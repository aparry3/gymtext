# Workout Extended Markdown Format Specification

## Overview

This document defines the extended markdown format used for workout display on the web. This format is generated by the workout agents and stored in `details.formatted` for rendering on the frontend.

## Design Principles

1. **Human-readable** - Can be read and understood without special parsing
2. **Flexible** - Adapts to any workout complexity (strength, cardio, circuits, etc.)
3. **LLM-friendly** - Text generation is more reliable than complex JSON
4. **Rich** - Contains all details needed for display (RPE, tempo, cues, equipment, etc.)
5. **Parseable** - Simple regex patterns can extract exercises for chat agent context

## Format Structure

### Session Header
```markdown
# {Theme} - {Focus}

## ğŸ¯ Session Overview
**Duration:** ~{X} minutes
**RPE Target:** {X-Y}
**Focus:** {Primary focus areas}
```

### Workout Blocks
Each block represents a section of the workout (warm-up, main lift, accessories, cool-down):

```markdown
---

## {Emoji} Block {N}: {Block Name}
**Goal:** {Purpose of this block}

{Work items...}
```

**Common block emojis:**
- ğŸ”¥ Warm-Up & Activation
- ğŸ’ª Main Lift / Strength Work
- ğŸ‹ï¸ Accessory Work
- ğŸƒ Conditioning / Cardio
- ğŸ§˜ Cool-Down / Mobility

### Work Items

#### Straight Sets
Single exercise performed for multiple sets:

```markdown
1. **{Exercise Name}** [{TYPE}]
   - {X} x {Y} reps @ {Z}% 1RM
   - RPE: {X} | RIR: {Y}
   - Rest: {X}min
   - Tempo: {X-Y-Z-W}
   - Equipment: {equipment}
   - *Cues: {coaching cues}*
   - **Progression:** {progression notes}
   - Notes: {additional notes}
```

**Exercise types:** [PREP], [COMPOUND], [SECONDARY], [ACCESSORY], [CORE], [CARDIO], [COOLDOWN]

#### Supersets
Two exercises alternated (e.g., A1, A2, A1, A2...):

```markdown
**A. Superset ({X} rounds, {Y}s rest between rounds):**
   1a. **{Exercise 1}**
       - {sets} x {reps} @ RPE {X}
       - *Cue: {cue}*

   1b. **{Exercise 2}**
       - {sets} x {reps}
       - Rest: {X}s before next exercise
```

#### Circuits
Three or more exercises performed in sequence:

```markdown
**B. Circuit ({X} rounds, {Y}s rest between rounds):**
   2a. **{Exercise 1}** - {sets} x {reps} @ RPE {X}
   2b. **{Exercise 2}** - {sets} x {reps}
   2c. **{Exercise 3}** - {duration}
```

### Cardio/Conditioning Format
```markdown
1. **{Activity Name}**
   - Duration: {X} min
   - Pace: {pace/effort description}
   - Heart Rate: Zone {X} ({Y-Z} bpm)
   - *Cue: {breathing/form cues}*
```

### Session Footer

```markdown
---

## ğŸ“ Coaching Notes
- {Note 1}
- {Note 2}
- {Note 3}

## ğŸ¯ Modifications Available
- **{Condition}:** {Modification}
- **{Condition}:** {Modification}
```

## Complete Examples

### Example 1: Strength Training (Upper Push)

```markdown
# Upper Push - Strength Focus

## ğŸ¯ Session Overview
**Duration:** ~60 minutes
**RPE Target:** 7-8
**Focus:** Horizontal pressing volume, vertical pressing strength

---

## ğŸ”¥ Block 1: Warm-Up & Activation
**Goal:** Prepare shoulders and chest for pressing

1. **Band Pull-Aparts** [PREP]
   - 3 x 20 reps
   - *Cue: Squeeze shoulder blades together*
   - Rest: 30s

2. **Push-Up Plus** [PREP]
   - 2 x 10 reps
   - Tempo: 2-0-1-0
   - *Cue: Protract scapula at top*

---

## ğŸ’ª Block 2: Main Lift
**Goal:** Build horizontal pressing strength

1. **Barbell Bench Press** [COMPOUND]
   - 4 x 5 reps @ 80% 1RM
   - RPE: 8 | RIR: 2
   - Rest: 3-4 min
   - Equipment: Barbell, bench
   - *Cues: Retract scapula, leg drive, bar path over mid-chest*
   - **Progression:** +5lbs from last week (225lbs â†’ 230lbs)

---

## ğŸ‹ï¸ Block 3: Accessory Work
**Goal:** Volume and hypertrophy

**A. Superset (3 rounds, 90s rest between rounds):**
   1a. **Incline Dumbbell Press** [SECONDARY]
       - 10-12 reps @ RPE 7
       - Equipment: Dumbbells, incline bench
       - *Cue: Full ROM, control eccentric*

   1b. **Cable Face Pulls** [ACCESSORY]
       - 15 reps
       - Equipment: Cable machine, rope attachment
       - *Cue: Pull to forehead level, external rotation*
       - Rest: 30s before next round

**B. Circuit (2 rounds, 60s rest between rounds):**
   2a. **Dips** [SECONDARY] - 8-10 reps @ RPE 8
   2b. **Lateral Raises** [ACCESSORY] - 12 reps per side
   2c. **Tricep Pushdowns** [ACCESSORY] - 15 reps

---

## ğŸ§˜ Block 4: Cool-Down
**Goal:** Mobility and recovery

1. **Doorway Pec Stretch**
   - 2 x 60s per side
   - *Cue: Lean forward gently, breathe deeply*

2. **Thread the Needle**
   - 2 x 10 reps per side

---

## ğŸ“ Coaching Notes
- If shoulder feels tight on bench, reduce ROM or switch to dumbbells
- Prioritize quality over weight on accessories
- Track dip reps - should improve weekly
- Adjust rest as needed to maintain RPE targets

## ğŸ¯ Modifications Available
- **No barbell:** Replace bench press with dumbbell bench press
- **Shoulder discomfort:** Swap dips for close-grip push-ups, reduce incline angle
- **Time constraint:** Skip block 4, reduce superset to 2 rounds
```

### Example 2: Running Workout

```markdown
# Easy Run - Aerobic Base Building

## ğŸ¯ Session Overview
**Duration:** ~45 minutes
**Effort:** Easy/Conversational
**Focus:** Aerobic base, active recovery

---

## ğŸƒ Block 1: Running
**Goal:** Build aerobic capacity

1. **Easy Run**
   - Duration: 40 min
   - Pace: 9:30-10:00 /mile (conversational)
   - Heart Rate: Zone 2 (130-145 bpm)
   - *Cues: Relax shoulders, land midfoot, breathe rhythmically*
   - Notes: Should feel easy - you can hold a conversation

---

## ğŸ§˜ Block 2: Cool-Down
**Goal:** Recovery and mobility

1. **Walking** - 5 min easy walk
2. **Hip Flexor Stretch** - 2 x 30s per side
3. **Quad Stretch** - 2 x 30s per side
4. **Calf Stretch** - 2 x 30s per side

---

## ğŸ“ Coaching Notes
- If you feel fatigue from previous workouts, cut short and walk
- Focus on nasal breathing as much as possible
- Note how your legs feel for tracking recovery

## ğŸ¯ Modifications Available
- **Fatigue:** Reduce to 30 min or walk intervals
- **Weather:** Indoor treadmill at 1% incline
```

### Example 3: MetCon/HIIT

```markdown
# EMOM MetCon - Power Endurance

## ğŸ¯ Session Overview
**Duration:** ~30 minutes
**Format:** EMOM (Every Minute On the Minute)
**Focus:** Power output, metabolic conditioning

---

## ğŸ”¥ Block 1: Warm-Up
**Goal:** Prepare for high-intensity work

1. **Jump Rope** - 3 min easy
2. **Dynamic Stretching** - 5 min (leg swings, arm circles, torso twists)
3. **Practice Movements** - 2 min (light KB swings, air squats, push-ups)

---

## ğŸƒ Block 2: EMOM Circuit
**Goal:** Sustain power output across 20 minutes

**Format:** EMOM 20 (alternating movements every minute)

**Minute 1:**
- **Kettlebell Swings** - 15 reps @ RPE 7-8
- Equipment: 53lb kettlebell
- *Cue: Hip hinge, explosive hip extension*

**Minute 2:**
- **Burpees** - 10 reps
- *Cue: Chest to deck, full hip extension at top*

Repeat for 20 minutes (10 rounds total)

**Rest:** Remaining time in each minute

---

## ğŸ§˜ Block 3: Cool-Down
**Goal:** Bring heart rate down, stretch

1. **Easy Walk/Row** - 3-5 min until HR < 120
2. **Downward Dog to Child's Pose Flow** - 2 min
3. **Hamstring Stretch** - 2 x 30s per side

---

## ğŸ“ Coaching Notes
- Goal is to finish each movement with 15-20s rest
- If you can't finish in time, reduce reps (12 swings, 8 burpees)
- Focus on quality of movement over speed
- Heart rate should be 75-85% max during work

## ğŸ¯ Modifications Available
- **Too intense:** Reduce to 15 minutes, or increase rest (EMOM 90s)
- **No kettlebell:** Use dumbbell or perform jump squats
- **Burpees too hard:** Step-back burpees or mountain climbers
```

## Parsing Rules for Chat Agent

To extract exercises for chat context, use these patterns:

**Exercise name extraction:**
- Pattern: `**{Exercise Name}**` followed by `[TYPE]` or exercise details
- Example: `**Barbell Bench Press** [COMPOUND]` â†’ "Barbell Bench Press"

**Superset detection:**
- Pattern: Lines starting with `{N}a.`, `{N}b.`, etc.
- Example: `1a. **Exercise 1**` and `1b. **Exercise 2**` â†’ Superset pair

**Circuit detection:**
- Pattern: Section with header containing "Circuit"
- Lines with `{N}a.`, `{N}b.`, `{N}c.`, etc.

## Required Fields

Every formatted workout MUST include:

1. **Session Header** - Theme/title and overview
2. **At least one Block** - With goal and work items
3. **Coaching Notes** - Contextual information for the user

## Optional Fields

These can be included as needed:

- RPE, RIR, percentage 1RM
- Tempo prescriptions
- Equipment specifications
- Coaching cues
- Progression notes
- Modifications section
- Session context (week number, phase, etc.)

## Validation

The formatted text should:
- Start with `# ` (h1 header)
- Include at least one `## ` (h2 header for blocks)
- Include at least one exercise with `**Exercise Name**`
- Be valid markdown (parseable by standard markdown parsers)

## Migration Notes

- New workouts will have `details.formatted` populated
- Existing workouts will fall back to JSON parsing in frontend
- Chat agent should try formatted parsing first, fall back to JSON
