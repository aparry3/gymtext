{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/server/config/env.ts"],"sourcesContent":["/**\n * Server Environment Variables\n *\n * THE ONLY place in the codebase that validates server-side secrets.\n * App config overrides are handled by shared/config.\n */\nimport { z } from 'zod';\n\n// =============================================================================\n// Zod Schema - Server Secrets Only\n// =============================================================================\n\nconst ServerEnvSchema = z.object({\n  // -------------------------------------------------------------------------\n  // Database\n  // -------------------------------------------------------------------------\n  DATABASE_URL: z.string().min(1, 'DATABASE_URL is required'),\n  SESSION_ENCRYPTION_KEY: z.string().optional(),\n\n  // -------------------------------------------------------------------------\n  // Twilio\n  // -------------------------------------------------------------------------\n  TWILIO_ACCOUNT_SID: z.string().min(1, 'TWILIO_ACCOUNT_SID is required'),\n  TWILIO_AUTH_TOKEN: z.string().min(1, 'TWILIO_AUTH_TOKEN is required'),\n  TWILIO_NUMBER: z.string().min(1, 'TWILIO_NUMBER is required'),\n\n  // -------------------------------------------------------------------------\n  // Stripe\n  // -------------------------------------------------------------------------\n  STRIPE_SECRET_KEY: z.string().min(1, 'STRIPE_SECRET_KEY is required'),\n  STRIPE_WEBHOOK_SECRET: z.string().optional(), // Optional for development\n\n  // -------------------------------------------------------------------------\n  // AI - validated but LangChain reads these directly from process.env\n  // -------------------------------------------------------------------------\n  OPENAI_API_KEY: z.string().min(1, 'OPENAI_API_KEY is required'),\n  GOOGLE_API_KEY: z.string().min(1, 'GOOGLE_API_KEY is required'),\n  XAI_API_KEY: z.string().optional(),\n\n  // -------------------------------------------------------------------------\n  // Pinecone\n  // -------------------------------------------------------------------------\n  PINECONE_API_KEY: z.string().min(1, 'PINECONE_API_KEY is required'),\n  PINECONE_INDEX: z.string().min(1, 'PINECONE_INDEX is required'),\n\n  // -------------------------------------------------------------------------\n  // Background Jobs\n  // -------------------------------------------------------------------------\n  CRON_SECRET: z.string().optional(),\n  INNGEST_EVENT_KEY: z.string().optional(),\n  INNGEST_SIGNING_KEY: z.string().optional(),\n\n  // -------------------------------------------------------------------------\n  // Environment (for server-side env detection)\n  // -------------------------------------------------------------------------\n  NODE_ENV: z.enum(['development', 'test', 'production']).default('development'),\n  APP_ENV: z.enum(['development', 'staging', 'production']).optional(),\n});\n\n// =============================================================================\n// Validation\n// =============================================================================\n\nfunction validateServerEnv() {\n  const result = ServerEnvSchema.safeParse(process.env);\n\n  if (!result.success) {\n    const errors = result.error.errors\n      .map((e) => `  - ${e.path.join('.')}: ${e.message}`)\n      .join('\\n');\n\n    throw new Error(\n      `Server environment validation failed:\\n${errors}\\n\\n` +\n        `Ensure all required environment variables are set.`\n    );\n  }\n\n  return result.data;\n}\n\n// Singleton - validated once at startup\nlet _serverEnv: z.infer<typeof ServerEnvSchema> | null = null;\n\n/**\n * Get validated server environment variables.\n * Caches the result for subsequent calls.\n */\nexport function getServerEnv() {\n  if (!_serverEnv) {\n    _serverEnv = validateServerEnv();\n  }\n  return _serverEnv;\n}\n\n/**\n * Reset env cache (useful for testing).\n */\nexport function resetServerEnv() {\n  _serverEnv = null;\n}\n\n// Export type\nexport type ServerEnv = z.infer<typeof ServerEnvSchema>;\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;AACD;AAAA;;AAEA,gFAAgF;AAChF,mCAAmC;AACnC,gFAAgF;AAEhF,MAAM,kBAAkB,0MAAC,CAAC,MAAM,CAAC;IAC/B,4EAA4E;IAC5E,WAAW;IACX,4EAA4E;IAC5E,cAAc,0MAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAChC,wBAAwB,0MAAC,CAAC,MAAM,GAAG,QAAQ;IAE3C,4EAA4E;IAC5E,SAAS;IACT,4EAA4E;IAC5E,oBAAoB,0MAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACtC,mBAAmB,0MAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACrC,eAAe,0MAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAEjC,4EAA4E;IAC5E,SAAS;IACT,4EAA4E;IAC5E,mBAAmB,0MAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACrC,uBAAuB,0MAAC,CAAC,MAAM,GAAG,QAAQ;IAE1C,4EAA4E;IAC5E,qEAAqE;IACrE,4EAA4E;IAC5E,gBAAgB,0MAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAClC,gBAAgB,0MAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAClC,aAAa,0MAAC,CAAC,MAAM,GAAG,QAAQ;IAEhC,4EAA4E;IAC5E,WAAW;IACX,4EAA4E;IAC5E,kBAAkB,0MAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACpC,gBAAgB,0MAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAElC,4EAA4E;IAC5E,kBAAkB;IAClB,4EAA4E;IAC5E,aAAa,0MAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,mBAAmB,0MAAC,CAAC,MAAM,GAAG,QAAQ;IACtC,qBAAqB,0MAAC,CAAC,MAAM,GAAG,QAAQ;IAExC,4EAA4E;IAC5E,8CAA8C;IAC9C,4EAA4E;IAC5E,UAAU,0MAAC,CAAC,IAAI,CAAC;QAAC;QAAe;QAAQ;KAAa,EAAE,OAAO,CAAC;IAChE,SAAS,0MAAC,CAAC,IAAI,CAAC;QAAC;QAAe;QAAW;KAAa,EAAE,QAAQ;AACpE;AAEA,gFAAgF;AAChF,aAAa;AACb,gFAAgF;AAEhF,SAAS;IACP,MAAM,SAAS,gBAAgB,SAAS,CAAC,QAAQ,GAAG;IAEpD,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,SAAS,OAAO,KAAK,CAAC,MAAM,CAC/B,GAAG,CAAC,CAAC,IAAM,CAAC,IAAI,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE,EAAE,OAAO,EAAE,EAClD,IAAI,CAAC;QAER,MAAM,IAAI,MACR,CAAC,uCAAuC,EAAE,OAAO,IAAI,CAAC,GACpD,CAAC,kDAAkD,CAAC;IAE1D;IAEA,OAAO,OAAO,IAAI;AACpB;AAEA,wCAAwC;AACxC,IAAI,aAAqD;AAMlD,SAAS;IACd,IAAI,CAAC,YAAY;QACf,aAAa;IACf;IACA,OAAO;AACT;AAKO,SAAS;IACd,aAAa;AACf"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/server/config/secrets.ts"],"sourcesContent":["/**\n * Server Secrets\n *\n * Grouped accessors for secret environment variables.\n * All secrets are validated at import time via getServerEnv().\n */\nimport { getServerEnv } from './env';\n\n// =============================================================================\n// Database Secrets\n// =============================================================================\n\nexport function getDatabaseSecrets() {\n  const env = getServerEnv();\n  return {\n    databaseUrl: env.DATABASE_URL,\n    sessionEncryptionKey: env.SESSION_ENCRYPTION_KEY,\n  };\n}\n\n// =============================================================================\n// Twilio Secrets\n// =============================================================================\n\nexport function getTwilioSecrets() {\n  const env = getServerEnv();\n  return {\n    accountSid: env.TWILIO_ACCOUNT_SID,\n    authToken: env.TWILIO_AUTH_TOKEN,\n    phoneNumber: env.TWILIO_NUMBER,\n  };\n}\n\n// =============================================================================\n// Stripe Secrets\n// =============================================================================\n\nexport function getStripeSecrets() {\n  const env = getServerEnv();\n  return {\n    secretKey: env.STRIPE_SECRET_KEY,\n    // webhookSecret may be undefined in development, but required for webhook route\n    webhookSecret: env.STRIPE_WEBHOOK_SECRET!,\n  };\n}\n\n// =============================================================================\n// AI Secrets\n// Note: LangChain auto-reads OPENAI_API_KEY and GOOGLE_API_KEY from process.env.\n// We expose them here for cases where direct access is needed (e.g., GoogleGenAI SDK).\n// =============================================================================\n\nexport function getAiSecrets() {\n  const env = getServerEnv();\n  return {\n    openaiApiKey: env.OPENAI_API_KEY,\n    googleApiKey: env.GOOGLE_API_KEY,\n    xaiApiKey: env.XAI_API_KEY,\n  };\n}\n\n// =============================================================================\n// Pinecone Secrets\n// =============================================================================\n\nexport function getPineconeSecrets() {\n  const env = getServerEnv();\n  return {\n    apiKey: env.PINECONE_API_KEY,\n    indexName: env.PINECONE_INDEX,\n  };\n}\n\n// =============================================================================\n// Background Job Secrets\n// =============================================================================\n\nexport function getCronSecrets() {\n  const env = getServerEnv();\n  return {\n    cronSecret: env.CRON_SECRET,\n    inngestEventKey: env.INNGEST_EVENT_KEY,\n    inngestSigningKey: env.INNGEST_SIGNING_KEY,\n  };\n}\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;;;;;;;;;AACD;;AAMO,SAAS;IACd,MAAM,MAAM,IAAA,sKAAY;IACxB,OAAO;QACL,aAAa,IAAI,YAAY;QAC7B,sBAAsB,IAAI,sBAAsB;IAClD;AACF;AAMO,SAAS;IACd,MAAM,MAAM,IAAA,sKAAY;IACxB,OAAO;QACL,YAAY,IAAI,kBAAkB;QAClC,WAAW,IAAI,iBAAiB;QAChC,aAAa,IAAI,aAAa;IAChC;AACF;AAMO,SAAS;IACd,MAAM,MAAM,IAAA,sKAAY;IACxB,OAAO;QACL,WAAW,IAAI,iBAAiB;QAChC,gFAAgF;QAChF,eAAe,IAAI,qBAAqB;IAC1C;AACF;AAQO,SAAS;IACd,MAAM,MAAM,IAAA,sKAAY;IACxB,OAAO;QACL,cAAc,IAAI,cAAc;QAChC,cAAc,IAAI,cAAc;QAChC,WAAW,IAAI,WAAW;IAC5B;AACF;AAMO,SAAS;IACd,MAAM,MAAM,IAAA,sKAAY;IACxB,OAAO;QACL,QAAQ,IAAI,gBAAgB;QAC5B,WAAW,IAAI,cAAc;IAC/B;AACF;AAMO,SAAS;IACd,MAAM,MAAM,IAAA,sKAAY;IACxB,OAAO;QACL,YAAY,IAAI,WAAW;QAC3B,iBAAiB,IAAI,iBAAiB;QACtC,mBAAmB,IAAI,mBAAmB;IAC5C;AACF"}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/server/config/settings.ts"],"sourcesContent":["/**\n * Server Settings\n *\n * Non-secret server-only settings.\n * For app config (admin, urls, etc.), use shared/config instead.\n */\nimport { getServerEnv } from './env';\n\n// =============================================================================\n// Environment Detection\n// =============================================================================\n\nexport function getEnvironmentSettings() {\n  const env = getServerEnv();\n  return {\n    nodeEnv: env.NODE_ENV,\n    appEnv: env.APP_ENV,\n    isDevelopment: env.NODE_ENV === 'development',\n    isProduction: env.NODE_ENV === 'production',\n    isTest: env.NODE_ENV === 'test',\n  };\n}\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;AACD;;AAMO,SAAS;IACd,MAAM,MAAM,IAAA,sKAAY;IACxB,OAAO;QACL,SAAS,IAAI,QAAQ;QACrB,QAAQ,IAAI,OAAO;QACnB,eAAe,IAAI,QAAQ,KAAK;QAChC,cAAc,IAAI,QAAQ,KAAK;QAC/B,QAAQ,IAAI,QAAQ,KAAK;IAC3B;AACF"}},
    {"offset": {"line": 221, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/server/config/index.ts"],"sourcesContent":["/**\n * Server Configuration\n *\n * This module protects server-only config from client bundles.\n * Any attempt to import this from client code will fail at build time.\n */\nimport 'server-only';\n\n// Re-export everything\nexport * from './env';\nexport * from './secrets';\nexport * from './settings';\n"],"names":[],"mappings":"AAAA;;;;;CAKC;AACD;AAEA,uBAAuB;AACvB;AACA;AACA"}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/shared/config/schema.ts"],"sourcesContent":["import { z } from 'zod';\n\n// ============================================================================\n// Environment Detection (for smart defaults)\n// ============================================================================\nconst isDev = process.env.NODE_ENV === 'development';\nconst isProd = process.env.NODE_ENV === 'production';\n\n// ============================================================================\n// Context Configuration (migrated from context.config.ts)\n// ============================================================================\nexport const ContextConfigSchema = z.object({\n  messageHistoryLimit: z.number().int().positive().default(5),\n  includeSystemMessages: z.boolean().default(true),\n  maxContextTokens: z.number().int().positive().default(1000),\n  reserveTokensForResponse: z.number().int().positive().default(1500),\n  conversationGapMinutes: z.number().int().positive().default(30),\n  enableCaching: z.boolean().default(true),\n  // Longer cache in production\n  cacheTTLSeconds: z.number().int().nonnegative().default(isProd ? 600 : 300),\n});\n\n// ============================================================================\n// Chat Configuration\n// ============================================================================\nexport const ChatConfigSchema = z.object({\n  smsMaxLength: z.number().int().positive().default(1600),\n  contextMinutes: z.number().int().positive().default(10),\n});\n\n// ============================================================================\n// Messaging Configuration\n// ============================================================================\nexport const MessagingProviderSchema = z.enum(['twilio', 'local']);\n\nexport const MessagingConfigSchema = z.object({\n  // Use local provider in development, twilio in production\n  provider: MessagingProviderSchema.default(isDev ? 'local' : 'twilio'),\n});\n\n// ============================================================================\n// Feature Flags\n// ============================================================================\nexport const FeatureFlagsSchema = z.object({\n  // Enable agent logging in development by default\n  agentLogging: z.boolean().default(isDev),\n  enableConversationStorage: z.boolean().default(true),\n});\n\n// ============================================================================\n// Conversation Configuration\n// ============================================================================\nexport const ConversationConfigSchema = z.object({\n  timeoutMinutes: z.number().int().positive().default(30),\n  maxLength: z.number().int().positive().default(100),\n  inactiveThresholdDays: z.number().int().positive().default(7),\n});\n\n// ============================================================================\n// Short Links Configuration\n// ============================================================================\nexport const ShortLinksConfigSchema = z.object({\n  defaultExpiryDays: z.number().int().positive().default(7),\n  domain: z.string().optional(),\n});\n\n// ============================================================================\n// Stripe Configuration (non-secret)\n// ============================================================================\nexport const StripeConfigSchema = z.object({\n  priceId: z.string().min(1),\n});\n\n// ============================================================================\n// Admin Configuration\n// ============================================================================\nexport const AdminConfigSchema = z.object({\n  phoneNumbers: z.array(z.string()).default([]),\n  maxRequestsPerWindow: z.number().int().positive().default(3),\n  rateLimitWindowMinutes: z.number().int().positive().default(15),\n  codeExpiryMinutes: z.number().int().positive().default(10),\n  codeLength: z.number().int().positive().default(6),\n  devBypassCode: z.string().optional(),\n});\n\n// ============================================================================\n// Application URLs\n// ============================================================================\nexport const UrlsConfigSchema = z.object({\n  baseUrl: z.string().optional(),\n  publicBaseUrl: z.string().optional(),\n});\n\n// ============================================================================\n// Root Configuration Schema\n// ============================================================================\nexport const AppConfigSchema = z.object({\n  environment: z.enum(['development', 'staging', 'production']),\n  context: ContextConfigSchema,\n  chat: ChatConfigSchema,\n  messaging: MessagingConfigSchema,\n  features: FeatureFlagsSchema,\n  conversation: ConversationConfigSchema,\n  shortLinks: ShortLinksConfigSchema,\n  stripe: StripeConfigSchema,\n  admin: AdminConfigSchema,\n  urls: UrlsConfigSchema,\n});\n\n// Export types inferred from schemas\nexport type AppConfig = z.infer<typeof AppConfigSchema>;\nexport type ContextConfig = z.infer<typeof ContextConfigSchema>;\nexport type ChatConfig = z.infer<typeof ChatConfigSchema>;\nexport type MessagingConfig = z.infer<typeof MessagingConfigSchema>;\nexport type MessagingProvider = z.infer<typeof MessagingProviderSchema>;\nexport type FeatureFlags = z.infer<typeof FeatureFlagsSchema>;\nexport type ConversationConfig = z.infer<typeof ConversationConfigSchema>;\nexport type ShortLinksConfig = z.infer<typeof ShortLinksConfigSchema>;\nexport type StripeConfig = z.infer<typeof StripeConfigSchema>;\nexport type AdminConfig = z.infer<typeof AdminConfigSchema>;\nexport type UrlsConfig = z.infer<typeof UrlsConfigSchema>;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 343, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/shared/config/loader.ts"],"sourcesContent":["import { AppConfigSchema, type AppConfig, type MessagingProvider } from './schema';\n\nexport type Environment = 'development' | 'staging' | 'production';\n\n/**\n * Determine current environment.\n * APP_ENV can override NODE_ENV (useful for staging which isn't a Node concept).\n */\nexport function getEnvironment(): Environment {\n  const appEnv = process.env.APP_ENV;\n  const nodeEnv = process.env.NODE_ENV;\n\n  if (appEnv === 'staging') return 'staging';\n  if (nodeEnv === 'production') return 'production';\n  return 'development';\n}\n\n/**\n * Parse comma-separated phone numbers from env var.\n */\nfunction parsePhoneNumbers(envValue: string | undefined): string[] {\n  if (!envValue) return [];\n  return envValue\n    .split(',')\n    .map((num) => num.trim())\n    .filter((num) => num.length > 0);\n}\n\n/**\n * Parse optional integer from env var.\n */\nfunction parseOptionalInt(value: string | undefined): number | undefined {\n  if (!value) return undefined;\n  const parsed = parseInt(value, 10);\n  return isNaN(parsed) ? undefined : parsed;\n}\n\n/**\n * Parse optional boolean from env var.\n * Treats 'true' as true, 'false' as false, undefined as undefined.\n */\nfunction parseOptionalBool(value: string | undefined): boolean | undefined {\n  if (value === undefined) return undefined;\n  return value === 'true';\n}\n\n/**\n * Load and validate configuration.\n * Builds config from env vars, letting Zod schemas handle defaults.\n * Throws on validation failure (fail-fast).\n */\nexport function loadConfig(): AppConfig {\n  const env = getEnvironment();\n\n  // Build raw config from env vars - undefined values let Zod defaults apply\n  const rawConfig = {\n    environment: env,\n    context: {\n      messageHistoryLimit: parseOptionalInt(process.env.CONTEXT_MESSAGE_HISTORY_LIMIT),\n      includeSystemMessages: parseOptionalBool(process.env.CONTEXT_INCLUDE_SYSTEM_MESSAGES),\n      maxContextTokens: parseOptionalInt(process.env.CONTEXT_MAX_TOKENS),\n      reserveTokensForResponse: parseOptionalInt(process.env.CONTEXT_RESERVE_TOKENS),\n      conversationGapMinutes: parseOptionalInt(process.env.CONTEXT_CONVERSATION_GAP_MINUTES),\n      enableCaching: parseOptionalBool(process.env.CONTEXT_ENABLE_CACHING),\n      cacheTTLSeconds: parseOptionalInt(process.env.CONTEXT_CACHE_TTL),\n    },\n    chat: {\n      smsMaxLength: parseOptionalInt(process.env.SMS_MAX_LENGTH),\n      contextMinutes: parseOptionalInt(process.env.CHAT_CONTEXT_MINUTES),\n    },\n    messaging: {\n      provider: process.env.MESSAGING_PROVIDER as MessagingProvider | undefined,\n    },\n    features: {\n      agentLogging: parseOptionalBool(process.env.AGENT_LOGGING),\n      enableConversationStorage: parseOptionalBool(process.env.ENABLE_CONVERSATION_STORAGE),\n    },\n    conversation: {\n      timeoutMinutes: parseOptionalInt(process.env.CONVERSATION_TIMEOUT_MINUTES),\n      maxLength: parseOptionalInt(process.env.MAX_CONVERSATION_LENGTH),\n      inactiveThresholdDays: parseOptionalInt(process.env.INACTIVE_THRESHOLD_DAYS),\n    },\n    shortLinks: {\n      defaultExpiryDays: parseOptionalInt(process.env.SHORT_LINK_DEFAULT_EXPIRY_DAYS),\n      domain: process.env.SHORT_LINK_DOMAIN,\n    },\n    stripe: {\n      priceId: process.env.STRIPE_PRICE_ID,\n    },\n    admin: {\n      phoneNumbers: process.env.ADMIN_PHONE_NUMBERS\n        ? parsePhoneNumbers(process.env.ADMIN_PHONE_NUMBERS)\n        : undefined,\n      devBypassCode: process.env.DEV_BYPASS_CODE,\n    },\n    urls: {\n      baseUrl: process.env.BASE_URL,\n      publicBaseUrl: process.env.NEXT_PUBLIC_BASE_URL,\n    },\n  };\n\n  // Validate with Zod - applies defaults and throws on failure\n  const result = AppConfigSchema.safeParse(rawConfig);\n\n  if (!result.success) {\n    const errors = result.error.errors\n      .map((e) => `  - ${e.path.join('.')}: ${e.message}`)\n      .join('\\n');\n\n    throw new Error(\n      `Configuration validation failed:\\n${errors}\\n\\n` +\n        `Environment: ${env}\\n` +\n        `Check your environment variables.`\n    );\n  }\n\n  return result.data;\n}\n\n// Singleton config instance\nlet _config: AppConfig | null = null;\n\n/**\n * Get the validated application config.\n * Caches the result for subsequent calls.\n */\nexport function getConfig(): AppConfig {\n  if (!_config) {\n    _config = loadConfig();\n  }\n  return _config;\n}\n\n/**\n * Reset config cache (useful for testing).\n */\nexport function resetConfig(): void {\n  _config = null;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 452, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/shared/config/public.ts"],"sourcesContent":["/**\n * Public Configuration\n *\n * Safe for client-side usage. All NEXT_PUBLIC_* values are validated here.\n */\nimport { z } from 'zod';\n\n// =============================================================================\n// Public Environment Schema\n// =============================================================================\n\nconst PublicEnvSchema = z.object({\n  NEXT_PUBLIC_BASE_URL: z.string().optional(),\n  NEXT_PUBLIC_ANALYTICS_WRITE_KEY: z.string().optional(),\n  NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: z.string().optional(),\n});\n\ntype PublicEnv = z.infer<typeof PublicEnvSchema>;\n\n// =============================================================================\n// Validation & Caching\n// =============================================================================\n\nlet _publicEnv: PublicEnv | null = null;\n\nfunction getPublicEnv(): PublicEnv {\n  if (!_publicEnv) {\n    const result = PublicEnvSchema.safeParse({\n      NEXT_PUBLIC_BASE_URL: process.env.NEXT_PUBLIC_BASE_URL,\n      NEXT_PUBLIC_ANALYTICS_WRITE_KEY: process.env.NEXT_PUBLIC_ANALYTICS_WRITE_KEY,\n      NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,\n    });\n\n    if (!result.success) {\n      console.warn('Public environment validation warnings:', result.error.errors);\n    }\n\n    _publicEnv = result.data ?? {};\n  }\n  return _publicEnv;\n}\n\n/**\n * Reset env cache (useful for testing).\n */\nexport function resetPublicEnv(): void {\n  _publicEnv = null;\n}\n\n// =============================================================================\n// URL Settings\n// =============================================================================\n\nexport function getPublicUrls() {\n  const env = getPublicEnv();\n  return {\n    baseUrl: env.NEXT_PUBLIC_BASE_URL,\n  };\n}\n\n// =============================================================================\n// Analytics Config\n// =============================================================================\n\nexport function getAnalyticsConfig() {\n  const env = getPublicEnv();\n  return {\n    writeKey: env.NEXT_PUBLIC_ANALYTICS_WRITE_KEY,\n    isEnabled: Boolean(env.NEXT_PUBLIC_ANALYTICS_WRITE_KEY),\n  };\n}\n\n// =============================================================================\n// Public Stripe Config\n// =============================================================================\n\nexport function getPublicStripeConfig() {\n  const env = getPublicEnv();\n  return {\n    publishableKey: env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,\n  };\n}\n\n// =============================================================================\n// Environment Detection (client-safe)\n// =============================================================================\n\n/**\n * Check if running in production environment.\n * Safe for use in client components.\n */\nexport function isProductionEnvironment(): boolean {\n  return process.env.NODE_ENV === 'production';\n}\n\n/**\n * Check if running in development environment.\n * Safe for use in client components.\n */\nexport function isDevelopmentEnvironment(): boolean {\n  return process.env.NODE_ENV === 'development';\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;;;;;;;;AACD;AAAA;;AAEA,gFAAgF;AAChF,4BAA4B;AAC5B,gFAAgF;AAEhF,MAAM,kBAAkB,0MAAC,CAAC,MAAM,CAAC;IAC/B,sBAAsB,0MAAC,CAAC,MAAM,GAAG,QAAQ;IACzC,iCAAiC,0MAAC,CAAC,MAAM,GAAG,QAAQ;IACpD,oCAAoC,0MAAC,CAAC,MAAM,GAAG,QAAQ;AACzD;AAIA,gFAAgF;AAChF,uBAAuB;AACvB,gFAAgF;AAEhF,IAAI,aAA+B;AAEnC,SAAS;IACP,IAAI,CAAC,YAAY;QACf,MAAM,SAAS,gBAAgB,SAAS,CAAC;YACvC,oBAAoB;YACpB,iCAAiC,QAAQ,GAAG,CAAC,+BAA+B;YAC5E,kCAAkC;QACpC;QAEA,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,QAAQ,IAAI,CAAC,2CAA2C,OAAO,KAAK,CAAC,MAAM;QAC7E;QAEA,aAAa,OAAO,IAAI,IAAI,CAAC;IAC/B;IACA,OAAO;AACT;AAKO,SAAS;IACd,aAAa;AACf;AAMO,SAAS;IACd,MAAM,MAAM;IACZ,OAAO;QACL,SAAS,IAAI,oBAAoB;IACnC;AACF;AAMO,SAAS;IACd,MAAM,MAAM;IACZ,OAAO;QACL,UAAU,IAAI,+BAA+B;QAC7C,WAAW,QAAQ,IAAI,+BAA+B;IACxD;AACF;AAMO,SAAS;IACd,MAAM,MAAM;IACZ,OAAO;QACL,gBAAgB,IAAI,kCAAkC;IACxD;AACF;AAUO,SAAS;IACd,OAAO,oDAAyB;AAClC;AAMO,SAAS;IACd,OAAO,oDAAyB;AAClC"}},
    {"offset": {"line": 531, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/shared/config/index.ts"],"sourcesContent":["/**\n * Application Configuration\n *\n * This module provides type-safe, validated configuration for the application.\n * Config values are loaded once at startup and cached.\n *\n * Usage:\n *   import { config } from '@/shared/config';\n *   console.log(config.chat.smsMaxLength);\n *\n * Or use section accessors:\n *   import { getChatConfig, getFeatureFlags } from '@/shared/config';\n *   const { smsMaxLength } = getChatConfig();\n */\n\nexport { getConfig, loadConfig, resetConfig, getEnvironment } from './loader';\nexport type { Environment } from './loader';\nexport * from './schema';\nexport * from './public';\n\nimport { getConfig } from './loader';\nimport type {\n  AppConfig,\n  ContextConfig,\n  ChatConfig,\n  MessagingConfig,\n  FeatureFlags,\n  ConversationConfig,\n  ShortLinksConfig,\n  StripeConfig,\n  AdminConfig,\n  UrlsConfig,\n} from './schema';\n\n// ============================================================================\n// Lazy config getter to avoid issues during build/module loading\n// ============================================================================\n\nlet _cachedConfig: AppConfig | null = null;\n\nfunction getCachedConfig(): AppConfig {\n  if (!_cachedConfig) {\n    _cachedConfig = getConfig();\n  }\n  return _cachedConfig;\n}\n\n/**\n * The validated application configuration.\n * Use this for direct property access: config.chat.smsMaxLength\n *\n * Note: This is a getter that lazily loads config on first access.\n */\nexport const config = new Proxy({} as AppConfig, {\n  get(_target, prop) {\n    return getCachedConfig()[prop as keyof AppConfig];\n  },\n});\n\n// ============================================================================\n// Convenience accessors for individual config sections\n// These match the existing getContextConfig() pattern\n// ============================================================================\n\nexport function getContextConfig(): ContextConfig {\n  return getConfig().context;\n}\n\nexport function getChatConfig(): ChatConfig {\n  return getConfig().chat;\n}\n\nexport function getMessagingConfig(): MessagingConfig {\n  return getConfig().messaging;\n}\n\nexport function getFeatureFlags(): FeatureFlags {\n  return getConfig().features;\n}\n\nexport function getConversationConfig(): ConversationConfig {\n  return getConfig().conversation;\n}\n\nexport function getShortLinksConfig(): ShortLinksConfig {\n  return getConfig().shortLinks;\n}\n\nexport function getStripeConfig(): StripeConfig {\n  return getConfig().stripe;\n}\n\nexport function getAdminConfig(): AdminConfig {\n  return getConfig().admin;\n}\n\nexport function getUrlsConfig(): UrlsConfig {\n  return getConfig().urls;\n}\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;CAaC;;;;;;;;;;;;;;;;;;;;;;AAED;AAEA;AACA;;;;;AAgBA,+EAA+E;AAC/E,iEAAiE;AACjE,+EAA+E;AAE/E,IAAI,gBAAkC;AAEtC,SAAS;IACP,IAAI,CAAC,eAAe;QAClB,gBAAgB,IAAA,sKAAS;IAC3B;IACA,OAAO;AACT;AAQO,MAAM,SAAS,IAAI,MAAM,CAAC,GAAgB;IAC/C,KAAI,OAAO,EAAE,IAAI;QACf,OAAO,iBAAiB,CAAC,KAAwB;IACnD;AACF;AAOO,SAAS;IACd,OAAO,IAAA,sKAAS,IAAG,OAAO;AAC5B;AAEO,SAAS;IACd,OAAO,IAAA,sKAAS,IAAG,IAAI;AACzB;AAEO,SAAS;IACd,OAAO,IAAA,sKAAS,IAAG,SAAS;AAC9B;AAEO,SAAS;IACd,OAAO,IAAA,sKAAS,IAAG,QAAQ;AAC7B;AAEO,SAAS;IACd,OAAO,IAAA,sKAAS,IAAG,YAAY;AACjC;AAEO,SAAS;IACd,OAAO,IAAA,sKAAS,IAAG,UAAU;AAC/B;AAEO,SAAS;IACd,OAAO,IAAA,sKAAS,IAAG,MAAM;AAC3B;AAEO,SAAS;IACd,OAAO,IAAA,sKAAS,IAAG,KAAK;AAC1B;AAEO,SAAS;IACd,OAAO,IAAA,sKAAS,IAAG,IAAI;AACzB"}},
    {"offset": {"line": 721, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/server/connections/twilio/factory.ts"],"sourcesContent":["/**\n * Twilio Client Factory\n *\n * Creates Twilio client instances on-demand. Supports multiple\n * credentials for environment switching (sandbox/production).\n */\nimport twilio from 'twilio';\nimport { MessageInstance } from 'twilio/lib/rest/api/v2010/account/message';\n\n/**\n * Twilio credentials configuration\n */\nexport interface TwilioCredentials {\n  accountSid: string;\n  authToken: string;\n  phoneNumber: string;\n}\n\n/**\n * Twilio client interface for dependency injection\n */\nexport interface ITwilioClient {\n  sendSMS(to: string, message?: string, mediaUrls?: string[]): Promise<MessageInstance>;\n  sendMMS(to: string, message: string | undefined, mediaUrls: string[]): Promise<MessageInstance>;\n  getMessageStatus(messageSid: string): Promise<MessageInstance>;\n  getFromNumber(): string;\n}\n\n// Cache clients by account SID\nconst clientCache = new Map<string, ITwilioClient>();\n\n/**\n * Create or retrieve a cached Twilio client\n * @param credentials - Twilio account credentials\n * @param statusCallbackUrl - Optional status callback URL for message delivery updates\n * @returns ITwilioClient instance\n */\nexport function createTwilioClient(\n  credentials: TwilioCredentials,\n  statusCallbackUrl?: string\n): ITwilioClient {\n  const cacheKey = credentials.accountSid;\n\n  // Return cached instance if available\n  if (clientCache.has(cacheKey)) {\n    return clientCache.get(cacheKey)!;\n  }\n\n  const client = twilio(credentials.accountSid, credentials.authToken);\n  const fromNumber = credentials.phoneNumber;\n\n  const twilioClient: ITwilioClient = {\n    async sendSMS(to: string, message?: string, mediaUrls?: string[]): Promise<MessageInstance> {\n      try {\n        const messageType = mediaUrls && mediaUrls.length > 0 ? 'MMS' : 'SMS';\n        console.log(`Sending ${messageType} from:`, fromNumber, 'to:', to);\n        if (mediaUrls && mediaUrls.length > 0) {\n          console.log('Media URLs:', mediaUrls);\n        }\n        if (!message && (!mediaUrls || mediaUrls.length === 0)) {\n          throw new Error('Must provide either message text or media URLs');\n        }\n\n        const response = await client.messages.create({\n          ...(message && { body: message }),\n          from: fromNumber,\n          to: to,\n          statusCallback: statusCallbackUrl,\n          ...(mediaUrls && mediaUrls.length > 0 && { mediaUrl: mediaUrls }),\n        });\n        return response;\n      } catch (error) {\n        console.error('Error sending SMS/MMS:', error);\n        throw error;\n      }\n    },\n\n    async sendMMS(to: string, message: string | undefined, mediaUrls: string[]): Promise<MessageInstance> {\n      return this.sendSMS(to, message, mediaUrls);\n    },\n\n    async getMessageStatus(messageSid: string): Promise<MessageInstance> {\n      return await client.messages(messageSid).fetch();\n    },\n\n    getFromNumber(): string {\n      return fromNumber;\n    },\n  };\n\n  clientCache.set(cacheKey, twilioClient);\n  return twilioClient;\n}\n\n/**\n * Clear all cached Twilio clients\n */\nexport function clearTwilioClients(): void {\n  clientCache.clear();\n}\n\n/**\n * Get all active Twilio account SIDs (for debugging)\n */\nexport function getActiveTwilioAccounts(): string[] {\n  return Array.from(clientCache.keys());\n}\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;;;AACD;;AAsBA,+BAA+B;AAC/B,MAAM,cAAc,IAAI;AAQjB,SAAS,mBACd,WAA8B,EAC9B,iBAA0B;IAE1B,MAAM,WAAW,YAAY,UAAU;IAEvC,sCAAsC;IACtC,IAAI,YAAY,GAAG,CAAC,WAAW;QAC7B,OAAO,YAAY,GAAG,CAAC;IACzB;IAEA,MAAM,SAAS,IAAA,sMAAM,EAAC,YAAY,UAAU,EAAE,YAAY,SAAS;IACnE,MAAM,aAAa,YAAY,WAAW;IAE1C,MAAM,eAA8B;QAClC,MAAM,SAAQ,EAAU,EAAE,OAAgB,EAAE,SAAoB;YAC9D,IAAI;gBACF,MAAM,cAAc,aAAa,UAAU,MAAM,GAAG,IAAI,QAAQ;gBAChE,QAAQ,GAAG,CAAC,CAAC,QAAQ,EAAE,YAAY,MAAM,CAAC,EAAE,YAAY,OAAO;gBAC/D,IAAI,aAAa,UAAU,MAAM,GAAG,GAAG;oBACrC,QAAQ,GAAG,CAAC,eAAe;gBAC7B;gBACA,IAAI,CAAC,WAAW,CAAC,CAAC,aAAa,UAAU,MAAM,KAAK,CAAC,GAAG;oBACtD,MAAM,IAAI,MAAM;gBAClB;gBAEA,MAAM,WAAW,MAAM,OAAO,QAAQ,CAAC,MAAM,CAAC;oBAC5C,GAAI,WAAW;wBAAE,MAAM;oBAAQ,CAAC;oBAChC,MAAM;oBACN,IAAI;oBACJ,gBAAgB;oBAChB,GAAI,aAAa,UAAU,MAAM,GAAG,KAAK;wBAAE,UAAU;oBAAU,CAAC;gBAClE;gBACA,OAAO;YACT,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,0BAA0B;gBACxC,MAAM;YACR;QACF;QAEA,MAAM,SAAQ,EAAU,EAAE,OAA2B,EAAE,SAAmB;YACxE,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,SAAS;QACnC;QAEA,MAAM,kBAAiB,UAAkB;YACvC,OAAO,MAAM,OAAO,QAAQ,CAAC,YAAY,KAAK;QAChD;QAEA;YACE,OAAO;QACT;IACF;IAEA,YAAY,GAAG,CAAC,UAAU;IAC1B,OAAO;AACT;AAKO,SAAS;IACd,YAAY,KAAK;AACnB;AAKO,SAAS;IACd,OAAO,MAAM,IAAI,CAAC,YAAY,IAAI;AACpC"}},
    {"offset": {"line": 797, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/server/connections/twilio/twilio.ts"],"sourcesContent":["/**\n * Twilio Connection\n *\n * This module provides the default Twilio client using environment\n * variables. For environment switching (sandbox/production), use\n * the factory functions instead.\n */\nimport { getTwilioSecrets } from '@/server/config';\nimport { getUrlsConfig } from '@/shared/config';\nimport { createTwilioClient, type ITwilioClient, type TwilioCredentials } from './factory';\n\n// Get credentials from validated server config\nconst credentials = getTwilioSecrets();\n\n// Build status callback URL if BASE_URL is configured\nconst { baseUrl } = getUrlsConfig();\nconst statusCallbackUrl = baseUrl ? `${baseUrl}/api/twilio/status` : undefined;\n\n// Create default Twilio client using factory\nexport const twilioClient: ITwilioClient = createTwilioClient(\n  {\n    accountSid: credentials.accountSid,\n    authToken: credentials.authToken,\n    phoneNumber: credentials.phoneNumber,\n  },\n  statusCallbackUrl\n);\n\n// Re-export factory functions and types for environment switching\nexport {\n  createTwilioClient,\n  clearTwilioClients,\n  getActiveTwilioAccounts,\n  type ITwilioClient,\n  type TwilioCredentials,\n} from './factory'; "],"names":[],"mappings":"AAAA;;;;;;CAMC;;;;AACD;AAAA;AACA;AACA;;;;AAEA,+CAA+C;AAC/C,MAAM,cAAc,IAAA,8KAAgB;AAEpC,sDAAsD;AACtD,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,yLAAa;AACjC,MAAM,oBAAoB,UAAU,GAAG,QAAQ,kBAAkB,CAAC,GAAG;AAG9D,MAAM,eAA8B,IAAA,+LAAkB,EAC3D;IACE,YAAY,YAAY,UAAU;IAClC,WAAW,YAAY,SAAS;IAChC,aAAa,YAAY,WAAW;AACtC,GACA"}},
    {"offset": {"line": 829, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/server/connections/messaging/twilioClient.ts"],"sourcesContent":["/**\n * Twilio Messaging Client\n *\n * Implements IMessagingClient for Twilio SMS delivery.\n * Wraps the Twilio API and provides a standardized messaging interface.\n */\n\nimport { twilioClient as twilioSdk } from '../twilio/twilio';\nimport type { IMessagingClient, MessageResult, MessagingProvider } from './types';\nimport type { UserWithProfile } from '@/server/models/user';\n\nexport class TwilioMessagingClient implements IMessagingClient {\n  public readonly provider: MessagingProvider = 'twilio';\n\n  async sendMessage(user: UserWithProfile, message?: string, mediaUrls?: string[]): Promise<MessageResult> {\n    try {\n      const twilioResponse = await twilioSdk.sendSMS(user.phoneNumber, message, mediaUrls);\n\n      return {\n        messageId: twilioResponse.sid,\n        status: this.mapTwilioStatus(twilioResponse.status),\n        provider: this.provider,\n        to: twilioResponse.to,\n        from: twilioResponse.from,\n        timestamp: twilioResponse.dateCreated,\n        metadata: {\n          twilioSid: twilioResponse.sid,\n          twilioStatus: twilioResponse.status,\n          errorCode: twilioResponse.errorCode,\n          errorMessage: twilioResponse.errorMessage,\n          mediaUrls,\n        },\n      };\n    } catch (error) {\n      console.error('TwilioMessagingClient: Failed to send message', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Maps Twilio status to standardized message status\n   */\n  private mapTwilioStatus(\n    twilioStatus: string\n  ): MessageResult['status'] {\n    switch (twilioStatus) {\n      case 'sent':\n      case 'delivered':\n        return 'delivered';\n      case 'queued':\n      case 'accepted':\n      case 'sending':\n        return 'queued';\n      case 'failed':\n      case 'undelivered':\n        return 'failed';\n      default:\n        return 'sent';\n    }\n  }\n}\n\n// Export singleton instance\nexport const twilioMessagingClient = new TwilioMessagingClient();\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;AAED;;AAIO,MAAM;IACK,WAA8B,SAAS;IAEvD,MAAM,YAAY,IAAqB,EAAE,OAAgB,EAAE,SAAoB,EAA0B;QACvG,IAAI;YACF,MAAM,iBAAiB,MAAM,wMAAS,CAAC,OAAO,CAAC,KAAK,WAAW,EAAE,SAAS;YAE1E,OAAO;gBACL,WAAW,eAAe,GAAG;gBAC7B,QAAQ,IAAI,CAAC,eAAe,CAAC,eAAe,MAAM;gBAClD,UAAU,IAAI,CAAC,QAAQ;gBACvB,IAAI,eAAe,EAAE;gBACrB,MAAM,eAAe,IAAI;gBACzB,WAAW,eAAe,WAAW;gBACrC,UAAU;oBACR,WAAW,eAAe,GAAG;oBAC7B,cAAc,eAAe,MAAM;oBACnC,WAAW,eAAe,SAAS;oBACnC,cAAc,eAAe,YAAY;oBACzC;gBACF;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iDAAiD;YAC/D,MAAM;QACR;IACF;IAEA;;GAEC,GACD,AAAQ,gBACN,YAAoB,EACK;QACzB,OAAQ;YACN,KAAK;YACL,KAAK;gBACH,OAAO;YACT,KAAK;YACL,KAAK;YACL,KAAK;gBACH,OAAO;YACT,KAAK;YACL,KAAK;gBACH,OAAO;YACT;gBACE,OAAO;QACX;IACF;AACF;AAGO,MAAM,wBAAwB,IAAI"}},
    {"offset": {"line": 891, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/server/connections/messaging/localClient.ts"],"sourcesContent":["/**\n * Local Messaging Client\n *\n * Implements IMessagingClient for local development and testing.\n * Uses EventEmitter to broadcast messages to connected SSE clients.\n * Does not actually send SMS - instead emits events for local consumption.\n */\n\nimport { EventEmitter } from 'events';\nimport type { IMessagingClient, MessageResult, MessagingProvider } from './types';\nimport type { UserWithProfile } from '@/server/models/user';\n\nexport interface LocalMessage {\n  messageId: string;\n  to: string;\n  from: string;\n  content: string;\n  timestamp: Date;\n}\n\nexport class LocalMessagingClient implements IMessagingClient {\n  public readonly provider: MessagingProvider = 'local';\n  private eventEmitter: EventEmitter;\n  private messageCounter = 0;\n\n  constructor() {\n    this.eventEmitter = new EventEmitter();\n    // Increase max listeners for SSE connections\n    this.eventEmitter.setMaxListeners(100);\n  }\n\n  async sendMessage(user: UserWithProfile, message?: string, mediaUrls?: string[]): Promise<MessageResult> {\n    const messageId = `local-${Date.now()}-${++this.messageCounter}`;\n    const timestamp = new Date();\n    const to = user.phoneNumber;\n\n    const localMessage: LocalMessage = {\n      messageId,\n      to,\n      from: 'local-system',\n      content: message || '[MMS only - no text]',\n      timestamp,\n    };\n\n    // Emit the message event for SSE listeners\n    this.eventEmitter.emit('message', localMessage);\n\n    console.log(`[LocalMessagingClient] Message sent (not actual SMS):`, {\n      messageId,\n      to,\n      userId: user.id,\n      preview: message ? message.substring(0, 50) : '[MMS only]',\n      mediaUrls,\n    });\n\n    return {\n      messageId,\n      status: 'sent',\n      provider: this.provider,\n      to,\n      from: 'local-system',\n      timestamp,\n      metadata: {\n        userId: user.id,\n        phoneNumber: to,\n        contentLength: message?.length || 0,\n        mediaUrls,\n      },\n    };\n  }\n\n  /**\n   * Subscribe to message events (for SSE connections)\n   */\n  onMessage(listener: (message: LocalMessage) => void): void {\n    this.eventEmitter.on('message', listener);\n  }\n\n  /**\n   * Unsubscribe from message events\n   */\n  offMessage(listener: (message: LocalMessage) => void): void {\n    this.eventEmitter.off('message', listener);\n  }\n\n  /**\n   * Get current number of active listeners\n   */\n  getListenerCount(): number {\n    return this.eventEmitter.listenerCount('message');\n  }\n}\n\n// Export singleton instance\nexport const localMessagingClient = new LocalMessagingClient();\n"],"names":[],"mappings":"AAAA;;;;;;CAMC;;;;;;AAED;;AAYO,MAAM;IACK,WAA8B,QAAQ;IAC9C,aAA2B;IAC3B,iBAAiB,EAAE;IAE3B,aAAc;QACZ,IAAI,CAAC,YAAY,GAAG,IAAI,qHAAY;QACpC,6CAA6C;QAC7C,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC;IACpC;IAEA,MAAM,YAAY,IAAqB,EAAE,OAAgB,EAAE,SAAoB,EAA0B;QACvG,MAAM,YAAY,CAAC,MAAM,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,cAAc,EAAE;QAChE,MAAM,YAAY,IAAI;QACtB,MAAM,KAAK,KAAK,WAAW;QAE3B,MAAM,eAA6B;YACjC;YACA;YACA,MAAM;YACN,SAAS,WAAW;YACpB;QACF;QAEA,2CAA2C;QAC3C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,WAAW;QAElC,QAAQ,GAAG,CAAC,CAAC,qDAAqD,CAAC,EAAE;YACnE;YACA;YACA,QAAQ,KAAK,EAAE;YACf,SAAS,UAAU,QAAQ,SAAS,CAAC,GAAG,MAAM;YAC9C;QACF;QAEA,OAAO;YACL;YACA,QAAQ;YACR,UAAU,IAAI,CAAC,QAAQ;YACvB;YACA,MAAM;YACN;YACA,UAAU;gBACR,QAAQ,KAAK,EAAE;gBACf,aAAa;gBACb,eAAe,SAAS,UAAU;gBAClC;YACF;QACF;IACF;IAEA;;GAEC,GACD,UAAU,QAAyC,EAAQ;QACzD,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,WAAW;IAClC;IAEA;;GAEC,GACD,WAAW,QAAyC,EAAQ;QAC1D,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,WAAW;IACnC;IAEA;;GAEC,GACD,mBAA2B;QACzB,OAAO,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC;IACzC;AACF;AAGO,MAAM,uBAAuB,IAAI"}},
    {"offset": {"line": 970, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/server/connections/messaging/factory.ts"],"sourcesContent":["/**\n * Messaging Client Factory\n *\n * Provides a centralized way to get the appropriate messaging client\n * based on environment configuration.\n */\n\nimport type { IMessagingClient, MessagingProvider } from './types';\nimport { twilioMessagingClient } from './twilioClient';\nimport { localMessagingClient } from './localClient';\nimport { getMessagingConfig } from '@/shared/config';\n\n/**\n * Get the messaging client based on environment configuration\n * Defaults to Twilio in production, can be overridden with MESSAGING_PROVIDER env var\n */\nexport function getMessagingClient(): IMessagingClient {\n  const { provider } = getMessagingConfig();\n\n  switch (provider) {\n    case 'local':\n      console.log('[MessagingFactory] Using LocalMessagingClient (no SMS will be sent)');\n      return localMessagingClient;\n    case 'twilio':\n    default:\n      return twilioMessagingClient;\n  }\n}\n\n/**\n * Get a specific messaging client by provider name\n * Useful for testing or when you need direct access to a specific provider\n */\nexport function getMessagingClientByProvider(provider: MessagingProvider): IMessagingClient {\n  switch (provider) {\n    case 'local':\n      return localMessagingClient;\n    case 'twilio':\n      return twilioMessagingClient;\n    default:\n      throw new Error(`Unknown messaging provider: ${provider}`);\n  }\n}\n\n// Export the default client as a singleton\nexport const messagingClient = getMessagingClient();\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;;;AAGD;AACA;AACA;;;;AAMO,SAAS;IACd,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,8LAAkB;IAEvC,OAAQ;QACN,KAAK;YACH,QAAQ,GAAG,CAAC;YACZ,OAAO,wMAAoB;QAC7B,KAAK;QACL;YACE,OAAO,0MAAqB;IAChC;AACF;AAMO,SAAS,6BAA6B,QAA2B;IACtE,OAAQ;QACN,KAAK;YACH,OAAO,wMAAoB;QAC7B,KAAK;YACH,OAAO,0MAAqB;QAC9B;YACE,MAAM,IAAI,MAAM,CAAC,4BAA4B,EAAE,UAAU;IAC7D;AACF;AAGO,MAAM,kBAAkB"}},
    {"offset": {"line": 1015, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/packages/shared/src/server/connections/messaging/index.ts"],"sourcesContent":["/**\n * Messaging Module Exports\n *\n * Central export point for all messaging-related types, clients, and utilities.\n */\n\nexport type { IMessagingClient, MessageResult, MessagingProvider } from './types';\nexport type { LocalMessage } from './localClient';\n\nexport { TwilioMessagingClient, twilioMessagingClient } from './twilioClient';\nexport { LocalMessagingClient, localMessagingClient } from './localClient';\nexport { getMessagingClient, getMessagingClientByProvider, messagingClient } from './factory';\n"],"names":[],"mappings":"AAAA;;;;CAIC;AAKD;AACA;AACA"}},
    {"offset": {"line": 1030, "column": 0}, "map": {"version":3,"sources":["file:///Users/aaronparry/Developer/GymText/gymtext/apps/admin/src/app/api/messages/stream/route.ts"],"sourcesContent":["/**\n * Message Stream API (Server-Sent Events)\n *\n * Provides real-time message streaming for local development and admin chat.\n * Clients can subscribe to receive messages as they are sent.\n */\n\nimport { NextRequest } from 'next/server';\nimport { localMessagingClient, type LocalMessage } from '@/server/connections/messaging';\nimport { getMessagingConfig } from '@/shared/config';\n\nexport const dynamic = 'force-dynamic';\nexport const runtime = 'nodejs';\n\nexport async function GET(request: NextRequest): Promise<Response> {\n  // Only allow SSE when using local messaging provider\n  const { provider } = getMessagingConfig();\n  if (provider !== 'local') {\n    return new Response('SSE is only available with MESSAGING_PROVIDER=local', {\n      status: 400,\n    });\n  }\n\n  // Optional: Filter by phoneNumber from query params\n  const { searchParams } = new URL(request.url);\n  const filterPhoneNumber = searchParams.get('phoneNumber');\n\n  // Create SSE stream\n  const encoder = new TextEncoder();\n  const stream = new ReadableStream({\n    start(controller) {\n      // Send initial connection message\n      const connectMessage = `data: ${JSON.stringify({ type: 'connected', timestamp: new Date() })}\\n\\n`;\n      controller.enqueue(encoder.encode(connectMessage));\n\n      // Set up message listener\n      const messageListener = (message: LocalMessage) => {\n        // Filter by phone number if specified\n        if (filterPhoneNumber && message.to !== filterPhoneNumber) {\n          return;\n        }\n\n        const data = {\n          type: 'message',\n          message: {\n            id: message.messageId,\n            to: message.to,\n            from: message.from,\n            content: message.content,\n            timestamp: message.timestamp,\n          },\n        };\n\n        const sseMessage = `data: ${JSON.stringify(data)}\\n\\n`;\n        try {\n          controller.enqueue(encoder.encode(sseMessage));\n        } catch (error) {\n          console.error('Error sending SSE message:', error);\n        }\n      };\n\n      // Subscribe to messages\n      localMessagingClient.onMessage(messageListener);\n\n      console.log('[SSE] Client connected', {\n        filterPhoneNumber,\n        activeListeners: localMessagingClient.getListenerCount(),\n      });\n\n      // Clean up on connection close\n      const cleanup = () => {\n        localMessagingClient.offMessage(messageListener);\n        console.log('[SSE] Client disconnected', {\n          activeListeners: localMessagingClient.getListenerCount(),\n        });\n      };\n\n      // Handle connection close\n      request.signal.addEventListener('abort', () => {\n        cleanup();\n        try {\n          controller.close();\n        } catch {\n          // Controller might already be closed - ignore error\n        }\n      });\n    },\n  });\n\n  // Return SSE response\n  return new Response(stream, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n    },\n  });\n}\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;;;AAGD;AAAA;AACA;;;AAEO,MAAM,UAAU;AAChB,MAAM,UAAU;AAEhB,eAAe,IAAI,OAAoB;IAC5C,qDAAqD;IACrD,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,8LAAkB;IACvC,IAAI,aAAa,SAAS;QACxB,OAAO,IAAI,SAAS,uDAAuD;YACzE,QAAQ;QACV;IACF;IAEA,oDAAoD;IACpD,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,oBAAoB,aAAa,GAAG,CAAC;IAE3C,oBAAoB;IACpB,MAAM,UAAU,IAAI;IACpB,MAAM,SAAS,IAAI,eAAe;QAChC,OAAM,UAAU;YACd,kCAAkC;YAClC,MAAM,iBAAiB,CAAC,MAAM,EAAE,KAAK,SAAS,CAAC;gBAAE,MAAM;gBAAa,WAAW,IAAI;YAAO,GAAG,IAAI,CAAC;YAClG,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;YAElC,0BAA0B;YAC1B,MAAM,kBAAkB,CAAC;gBACvB,sCAAsC;gBACtC,IAAI,qBAAqB,QAAQ,EAAE,KAAK,mBAAmB;oBACzD;gBACF;gBAEA,MAAM,OAAO;oBACX,MAAM;oBACN,SAAS;wBACP,IAAI,QAAQ,SAAS;wBACrB,IAAI,QAAQ,EAAE;wBACd,MAAM,QAAQ,IAAI;wBAClB,SAAS,QAAQ,OAAO;wBACxB,WAAW,QAAQ,SAAS;oBAC9B;gBACF;gBAEA,MAAM,aAAa,CAAC,MAAM,EAAE,KAAK,SAAS,CAAC,MAAM,IAAI,CAAC;gBACtD,IAAI;oBACF,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;gBACpC,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,8BAA8B;gBAC9C;YACF;YAEA,wBAAwB;YACxB,wMAAoB,CAAC,SAAS,CAAC;YAE/B,QAAQ,GAAG,CAAC,0BAA0B;gBACpC;gBACA,iBAAiB,wMAAoB,CAAC,gBAAgB;YACxD;YAEA,+BAA+B;YAC/B,MAAM,UAAU;gBACd,wMAAoB,CAAC,UAAU,CAAC;gBAChC,QAAQ,GAAG,CAAC,6BAA6B;oBACvC,iBAAiB,wMAAoB,CAAC,gBAAgB;gBACxD;YACF;YAEA,0BAA0B;YAC1B,QAAQ,MAAM,CAAC,gBAAgB,CAAC,SAAS;gBACvC;gBACA,IAAI;oBACF,WAAW,KAAK;gBAClB,EAAE,OAAM;gBACN,oDAAoD;gBACtD;YACF;QACF;IACF;IAEA,sBAAsB;IACtB,OAAO,IAAI,SAAS,QAAQ;QAC1B,SAAS;YACP,gBAAgB;YAChB,iBAAiB;YACjB,cAAc;QAChB;IACF;AACF"}}]
}