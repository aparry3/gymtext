module.exports=[37702,(e,s,t)=>{s.exports=e.x("worker_threads",()=>require("worker_threads"))},812057,(e,s,t)=>{s.exports=e.x("node:util",()=>require("node:util"))},363890,(e,s,t)=>{s.exports=e.x("stream/web",()=>require("stream/web"))},60438,(e,s,t)=>{s.exports=e.x("perf_hooks",()=>require("perf_hooks"))},178249,(e,s,t)=>{s.exports=e.x("util/types",()=>require("util/types"))},687769,(e,s,t)=>{s.exports=e.x("node:events",()=>require("node:events"))},154993,(e,s,t)=>{s.exports=e.x("diagnostics_channel",()=>require("diagnostics_channel"))},925328,(e,s,t)=>{s.exports=e.x("http2",()=>require("http2"))},99348,(e,s,t)=>{s.exports=e.x("string_decoder",()=>require("string_decoder"))},410430,(e,s,t)=>{s.exports=e.x("async_hooks",()=>require("async_hooks"))},611913,(e,s,t)=>{s.exports=e.x("console",()=>require("console"))},501261,e=>{"use strict";var s=e.i(46308);class t extends s.BaseRepository{async create(e){return await this.db.insertInto("messages").values(e).returningAll().executeTakeFirstOrThrow()}async findById(e){return await this.db.selectFrom("messages").selectAll().where("id","=",e).executeTakeFirst()}async findByClientId(e,s=50,t=0){return await this.db.selectFrom("messages").selectAll().where("clientId","=",e).orderBy("createdAt","desc").limit(s).offset(t).execute()}async findRecentByClientId(e,s=10){return(await this.db.selectFrom("messages").selectAll().where("clientId","=",e).orderBy("createdAt","desc").limit(s).execute()).reverse()}async countByClientId(e){let s=await this.db.selectFrom("messages").select(({fn:e})=>e.count("id").as("count")).where("clientId","=",e).executeTakeFirst();return Number(s?.count??0)}async findByProviderMessageId(e){return await this.db.selectFrom("messages").selectAll().where("providerMessageId","=",e).executeTakeFirst()}async updateDeliveryStatus(e,s,t){return await this.db.updateTable("messages").set({deliveryStatus:s,deliveryError:t||null,lastDeliveryAttemptAt:new Date}).where("id","=",e).returningAll().executeTakeFirstOrThrow()}async incrementDeliveryAttempts(e){let s=await this.findById(e);if(!s)throw Error(`Message ${e} not found`);return await this.db.updateTable("messages").set({deliveryAttempts:(s.deliveryAttempts||1)+1,lastDeliveryAttemptAt:new Date}).where("id","=",e).returningAll().executeTakeFirstOrThrow()}async updateProviderMessageId(e,s){return await this.db.updateTable("messages").set({providerMessageId:s}).where("id","=",e).returningAll().executeTakeFirstOrThrow()}async findAllWithUserInfo(e){let s=this.db.selectFrom("messages").innerJoin("users","users.id","messages.clientId").select(["messages.id","messages.clientId","messages.conversationId","messages.direction","messages.content","messages.phoneFrom","messages.phoneTo","messages.provider","messages.providerMessageId","messages.deliveryStatus","messages.deliveryAttempts","messages.lastDeliveryAttemptAt","messages.deliveryError","messages.metadata","messages.createdAt","users.name as userName","users.phoneNumber as userPhone"]);e.clientId&&(s=s.where("messages.clientId","=",e.clientId)),e.direction&&(s=s.where("messages.direction","=",e.direction)),e.status&&(s=s.where("messages.deliveryStatus","=",e.status)),e.search&&(s=s.where(s=>s.or([s("messages.phoneFrom","ilike",`%${e.search}%`),s("messages.phoneTo","ilike",`%${e.search}%`),s("users.name","ilike",`%${e.search}%`),s("users.phoneNumber","ilike",`%${e.search}%`)])));let t=this.db.selectFrom("messages").innerJoin("users","users.id","messages.clientId").select(({fn:e})=>e.count("messages.id").as("count"));e.clientId&&(t=t.where("messages.clientId","=",e.clientId)),e.direction&&(t=t.where("messages.direction","=",e.direction)),e.status&&(t=t.where("messages.deliveryStatus","=",e.status)),e.search&&(t=t.where(s=>s.or([s("messages.phoneFrom","ilike",`%${e.search}%`),s("messages.phoneTo","ilike",`%${e.search}%`),s("users.name","ilike",`%${e.search}%`),s("users.phoneNumber","ilike",`%${e.search}%`)])));let r=await t.executeTakeFirst(),a=Number(r?.count??0);return{messages:await s.orderBy("messages.createdAt","desc").limit(e.limit||50).offset(e.offset||0).execute(),total:a}}async getStats(e){let s=this.db.selectFrom("messages");e&&(s=s.where("clientId","=",e));let[t,r,a,i,n]=await Promise.all([s.select(({fn:e})=>e.count("id").as("count")).executeTakeFirst(),s.select(({fn:e})=>e.count("id").as("count")).where("direction","=","inbound").executeTakeFirst(),s.select(({fn:e})=>e.count("id").as("count")).where("direction","=","outbound").executeTakeFirst(),s.select(({fn:e})=>e.count("id").as("count")).where("deliveryStatus","in",["queued","sent"]).executeTakeFirst(),s.select(({fn:e})=>e.count("id").as("count")).where("deliveryStatus","in",["failed","undelivered"]).executeTakeFirst()]);return{totalMessages:Number(t?.count??0),inbound:Number(r?.count??0),outbound:Number(a?.count??0),pending:Number(i?.count??0),failed:Number(n?.count??0)}}}e.s(["MessageRepository",()=>t])},94510,e=>{"use strict";var s=e.i(46308);class t extends s.BaseRepository{async create(e){return await this.db.insertInto("messageQueues").values(e).returningAll().executeTakeFirstOrThrow()}async createMany(e){return 0===e.length?[]:await this.db.insertInto("messageQueues").values(e).returningAll().execute()}async findById(e){return await this.db.selectFrom("messageQueues").selectAll().where("id","=",e).executeTakeFirst()}async findByMessageId(e){return await this.db.selectFrom("messageQueues").selectAll().where("messageId","=",e).executeTakeFirst()}async findPendingByClient(e,s){return await this.db.selectFrom("messageQueues").selectAll().where("clientId","=",e).where("queueName","=",s).where("status","=","pending").orderBy("sequenceNumber","asc").execute()}async findAllPending(e){let s=this.db.selectFrom("messageQueues").selectAll().where("status","=","pending");return e.clientId&&(s=s.where("clientId","=",e.clientId)),await s.orderBy("createdAt","desc").limit(e.limit||100).offset(e.offset||0).execute()}async findAllPendingWithUserInfo(e){let s=this.db.selectFrom("messageQueues").innerJoin("users","users.id","messageQueues.clientId").select(["messageQueues.id","messageQueues.clientId","messageQueues.queueName","messageQueues.sequenceNumber","messageQueues.messageContent","messageQueues.mediaUrls","messageQueues.status","messageQueues.messageId","messageQueues.retryCount","messageQueues.maxRetries","messageQueues.timeoutMinutes","messageQueues.errorMessage","messageQueues.createdAt","messageQueues.sentAt","messageQueues.deliveredAt","users.name as userName","users.phoneNumber as userPhone"]).where("messageQueues.status","=","pending");return e.clientId&&(s=s.where("messageQueues.clientId","=",e.clientId)),await s.orderBy("messageQueues.createdAt","desc").limit(e.limit||100).execute()}async findNextPending(e,s){return await this.db.selectFrom("messageQueues").selectAll().where("clientId","=",e).where("queueName","=",s).where("status","=","pending").orderBy("sequenceNumber","asc").limit(1).executeTakeFirst()}async findStalled(e){return await this.db.selectFrom("messageQueues").selectAll().where("status","=","sent").where("sentAt","<",e).execute()}async updateStatus(e,s,t,r){return await this.db.updateTable("messageQueues").set({status:s,...t?.sentAt&&{sentAt:t.sentAt},...t?.deliveredAt&&{deliveredAt:t.deliveredAt},...r&&{errorMessage:r}}).where("id","=",e).returningAll().executeTakeFirstOrThrow()}async linkMessage(e,s){return await this.db.updateTable("messageQueues").set({messageId:s,status:"sent",sentAt:new Date}).where("id","=",e).returningAll().executeTakeFirstOrThrow()}async incrementRetry(e){let s=await this.findById(e);if(!s)throw Error(`Queue entry ${e} not found`);return await this.db.updateTable("messageQueues").set({retryCount:s.retryCount+1}).where("id","=",e).returningAll().executeTakeFirstOrThrow()}async deleteCompleted(e,s){await this.db.deleteFrom("messageQueues").where("clientId","=",e).where("queueName","=",s).where("status","in",["delivered","failed"]).execute()}async getQueueStatus(e,s){let t=await this.db.selectFrom("messageQueues").select(["status"]).where("clientId","=",e).where("queueName","=",s).execute();return{total:t.length,pending:t.filter(e=>"pending"===e.status).length,sent:t.filter(e=>"sent"===e.status).length,delivered:t.filter(e=>"delivered"===e.status).length,failed:t.filter(e=>"failed"===e.status).length}}}e.s(["MessageQueueRepository",()=>t])},193695,(e,s,t)=>{s.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},918622,(e,s,t)=>{s.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,s,t)=>{s.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,s,t)=>{s.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,s,t)=>{s.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},224361,(e,s,t)=>{s.exports=e.x("util",()=>require("util"))},814747,(e,s,t)=>{s.exports=e.x("path",()=>require("path"))},733897,e=>{"use strict";var s=e.i(46308);class t extends s.BaseRepository{async createAuthCode(e,s,t){await this.db.insertInto("userAuthCodes").values({phoneNumber:e,code:s,expiresAt:t,createdAt:new Date}).execute()}async findValidCode(e,s){return await this.db.selectFrom("userAuthCodes").select(["id","phoneNumber"]).where("phoneNumber","=",e).where("code","=",s).where("expiresAt",">",new Date).executeTakeFirst()||null}async deleteCodesForPhone(e){await this.db.deleteFrom("userAuthCodes").where("phoneNumber","=",e).execute()}async deleteExpiredCodes(){return Number((await this.db.deleteFrom("userAuthCodes").where("expiresAt","<",new Date).executeTakeFirst()).numDeletedRows||0)}async countRecentRequests(e,s){let t=await this.db.selectFrom("userAuthCodes").select(e=>e.fn.countAll().as("count")).where("phoneNumber","=",e).where("createdAt",">=",s).executeTakeFirst();return Number(t?.count||0)}}e.s(["UserAuthRepository",()=>t])},38330,e=>{"use strict";var s=e.i(94510),t=e.i(36480),r=e.i(187070),a=e.i(681247);class i{static instance;messageQueueRepo;constructor(){this.messageQueueRepo=new s.MessageQueueRepository(t.postgresDb)}static getInstance(){return i.instance||(i.instance=new i),i.instance}async enqueueMessages(e,s,t){if(0===s.length)return;console.log(`[MessageQueueService] Enqueueing ${s.length} messages for client ${e} in queue '${t}'`);let a=s.map((s,r)=>({clientId:e,queueName:t,sequenceNumber:r+1,messageContent:s.content||null,mediaUrls:s.mediaUrls?JSON.stringify(s.mediaUrls):null,status:"pending"}));await this.messageQueueRepo.createMany(a),console.log(`[MessageQueueService] Created ${a.length} queue entries`),await r.inngest.send({name:"message-queue/process-next",data:{clientId:e,queueName:t}})}async processNextMessage(e,s){console.log(`[MessageQueueService] Processing next message for client ${e} in queue '${s}'`);let t=await this.messageQueueRepo.findNextPending(e,s);if(!t){console.log(`[MessageQueueService] No more pending messages in queue '${s}' for client ${e}`),await this.clearQueue(e,s);return}console.log(`[MessageQueueService] Found next message (sequence ${t.sequenceNumber})`),await r.inngest.send({name:"message-queue/send-message",data:{queueEntryId:t.id,clientId:t.clientId,queueName:t.queueName}})}async sendQueuedMessage(s){let t,r=await this.messageQueueRepo.findById(s);if(!r)throw Error(`Queue entry ${s} not found`);let{messageService:a}=await e.A(593853),{userService:i}=await e.A(464245),n=await i.getUser(r.clientId);if(!n)throw Error(`Client ${r.clientId} not found`);if(r.mediaUrls)if("string"==typeof r.mediaUrls)try{t=JSON.parse(r.mediaUrls)}catch(e){console.error("[MessageQueueService] Failed to parse media URLs:",e)}else t=r.mediaUrls;console.log(`[MessageQueueService] Sending queued message ${s}`);let u=await a.sendMessage(n,r.messageContent||void 0,t);return await this.messageQueueRepo.linkMessage(r.id,u.id),console.log("[MessageQueueService] Queued message sent successfully",{queueEntryId:s,messageId:u.id}),u}async markMessageDelivered(e){let s=await this.messageQueueRepo.findByMessageId(e);s?(console.log(`[MessageQueueService] Marking message ${e} as delivered`),await this.messageQueueRepo.updateStatus(s.id,"delivered",{deliveredAt:new Date}),await r.inngest.send({name:"message-queue/process-next",data:{clientId:s.clientId,queueName:s.queueName}}),console.log(`[MessageQueueService] Triggered next message for queue '${s.queueName}'`)):console.log(`[MessageQueueService] No queue entry found for message ${e}`)}async markMessageFailed(e,s){let t=await this.messageQueueRepo.findByMessageId(e);t?(console.log(`[MessageQueueService] Message ${e} failed:`,s),t.retryCount<t.maxRetries?(console.log(`[MessageQueueService] Retrying message (attempt ${t.retryCount+1}/${t.maxRetries})`),await this.messageQueueRepo.incrementRetry(t.id),await this.messageQueueRepo.updateStatus(t.id,"pending",void 0,s),await r.inngest.send({name:"message/delivery-failed",data:{messageId:e,clientId:t.clientId,providerMessageId:e,error:s||"Unknown error"}})):(console.log("[MessageQueueService] Max retries reached, marking as failed and moving to next"),await this.messageQueueRepo.updateStatus(t.id,"failed",void 0,s||"Max retries exceeded"),await r.inngest.send({name:"message-queue/process-next",data:{clientId:t.clientId,queueName:t.queueName}}))):console.log(`[MessageQueueService] No queue entry found for message ${e}`)}async checkStalledMessages(){let s=new Date(Date.now()-6e5),t=await this.messageQueueRepo.findStalled(s);if(0===t.length)return void console.log("[MessageQueueService] No stalled messages found");for(let s of(console.log(`[MessageQueueService] Found ${t.length} stalled messages`),t))try{if(!s.messageId){console.warn(`[MessageQueueService] Stalled entry ${s.id} has no messageId, marking as failed`),await this.messageQueueRepo.updateStatus(s.id,"failed",void 0,"No message ID found");continue}let{messageService:t}=await e.A(593853),r=t.messageRepo,i=await r.findById(s.messageId);if(!i||!i.providerMessageId){console.warn(`[MessageQueueService] Message ${s.messageId} not found or has no provider ID`),await this.messageQueueRepo.updateStatus(s.id,"delivered",{deliveredAt:new Date}),await this.processNextMessage(s.clientId,s.queueName);continue}console.log(`[MessageQueueService] Checking Twilio status for ${i.providerMessageId}`);let n=await a.twilioClient.getMessageStatus(i.providerMessageId);"delivered"===n.status?(console.log("[MessageQueueService] Twilio confirms delivery, updating queue"),await this.markMessageDelivered(s.messageId)):"failed"===n.status||"undelivered"===n.status?(console.log("[MessageQueueService] Twilio confirms failure, updating queue"),await this.markMessageFailed(s.messageId,`Stalled message status: ${n.status}`)):(console.log(`[MessageQueueService] Message still in transit (${n.status}), assuming delivered`),await this.messageQueueRepo.updateStatus(s.id,"delivered",{deliveredAt:new Date}),await this.processNextMessage(s.clientId,s.queueName))}catch(e){console.error(`[MessageQueueService] Error checking stalled message ${s.id}:`,e),await this.messageQueueRepo.updateStatus(s.id,"delivered",{deliveredAt:new Date}),await this.processNextMessage(s.clientId,s.queueName)}}async getQueueStatus(e,s){return await this.messageQueueRepo.getQueueStatus(e,s)}async clearQueue(e,s){console.log(`[MessageQueueService] Clearing completed queue '${s}' for client ${e}`),await this.messageQueueRepo.deleteCompleted(e,s)}}let n=i.getInstance();e.s(["MessageQueueService",()=>i,"messageQueueService",0,n])},787094,e=>{"use strict";var s=e.i(553573),t=e.i(163459),r=e.i(342845),a=e.i(904973),i=e.i(818385),n=e.i(588303),u=e.i(583020),o=e.i(304941),d=e.i(370312),l=e.i(40504),c=e.i(802579),g=e.i(225915),m=e.i(150373),h=e.i(804342),p=e.i(259207),w=e.i(348684),v=e.i(193695);e.i(650048);var x=e.i(219407),f=e.i(565431);e.i(180256);var y=e.i(80643),R=e.i(982099);e.i(791146);var I=e.i(832821);async function b(e,{params:s}){try{let{message:t}=await e.json(),{id:r}=await s;if(!t||!r)return R.NextResponse.json({success:!1,error:"Message and userId are required"},{status:400});let a=await f.userService.getUserById(r);if(!a)return R.NextResponse.json({success:!1,error:"User not found"},{status:404});let i=await f.userService.getUser(a.id);if(!i)return R.NextResponse.json({success:!1,error:"Failed to load user profile"},{status:500});let n=a.phoneNumber,u=(0,I.getTwilioSecrets)().phoneNumber||"+10000000000",o=await y.messageService.ingestMessage({user:i,content:t,from:n,to:u,twilioData:{MessageSid:`admin-${Date.now()}`,From:n,To:u,Body:t}});return R.NextResponse.json({success:!0,data:{jobId:o.jobId,ackMessage:o.ackMessage,timestamp:new Date().toISOString()}})}catch(e){return console.error("Error processing admin chat:",e),R.NextResponse.json({success:!1,error:"Failed to process message"},{status:500})}}async function A(e,{params:s}){try{let{id:t}=await s,{searchParams:r}=new URL(e.url),a=Math.min(parseInt(r.get("limit")||"20"),100),i=parseInt(r.get("offset")||"0");if(!await f.userService.getUserById(t))return R.NextResponse.json({success:!1,error:"User not found"},{status:404});let n=await y.messageService.getMessages(t,a,i),u=n.map(e=>({id:e.id,content:e.content,direction:e.direction,timestamp:e.createdAt instanceof Date?e.createdAt.toISOString():e.createdAt,from:e.phoneFrom||"",to:e.phoneTo||""})).reverse(),o=n.length===a;return R.NextResponse.json({success:!0,data:{messages:u,pagination:{limit:a,offset:i,hasMore:o,count:n.length}}})}catch(e){return console.error("Error fetching message history:",e),R.NextResponse.json({success:!1,error:"Failed to fetch message history"},{status:500})}}e.s(["GET",()=>A,"POST",()=>b],532937);var M=e.i(532937);let Q=new s.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/admin/users/[id]/chat/route",pathname:"/api/admin/users/[id]/chat",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/admin/src/app/api/admin/users/[id]/chat/route.ts",nextConfigOutput:"",userland:M}),{workAsyncStorage:S,workUnitAsyncStorage:N,serverHooks:k}=Q;function q(){return(0,r.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:N})}async function T(e,s,r){Q.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/admin/users/[id]/chat/route";f=f.replace(/\/index$/,"")||"/";let y=await Q.prepare(e,s,{srcPage:f,multiZoneDraftMode:!1});if(!y)return s.statusCode=400,s.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:I,nextConfig:b,parsedUrl:A,isDraftMode:M,prerenderManifest:S,routerServerContext:N,isOnDemandRevalidate:k,revalidateOnlyGenerated:q,resolvedPathname:T,clientReferenceManifest:F,serverActionsManifest:C}=y,_=(0,o.normalizeAppPath)(f),E=!!(S.dynamicRoutes[_]||S.routes[T]),$=async()=>((null==N?void 0:N.render404)?await N.render404(e,s,A,!1):s.end("This page could not be found"),null);if(E&&!M){let e=!!S.routes[T],s=S.dynamicRoutes[_];if(s&&!1===s.fallback&&!e){if(b.experimental.adapterPath)return await $();throw new v.NoFallbackError}}let P=null;!E||Q.isDev||M||(P="/index"===(P=T)?"/":P);let D=!0===Q.isDev||!E,U=E&&!D;C&&F&&(0,n.setReferenceManifestsSingleton)({page:f,clientReferenceManifest:F,serverActionsManifest:C,serverModuleMap:(0,u.createServerModuleMap)({serverActionsManifest:C})});let j=e.method||"GET",O=(0,i.getTracer)(),B=O.getActiveScopeSpan(),H={params:I,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:r.waitUntil,onClose:e=>{s.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(s,t,r)=>Q.onRequestError(e,s,r,N)},sharedContext:{buildId:R}},K=new d.NodeNextRequest(e),L=new d.NodeNextResponse(s),J=l.NextRequestAdapter.fromNodeNextRequest(K,(0,l.signalFromNodeResponse)(s));try{let n=async e=>Q.handle(J,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":s.statusCode,"next.rsc":!1});let t=O.getRootSpanAttributes();if(!t)return;if(t.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${t.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=t.get("next.route");if(r){let s=`${j} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":s}),e.updateName(s)}else e.updateName(`${j} ${f}`)}),u=!!(0,a.getRequestMeta)(e,"minimalMode"),o=async a=>{var i,o;let d=async({previousCacheEntry:t})=>{try{if(!u&&k&&q&&!t)return s.statusCode=404,s.setHeader("x-nextjs-cache","REVALIDATED"),s.end("This page could not be found"),null;let i=await n(a);e.fetchMetrics=H.renderOpts.fetchMetrics;let o=H.renderOpts.pendingWaitUntil;o&&r.waitUntil&&(r.waitUntil(o),o=void 0);let d=H.renderOpts.collectedTags;if(!E)return await (0,m.sendResponse)(K,L,i,H.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),s=(0,h.toNodeOutgoingHttpHeaders)(i.headers);d&&(s[w.NEXT_CACHE_TAGS_HEADER]=d),!s["content-type"]&&e.type&&(s["content-type"]=e.type);let t=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,r=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:x.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:s},cacheControl:{revalidate:t,expire:r}}}}catch(s){throw(null==t?void 0:t.isStale)&&await Q.onRequestError(e,s,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:k})},N),s}},l=await Q.handleResponse({req:e,nextConfig:b,cacheKey:P,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:k,revalidateOnlyGenerated:q,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:u});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==x.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(o=l.value)?void 0:o.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});u||s.setHeader("x-nextjs-cache",k?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),M&&s.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(l.value.headers);return u&&E||c.delete(w.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||s.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,p.getCacheControlHeader)(l.cacheControl)),await (0,m.sendResponse)(K,L,new Response(l.value.body,{headers:c,status:l.value.status||200})),null};B?await o(B):await O.withPropagatedContext(e.headers,()=>O.trace(c.BaseServerSpan.handleRequest,{spanName:`${j} ${f}`,kind:i.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},o))}catch(s){if(s instanceof v.NoFallbackError||await Q.onRequestError(e,s,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:k})}),E)throw s;return await (0,m.sendResponse)(K,L,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>q,"routeModule",()=>Q,"serverHooks",()=>k,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>N],787094)},485685,e=>{e.v(e=>Promise.resolve().then(()=>e(254799)))},316067,e=>{e.v(s=>Promise.all(["server/chunks/node_modules__pnpm_4edfb228._.js"].map(s=>e.l(s))).then(()=>s(706674)))},399164,e=>{e.v(s=>Promise.all(["server/chunks/[root-of-the-server]__91a202dd._.js","server/chunks/node_modules__pnpm_f8c52739._.js","server/chunks/3f000_node-fetch_src_index_0443a381.js"].map(s=>e.l(s))).then(()=>s(785605)))},493820,e=>{e.v(e=>Promise.resolve().then(()=>e(125720)))},5389,e=>{e.v(s=>Promise.all(["server/chunks/[externals]_node:async_hooks_b485b2a4._.js"].map(s=>e.l(s))).then(()=>s(478500)))},279524,e=>{e.v(e=>Promise.resolve().then(()=>e(38330)))},593853,e=>{e.v(e=>Promise.resolve().then(()=>e(80643)))},464245,e=>{e.v(e=>Promise.resolve().then(()=>e(565431)))},690342,e=>{e.v(s=>Promise.all(["server/chunks/packages_shared_src_server_services_agents_training_index_ts_c783fc21._.js"].map(s=>e.l(s))).then(()=>s(464752)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1a3cb72e._.js.map