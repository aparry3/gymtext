module.exports=[193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},733897,e=>{"use strict";var t=e.i(46308);class r extends t.BaseRepository{async createAuthCode(e,t,r){await this.db.insertInto("userAuthCodes").values({phoneNumber:e,code:t,expiresAt:r,createdAt:new Date}).execute()}async findValidCode(e,t){return await this.db.selectFrom("userAuthCodes").select(["id","phoneNumber"]).where("phoneNumber","=",e).where("code","=",t).where("expiresAt",">",new Date).executeTakeFirst()||null}async deleteCodesForPhone(e){await this.db.deleteFrom("userAuthCodes").where("phoneNumber","=",e).execute()}async deleteExpiredCodes(){return Number((await this.db.deleteFrom("userAuthCodes").where("expiresAt","<",new Date).executeTakeFirst()).numDeletedRows||0)}async countRecentRequests(e,t){let r=await this.db.selectFrom("userAuthCodes").select(e=>e.fn.countAll().as("count")).where("phoneNumber","=",e).where("createdAt",">=",t).executeTakeFirst();return Number(r?.count||0)}}e.s(["UserAuthRepository",()=>r])},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},224361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},490773,e=>{"use strict";function t(e){if(!e||"string"!=typeof e)return null;let t=e.replace(/\D/g,"");if(!t)return null;if(10===t.length){if(t[0]>="2"&&t[0]<="9")return`+1${t}`}else if(11===t.length&&t.startsWith("1")){if(t[1]>="2"&&t[1]<="9")return`+${t}`}else if(e.startsWith("+1")&&11===t.length&&t.startsWith("1")&&t[1]>="2"&&t[1]<="9")return e;return null}function r(e){return!!e&&"string"==typeof e&&/^\+1[2-9]\d{2}[2-9]\d{6}$/.test(e)}e.s(["normalizeUSPhoneNumber",()=>t,"validateUSPhoneNumber",()=>r])},967255,(e,t,r)=>{t.exports=e.x("pg",()=>require("pg"))},500874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},688947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},406461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},427699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},145706,(e,t,r)=>{t.exports=e.x("querystring",()=>require("querystring"))},921517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},524836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},792509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},446786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},504446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},755004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},449719,(e,t,r)=>{t.exports=e.x("assert",()=>require("assert"))},870722,(e,t,r)=>{t.exports=e.x("tty",()=>require("tty"))},527577,(e,t,r)=>{function s(e,t,r,s){return Math.round(e/r)+" "+s+(t>=1.5*r?"s":"")}t.exports=function(e,t){t=t||{};var r,n,o,a,i=typeof e;if("string"===i&&e.length>0){var u=e;if(!((u=String(u)).length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(c){var l=parseFloat(c[1]);switch((c[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*l;case"weeks":case"week":case"w":return 6048e5*l;case"days":case"day":case"d":return 864e5*l;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*l;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*l;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*l;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:break}}}return}if("number"===i&&isFinite(e)){return t.long?(n=Math.abs(r=e))>=864e5?s(r,n,864e5,"day"):n>=36e5?s(r,n,36e5,"hour"):n>=6e4?s(r,n,6e4,"minute"):n>=1e3?s(r,n,1e3,"second"):r+" ms":(a=Math.abs(o=e))>=864e5?Math.round(o/864e5)+"d":a>=36e5?Math.round(o/36e5)+"h":a>=6e4?Math.round(o/6e4)+"m":a>=1e3?Math.round(o/1e3)+"s":o+"ms"}throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},41530,(e,t,r)=>{"use strict";t.exports=(e,t=process.argv)=>{let r=e.startsWith("-")?"":1===e.length?"-":"--",s=t.indexOf(r+e),n=t.indexOf("--");return -1!==s&&(-1===n||s<n)}},209596,(e,t,r)=>{"use strict";let s;e.r(446786);let n=e.r(870722),o=e.r(41530),{env:a}=process;function i(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function u(e,t){if(0===s)return 0;if(o("color=16m")||o("color=full")||o("color=truecolor"))return 3;if(o("color=256"))return 2;if(e&&!t&&void 0===s)return 0;let r=s||0;if("dumb"===a.TERM)return r;if("CI"in a)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(e=>e in a)||"codeship"===a.CI_NAME?1:r;if("TEAMCITY_VERSION"in a)return+!!/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(a.TEAMCITY_VERSION);if("truecolor"===a.COLORTERM)return 3;if("TERM_PROGRAM"in a){let e=parseInt((a.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(a.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(a.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(a.TERM)||"COLORTERM"in a?1:r}o("no-color")||o("no-colors")||o("color=false")||o("color=never")?s=0:(o("color")||o("colors")||o("color=true")||o("color=always"))&&(s=1),"FORCE_COLOR"in a&&(s="true"===a.FORCE_COLOR?1:"false"===a.FORCE_COLOR?0:0===a.FORCE_COLOR.length?1:Math.min(parseInt(a.FORCE_COLOR,10),3)),t.exports={supportsColor:function(e){return i(u(e,e&&e.isTTY))},stdout:i(u(!0,n.isatty(1))),stderr:i(u(!0,n.isatty(2)))}},512089,e=>{"use strict";var t=e.i(733897),r=e.i(681247);e.i(791146);var s=e.i(437234),n=e.i(875559);class o{authRepository;MAX_REQUESTS_PER_WINDOW=3;RATE_LIMIT_WINDOW_MINUTES=15;CODE_EXPIRY_MINUTES=10;CODE_LENGTH=6;isDev=!(0,s.getEnvironmentSettings)().isProduction;devBypassCode=(0,n.getAdminConfig)().devBypassCode||"000000";constructor(){this.authRepository=new t.UserAuthRepository}isPhoneWhitelisted(e){let{phoneNumbers:t}=(0,n.getAdminConfig)();return 0===t.length?(console.warn("[AdminAuth] ADMIN_PHONE_NUMBERS not configured"),!1):t.includes(e)}generateCode(){return Math.floor(9e5*Math.random()+1e5).toString()}async requestCode(e){try{if(!e.startsWith("+1"))return console.error("[AdminAuth] Phone number not properly normalized:",e),{success:!1,message:"Internal error: phone number format invalid"};if(!this.isPhoneWhitelisted(e))return console.warn(`[AdminAuth] Unauthorized admin login attempt: ${e}`),{success:!1,message:"Phone number not authorized for admin access."};let t=new Date(Date.now()-60*this.RATE_LIMIT_WINDOW_MINUTES*1e3);if(await this.authRepository.countRecentRequests(e,t)>=this.MAX_REQUESTS_PER_WINDOW)return{success:!1,message:`Too many requests. Please try again in ${this.RATE_LIMIT_WINDOW_MINUTES} minutes.`};let s=this.generateCode(),n=new Date(Date.now()+60*this.CODE_EXPIRY_MINUTES*1e3);await this.authRepository.createAuthCode(e,s,n);let o=`Your GymText admin verification code is: ${s}

This code expires in ${this.CODE_EXPIRY_MINUTES} minutes.`;return await r.twilioClient.sendSMS(e,o),console.log(`[AdminAuth] Verification code sent to ${e}`),this.isDev&&(console.log(`[AdminAuth:Dev] ðŸ”‘ Verification code for ${e}: ${s}`),console.log(`[AdminAuth:Dev] ðŸ’¡ Tip: You can also use magic code "${this.devBypassCode}" in dev mode`)),{success:!0}}catch(e){return console.error("[AdminAuth] Error requesting verification code:",e),{success:!1,message:"Failed to send verification code. Please try again."}}}async verifyCode(e,t){try{if(!e.startsWith("+1"))return console.error("[AdminAuth] Phone number not properly normalized:",e),{success:!1,message:"Internal error: phone number format invalid"};if(!this.isPhoneWhitelisted(e))return console.warn(`[AdminAuth] Unauthorized verification attempt: ${e}`),{success:!1,message:"Phone number not authorized for admin access."};if(t.length!==this.CODE_LENGTH||!/^\d+$/.test(t))return{success:!1,message:"Invalid code format. Code must be 6 digits."};if(this.isDev&&t===this.devBypassCode)return console.log(`[AdminAuth:Dev] âœ… Magic bypass code accepted for ${e}`),await this.authRepository.deleteCodesForPhone(e),{success:!0};if(!await this.authRepository.findValidCode(e,t))return{success:!1,message:"Invalid or expired verification code."};return await this.authRepository.deleteCodesForPhone(e),console.log(`[AdminAuth] Admin verified: ${e}`),{success:!0}}catch(e){return console.error("[AdminAuth] Error verifying code:",e),{success:!1,message:"Failed to verify code. Please try again."}}}async cleanupExpiredCodes(){try{let e=await this.authRepository.deleteExpiredCodes();return console.log(`[AdminAuth] Cleaned up ${e} expired auth codes`),e}catch(e){return console.error("[AdminAuth] Error cleaning up expired codes:",e),0}}}let a=new o;e.s(["adminAuthService",0,a])},611086,e=>{"use strict";var t=e.i(553573),r=e.i(163459),s=e.i(342845),n=e.i(904973),o=e.i(818385),a=e.i(588303),i=e.i(583020),u=e.i(304941),c=e.i(370312),l=e.i(40504),d=e.i(802579),p=e.i(225915),h=e.i(150373),m=e.i(804342),f=e.i(259207),x=e.i(348684),R=e.i(193695);e.i(650048);var g=e.i(219407),v=e.i(982099),y=e.i(512089),E=e.i(490773);async function A(e){try{let{phoneNumber:t}=await e.json();if(!t||"string"!=typeof t)return v.NextResponse.json({success:!1,message:"Phone number is required"},{status:400});let r=(0,E.normalizeUSPhoneNumber)(t);if(!r)return v.NextResponse.json({success:!1,message:"Invalid phone number format. Please enter a valid US phone number."},{status:400});let s=await y.adminAuthService.requestCode(r);if(!s.success)return v.NextResponse.json(s,{status:400});return v.NextResponse.json({success:!0,message:"Verification code sent successfully"})}catch(e){return console.error("[AdminAuth] Error in request-code API:",e),v.NextResponse.json({success:!1,message:"Internal server error"},{status:500})}}e.s(["POST",()=>A],526979);var C=e.i(526979);let w=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/auth/request-code/route",pathname:"/api/auth/request-code",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/admin/src/app/api/auth/request-code/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:T,workUnitAsyncStorage:O,serverHooks:b}=w;function I(){return(0,s.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:O})}async function _(e,t,s){w.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/auth/request-code/route";v=v.replace(/\/index$/,"")||"/";let y=await w.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:E,params:A,nextConfig:C,parsedUrl:T,isDraftMode:O,prerenderManifest:b,routerServerContext:I,isOnDemandRevalidate:_,revalidateOnlyGenerated:N,resolvedPathname:M,clientReferenceManifest:P,serverActionsManifest:q}=y,S=(0,u.normalizeAppPath)(v),D=!!(b.dynamicRoutes[S]||b.routes[M]),U=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,T,!1):t.end("This page could not be found"),null);if(D&&!O){let e=!!b.routes[M],t=b.dynamicRoutes[S];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await U();throw new R.NoFallbackError}}let k=null;!D||w.isDev||O||(k="/index"===(k=M)?"/":k);let F=!0===w.isDev||!D,$=D&&!F;q&&P&&(0,a.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:P,serverActionsManifest:q,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:q})});let j=e.method||"GET",H=(0,o.getTracer)(),L=H.getActiveScopeSpan(),W={params:A,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:F,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>w.onRequestError(e,t,s,I)},sharedContext:{buildId:E}},B=new c.NodeNextRequest(e),V=new c.NodeNextResponse(t),z=l.NextRequestAdapter.fromNodeNextRequest(B,(0,l.signalFromNodeResponse)(t));try{let a=async e=>w.handle(z,W).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${j} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${v}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),u=async n=>{var o,u;let c=async({previousCacheEntry:r})=>{try{if(!i&&_&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await a(n);e.fetchMetrics=W.renderOpts.fetchMetrics;let u=W.renderOpts.pendingWaitUntil;u&&s.waitUntil&&(s.waitUntil(u),u=void 0);let c=W.renderOpts.collectedTags;if(!D)return await (0,h.sendResponse)(B,V,o,W.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(o.headers);c&&(t[x.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==W.renderOpts.collectedRevalidate&&!(W.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&W.renderOpts.collectedRevalidate,s=void 0===W.renderOpts.collectedExpire||W.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:W.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await w.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:_})},I),t}},l=await w.handleResponse({req:e,nextConfig:C,cacheKey:k,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:_,revalidateOnlyGenerated:N,responseGenerator:c,waitUntil:s.waitUntil,isMinimalMode:i});if(!D)return null;if((null==l||null==(o=l.value)?void 0:o.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(u=l.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",_?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),O&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,m.fromNodeOutgoingHttpHeaders)(l.value.headers);return i&&D||d.delete(x.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,f.getCacheControlHeader)(l.cacheControl)),await (0,h.sendResponse)(B,V,new Response(l.value.body,{headers:d,status:l.value.status||200})),null};L?await u(L):await H.withPropagatedContext(e.headers,()=>H.trace(d.BaseServerSpan.handleRequest,{spanName:`${j} ${v}`,kind:o.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},u))}catch(t){if(t instanceof R.NoFallbackError||await w.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:_})}),D)throw t;return await (0,h.sendResponse)(B,V,new Response(null,{status:500})),null}}e.s(["handler",()=>_,"patchFetch",()=>I,"routeModule",()=>w,"serverHooks",()=>b,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>O],611086)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__3d3330ec._.js.map