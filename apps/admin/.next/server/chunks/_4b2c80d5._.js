module.exports=[166238,(e,t,r)=>{},46308,832821,437234,791146,705590,36480,e=>{"use strict";let t;e.i(166238),e.i(454188);var r=e.i(331612);let i=r.z.object({DATABASE_URL:r.z.string().min(1,"DATABASE_URL is required"),SESSION_ENCRYPTION_KEY:r.z.string().optional(),TWILIO_ACCOUNT_SID:r.z.string().min(1,"TWILIO_ACCOUNT_SID is required"),TWILIO_AUTH_TOKEN:r.z.string().min(1,"TWILIO_AUTH_TOKEN is required"),TWILIO_NUMBER:r.z.string().min(1,"TWILIO_NUMBER is required"),STRIPE_SECRET_KEY:r.z.string().min(1,"STRIPE_SECRET_KEY is required"),STRIPE_WEBHOOK_SECRET:r.z.string().optional(),OPENAI_API_KEY:r.z.string().min(1,"OPENAI_API_KEY is required"),GOOGLE_API_KEY:r.z.string().min(1,"GOOGLE_API_KEY is required"),XAI_API_KEY:r.z.string().optional(),PINECONE_API_KEY:r.z.string().min(1,"PINECONE_API_KEY is required"),PINECONE_INDEX:r.z.string().min(1,"PINECONE_INDEX is required"),CRON_SECRET:r.z.string().optional(),INNGEST_EVENT_KEY:r.z.string().optional(),INNGEST_SIGNING_KEY:r.z.string().optional(),NODE_ENV:r.z.enum(["development","test","production"]).default("development"),APP_ENV:r.z.enum(["development","staging","production"]).optional()}),n=null;function o(){return n||(n=function(){let e=i.safeParse(process.env);if(!e.success){let t=e.error.errors.map(e=>`  - ${e.path.join(".")}: ${e.message}`).join("\n");throw Error(`Server environment validation failed:
${t}

Ensure all required environment variables are set.`)}return e.data}()),n}function s(){let e=o();return{databaseUrl:e.DATABASE_URL,sessionEncryptionKey:e.SESSION_ENCRYPTION_KEY}}function a(){let e=o();return{accountSid:e.TWILIO_ACCOUNT_SID,authToken:e.TWILIO_AUTH_TOKEN,phoneNumber:e.TWILIO_NUMBER}}function d(){let e=o();return{secretKey:e.STRIPE_SECRET_KEY,webhookSecret:e.STRIPE_WEBHOOK_SECRET}}function p(){let e=o();return{openaiApiKey:e.OPENAI_API_KEY,googleApiKey:e.GOOGLE_API_KEY,xaiApiKey:e.XAI_API_KEY}}function h(){let e=o();return{nodeEnv:e.NODE_ENV,appEnv:e.APP_ENV,isDevelopment:"development"===e.NODE_ENV,isProduction:"production"===e.NODE_ENV,isTest:"test"===e.NODE_ENV}}function u(e){return void 0===e||void 0===e}function c(e){return"string"==typeof e}function l(e){return"number"==typeof e}function m(e){return"boolean"==typeof e}function N(e){return"bigint"==typeof e}function f(e){return"function"==typeof e}function y(e){return"object"==typeof e&&null!==e}function w(e){return Object.freeze(e)}function g(e){return v(e)?e:[e]}function v(e){return Array.isArray(e)}function x(e){return e}e.s(["getAiSecrets",()=>p,"getDatabaseSecrets",()=>s,"getStripeSecrets",()=>d,"getTwilioSecrets",()=>a],832821),e.s(["getEnvironmentSettings",()=>h],437234),e.s([],791146);let b=Object.prototype.toString,W=w({is:e=>"AlterTableNode"===e.kind,create:e=>w({kind:"AlterTableNode",table:e}),cloneWithTableProps:(e,t)=>w({...e,...t}),cloneWithColumnAlteration:(e,t)=>w({...e,columnAlterations:e.columnAlterations?[...e.columnAlterations,t]:[t]})}),O=w({is:e=>"IdentifierNode"===e.kind,create:e=>w({kind:"IdentifierNode",name:e})}),C=w({is:e=>"CreateIndexNode"===e.kind,create:e=>w({kind:"CreateIndexNode",name:O.create(e)}),cloneWith:(e,t)=>w({...e,...t}),cloneWithColumns:(e,t)=>w({...e,columns:[...e.columns||[],...t]})}),q=w({is:e=>"CreateSchemaNode"===e.kind,create:(e,t)=>w({kind:"CreateSchemaNode",schema:O.create(e),...t}),cloneWith:(e,t)=>w({...e,...t})}),k=["preserve rows","delete rows","drop"],I=w({is:e=>"CreateTableNode"===e.kind,create:e=>w({kind:"CreateTableNode",table:e,columns:w([])}),cloneWithColumn:(e,t)=>w({...e,columns:w([...e.columns,t])}),cloneWithConstraint:(e,t)=>w({...e,constraints:e.constraints?w([...e.constraints,t]):w([t])}),cloneWithFrontModifier:(e,t)=>w({...e,frontModifiers:e.frontModifiers?w([...e.frontModifiers,t]):w([t])}),cloneWithEndModifier:(e,t)=>w({...e,endModifiers:e.endModifiers?w([...e.endModifiers,t]):w([t])}),cloneWith:(e,t)=>w({...e,...t})}),T=w({is:e=>"SchemableIdentifierNode"===e.kind,create:e=>w({kind:"SchemableIdentifierNode",identifier:O.create(e)}),createWithSchema:(e,t)=>w({kind:"SchemableIdentifierNode",schema:O.create(e),identifier:O.create(t)})}),S=w({is:e=>"DropIndexNode"===e.kind,create:(e,t)=>w({kind:"DropIndexNode",name:T.create(e),...t}),cloneWith:(e,t)=>w({...e,...t})}),E=w({is:e=>"DropSchemaNode"===e.kind,create:(e,t)=>w({kind:"DropSchemaNode",schema:O.create(e),...t}),cloneWith:(e,t)=>w({...e,...t})}),D=w({is:e=>"DropTableNode"===e.kind,create:(e,t)=>w({kind:"DropTableNode",table:e,...t}),cloneWith:(e,t)=>w({...e,...t})}),A=w({is:e=>"AliasNode"===e.kind,create:(e,t)=>w({kind:"AliasNode",node:e,alias:t})}),L=w({is:e=>"TableNode"===e.kind,create:e=>w({kind:"TableNode",table:T.create(e)}),createWithSchema:(e,t)=>w({kind:"TableNode",table:T.createWithSchema(e,t)})});function P(e){return y(e)&&f(e.toOperationNode)}function B(e){return y(e)&&"expressionType"in e&&P(e)}let M=w({is:e=>"SelectModifierNode"===e.kind,create:(e,t)=>w({kind:"SelectModifierNode",modifier:e,of:t}),createWithExpression:e=>w({kind:"SelectModifierNode",rawModifier:e})}),R=w({is:e=>"AndNode"===e.kind,create:(e,t)=>w({kind:"AndNode",left:e,right:t})}),Q=w({is:e=>"OrNode"===e.kind,create:(e,t)=>w({kind:"OrNode",left:e,right:t})}),F=w({is:e=>"OnNode"===e.kind,create:e=>w({kind:"OnNode",on:e}),cloneWithOperation:(e,t,r)=>w({...e,on:"And"===t?R.create(e.on,r):Q.create(e.on,r)})}),U=w({is:e=>"JoinNode"===e.kind,create:(e,t)=>w({kind:"JoinNode",joinType:e,table:t,on:void 0}),createWithOn:(e,t,r)=>w({kind:"JoinNode",joinType:e,table:t,on:F.create(r)}),cloneWithOn:(e,t)=>w({...e,on:e.on?F.cloneWithOperation(e.on,"And",t):F.create(t)})}),$=w({is:e=>"BinaryOperationNode"===e.kind,create:(e,t,r)=>w({kind:"BinaryOperationNode",leftOperand:e,operator:t,rightOperand:r})}),_=["->","->>"],V=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from","+","-","*","/","%","^","&","|","#","<<",">>","&&","||",..._,"not","-","exists","not exists","between","between symmetric"],j=w({is:e=>"OperatorNode"===e.kind,create:e=>w({kind:"OperatorNode",operator:e})});function J(e){return c(e)&&_.includes(e)}let K=w({is:e=>"ColumnNode"===e.kind,create:e=>w({kind:"ColumnNode",column:O.create(e)})}),z=w({is:e=>"SelectAllNode"===e.kind,create:()=>w({kind:"SelectAllNode"})}),G=w({is:e=>"ReferenceNode"===e.kind,create:(e,t)=>w({kind:"ReferenceNode",table:t,column:e}),createSelectAll:e=>w({kind:"ReferenceNode",table:e,column:z.create()})});class Y{#e;get dynamicReference(){return this.#e}get refType(){}constructor(e){this.#e=e}toOperationNode(){return eh(this.#e)}}function H(e){return y(e)&&P(e)&&c(e.dynamicReference)}let X=w({is:e=>"OrderByItemNode"===e.kind,create:(e,t)=>w({kind:"OrderByItemNode",orderBy:e,direction:t}),cloneWith:(e,t)=>w({...e,...t})}),Z=w({is:e=>"RawNode"===e.kind,create:(e,t)=>w({kind:"RawNode",sqlFragments:w(e),parameters:w(t)}),createWithSql:e=>Z.create([e],[]),createWithChild:e=>Z.create(["",""],[e]),createWithChildren:e=>Z.create(Array(e.length+1).fill(""),e)});class ee{#t;constructor(e){this.#t=w(e)}desc(){return new ee({node:X.cloneWith(this.#t.node,{direction:Z.createWithSql("desc")})})}asc(){return new ee({node:X.cloneWith(this.#t.node,{direction:Z.createWithSql("asc")})})}nullsLast(){return new ee({node:X.cloneWith(this.#t.node,{nulls:"last"})})}nullsFirst(){return new ee({node:X.cloneWith(this.#t.node,{nulls:"first"})})}collate(e){let t;return new ee({node:X.cloneWith(this.#t.node,{collation:(t=e,w({kind:"CollateNode",collation:O.create(t)}))})})}toOperationNode(){return this.#t.node}}let et=new Set;function er(e){et.has(e)||(et.add(e),console.log(e))}function ei(e){return"asc"===e||"desc"===e}function en(e){if(2===e.length)return[eo(e[0],e[1])];if(1===e.length){let[t]=e;return Array.isArray(t)?(er("orderBy(array) is deprecated, use multiple orderBy calls instead."),t.map(e=>eo(e))):[eo(t)]}throw Error(`Invalid number of arguments at order by! expected 1-2, received ${e.length}`)}function eo(e,t){let r=function(e){if(ry(e))return rN(e);if(H(e))return e.toOperationNode();let[t,r]=e.split(" ");return r?(er("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),es(el(t),r)):el(e)}(e);if(X.is(r)){if(t)throw Error("Cannot specify direction twice!");return r}return es(r,t)}function es(e,t){if("string"==typeof t){if(!ei(t))throw Error(`Invalid order by direction: ${t}`);return X.create(e,Z.createWithSql(t))}if(B(t))return er("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),X.create(e,t.toOperationNode());let r=X.create(e);return t?t(new ee({node:r})).toOperationNode():r}let ea=w({is:e=>"JSONReferenceNode"===e.kind,create:(e,t)=>w({kind:"JSONReferenceNode",reference:e,traversal:t}),cloneWithTraversal:(e,t)=>w({...e,traversal:t})}),ed=w({is:e=>"JSONOperatorChainNode"===e.kind,create:e=>w({kind:"JSONOperatorChainNode",operator:e,values:w([])}),cloneWithValue:(e,t)=>w({...e,values:w([...e.values,t])})}),ep=w({is:e=>"JSONPathNode"===e.kind,create:e=>w({kind:"JSONPathNode",inOperator:e,pathLegs:w([])}),cloneWithLeg:(e,t)=>w({...e,pathLegs:w([...e.pathLegs,t])})});function eh(e){return c(e)?el(e):e.toOperationNode()}function eu(e){return v(e)?e.map(e=>ec(e)):[ec(e)]}function ec(e){return ry(e)?rN(e):eh(e)}function el(e){if(!e.includes("."))return G.create(K.create(e));let t=e.split(".").map(ef);if(3===t.length)return function(e){let[t,r,i]=e;return G.create(K.create(i),L.createWithSchema(t,r))}(t);if(2===t.length)return function(e){let[t,r]=e;return G.create(K.create(r),L.create(t))}(t);throw Error(`invalid column reference ${e}`)}function em(e){return K.create(e)}function eN(e){if(!e.includes(" "))return em(e);{let[t,r]=e.split(" ").map(ef);if(!ei(r))throw Error(`invalid order direction "${r}" next to "${t}"`);return en([t,r])[0]}}function ef(e){return e.trim()}let ey=w({is:e=>"PrimitiveValueListNode"===e.kind,create:e=>w({kind:"PrimitiveValueListNode",values:w([...e])})}),ew=w({is:e=>"ValueListNode"===e.kind,create:e=>w({kind:"ValueListNode",values:w(e)})}),eg=w({is:e=>"ValueNode"===e.kind,create:e=>w({kind:"ValueNode",value:e}),createImmediate:e=>w({kind:"ValueNode",value:e,immediate:!0})});function ev(e){return ry(e)?rN(e):eg.create(e)}function ex(e){return l(e)||m(e)||null===e}function eb(e){if(!ex(e))throw Error(`unsafe immediate value ${JSON.stringify(e)}`);return eg.createImmediate(e)}let eW=w({is:e=>"ParensNode"===e.kind,create:e=>w({kind:"ParensNode",node:e})});function eO(e){if(3===e.length)return eC(e[0],e[1],e[2]);if(1===e.length)return ev(e[0]);throw Error(`invalid arguments: ${JSON.stringify(e)}`)}function eC(e,t,r){var i,n;if(("is"===(i=t)||"is not"===i)&&eT(r))return $.create(ec(e),eS(t),eg.createImmediate(r));return $.create(ec(e),eS(t),v(r)?(n=r).some(ry)?ew.create(n.map(e=>ev(e))):ey.create(n):ev(r))}function eq(e,t,r){return $.create(ec(e),eS(t),ec(r))}function ek(e,t){return eI(Object.entries(e).filter(([,e])=>!u(e)).map(([e,t])=>eC(e,eT(t)?"is":"=",t)),t)}function eI(e,t,r=!0){let i="and"===t?R.create:Q.create;if(0===e.length)return $.create(eg.createImmediate(1),j.create("="),eg.createImmediate(+("and"===t)));let n=eE(e[0]);for(let t=1;t<e.length;++t)n=i(n,eE(e[t]));return e.length>1&&r?eW.create(n):n}function eT(e){return null===e||m(e)}function eS(e){if(c(e)&&V.includes(e))return j.create(e);if(P(e))return e.toOperationNode();throw Error(`invalid operator ${JSON.stringify(e)}`)}function eE(e){return P(e)?e.toOperationNode():e}let eD=w({is:e=>"OrderByNode"===e.kind,create:e=>w({kind:"OrderByNode",items:w([...e])}),cloneWithItems:(e,t)=>w({...e,items:w([...e.items,...t])})}),eA=w({is:e=>"PartitionByNode"===e.kind,create:e=>w({kind:"PartitionByNode",items:w(e)}),cloneWithItems:(e,t)=>w({...e,items:w([...e.items,...t])})}),eL=w({is:e=>"OverNode"===e.kind,create:()=>w({kind:"OverNode"}),cloneWithOrderByItems:(e,t)=>w({...e,orderBy:e.orderBy?eD.cloneWithItems(e.orderBy,t):eD.create(t)}),cloneWithPartitionByItems:(e,t)=>w({...e,partitionBy:e.partitionBy?eA.cloneWithItems(e.partitionBy,t):eA.create(t)})}),eP=w({is:e=>"FromNode"===e.kind,create:e=>w({kind:"FromNode",froms:w(e)}),cloneWithFroms:(e,t)=>w({...e,froms:w([...e.froms,...t])})}),eB=w({is:e=>"GroupByNode"===e.kind,create:e=>w({kind:"GroupByNode",items:w(e)}),cloneWithItems:(e,t)=>w({...e,items:w([...e.items,...t])})}),eM=w({is:e=>"HavingNode"===e.kind,create:e=>w({kind:"HavingNode",having:e}),cloneWithOperation:(e,t,r)=>w({...e,having:"And"===t?R.create(e.having,r):Q.create(e.having,r)})}),eR=w({is:e=>"InsertQueryNode"===e.kind,create:(e,t,r)=>w({kind:"InsertQueryNode",into:e,...t&&{with:t},replace:r}),createWithoutInto:()=>w({kind:"InsertQueryNode"}),cloneWith:(e,t)=>w({...e,...t})}),eQ=w({is:e=>"ListNode"===e.kind,create:e=>w({kind:"ListNode",items:w(e)})}),eF=w({is:e=>"UpdateQueryNode"===e.kind,create:(e,t)=>w({kind:"UpdateQueryNode",table:1===e.length?e[0]:eQ.create(e),...t&&{with:t}}),createWithoutTable:()=>w({kind:"UpdateQueryNode"}),cloneWithFromItems:(e,t)=>w({...e,from:e.from?eP.cloneWithFroms(e.from,t):eP.create(t)}),cloneWithUpdates:(e,t)=>w({...e,updates:e.updates?w([...e.updates,...t]):t}),cloneWithLimit:(e,t)=>w({...e,limit:t})}),eU=w({is:e=>"UsingNode"===e.kind,create:e=>w({kind:"UsingNode",tables:w(e)}),cloneWithTables:(e,t)=>w({...e,tables:w([...e.tables,...t])})}),e$=w({is:e=>"DeleteQueryNode"===e.kind,create:(e,t)=>w({kind:"DeleteQueryNode",from:eP.create(e),...t&&{with:t}}),cloneWithOrderByItems:(e,t)=>eG.cloneWithOrderByItems(e,t),cloneWithoutOrderBy:e=>eG.cloneWithoutOrderBy(e),cloneWithLimit:(e,t)=>w({...e,limit:t}),cloneWithoutLimit:e=>w({...e,limit:void 0}),cloneWithUsing:(e,t)=>w({...e,using:void 0!==e.using?eU.cloneWithTables(e.using,t):eU.create(t)})}),e_=w({is:e=>"WhereNode"===e.kind,create:e=>w({kind:"WhereNode",where:e}),cloneWithOperation:(e,t,r)=>w({...e,where:"And"===t?R.create(e.where,r):Q.create(e.where,r)})}),eV=w({is:e=>"ReturningNode"===e.kind,create:e=>w({kind:"ReturningNode",selections:w(e)}),cloneWithSelections:(e,t)=>w({...e,selections:e.selections?w([...e.selections,...t]):w(t)})}),ej=w({is:e=>"ExplainNode"===e.kind,create:(e,t)=>w({kind:"ExplainNode",format:e,options:t})}),eJ=w({is:e=>"WhenNode"===e.kind,create:e=>w({kind:"WhenNode",condition:e}),cloneWithResult:(e,t)=>w({...e,result:t})}),eK=w({is:e=>"MergeQueryNode"===e.kind,create:(e,t)=>w({kind:"MergeQueryNode",into:e,...t&&{with:t}}),cloneWithUsing:(e,t)=>w({...e,using:t}),cloneWithWhen:(e,t)=>w({...e,whens:e.whens?w([...e.whens,t]):w([t])}),cloneWithThen:(e,t)=>w({...e,whens:e.whens?w([...e.whens.slice(0,-1),eJ.cloneWithResult(e.whens[e.whens.length-1],t)]):void 0})}),ez=w({is:e=>"OutputNode"===e.kind,create:e=>w({kind:"OutputNode",selections:w(e)}),cloneWithSelections:(e,t)=>w({...e,selections:e.selections?w([...e.selections,...t]):w(t)})}),eG=w({is:e=>eY.is(e)||eR.is(e)||eF.is(e)||e$.is(e)||eK.is(e),cloneWithEndModifier:(e,t)=>w({...e,endModifiers:e.endModifiers?w([...e.endModifiers,t]):w([t])}),cloneWithWhere:(e,t)=>w({...e,where:e.where?e_.cloneWithOperation(e.where,"And",t):e_.create(t)}),cloneWithJoin:(e,t)=>w({...e,joins:e.joins?w([...e.joins,t]):w([t])}),cloneWithReturning:(e,t)=>w({...e,returning:e.returning?eV.cloneWithSelections(e.returning,t):eV.create(t)}),cloneWithoutReturning:e=>w({...e,returning:void 0}),cloneWithoutWhere:e=>w({...e,where:void 0}),cloneWithExplain:(e,t,r)=>w({...e,explain:ej.create(t,r?.toOperationNode())}),cloneWithTop:(e,t)=>w({...e,top:t}),cloneWithOutput:(e,t)=>w({...e,output:e.output?ez.cloneWithSelections(e.output,t):ez.create(t)}),cloneWithOrderByItems:(e,t)=>w({...e,orderBy:e.orderBy?eD.cloneWithItems(e.orderBy,t):eD.create(t)}),cloneWithoutOrderBy:e=>w({...e,orderBy:void 0})}),eY=w({is:e=>"SelectQueryNode"===e.kind,create:e=>w({kind:"SelectQueryNode",...e&&{with:e}}),createFrom:(e,t)=>w({kind:"SelectQueryNode",from:eP.create(e),...t&&{with:t}}),cloneWithSelections:(e,t)=>w({...e,selections:e.selections?w([...e.selections,...t]):w(t)}),cloneWithDistinctOn:(e,t)=>w({...e,distinctOn:e.distinctOn?w([...e.distinctOn,...t]):w(t)}),cloneWithFrontModifier:(e,t)=>w({...e,frontModifiers:e.frontModifiers?w([...e.frontModifiers,t]):w([t])}),cloneWithOrderByItems:(e,t)=>eG.cloneWithOrderByItems(e,t),cloneWithGroupByItems:(e,t)=>w({...e,groupBy:e.groupBy?eB.cloneWithItems(e.groupBy,t):eB.create(t)}),cloneWithLimit:(e,t)=>w({...e,limit:t}),cloneWithOffset:(e,t)=>w({...e,offset:t}),cloneWithFetch:(e,t)=>w({...e,fetch:t}),cloneWithHaving:(e,t)=>w({...e,having:e.having?eM.cloneWithOperation(e.having,"And",t):eM.create(t)}),cloneWithSetOperations:(e,t)=>w({...e,setOperations:e.setOperations?w([...e.setOperations,...t]):w([...t])}),cloneWithoutSelections:e=>w({...e,selections:[]}),cloneWithoutLimit:e=>w({...e,limit:void 0}),cloneWithoutOffset:e=>w({...e,offset:void 0}),cloneWithoutOrderBy:e=>eG.cloneWithoutOrderBy(e),cloneWithoutGroupBy:e=>w({...e,groupBy:void 0})});class eH{#t;constructor(e){this.#t=w(e)}on(...e){return new eH({...this.#t,joinNode:U.cloneWithOn(this.#t.joinNode,eO(e))})}onRef(e,t,r){return new eH({...this.#t,joinNode:U.cloneWithOn(this.#t.joinNode,eq(e,t,r))})}onTrue(){return new eH({...this.#t,joinNode:U.cloneWithOn(this.#t.joinNode,Z.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#t.joinNode}}let eX=w({is:e=>"PartitionByItemNode"===e.kind,create:e=>w({kind:"PartitionByItemNode",partitionBy:e})});class eZ{#t;constructor(e){this.#t=w(e)}orderBy(...e){return new eZ({overNode:eL.cloneWithOrderByItems(this.#t.overNode,en(e))})}clearOrderBy(){return new eZ({overNode:eG.cloneWithoutOrderBy(this.#t.overNode)})}partitionBy(e){return new eZ({overNode:eL.cloneWithPartitionByItems(this.#t.overNode,eu(e).map(eX.create))})}$call(e){return e(this)}toOperationNode(){return this.#t.overNode}}let e0=w({is:e=>"SelectionNode"===e.kind,create:e=>w({kind:"SelectionNode",selection:e}),createSelectAll:()=>w({kind:"SelectionNode",selection:z.create()}),createSelectAllFromTable:e=>w({kind:"SelectionNode",selection:G.createSelectAll(e)})});function e1(e){return f(e)?e1(e(rm())):v(e)?e.map(e=>e2(e)):[e2(e)]}function e2(e){return c(e)?e0.create(function(e){let t=" as ";if(!e.includes(t))return el(e);{let[r,i]=e.split(t).map(ef);return A.create(el(r),O.create(i))}}(e)):H(e)?e0.create(e.toOperationNode()):e0.create(rf(e))}function e3(e){return e?Array.isArray(e)?e.map(e8):[e8(e)]:[e0.createSelectAll()]}function e8(e){if(c(e))return e0.createSelectAllFromTable(rx(e));throw Error(`invalid value selectAll expression: ${JSON.stringify(e)}`)}let e4=w({is:e=>"ValuesNode"===e.kind,create:e=>w({kind:"ValuesNode",values:w(e)})}),e6=w({is:e=>"DefaultInsertValueNode"===e.kind,create:()=>w({kind:"DefaultInsertValueNode"})});function e7(e){var t;let r,i=f(e)?e(rm()):e;return r=function(e){let t=new Map;for(let r of e)for(let e of Object.keys(r))t.has(e)||void 0===r[e]||t.set(e,t.size);return t}(t=v(i)?i:w([i])),[w([...r.keys()].map(K.create)),e4.create(t.map(e=>(function(e,t){let r=Object.keys(e),i=Array.from({length:t.size}),n=!1,o=r.length;for(let s of r){let r=t.get(s);if(u(r)){o--;continue}let a=e[s];(u(a)||ry(a))&&(n=!0),i[r]=a}if(o<t.size||n){let e=e6.create();return ew.create(i.map(t=>u(t)?e:ev(t)))}return ey.create(i)})(e,r)))]}let e5=w({is:e=>"ColumnUpdateNode"===e.kind,create:(e,t)=>w({kind:"ColumnUpdateNode",column:e,value:t})});function e9(e){return Object.entries(f(e)?e(rm()):e).filter(([e,t])=>void 0!==t).map(([e,t])=>e5.create(K.create(e),ev(t)))}let te=w({is:e=>"OnDuplicateKeyNode"===e.kind,create:e=>w({kind:"OnDuplicateKeyNode",updates:e})});class tt{insertId;numInsertedOrUpdatedRows;constructor(e,t){this.insertId=e,this.numInsertedOrUpdatedRows=t}}class tr extends Error{node;constructor(e){super("no result"),this.node=e}}function ti(e){return Object.prototype.hasOwnProperty.call(e,"prototype")}let tn=w({is:e=>"OnConflictNode"===e.kind,create:()=>w({kind:"OnConflictNode"}),cloneWith:(e,t)=>w({...e,...t}),cloneWithIndexWhere:(e,t)=>w({...e,indexWhere:e.indexWhere?e_.cloneWithOperation(e.indexWhere,"And",t):e_.create(t)}),cloneWithIndexOrWhere:(e,t)=>w({...e,indexWhere:e.indexWhere?e_.cloneWithOperation(e.indexWhere,"Or",t):e_.create(t)}),cloneWithUpdateWhere:(e,t)=>w({...e,updateWhere:e.updateWhere?e_.cloneWithOperation(e.updateWhere,"And",t):e_.create(t)}),cloneWithUpdateOrWhere:(e,t)=>w({...e,updateWhere:e.updateWhere?e_.cloneWithOperation(e.updateWhere,"Or",t):e_.create(t)}),cloneWithoutIndexWhere:e=>w({...e,indexWhere:void 0}),cloneWithoutUpdateWhere:e=>w({...e,updateWhere:void 0})});class to{#t;constructor(e){this.#t=w(e)}column(e){let t=K.create(e);return new to({...this.#t,onConflictNode:tn.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?w([...this.#t.onConflictNode.columns,t]):w([t])})})}columns(e){let t=e.map(K.create);return new to({...this.#t,onConflictNode:tn.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?w([...this.#t.onConflictNode.columns,...t]):w(t)})})}constraint(e){return new to({...this.#t,onConflictNode:tn.cloneWith(this.#t.onConflictNode,{constraint:O.create(e)})})}expression(e){return new to({...this.#t,onConflictNode:tn.cloneWith(this.#t.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new to({...this.#t,onConflictNode:tn.cloneWithIndexWhere(this.#t.onConflictNode,eO(e))})}whereRef(e,t,r){return new to({...this.#t,onConflictNode:tn.cloneWithIndexWhere(this.#t.onConflictNode,eq(e,t,r))})}clearWhere(){return new to({...this.#t,onConflictNode:tn.cloneWithoutIndexWhere(this.#t.onConflictNode)})}doNothing(){return new ts({...this.#t,onConflictNode:tn.cloneWith(this.#t.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new ta({...this.#t,onConflictNode:tn.cloneWith(this.#t.onConflictNode,{updates:e9(e)})})}$call(e){return e(this)}}class ts{#t;constructor(e){this.#t=w(e)}toOperationNode(){return this.#t.onConflictNode}}class ta{#t;constructor(e){this.#t=w(e)}where(...e){return new ta({...this.#t,onConflictNode:tn.cloneWithUpdateWhere(this.#t.onConflictNode,eO(e))})}whereRef(e,t,r){return new ta({...this.#t,onConflictNode:tn.cloneWithUpdateWhere(this.#t.onConflictNode,eq(e,t,r))})}clearWhere(){return new ta({...this.#t,onConflictNode:tn.cloneWithoutUpdateWhere(this.#t.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#t.onConflictNode}}let td=w({is:e=>"TopNode"===e.kind,create:(e,t)=>w({kind:"TopNode",expression:e,modifiers:t})});function tp(e,t){var r;if(!l(e)&&!N(e))throw Error(`Invalid top expression: ${e}`);if(!u(t)&&"percent"!==(r=t)&&"with ties"!==r&&"percent with ties"!==r)throw Error(`Invalid top modifiers: ${t}`);return td.create(e,t)}let th=w({is:e=>"OrActionNode"===e.kind,create:e=>w({kind:"OrActionNode",action:e})});class tu{#t;constructor(e){this.#t=w(e)}values(e){let[t,r]=e7(e);return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{columns:t,values:r})})}columns(e){return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{columns:w(e.map(K.create))})})}expression(e){return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{values:rN(e)})})}defaultValues(){return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{defaultValues:!0})})}modifyEnd(e){return new tu({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}ignore(){return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{orAction:th.create("ignore")})})}orIgnore(){return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{orAction:th.create("ignore")})})}orAbort(){return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{orAction:th.create("abort")})})}orFail(){return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{orAction:th.create("fail")})})}orReplace(){return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{orAction:th.create("replace")})})}orRollback(){return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{orAction:th.create("rollback")})})}top(e,t){return new tu({...this.#t,queryNode:eG.cloneWithTop(this.#t.queryNode,tp(e,t))})}onConflict(e){return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{onConflict:e(new to({onConflictNode:tn.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new tu({...this.#t,queryNode:eR.cloneWith(this.#t.queryNode,{onDuplicateKey:te.create(e9(e))})})}returning(e){return new tu({...this.#t,queryNode:eG.cloneWithReturning(this.#t.queryNode,e1(e))})}returningAll(){return new tu({...this.#t,queryNode:eG.cloneWithReturning(this.#t.queryNode,e3())})}output(e){return new tu({...this.#t,queryNode:eG.cloneWithOutput(this.#t.queryNode,e1(e))})}outputAll(e){return new tu({...this.#t,queryNode:eG.cloneWithOutput(this.#t.queryNode,e3(e))})}clearReturning(){return new tu({...this.#t,queryNode:eG.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new tu({...this.#t})}$castTo(){return new tu(this.#t)}$narrowType(){return new tu(this.#t)}$assertType(){return new tu(this.#t)}withPlugin(e){return new tu({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,i=e.query;return i.returning&&r.supportsReturning||i.output&&r.supportsOutput?t.rows:[new tt(t.insertId,t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=tr){let t=await this.executeTakeFirst();if(void 0===t)throw ti(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let r of this.#t.executor.stream(t,e,this.#t.queryId))yield*r.rows}async explain(e,t){let r=new tu({...this.#t,queryNode:eG.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}class tc{numDeletedRows;constructor(e){this.numDeletedRows=e}}let tl=w({is:e=>"LimitNode"===e.kind,create:e=>w({kind:"LimitNode",limit:e})});class tm{#t;constructor(e){this.#t=w(e)}where(...e){return new tm({...this.#t,queryNode:eG.cloneWithWhere(this.#t.queryNode,eO(e))})}whereRef(e,t,r){return new tm({...this.#t,queryNode:eG.cloneWithWhere(this.#t.queryNode,eq(e,t,r))})}clearWhere(){return new tm({...this.#t,queryNode:eG.cloneWithoutWhere(this.#t.queryNode)})}top(e,t){return new tm({...this.#t,queryNode:eG.cloneWithTop(this.#t.queryNode,tp(e,t))})}using(e){return new tm({...this.#t,queryNode:e$.cloneWithUsing(this.#t.queryNode,rw(e))})}innerJoin(...e){return this.#r("InnerJoin",e)}leftJoin(...e){return this.#r("LeftJoin",e)}rightJoin(...e){return this.#r("RightJoin",e)}fullJoin(...e){return this.#r("FullJoin",e)}#r(e,t){return new tm({...this.#t,queryNode:eG.cloneWithJoin(this.#t.queryNode,tJ(e,t))})}returning(e){return new tm({...this.#t,queryNode:eG.cloneWithReturning(this.#t.queryNode,e1(e))})}returningAll(e){return new tm({...this.#t,queryNode:eG.cloneWithReturning(this.#t.queryNode,e3(e))})}output(e){return new tm({...this.#t,queryNode:eG.cloneWithOutput(this.#t.queryNode,e1(e))})}outputAll(e){return new tm({...this.#t,queryNode:eG.cloneWithOutput(this.#t.queryNode,e3(e))})}clearReturning(){return new tm({...this.#t,queryNode:eG.cloneWithoutReturning(this.#t.queryNode)})}clearLimit(){return new tm({...this.#t,queryNode:e$.cloneWithoutLimit(this.#t.queryNode)})}orderBy(...e){return new tm({...this.#t,queryNode:eG.cloneWithOrderByItems(this.#t.queryNode,en(e))})}clearOrderBy(){return new tm({...this.#t,queryNode:eG.cloneWithoutOrderBy(this.#t.queryNode)})}limit(e){return new tm({...this.#t,queryNode:e$.cloneWithLimit(this.#t.queryNode,tl.create(ev(e)))})}modifyEnd(e){return new tm({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}$call(e){return e(this)}$if(e,t){return e?t(this):new tm({...this.#t})}$castTo(){return new tm(this.#t)}$narrowType(){return new tm(this.#t)}$assertType(){return new tm(this.#t)}withPlugin(e){return new tm({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,i=e.query;return i.returning&&r.supportsReturning||i.output&&r.supportsOutput?t.rows:[new tc(t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=tr){let t=await this.executeTakeFirst();if(void 0===t)throw ti(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let r of this.#t.executor.stream(t,e,this.#t.queryId))yield*r.rows}async explain(e,t){let r=new tm({...this.#t,queryNode:eG.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}class tN{numUpdatedRows;numChangedRows;constructor(e,t){this.numUpdatedRows=e,this.numChangedRows=t}}class tf{#t;constructor(e){this.#t=w(e)}where(...e){return new tf({...this.#t,queryNode:eG.cloneWithWhere(this.#t.queryNode,eO(e))})}whereRef(e,t,r){return new tf({...this.#t,queryNode:eG.cloneWithWhere(this.#t.queryNode,eq(e,t,r))})}clearWhere(){return new tf({...this.#t,queryNode:eG.cloneWithoutWhere(this.#t.queryNode)})}top(e,t){return new tf({...this.#t,queryNode:eG.cloneWithTop(this.#t.queryNode,tp(e,t))})}from(e){return new tf({...this.#t,queryNode:eF.cloneWithFromItems(this.#t.queryNode,rw(e))})}innerJoin(...e){return this.#r("InnerJoin",e)}leftJoin(...e){return this.#r("LeftJoin",e)}rightJoin(...e){return this.#r("RightJoin",e)}fullJoin(...e){return this.#r("FullJoin",e)}#r(e,t){return new tf({...this.#t,queryNode:eG.cloneWithJoin(this.#t.queryNode,tJ(e,t))})}orderBy(...e){return new tf({...this.#t,queryNode:eG.cloneWithOrderByItems(this.#t.queryNode,en(e))})}clearOrderBy(){return new tf({...this.#t,queryNode:eG.cloneWithoutOrderBy(this.#t.queryNode)})}limit(e){return new tf({...this.#t,queryNode:eF.cloneWithLimit(this.#t.queryNode,tl.create(ev(e)))})}set(...e){return new tf({...this.#t,queryNode:eF.cloneWithUpdates(this.#t.queryNode,function(...e){return 2===e.length?[e5.create(ec(e[0]),ev(e[1]))]:e9(e[0])}(...e))})}returning(e){return new tf({...this.#t,queryNode:eG.cloneWithReturning(this.#t.queryNode,e1(e))})}returningAll(e){return new tf({...this.#t,queryNode:eG.cloneWithReturning(this.#t.queryNode,e3(e))})}output(e){return new tf({...this.#t,queryNode:eG.cloneWithOutput(this.#t.queryNode,e1(e))})}outputAll(e){return new tf({...this.#t,queryNode:eG.cloneWithOutput(this.#t.queryNode,e3(e))})}modifyEnd(e){return new tf({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}clearReturning(){return new tf({...this.#t,queryNode:eG.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new tf({...this.#t})}$castTo(){return new tf(this.#t)}$narrowType(){return new tf(this.#t)}$assertType(){return new tf(this.#t)}withPlugin(e){return new tf({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,i=e.query;return i.returning&&r.supportsReturning||i.output&&r.supportsOutput?t.rows:[new tN(t.numAffectedRows??BigInt(0),t.numChangedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=tr){let t=await this.executeTakeFirst();if(void 0===t)throw ti(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let r of this.#t.executor.stream(t,e,this.#t.queryId))yield*r.rows}async explain(e,t){let r=new tf({...this.#t,queryNode:eG.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}let ty=w({is:e=>"CommonTableExpressionNameNode"===e.kind,create:(e,t)=>w({kind:"CommonTableExpressionNameNode",table:L.create(e),columns:t?w(t.map(K.create)):void 0})}),tw=w({is:e=>"CommonTableExpressionNode"===e.kind,create:(e,t)=>w({kind:"CommonTableExpressionNode",name:e,expression:t}),cloneWith:(e,t)=>w({...e,...t})});class tg{#t;constructor(e){this.#t=w(e)}materialized(){return new tg({...this.#t,node:tw.cloneWith(this.#t.node,{materialized:!0})})}notMaterialized(){return new tg({...this.#t,node:tw.cloneWith(this.#t.node,{materialized:!1})})}toOperationNode(){return this.#t.node}}function tv(e,t){var r;let i=t(new tj({executor:tQ})).toOperationNode();return f(e)?e((r=i,e=>new tg({node:tw.create(tx(e),r)}))).toOperationNode():tw.create(tx(e),i)}function tx(e){if(!e.includes("("))return ty.create(e);{let t=e.split(/[\(\)]/),r=t[0],i=t[1].split(",").map(e=>e.trim());return ty.create(r,i)}}let tb=w({is:e=>"WithNode"===e.kind,create:(e,t)=>w({kind:"WithNode",expressions:w([e]),...t}),cloneWithExpression:(e,t)=>w({...e,expressions:w([...e.expressions,t])})}),tW=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function tO(){return new tC}class tC{#i;get queryId(){return void 0===this.#i&&(this.#i=function(e){let t="";for(let e=0;e<8;++e)t+=tW[~~(Math.random()*tW.length)];return t}(0)),this.#i}}class tq{nodeStack=[];#n=w({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(e,t){if(!e)return e;this.nodeStack.push(e);let r=this.transformNodeImpl(e,t);return this.nodeStack.pop(),w(r)}transformNodeImpl(e,t){return this.#n[e.kind](e,t)}transformNodeList(e,t){return e?w(e.map(e=>this.transformNode(e,t))):e}transformSelectQuery(e,t){return{kind:"SelectQueryNode",from:this.transformNode(e.from,t),selections:this.transformNodeList(e.selections,t),distinctOn:this.transformNodeList(e.distinctOn,t),joins:this.transformNodeList(e.joins,t),groupBy:this.transformNode(e.groupBy,t),orderBy:this.transformNode(e.orderBy,t),where:this.transformNode(e.where,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),limit:this.transformNode(e.limit,t),offset:this.transformNode(e.offset,t),with:this.transformNode(e.with,t),having:this.transformNode(e.having,t),explain:this.transformNode(e.explain,t),setOperations:this.transformNodeList(e.setOperations,t),fetch:this.transformNode(e.fetch,t),top:this.transformNode(e.top,t)}}transformSelection(e,t){return{kind:"SelectionNode",selection:this.transformNode(e.selection,t)}}transformColumn(e,t){return{kind:"ColumnNode",column:this.transformNode(e.column,t)}}transformAlias(e,t){return{kind:"AliasNode",node:this.transformNode(e.node,t),alias:this.transformNode(e.alias,t)}}transformTable(e,t){return{kind:"TableNode",table:this.transformNode(e.table,t)}}transformFrom(e,t){return{kind:"FromNode",froms:this.transformNodeList(e.froms,t)}}transformReference(e,t){return{kind:"ReferenceNode",column:this.transformNode(e.column,t),table:this.transformNode(e.table,t)}}transformAnd(e,t){return{kind:"AndNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)}}transformOr(e,t){return{kind:"OrNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)}}transformValueList(e,t){return{kind:"ValueListNode",values:this.transformNodeList(e.values,t)}}transformParens(e,t){return{kind:"ParensNode",node:this.transformNode(e.node,t)}}transformJoin(e,t){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table,t),on:this.transformNode(e.on,t)}}transformRaw(e,t){return{kind:"RawNode",sqlFragments:w([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters,t)}}transformWhere(e,t){return{kind:"WhereNode",where:this.transformNode(e.where,t)}}transformInsertQuery(e,t){return{kind:"InsertQueryNode",into:this.transformNode(e.into,t),columns:this.transformNodeList(e.columns,t),values:this.transformNode(e.values,t),returning:this.transformNode(e.returning,t),onConflict:this.transformNode(e.onConflict,t),onDuplicateKey:this.transformNode(e.onDuplicateKey,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),ignore:e.ignore,orAction:this.transformNode(e.orAction,t),replace:e.replace,explain:this.transformNode(e.explain,t),defaultValues:e.defaultValues,top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)}}transformValues(e,t){return{kind:"ValuesNode",values:this.transformNodeList(e.values,t)}}transformDeleteQuery(e,t){return{kind:"DeleteQueryNode",from:this.transformNode(e.from,t),using:this.transformNode(e.using,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),orderBy:this.transformNode(e.orderBy,t),limit:this.transformNode(e.limit,t),explain:this.transformNode(e.explain,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)}}transformReturning(e,t){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections,t)}}transformCreateTable(e,t){return{kind:"CreateTableNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),constraints:this.transformNodeList(e.constraints,t),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),selectQuery:this.transformNode(e.selectQuery,t)}}transformColumnDefinition(e,t){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),references:this.transformNode(e.references,t),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo,t),check:this.transformNode(e.check,t),generated:this.transformNode(e.generated,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e,t){return{kind:"AddColumnNode",column:this.transformNode(e.column,t)}}transformDropTable(e,t){return{kind:"DropTableNode",table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e,t){return{kind:"OrderByNode",items:this.transformNodeList(e.items,t)}}transformOrderByItem(e,t){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy,t),direction:this.transformNode(e.direction,t),collation:this.transformNode(e.collation,t),nulls:e.nulls}}transformGroupBy(e,t){return{kind:"GroupByNode",items:this.transformNodeList(e.items,t)}}transformGroupByItem(e,t){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy,t)}}transformUpdateQuery(e,t){return{kind:"UpdateQueryNode",table:this.transformNode(e.table,t),from:this.transformNode(e.from,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),updates:this.transformNodeList(e.updates,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),explain:this.transformNode(e.explain,t),limit:this.transformNode(e.limit,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t),orderBy:this.transformNode(e.orderBy,t)}}transformColumnUpdate(e,t){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column,t),value:this.transformNode(e.value,t)}}transformLimit(e,t){return{kind:"LimitNode",limit:this.transformNode(e.limit,t)}}transformOffset(e,t){return{kind:"OffsetNode",offset:this.transformNode(e.offset,t)}}transformOnConflict(e,t){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns,t),constraint:this.transformNode(e.constraint,t),indexExpression:this.transformNode(e.indexExpression,t),indexWhere:this.transformNode(e.indexWhere,t),updates:this.transformNodeList(e.updates,t),updateWhere:this.transformNode(e.updateWhere,t),doNothing:e.doNothing}}transformOnDuplicateKey(e,t){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates,t)}}transformCreateIndex(e,t){return{kind:"CreateIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists,where:this.transformNode(e.where,t),nullsNotDistinct:e.nullsNotDistinct}}transformList(e,t){return{kind:"ListNode",items:this.transformNodeList(e.items,t)}}transformDropIndex(e,t){return{kind:"DropIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e,t){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformUniqueConstraint(e,t){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),nullsNotDistinct:e.nullsNotDistinct,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformForeignKeyConstraint(e,t){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns,t),references:this.transformNode(e.references,t),name:this.transformNode(e.name,t),onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformSetOperation(e,t){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression,t),all:e.all}}transformReferences(e,t){return{kind:"ReferencesNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e,t){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression,t),name:this.transformNode(e.name,t)}}transformWith(e,t){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions,t),recursive:e.recursive}}transformCommonTableExpression(e,t){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name,t),materialized:e.materialized,expression:this.transformNode(e.expression,t)}}transformCommonTableExpressionName(e,t){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t)}}transformHaving(e,t){return{kind:"HavingNode",having:this.transformNode(e.having,t)}}transformCreateSchema(e,t){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema,t),ifNotExists:e.ifNotExists}}transformDropSchema(e,t){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema,t),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e,t){return{kind:"AlterTableNode",table:this.transformNode(e.table,t),renameTo:this.transformNode(e.renameTo,t),setSchema:this.transformNode(e.setSchema,t),columnAlterations:this.transformNodeList(e.columnAlterations,t),addConstraint:this.transformNode(e.addConstraint,t),dropConstraint:this.transformNode(e.dropConstraint,t),renameConstraint:this.transformNode(e.renameConstraint,t),addIndex:this.transformNode(e.addIndex,t),dropIndex:this.transformNode(e.dropIndex,t)}}transformDropColumn(e,t){return{kind:"DropColumnNode",column:this.transformNode(e.column,t)}}transformRenameColumn(e,t){return{kind:"RenameColumnNode",column:this.transformNode(e.column,t),renameTo:this.transformNode(e.renameTo,t)}}transformAlterColumn(e,t){return{kind:"AlterColumnNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),dataTypeExpression:this.transformNode(e.dataTypeExpression,t),setDefault:this.transformNode(e.setDefault,t),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e,t){return{kind:"ModifyColumnNode",column:this.transformNode(e.column,t)}}transformAddConstraint(e,t){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint,t)}}transformDropConstraint(e,t){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName,t),ifExists:e.ifExists,modifier:e.modifier}}transformRenameConstraint(e,t){return{kind:"RenameConstraintNode",oldName:this.transformNode(e.oldName,t),newName:this.transformNode(e.newName,t)}}transformCreateView(e,t){return{kind:"CreateViewNode",name:this.transformNode(e.name,t),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns,t),as:this.transformNode(e.as,t)}}transformRefreshMaterializedView(e,t){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(e.name,t),concurrently:e.concurrently,withNoData:e.withNoData}}transformDropView(e,t){return{kind:"DropViewNode",name:this.transformNode(e.name,t),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e,t){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression,t)}}transformDefaultValue(e,t){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue,t)}}transformOn(e,t){return{kind:"OnNode",on:this.transformNode(e.on,t)}}transformSelectModifier(e,t){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier,t),of:this.transformNodeList(e.of,t)}}transformCreateType(e,t){return{kind:"CreateTypeNode",name:this.transformNode(e.name,t),enum:this.transformNode(e.enum,t)}}transformDropType(e,t){return{kind:"DropTypeNode",name:this.transformNode(e.name,t),ifExists:e.ifExists}}transformExplain(e,t){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options,t)}}transformSchemableIdentifier(e,t){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema,t),identifier:this.transformNode(e.identifier,t)}}transformAggregateFunction(e,t){return{kind:"AggregateFunctionNode",func:e.func,aggregated:this.transformNodeList(e.aggregated,t),distinct:e.distinct,orderBy:this.transformNode(e.orderBy,t),withinGroup:this.transformNode(e.withinGroup,t),filter:this.transformNode(e.filter,t),over:this.transformNode(e.over,t)}}transformOver(e,t){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy,t),partitionBy:this.transformNode(e.partitionBy,t)}}transformPartitionBy(e,t){return{kind:"PartitionByNode",items:this.transformNodeList(e.items,t)}}transformPartitionByItem(e,t){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy,t)}}transformBinaryOperation(e,t){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand,t),operator:this.transformNode(e.operator,t),rightOperand:this.transformNode(e.rightOperand,t)}}transformUnaryOperation(e,t){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator,t),operand:this.transformNode(e.operand,t)}}transformUsing(e,t){return{kind:"UsingNode",tables:this.transformNodeList(e.tables,t)}}transformFunction(e,t){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments,t)}}transformCase(e,t){return{kind:"CaseNode",value:this.transformNode(e.value,t),when:this.transformNodeList(e.when,t),else:this.transformNode(e.else,t),isStatement:e.isStatement}}transformWhen(e,t){return{kind:"WhenNode",condition:this.transformNode(e.condition,t),result:this.transformNode(e.result,t)}}transformJSONReference(e,t){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference,t),traversal:this.transformNode(e.traversal,t)}}transformJSONPath(e,t){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator,t),pathLegs:this.transformNodeList(e.pathLegs,t)}}transformJSONPathLeg(e,t){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e,t){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator,t),values:this.transformNodeList(e.values,t)}}transformTuple(e,t){return{kind:"TupleNode",values:this.transformNodeList(e.values,t)}}transformMergeQuery(e,t){return{kind:"MergeQueryNode",into:this.transformNode(e.into,t),using:this.transformNode(e.using,t),whens:this.transformNodeList(e.whens,t),with:this.transformNode(e.with,t),top:this.transformNode(e.top,t),endModifiers:this.transformNodeList(e.endModifiers,t),output:this.transformNode(e.output,t),returning:this.transformNode(e.returning,t)}}transformMatched(e,t){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e,t){return{kind:"AddIndexNode",name:this.transformNode(e.name,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists}}transformCast(e,t){return{kind:"CastNode",expression:this.transformNode(e.expression,t),dataType:this.transformNode(e.dataType,t)}}transformFetch(e,t){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount,t),modifier:e.modifier}}transformTop(e,t){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e,t){return{kind:"OutputNode",selections:this.transformNodeList(e.selections,t)}}transformDataType(e,t){return e}transformSelectAll(e,t){return e}transformIdentifier(e,t){return e}transformValue(e,t){return e}transformPrimitiveValueList(e,t){return e}transformOperator(e,t){return e}transformDefaultInsertValue(e,t){return e}transformOrAction(e,t){return e}transformCollate(e,t){return e}}let tk=w({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),tI={json_agg:!0,to_json:!0};class tT extends tq{#o;#s=new Set;#a=new Set;constructor(e){super(),this.#o=e}transformNodeImpl(e,t){if(!this.#d(e))return super.transformNodeImpl(e,t);let r=this.#p(e);for(let e of r)this.#a.add(e);let i=this.#h(e);for(let e of i)this.#s.add(e);let n=super.transformNodeImpl(e,t);for(let e of i)this.#s.delete(e);for(let e of r)this.#a.delete(e);return n}transformSchemableIdentifier(e,t){let r=super.transformSchemableIdentifier(e,t);return r.schema||!this.#s.has(e.identifier.name)?r:{...r,schema:O.create(this.#o)}}transformReferences(e,t){let r=super.transformReferences(e,t);return r.table.table.schema?r:{...r,table:L.createWithSchema(this.#o,r.table.table.identifier.name)}}transformAggregateFunction(e,t){return{...super.transformAggregateFunction({...e,aggregated:[]},t),aggregated:this.#u(e,t,"aggregated")}}transformFunction(e,t){return{...super.transformFunction({...e,arguments:[]},t),arguments:this.#u(e,t,"arguments")}}#u(e,t,r){return tI[e.func]?e[r].map(e=>!L.is(e)||e.table.schema?this.transformNode(e,t):{...e,table:this.transformIdentifier(e.table.identifier,t)}):this.transformNodeList(e[r],t)}#d(e){return e.kind in tk}#h(e){let t=new Set;if("name"in e&&e.name&&T.is(e.name)&&this.#c(e.name,t),"from"in e&&e.from)for(let r of e.from.froms)this.#l(r,t);if("into"in e&&e.into&&this.#l(e.into,t),"table"in e&&e.table&&this.#l(e.table,t),"joins"in e&&e.joins)for(let r of e.joins)this.#l(r.table,t);return"using"in e&&e.using&&this.#l(e.using,t),t}#p(e){let t=new Set;return"with"in e&&e.with&&this.#m(e.with,t),t}#l(e,t){if(L.is(e))this.#c(e.table,t);else if(A.is(e)&&L.is(e.node))this.#c(e.node.table,t);else if(eQ.is(e))for(let r of e.items)this.#l(r,t)}#c(e,t){let r=e.identifier.name;this.#s.has(r)||this.#a.has(r)||t.add(r)}#m(e,t){for(let r of e.expressions){let e=r.name.table.table.identifier.name;this.#a.has(e)||t.add(e)}}}class tS{#N;constructor(e){this.#N=new tT(e)}transformQuery(e){return this.#N.transformNode(e.node,e.queryId)}async transformResult(e){return e.result}}let tE=w({is:e=>"MatchedNode"===e.kind,create:(e,t=!1)=>w({kind:"MatchedNode",not:e,bySource:t})});function tD(e,t,r){return eJ.create(eI([tE.create(!e.isMatched,e.bySource),...t&&t.length>0?[3===t.length&&r?eq(t[0],t[1],t[2]):eO(t)]:[]],"and",!1))}function tA(e){return c(e)?Z.create([e],[]):P(e)?e.toOperationNode():e}class tL{#f;#y;#w;constructor(){this.#f=new Promise((e,t)=>{this.#w=t,this.#y=e})}get promise(){return this.#f}resolve=e=>{this.#y&&this.#y(e)};reject=e=>{this.#w&&this.#w(e)}}async function tP(e){let t=new tL,r=new tL;return e.provideConnection(async e=>(t.resolve(e),await r.promise)).catch(e=>t.reject(e)),w({connection:await t.promise,release:r.resolve})}let tB=w([]);class tM{#g;constructor(e=tB){this.#g=e}get plugins(){return this.#g}transformQuery(e,t){for(let r of this.#g){let i=r.transformQuery({node:e,queryId:t});if(i.kind===e.kind)e=i;else throw Error(`KyselyPlugin.transformQuery must return a node of the same kind that was given to it. The plugin was given a ${e.kind} but it returned a ${i.kind}`)}return e}async executeQuery(e,t){return await this.provideConnection(async r=>{let i=await r.executeQuery(e);return"numUpdatedOrDeletedRows"in i&&er("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#v(i,t)})}async *stream(e,t,r){let{connection:i,release:n}=await tP(this);try{for await(let n of i.streamQuery(e,t))yield await this.#v(n,r)}finally{n()}}async #v(e,t){for(let r of this.#g)e=await r.transformResult({result:e,queryId:t});return e}}class tR extends tM{get adapter(){throw Error("this query cannot be compiled to SQL")}compileQuery(){throw Error("this query cannot be compiled to SQL")}provideConnection(){throw Error("this query cannot be executed")}withConnectionProvider(){throw Error("this query cannot have a connection provider")}withPlugin(e){return new tR([...this.plugins,e])}withPlugins(e){return new tR([...this.plugins,...e])}withPluginAtFront(e){return new tR([e,...this.plugins])}withoutPlugins(){return new tR([])}}let tQ=new tR;class tF{numChangedRows;constructor(e){this.numChangedRows=e}}class tU{#t;constructor(e){this.#t=w(e)}modifyEnd(e){return new tU({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}top(e,t){return new tU({...this.#t,queryNode:eG.cloneWithTop(this.#t.queryNode,tp(e,t))})}using(...e){return new t$({...this.#t,queryNode:eK.cloneWithUsing(this.#t.queryNode,tJ("Using",e))})}returning(e){return new tU({...this.#t,queryNode:eG.cloneWithReturning(this.#t.queryNode,e1(e))})}returningAll(e){return new tU({...this.#t,queryNode:eG.cloneWithReturning(this.#t.queryNode,e3(e))})}output(e){return new tU({...this.#t,queryNode:eG.cloneWithOutput(this.#t.queryNode,e1(e))})}outputAll(e){return new tU({...this.#t,queryNode:eG.cloneWithOutput(this.#t.queryNode,e3(e))})}}class t${#t;constructor(e){this.#t=w(e)}modifyEnd(e){return new t$({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}top(e,t){return new t$({...this.#t,queryNode:eG.cloneWithTop(this.#t.queryNode,tp(e,t))})}whenMatched(){return this.#x([])}whenMatchedAnd(...e){return this.#x(e)}whenMatchedAndRef(e,t,r){return this.#x([e,t,r],!0)}#x(e,t){return new t_({...this.#t,queryNode:eK.cloneWithWhen(this.#t.queryNode,tD({isMatched:!0},e,t))})}whenNotMatched(){return this.#b([])}whenNotMatchedAnd(...e){return this.#b(e)}whenNotMatchedAndRef(e,t,r){return this.#b([e,t,r],!0)}whenNotMatchedBySource(){return this.#b([],!1,!0)}whenNotMatchedBySourceAnd(...e){return this.#b(e,!1,!0)}whenNotMatchedBySourceAndRef(e,t,r){return this.#b([e,t,r],!0,!0)}returning(e){return new t$({...this.#t,queryNode:eG.cloneWithReturning(this.#t.queryNode,e1(e))})}returningAll(e){return new t$({...this.#t,queryNode:eG.cloneWithReturning(this.#t.queryNode,e3(e))})}output(e){return new t$({...this.#t,queryNode:eG.cloneWithOutput(this.#t.queryNode,e1(e))})}outputAll(e){return new t$({...this.#t,queryNode:eG.cloneWithOutput(this.#t.queryNode,e3(e))})}#b(e,t=!1,r=!1){let i={...this.#t,queryNode:eK.cloneWithWhen(this.#t.queryNode,tD({isMatched:!1,bySource:r},e,t))};return new(r?t_:tV)(i)}$call(e){return e(this)}$if(e,t){return e?t(this):new t$({...this.#t})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,i=e.query;return i.returning&&r.supportsReturning||i.output&&r.supportsOutput?t.rows:[new tF(t.numAffectedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=tr){let t=await this.executeTakeFirst();if(void 0===t)throw ti(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}}class t_{#t;constructor(e){this.#t=w(e)}thenDelete(){return new t$({...this.#t,queryNode:eK.cloneWithThen(this.#t.queryNode,tA("delete"))})}thenDoNothing(){return new t$({...this.#t,queryNode:eK.cloneWithThen(this.#t.queryNode,tA("do nothing"))})}thenUpdate(e){return new t$({...this.#t,queryNode:eK.cloneWithThen(this.#t.queryNode,tA(e(new tf({queryId:this.#t.queryId,executor:tQ,queryNode:eF.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate(t=>t.set(...e))}}class tV{#t;constructor(e){this.#t=w(e)}thenDoNothing(){return new t$({...this.#t,queryNode:eK.cloneWithThen(this.#t.queryNode,tA("do nothing"))})}thenInsertValues(e){let[t,r]=e7(e);return new t$({...this.#t,queryNode:eK.cloneWithThen(this.#t.queryNode,tA(eR.cloneWith(eR.createWithoutInto(),{columns:t,values:r})))})}}class tj{#t;constructor(e){this.#t=w(e)}selectFrom(e){return new t1({queryId:tO(),executor:this.#t.executor,queryNode:eY.createFrom(rw(e),this.#t.withNode)})}selectNoFrom(e){return new t1({queryId:tO(),executor:this.#t.executor,queryNode:eY.cloneWithSelections(eY.create(this.#t.withNode),e1(e))})}insertInto(e){return new tu({queryId:tO(),executor:this.#t.executor,queryNode:eR.create(rx(e),this.#t.withNode)})}replaceInto(e){return new tu({queryId:tO(),executor:this.#t.executor,queryNode:eR.create(rx(e),this.#t.withNode,!0)})}deleteFrom(e){return new tm({queryId:tO(),executor:this.#t.executor,queryNode:e$.create(rw(e),this.#t.withNode)})}updateTable(e){return new tf({queryId:tO(),executor:this.#t.executor,queryNode:eF.create(rw(e),this.#t.withNode)})}mergeInto(e){return new tU({queryId:tO(),executor:this.#t.executor,queryNode:eK.create(rv(e),this.#t.withNode)})}with(e,t){let r=tv(e,t);return new tj({...this.#t,withNode:this.#t.withNode?tb.cloneWithExpression(this.#t.withNode,r):tb.create(r)})}withRecursive(e,t){let r=tv(e,t);return new tj({...this.#t,withNode:this.#t.withNode?tb.cloneWithExpression(this.#t.withNode,r):tb.create(r,{recursive:!0})})}withPlugin(e){return new tj({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new tj({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new tj({...this.#t,executor:this.#t.executor.withPluginAtFront(new tS(e))})}}function tJ(e,t){var r,i,n,o,s,a;if(3===t.length){return r=e,i=t[0],n=t[1],o=t[2],U.createWithOn(r,rg(i),eq(n,"=",o))}if(2===t.length)return function(e,t,r){return r(new eH({joinNode:U.create(e,rg(t))})).toOperationNode()}(e,t[0],t[1]);if(1===t.length){return s=e,a=t[0],U.create(s,rg(a))}throw Error("not implemented")}let tK=w({is:e=>"OffsetNode"===e.kind,create:e=>w({kind:"OffsetNode",offset:e})}),tz=w({is:e=>"GroupByItemNode"===e.kind,create:e=>w({kind:"GroupByItemNode",groupBy:e})}),tG=w({is:e=>"SetOperationNode"===e.kind,create:(e,t,r)=>w({kind:"SetOperationNode",operator:e,expression:t,all:r})});function tY(e,t,r){return f(t)&&(t=t(rm())),v(t)||(t=[t]),t.map(t=>tG.create(e,rN(t),r))}class tH{#W;constructor(e){this.#W=e}get expressionType(){}as(e){return new tX(this,e)}or(...e){return new tZ(Q.create(this.#W,eO(e)))}and(...e){return new t0(R.create(this.#W,eO(e)))}$castTo(){return new tH(this.#W)}$notNull(){return new tH(this.#W)}toOperationNode(){return this.#W}}class tX{#O;#C;constructor(e,t){this.#O=e,this.#C=t}get expression(){return this.#O}get alias(){return this.#C}toOperationNode(){return A.create(this.#O.toOperationNode(),P(this.#C)?this.#C.toOperationNode():O.create(this.#C))}}class tZ{#W;constructor(e){this.#W=e}get expressionType(){}as(e){return new tX(this,e)}or(...e){return new tZ(Q.create(this.#W,eO(e)))}$castTo(){return new tZ(this.#W)}toOperationNode(){return eW.create(this.#W)}}class t0{#W;constructor(e){this.#W=e}get expressionType(){}as(e){return new tX(this,e)}and(...e){return new t0(R.create(this.#W,eO(e)))}$castTo(){return new t0(this.#W)}toOperationNode(){return eW.create(this.#W)}}class t1{#t;constructor(e){this.#t=w(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new t1({...this.#t,queryNode:eG.cloneWithWhere(this.#t.queryNode,eO(e))})}whereRef(e,t,r){return new t1({...this.#t,queryNode:eG.cloneWithWhere(this.#t.queryNode,eq(e,t,r))})}having(...e){return new t1({...this.#t,queryNode:eY.cloneWithHaving(this.#t.queryNode,eO(e))})}havingRef(e,t,r){return new t1({...this.#t,queryNode:eY.cloneWithHaving(this.#t.queryNode,eq(e,t,r))})}select(e){return new t1({...this.#t,queryNode:eY.cloneWithSelections(this.#t.queryNode,e1(e))})}distinctOn(e){return new t1({...this.#t,queryNode:eY.cloneWithDistinctOn(this.#t.queryNode,eu(e))})}modifyFront(e){return new t1({...this.#t,queryNode:eY.cloneWithFrontModifier(this.#t.queryNode,M.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new t1({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,M.createWithExpression(e.toOperationNode()))})}distinct(){return new t1({...this.#t,queryNode:eY.cloneWithFrontModifier(this.#t.queryNode,M.create("Distinct"))})}forUpdate(e){return new t1({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,M.create("ForUpdate",e?g(e).map(rx):void 0))})}forShare(e){return new t1({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,M.create("ForShare",e?g(e).map(rx):void 0))})}forKeyShare(e){return new t1({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,M.create("ForKeyShare",e?g(e).map(rx):void 0))})}forNoKeyUpdate(e){return new t1({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,M.create("ForNoKeyUpdate",e?g(e).map(rx):void 0))})}skipLocked(){return new t1({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,M.create("SkipLocked"))})}noWait(){return new t1({...this.#t,queryNode:eG.cloneWithEndModifier(this.#t.queryNode,M.create("NoWait"))})}selectAll(e){return new t1({...this.#t,queryNode:eY.cloneWithSelections(this.#t.queryNode,e3(e))})}innerJoin(...e){return this.#r("InnerJoin",e)}leftJoin(...e){return this.#r("LeftJoin",e)}rightJoin(...e){return this.#r("RightJoin",e)}fullJoin(...e){return this.#r("FullJoin",e)}crossJoin(...e){return this.#r("CrossJoin",e)}innerJoinLateral(...e){return this.#r("LateralInnerJoin",e)}leftJoinLateral(...e){return this.#r("LateralLeftJoin",e)}crossJoinLateral(...e){return this.#r("LateralCrossJoin",e)}crossApply(...e){return this.#r("CrossApply",e)}outerApply(...e){return this.#r("OuterApply",e)}#r(e,t){return new t1({...this.#t,queryNode:eG.cloneWithJoin(this.#t.queryNode,tJ(e,t))})}orderBy(...e){return new t1({...this.#t,queryNode:eG.cloneWithOrderByItems(this.#t.queryNode,en(e))})}groupBy(e){var t;return new t1({...this.#t,queryNode:eY.cloneWithGroupByItems(this.#t.queryNode,eu(t=f(t=e)?t(rm()):t).map(tz.create))})}limit(e){return new t1({...this.#t,queryNode:eY.cloneWithLimit(this.#t.queryNode,tl.create(ev(e)))})}offset(e){return new t1({...this.#t,queryNode:eY.cloneWithOffset(this.#t.queryNode,tK.create(ev(e)))})}fetch(e,t="only"){return new t1({...this.#t,queryNode:eY.cloneWithFetch(this.#t.queryNode,function(e,t){var r;let i,n;if(!l(e)&&!N(e))throw Error(`Invalid fetch row count: ${e}`);if("only"!==(r=t)&&"with ties"!==r)throw Error(`Invalid fetch modifier: ${t}`);return i=e,n=t,{kind:"FetchNode",rowCount:eg.create(i),modifier:n}}(e,t))})}top(e,t){return new t1({...this.#t,queryNode:eG.cloneWithTop(this.#t.queryNode,tp(e,t))})}union(e){return new t1({...this.#t,queryNode:eY.cloneWithSetOperations(this.#t.queryNode,tY("union",e,!1))})}unionAll(e){return new t1({...this.#t,queryNode:eY.cloneWithSetOperations(this.#t.queryNode,tY("union",e,!0))})}intersect(e){return new t1({...this.#t,queryNode:eY.cloneWithSetOperations(this.#t.queryNode,tY("intersect",e,!1))})}intersectAll(e){return new t1({...this.#t,queryNode:eY.cloneWithSetOperations(this.#t.queryNode,tY("intersect",e,!0))})}except(e){return new t1({...this.#t,queryNode:eY.cloneWithSetOperations(this.#t.queryNode,tY("except",e,!1))})}exceptAll(e){return new t1({...this.#t,queryNode:eY.cloneWithSetOperations(this.#t.queryNode,tY("except",e,!0))})}as(e){return new t2(this,e)}clearSelect(){return new t1({...this.#t,queryNode:eY.cloneWithoutSelections(this.#t.queryNode)})}clearWhere(){return new t1({...this.#t,queryNode:eG.cloneWithoutWhere(this.#t.queryNode)})}clearLimit(){return new t1({...this.#t,queryNode:eY.cloneWithoutLimit(this.#t.queryNode)})}clearOffset(){return new t1({...this.#t,queryNode:eY.cloneWithoutOffset(this.#t.queryNode)})}clearOrderBy(){return new t1({...this.#t,queryNode:eG.cloneWithoutOrderBy(this.#t.queryNode)})}clearGroupBy(){return new t1({...this.#t,queryNode:eY.cloneWithoutGroupBy(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new t1({...this.#t})}$castTo(){return new t1(this.#t)}$narrowType(){return new t1(this.#t)}$assertType(){return new t1(this.#t)}$asTuple(){return new tH(this.toOperationNode())}$asScalar(){return new tH(this.toOperationNode())}withPlugin(e){return new t1({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile();return(await this.#t.executor.executeQuery(e,this.#t.queryId)).rows}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=tr){let t=await this.executeTakeFirst();if(void 0===t)throw ti(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let r of this.#t.executor.stream(t,e,this.#t.queryId))yield*r.rows}async explain(e,t){let r=new t1({...this.#t,queryNode:eG.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}class t2{#q;#C;constructor(e,t){this.#q=e,this.#C=t}get expression(){return this.#q}get alias(){return this.#C}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return A.create(this.#q.toOperationNode(),O.create(this.#C))}}let t3=w({is:e=>"AggregateFunctionNode"===e.kind,create:(e,t=[])=>w({kind:"AggregateFunctionNode",func:e,aggregated:t}),cloneWithDistinct:e=>w({...e,distinct:!0}),cloneWithOrderBy(e,t,r=!1){let i=r?"withinGroup":"orderBy";return w({...e,[i]:e[i]?eD.cloneWithItems(e[i],t):eD.create(t)})},cloneWithFilter:(e,t)=>w({...e,filter:e.filter?e_.cloneWithOperation(e.filter,"And",t):e_.create(t)}),cloneWithOrFilter:(e,t)=>w({...e,filter:e.filter?e_.cloneWithOperation(e.filter,"Or",t):e_.create(t)}),cloneWithOver:(e,t)=>w({...e,over:t})}),t8=w({is:e=>"FunctionNode"===e.kind,create:(e,t)=>w({kind:"FunctionNode",func:e,arguments:t})});class t4{#t;constructor(e){this.#t=w(e)}get expressionType(){}as(e){return new t6(this,e)}distinct(){return new t4({...this.#t,aggregateFunctionNode:t3.cloneWithDistinct(this.#t.aggregateFunctionNode)})}orderBy(...e){return new t4({...this.#t,aggregateFunctionNode:eG.cloneWithOrderByItems(this.#t.aggregateFunctionNode,en(e))})}clearOrderBy(){return new t4({...this.#t,aggregateFunctionNode:eG.cloneWithoutOrderBy(this.#t.aggregateFunctionNode)})}withinGroupOrderBy(...e){return new t4({...this.#t,aggregateFunctionNode:t3.cloneWithOrderBy(this.#t.aggregateFunctionNode,en(e),!0)})}filterWhere(...e){return new t4({...this.#t,aggregateFunctionNode:t3.cloneWithFilter(this.#t.aggregateFunctionNode,eO(e))})}filterWhereRef(e,t,r){return new t4({...this.#t,aggregateFunctionNode:t3.cloneWithFilter(this.#t.aggregateFunctionNode,eq(e,t,r))})}over(e){let t=new eZ({overNode:eL.create()});return new t4({...this.#t,aggregateFunctionNode:t3.cloneWithOver(this.#t.aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}$castTo(){return new t4(this.#t)}$notNull(){return new t4(this.#t)}toOperationNode(){return this.#t.aggregateFunctionNode}}class t6{#k;#C;constructor(e,t){this.#k=e,this.#C=t}get expression(){return this.#k}get alias(){return this.#C}toOperationNode(){return A.create(this.#k.toOperationNode(),O.create(this.#C))}}function t7(){let e=(e,t)=>new tH(t8.create(e,eu(t??[]))),t=(e,t)=>new t4({aggregateFunctionNode:t3.create(e,t?eu(t):void 0)});return Object.assign(e,{agg:t,avg:e=>t("avg",[e]),coalesce:(...t)=>e("coalesce",t),count:e=>t("count",[e]),countAll:e=>new t4({aggregateFunctionNode:t3.create("count",e3(e))}),max:e=>t("max",[e]),min:e=>t("min",[e]),sum:e=>t("sum",[e]),any:t=>e("any",[t]),jsonAgg:e=>new t4({aggregateFunctionNode:t3.create("json_agg",[c(e)?rx(e):e.toOperationNode()])}),toJson:e=>new tH(t8.create("to_json",[c(e)?rx(e):e.toOperationNode()]))})}let t5=w({is:e=>"UnaryOperationNode"===e.kind,create:(e,t)=>w({kind:"UnaryOperationNode",operator:e,operand:t})}),t9=w({is:e=>"CaseNode"===e.kind,create:e=>w({kind:"CaseNode",value:e}),cloneWithWhen:(e,t)=>w({...e,when:w(e.when?[...e.when,t]:[t])}),cloneWithThen:(e,t)=>w({...e,when:e.when?w([...e.when.slice(0,-1),eJ.cloneWithResult(e.when[e.when.length-1],t)]):void 0}),cloneWith:(e,t)=>w({...e,...t})});class re{#t;constructor(e){this.#t=w(e)}when(...e){return new rt({...this.#t,node:t9.cloneWithWhen(this.#t.node,eJ.create(eO(e)))})}}class rt{#t;constructor(e){this.#t=w(e)}then(e){return new rr({...this.#t,node:t9.cloneWithThen(this.#t.node,ex(e)?eb(e):ev(e))})}}class rr{#t;constructor(e){this.#t=w(e)}when(...e){return new rt({...this.#t,node:t9.cloneWithWhen(this.#t.node,eJ.create(eO(e)))})}else(e){return new ri({...this.#t,node:t9.cloneWith(this.#t.node,{else:ex(e)?eb(e):ev(e)})})}end(){return new tH(t9.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new tH(t9.cloneWith(this.#t.node,{isStatement:!0}))}}class ri{#t;constructor(e){this.#t=w(e)}end(){return new tH(t9.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new tH(t9.cloneWith(this.#t.node,{isStatement:!0}))}}let rn=w({is:e=>"JSONPathLegNode"===e.kind,create:(e,t)=>w({kind:"JSONPathLegNode",type:e,value:t})});class ro{#W;constructor(e){this.#W=e}at(e){return this.#I("ArrayLocation",e)}key(e){return this.#I("Member",e)}#I(e,t){return new rs(ea.is(this.#W)?ea.cloneWithTraversal(this.#W,ep.is(this.#W.traversal)?ep.cloneWithLeg(this.#W.traversal,rn.create(e,t)):ed.cloneWithValue(this.#W.traversal,eg.createImmediate(t))):ep.cloneWithLeg(this.#W,rn.create(e,t)))}}class rs extends ro{#W;constructor(e){super(e),this.#W=e}get expressionType(){}as(e){return new ra(this,e)}$castTo(){return new rs(this.#W)}$notNull(){return new rs(this.#W)}toOperationNode(){return this.#W}}class ra{#T;#C;constructor(e,t){this.#T=e,this.#C=t}get expression(){return this.#T}get alias(){return this.#C}toOperationNode(){return A.create(this.#T.toOperationNode(),P(this.#C)?this.#C.toOperationNode():O.create(this.#C))}}let rd=w({is:e=>"TupleNode"===e.kind,create:e=>w({kind:"TupleNode",values:w(e)})}),rp=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],rh=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],ru=w({is:e=>"DataTypeNode"===e.kind,create:e=>w({kind:"DataTypeNode",dataType:e})});function rc(e){if(P(e))return e.toOperationNode();if(rp.includes(e)||rh.some(t=>t.test(e)))return ru.create(e);throw Error(`invalid column data type ${JSON.stringify(e)}`)}let rl=w({is:e=>"CastNode"===e.kind,create:(e,t)=>w({kind:"CastNode",expression:e,dataType:t})});function rm(e=tQ){function t(e,t){return new tH(t5.create(j.create(e),ec(t)))}let r=Object.assign(function(e,t,r){return new tH(eC(e,t,r))},{fn:void 0,eb:void 0,selectFrom:t=>new t1({queryId:tO(),executor:e,queryNode:eY.createFrom(rw(t))}),case:e=>new re({node:t9.create(u(e)?void 0:ec(e))}),ref:(e,t)=>u(t)?new tH(el(e)):new ro(function(e,t){let r=el(e);if(J(t))return ea.create(r,ed.create(j.create(t)));let i=t.slice(0,-1);if(J(i))return ea.create(r,ep.create(j.create(i)));throw Error(`Invalid JSON operator: ${t}`)}(e,t)),jsonPath:()=>new ro(ep.create()),table:e=>new tH(rx(e)),val:e=>new tH(ev(e)),refTuple:(...e)=>new tH(rd.create(e.map(ec))),tuple:(...e)=>new tH(rd.create(e.map(ev))),lit:e=>new tH(eb(e)),unary:t,not:e=>t("not",e),exists:e=>t("exists",e),neg:e=>t("-",e),between:(e,t,r)=>new tH($.create(ec(e),j.create("between"),R.create(ev(t),ev(r)))),betweenSymmetric:(e,t,r)=>new tH($.create(ec(e),j.create("between symmetric"),R.create(ev(t),ev(r)))),and:e=>new tH(v(e)?eI(e,"and"):ek(e,"and")),or:e=>new tH(v(e)?eI(e,"or"):ek(e,"or")),parens(...e){let t=eO(e);return new tH(eW.is(t)?t:eW.create(t))},cast:(e,t)=>new tH(rl.create(ec(e),rc(t))),withSchema:t=>rm(e.withPluginAtFront(new tS(t)))});return r.fn=t7(),r.eb=r,r}function rN(e){if(P(e))return e.toOperationNode();if(f(e))return e(rm()).toOperationNode();throw Error(`invalid expression: ${JSON.stringify(e)}`)}function rf(e){if(P(e))return e.toOperationNode();if(f(e))return e(rm()).toOperationNode();throw Error(`invalid aliased expression: ${JSON.stringify(e)}`)}function ry(e){return B(e)||y(e)&&"expression"in e&&c(e.alias)&&P(e)||f(e)}function rw(e){return v(e)?e.map(e=>rg(e)):[rg(e)]}function rg(e){return c(e)?rv(e):rf(e)}function rv(e){let t=" as ";if(!e.includes(t))return rx(e);{let[r,i]=e.split(t).map(rb);return A.create(rx(r),O.create(i))}}function rx(e){if(!e.includes("."))return L.create(e);{let[t,r]=e.split(".").map(rb);return L.createWithSchema(t,r)}}function rb(e){return e.trim()}let rW=w({is:e=>"AddColumnNode"===e.kind,create:e=>w({kind:"AddColumnNode",column:e})}),rO=w({is:e=>"ColumnDefinitionNode"===e.kind,create:(e,t)=>w({kind:"ColumnDefinitionNode",column:K.create(e),dataType:t}),cloneWithFrontModifier:(e,t)=>w({...e,frontModifiers:e.frontModifiers?w([...e.frontModifiers,t]):[t]}),cloneWithEndModifier:(e,t)=>w({...e,endModifiers:e.endModifiers?w([...e.endModifiers,t]):[t]}),cloneWith:(e,t)=>w({...e,...t})}),rC=w({is:e=>"DropColumnNode"===e.kind,create:e=>w({kind:"DropColumnNode",column:K.create(e)})}),rq=w({is:e=>"RenameColumnNode"===e.kind,create:(e,t)=>w({kind:"RenameColumnNode",column:K.create(e),renameTo:K.create(t)})}),rk=w({is:e=>"CheckConstraintNode"===e.kind,create:(e,t)=>w({kind:"CheckConstraintNode",expression:e,name:t?O.create(t):void 0})}),rI=["no action","restrict","cascade","set null","set default"],rT=w({is:e=>"ReferencesNode"===e.kind,create:(e,t)=>w({kind:"ReferencesNode",table:e,columns:w([...t])}),cloneWithOnDelete:(e,t)=>w({...e,onDelete:t}),cloneWithOnUpdate:(e,t)=>w({...e,onUpdate:t})});function rS(e){return P(e)?e.toOperationNode():eg.createImmediate(e)}let rE=w({is:e=>"GeneratedNode"===e.kind,create:e=>w({kind:"GeneratedNode",...e}),createWithExpression:e=>w({kind:"GeneratedNode",always:!0,expression:e}),cloneWith:(e,t)=>w({...e,...t})}),rD=w({is:e=>"DefaultValueNode"===e.kind,create:e=>w({kind:"DefaultValueNode",defaultValue:e})});function rA(e){if(rI.includes(e))return e;throw Error(`invalid OnModifyForeignAction ${e}`)}class rL{#W;constructor(e){this.#W=e}autoIncrement(){return new rL(rO.cloneWith(this.#W,{autoIncrement:!0}))}identity(){return new rL(rO.cloneWith(this.#W,{identity:!0}))}primaryKey(){return new rL(rO.cloneWith(this.#W,{primaryKey:!0}))}references(e){let t=el(e);if(!t.table||z.is(t.column))throw Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new rL(rO.cloneWith(this.#W,{references:rT.create(t.table,[t.column])}))}onDelete(e){if(!this.#W.references)throw Error("on delete constraint can only be added for foreign keys");return new rL(rO.cloneWith(this.#W,{references:rT.cloneWithOnDelete(this.#W.references,rA(e))}))}onUpdate(e){if(!this.#W.references)throw Error("on update constraint can only be added for foreign keys");return new rL(rO.cloneWith(this.#W,{references:rT.cloneWithOnUpdate(this.#W.references,rA(e))}))}unique(){return new rL(rO.cloneWith(this.#W,{unique:!0}))}notNull(){return new rL(rO.cloneWith(this.#W,{notNull:!0}))}unsigned(){return new rL(rO.cloneWith(this.#W,{unsigned:!0}))}defaultTo(e){return new rL(rO.cloneWith(this.#W,{defaultTo:rD.create(rS(e))}))}check(e){return new rL(rO.cloneWith(this.#W,{check:rk.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new rL(rO.cloneWith(this.#W,{generated:rE.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new rL(rO.cloneWith(this.#W,{generated:rE.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new rL(rO.cloneWith(this.#W,{generated:rE.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#W.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new rL(rO.cloneWith(this.#W,{generated:rE.cloneWith(this.#W.generated,{stored:!0})}))}modifyFront(e){return new rL(rO.cloneWithFrontModifier(this.#W,e.toOperationNode()))}nullsNotDistinct(){return new rL(rO.cloneWith(this.#W,{nullsNotDistinct:!0}))}ifNotExists(){return new rL(rO.cloneWith(this.#W,{ifNotExists:!0}))}modifyEnd(e){return new rL(rO.cloneWithEndModifier(this.#W,e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return this.#W}}let rP=w({is:e=>"ModifyColumnNode"===e.kind,create:e=>w({kind:"ModifyColumnNode",column:e})}),rB=w({is:e=>"ForeignKeyConstraintNode"===e.kind,create:(e,t,r,i)=>w({kind:"ForeignKeyConstraintNode",columns:e,references:rT.create(t,r),name:i?O.create(i):void 0}),cloneWith:(e,t)=>w({...e,...t})});class rM{#W;constructor(e){this.#W=e}onDelete(e){return new rM(rB.cloneWith(this.#W,{onDelete:rA(e)}))}onUpdate(e){return new rM(rB.cloneWith(this.#W,{onUpdate:rA(e)}))}deferrable(){return new rM(rB.cloneWith(this.#W,{deferrable:!0}))}notDeferrable(){return new rM(rB.cloneWith(this.#W,{deferrable:!1}))}initiallyDeferred(){return new rM(rB.cloneWith(this.#W,{initiallyDeferred:!0}))}initiallyImmediate(){return new rM(rB.cloneWith(this.#W,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#W}}let rR=w({is:e=>"AddConstraintNode"===e.kind,create:e=>w({kind:"AddConstraintNode",constraint:e})}),rQ=w({is:e=>"UniqueConstraintNode"===e.kind,create:(e,t,r)=>w({kind:"UniqueConstraintNode",columns:w(e.map(K.create)),name:t?O.create(t):void 0,nullsNotDistinct:r}),cloneWith:(e,t)=>w({...e,...t})}),rF=w({is:e=>"DropConstraintNode"===e.kind,create:e=>w({kind:"DropConstraintNode",constraintName:O.create(e)}),cloneWith:(e,t)=>w({...e,...t})}),rU=w({is:e=>"AlterColumnNode"===e.kind,create:(e,t,r)=>w({kind:"AlterColumnNode",column:K.create(e),[t]:r})});class r${#S;constructor(e){this.#S=e}setDataType(e){return new r_(rU.create(this.#S,"dataType",rc(e)))}setDefault(e){return new r_(rU.create(this.#S,"setDefault",rS(e)))}dropDefault(){return new r_(rU.create(this.#S,"dropDefault",!0))}setNotNull(){return new r_(rU.create(this.#S,"setNotNull",!0))}dropNotNull(){return new r_(rU.create(this.#S,"dropNotNull",!0))}$call(e){return e(this)}}class r_{#E;constructor(e){this.#E=e}toOperationNode(){return this.#E}}class rV{#t;constructor(e){this.#t=w(e)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class rj{#t;constructor(e){this.#t=w(e)}onDelete(e){return new rj({...this.#t,constraintBuilder:this.#t.constraintBuilder.onDelete(e)})}onUpdate(e){return new rj({...this.#t,constraintBuilder:this.#t.constraintBuilder.onUpdate(e)})}deferrable(){return new rj({...this.#t,constraintBuilder:this.#t.constraintBuilder.deferrable()})}notDeferrable(){return new rj({...this.#t,constraintBuilder:this.#t.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new rj({...this.#t,constraintBuilder:this.#t.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new rj({...this.#t,constraintBuilder:this.#t.constraintBuilder.initiallyImmediate()})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(W.cloneWithTableProps(this.#t.node,{addConstraint:rR.create(this.#t.constraintBuilder.toOperationNode())}),this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class rJ{#t;constructor(e){this.#t=w(e)}ifExists(){return new rJ({...this.#t,node:W.cloneWithTableProps(this.#t.node,{dropConstraint:rF.cloneWith(this.#t.node.dropConstraint,{ifExists:!0})})})}cascade(){return new rJ({...this.#t,node:W.cloneWithTableProps(this.#t.node,{dropConstraint:rF.cloneWith(this.#t.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new rJ({...this.#t,node:W.cloneWithTableProps(this.#t.node,{dropConstraint:rF.cloneWith(this.#t.node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}let rK=w({is:e=>"PrimaryKeyConstraintNode"===e.kind,create:(e,t)=>w({kind:"PrimaryKeyConstraintNode",columns:w(e.map(K.create)),name:t?O.create(t):void 0}),cloneWith:(e,t)=>w({...e,...t})}),rz=w({is:e=>"AddIndexNode"===e.kind,create:e=>w({kind:"AddIndexNode",name:O.create(e)}),cloneWith:(e,t)=>w({...e,...t}),cloneWithColumns:(e,t)=>w({...e,columns:[...e.columns||[],...t]})});class rG{#t;constructor(e){this.#t=w(e)}unique(){return new rG({...this.#t,node:W.cloneWithTableProps(this.#t.node,{addIndex:rz.cloneWith(this.#t.node.addIndex,{unique:!0})})})}column(e){return new rG({...this.#t,node:W.cloneWithTableProps(this.#t.node,{addIndex:rz.cloneWithColumns(this.#t.node.addIndex,[eN(e)])})})}columns(e){return new rG({...this.#t,node:W.cloneWithTableProps(this.#t.node,{addIndex:rz.cloneWithColumns(this.#t.node.addIndex,e.map(eN))})})}expression(e){return new rG({...this.#t,node:W.cloneWithTableProps(this.#t.node,{addIndex:rz.cloneWithColumns(this.#t.node.addIndex,[e.toOperationNode()])})})}using(e){return new rG({...this.#t,node:W.cloneWithTableProps(this.#t.node,{addIndex:rz.cloneWith(this.#t.node.addIndex,{using:Z.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class rY{#W;constructor(e){this.#W=e}nullsNotDistinct(){return new rY(rQ.cloneWith(this.#W,{nullsNotDistinct:!0}))}deferrable(){return new rY(rQ.cloneWith(this.#W,{deferrable:!0}))}notDeferrable(){return new rY(rQ.cloneWith(this.#W,{deferrable:!1}))}initiallyDeferred(){return new rY(rQ.cloneWith(this.#W,{initiallyDeferred:!0}))}initiallyImmediate(){return new rY(rQ.cloneWith(this.#W,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#W}}class rH{#W;constructor(e){this.#W=e}deferrable(){return new rH(rK.cloneWith(this.#W,{deferrable:!0}))}notDeferrable(){return new rH(rK.cloneWith(this.#W,{deferrable:!1}))}initiallyDeferred(){return new rH(rK.cloneWith(this.#W,{initiallyDeferred:!0}))}initiallyImmediate(){return new rH(rK.cloneWith(this.#W,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#W}}class rX{#W;constructor(e){this.#W=e}$call(e){return e(this)}toOperationNode(){return this.#W}}let rZ=w({is:e=>"RenameConstraintNode"===e.kind,create:(e,t)=>w({kind:"RenameConstraintNode",oldName:O.create(e),newName:O.create(t)})});class r0{#t;constructor(e){this.#t=w(e)}renameTo(e){return new rV({...this.#t,node:W.cloneWithTableProps(this.#t.node,{renameTo:rx(e)})})}setSchema(e){return new rV({...this.#t,node:W.cloneWithTableProps(this.#t.node,{setSchema:O.create(e)})})}alterColumn(e,t){let r=t(new r$(e));return new r1({...this.#t,node:W.cloneWithColumnAlteration(this.#t.node,r.toOperationNode())})}dropColumn(e){return new r1({...this.#t,node:W.cloneWithColumnAlteration(this.#t.node,rC.create(e))})}renameColumn(e,t){return new r1({...this.#t,node:W.cloneWithColumnAlteration(this.#t.node,rq.create(e,t))})}addColumn(e,t,r=x){let i=r(new rL(rO.create(e,rc(t))));return new r1({...this.#t,node:W.cloneWithColumnAlteration(this.#t.node,rW.create(i.toOperationNode()))})}modifyColumn(e,t,r=x){let i=r(new rL(rO.create(e,rc(t))));return new r1({...this.#t,node:W.cloneWithColumnAlteration(this.#t.node,rP.create(i.toOperationNode()))})}addUniqueConstraint(e,t,r=x){let i=r(new rY(rQ.create(t,e)));return new rV({...this.#t,node:W.cloneWithTableProps(this.#t.node,{addConstraint:rR.create(i.toOperationNode())})})}addCheckConstraint(e,t,r=x){let i=r(new rX(rk.create(t.toOperationNode(),e)));return new rV({...this.#t,node:W.cloneWithTableProps(this.#t.node,{addConstraint:rR.create(i.toOperationNode())})})}addForeignKeyConstraint(e,t,r,i,n=x){let o=n(new rM(rB.create(t.map(K.create),rx(r),i.map(K.create),e)));return new rj({...this.#t,constraintBuilder:o})}addPrimaryKeyConstraint(e,t,r=x){let i=r(new rH(rK.create(t,e)));return new rV({...this.#t,node:W.cloneWithTableProps(this.#t.node,{addConstraint:rR.create(i.toOperationNode())})})}dropConstraint(e){return new rJ({...this.#t,node:W.cloneWithTableProps(this.#t.node,{dropConstraint:rF.create(e)})})}renameConstraint(e,t){return new rJ({...this.#t,node:W.cloneWithTableProps(this.#t.node,{renameConstraint:rZ.create(e,t)})})}addIndex(e){return new rG({...this.#t,node:W.cloneWithTableProps(this.#t.node,{addIndex:rz.create(e)})})}dropIndex(e){return new rV({...this.#t,node:W.cloneWithTableProps(this.#t.node,{dropIndex:S.create(e)})})}$call(e){return e(this)}}class r1{#t;constructor(e){this.#t=w(e)}alterColumn(e,t){let r=t(new r$(e));return new r1({...this.#t,node:W.cloneWithColumnAlteration(this.#t.node,r.toOperationNode())})}dropColumn(e){return new r1({...this.#t,node:W.cloneWithColumnAlteration(this.#t.node,rC.create(e))})}renameColumn(e,t){return new r1({...this.#t,node:W.cloneWithColumnAlteration(this.#t.node,rq.create(e,t))})}addColumn(e,t,r=x){let i=r(new rL(rO.create(e,rc(t))));return new r1({...this.#t,node:W.cloneWithColumnAlteration(this.#t.node,rW.create(i.toOperationNode()))})}modifyColumn(e,t,r=x){let i=r(new rL(rO.create(e,rc(t))));return new r1({...this.#t,node:W.cloneWithColumnAlteration(this.#t.node,rP.create(i.toOperationNode()))})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class r2 extends tq{transformPrimitiveValueList(e){return ew.create(e.values.map(eg.createImmediate))}transformValue(e){return eg.createImmediate(e.value)}}class r3{#t;constructor(e){this.#t=w(e)}ifNotExists(){return new r3({...this.#t,node:C.cloneWith(this.#t.node,{ifNotExists:!0})})}unique(){return new r3({...this.#t,node:C.cloneWith(this.#t.node,{unique:!0})})}nullsNotDistinct(){return new r3({...this.#t,node:C.cloneWith(this.#t.node,{nullsNotDistinct:!0})})}on(e){return new r3({...this.#t,node:C.cloneWith(this.#t.node,{table:rx(e)})})}column(e){return new r3({...this.#t,node:C.cloneWithColumns(this.#t.node,[eN(e)])})}columns(e){return new r3({...this.#t,node:C.cloneWithColumns(this.#t.node,e.map(eN))})}expression(e){return new r3({...this.#t,node:C.cloneWithColumns(this.#t.node,[e.toOperationNode()])})}using(e){return new r3({...this.#t,node:C.cloneWith(this.#t.node,{using:Z.createWithSql(e)})})}where(...e){let t=new r2;return new r3({...this.#t,node:eG.cloneWithWhere(this.#t.node,t.transformNode(eO(e),this.#t.queryId))})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class r8{#t;constructor(e){this.#t=w(e)}ifNotExists(){return new r8({...this.#t,node:q.cloneWith(this.#t.node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class r4{#t;constructor(e){this.#t=w(e)}temporary(){return new r4({...this.#t,node:I.cloneWith(this.#t.node,{temporary:!0})})}onCommit(e){return new r4({...this.#t,node:I.cloneWith(this.#t.node,{onCommit:function(e){if(k.includes(e))return e;throw Error(`invalid OnCommitAction ${e}`)}(e)})})}ifNotExists(){return new r4({...this.#t,node:I.cloneWith(this.#t.node,{ifNotExists:!0})})}addColumn(e,t,r=x){let i=r(new rL(rO.create(e,rc(t))));return new r4({...this.#t,node:I.cloneWithColumn(this.#t.node,i.toOperationNode())})}addPrimaryKeyConstraint(e,t,r=x){let i=r(new rH(rK.create(t,e)));return new r4({...this.#t,node:I.cloneWithConstraint(this.#t.node,i.toOperationNode())})}addUniqueConstraint(e,t,r=x){let i=r(new rY(rQ.create(t,e)));return new r4({...this.#t,node:I.cloneWithConstraint(this.#t.node,i.toOperationNode())})}addCheckConstraint(e,t,r=x){let i=r(new rX(rk.create(t.toOperationNode(),e)));return new r4({...this.#t,node:I.cloneWithConstraint(this.#t.node,i.toOperationNode())})}addForeignKeyConstraint(e,t,r,i,n=x){let o=n(new rM(rB.create(t.map(K.create),rx(r),i.map(K.create),e)));return new r4({...this.#t,node:I.cloneWithConstraint(this.#t.node,o.toOperationNode())})}modifyFront(e){return new r4({...this.#t,node:I.cloneWithFrontModifier(this.#t.node,e.toOperationNode())})}modifyEnd(e){return new r4({...this.#t,node:I.cloneWithEndModifier(this.#t.node,e.toOperationNode())})}as(e){return new r4({...this.#t,node:I.cloneWith(this.#t.node,{selectQuery:rN(e)})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class r6{#t;constructor(e){this.#t=w(e)}on(e){return new r6({...this.#t,node:S.cloneWith(this.#t.node,{table:rx(e)})})}ifExists(){return new r6({...this.#t,node:S.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new r6({...this.#t,node:S.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class r7{#t;constructor(e){this.#t=w(e)}ifExists(){return new r7({...this.#t,node:E.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new r7({...this.#t,node:E.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class r5{#t;constructor(e){this.#t=w(e)}ifExists(){return new r5({...this.#t,node:D.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new r5({...this.#t,node:D.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}let r9=w({is:e=>"CreateViewNode"===e.kind,create:e=>w({kind:"CreateViewNode",name:T.create(e)}),cloneWith:(e,t)=>w({...e,...t})});class ie{#N=new r2;transformQuery(e){return this.#N.transformNode(e.node,e.queryId)}transformResult(e){return Promise.resolve(e.result)}}class it{#t;constructor(e){this.#t=w(e)}temporary(){return new it({...this.#t,node:r9.cloneWith(this.#t.node,{temporary:!0})})}materialized(){return new it({...this.#t,node:r9.cloneWith(this.#t.node,{materialized:!0})})}ifNotExists(){return new it({...this.#t,node:r9.cloneWith(this.#t.node,{ifNotExists:!0})})}orReplace(){return new it({...this.#t,node:r9.cloneWith(this.#t.node,{orReplace:!0})})}columns(e){return new it({...this.#t,node:r9.cloneWith(this.#t.node,{columns:e.map(em)})})}as(e){let t=e.withPlugin(new ie).toOperationNode();return new it({...this.#t,node:r9.cloneWith(this.#t.node,{as:t})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}let ir=w({is:e=>"DropViewNode"===e.kind,create:e=>w({kind:"DropViewNode",name:T.create(e)}),cloneWith:(e,t)=>w({...e,...t})});class ii{#t;constructor(e){this.#t=w(e)}materialized(){return new ii({...this.#t,node:ir.cloneWith(this.#t.node,{materialized:!0})})}ifExists(){return new ii({...this.#t,node:ir.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new ii({...this.#t,node:ir.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}let io=w({is:e=>"CreateTypeNode"===e.kind,create:e=>w({kind:"CreateTypeNode",name:e}),cloneWithEnum:(e,t)=>w({...e,enum:ew.create(t.map(eg.createImmediate))})});class is{#t;constructor(e){this.#t=w(e)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}asEnum(e){return new is({...this.#t,node:io.cloneWithEnum(this.#t.node,e)})}$call(e){return e(this)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}let ia=w({is:e=>"DropTypeNode"===e.kind,create:e=>w({kind:"DropTypeNode",name:e}),cloneWith:(e,t)=>w({...e,...t})});class id{#t;constructor(e){this.#t=w(e)}ifExists(){return new id({...this.#t,node:ia.cloneWith(this.#t.node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}function ip(e){if(!e.includes("."))return T.create(e);{let t=e.split(".").map(ih);if(2===t.length)return T.createWithSchema(t[0],t[1]);throw Error(`invalid schemable identifier ${e}`)}}function ih(e){return e.trim()}let iu=w({is:e=>"RefreshMaterializedViewNode"===e.kind,create:e=>w({kind:"RefreshMaterializedViewNode",name:T.create(e)}),cloneWith:(e,t)=>w({...e,...t})});class ic{#t;constructor(e){this.#t=w(e)}concurrently(){return new ic({...this.#t,node:iu.cloneWith(this.#t.node,{concurrently:!0,withNoData:!1})})}withData(){return new ic({...this.#t,node:iu.cloneWith(this.#t.node,{withNoData:!1})})}withNoData(){return new ic({...this.#t,node:iu.cloneWith(this.#t.node,{withNoData:!0,concurrently:!1})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class il{#D;constructor(e){this.#D=e}createTable(e){return new r4({queryId:tO(),executor:this.#D,node:I.create(rx(e))})}dropTable(e){return new r5({queryId:tO(),executor:this.#D,node:D.create(rx(e))})}createIndex(e){return new r3({queryId:tO(),executor:this.#D,node:C.create(e)})}dropIndex(e){return new r6({queryId:tO(),executor:this.#D,node:S.create(e)})}createSchema(e){return new r8({queryId:tO(),executor:this.#D,node:q.create(e)})}dropSchema(e){return new r7({queryId:tO(),executor:this.#D,node:E.create(e)})}alterTable(e){return new r0({queryId:tO(),executor:this.#D,node:W.create(rx(e))})}createView(e){return new it({queryId:tO(),executor:this.#D,node:r9.create(e)})}refreshMaterializedView(e){return new ic({queryId:tO(),executor:this.#D,node:iu.create(e)})}dropView(e){return new ii({queryId:tO(),executor:this.#D,node:ir.create(e)})}createType(e){return new is({queryId:tO(),executor:this.#D,node:io.create(ip(e))})}dropType(e){return new id({queryId:tO(),executor:this.#D,node:ia.create(ip(e))})}withPlugin(e){return new il(this.#D.withPlugin(e))}withoutPlugins(){return new il(this.#D.withoutPlugins())}withSchema(e){return new il(this.#D.withPluginAtFront(new tS(e)))}}class im{ref(e){return new Y(e)}}class iN{#A;constructor(e){this.#A=e}async provideConnection(e){let t=await this.#A.acquireConnection();try{return await e(t)}finally{await this.#A.releaseConnection(t)}}}class iy extends tM{#L;#P;#B;constructor(e,t,r,i=[]){super(i),this.#L=e,this.#P=t,this.#B=r}get adapter(){return this.#P}compileQuery(e,t){return this.#L.compileQuery(e,t)}provideConnection(e){return this.#B.provideConnection(e)}withPlugins(e){return new iy(this.#L,this.#P,this.#B,[...this.plugins,...e])}withPlugin(e){return new iy(this.#L,this.#P,this.#B,[...this.plugins,e])}withPluginAtFront(e){return new iy(this.#L,this.#P,this.#B,[e,...this.plugins])}withConnectionProvider(e){return new iy(this.#L,this.#P,e,[...this.plugins])}withoutPlugins(){return new iy(this.#L,this.#P,this.#B,[])}}function iw(){return"undefined"!=typeof performance&&f(performance.now)?performance.now():Date.now()}class ig{#A;#M;#R;#Q;#F;#U=new WeakSet;constructor(e,t){this.#Q=!1,this.#A=e,this.#M=t}async init(){if(this.#F)throw Error("driver has already been destroyed");this.#R||(this.#R=this.#A.init().then(()=>{this.#Q=!0}).catch(e=>(this.#R=void 0,Promise.reject(e)))),await this.#R}async acquireConnection(){if(this.#F)throw Error("driver has already been destroyed");this.#Q||await this.init();let e=await this.#A.acquireConnection();return this.#U.has(e)||(this.#$()&&this.#_(e),this.#U.add(e)),e}async releaseConnection(e){await this.#A.releaseConnection(e)}beginTransaction(e,t){return this.#A.beginTransaction(e,t)}commitTransaction(e){return this.#A.commitTransaction(e)}rollbackTransaction(e){return this.#A.rollbackTransaction(e)}savepoint(e,t,r){if(this.#A.savepoint)return this.#A.savepoint(e,t,r);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(e,t,r){if(this.#A.rollbackToSavepoint)return this.#A.rollbackToSavepoint(e,t,r);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(e,t,r){if(this.#A.releaseSavepoint)return this.#A.releaseSavepoint(e,t,r);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#R&&(await this.#R,this.#F||(this.#F=this.#A.destroy().catch(e=>(this.#F=void 0,Promise.reject(e)))),await this.#F)}#$(){return this.#M.isLevelEnabled("query")||this.#M.isLevelEnabled("error")}#_(e){let t=e.executeQuery,r=e.streamQuery,i=this;e.executeQuery=async r=>{let n,o=iw();try{return await t.call(e,r)}catch(e){throw n=e,await i.#V(e,r,o),e}finally{n||await i.#j(r,o)}},e.streamQuery=async function*(t,n){let o,s=iw();try{for await(let i of r.call(e,t,n))yield i}catch(e){throw o=e,await i.#V(e,t,s),e}finally{o||await i.#j(t,s,!0)}}}async #V(e,t,r){await this.#M.error(()=>({level:"error",error:e,query:t,queryDurationMillis:this.#J(r)}))}async #j(e,t,r=!1){await this.#M.query(()=>({level:"query",isStream:r,query:e,queryDurationMillis:this.#J(t)}))}#J(e){return iw()-e}}let iv=()=>{};class ix{#K;#z;constructor(e){this.#K=e}async provideConnection(e){for(;this.#z;)await this.#z.catch(iv);return this.#z=this.#G(e).finally(()=>{this.#z=void 0}),this.#z}async #G(e){return await e(this.#K)}}let ib=["read only","read write"],iW=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function iO(e){if(e.accessMode&&!ib.includes(e.accessMode))throw Error(`invalid transaction access mode ${e.accessMode}`);if(e.isolationLevel&&!iW.includes(e.isolationLevel))throw Error(`invalid transaction isolation level ${e.isolationLevel}`)}w(["query","error"]);class iC{#Y;#H;constructor(e){f(e)?(this.#H=e,this.#Y=w({query:!0,error:!0})):(this.#H=iq,this.#Y=w({query:e.includes("query"),error:e.includes("error")}))}isLevelEnabled(e){return this.#Y[e]}async query(e){this.#Y.query&&await this.#H(e())}async error(e){this.#Y.error&&await this.#H(e())}}function iq(e){if("query"===e.level){let t=`kysely:query:${e.isStream?"stream:":""}`;console.log(`${t} ${e.query.sql}`),console.log(`${t} duration: ${e.queryDurationMillis.toFixed(1)}ms`)}else"error"===e.level&&(e.error instanceof Error?console.error(`kysely:error: ${e.error.stack??e.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:e.error,query:e.query.sql,queryDurationMillis:e.queryDurationMillis})}`))}Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class ik extends tj{#t;constructor(e){let t,r;if(function(e){return y(e)&&y(e.config)&&y(e.driver)&&y(e.executor)&&y(e.dialect)}(e))t={executor:e.executor},r={...e};else{const i=e.dialect,n=i.createDriver(),o=i.createQueryCompiler(),s=i.createAdapter(),a=new ig(n,new iC(e.log??[])),d=new iy(o,s,new iN(a),e.plugins??[]);t={executor:d},r={config:e,executor:d,dialect:i,driver:a}}super(t),this.#t=w(r)}get schema(){return new il(this.#t.executor)}get dynamic(){return new im}get introspection(){return this.#t.dialect.createIntrospector(this.withoutPlugins())}case(e){return new re({node:t9.create(u(e)?void 0:rN(e))})}get fn(){return t7()}transaction(){return new iS({...this.#t})}startTransaction(){return new iE({...this.#t})}connection(){return new iT({...this.#t})}withPlugin(e){return new ik({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new ik({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new ik({...this.#t,executor:this.#t.executor.withPluginAtFront(new tS(e))})}withTables(){return new ik({...this.#t})}async destroy(){await this.#t.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#t.executor}executeQuery(e,t=tO()){let r=y(e)&&f(e.compile)?e.compile():e;return this.getExecutor().executeQuery(r,t)}async [Symbol.asyncDispose](){await this.destroy()}}class iI extends ik{#t;constructor(e){super(e),this.#t=e}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(e){return new iI({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new iI({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new iI({...this.#t,executor:this.#t.executor.withPluginAtFront(new tS(e))})}withTables(){return new iI({...this.#t})}}class iT{#t;constructor(e){this.#t=w(e)}async execute(e){return this.#t.executor.provideConnection(async t=>{let r=this.#t.executor.withConnectionProvider(new ix(t)),i=new ik({...this.#t,executor:r});return await e(i)})}}class iS{#t;constructor(e){this.#t=w(e)}setAccessMode(e){return new iS({...this.#t,accessMode:e})}setIsolationLevel(e){return new iS({...this.#t,isolationLevel:e})}async execute(e){let{isolationLevel:t,accessMode:r,...i}=this.#t,n={isolationLevel:t,accessMode:r};return iO(n),this.#t.executor.provideConnection(async t=>{let r=this.#t.executor.withConnectionProvider(new ix(t)),o=new iI({...i,executor:r});try{await this.#t.driver.beginTransaction(t,n);let r=await e(o);return await this.#t.driver.commitTransaction(t),r}catch(e){throw await this.#t.driver.rollbackTransaction(t),e}})}}class iE{#t;constructor(e){this.#t=w(e)}setAccessMode(e){return new iE({...this.#t,accessMode:e})}setIsolationLevel(e){return new iE({...this.#t,isolationLevel:e})}async execute(){let{isolationLevel:e,accessMode:t,...r}=this.#t,i={isolationLevel:e,accessMode:t};iO(i);let n=await tP(this.#t.executor);return await this.#t.driver.beginTransaction(n.connection,i),new iD({...r,connection:n,executor:this.#t.executor.withConnectionProvider(new ix(n.connection))})}}class iD extends iI{#t;#X;#Z;constructor(e){const t={isCommitted:!1,isRolledBack:!1},{connection:r,...i}=e={...e,executor:new iP(e.executor,t)};super(i),this.#t=w(e),this.#Z=t;const n=tO();this.#X=t=>e.executor.compileQuery(t,n)}get isCommitted(){return this.#Z.isCommitted}get isRolledBack(){return this.#Z.isRolledBack}commit(){return iL(this.#Z),new iA(async()=>{await this.#t.driver.commitTransaction(this.#t.connection.connection),this.#Z.isCommitted=!0,this.#t.connection.release()})}rollback(){return iL(this.#Z),new iA(async()=>{await this.#t.driver.rollbackTransaction(this.#t.connection.connection),this.#Z.isRolledBack=!0,this.#t.connection.release()})}savepoint(e){return iL(this.#Z),new iA(async()=>(await this.#t.driver.savepoint?.(this.#t.connection.connection,e,this.#X),new iD({...this.#t})))}rollbackToSavepoint(e){return iL(this.#Z),new iA(async()=>(await this.#t.driver.rollbackToSavepoint?.(this.#t.connection.connection,e,this.#X),new iD({...this.#t})))}releaseSavepoint(e){return iL(this.#Z),new iA(async()=>(await this.#t.driver.releaseSavepoint?.(this.#t.connection.connection,e,this.#X),new iD({...this.#t})))}withPlugin(e){return new iD({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new iD({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new iD({...this.#t,executor:this.#t.executor.withPluginAtFront(new tS(e))})}withTables(){return new iD({...this.#t})}}class iA{#ee;constructor(e){this.#ee=e}async execute(){return await this.#ee()}}function iL(e){if(e.isCommitted)throw Error("Transaction is already committed");if(e.isRolledBack)throw Error("Transaction is already rolled back")}class iP{#D;#Z;constructor(e,t){e instanceof iP?this.#D=e.#D:this.#D=e,this.#Z=t}get adapter(){return this.#D.adapter}get plugins(){return this.#D.plugins}transformQuery(e,t){return this.#D.transformQuery(e,t)}compileQuery(e,t){return this.#D.compileQuery(e,t)}provideConnection(e){return this.#D.provideConnection(e)}executeQuery(e,t){return iL(this.#Z),this.#D.executeQuery(e,t)}stream(e,t,r){return iL(this.#Z),this.#D.stream(e,t,r)}withConnectionProvider(e){return new iP(this.#D.withConnectionProvider(e),this.#Z)}withPlugin(e){return new iP(this.#D.withPlugin(e),this.#Z)}withPlugins(e){return new iP(this.#D.withPlugins(e),this.#Z)}withPluginAtFront(e){return new iP(this.#D.withPluginAtFront(e),this.#Z)}withoutPlugins(){return new iP(this.#D.withoutPlugins(),this.#Z)}}function iB(e,t){return Z.createWithChildren([Z.createWithSql(`${e} `),O.create(t)])}let iM=w({raw:(e,t=[])=>w({sql:e,query:Z.createWithSql(e),parameters:w(t),queryId:tO()})}),iR=Symbol();class iQ{#et;#U=new WeakMap;#er;constructor(e){this.#et=w({...e})}async init(){this.#er=f(this.#et.pool)?await this.#et.pool():this.#et.pool}async acquireConnection(){let e=await this.#er.connect(),t=this.#U.get(e);return!t&&(t=new iF(e,{cursor:this.#et.cursor??null}),this.#U.set(e,t),this.#et.onCreateConnection&&await this.#et.onCreateConnection(t)),this.#et.onReserveConnection&&await this.#et.onReserveConnection(t),t}async beginTransaction(e,t){if(t.isolationLevel||t.accessMode){let r="start transaction";t.isolationLevel&&(r+=` isolation level ${t.isolationLevel}`),t.accessMode&&(r+=` ${t.accessMode}`),await e.executeQuery(iM.raw(r))}else await e.executeQuery(iM.raw("begin"))}async commitTransaction(e){await e.executeQuery(iM.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(iM.raw("rollback"))}async savepoint(e,t,r){await e.executeQuery(r(iB("savepoint",t),tO()))}async rollbackToSavepoint(e,t,r){await e.executeQuery(r(iB("rollback to",t),tO()))}async releaseSavepoint(e,t,r){await e.executeQuery(r(iB("release",t),tO()))}async releaseConnection(e){e[iR]()}async destroy(){if(this.#er){let e=this.#er;this.#er=void 0,await e.end()}}}class iF{#ei;#en;constructor(e,t){this.#ei=e,this.#en=t}async executeQuery(e){try{let{command:t,rowCount:r,rows:i}=await this.#ei.query(e.sql,[...e.parameters]);return{numAffectedRows:"INSERT"===t||"UPDATE"===t||"DELETE"===t||"MERGE"===t?BigInt(r):void 0,rows:i??[]}}catch(e){throw function(e,t){var r;if(y(r=e)&&c(r.stack)&&t.stack){let r=t.stack.split("\n").slice(1).join("\n");e.stack+=`
${r}`}return e}(e,Error())}}async *streamQuery(e,t){if(!this.#en.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(t)||t<=0)throw Error("chunkSize must be a positive integer");let r=this.#ei.query(new this.#en.cursor(e.sql,e.parameters.slice()));try{for(;;){let e=await r.read(t);if(0===e.length)break;yield{rows:e}}}finally{await r.close()}}[iR](){this.#ei.release()}}w({__noMigrations__:!0});class iU{#t;constructor(e){this.#t=w(e)}get expressionType(){}get isRawBuilder(){return!0}as(e){return new i_(this,e)}$castTo(){return new iU({...this.#t})}$notNull(){return new iU(this.#t)}withPlugin(e){return new iU({...this.#t,plugins:void 0!==this.#t.plugins?w([...this.#t.plugins,e]):w([e])})}toOperationNode(){return this.#eo(this.#es())}compile(e){return this.#ea(this.#es(e))}async execute(e){let t=this.#es(e);return t.executeQuery(this.#ea(t),this.#t.queryId)}#es(e){let t=void 0!==e?e.getExecutor():tQ;return void 0!==this.#t.plugins?t.withPlugins(this.#t.plugins):t}#eo(e){return e.transformQuery(this.#t.rawNode,this.#t.queryId)}#ea(e){return e.compileQuery(this.#eo(e),this.#t.queryId)}}function i$(e){return new iU(e)}class i_{#ed;#C;constructor(e,t){this.#ed=e,this.#C=t}get expression(){return this.#ed}get alias(){return this.#C}get rawBuilder(){return this.#ed}toOperationNode(){return A.create(this.#ed.toOperationNode(),P(this.#C)?this.#C.toOperationNode():O.create(this.#C))}}let iV=Object.assign((e,...t)=>i$({queryId:tO(),rawNode:Z.create(e,t?.map(ij)??[])}),{ref:e=>i$({queryId:tO(),rawNode:Z.createWithChild(el(e))}),val:e=>i$({queryId:tO(),rawNode:Z.createWithChild(ev(e))}),value(e){return this.val(e)},table:e=>i$({queryId:tO(),rawNode:Z.createWithChild(rx(e))}),id(...e){let t=Array(e.length+1).fill(".");return t[0]="",t[t.length-1]="",i$({queryId:tO(),rawNode:Z.create(t,e.map(O.create))})},lit:e=>i$({queryId:tO(),rawNode:Z.createWithChild(eg.createImmediate(e))}),literal(e){return this.lit(e)},raw:e=>i$({queryId:tO(),rawNode:Z.createWithSql(e)}),join(e,t=iV`, `){let r=Array(Math.max(2*e.length-1,0)),i=t.toOperationNode();for(let t=0;t<e.length;++t)r[2*t]=ij(e[t]),t!==e.length-1&&(r[2*t+1]=i);return i$({queryId:tO(),rawNode:Z.createWithChildren(r)})}});function ij(e){return P(e)?e.toOperationNode():ev(e)}e.s(["sql",0,iV],705590);class iJ{#ep;constructor(e){this.#ep=e}async getSchemas(){return(await this.#ep.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(e=>({name:e.nspname}))}async getTables(e={withInternalKyselyTables:!1}){let t=this.#ep.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",iV`col_description(a.attrelid, a.attnum)`.as("column_description"),iV`pg_get_serial_sequence(ns.nspname || '.' || c.relname, a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();e.withInternalKyselyTables||(t=t.where("c.relname","!=","kysely_migration").where("c.relname","!=","kysely_migration_lock"));let r=await t.execute();return this.#eh(r)}async getMetadata(e){return{tables:await this.getTables(e)}}#eh(e){return e.reduce((e,t)=>{let r=e.find(e=>e.name===t.table&&e.schema===t.schema);return r||(r=w({name:t.table,isView:"v"===t.table_type,schema:t.schema,columns:[]}),e.push(r)),r.columns.push(w({name:t.column,dataType:t.type,dataTypeSchema:t.type_schema,isNullable:!t.not_null,isAutoIncrementing:null!==t.auto_incrementing,hasDefaultValue:t.has_default,comment:t.column_description??void 0})),e},[])}}class iK{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#eu=w({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)});visitNode=e=>{this.nodeStack.push(e),this.#eu[e.kind](e),this.nodeStack.pop()}}let iz=/'/g;class iG extends iK{#ec="";#el=[];get numParameters(){return this.#el.length}compileQuery(e,t){return this.#ec="",this.#el=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(e),w({query:e,queryId:t,sql:this.getSql(),parameters:[...this.#el]})}getSql(){return this.#ec}visitSelectQuery(e){let t=void 0!==this.parentNode&&!eW.is(this.parentNode)&&!eR.is(this.parentNode)&&!I.is(this.parentNode)&&!r9.is(this.parentNode)&&!tG.is(this.parentNode);void 0===this.parentNode&&e.explain&&(this.visitNode(e.explain),this.append(" ")),t&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("select"),e.distinctOn&&(this.append(" "),this.compileDistinctOn(e.distinctOn)),e.frontModifiers?.length&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.top&&(this.append(" "),this.visitNode(e.top)),e.selections&&(this.append(" "),this.compileList(e.selections)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.groupBy&&(this.append(" "),this.visitNode(e.groupBy)),e.having&&(this.append(" "),this.visitNode(e.having)),e.setOperations&&(this.append(" "),this.compileList(e.setOperations," ")),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.offset&&(this.append(" "),this.visitNode(e.offset)),e.fetch&&(this.append(" "),this.visitNode(e.fetch)),e.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...e.endModifiers])," ")),t&&this.append(")")}visitFrom(e){this.append("from "),this.compileList(e.froms)}visitSelection(e){this.visitNode(e.selection)}visitColumn(e){this.visitNode(e.column)}compileDistinctOn(e){this.append("distinct on ("),this.compileList(e),this.append(")")}compileList(e,t=", "){let r=e.length-1;for(let i=0;i<=r;i++)this.visitNode(e[i]),i<r&&this.append(t)}visitWhere(e){this.append("where "),this.visitNode(e.where)}visitHaving(e){this.append("having "),this.visitNode(e.having)}visitInsertQuery(e){let t=this.nodeStack.find(eG.is),r=t!==e;!r&&e.explain&&(this.visitNode(e.explain),this.append(" ")),r&&!eK.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append(e.replace?"replace":"insert"),e.ignore&&(er("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),e.orAction&&(this.append(" "),this.visitNode(e.orAction)),e.top&&(this.append(" "),this.visitNode(e.top)),e.into&&(this.append(" into "),this.visitNode(e.into)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.output&&(this.append(" "),this.visitNode(e.output)),e.values&&(this.append(" "),this.visitNode(e.values)),e.defaultValues&&(this.append(" "),this.append("default values")),e.onConflict&&(this.append(" "),this.visitNode(e.onConflict)),e.onDuplicateKey&&(this.append(" "),this.visitNode(e.onDuplicateKey)),e.returning&&(this.append(" "),this.visitNode(e.returning)),r&&!eK.is(t)&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitValues(e){this.append("values "),this.compileList(e.values)}visitDeleteQuery(e){let t=this.nodeStack.find(eG.is)!==e;!t&&e.explain&&(this.visitNode(e.explain),this.append(" ")),t&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("delete "),e.top&&(this.visitNode(e.top),this.append(" ")),this.visitNode(e.from),e.output&&(this.append(" "),this.visitNode(e.output)),e.using&&(this.append(" "),this.visitNode(e.using)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),t&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitReturning(e){this.append("returning "),this.compileList(e.selections)}visitAlias(e){this.visitNode(e.node),this.append(" as "),this.visitNode(e.alias)}visitReference(e){e.table&&(this.visitNode(e.table),this.append(".")),this.visitNode(e.column)}visitSelectAll(e){this.append("*")}visitIdentifier(e){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(e),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(e){if(!c(e.name))throw Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(e.name))}visitAnd(e){this.visitNode(e.left),this.append(" and "),this.visitNode(e.right)}visitOr(e){this.visitNode(e.left),this.append(" or "),this.visitNode(e.right)}visitValue(e){e.immediate?this.appendImmediateValue(e.value):this.appendValue(e.value)}visitValueList(e){this.append("("),this.compileList(e.values),this.append(")")}visitTuple(e){this.append("("),this.compileList(e.values),this.append(")")}visitPrimitiveValueList(e){this.append("(");let{values:t}=e;for(let e=0;e<t.length;++e)this.appendValue(t[e]),e!==t.length-1&&this.append(", ");this.append(")")}visitParens(e){this.append("("),this.visitNode(e.node),this.append(")")}visitJoin(e){this.append(iX[e.joinType]),this.append(" "),this.visitNode(e.table),e.on&&(this.append(" "),this.visitNode(e.on))}visitOn(e){this.append("on "),this.visitNode(e.on)}visitRaw(e){let{sqlFragments:t,parameters:r}=e;for(let e=0;e<t.length;++e)this.append(t[e]),r.length>e&&this.visitNode(r[e])}visitOperator(e){this.append(e.operator)}visitTable(e){this.visitNode(e.table)}visitSchemableIdentifier(e){e.schema&&(this.visitNode(e.schema),this.append(".")),this.visitNode(e.identifier)}visitCreateTable(e){this.append("create "),e.frontModifiers&&e.frontModifiers.length>0&&(this.compileList(e.frontModifiers," "),this.append(" ")),e.temporary&&this.append("temporary "),this.append("table "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.table),e.selectQuery?(this.append(" as "),this.visitNode(e.selectQuery)):(this.append(" ("),this.compileList([...e.columns,...e.constraints??[]]),this.append(")"),e.onCommit&&(this.append(" on commit "),this.append(e.onCommit)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," ")))}visitColumnDefinition(e){e.ifNotExists&&this.append("if not exists "),this.visitNode(e.column),this.append(" "),this.visitNode(e.dataType),e.unsigned&&this.append(" unsigned"),e.frontModifiers&&e.frontModifiers.length>0&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.generated&&(this.append(" "),this.visitNode(e.generated)),e.identity&&this.append(" identity"),e.defaultTo&&(this.append(" "),this.visitNode(e.defaultTo)),e.notNull&&this.append(" not null"),e.unique&&this.append(" unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.primaryKey&&this.append(" primary key"),e.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),e.references&&(this.append(" "),this.visitNode(e.references)),e.check&&(this.append(" "),this.visitNode(e.check)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(e){this.append("references "),this.visitNode(e.table),this.append(" ("),this.compileList(e.columns),this.append(")"),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate))}visitDropTable(e){this.append("drop table "),e.ifExists&&this.append("if exists "),this.visitNode(e.table),e.cascade&&this.append(" cascade")}visitDataType(e){this.append(e.dataType)}visitOrderBy(e){this.append("order by "),this.compileList(e.items)}visitOrderByItem(e){this.visitNode(e.orderBy),e.collation&&(this.append(" "),this.visitNode(e.collation)),e.direction&&(this.append(" "),this.visitNode(e.direction)),e.nulls&&(this.append(" nulls "),this.append(e.nulls))}visitGroupBy(e){this.append("group by "),this.compileList(e.items)}visitGroupByItem(e){this.visitNode(e.groupBy)}visitUpdateQuery(e){let t=this.nodeStack.find(eG.is),r=t!==e;if(!r&&e.explain&&(this.visitNode(e.explain),this.append(" ")),r&&!eK.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("update "),e.top&&(this.visitNode(e.top),this.append(" ")),e.table&&(this.visitNode(e.table),this.append(" ")),this.append("set "),e.updates&&this.compileList(e.updates),e.output&&(this.append(" "),this.visitNode(e.output)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins){if(!e.from)throw Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(e.joins," ")}e.where&&(this.append(" "),this.visitNode(e.where)),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),r&&!eK.is(t)&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitColumnUpdate(e){this.visitNode(e.column),this.append(" = "),this.visitNode(e.value)}visitLimit(e){this.append("limit "),this.visitNode(e.limit)}visitOffset(e){this.append("offset "),this.visitNode(e.offset)}visitOnConflict(e){this.append("on conflict"),e.columns?(this.append(" ("),this.compileList(e.columns),this.append(")")):e.constraint?(this.append(" on constraint "),this.visitNode(e.constraint)):e.indexExpression&&(this.append(" ("),this.visitNode(e.indexExpression),this.append(")")),e.indexWhere&&(this.append(" "),this.visitNode(e.indexWhere)),!0===e.doNothing?this.append(" do nothing"):e.updates&&(this.append(" do update set "),this.compileList(e.updates),e.updateWhere&&(this.append(" "),this.visitNode(e.updateWhere)))}visitOnDuplicateKey(e){this.append("on duplicate key update "),this.compileList(e.updates)}visitCreateIndex(e){this.append("create "),e.unique&&this.append("unique "),this.append("index "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.using&&(this.append(" using "),this.visitNode(e.using)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.where&&(this.append(" "),this.visitNode(e.where))}visitDropIndex(e){this.append("drop index "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.cascade&&this.append(" cascade")}visitCreateSchema(e){this.append("create schema "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.schema)}visitDropSchema(e){this.append("drop schema "),e.ifExists&&this.append("if exists "),this.visitNode(e.schema),e.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("primary key ("),this.compileList(e.columns),this.append(")"),this.buildDeferrable(e)}buildDeferrable(e){void 0!==e.deferrable&&(e.deferrable?this.append(" deferrable"):this.append(" not deferrable")),void 0!==e.initiallyDeferred&&(e.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(e.columns),this.append(")"),this.buildDeferrable(e)}visitCheckConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("check ("),this.visitNode(e.expression),this.append(")")}visitForeignKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("foreign key ("),this.compileList(e.columns),this.append(") "),this.visitNode(e.references),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate)),this.buildDeferrable(e)}visitList(e){this.compileList(e.items)}visitWith(e){this.append("with "),e.recursive&&this.append("recursive "),this.compileList(e.expressions)}visitCommonTableExpression(e){this.visitNode(e.name),this.append(" as "),m(e.materialized)&&(e.materialized||this.append("not "),this.append("materialized ")),this.visitNode(e.expression)}visitCommonTableExpressionName(e){this.visitNode(e.table),e.columns&&(this.append("("),this.compileList(e.columns),this.append(")"))}visitAlterTable(e){this.append("alter table "),this.visitNode(e.table),this.append(" "),e.renameTo&&(this.append("rename to "),this.visitNode(e.renameTo)),e.setSchema&&(this.append("set schema "),this.visitNode(e.setSchema)),e.addConstraint&&this.visitNode(e.addConstraint),e.dropConstraint&&this.visitNode(e.dropConstraint),e.renameConstraint&&this.visitNode(e.renameConstraint),e.columnAlterations&&this.compileColumnAlterations(e.columnAlterations),e.addIndex&&this.visitNode(e.addIndex),e.dropIndex&&this.visitNode(e.dropIndex)}visitAddColumn(e){this.append("add column "),this.visitNode(e.column)}visitRenameColumn(e){this.append("rename column "),this.visitNode(e.column),this.append(" to "),this.visitNode(e.renameTo)}visitDropColumn(e){this.append("drop column "),this.visitNode(e.column)}visitAlterColumn(e){this.append("alter column "),this.visitNode(e.column),this.append(" "),e.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(e.dataType),e.dataTypeExpression&&(this.append("using "),this.visitNode(e.dataTypeExpression))),e.setDefault&&(this.append("set default "),this.visitNode(e.setDefault)),e.dropDefault&&this.append("drop default"),e.setNotNull&&this.append("set not null"),e.dropNotNull&&this.append("drop not null")}visitModifyColumn(e){this.append("modify column "),this.visitNode(e.column)}visitAddConstraint(e){this.append("add "),this.visitNode(e.constraint)}visitDropConstraint(e){this.append("drop constraint "),e.ifExists&&this.append("if exists "),this.visitNode(e.constraintName),"cascade"===e.modifier?this.append(" cascade"):"restrict"===e.modifier&&this.append(" restrict")}visitRenameConstraint(e){this.append("rename constraint "),this.visitNode(e.oldName),this.append(" to "),this.visitNode(e.newName)}visitSetOperation(e){this.append(e.operator),this.append(" "),e.all&&this.append("all "),this.visitNode(e.expression)}visitCreateView(e){this.append("create "),e.orReplace&&this.append("or replace "),e.materialized&&this.append("materialized "),e.temporary&&this.append("temporary "),this.append("view "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),this.append(" "),e.columns&&(this.append("("),this.compileList(e.columns),this.append(") ")),e.as&&(this.append("as "),this.visitNode(e.as))}visitRefreshMaterializedView(e){this.append("refresh materialized view "),e.concurrently&&this.append("concurrently "),this.visitNode(e.name),e.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(e){this.append("drop "),e.materialized&&this.append("materialized "),this.append("view "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.cascade&&this.append(" cascade")}visitGenerated(e){this.append("generated "),e.always&&this.append("always "),e.byDefault&&this.append("by default "),this.append("as "),e.identity&&this.append("identity"),e.expression&&(this.append("("),this.visitNode(e.expression),this.append(")")),e.stored&&this.append(" stored")}visitDefaultValue(e){this.append("default "),this.visitNode(e.defaultValue)}visitSelectModifier(e){e.rawModifier?this.visitNode(e.rawModifier):this.append(iY[e.modifier]),e.of&&(this.append(" of "),this.compileList(e.of,", "))}visitCreateType(e){this.append("create type "),this.visitNode(e.name),e.enum&&(this.append(" as enum "),this.visitNode(e.enum))}visitDropType(e){this.append("drop type "),e.ifExists&&this.append("if exists "),this.visitNode(e.name)}visitExplain(e){this.append("explain"),(e.options||e.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),e.options&&(this.visitNode(e.options),e.format&&this.append(this.getExplainOptionsDelimiter())),e.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(e.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(e){this.append("default")}visitAggregateFunction(e){this.append(e.func),this.append("("),e.distinct&&this.append("distinct "),this.compileList(e.aggregated),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),this.append(")"),e.withinGroup&&(this.append(" within group ("),this.visitNode(e.withinGroup),this.append(")")),e.filter&&(this.append(" filter("),this.visitNode(e.filter),this.append(")")),e.over&&(this.append(" "),this.visitNode(e.over))}visitOver(e){this.append("over("),e.partitionBy&&(this.visitNode(e.partitionBy),e.orderBy&&this.append(" ")),e.orderBy&&this.visitNode(e.orderBy),this.append(")")}visitPartitionBy(e){this.append("partition by "),this.compileList(e.items)}visitPartitionByItem(e){this.visitNode(e.partitionBy)}visitBinaryOperation(e){this.visitNode(e.leftOperand),this.append(" "),this.visitNode(e.operator),this.append(" "),this.visitNode(e.rightOperand)}visitUnaryOperation(e){this.visitNode(e.operator),this.isMinusOperator(e.operator)||this.append(" "),this.visitNode(e.operand)}isMinusOperator(e){return j.is(e)&&"-"===e.operator}visitUsing(e){this.append("using "),this.compileList(e.tables)}visitFunction(e){this.append(e.func),this.append("("),this.compileList(e.arguments),this.append(")")}visitCase(e){this.append("case"),e.value&&(this.append(" "),this.visitNode(e.value)),e.when&&(this.append(" "),this.compileList(e.when," ")),e.else&&(this.append(" else "),this.visitNode(e.else)),this.append(" end"),e.isStatement&&this.append(" case")}visitWhen(e){this.append("when "),this.visitNode(e.condition),e.result&&(this.append(" then "),this.visitNode(e.result))}visitJSONReference(e){this.visitNode(e.reference),this.visitNode(e.traversal)}visitJSONPath(e){for(let t of(e.inOperator&&this.visitNode(e.inOperator),this.append("'$"),e.pathLegs))this.visitNode(t);this.append("'")}visitJSONPathLeg(e){let t="ArrayLocation"===e.type;this.append(t?"[":"."),this.append(String(e.value)),t&&this.append("]")}visitJSONOperatorChain(e){for(let t=0,r=e.values.length;t<r;t++)t===r-1?this.visitNode(e.operator):this.append("->"),this.visitNode(e.values[t])}visitMergeQuery(e){e.with&&(this.visitNode(e.with),this.append(" ")),this.append("merge "),e.top&&(this.visitNode(e.top),this.append(" ")),this.append("into "),this.visitNode(e.into),e.using&&(this.append(" "),this.visitNode(e.using)),e.whens&&(this.append(" "),this.compileList(e.whens," ")),e.returning&&(this.append(" "),this.visitNode(e.returning)),e.output&&(this.append(" "),this.visitNode(e.output)),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitMatched(e){e.not&&this.append("not "),this.append("matched"),e.bySource&&this.append(" by source")}visitAddIndex(e){this.append("add "),e.unique&&this.append("unique "),this.append("index "),this.visitNode(e.name),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.using&&(this.append(" using "),this.visitNode(e.using))}visitCast(e){this.append("cast("),this.visitNode(e.expression),this.append(" as "),this.visitNode(e.dataType),this.append(")")}visitFetch(e){this.append("fetch next "),this.visitNode(e.rowCount),this.append(` rows ${e.modifier}`)}visitOutput(e){this.append("output "),this.compileList(e.selections)}visitTop(e){this.append(`top(${e.expression})`),e.modifiers&&this.append(` ${e.modifiers}`)}visitOrAction(e){this.append(e.action)}visitCollate(e){this.append("collate "),this.visitNode(e.collation)}append(e){this.#ec+=e}appendValue(e){this.addParameter(e),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(e){let t=this.getLeftIdentifierWrapper(),r=this.getRightIdentifierWrapper(),i="";for(let n of e)i+=n,n===t?i+=t:n===r&&(i+=r);return i}sanitizeStringLiteral(e){return e.replace(iz,"''")}addParameter(e){this.#el.push(e)}appendImmediateValue(e){if(c(e))this.appendStringLiteral(e);else if(l(e)||m(e))this.append(e.toString());else if(null===e)this.append("null");else if(e instanceof Date)this.appendImmediateValue(e.toISOString());else if(N(e))this.appendImmediateValue(e.toString());else throw Error(`invalid immediate value ${e}`)}appendStringLiteral(e){this.append("'"),this.append(this.sanitizeStringLiteral(e)),this.append("'")}sortSelectModifiers(e){return e.sort((e,t)=>e.modifier&&t.modifier?iH[e.modifier]-iH[t.modifier]:1),w(e)}compileColumnAlterations(e){this.compileList(e)}announcesNewColumnDataType(){return!0}}let iY=w({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),iH=w({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),iX=w({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"}),iZ=/"/g;class i0 extends iG{sanitizeIdentifier(e){return e.replace(iZ,'""')}}class i1{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}let i2=BigInt("3853314791062309107");class i3 extends i1{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(e,t){await iV`select pg_advisory_xact_lock(${iV.lit(i2)})`.execute(e)}async releaseMigrationLock(e,t){}}class i8{#et;constructor(e){this.#et=e}createDriver(){return new iQ(this.#et)}createQueryCompiler(){return new i0}createAdapter(){return new i3}createIntrospector(e){return new iJ(e)}}class i4 extends tq{#em;constructor(e){super(),this.#em=e}transformIdentifier(e,t){return{...e=super.transformIdentifier(e,t),name:this.#em(e.name)}}}function i6(e){return e>="0"&&e<="9"}function i7(e){let t=new Map;return r=>{let i=t.get(r);return i||(i=e(r),t.set(r,i)),i}}class i5{opt;#eN;#em;#ef;constructor(e={}){this.opt=e,this.#eN=function({upperCase:e=!1}={}){return i7(t=>{if(0===t.length)return t;e&&function(e){for(let t=1,r=e.length;t<r;++t){let r=e[t];if("_"!==r&&r!==r.toUpperCase())return!1}return!0}(t)&&(t=t.toLowerCase());let r=t[0];for(let e=1,i=t.length;e<i;++e){let i=t[e],n=t[e-1];"_"!==i&&("_"===n?r+=i.toUpperCase():r+=i)}return r})}(e),this.#em=function({upperCase:e=!1,underscoreBeforeDigits:t=!1,underscoreBetweenUppercaseLetters:r=!1}={}){return i7(i=>{if(0===i.length)return i;let n=i.toUpperCase(),o=i.toLowerCase(),s=o[0];for(let e=1,a=i.length;e<a;++e){let a=i[e],d=i[e-1],p=n[e],h=n[e-1],u=o[e],c=o[e-1];if(t&&i6(a)&&!i6(d)&&!s.endsWith("_")){s+="_"+a;continue}if(a===p&&p!==u){let e=d===h&&h!==c;r||!e?s+="_"+u:s+=u}else s+=a}return e?s.toUpperCase():s})}(e),this.#ef=new i4(this.snakeCase.bind(this))}transformQuery(e){return this.#ef.transformNode(e.node,e.queryId)}async transformResult(e){return e.result.rows&&Array.isArray(e.result.rows)?{...e.result,rows:e.result.rows.map(e=>this.mapRow(e))}:e.result}mapRow(e){return Object.keys(e).reduce((t,r)=>{let i=e[r];return Array.isArray(i)?i=i.map(e=>i9(e,this.opt)?this.mapRow(e):e):i9(i,this.opt)&&(i=this.mapRow(i)),t[this.camelCase(r)]=i,t},{})}snakeCase(e){return this.#em(e)}camelCase(e){return this.#eN(e)}}function i9(e,t){return function(e){var t;if(!y(e)||"[object Object]"!==(null==(t=e)?void 0===t?"[object Undefined]":"[object Null]":b.call(t)))return!1;if(null===Object.getPrototypeOf(e))return!0;let r=e;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}(e)&&!t?.maintainNestedObjectKeys}var ne=e.i(967255);let nt=new Map,nr=new Map,{databaseUrl:ni}=s(),nn=function(e){if(nr.has(e))return nr.get(e);let t=nt.get(e);t||(t=new ne.Pool({connectionString:e,max:10}),nt.set(e,t));let r=new ik({dialect:new i8({pool:t}),plugins:[new i5]});return nr.set(e,r),r}(ni);(t=nt.get(ni))||(t=new ne.Pool({connectionString:ni,max:10}),nt.set(ni,t)),e.s(["postgresDb",0,nn],36480);class no{db;constructor(e=nn){this.db=e}}e.s(["BaseRepository",()=>no],46308)}];

//# sourceMappingURL=_4b2c80d5._.js.map