module.exports=[46308,705590,36480,e=>{"use strict";let t;e.i(791146);var r=e.i(832821);function i(e){return void 0===e||void 0===e}function n(e){return"string"==typeof e}function o(e){return"number"==typeof e}function s(e){return"boolean"==typeof e}function a(e){return"bigint"==typeof e}function d(e){return"function"==typeof e}function p(e){return"object"==typeof e&&null!==e}function h(e){return Object.freeze(e)}function u(e){return c(e)?e:[e]}function c(e){return Array.isArray(e)}function l(e){return e}let m=Object.prototype.toString,N=h({is:e=>"AlterTableNode"===e.kind,create:e=>h({kind:"AlterTableNode",table:e}),cloneWithTableProps:(e,t)=>h({...e,...t}),cloneWithColumnAlteration:(e,t)=>h({...e,columnAlterations:e.columnAlterations?[...e.columnAlterations,t]:[t]})}),f=h({is:e=>"IdentifierNode"===e.kind,create:e=>h({kind:"IdentifierNode",name:e})}),y=h({is:e=>"CreateIndexNode"===e.kind,create:e=>h({kind:"CreateIndexNode",name:f.create(e)}),cloneWith:(e,t)=>h({...e,...t}),cloneWithColumns:(e,t)=>h({...e,columns:[...e.columns||[],...t]})}),w=h({is:e=>"CreateSchemaNode"===e.kind,create:(e,t)=>h({kind:"CreateSchemaNode",schema:f.create(e),...t}),cloneWith:(e,t)=>h({...e,...t})}),g=["preserve rows","delete rows","drop"],v=h({is:e=>"CreateTableNode"===e.kind,create:e=>h({kind:"CreateTableNode",table:e,columns:h([])}),cloneWithColumn:(e,t)=>h({...e,columns:h([...e.columns,t])}),cloneWithConstraint:(e,t)=>h({...e,constraints:e.constraints?h([...e.constraints,t]):h([t])}),cloneWithFrontModifier:(e,t)=>h({...e,frontModifiers:e.frontModifiers?h([...e.frontModifiers,t]):h([t])}),cloneWithEndModifier:(e,t)=>h({...e,endModifiers:e.endModifiers?h([...e.endModifiers,t]):h([t])}),cloneWith:(e,t)=>h({...e,...t})}),x=h({is:e=>"SchemableIdentifierNode"===e.kind,create:e=>h({kind:"SchemableIdentifierNode",identifier:f.create(e)}),createWithSchema:(e,t)=>h({kind:"SchemableIdentifierNode",schema:f.create(e),identifier:f.create(t)})}),b=h({is:e=>"DropIndexNode"===e.kind,create:(e,t)=>h({kind:"DropIndexNode",name:x.create(e),...t}),cloneWith:(e,t)=>h({...e,...t})}),W=h({is:e=>"DropSchemaNode"===e.kind,create:(e,t)=>h({kind:"DropSchemaNode",schema:f.create(e),...t}),cloneWith:(e,t)=>h({...e,...t})}),O=h({is:e=>"DropTableNode"===e.kind,create:(e,t)=>h({kind:"DropTableNode",table:e,...t}),cloneWith:(e,t)=>h({...e,...t})}),C=h({is:e=>"AliasNode"===e.kind,create:(e,t)=>h({kind:"AliasNode",node:e,alias:t})}),q=h({is:e=>"TableNode"===e.kind,create:e=>h({kind:"TableNode",table:x.create(e)}),createWithSchema:(e,t)=>h({kind:"TableNode",table:x.createWithSchema(e,t)})});function k(e){return p(e)&&d(e.toOperationNode)}function I(e){return p(e)&&"expressionType"in e&&k(e)}let T=h({is:e=>"SelectModifierNode"===e.kind,create:(e,t)=>h({kind:"SelectModifierNode",modifier:e,of:t}),createWithExpression:e=>h({kind:"SelectModifierNode",rawModifier:e})}),S=h({is:e=>"AndNode"===e.kind,create:(e,t)=>h({kind:"AndNode",left:e,right:t})}),D=h({is:e=>"OrNode"===e.kind,create:(e,t)=>h({kind:"OrNode",left:e,right:t})}),L=h({is:e=>"OnNode"===e.kind,create:e=>h({kind:"OnNode",on:e}),cloneWithOperation:(e,t,r)=>h({...e,on:"And"===t?S.create(e.on,r):D.create(e.on,r)})}),E=h({is:e=>"JoinNode"===e.kind,create:(e,t)=>h({kind:"JoinNode",joinType:e,table:t,on:void 0}),createWithOn:(e,t,r)=>h({kind:"JoinNode",joinType:e,table:t,on:L.create(r)}),cloneWithOn:(e,t)=>h({...e,on:e.on?L.cloneWithOperation(e.on,"And",t):L.create(t)})}),A=h({is:e=>"BinaryOperationNode"===e.kind,create:(e,t,r)=>h({kind:"BinaryOperationNode",leftOperand:e,operator:t,rightOperand:r})}),B=["->","->>"],P=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from","+","-","*","/","%","^","&","|","#","<<",">>","&&","||",...B,"not","-","exists","not exists","between","between symmetric"],M=h({is:e=>"OperatorNode"===e.kind,create:e=>h({kind:"OperatorNode",operator:e})});function R(e){return n(e)&&B.includes(e)}let Q=h({is:e=>"ColumnNode"===e.kind,create:e=>h({kind:"ColumnNode",column:f.create(e)})}),F=h({is:e=>"SelectAllNode"===e.kind,create:()=>h({kind:"SelectAllNode"})}),$=h({is:e=>"ReferenceNode"===e.kind,create:(e,t)=>h({kind:"ReferenceNode",table:t,column:e}),createSelectAll:e=>h({kind:"ReferenceNode",table:e,column:F.create()})});class U{#e;get dynamicReference(){return this.#e}get refType(){}constructor(e){this.#e=e}toOperationNode(){return er(this.#e)}}function V(e){return p(e)&&k(e)&&n(e.dynamicReference)}let J=h({is:e=>"OrderByItemNode"===e.kind,create:(e,t)=>h({kind:"OrderByItemNode",orderBy:e,direction:t}),cloneWith:(e,t)=>h({...e,...t})}),j=h({is:e=>"RawNode"===e.kind,create:(e,t)=>h({kind:"RawNode",sqlFragments:h(e),parameters:h(t)}),createWithSql:e=>j.create([e],[]),createWithChild:e=>j.create(["",""],[e]),createWithChildren:e=>j.create(Array(e.length+1).fill(""),e)});class K{#t;constructor(e){this.#t=h(e)}desc(){return new K({node:J.cloneWith(this.#t.node,{direction:j.createWithSql("desc")})})}asc(){return new K({node:J.cloneWith(this.#t.node,{direction:j.createWithSql("asc")})})}nullsLast(){return new K({node:J.cloneWith(this.#t.node,{nulls:"last"})})}nullsFirst(){return new K({node:J.cloneWith(this.#t.node,{nulls:"first"})})}collate(e){let t;return new K({node:J.cloneWith(this.#t.node,{collation:(t=e,h({kind:"CollateNode",collation:f.create(t)}))})})}toOperationNode(){return this.#t.node}}let z=new Set;function _(e){z.has(e)||(z.add(e),console.log(e))}function G(e){return"asc"===e||"desc"===e}function H(e){if(2===e.length)return[X(e[0],e[1])];if(1===e.length){let[t]=e;return Array.isArray(t)?(_("orderBy(array) is deprecated, use multiple orderBy calls instead."),t.map(e=>X(e))):[X(t)]}throw Error(`Invalid number of arguments at order by! expected 1-2, received ${e.length}`)}function X(e,t){let r=function(e){if(rp(e))return ra(e);if(V(e))return e.toOperationNode();let[t,r]=e.split(" ");return r?(_("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),Y(eo(t),r)):eo(e)}(e);if(J.is(r)){if(t)throw Error("Cannot specify direction twice!");return r}return Y(r,t)}function Y(e,t){if("string"==typeof t){if(!G(t))throw Error(`Invalid order by direction: ${t}`);return J.create(e,j.createWithSql(t))}if(I(t))return _("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),J.create(e,t.toOperationNode());let r=J.create(e);return t?t(new K({node:r})).toOperationNode():r}let Z=h({is:e=>"JSONReferenceNode"===e.kind,create:(e,t)=>h({kind:"JSONReferenceNode",reference:e,traversal:t}),cloneWithTraversal:(e,t)=>h({...e,traversal:t})}),ee=h({is:e=>"JSONOperatorChainNode"===e.kind,create:e=>h({kind:"JSONOperatorChainNode",operator:e,values:h([])}),cloneWithValue:(e,t)=>h({...e,values:h([...e.values,t])})}),et=h({is:e=>"JSONPathNode"===e.kind,create:e=>h({kind:"JSONPathNode",inOperator:e,pathLegs:h([])}),cloneWithLeg:(e,t)=>h({...e,pathLegs:h([...e.pathLegs,t])})});function er(e){return n(e)?eo(e):e.toOperationNode()}function ei(e){return c(e)?e.map(e=>en(e)):[en(e)]}function en(e){return rp(e)?ra(e):er(e)}function eo(e){if(!e.includes("."))return $.create(Q.create(e));let t=e.split(".").map(ed);if(3===t.length)return function(e){let[t,r,i]=e;return $.create(Q.create(i),q.createWithSchema(t,r))}(t);if(2===t.length)return function(e){let[t,r]=e;return $.create(Q.create(r),q.create(t))}(t);throw Error(`invalid column reference ${e}`)}function es(e){return Q.create(e)}function ea(e){if(!e.includes(" "))return es(e);{let[t,r]=e.split(" ").map(ed);if(!G(r))throw Error(`invalid order direction "${r}" next to "${t}"`);return H([t,r])[0]}}function ed(e){return e.trim()}let ep=h({is:e=>"PrimitiveValueListNode"===e.kind,create:e=>h({kind:"PrimitiveValueListNode",values:h([...e])})}),eh=h({is:e=>"ValueListNode"===e.kind,create:e=>h({kind:"ValueListNode",values:h(e)})}),eu=h({is:e=>"ValueNode"===e.kind,create:e=>h({kind:"ValueNode",value:e}),createImmediate:e=>h({kind:"ValueNode",value:e,immediate:!0})});function ec(e){return rp(e)?ra(e):eu.create(e)}function el(e){return o(e)||s(e)||null===e}function em(e){if(!el(e))throw Error(`unsafe immediate value ${JSON.stringify(e)}`);return eu.createImmediate(e)}let eN=h({is:e=>"ParensNode"===e.kind,create:e=>h({kind:"ParensNode",node:e})});function ef(e){if(3===e.length)return ey(e[0],e[1],e[2]);if(1===e.length)return ec(e[0]);throw Error(`invalid arguments: ${JSON.stringify(e)}`)}function ey(e,t,r){var i,n;if(("is"===(i=t)||"is not"===i)&&ex(r))return A.create(en(e),eb(t),eu.createImmediate(r));return A.create(en(e),eb(t),c(r)?(n=r).some(rp)?eh.create(n.map(e=>ec(e))):ep.create(n):ec(r))}function ew(e,t,r){return A.create(en(e),eb(t),en(r))}function eg(e,t){return ev(Object.entries(e).filter(([,e])=>!i(e)).map(([e,t])=>ey(e,ex(t)?"is":"=",t)),t)}function ev(e,t,r=!0){let i="and"===t?S.create:D.create;if(0===e.length)return A.create(eu.createImmediate(1),M.create("="),eu.createImmediate(+("and"===t)));let n=eW(e[0]);for(let t=1;t<e.length;++t)n=i(n,eW(e[t]));return e.length>1&&r?eN.create(n):n}function ex(e){return null===e||s(e)}function eb(e){if(n(e)&&P.includes(e))return M.create(e);if(k(e))return e.toOperationNode();throw Error(`invalid operator ${JSON.stringify(e)}`)}function eW(e){return k(e)?e.toOperationNode():e}let eO=h({is:e=>"OrderByNode"===e.kind,create:e=>h({kind:"OrderByNode",items:h([...e])}),cloneWithItems:(e,t)=>h({...e,items:h([...e.items,...t])})}),eC=h({is:e=>"PartitionByNode"===e.kind,create:e=>h({kind:"PartitionByNode",items:h(e)}),cloneWithItems:(e,t)=>h({...e,items:h([...e.items,...t])})}),eq=h({is:e=>"OverNode"===e.kind,create:()=>h({kind:"OverNode"}),cloneWithOrderByItems:(e,t)=>h({...e,orderBy:e.orderBy?eO.cloneWithItems(e.orderBy,t):eO.create(t)}),cloneWithPartitionByItems:(e,t)=>h({...e,partitionBy:e.partitionBy?eC.cloneWithItems(e.partitionBy,t):eC.create(t)})}),ek=h({is:e=>"FromNode"===e.kind,create:e=>h({kind:"FromNode",froms:h(e)}),cloneWithFroms:(e,t)=>h({...e,froms:h([...e.froms,...t])})}),eI=h({is:e=>"GroupByNode"===e.kind,create:e=>h({kind:"GroupByNode",items:h(e)}),cloneWithItems:(e,t)=>h({...e,items:h([...e.items,...t])})}),eT=h({is:e=>"HavingNode"===e.kind,create:e=>h({kind:"HavingNode",having:e}),cloneWithOperation:(e,t,r)=>h({...e,having:"And"===t?S.create(e.having,r):D.create(e.having,r)})}),eS=h({is:e=>"InsertQueryNode"===e.kind,create:(e,t,r)=>h({kind:"InsertQueryNode",into:e,...t&&{with:t},replace:r}),createWithoutInto:()=>h({kind:"InsertQueryNode"}),cloneWith:(e,t)=>h({...e,...t})}),eD=h({is:e=>"ListNode"===e.kind,create:e=>h({kind:"ListNode",items:h(e)})}),eL=h({is:e=>"UpdateQueryNode"===e.kind,create:(e,t)=>h({kind:"UpdateQueryNode",table:1===e.length?e[0]:eD.create(e),...t&&{with:t}}),createWithoutTable:()=>h({kind:"UpdateQueryNode"}),cloneWithFromItems:(e,t)=>h({...e,from:e.from?ek.cloneWithFroms(e.from,t):ek.create(t)}),cloneWithUpdates:(e,t)=>h({...e,updates:e.updates?h([...e.updates,...t]):t}),cloneWithLimit:(e,t)=>h({...e,limit:t})}),eE=h({is:e=>"UsingNode"===e.kind,create:e=>h({kind:"UsingNode",tables:h(e)}),cloneWithTables:(e,t)=>h({...e,tables:h([...e.tables,...t])})}),eA=h({is:e=>"DeleteQueryNode"===e.kind,create:(e,t)=>h({kind:"DeleteQueryNode",from:ek.create(e),...t&&{with:t}}),cloneWithOrderByItems:(e,t)=>e$.cloneWithOrderByItems(e,t),cloneWithoutOrderBy:e=>e$.cloneWithoutOrderBy(e),cloneWithLimit:(e,t)=>h({...e,limit:t}),cloneWithoutLimit:e=>h({...e,limit:void 0}),cloneWithUsing:(e,t)=>h({...e,using:void 0!==e.using?eE.cloneWithTables(e.using,t):eE.create(t)})}),eB=h({is:e=>"WhereNode"===e.kind,create:e=>h({kind:"WhereNode",where:e}),cloneWithOperation:(e,t,r)=>h({...e,where:"And"===t?S.create(e.where,r):D.create(e.where,r)})}),eP=h({is:e=>"ReturningNode"===e.kind,create:e=>h({kind:"ReturningNode",selections:h(e)}),cloneWithSelections:(e,t)=>h({...e,selections:e.selections?h([...e.selections,...t]):h(t)})}),eM=h({is:e=>"ExplainNode"===e.kind,create:(e,t)=>h({kind:"ExplainNode",format:e,options:t})}),eR=h({is:e=>"WhenNode"===e.kind,create:e=>h({kind:"WhenNode",condition:e}),cloneWithResult:(e,t)=>h({...e,result:t})}),eQ=h({is:e=>"MergeQueryNode"===e.kind,create:(e,t)=>h({kind:"MergeQueryNode",into:e,...t&&{with:t}}),cloneWithUsing:(e,t)=>h({...e,using:t}),cloneWithWhen:(e,t)=>h({...e,whens:e.whens?h([...e.whens,t]):h([t])}),cloneWithThen:(e,t)=>h({...e,whens:e.whens?h([...e.whens.slice(0,-1),eR.cloneWithResult(e.whens[e.whens.length-1],t)]):void 0})}),eF=h({is:e=>"OutputNode"===e.kind,create:e=>h({kind:"OutputNode",selections:h(e)}),cloneWithSelections:(e,t)=>h({...e,selections:e.selections?h([...e.selections,...t]):h(t)})}),e$=h({is:e=>eU.is(e)||eS.is(e)||eL.is(e)||eA.is(e)||eQ.is(e),cloneWithEndModifier:(e,t)=>h({...e,endModifiers:e.endModifiers?h([...e.endModifiers,t]):h([t])}),cloneWithWhere:(e,t)=>h({...e,where:e.where?eB.cloneWithOperation(e.where,"And",t):eB.create(t)}),cloneWithJoin:(e,t)=>h({...e,joins:e.joins?h([...e.joins,t]):h([t])}),cloneWithReturning:(e,t)=>h({...e,returning:e.returning?eP.cloneWithSelections(e.returning,t):eP.create(t)}),cloneWithoutReturning:e=>h({...e,returning:void 0}),cloneWithoutWhere:e=>h({...e,where:void 0}),cloneWithExplain:(e,t,r)=>h({...e,explain:eM.create(t,r?.toOperationNode())}),cloneWithTop:(e,t)=>h({...e,top:t}),cloneWithOutput:(e,t)=>h({...e,output:e.output?eF.cloneWithSelections(e.output,t):eF.create(t)}),cloneWithOrderByItems:(e,t)=>h({...e,orderBy:e.orderBy?eO.cloneWithItems(e.orderBy,t):eO.create(t)}),cloneWithoutOrderBy:e=>h({...e,orderBy:void 0})}),eU=h({is:e=>"SelectQueryNode"===e.kind,create:e=>h({kind:"SelectQueryNode",...e&&{with:e}}),createFrom:(e,t)=>h({kind:"SelectQueryNode",from:ek.create(e),...t&&{with:t}}),cloneWithSelections:(e,t)=>h({...e,selections:e.selections?h([...e.selections,...t]):h(t)}),cloneWithDistinctOn:(e,t)=>h({...e,distinctOn:e.distinctOn?h([...e.distinctOn,...t]):h(t)}),cloneWithFrontModifier:(e,t)=>h({...e,frontModifiers:e.frontModifiers?h([...e.frontModifiers,t]):h([t])}),cloneWithOrderByItems:(e,t)=>e$.cloneWithOrderByItems(e,t),cloneWithGroupByItems:(e,t)=>h({...e,groupBy:e.groupBy?eI.cloneWithItems(e.groupBy,t):eI.create(t)}),cloneWithLimit:(e,t)=>h({...e,limit:t}),cloneWithOffset:(e,t)=>h({...e,offset:t}),cloneWithFetch:(e,t)=>h({...e,fetch:t}),cloneWithHaving:(e,t)=>h({...e,having:e.having?eT.cloneWithOperation(e.having,"And",t):eT.create(t)}),cloneWithSetOperations:(e,t)=>h({...e,setOperations:e.setOperations?h([...e.setOperations,...t]):h([...t])}),cloneWithoutSelections:e=>h({...e,selections:[]}),cloneWithoutLimit:e=>h({...e,limit:void 0}),cloneWithoutOffset:e=>h({...e,offset:void 0}),cloneWithoutOrderBy:e=>e$.cloneWithoutOrderBy(e),cloneWithoutGroupBy:e=>h({...e,groupBy:void 0})});class eV{#t;constructor(e){this.#t=h(e)}on(...e){return new eV({...this.#t,joinNode:E.cloneWithOn(this.#t.joinNode,ef(e))})}onRef(e,t,r){return new eV({...this.#t,joinNode:E.cloneWithOn(this.#t.joinNode,ew(e,t,r))})}onTrue(){return new eV({...this.#t,joinNode:E.cloneWithOn(this.#t.joinNode,j.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#t.joinNode}}let eJ=h({is:e=>"PartitionByItemNode"===e.kind,create:e=>h({kind:"PartitionByItemNode",partitionBy:e})});class ej{#t;constructor(e){this.#t=h(e)}orderBy(...e){return new ej({overNode:eq.cloneWithOrderByItems(this.#t.overNode,H(e))})}clearOrderBy(){return new ej({overNode:e$.cloneWithoutOrderBy(this.#t.overNode)})}partitionBy(e){return new ej({overNode:eq.cloneWithPartitionByItems(this.#t.overNode,ei(e).map(eJ.create))})}$call(e){return e(this)}toOperationNode(){return this.#t.overNode}}let eK=h({is:e=>"SelectionNode"===e.kind,create:e=>h({kind:"SelectionNode",selection:e}),createSelectAll:()=>h({kind:"SelectionNode",selection:F.create()}),createSelectAllFromTable:e=>h({kind:"SelectionNode",selection:$.createSelectAll(e)})});function ez(e){return d(e)?ez(e(rs())):c(e)?e.map(e=>e_(e)):[e_(e)]}function e_(e){return n(e)?eK.create(function(e){let t=" as ";if(!e.includes(t))return eo(e);{let[r,i]=e.split(t).map(ed);return C.create(eo(r),f.create(i))}}(e)):V(e)?eK.create(e.toOperationNode()):eK.create(rd(e))}function eG(e){return e?Array.isArray(e)?e.map(eH):[eH(e)]:[eK.createSelectAll()]}function eH(e){if(n(e))return eK.createSelectAllFromTable(rl(e));throw Error(`invalid value selectAll expression: ${JSON.stringify(e)}`)}let eX=h({is:e=>"ValuesNode"===e.kind,create:e=>h({kind:"ValuesNode",values:h(e)})}),eY=h({is:e=>"DefaultInsertValueNode"===e.kind,create:()=>h({kind:"DefaultInsertValueNode"})});function eZ(e){var t;let r,n=d(e)?e(rs()):e;return r=function(e){let t=new Map;for(let r of e)for(let e of Object.keys(r))t.has(e)||void 0===r[e]||t.set(e,t.size);return t}(t=c(n)?n:h([n])),[h([...r.keys()].map(Q.create)),eX.create(t.map(e=>(function(e,t){let r=Object.keys(e),n=Array.from({length:t.size}),o=!1,s=r.length;for(let a of r){let r=t.get(a);if(i(r)){s--;continue}let d=e[a];(i(d)||rp(d))&&(o=!0),n[r]=d}if(s<t.size||o){let e=eY.create();return eh.create(n.map(t=>i(t)?e:ec(t)))}return ep.create(n)})(e,r)))]}let e0=h({is:e=>"ColumnUpdateNode"===e.kind,create:(e,t)=>h({kind:"ColumnUpdateNode",column:e,value:t})});function e1(e){return Object.entries(d(e)?e(rs()):e).filter(([e,t])=>void 0!==t).map(([e,t])=>e0.create(Q.create(e),ec(t)))}let e2=h({is:e=>"OnDuplicateKeyNode"===e.kind,create:e=>h({kind:"OnDuplicateKeyNode",updates:e})});class e3{insertId;numInsertedOrUpdatedRows;constructor(e,t){this.insertId=e,this.numInsertedOrUpdatedRows=t}}class e8 extends Error{node;constructor(e){super("no result"),this.node=e}}function e4(e){return Object.prototype.hasOwnProperty.call(e,"prototype")}let e5=h({is:e=>"OnConflictNode"===e.kind,create:()=>h({kind:"OnConflictNode"}),cloneWith:(e,t)=>h({...e,...t}),cloneWithIndexWhere:(e,t)=>h({...e,indexWhere:e.indexWhere?eB.cloneWithOperation(e.indexWhere,"And",t):eB.create(t)}),cloneWithIndexOrWhere:(e,t)=>h({...e,indexWhere:e.indexWhere?eB.cloneWithOperation(e.indexWhere,"Or",t):eB.create(t)}),cloneWithUpdateWhere:(e,t)=>h({...e,updateWhere:e.updateWhere?eB.cloneWithOperation(e.updateWhere,"And",t):eB.create(t)}),cloneWithUpdateOrWhere:(e,t)=>h({...e,updateWhere:e.updateWhere?eB.cloneWithOperation(e.updateWhere,"Or",t):eB.create(t)}),cloneWithoutIndexWhere:e=>h({...e,indexWhere:void 0}),cloneWithoutUpdateWhere:e=>h({...e,updateWhere:void 0})});class e6{#t;constructor(e){this.#t=h(e)}column(e){let t=Q.create(e);return new e6({...this.#t,onConflictNode:e5.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?h([...this.#t.onConflictNode.columns,t]):h([t])})})}columns(e){let t=e.map(Q.create);return new e6({...this.#t,onConflictNode:e5.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?h([...this.#t.onConflictNode.columns,...t]):h(t)})})}constraint(e){return new e6({...this.#t,onConflictNode:e5.cloneWith(this.#t.onConflictNode,{constraint:f.create(e)})})}expression(e){return new e6({...this.#t,onConflictNode:e5.cloneWith(this.#t.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new e6({...this.#t,onConflictNode:e5.cloneWithIndexWhere(this.#t.onConflictNode,ef(e))})}whereRef(e,t,r){return new e6({...this.#t,onConflictNode:e5.cloneWithIndexWhere(this.#t.onConflictNode,ew(e,t,r))})}clearWhere(){return new e6({...this.#t,onConflictNode:e5.cloneWithoutIndexWhere(this.#t.onConflictNode)})}doNothing(){return new e9({...this.#t,onConflictNode:e5.cloneWith(this.#t.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new e7({...this.#t,onConflictNode:e5.cloneWith(this.#t.onConflictNode,{updates:e1(e)})})}$call(e){return e(this)}}class e9{#t;constructor(e){this.#t=h(e)}toOperationNode(){return this.#t.onConflictNode}}class e7{#t;constructor(e){this.#t=h(e)}where(...e){return new e7({...this.#t,onConflictNode:e5.cloneWithUpdateWhere(this.#t.onConflictNode,ef(e))})}whereRef(e,t,r){return new e7({...this.#t,onConflictNode:e5.cloneWithUpdateWhere(this.#t.onConflictNode,ew(e,t,r))})}clearWhere(){return new e7({...this.#t,onConflictNode:e5.cloneWithoutUpdateWhere(this.#t.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#t.onConflictNode}}let te=h({is:e=>"TopNode"===e.kind,create:(e,t)=>h({kind:"TopNode",expression:e,modifiers:t})});function tt(e,t){var r;if(!o(e)&&!a(e))throw Error(`Invalid top expression: ${e}`);if(!i(t)&&"percent"!==(r=t)&&"with ties"!==r&&"percent with ties"!==r)throw Error(`Invalid top modifiers: ${t}`);return te.create(e,t)}let tr=h({is:e=>"OrActionNode"===e.kind,create:e=>h({kind:"OrActionNode",action:e})});class ti{#t;constructor(e){this.#t=h(e)}values(e){let[t,r]=eZ(e);return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{columns:t,values:r})})}columns(e){return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{columns:h(e.map(Q.create))})})}expression(e){return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{values:ra(e)})})}defaultValues(){return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{defaultValues:!0})})}modifyEnd(e){return new ti({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}ignore(){return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{orAction:tr.create("ignore")})})}orIgnore(){return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{orAction:tr.create("ignore")})})}orAbort(){return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{orAction:tr.create("abort")})})}orFail(){return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{orAction:tr.create("fail")})})}orReplace(){return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{orAction:tr.create("replace")})})}orRollback(){return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{orAction:tr.create("rollback")})})}top(e,t){return new ti({...this.#t,queryNode:e$.cloneWithTop(this.#t.queryNode,tt(e,t))})}onConflict(e){return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{onConflict:e(new e6({onConflictNode:e5.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new ti({...this.#t,queryNode:eS.cloneWith(this.#t.queryNode,{onDuplicateKey:e2.create(e1(e))})})}returning(e){return new ti({...this.#t,queryNode:e$.cloneWithReturning(this.#t.queryNode,ez(e))})}returningAll(){return new ti({...this.#t,queryNode:e$.cloneWithReturning(this.#t.queryNode,eG())})}output(e){return new ti({...this.#t,queryNode:e$.cloneWithOutput(this.#t.queryNode,ez(e))})}outputAll(e){return new ti({...this.#t,queryNode:e$.cloneWithOutput(this.#t.queryNode,eG(e))})}clearReturning(){return new ti({...this.#t,queryNode:e$.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new ti({...this.#t})}$castTo(){return new ti(this.#t)}$narrowType(){return new ti(this.#t)}$assertType(){return new ti(this.#t)}withPlugin(e){return new ti({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,i=e.query;return i.returning&&r.supportsReturning||i.output&&r.supportsOutput?t.rows:[new e3(t.insertId,t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=e8){let t=await this.executeTakeFirst();if(void 0===t)throw e4(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let r of this.#t.executor.stream(t,e,this.#t.queryId))yield*r.rows}async explain(e,t){let r=new ti({...this.#t,queryNode:e$.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}class tn{numDeletedRows;constructor(e){this.numDeletedRows=e}}let to=h({is:e=>"LimitNode"===e.kind,create:e=>h({kind:"LimitNode",limit:e})});class ts{#t;constructor(e){this.#t=h(e)}where(...e){return new ts({...this.#t,queryNode:e$.cloneWithWhere(this.#t.queryNode,ef(e))})}whereRef(e,t,r){return new ts({...this.#t,queryNode:e$.cloneWithWhere(this.#t.queryNode,ew(e,t,r))})}clearWhere(){return new ts({...this.#t,queryNode:e$.cloneWithoutWhere(this.#t.queryNode)})}top(e,t){return new ts({...this.#t,queryNode:e$.cloneWithTop(this.#t.queryNode,tt(e,t))})}using(e){return new ts({...this.#t,queryNode:eA.cloneWithUsing(this.#t.queryNode,rh(e))})}innerJoin(...e){return this.#r("InnerJoin",e)}leftJoin(...e){return this.#r("LeftJoin",e)}rightJoin(...e){return this.#r("RightJoin",e)}fullJoin(...e){return this.#r("FullJoin",e)}#r(e,t){return new ts({...this.#t,queryNode:e$.cloneWithJoin(this.#t.queryNode,tR(e,t))})}returning(e){return new ts({...this.#t,queryNode:e$.cloneWithReturning(this.#t.queryNode,ez(e))})}returningAll(e){return new ts({...this.#t,queryNode:e$.cloneWithReturning(this.#t.queryNode,eG(e))})}output(e){return new ts({...this.#t,queryNode:e$.cloneWithOutput(this.#t.queryNode,ez(e))})}outputAll(e){return new ts({...this.#t,queryNode:e$.cloneWithOutput(this.#t.queryNode,eG(e))})}clearReturning(){return new ts({...this.#t,queryNode:e$.cloneWithoutReturning(this.#t.queryNode)})}clearLimit(){return new ts({...this.#t,queryNode:eA.cloneWithoutLimit(this.#t.queryNode)})}orderBy(...e){return new ts({...this.#t,queryNode:e$.cloneWithOrderByItems(this.#t.queryNode,H(e))})}clearOrderBy(){return new ts({...this.#t,queryNode:e$.cloneWithoutOrderBy(this.#t.queryNode)})}limit(e){return new ts({...this.#t,queryNode:eA.cloneWithLimit(this.#t.queryNode,to.create(ec(e)))})}modifyEnd(e){return new ts({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}$call(e){return e(this)}$if(e,t){return e?t(this):new ts({...this.#t})}$castTo(){return new ts(this.#t)}$narrowType(){return new ts(this.#t)}$assertType(){return new ts(this.#t)}withPlugin(e){return new ts({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,i=e.query;return i.returning&&r.supportsReturning||i.output&&r.supportsOutput?t.rows:[new tn(t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=e8){let t=await this.executeTakeFirst();if(void 0===t)throw e4(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let r of this.#t.executor.stream(t,e,this.#t.queryId))yield*r.rows}async explain(e,t){let r=new ts({...this.#t,queryNode:e$.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}class ta{numUpdatedRows;numChangedRows;constructor(e,t){this.numUpdatedRows=e,this.numChangedRows=t}}class td{#t;constructor(e){this.#t=h(e)}where(...e){return new td({...this.#t,queryNode:e$.cloneWithWhere(this.#t.queryNode,ef(e))})}whereRef(e,t,r){return new td({...this.#t,queryNode:e$.cloneWithWhere(this.#t.queryNode,ew(e,t,r))})}clearWhere(){return new td({...this.#t,queryNode:e$.cloneWithoutWhere(this.#t.queryNode)})}top(e,t){return new td({...this.#t,queryNode:e$.cloneWithTop(this.#t.queryNode,tt(e,t))})}from(e){return new td({...this.#t,queryNode:eL.cloneWithFromItems(this.#t.queryNode,rh(e))})}innerJoin(...e){return this.#r("InnerJoin",e)}leftJoin(...e){return this.#r("LeftJoin",e)}rightJoin(...e){return this.#r("RightJoin",e)}fullJoin(...e){return this.#r("FullJoin",e)}#r(e,t){return new td({...this.#t,queryNode:e$.cloneWithJoin(this.#t.queryNode,tR(e,t))})}orderBy(...e){return new td({...this.#t,queryNode:e$.cloneWithOrderByItems(this.#t.queryNode,H(e))})}clearOrderBy(){return new td({...this.#t,queryNode:e$.cloneWithoutOrderBy(this.#t.queryNode)})}limit(e){return new td({...this.#t,queryNode:eL.cloneWithLimit(this.#t.queryNode,to.create(ec(e)))})}set(...e){return new td({...this.#t,queryNode:eL.cloneWithUpdates(this.#t.queryNode,function(...e){return 2===e.length?[e0.create(en(e[0]),ec(e[1]))]:e1(e[0])}(...e))})}returning(e){return new td({...this.#t,queryNode:e$.cloneWithReturning(this.#t.queryNode,ez(e))})}returningAll(e){return new td({...this.#t,queryNode:e$.cloneWithReturning(this.#t.queryNode,eG(e))})}output(e){return new td({...this.#t,queryNode:e$.cloneWithOutput(this.#t.queryNode,ez(e))})}outputAll(e){return new td({...this.#t,queryNode:e$.cloneWithOutput(this.#t.queryNode,eG(e))})}modifyEnd(e){return new td({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}clearReturning(){return new td({...this.#t,queryNode:e$.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new td({...this.#t})}$castTo(){return new td(this.#t)}$narrowType(){return new td(this.#t)}$assertType(){return new td(this.#t)}withPlugin(e){return new td({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,i=e.query;return i.returning&&r.supportsReturning||i.output&&r.supportsOutput?t.rows:[new ta(t.numAffectedRows??BigInt(0),t.numChangedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=e8){let t=await this.executeTakeFirst();if(void 0===t)throw e4(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let r of this.#t.executor.stream(t,e,this.#t.queryId))yield*r.rows}async explain(e,t){let r=new td({...this.#t,queryNode:e$.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}let tp=h({is:e=>"CommonTableExpressionNameNode"===e.kind,create:(e,t)=>h({kind:"CommonTableExpressionNameNode",table:q.create(e),columns:t?h(t.map(Q.create)):void 0})}),th=h({is:e=>"CommonTableExpressionNode"===e.kind,create:(e,t)=>h({kind:"CommonTableExpressionNode",name:e,expression:t}),cloneWith:(e,t)=>h({...e,...t})});class tu{#t;constructor(e){this.#t=h(e)}materialized(){return new tu({...this.#t,node:th.cloneWith(this.#t.node,{materialized:!0})})}notMaterialized(){return new tu({...this.#t,node:th.cloneWith(this.#t.node,{materialized:!1})})}toOperationNode(){return this.#t.node}}function tc(e,t){var r;let i=t(new tM({executor:tD})).toOperationNode();return d(e)?e((r=i,e=>new tu({node:th.create(tl(e),r)}))).toOperationNode():th.create(tl(e),i)}function tl(e){if(!e.includes("("))return tp.create(e);{let t=e.split(/[\(\)]/),r=t[0],i=t[1].split(",").map(e=>e.trim());return tp.create(r,i)}}let tm=h({is:e=>"WithNode"===e.kind,create:(e,t)=>h({kind:"WithNode",expressions:h([e]),...t}),cloneWithExpression:(e,t)=>h({...e,expressions:h([...e.expressions,t])})}),tN=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function tf(){return new ty}class ty{#i;get queryId(){return void 0===this.#i&&(this.#i=function(e){let t="";for(let e=0;e<8;++e)t+=tN[~~(Math.random()*tN.length)];return t}(0)),this.#i}}class tw{nodeStack=[];#n=h({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(e,t){if(!e)return e;this.nodeStack.push(e);let r=this.transformNodeImpl(e,t);return this.nodeStack.pop(),h(r)}transformNodeImpl(e,t){return this.#n[e.kind](e,t)}transformNodeList(e,t){return e?h(e.map(e=>this.transformNode(e,t))):e}transformSelectQuery(e,t){return{kind:"SelectQueryNode",from:this.transformNode(e.from,t),selections:this.transformNodeList(e.selections,t),distinctOn:this.transformNodeList(e.distinctOn,t),joins:this.transformNodeList(e.joins,t),groupBy:this.transformNode(e.groupBy,t),orderBy:this.transformNode(e.orderBy,t),where:this.transformNode(e.where,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),limit:this.transformNode(e.limit,t),offset:this.transformNode(e.offset,t),with:this.transformNode(e.with,t),having:this.transformNode(e.having,t),explain:this.transformNode(e.explain,t),setOperations:this.transformNodeList(e.setOperations,t),fetch:this.transformNode(e.fetch,t),top:this.transformNode(e.top,t)}}transformSelection(e,t){return{kind:"SelectionNode",selection:this.transformNode(e.selection,t)}}transformColumn(e,t){return{kind:"ColumnNode",column:this.transformNode(e.column,t)}}transformAlias(e,t){return{kind:"AliasNode",node:this.transformNode(e.node,t),alias:this.transformNode(e.alias,t)}}transformTable(e,t){return{kind:"TableNode",table:this.transformNode(e.table,t)}}transformFrom(e,t){return{kind:"FromNode",froms:this.transformNodeList(e.froms,t)}}transformReference(e,t){return{kind:"ReferenceNode",column:this.transformNode(e.column,t),table:this.transformNode(e.table,t)}}transformAnd(e,t){return{kind:"AndNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)}}transformOr(e,t){return{kind:"OrNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)}}transformValueList(e,t){return{kind:"ValueListNode",values:this.transformNodeList(e.values,t)}}transformParens(e,t){return{kind:"ParensNode",node:this.transformNode(e.node,t)}}transformJoin(e,t){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table,t),on:this.transformNode(e.on,t)}}transformRaw(e,t){return{kind:"RawNode",sqlFragments:h([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters,t)}}transformWhere(e,t){return{kind:"WhereNode",where:this.transformNode(e.where,t)}}transformInsertQuery(e,t){return{kind:"InsertQueryNode",into:this.transformNode(e.into,t),columns:this.transformNodeList(e.columns,t),values:this.transformNode(e.values,t),returning:this.transformNode(e.returning,t),onConflict:this.transformNode(e.onConflict,t),onDuplicateKey:this.transformNode(e.onDuplicateKey,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),ignore:e.ignore,orAction:this.transformNode(e.orAction,t),replace:e.replace,explain:this.transformNode(e.explain,t),defaultValues:e.defaultValues,top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)}}transformValues(e,t){return{kind:"ValuesNode",values:this.transformNodeList(e.values,t)}}transformDeleteQuery(e,t){return{kind:"DeleteQueryNode",from:this.transformNode(e.from,t),using:this.transformNode(e.using,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),orderBy:this.transformNode(e.orderBy,t),limit:this.transformNode(e.limit,t),explain:this.transformNode(e.explain,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)}}transformReturning(e,t){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections,t)}}transformCreateTable(e,t){return{kind:"CreateTableNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),constraints:this.transformNodeList(e.constraints,t),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),selectQuery:this.transformNode(e.selectQuery,t)}}transformColumnDefinition(e,t){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),references:this.transformNode(e.references,t),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo,t),check:this.transformNode(e.check,t),generated:this.transformNode(e.generated,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e,t){return{kind:"AddColumnNode",column:this.transformNode(e.column,t)}}transformDropTable(e,t){return{kind:"DropTableNode",table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e,t){return{kind:"OrderByNode",items:this.transformNodeList(e.items,t)}}transformOrderByItem(e,t){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy,t),direction:this.transformNode(e.direction,t),collation:this.transformNode(e.collation,t),nulls:e.nulls}}transformGroupBy(e,t){return{kind:"GroupByNode",items:this.transformNodeList(e.items,t)}}transformGroupByItem(e,t){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy,t)}}transformUpdateQuery(e,t){return{kind:"UpdateQueryNode",table:this.transformNode(e.table,t),from:this.transformNode(e.from,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),updates:this.transformNodeList(e.updates,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),explain:this.transformNode(e.explain,t),limit:this.transformNode(e.limit,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t),orderBy:this.transformNode(e.orderBy,t)}}transformColumnUpdate(e,t){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column,t),value:this.transformNode(e.value,t)}}transformLimit(e,t){return{kind:"LimitNode",limit:this.transformNode(e.limit,t)}}transformOffset(e,t){return{kind:"OffsetNode",offset:this.transformNode(e.offset,t)}}transformOnConflict(e,t){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns,t),constraint:this.transformNode(e.constraint,t),indexExpression:this.transformNode(e.indexExpression,t),indexWhere:this.transformNode(e.indexWhere,t),updates:this.transformNodeList(e.updates,t),updateWhere:this.transformNode(e.updateWhere,t),doNothing:e.doNothing}}transformOnDuplicateKey(e,t){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates,t)}}transformCreateIndex(e,t){return{kind:"CreateIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists,where:this.transformNode(e.where,t),nullsNotDistinct:e.nullsNotDistinct}}transformList(e,t){return{kind:"ListNode",items:this.transformNodeList(e.items,t)}}transformDropIndex(e,t){return{kind:"DropIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e,t){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformUniqueConstraint(e,t){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),nullsNotDistinct:e.nullsNotDistinct,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformForeignKeyConstraint(e,t){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns,t),references:this.transformNode(e.references,t),name:this.transformNode(e.name,t),onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformSetOperation(e,t){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression,t),all:e.all}}transformReferences(e,t){return{kind:"ReferencesNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e,t){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression,t),name:this.transformNode(e.name,t)}}transformWith(e,t){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions,t),recursive:e.recursive}}transformCommonTableExpression(e,t){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name,t),materialized:e.materialized,expression:this.transformNode(e.expression,t)}}transformCommonTableExpressionName(e,t){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t)}}transformHaving(e,t){return{kind:"HavingNode",having:this.transformNode(e.having,t)}}transformCreateSchema(e,t){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema,t),ifNotExists:e.ifNotExists}}transformDropSchema(e,t){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema,t),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e,t){return{kind:"AlterTableNode",table:this.transformNode(e.table,t),renameTo:this.transformNode(e.renameTo,t),setSchema:this.transformNode(e.setSchema,t),columnAlterations:this.transformNodeList(e.columnAlterations,t),addConstraint:this.transformNode(e.addConstraint,t),dropConstraint:this.transformNode(e.dropConstraint,t),renameConstraint:this.transformNode(e.renameConstraint,t),addIndex:this.transformNode(e.addIndex,t),dropIndex:this.transformNode(e.dropIndex,t)}}transformDropColumn(e,t){return{kind:"DropColumnNode",column:this.transformNode(e.column,t)}}transformRenameColumn(e,t){return{kind:"RenameColumnNode",column:this.transformNode(e.column,t),renameTo:this.transformNode(e.renameTo,t)}}transformAlterColumn(e,t){return{kind:"AlterColumnNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),dataTypeExpression:this.transformNode(e.dataTypeExpression,t),setDefault:this.transformNode(e.setDefault,t),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e,t){return{kind:"ModifyColumnNode",column:this.transformNode(e.column,t)}}transformAddConstraint(e,t){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint,t)}}transformDropConstraint(e,t){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName,t),ifExists:e.ifExists,modifier:e.modifier}}transformRenameConstraint(e,t){return{kind:"RenameConstraintNode",oldName:this.transformNode(e.oldName,t),newName:this.transformNode(e.newName,t)}}transformCreateView(e,t){return{kind:"CreateViewNode",name:this.transformNode(e.name,t),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns,t),as:this.transformNode(e.as,t)}}transformRefreshMaterializedView(e,t){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(e.name,t),concurrently:e.concurrently,withNoData:e.withNoData}}transformDropView(e,t){return{kind:"DropViewNode",name:this.transformNode(e.name,t),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e,t){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression,t)}}transformDefaultValue(e,t){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue,t)}}transformOn(e,t){return{kind:"OnNode",on:this.transformNode(e.on,t)}}transformSelectModifier(e,t){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier,t),of:this.transformNodeList(e.of,t)}}transformCreateType(e,t){return{kind:"CreateTypeNode",name:this.transformNode(e.name,t),enum:this.transformNode(e.enum,t)}}transformDropType(e,t){return{kind:"DropTypeNode",name:this.transformNode(e.name,t),ifExists:e.ifExists}}transformExplain(e,t){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options,t)}}transformSchemableIdentifier(e,t){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema,t),identifier:this.transformNode(e.identifier,t)}}transformAggregateFunction(e,t){return{kind:"AggregateFunctionNode",func:e.func,aggregated:this.transformNodeList(e.aggregated,t),distinct:e.distinct,orderBy:this.transformNode(e.orderBy,t),withinGroup:this.transformNode(e.withinGroup,t),filter:this.transformNode(e.filter,t),over:this.transformNode(e.over,t)}}transformOver(e,t){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy,t),partitionBy:this.transformNode(e.partitionBy,t)}}transformPartitionBy(e,t){return{kind:"PartitionByNode",items:this.transformNodeList(e.items,t)}}transformPartitionByItem(e,t){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy,t)}}transformBinaryOperation(e,t){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand,t),operator:this.transformNode(e.operator,t),rightOperand:this.transformNode(e.rightOperand,t)}}transformUnaryOperation(e,t){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator,t),operand:this.transformNode(e.operand,t)}}transformUsing(e,t){return{kind:"UsingNode",tables:this.transformNodeList(e.tables,t)}}transformFunction(e,t){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments,t)}}transformCase(e,t){return{kind:"CaseNode",value:this.transformNode(e.value,t),when:this.transformNodeList(e.when,t),else:this.transformNode(e.else,t),isStatement:e.isStatement}}transformWhen(e,t){return{kind:"WhenNode",condition:this.transformNode(e.condition,t),result:this.transformNode(e.result,t)}}transformJSONReference(e,t){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference,t),traversal:this.transformNode(e.traversal,t)}}transformJSONPath(e,t){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator,t),pathLegs:this.transformNodeList(e.pathLegs,t)}}transformJSONPathLeg(e,t){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e,t){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator,t),values:this.transformNodeList(e.values,t)}}transformTuple(e,t){return{kind:"TupleNode",values:this.transformNodeList(e.values,t)}}transformMergeQuery(e,t){return{kind:"MergeQueryNode",into:this.transformNode(e.into,t),using:this.transformNode(e.using,t),whens:this.transformNodeList(e.whens,t),with:this.transformNode(e.with,t),top:this.transformNode(e.top,t),endModifiers:this.transformNodeList(e.endModifiers,t),output:this.transformNode(e.output,t),returning:this.transformNode(e.returning,t)}}transformMatched(e,t){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e,t){return{kind:"AddIndexNode",name:this.transformNode(e.name,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists}}transformCast(e,t){return{kind:"CastNode",expression:this.transformNode(e.expression,t),dataType:this.transformNode(e.dataType,t)}}transformFetch(e,t){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount,t),modifier:e.modifier}}transformTop(e,t){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e,t){return{kind:"OutputNode",selections:this.transformNodeList(e.selections,t)}}transformDataType(e,t){return e}transformSelectAll(e,t){return e}transformIdentifier(e,t){return e}transformValue(e,t){return e}transformPrimitiveValueList(e,t){return e}transformOperator(e,t){return e}transformDefaultInsertValue(e,t){return e}transformOrAction(e,t){return e}transformCollate(e,t){return e}}let tg=h({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),tv={json_agg:!0,to_json:!0};class tx extends tw{#o;#s=new Set;#a=new Set;constructor(e){super(),this.#o=e}transformNodeImpl(e,t){if(!this.#d(e))return super.transformNodeImpl(e,t);let r=this.#p(e);for(let e of r)this.#a.add(e);let i=this.#h(e);for(let e of i)this.#s.add(e);let n=super.transformNodeImpl(e,t);for(let e of i)this.#s.delete(e);for(let e of r)this.#a.delete(e);return n}transformSchemableIdentifier(e,t){let r=super.transformSchemableIdentifier(e,t);return r.schema||!this.#s.has(e.identifier.name)?r:{...r,schema:f.create(this.#o)}}transformReferences(e,t){let r=super.transformReferences(e,t);return r.table.table.schema?r:{...r,table:q.createWithSchema(this.#o,r.table.table.identifier.name)}}transformAggregateFunction(e,t){return{...super.transformAggregateFunction({...e,aggregated:[]},t),aggregated:this.#u(e,t,"aggregated")}}transformFunction(e,t){return{...super.transformFunction({...e,arguments:[]},t),arguments:this.#u(e,t,"arguments")}}#u(e,t,r){return tv[e.func]?e[r].map(e=>!q.is(e)||e.table.schema?this.transformNode(e,t):{...e,table:this.transformIdentifier(e.table.identifier,t)}):this.transformNodeList(e[r],t)}#d(e){return e.kind in tg}#h(e){let t=new Set;if("name"in e&&e.name&&x.is(e.name)&&this.#c(e.name,t),"from"in e&&e.from)for(let r of e.from.froms)this.#l(r,t);if("into"in e&&e.into&&this.#l(e.into,t),"table"in e&&e.table&&this.#l(e.table,t),"joins"in e&&e.joins)for(let r of e.joins)this.#l(r.table,t);return"using"in e&&e.using&&this.#l(e.using,t),t}#p(e){let t=new Set;return"with"in e&&e.with&&this.#m(e.with,t),t}#l(e,t){if(q.is(e))this.#c(e.table,t);else if(C.is(e)&&q.is(e.node))this.#c(e.node.table,t);else if(eD.is(e))for(let r of e.items)this.#l(r,t)}#c(e,t){let r=e.identifier.name;this.#s.has(r)||this.#a.has(r)||t.add(r)}#m(e,t){for(let r of e.expressions){let e=r.name.table.table.identifier.name;this.#a.has(e)||t.add(e)}}}class tb{#N;constructor(e){this.#N=new tx(e)}transformQuery(e){return this.#N.transformNode(e.node,e.queryId)}async transformResult(e){return e.result}}let tW=h({is:e=>"MatchedNode"===e.kind,create:(e,t=!1)=>h({kind:"MatchedNode",not:e,bySource:t})});function tO(e,t,r){return eR.create(ev([tW.create(!e.isMatched,e.bySource),...t&&t.length>0?[3===t.length&&r?ew(t[0],t[1],t[2]):ef(t)]:[]],"and",!1))}function tC(e){return n(e)?j.create([e],[]):k(e)?e.toOperationNode():e}class tq{#f;#y;#w;constructor(){this.#f=new Promise((e,t)=>{this.#w=t,this.#y=e})}get promise(){return this.#f}resolve=e=>{this.#y&&this.#y(e)};reject=e=>{this.#w&&this.#w(e)}}async function tk(e){let t=new tq,r=new tq;return e.provideConnection(async e=>(t.resolve(e),await r.promise)).catch(e=>t.reject(e)),h({connection:await t.promise,release:r.resolve})}let tI=h([]);class tT{#g;constructor(e=tI){this.#g=e}get plugins(){return this.#g}transformQuery(e,t){for(let r of this.#g){let i=r.transformQuery({node:e,queryId:t});if(i.kind===e.kind)e=i;else throw Error(`KyselyPlugin.transformQuery must return a node of the same kind that was given to it. The plugin was given a ${e.kind} but it returned a ${i.kind}`)}return e}async executeQuery(e,t){return await this.provideConnection(async r=>{let i=await r.executeQuery(e);return"numUpdatedOrDeletedRows"in i&&_("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#v(i,t)})}async *stream(e,t,r){let{connection:i,release:n}=await tk(this);try{for await(let n of i.streamQuery(e,t))yield await this.#v(n,r)}finally{n()}}async #v(e,t){for(let r of this.#g)e=await r.transformResult({result:e,queryId:t});return e}}class tS extends tT{get adapter(){throw Error("this query cannot be compiled to SQL")}compileQuery(){throw Error("this query cannot be compiled to SQL")}provideConnection(){throw Error("this query cannot be executed")}withConnectionProvider(){throw Error("this query cannot have a connection provider")}withPlugin(e){return new tS([...this.plugins,e])}withPlugins(e){return new tS([...this.plugins,...e])}withPluginAtFront(e){return new tS([e,...this.plugins])}withoutPlugins(){return new tS([])}}let tD=new tS;class tL{numChangedRows;constructor(e){this.numChangedRows=e}}class tE{#t;constructor(e){this.#t=h(e)}modifyEnd(e){return new tE({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}top(e,t){return new tE({...this.#t,queryNode:e$.cloneWithTop(this.#t.queryNode,tt(e,t))})}using(...e){return new tA({...this.#t,queryNode:eQ.cloneWithUsing(this.#t.queryNode,tR("Using",e))})}returning(e){return new tE({...this.#t,queryNode:e$.cloneWithReturning(this.#t.queryNode,ez(e))})}returningAll(e){return new tE({...this.#t,queryNode:e$.cloneWithReturning(this.#t.queryNode,eG(e))})}output(e){return new tE({...this.#t,queryNode:e$.cloneWithOutput(this.#t.queryNode,ez(e))})}outputAll(e){return new tE({...this.#t,queryNode:e$.cloneWithOutput(this.#t.queryNode,eG(e))})}}class tA{#t;constructor(e){this.#t=h(e)}modifyEnd(e){return new tA({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}top(e,t){return new tA({...this.#t,queryNode:e$.cloneWithTop(this.#t.queryNode,tt(e,t))})}whenMatched(){return this.#x([])}whenMatchedAnd(...e){return this.#x(e)}whenMatchedAndRef(e,t,r){return this.#x([e,t,r],!0)}#x(e,t){return new tB({...this.#t,queryNode:eQ.cloneWithWhen(this.#t.queryNode,tO({isMatched:!0},e,t))})}whenNotMatched(){return this.#b([])}whenNotMatchedAnd(...e){return this.#b(e)}whenNotMatchedAndRef(e,t,r){return this.#b([e,t,r],!0)}whenNotMatchedBySource(){return this.#b([],!1,!0)}whenNotMatchedBySourceAnd(...e){return this.#b(e,!1,!0)}whenNotMatchedBySourceAndRef(e,t,r){return this.#b([e,t,r],!0,!0)}returning(e){return new tA({...this.#t,queryNode:e$.cloneWithReturning(this.#t.queryNode,ez(e))})}returningAll(e){return new tA({...this.#t,queryNode:e$.cloneWithReturning(this.#t.queryNode,eG(e))})}output(e){return new tA({...this.#t,queryNode:e$.cloneWithOutput(this.#t.queryNode,ez(e))})}outputAll(e){return new tA({...this.#t,queryNode:e$.cloneWithOutput(this.#t.queryNode,eG(e))})}#b(e,t=!1,r=!1){let i={...this.#t,queryNode:eQ.cloneWithWhen(this.#t.queryNode,tO({isMatched:!1,bySource:r},e,t))};return new(r?tB:tP)(i)}$call(e){return e(this)}$if(e,t){return e?t(this):new tA({...this.#t})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,i=e.query;return i.returning&&r.supportsReturning||i.output&&r.supportsOutput?t.rows:[new tL(t.numAffectedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=e8){let t=await this.executeTakeFirst();if(void 0===t)throw e4(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}}class tB{#t;constructor(e){this.#t=h(e)}thenDelete(){return new tA({...this.#t,queryNode:eQ.cloneWithThen(this.#t.queryNode,tC("delete"))})}thenDoNothing(){return new tA({...this.#t,queryNode:eQ.cloneWithThen(this.#t.queryNode,tC("do nothing"))})}thenUpdate(e){return new tA({...this.#t,queryNode:eQ.cloneWithThen(this.#t.queryNode,tC(e(new td({queryId:this.#t.queryId,executor:tD,queryNode:eL.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate(t=>t.set(...e))}}class tP{#t;constructor(e){this.#t=h(e)}thenDoNothing(){return new tA({...this.#t,queryNode:eQ.cloneWithThen(this.#t.queryNode,tC("do nothing"))})}thenInsertValues(e){let[t,r]=eZ(e);return new tA({...this.#t,queryNode:eQ.cloneWithThen(this.#t.queryNode,tC(eS.cloneWith(eS.createWithoutInto(),{columns:t,values:r})))})}}class tM{#t;constructor(e){this.#t=h(e)}selectFrom(e){return new tz({queryId:tf(),executor:this.#t.executor,queryNode:eU.createFrom(rh(e),this.#t.withNode)})}selectNoFrom(e){return new tz({queryId:tf(),executor:this.#t.executor,queryNode:eU.cloneWithSelections(eU.create(this.#t.withNode),ez(e))})}insertInto(e){return new ti({queryId:tf(),executor:this.#t.executor,queryNode:eS.create(rl(e),this.#t.withNode)})}replaceInto(e){return new ti({queryId:tf(),executor:this.#t.executor,queryNode:eS.create(rl(e),this.#t.withNode,!0)})}deleteFrom(e){return new ts({queryId:tf(),executor:this.#t.executor,queryNode:eA.create(rh(e),this.#t.withNode)})}updateTable(e){return new td({queryId:tf(),executor:this.#t.executor,queryNode:eL.create(rh(e),this.#t.withNode)})}mergeInto(e){return new tE({queryId:tf(),executor:this.#t.executor,queryNode:eQ.create(rc(e),this.#t.withNode)})}with(e,t){let r=tc(e,t);return new tM({...this.#t,withNode:this.#t.withNode?tm.cloneWithExpression(this.#t.withNode,r):tm.create(r)})}withRecursive(e,t){let r=tc(e,t);return new tM({...this.#t,withNode:this.#t.withNode?tm.cloneWithExpression(this.#t.withNode,r):tm.create(r,{recursive:!0})})}withPlugin(e){return new tM({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new tM({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new tM({...this.#t,executor:this.#t.executor.withPluginAtFront(new tb(e))})}}function tR(e,t){var r,i,n,o,s,a;if(3===t.length){return r=e,i=t[0],n=t[1],o=t[2],E.createWithOn(r,ru(i),ew(n,"=",o))}if(2===t.length)return function(e,t,r){return r(new eV({joinNode:E.create(e,ru(t))})).toOperationNode()}(e,t[0],t[1]);if(1===t.length){return s=e,a=t[0],E.create(s,ru(a))}throw Error("not implemented")}let tQ=h({is:e=>"OffsetNode"===e.kind,create:e=>h({kind:"OffsetNode",offset:e})}),tF=h({is:e=>"GroupByItemNode"===e.kind,create:e=>h({kind:"GroupByItemNode",groupBy:e})}),t$=h({is:e=>"SetOperationNode"===e.kind,create:(e,t,r)=>h({kind:"SetOperationNode",operator:e,expression:t,all:r})});function tU(e,t,r){return d(t)&&(t=t(rs())),c(t)||(t=[t]),t.map(t=>t$.create(e,ra(t),r))}class tV{#W;constructor(e){this.#W=e}get expressionType(){}as(e){return new tJ(this,e)}or(...e){return new tj(D.create(this.#W,ef(e)))}and(...e){return new tK(S.create(this.#W,ef(e)))}$castTo(){return new tV(this.#W)}$notNull(){return new tV(this.#W)}toOperationNode(){return this.#W}}class tJ{#O;#C;constructor(e,t){this.#O=e,this.#C=t}get expression(){return this.#O}get alias(){return this.#C}toOperationNode(){return C.create(this.#O.toOperationNode(),k(this.#C)?this.#C.toOperationNode():f.create(this.#C))}}class tj{#W;constructor(e){this.#W=e}get expressionType(){}as(e){return new tJ(this,e)}or(...e){return new tj(D.create(this.#W,ef(e)))}$castTo(){return new tj(this.#W)}toOperationNode(){return eN.create(this.#W)}}class tK{#W;constructor(e){this.#W=e}get expressionType(){}as(e){return new tJ(this,e)}and(...e){return new tK(S.create(this.#W,ef(e)))}$castTo(){return new tK(this.#W)}toOperationNode(){return eN.create(this.#W)}}class tz{#t;constructor(e){this.#t=h(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new tz({...this.#t,queryNode:e$.cloneWithWhere(this.#t.queryNode,ef(e))})}whereRef(e,t,r){return new tz({...this.#t,queryNode:e$.cloneWithWhere(this.#t.queryNode,ew(e,t,r))})}having(...e){return new tz({...this.#t,queryNode:eU.cloneWithHaving(this.#t.queryNode,ef(e))})}havingRef(e,t,r){return new tz({...this.#t,queryNode:eU.cloneWithHaving(this.#t.queryNode,ew(e,t,r))})}select(e){return new tz({...this.#t,queryNode:eU.cloneWithSelections(this.#t.queryNode,ez(e))})}distinctOn(e){return new tz({...this.#t,queryNode:eU.cloneWithDistinctOn(this.#t.queryNode,ei(e))})}modifyFront(e){return new tz({...this.#t,queryNode:eU.cloneWithFrontModifier(this.#t.queryNode,T.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new tz({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,T.createWithExpression(e.toOperationNode()))})}distinct(){return new tz({...this.#t,queryNode:eU.cloneWithFrontModifier(this.#t.queryNode,T.create("Distinct"))})}forUpdate(e){return new tz({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,T.create("ForUpdate",e?u(e).map(rl):void 0))})}forShare(e){return new tz({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,T.create("ForShare",e?u(e).map(rl):void 0))})}forKeyShare(e){return new tz({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,T.create("ForKeyShare",e?u(e).map(rl):void 0))})}forNoKeyUpdate(e){return new tz({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,T.create("ForNoKeyUpdate",e?u(e).map(rl):void 0))})}skipLocked(){return new tz({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,T.create("SkipLocked"))})}noWait(){return new tz({...this.#t,queryNode:e$.cloneWithEndModifier(this.#t.queryNode,T.create("NoWait"))})}selectAll(e){return new tz({...this.#t,queryNode:eU.cloneWithSelections(this.#t.queryNode,eG(e))})}innerJoin(...e){return this.#r("InnerJoin",e)}leftJoin(...e){return this.#r("LeftJoin",e)}rightJoin(...e){return this.#r("RightJoin",e)}fullJoin(...e){return this.#r("FullJoin",e)}crossJoin(...e){return this.#r("CrossJoin",e)}innerJoinLateral(...e){return this.#r("LateralInnerJoin",e)}leftJoinLateral(...e){return this.#r("LateralLeftJoin",e)}crossJoinLateral(...e){return this.#r("LateralCrossJoin",e)}crossApply(...e){return this.#r("CrossApply",e)}outerApply(...e){return this.#r("OuterApply",e)}#r(e,t){return new tz({...this.#t,queryNode:e$.cloneWithJoin(this.#t.queryNode,tR(e,t))})}orderBy(...e){return new tz({...this.#t,queryNode:e$.cloneWithOrderByItems(this.#t.queryNode,H(e))})}groupBy(e){var t;return new tz({...this.#t,queryNode:eU.cloneWithGroupByItems(this.#t.queryNode,ei(t=d(t=e)?t(rs()):t).map(tF.create))})}limit(e){return new tz({...this.#t,queryNode:eU.cloneWithLimit(this.#t.queryNode,to.create(ec(e)))})}offset(e){return new tz({...this.#t,queryNode:eU.cloneWithOffset(this.#t.queryNode,tQ.create(ec(e)))})}fetch(e,t="only"){return new tz({...this.#t,queryNode:eU.cloneWithFetch(this.#t.queryNode,function(e,t){var r;let i,n;if(!o(e)&&!a(e))throw Error(`Invalid fetch row count: ${e}`);if("only"!==(r=t)&&"with ties"!==r)throw Error(`Invalid fetch modifier: ${t}`);return i=e,n=t,{kind:"FetchNode",rowCount:eu.create(i),modifier:n}}(e,t))})}top(e,t){return new tz({...this.#t,queryNode:e$.cloneWithTop(this.#t.queryNode,tt(e,t))})}union(e){return new tz({...this.#t,queryNode:eU.cloneWithSetOperations(this.#t.queryNode,tU("union",e,!1))})}unionAll(e){return new tz({...this.#t,queryNode:eU.cloneWithSetOperations(this.#t.queryNode,tU("union",e,!0))})}intersect(e){return new tz({...this.#t,queryNode:eU.cloneWithSetOperations(this.#t.queryNode,tU("intersect",e,!1))})}intersectAll(e){return new tz({...this.#t,queryNode:eU.cloneWithSetOperations(this.#t.queryNode,tU("intersect",e,!0))})}except(e){return new tz({...this.#t,queryNode:eU.cloneWithSetOperations(this.#t.queryNode,tU("except",e,!1))})}exceptAll(e){return new tz({...this.#t,queryNode:eU.cloneWithSetOperations(this.#t.queryNode,tU("except",e,!0))})}as(e){return new t_(this,e)}clearSelect(){return new tz({...this.#t,queryNode:eU.cloneWithoutSelections(this.#t.queryNode)})}clearWhere(){return new tz({...this.#t,queryNode:e$.cloneWithoutWhere(this.#t.queryNode)})}clearLimit(){return new tz({...this.#t,queryNode:eU.cloneWithoutLimit(this.#t.queryNode)})}clearOffset(){return new tz({...this.#t,queryNode:eU.cloneWithoutOffset(this.#t.queryNode)})}clearOrderBy(){return new tz({...this.#t,queryNode:e$.cloneWithoutOrderBy(this.#t.queryNode)})}clearGroupBy(){return new tz({...this.#t,queryNode:eU.cloneWithoutGroupBy(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new tz({...this.#t})}$castTo(){return new tz(this.#t)}$narrowType(){return new tz(this.#t)}$assertType(){return new tz(this.#t)}$asTuple(){return new tV(this.toOperationNode())}$asScalar(){return new tV(this.toOperationNode())}withPlugin(e){return new tz({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile();return(await this.#t.executor.executeQuery(e,this.#t.queryId)).rows}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=e8){let t=await this.executeTakeFirst();if(void 0===t)throw e4(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let r of this.#t.executor.stream(t,e,this.#t.queryId))yield*r.rows}async explain(e,t){let r=new tz({...this.#t,queryNode:e$.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}class t_{#q;#C;constructor(e,t){this.#q=e,this.#C=t}get expression(){return this.#q}get alias(){return this.#C}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return C.create(this.#q.toOperationNode(),f.create(this.#C))}}let tG=h({is:e=>"AggregateFunctionNode"===e.kind,create:(e,t=[])=>h({kind:"AggregateFunctionNode",func:e,aggregated:t}),cloneWithDistinct:e=>h({...e,distinct:!0}),cloneWithOrderBy(e,t,r=!1){let i=r?"withinGroup":"orderBy";return h({...e,[i]:e[i]?eO.cloneWithItems(e[i],t):eO.create(t)})},cloneWithFilter:(e,t)=>h({...e,filter:e.filter?eB.cloneWithOperation(e.filter,"And",t):eB.create(t)}),cloneWithOrFilter:(e,t)=>h({...e,filter:e.filter?eB.cloneWithOperation(e.filter,"Or",t):eB.create(t)}),cloneWithOver:(e,t)=>h({...e,over:t})}),tH=h({is:e=>"FunctionNode"===e.kind,create:(e,t)=>h({kind:"FunctionNode",func:e,arguments:t})});class tX{#t;constructor(e){this.#t=h(e)}get expressionType(){}as(e){return new tY(this,e)}distinct(){return new tX({...this.#t,aggregateFunctionNode:tG.cloneWithDistinct(this.#t.aggregateFunctionNode)})}orderBy(...e){return new tX({...this.#t,aggregateFunctionNode:e$.cloneWithOrderByItems(this.#t.aggregateFunctionNode,H(e))})}clearOrderBy(){return new tX({...this.#t,aggregateFunctionNode:e$.cloneWithoutOrderBy(this.#t.aggregateFunctionNode)})}withinGroupOrderBy(...e){return new tX({...this.#t,aggregateFunctionNode:tG.cloneWithOrderBy(this.#t.aggregateFunctionNode,H(e),!0)})}filterWhere(...e){return new tX({...this.#t,aggregateFunctionNode:tG.cloneWithFilter(this.#t.aggregateFunctionNode,ef(e))})}filterWhereRef(e,t,r){return new tX({...this.#t,aggregateFunctionNode:tG.cloneWithFilter(this.#t.aggregateFunctionNode,ew(e,t,r))})}over(e){let t=new ej({overNode:eq.create()});return new tX({...this.#t,aggregateFunctionNode:tG.cloneWithOver(this.#t.aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}$castTo(){return new tX(this.#t)}$notNull(){return new tX(this.#t)}toOperationNode(){return this.#t.aggregateFunctionNode}}class tY{#k;#C;constructor(e,t){this.#k=e,this.#C=t}get expression(){return this.#k}get alias(){return this.#C}toOperationNode(){return C.create(this.#k.toOperationNode(),f.create(this.#C))}}function tZ(){let e=(e,t)=>new tV(tH.create(e,ei(t??[]))),t=(e,t)=>new tX({aggregateFunctionNode:tG.create(e,t?ei(t):void 0)});return Object.assign(e,{agg:t,avg:e=>t("avg",[e]),coalesce:(...t)=>e("coalesce",t),count:e=>t("count",[e]),countAll:e=>new tX({aggregateFunctionNode:tG.create("count",eG(e))}),max:e=>t("max",[e]),min:e=>t("min",[e]),sum:e=>t("sum",[e]),any:t=>e("any",[t]),jsonAgg:e=>new tX({aggregateFunctionNode:tG.create("json_agg",[n(e)?rl(e):e.toOperationNode()])}),toJson:e=>new tV(tH.create("to_json",[n(e)?rl(e):e.toOperationNode()]))})}let t0=h({is:e=>"UnaryOperationNode"===e.kind,create:(e,t)=>h({kind:"UnaryOperationNode",operator:e,operand:t})}),t1=h({is:e=>"CaseNode"===e.kind,create:e=>h({kind:"CaseNode",value:e}),cloneWithWhen:(e,t)=>h({...e,when:h(e.when?[...e.when,t]:[t])}),cloneWithThen:(e,t)=>h({...e,when:e.when?h([...e.when.slice(0,-1),eR.cloneWithResult(e.when[e.when.length-1],t)]):void 0}),cloneWith:(e,t)=>h({...e,...t})});class t2{#t;constructor(e){this.#t=h(e)}when(...e){return new t3({...this.#t,node:t1.cloneWithWhen(this.#t.node,eR.create(ef(e)))})}}class t3{#t;constructor(e){this.#t=h(e)}then(e){return new t8({...this.#t,node:t1.cloneWithThen(this.#t.node,el(e)?em(e):ec(e))})}}class t8{#t;constructor(e){this.#t=h(e)}when(...e){return new t3({...this.#t,node:t1.cloneWithWhen(this.#t.node,eR.create(ef(e)))})}else(e){return new t4({...this.#t,node:t1.cloneWith(this.#t.node,{else:el(e)?em(e):ec(e)})})}end(){return new tV(t1.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new tV(t1.cloneWith(this.#t.node,{isStatement:!0}))}}class t4{#t;constructor(e){this.#t=h(e)}end(){return new tV(t1.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new tV(t1.cloneWith(this.#t.node,{isStatement:!0}))}}let t5=h({is:e=>"JSONPathLegNode"===e.kind,create:(e,t)=>h({kind:"JSONPathLegNode",type:e,value:t})});class t6{#W;constructor(e){this.#W=e}at(e){return this.#I("ArrayLocation",e)}key(e){return this.#I("Member",e)}#I(e,t){return new t9(Z.is(this.#W)?Z.cloneWithTraversal(this.#W,et.is(this.#W.traversal)?et.cloneWithLeg(this.#W.traversal,t5.create(e,t)):ee.cloneWithValue(this.#W.traversal,eu.createImmediate(t))):et.cloneWithLeg(this.#W,t5.create(e,t)))}}class t9 extends t6{#W;constructor(e){super(e),this.#W=e}get expressionType(){}as(e){return new t7(this,e)}$castTo(){return new t9(this.#W)}$notNull(){return new t9(this.#W)}toOperationNode(){return this.#W}}class t7{#T;#C;constructor(e,t){this.#T=e,this.#C=t}get expression(){return this.#T}get alias(){return this.#C}toOperationNode(){return C.create(this.#T.toOperationNode(),k(this.#C)?this.#C.toOperationNode():f.create(this.#C))}}let re=h({is:e=>"TupleNode"===e.kind,create:e=>h({kind:"TupleNode",values:h(e)})}),rt=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],rr=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],ri=h({is:e=>"DataTypeNode"===e.kind,create:e=>h({kind:"DataTypeNode",dataType:e})});function rn(e){if(k(e))return e.toOperationNode();if(rt.includes(e)||rr.some(t=>t.test(e)))return ri.create(e);throw Error(`invalid column data type ${JSON.stringify(e)}`)}let ro=h({is:e=>"CastNode"===e.kind,create:(e,t)=>h({kind:"CastNode",expression:e,dataType:t})});function rs(e=tD){function t(e,t){return new tV(t0.create(M.create(e),en(t)))}let r=Object.assign(function(e,t,r){return new tV(ey(e,t,r))},{fn:void 0,eb:void 0,selectFrom:t=>new tz({queryId:tf(),executor:e,queryNode:eU.createFrom(rh(t))}),case:e=>new t2({node:t1.create(i(e)?void 0:en(e))}),ref:(e,t)=>i(t)?new tV(eo(e)):new t6(function(e,t){let r=eo(e);if(R(t))return Z.create(r,ee.create(M.create(t)));let i=t.slice(0,-1);if(R(i))return Z.create(r,et.create(M.create(i)));throw Error(`Invalid JSON operator: ${t}`)}(e,t)),jsonPath:()=>new t6(et.create()),table:e=>new tV(rl(e)),val:e=>new tV(ec(e)),refTuple:(...e)=>new tV(re.create(e.map(en))),tuple:(...e)=>new tV(re.create(e.map(ec))),lit:e=>new tV(em(e)),unary:t,not:e=>t("not",e),exists:e=>t("exists",e),neg:e=>t("-",e),between:(e,t,r)=>new tV(A.create(en(e),M.create("between"),S.create(ec(t),ec(r)))),betweenSymmetric:(e,t,r)=>new tV(A.create(en(e),M.create("between symmetric"),S.create(ec(t),ec(r)))),and:e=>new tV(c(e)?ev(e,"and"):eg(e,"and")),or:e=>new tV(c(e)?ev(e,"or"):eg(e,"or")),parens(...e){let t=ef(e);return new tV(eN.is(t)?t:eN.create(t))},cast:(e,t)=>new tV(ro.create(en(e),rn(t))),withSchema:t=>rs(e.withPluginAtFront(new tb(t)))});return r.fn=tZ(),r.eb=r,r}function ra(e){if(k(e))return e.toOperationNode();if(d(e))return e(rs()).toOperationNode();throw Error(`invalid expression: ${JSON.stringify(e)}`)}function rd(e){if(k(e))return e.toOperationNode();if(d(e))return e(rs()).toOperationNode();throw Error(`invalid aliased expression: ${JSON.stringify(e)}`)}function rp(e){return I(e)||p(e)&&"expression"in e&&n(e.alias)&&k(e)||d(e)}function rh(e){return c(e)?e.map(e=>ru(e)):[ru(e)]}function ru(e){return n(e)?rc(e):rd(e)}function rc(e){let t=" as ";if(!e.includes(t))return rl(e);{let[r,i]=e.split(t).map(rm);return C.create(rl(r),f.create(i))}}function rl(e){if(!e.includes("."))return q.create(e);{let[t,r]=e.split(".").map(rm);return q.createWithSchema(t,r)}}function rm(e){return e.trim()}let rN=h({is:e=>"AddColumnNode"===e.kind,create:e=>h({kind:"AddColumnNode",column:e})}),rf=h({is:e=>"ColumnDefinitionNode"===e.kind,create:(e,t)=>h({kind:"ColumnDefinitionNode",column:Q.create(e),dataType:t}),cloneWithFrontModifier:(e,t)=>h({...e,frontModifiers:e.frontModifiers?h([...e.frontModifiers,t]):[t]}),cloneWithEndModifier:(e,t)=>h({...e,endModifiers:e.endModifiers?h([...e.endModifiers,t]):[t]}),cloneWith:(e,t)=>h({...e,...t})}),ry=h({is:e=>"DropColumnNode"===e.kind,create:e=>h({kind:"DropColumnNode",column:Q.create(e)})}),rw=h({is:e=>"RenameColumnNode"===e.kind,create:(e,t)=>h({kind:"RenameColumnNode",column:Q.create(e),renameTo:Q.create(t)})}),rg=h({is:e=>"CheckConstraintNode"===e.kind,create:(e,t)=>h({kind:"CheckConstraintNode",expression:e,name:t?f.create(t):void 0})}),rv=["no action","restrict","cascade","set null","set default"],rx=h({is:e=>"ReferencesNode"===e.kind,create:(e,t)=>h({kind:"ReferencesNode",table:e,columns:h([...t])}),cloneWithOnDelete:(e,t)=>h({...e,onDelete:t}),cloneWithOnUpdate:(e,t)=>h({...e,onUpdate:t})});function rb(e){return k(e)?e.toOperationNode():eu.createImmediate(e)}let rW=h({is:e=>"GeneratedNode"===e.kind,create:e=>h({kind:"GeneratedNode",...e}),createWithExpression:e=>h({kind:"GeneratedNode",always:!0,expression:e}),cloneWith:(e,t)=>h({...e,...t})}),rO=h({is:e=>"DefaultValueNode"===e.kind,create:e=>h({kind:"DefaultValueNode",defaultValue:e})});function rC(e){if(rv.includes(e))return e;throw Error(`invalid OnModifyForeignAction ${e}`)}class rq{#W;constructor(e){this.#W=e}autoIncrement(){return new rq(rf.cloneWith(this.#W,{autoIncrement:!0}))}identity(){return new rq(rf.cloneWith(this.#W,{identity:!0}))}primaryKey(){return new rq(rf.cloneWith(this.#W,{primaryKey:!0}))}references(e){let t=eo(e);if(!t.table||F.is(t.column))throw Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new rq(rf.cloneWith(this.#W,{references:rx.create(t.table,[t.column])}))}onDelete(e){if(!this.#W.references)throw Error("on delete constraint can only be added for foreign keys");return new rq(rf.cloneWith(this.#W,{references:rx.cloneWithOnDelete(this.#W.references,rC(e))}))}onUpdate(e){if(!this.#W.references)throw Error("on update constraint can only be added for foreign keys");return new rq(rf.cloneWith(this.#W,{references:rx.cloneWithOnUpdate(this.#W.references,rC(e))}))}unique(){return new rq(rf.cloneWith(this.#W,{unique:!0}))}notNull(){return new rq(rf.cloneWith(this.#W,{notNull:!0}))}unsigned(){return new rq(rf.cloneWith(this.#W,{unsigned:!0}))}defaultTo(e){return new rq(rf.cloneWith(this.#W,{defaultTo:rO.create(rb(e))}))}check(e){return new rq(rf.cloneWith(this.#W,{check:rg.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new rq(rf.cloneWith(this.#W,{generated:rW.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new rq(rf.cloneWith(this.#W,{generated:rW.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new rq(rf.cloneWith(this.#W,{generated:rW.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#W.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new rq(rf.cloneWith(this.#W,{generated:rW.cloneWith(this.#W.generated,{stored:!0})}))}modifyFront(e){return new rq(rf.cloneWithFrontModifier(this.#W,e.toOperationNode()))}nullsNotDistinct(){return new rq(rf.cloneWith(this.#W,{nullsNotDistinct:!0}))}ifNotExists(){return new rq(rf.cloneWith(this.#W,{ifNotExists:!0}))}modifyEnd(e){return new rq(rf.cloneWithEndModifier(this.#W,e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return this.#W}}let rk=h({is:e=>"ModifyColumnNode"===e.kind,create:e=>h({kind:"ModifyColumnNode",column:e})}),rI=h({is:e=>"ForeignKeyConstraintNode"===e.kind,create:(e,t,r,i)=>h({kind:"ForeignKeyConstraintNode",columns:e,references:rx.create(t,r),name:i?f.create(i):void 0}),cloneWith:(e,t)=>h({...e,...t})});class rT{#W;constructor(e){this.#W=e}onDelete(e){return new rT(rI.cloneWith(this.#W,{onDelete:rC(e)}))}onUpdate(e){return new rT(rI.cloneWith(this.#W,{onUpdate:rC(e)}))}deferrable(){return new rT(rI.cloneWith(this.#W,{deferrable:!0}))}notDeferrable(){return new rT(rI.cloneWith(this.#W,{deferrable:!1}))}initiallyDeferred(){return new rT(rI.cloneWith(this.#W,{initiallyDeferred:!0}))}initiallyImmediate(){return new rT(rI.cloneWith(this.#W,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#W}}let rS=h({is:e=>"AddConstraintNode"===e.kind,create:e=>h({kind:"AddConstraintNode",constraint:e})}),rD=h({is:e=>"UniqueConstraintNode"===e.kind,create:(e,t,r)=>h({kind:"UniqueConstraintNode",columns:h(e.map(Q.create)),name:t?f.create(t):void 0,nullsNotDistinct:r}),cloneWith:(e,t)=>h({...e,...t})}),rL=h({is:e=>"DropConstraintNode"===e.kind,create:e=>h({kind:"DropConstraintNode",constraintName:f.create(e)}),cloneWith:(e,t)=>h({...e,...t})}),rE=h({is:e=>"AlterColumnNode"===e.kind,create:(e,t,r)=>h({kind:"AlterColumnNode",column:Q.create(e),[t]:r})});class rA{#S;constructor(e){this.#S=e}setDataType(e){return new rB(rE.create(this.#S,"dataType",rn(e)))}setDefault(e){return new rB(rE.create(this.#S,"setDefault",rb(e)))}dropDefault(){return new rB(rE.create(this.#S,"dropDefault",!0))}setNotNull(){return new rB(rE.create(this.#S,"setNotNull",!0))}dropNotNull(){return new rB(rE.create(this.#S,"dropNotNull",!0))}$call(e){return e(this)}}class rB{#D;constructor(e){this.#D=e}toOperationNode(){return this.#D}}class rP{#t;constructor(e){this.#t=h(e)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class rM{#t;constructor(e){this.#t=h(e)}onDelete(e){return new rM({...this.#t,constraintBuilder:this.#t.constraintBuilder.onDelete(e)})}onUpdate(e){return new rM({...this.#t,constraintBuilder:this.#t.constraintBuilder.onUpdate(e)})}deferrable(){return new rM({...this.#t,constraintBuilder:this.#t.constraintBuilder.deferrable()})}notDeferrable(){return new rM({...this.#t,constraintBuilder:this.#t.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new rM({...this.#t,constraintBuilder:this.#t.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new rM({...this.#t,constraintBuilder:this.#t.constraintBuilder.initiallyImmediate()})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(N.cloneWithTableProps(this.#t.node,{addConstraint:rS.create(this.#t.constraintBuilder.toOperationNode())}),this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class rR{#t;constructor(e){this.#t=h(e)}ifExists(){return new rR({...this.#t,node:N.cloneWithTableProps(this.#t.node,{dropConstraint:rL.cloneWith(this.#t.node.dropConstraint,{ifExists:!0})})})}cascade(){return new rR({...this.#t,node:N.cloneWithTableProps(this.#t.node,{dropConstraint:rL.cloneWith(this.#t.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new rR({...this.#t,node:N.cloneWithTableProps(this.#t.node,{dropConstraint:rL.cloneWith(this.#t.node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}let rQ=h({is:e=>"PrimaryKeyConstraintNode"===e.kind,create:(e,t)=>h({kind:"PrimaryKeyConstraintNode",columns:h(e.map(Q.create)),name:t?f.create(t):void 0}),cloneWith:(e,t)=>h({...e,...t})}),rF=h({is:e=>"AddIndexNode"===e.kind,create:e=>h({kind:"AddIndexNode",name:f.create(e)}),cloneWith:(e,t)=>h({...e,...t}),cloneWithColumns:(e,t)=>h({...e,columns:[...e.columns||[],...t]})});class r${#t;constructor(e){this.#t=h(e)}unique(){return new r$({...this.#t,node:N.cloneWithTableProps(this.#t.node,{addIndex:rF.cloneWith(this.#t.node.addIndex,{unique:!0})})})}column(e){return new r$({...this.#t,node:N.cloneWithTableProps(this.#t.node,{addIndex:rF.cloneWithColumns(this.#t.node.addIndex,[ea(e)])})})}columns(e){return new r$({...this.#t,node:N.cloneWithTableProps(this.#t.node,{addIndex:rF.cloneWithColumns(this.#t.node.addIndex,e.map(ea))})})}expression(e){return new r$({...this.#t,node:N.cloneWithTableProps(this.#t.node,{addIndex:rF.cloneWithColumns(this.#t.node.addIndex,[e.toOperationNode()])})})}using(e){return new r$({...this.#t,node:N.cloneWithTableProps(this.#t.node,{addIndex:rF.cloneWith(this.#t.node.addIndex,{using:j.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class rU{#W;constructor(e){this.#W=e}nullsNotDistinct(){return new rU(rD.cloneWith(this.#W,{nullsNotDistinct:!0}))}deferrable(){return new rU(rD.cloneWith(this.#W,{deferrable:!0}))}notDeferrable(){return new rU(rD.cloneWith(this.#W,{deferrable:!1}))}initiallyDeferred(){return new rU(rD.cloneWith(this.#W,{initiallyDeferred:!0}))}initiallyImmediate(){return new rU(rD.cloneWith(this.#W,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#W}}class rV{#W;constructor(e){this.#W=e}deferrable(){return new rV(rQ.cloneWith(this.#W,{deferrable:!0}))}notDeferrable(){return new rV(rQ.cloneWith(this.#W,{deferrable:!1}))}initiallyDeferred(){return new rV(rQ.cloneWith(this.#W,{initiallyDeferred:!0}))}initiallyImmediate(){return new rV(rQ.cloneWith(this.#W,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#W}}class rJ{#W;constructor(e){this.#W=e}$call(e){return e(this)}toOperationNode(){return this.#W}}let rj=h({is:e=>"RenameConstraintNode"===e.kind,create:(e,t)=>h({kind:"RenameConstraintNode",oldName:f.create(e),newName:f.create(t)})});class rK{#t;constructor(e){this.#t=h(e)}renameTo(e){return new rP({...this.#t,node:N.cloneWithTableProps(this.#t.node,{renameTo:rl(e)})})}setSchema(e){return new rP({...this.#t,node:N.cloneWithTableProps(this.#t.node,{setSchema:f.create(e)})})}alterColumn(e,t){let r=t(new rA(e));return new rz({...this.#t,node:N.cloneWithColumnAlteration(this.#t.node,r.toOperationNode())})}dropColumn(e){return new rz({...this.#t,node:N.cloneWithColumnAlteration(this.#t.node,ry.create(e))})}renameColumn(e,t){return new rz({...this.#t,node:N.cloneWithColumnAlteration(this.#t.node,rw.create(e,t))})}addColumn(e,t,r=l){let i=r(new rq(rf.create(e,rn(t))));return new rz({...this.#t,node:N.cloneWithColumnAlteration(this.#t.node,rN.create(i.toOperationNode()))})}modifyColumn(e,t,r=l){let i=r(new rq(rf.create(e,rn(t))));return new rz({...this.#t,node:N.cloneWithColumnAlteration(this.#t.node,rk.create(i.toOperationNode()))})}addUniqueConstraint(e,t,r=l){let i=r(new rU(rD.create(t,e)));return new rP({...this.#t,node:N.cloneWithTableProps(this.#t.node,{addConstraint:rS.create(i.toOperationNode())})})}addCheckConstraint(e,t,r=l){let i=r(new rJ(rg.create(t.toOperationNode(),e)));return new rP({...this.#t,node:N.cloneWithTableProps(this.#t.node,{addConstraint:rS.create(i.toOperationNode())})})}addForeignKeyConstraint(e,t,r,i,n=l){let o=n(new rT(rI.create(t.map(Q.create),rl(r),i.map(Q.create),e)));return new rM({...this.#t,constraintBuilder:o})}addPrimaryKeyConstraint(e,t,r=l){let i=r(new rV(rQ.create(t,e)));return new rP({...this.#t,node:N.cloneWithTableProps(this.#t.node,{addConstraint:rS.create(i.toOperationNode())})})}dropConstraint(e){return new rR({...this.#t,node:N.cloneWithTableProps(this.#t.node,{dropConstraint:rL.create(e)})})}renameConstraint(e,t){return new rR({...this.#t,node:N.cloneWithTableProps(this.#t.node,{renameConstraint:rj.create(e,t)})})}addIndex(e){return new r$({...this.#t,node:N.cloneWithTableProps(this.#t.node,{addIndex:rF.create(e)})})}dropIndex(e){return new rP({...this.#t,node:N.cloneWithTableProps(this.#t.node,{dropIndex:b.create(e)})})}$call(e){return e(this)}}class rz{#t;constructor(e){this.#t=h(e)}alterColumn(e,t){let r=t(new rA(e));return new rz({...this.#t,node:N.cloneWithColumnAlteration(this.#t.node,r.toOperationNode())})}dropColumn(e){return new rz({...this.#t,node:N.cloneWithColumnAlteration(this.#t.node,ry.create(e))})}renameColumn(e,t){return new rz({...this.#t,node:N.cloneWithColumnAlteration(this.#t.node,rw.create(e,t))})}addColumn(e,t,r=l){let i=r(new rq(rf.create(e,rn(t))));return new rz({...this.#t,node:N.cloneWithColumnAlteration(this.#t.node,rN.create(i.toOperationNode()))})}modifyColumn(e,t,r=l){let i=r(new rq(rf.create(e,rn(t))));return new rz({...this.#t,node:N.cloneWithColumnAlteration(this.#t.node,rk.create(i.toOperationNode()))})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class r_ extends tw{transformPrimitiveValueList(e){return eh.create(e.values.map(eu.createImmediate))}transformValue(e){return eu.createImmediate(e.value)}}class rG{#t;constructor(e){this.#t=h(e)}ifNotExists(){return new rG({...this.#t,node:y.cloneWith(this.#t.node,{ifNotExists:!0})})}unique(){return new rG({...this.#t,node:y.cloneWith(this.#t.node,{unique:!0})})}nullsNotDistinct(){return new rG({...this.#t,node:y.cloneWith(this.#t.node,{nullsNotDistinct:!0})})}on(e){return new rG({...this.#t,node:y.cloneWith(this.#t.node,{table:rl(e)})})}column(e){return new rG({...this.#t,node:y.cloneWithColumns(this.#t.node,[ea(e)])})}columns(e){return new rG({...this.#t,node:y.cloneWithColumns(this.#t.node,e.map(ea))})}expression(e){return new rG({...this.#t,node:y.cloneWithColumns(this.#t.node,[e.toOperationNode()])})}using(e){return new rG({...this.#t,node:y.cloneWith(this.#t.node,{using:j.createWithSql(e)})})}where(...e){let t=new r_;return new rG({...this.#t,node:e$.cloneWithWhere(this.#t.node,t.transformNode(ef(e),this.#t.queryId))})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class rH{#t;constructor(e){this.#t=h(e)}ifNotExists(){return new rH({...this.#t,node:w.cloneWith(this.#t.node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class rX{#t;constructor(e){this.#t=h(e)}temporary(){return new rX({...this.#t,node:v.cloneWith(this.#t.node,{temporary:!0})})}onCommit(e){return new rX({...this.#t,node:v.cloneWith(this.#t.node,{onCommit:function(e){if(g.includes(e))return e;throw Error(`invalid OnCommitAction ${e}`)}(e)})})}ifNotExists(){return new rX({...this.#t,node:v.cloneWith(this.#t.node,{ifNotExists:!0})})}addColumn(e,t,r=l){let i=r(new rq(rf.create(e,rn(t))));return new rX({...this.#t,node:v.cloneWithColumn(this.#t.node,i.toOperationNode())})}addPrimaryKeyConstraint(e,t,r=l){let i=r(new rV(rQ.create(t,e)));return new rX({...this.#t,node:v.cloneWithConstraint(this.#t.node,i.toOperationNode())})}addUniqueConstraint(e,t,r=l){let i=r(new rU(rD.create(t,e)));return new rX({...this.#t,node:v.cloneWithConstraint(this.#t.node,i.toOperationNode())})}addCheckConstraint(e,t,r=l){let i=r(new rJ(rg.create(t.toOperationNode(),e)));return new rX({...this.#t,node:v.cloneWithConstraint(this.#t.node,i.toOperationNode())})}addForeignKeyConstraint(e,t,r,i,n=l){let o=n(new rT(rI.create(t.map(Q.create),rl(r),i.map(Q.create),e)));return new rX({...this.#t,node:v.cloneWithConstraint(this.#t.node,o.toOperationNode())})}modifyFront(e){return new rX({...this.#t,node:v.cloneWithFrontModifier(this.#t.node,e.toOperationNode())})}modifyEnd(e){return new rX({...this.#t,node:v.cloneWithEndModifier(this.#t.node,e.toOperationNode())})}as(e){return new rX({...this.#t,node:v.cloneWith(this.#t.node,{selectQuery:ra(e)})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class rY{#t;constructor(e){this.#t=h(e)}on(e){return new rY({...this.#t,node:b.cloneWith(this.#t.node,{table:rl(e)})})}ifExists(){return new rY({...this.#t,node:b.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new rY({...this.#t,node:b.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class rZ{#t;constructor(e){this.#t=h(e)}ifExists(){return new rZ({...this.#t,node:W.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new rZ({...this.#t,node:W.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class r0{#t;constructor(e){this.#t=h(e)}ifExists(){return new r0({...this.#t,node:O.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new r0({...this.#t,node:O.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}let r1=h({is:e=>"CreateViewNode"===e.kind,create:e=>h({kind:"CreateViewNode",name:x.create(e)}),cloneWith:(e,t)=>h({...e,...t})});class r2{#N=new r_;transformQuery(e){return this.#N.transformNode(e.node,e.queryId)}transformResult(e){return Promise.resolve(e.result)}}class r3{#t;constructor(e){this.#t=h(e)}temporary(){return new r3({...this.#t,node:r1.cloneWith(this.#t.node,{temporary:!0})})}materialized(){return new r3({...this.#t,node:r1.cloneWith(this.#t.node,{materialized:!0})})}ifNotExists(){return new r3({...this.#t,node:r1.cloneWith(this.#t.node,{ifNotExists:!0})})}orReplace(){return new r3({...this.#t,node:r1.cloneWith(this.#t.node,{orReplace:!0})})}columns(e){return new r3({...this.#t,node:r1.cloneWith(this.#t.node,{columns:e.map(es)})})}as(e){let t=e.withPlugin(new r2).toOperationNode();return new r3({...this.#t,node:r1.cloneWith(this.#t.node,{as:t})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}let r8=h({is:e=>"DropViewNode"===e.kind,create:e=>h({kind:"DropViewNode",name:x.create(e)}),cloneWith:(e,t)=>h({...e,...t})});class r4{#t;constructor(e){this.#t=h(e)}materialized(){return new r4({...this.#t,node:r8.cloneWith(this.#t.node,{materialized:!0})})}ifExists(){return new r4({...this.#t,node:r8.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new r4({...this.#t,node:r8.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}let r5=h({is:e=>"CreateTypeNode"===e.kind,create:e=>h({kind:"CreateTypeNode",name:e}),cloneWithEnum:(e,t)=>h({...e,enum:eh.create(t.map(eu.createImmediate))})});class r6{#t;constructor(e){this.#t=h(e)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}asEnum(e){return new r6({...this.#t,node:r5.cloneWithEnum(this.#t.node,e)})}$call(e){return e(this)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}let r9=h({is:e=>"DropTypeNode"===e.kind,create:e=>h({kind:"DropTypeNode",name:e}),cloneWith:(e,t)=>h({...e,...t})});class r7{#t;constructor(e){this.#t=h(e)}ifExists(){return new r7({...this.#t,node:r9.cloneWith(this.#t.node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}function ie(e){if(!e.includes("."))return x.create(e);{let t=e.split(".").map(it);if(2===t.length)return x.createWithSchema(t[0],t[1]);throw Error(`invalid schemable identifier ${e}`)}}function it(e){return e.trim()}let ir=h({is:e=>"RefreshMaterializedViewNode"===e.kind,create:e=>h({kind:"RefreshMaterializedViewNode",name:x.create(e)}),cloneWith:(e,t)=>h({...e,...t})});class ii{#t;constructor(e){this.#t=h(e)}concurrently(){return new ii({...this.#t,node:ir.cloneWith(this.#t.node,{concurrently:!0,withNoData:!1})})}withData(){return new ii({...this.#t,node:ir.cloneWith(this.#t.node,{withNoData:!1})})}withNoData(){return new ii({...this.#t,node:ir.cloneWith(this.#t.node,{withNoData:!0,concurrently:!1})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}class io{#L;constructor(e){this.#L=e}createTable(e){return new rX({queryId:tf(),executor:this.#L,node:v.create(rl(e))})}dropTable(e){return new r0({queryId:tf(),executor:this.#L,node:O.create(rl(e))})}createIndex(e){return new rG({queryId:tf(),executor:this.#L,node:y.create(e)})}dropIndex(e){return new rY({queryId:tf(),executor:this.#L,node:b.create(e)})}createSchema(e){return new rH({queryId:tf(),executor:this.#L,node:w.create(e)})}dropSchema(e){return new rZ({queryId:tf(),executor:this.#L,node:W.create(e)})}alterTable(e){return new rK({queryId:tf(),executor:this.#L,node:N.create(rl(e))})}createView(e){return new r3({queryId:tf(),executor:this.#L,node:r1.create(e)})}refreshMaterializedView(e){return new ii({queryId:tf(),executor:this.#L,node:ir.create(e)})}dropView(e){return new r4({queryId:tf(),executor:this.#L,node:r8.create(e)})}createType(e){return new r6({queryId:tf(),executor:this.#L,node:r5.create(ie(e))})}dropType(e){return new r7({queryId:tf(),executor:this.#L,node:r9.create(ie(e))})}withPlugin(e){return new io(this.#L.withPlugin(e))}withoutPlugins(){return new io(this.#L.withoutPlugins())}withSchema(e){return new io(this.#L.withPluginAtFront(new tb(e)))}}class is{ref(e){return new U(e)}}class ia{#E;constructor(e){this.#E=e}async provideConnection(e){let t=await this.#E.acquireConnection();try{return await e(t)}finally{await this.#E.releaseConnection(t)}}}class id extends tT{#A;#B;#P;constructor(e,t,r,i=[]){super(i),this.#A=e,this.#B=t,this.#P=r}get adapter(){return this.#B}compileQuery(e,t){return this.#A.compileQuery(e,t)}provideConnection(e){return this.#P.provideConnection(e)}withPlugins(e){return new id(this.#A,this.#B,this.#P,[...this.plugins,...e])}withPlugin(e){return new id(this.#A,this.#B,this.#P,[...this.plugins,e])}withPluginAtFront(e){return new id(this.#A,this.#B,this.#P,[e,...this.plugins])}withConnectionProvider(e){return new id(this.#A,this.#B,e,[...this.plugins])}withoutPlugins(){return new id(this.#A,this.#B,this.#P,[])}}function ip(){return"undefined"!=typeof performance&&d(performance.now)?performance.now():Date.now()}class ih{#E;#M;#R;#Q;#F;#$=new WeakSet;constructor(e,t){this.#Q=!1,this.#E=e,this.#M=t}async init(){if(this.#F)throw Error("driver has already been destroyed");this.#R||(this.#R=this.#E.init().then(()=>{this.#Q=!0}).catch(e=>(this.#R=void 0,Promise.reject(e)))),await this.#R}async acquireConnection(){if(this.#F)throw Error("driver has already been destroyed");this.#Q||await this.init();let e=await this.#E.acquireConnection();return this.#$.has(e)||(this.#U()&&this.#V(e),this.#$.add(e)),e}async releaseConnection(e){await this.#E.releaseConnection(e)}beginTransaction(e,t){return this.#E.beginTransaction(e,t)}commitTransaction(e){return this.#E.commitTransaction(e)}rollbackTransaction(e){return this.#E.rollbackTransaction(e)}savepoint(e,t,r){if(this.#E.savepoint)return this.#E.savepoint(e,t,r);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(e,t,r){if(this.#E.rollbackToSavepoint)return this.#E.rollbackToSavepoint(e,t,r);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(e,t,r){if(this.#E.releaseSavepoint)return this.#E.releaseSavepoint(e,t,r);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#R&&(await this.#R,this.#F||(this.#F=this.#E.destroy().catch(e=>(this.#F=void 0,Promise.reject(e)))),await this.#F)}#U(){return this.#M.isLevelEnabled("query")||this.#M.isLevelEnabled("error")}#V(e){let t=e.executeQuery,r=e.streamQuery,i=this;e.executeQuery=async r=>{let n,o=ip();try{return await t.call(e,r)}catch(e){throw n=e,await i.#J(e,r,o),e}finally{n||await i.#j(r,o)}},e.streamQuery=async function*(t,n){let o,s=ip();try{for await(let i of r.call(e,t,n))yield i}catch(e){throw o=e,await i.#J(e,t,s),e}finally{o||await i.#j(t,s,!0)}}}async #J(e,t,r){await this.#M.error(()=>({level:"error",error:e,query:t,queryDurationMillis:this.#K(r)}))}async #j(e,t,r=!1){await this.#M.query(()=>({level:"query",isStream:r,query:e,queryDurationMillis:this.#K(t)}))}#K(e){return ip()-e}}let iu=()=>{};class ic{#z;#_;constructor(e){this.#z=e}async provideConnection(e){for(;this.#_;)await this.#_.catch(iu);return this.#_=this.#G(e).finally(()=>{this.#_=void 0}),this.#_}async #G(e){return await e(this.#z)}}let il=["read only","read write"],im=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function iN(e){if(e.accessMode&&!il.includes(e.accessMode))throw Error(`invalid transaction access mode ${e.accessMode}`);if(e.isolationLevel&&!im.includes(e.isolationLevel))throw Error(`invalid transaction isolation level ${e.isolationLevel}`)}h(["query","error"]);class iy{#H;#X;constructor(e){d(e)?(this.#X=e,this.#H=h({query:!0,error:!0})):(this.#X=iw,this.#H=h({query:e.includes("query"),error:e.includes("error")}))}isLevelEnabled(e){return this.#H[e]}async query(e){this.#H.query&&await this.#X(e())}async error(e){this.#H.error&&await this.#X(e())}}function iw(e){if("query"===e.level){let t=`kysely:query:${e.isStream?"stream:":""}`;console.log(`${t} ${e.query.sql}`),console.log(`${t} duration: ${e.queryDurationMillis.toFixed(1)}ms`)}else"error"===e.level&&(e.error instanceof Error?console.error(`kysely:error: ${e.error.stack??e.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:e.error,query:e.query.sql,queryDurationMillis:e.queryDurationMillis})}`))}Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class ig extends tM{#t;constructor(e){let t,r;if(function(e){return p(e)&&p(e.config)&&p(e.driver)&&p(e.executor)&&p(e.dialect)}(e))t={executor:e.executor},r={...e};else{const i=e.dialect,n=i.createDriver(),o=i.createQueryCompiler(),s=i.createAdapter(),a=new ih(n,new iy(e.log??[])),d=new id(o,s,new ia(a),e.plugins??[]);t={executor:d},r={config:e,executor:d,dialect:i,driver:a}}super(t),this.#t=h(r)}get schema(){return new io(this.#t.executor)}get dynamic(){return new is}get introspection(){return this.#t.dialect.createIntrospector(this.withoutPlugins())}case(e){return new t2({node:t1.create(i(e)?void 0:ra(e))})}get fn(){return tZ()}transaction(){return new ib({...this.#t})}startTransaction(){return new iW({...this.#t})}connection(){return new ix({...this.#t})}withPlugin(e){return new ig({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new ig({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new ig({...this.#t,executor:this.#t.executor.withPluginAtFront(new tb(e))})}withTables(){return new ig({...this.#t})}async destroy(){await this.#t.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#t.executor}executeQuery(e,t=tf()){let r=p(e)&&d(e.compile)?e.compile():e;return this.getExecutor().executeQuery(r,t)}async [Symbol.asyncDispose](){await this.destroy()}}class iv extends ig{#t;constructor(e){super(e),this.#t=e}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(e){return new iv({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new iv({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new iv({...this.#t,executor:this.#t.executor.withPluginAtFront(new tb(e))})}withTables(){return new iv({...this.#t})}}class ix{#t;constructor(e){this.#t=h(e)}async execute(e){return this.#t.executor.provideConnection(async t=>{let r=this.#t.executor.withConnectionProvider(new ic(t)),i=new ig({...this.#t,executor:r});return await e(i)})}}class ib{#t;constructor(e){this.#t=h(e)}setAccessMode(e){return new ib({...this.#t,accessMode:e})}setIsolationLevel(e){return new ib({...this.#t,isolationLevel:e})}async execute(e){let{isolationLevel:t,accessMode:r,...i}=this.#t,n={isolationLevel:t,accessMode:r};return iN(n),this.#t.executor.provideConnection(async t=>{let r=this.#t.executor.withConnectionProvider(new ic(t)),o=new iv({...i,executor:r});try{await this.#t.driver.beginTransaction(t,n);let r=await e(o);return await this.#t.driver.commitTransaction(t),r}catch(e){throw await this.#t.driver.rollbackTransaction(t),e}})}}class iW{#t;constructor(e){this.#t=h(e)}setAccessMode(e){return new iW({...this.#t,accessMode:e})}setIsolationLevel(e){return new iW({...this.#t,isolationLevel:e})}async execute(){let{isolationLevel:e,accessMode:t,...r}=this.#t,i={isolationLevel:e,accessMode:t};iN(i);let n=await tk(this.#t.executor);return await this.#t.driver.beginTransaction(n.connection,i),new iO({...r,connection:n,executor:this.#t.executor.withConnectionProvider(new ic(n.connection))})}}class iO extends iv{#t;#Y;#Z;constructor(e){const t={isCommitted:!1,isRolledBack:!1},{connection:r,...i}=e={...e,executor:new ik(e.executor,t)};super(i),this.#t=h(e),this.#Z=t;const n=tf();this.#Y=t=>e.executor.compileQuery(t,n)}get isCommitted(){return this.#Z.isCommitted}get isRolledBack(){return this.#Z.isRolledBack}commit(){return iq(this.#Z),new iC(async()=>{await this.#t.driver.commitTransaction(this.#t.connection.connection),this.#Z.isCommitted=!0,this.#t.connection.release()})}rollback(){return iq(this.#Z),new iC(async()=>{await this.#t.driver.rollbackTransaction(this.#t.connection.connection),this.#Z.isRolledBack=!0,this.#t.connection.release()})}savepoint(e){return iq(this.#Z),new iC(async()=>(await this.#t.driver.savepoint?.(this.#t.connection.connection,e,this.#Y),new iO({...this.#t})))}rollbackToSavepoint(e){return iq(this.#Z),new iC(async()=>(await this.#t.driver.rollbackToSavepoint?.(this.#t.connection.connection,e,this.#Y),new iO({...this.#t})))}releaseSavepoint(e){return iq(this.#Z),new iC(async()=>(await this.#t.driver.releaseSavepoint?.(this.#t.connection.connection,e,this.#Y),new iO({...this.#t})))}withPlugin(e){return new iO({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new iO({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new iO({...this.#t,executor:this.#t.executor.withPluginAtFront(new tb(e))})}withTables(){return new iO({...this.#t})}}class iC{#ee;constructor(e){this.#ee=e}async execute(){return await this.#ee()}}function iq(e){if(e.isCommitted)throw Error("Transaction is already committed");if(e.isRolledBack)throw Error("Transaction is already rolled back")}class ik{#L;#Z;constructor(e,t){e instanceof ik?this.#L=e.#L:this.#L=e,this.#Z=t}get adapter(){return this.#L.adapter}get plugins(){return this.#L.plugins}transformQuery(e,t){return this.#L.transformQuery(e,t)}compileQuery(e,t){return this.#L.compileQuery(e,t)}provideConnection(e){return this.#L.provideConnection(e)}executeQuery(e,t){return iq(this.#Z),this.#L.executeQuery(e,t)}stream(e,t,r){return iq(this.#Z),this.#L.stream(e,t,r)}withConnectionProvider(e){return new ik(this.#L.withConnectionProvider(e),this.#Z)}withPlugin(e){return new ik(this.#L.withPlugin(e),this.#Z)}withPlugins(e){return new ik(this.#L.withPlugins(e),this.#Z)}withPluginAtFront(e){return new ik(this.#L.withPluginAtFront(e),this.#Z)}withoutPlugins(){return new ik(this.#L.withoutPlugins(),this.#Z)}}function iI(e,t){return j.createWithChildren([j.createWithSql(`${e} `),f.create(t)])}let iT=h({raw:(e,t=[])=>h({sql:e,query:j.createWithSql(e),parameters:h(t),queryId:tf()})}),iS=Symbol();class iD{#et;#$=new WeakMap;#er;constructor(e){this.#et=h({...e})}async init(){this.#er=d(this.#et.pool)?await this.#et.pool():this.#et.pool}async acquireConnection(){let e=await this.#er.connect(),t=this.#$.get(e);return!t&&(t=new iL(e,{cursor:this.#et.cursor??null}),this.#$.set(e,t),this.#et.onCreateConnection&&await this.#et.onCreateConnection(t)),this.#et.onReserveConnection&&await this.#et.onReserveConnection(t),t}async beginTransaction(e,t){if(t.isolationLevel||t.accessMode){let r="start transaction";t.isolationLevel&&(r+=` isolation level ${t.isolationLevel}`),t.accessMode&&(r+=` ${t.accessMode}`),await e.executeQuery(iT.raw(r))}else await e.executeQuery(iT.raw("begin"))}async commitTransaction(e){await e.executeQuery(iT.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(iT.raw("rollback"))}async savepoint(e,t,r){await e.executeQuery(r(iI("savepoint",t),tf()))}async rollbackToSavepoint(e,t,r){await e.executeQuery(r(iI("rollback to",t),tf()))}async releaseSavepoint(e,t,r){await e.executeQuery(r(iI("release",t),tf()))}async releaseConnection(e){e[iS]()}async destroy(){if(this.#er){let e=this.#er;this.#er=void 0,await e.end()}}}class iL{#ei;#en;constructor(e,t){this.#ei=e,this.#en=t}async executeQuery(e){try{let{command:t,rowCount:r,rows:i}=await this.#ei.query(e.sql,[...e.parameters]);return{numAffectedRows:"INSERT"===t||"UPDATE"===t||"DELETE"===t||"MERGE"===t?BigInt(r):void 0,rows:i??[]}}catch(e){throw function(e,t){var r;if(p(r=e)&&n(r.stack)&&t.stack){let r=t.stack.split("\n").slice(1).join("\n");e.stack+=`
${r}`}return e}(e,Error())}}async *streamQuery(e,t){if(!this.#en.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(t)||t<=0)throw Error("chunkSize must be a positive integer");let r=this.#ei.query(new this.#en.cursor(e.sql,e.parameters.slice()));try{for(;;){let e=await r.read(t);if(0===e.length)break;yield{rows:e}}}finally{await r.close()}}[iS](){this.#ei.release()}}h({__noMigrations__:!0});class iE{#t;constructor(e){this.#t=h(e)}get expressionType(){}get isRawBuilder(){return!0}as(e){return new iB(this,e)}$castTo(){return new iE({...this.#t})}$notNull(){return new iE(this.#t)}withPlugin(e){return new iE({...this.#t,plugins:void 0!==this.#t.plugins?h([...this.#t.plugins,e]):h([e])})}toOperationNode(){return this.#eo(this.#es())}compile(e){return this.#ea(this.#es(e))}async execute(e){let t=this.#es(e);return t.executeQuery(this.#ea(t),this.#t.queryId)}#es(e){let t=void 0!==e?e.getExecutor():tD;return void 0!==this.#t.plugins?t.withPlugins(this.#t.plugins):t}#eo(e){return e.transformQuery(this.#t.rawNode,this.#t.queryId)}#ea(e){return e.compileQuery(this.#eo(e),this.#t.queryId)}}function iA(e){return new iE(e)}class iB{#ed;#C;constructor(e,t){this.#ed=e,this.#C=t}get expression(){return this.#ed}get alias(){return this.#C}get rawBuilder(){return this.#ed}toOperationNode(){return C.create(this.#ed.toOperationNode(),k(this.#C)?this.#C.toOperationNode():f.create(this.#C))}}let iP=Object.assign((e,...t)=>iA({queryId:tf(),rawNode:j.create(e,t?.map(iM)??[])}),{ref:e=>iA({queryId:tf(),rawNode:j.createWithChild(eo(e))}),val:e=>iA({queryId:tf(),rawNode:j.createWithChild(ec(e))}),value(e){return this.val(e)},table:e=>iA({queryId:tf(),rawNode:j.createWithChild(rl(e))}),id(...e){let t=Array(e.length+1).fill(".");return t[0]="",t[t.length-1]="",iA({queryId:tf(),rawNode:j.create(t,e.map(f.create))})},lit:e=>iA({queryId:tf(),rawNode:j.createWithChild(eu.createImmediate(e))}),literal(e){return this.lit(e)},raw:e=>iA({queryId:tf(),rawNode:j.createWithSql(e)}),join(e,t=iP`, `){let r=Array(Math.max(2*e.length-1,0)),i=t.toOperationNode();for(let t=0;t<e.length;++t)r[2*t]=iM(e[t]),t!==e.length-1&&(r[2*t+1]=i);return iA({queryId:tf(),rawNode:j.createWithChildren(r)})}});function iM(e){return k(e)?e.toOperationNode():ec(e)}e.s(["sql",0,iP],705590);class iR{#ep;constructor(e){this.#ep=e}async getSchemas(){return(await this.#ep.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(e=>({name:e.nspname}))}async getTables(e={withInternalKyselyTables:!1}){let t=this.#ep.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",iP`col_description(a.attrelid, a.attnum)`.as("column_description"),iP`pg_get_serial_sequence(ns.nspname || '.' || c.relname, a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();e.withInternalKyselyTables||(t=t.where("c.relname","!=","kysely_migration").where("c.relname","!=","kysely_migration_lock"));let r=await t.execute();return this.#eh(r)}async getMetadata(e){return{tables:await this.getTables(e)}}#eh(e){return e.reduce((e,t)=>{let r=e.find(e=>e.name===t.table&&e.schema===t.schema);return r||(r=h({name:t.table,isView:"v"===t.table_type,schema:t.schema,columns:[]}),e.push(r)),r.columns.push(h({name:t.column,dataType:t.type,dataTypeSchema:t.type_schema,isNullable:!t.not_null,isAutoIncrementing:null!==t.auto_incrementing,hasDefaultValue:t.has_default,comment:t.column_description??void 0})),e},[])}}class iQ{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#eu=h({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)});visitNode=e=>{this.nodeStack.push(e),this.#eu[e.kind](e),this.nodeStack.pop()}}let iF=/'/g;class i$ extends iQ{#ec="";#el=[];get numParameters(){return this.#el.length}compileQuery(e,t){return this.#ec="",this.#el=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(e),h({query:e,queryId:t,sql:this.getSql(),parameters:[...this.#el]})}getSql(){return this.#ec}visitSelectQuery(e){let t=void 0!==this.parentNode&&!eN.is(this.parentNode)&&!eS.is(this.parentNode)&&!v.is(this.parentNode)&&!r1.is(this.parentNode)&&!t$.is(this.parentNode);void 0===this.parentNode&&e.explain&&(this.visitNode(e.explain),this.append(" ")),t&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("select"),e.distinctOn&&(this.append(" "),this.compileDistinctOn(e.distinctOn)),e.frontModifiers?.length&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.top&&(this.append(" "),this.visitNode(e.top)),e.selections&&(this.append(" "),this.compileList(e.selections)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.groupBy&&(this.append(" "),this.visitNode(e.groupBy)),e.having&&(this.append(" "),this.visitNode(e.having)),e.setOperations&&(this.append(" "),this.compileList(e.setOperations," ")),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.offset&&(this.append(" "),this.visitNode(e.offset)),e.fetch&&(this.append(" "),this.visitNode(e.fetch)),e.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...e.endModifiers])," ")),t&&this.append(")")}visitFrom(e){this.append("from "),this.compileList(e.froms)}visitSelection(e){this.visitNode(e.selection)}visitColumn(e){this.visitNode(e.column)}compileDistinctOn(e){this.append("distinct on ("),this.compileList(e),this.append(")")}compileList(e,t=", "){let r=e.length-1;for(let i=0;i<=r;i++)this.visitNode(e[i]),i<r&&this.append(t)}visitWhere(e){this.append("where "),this.visitNode(e.where)}visitHaving(e){this.append("having "),this.visitNode(e.having)}visitInsertQuery(e){let t=this.nodeStack.find(e$.is),r=t!==e;!r&&e.explain&&(this.visitNode(e.explain),this.append(" ")),r&&!eQ.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append(e.replace?"replace":"insert"),e.ignore&&(_("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),e.orAction&&(this.append(" "),this.visitNode(e.orAction)),e.top&&(this.append(" "),this.visitNode(e.top)),e.into&&(this.append(" into "),this.visitNode(e.into)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.output&&(this.append(" "),this.visitNode(e.output)),e.values&&(this.append(" "),this.visitNode(e.values)),e.defaultValues&&(this.append(" "),this.append("default values")),e.onConflict&&(this.append(" "),this.visitNode(e.onConflict)),e.onDuplicateKey&&(this.append(" "),this.visitNode(e.onDuplicateKey)),e.returning&&(this.append(" "),this.visitNode(e.returning)),r&&!eQ.is(t)&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitValues(e){this.append("values "),this.compileList(e.values)}visitDeleteQuery(e){let t=this.nodeStack.find(e$.is)!==e;!t&&e.explain&&(this.visitNode(e.explain),this.append(" ")),t&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("delete "),e.top&&(this.visitNode(e.top),this.append(" ")),this.visitNode(e.from),e.output&&(this.append(" "),this.visitNode(e.output)),e.using&&(this.append(" "),this.visitNode(e.using)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),t&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitReturning(e){this.append("returning "),this.compileList(e.selections)}visitAlias(e){this.visitNode(e.node),this.append(" as "),this.visitNode(e.alias)}visitReference(e){e.table&&(this.visitNode(e.table),this.append(".")),this.visitNode(e.column)}visitSelectAll(e){this.append("*")}visitIdentifier(e){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(e),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(e){if(!n(e.name))throw Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(e.name))}visitAnd(e){this.visitNode(e.left),this.append(" and "),this.visitNode(e.right)}visitOr(e){this.visitNode(e.left),this.append(" or "),this.visitNode(e.right)}visitValue(e){e.immediate?this.appendImmediateValue(e.value):this.appendValue(e.value)}visitValueList(e){this.append("("),this.compileList(e.values),this.append(")")}visitTuple(e){this.append("("),this.compileList(e.values),this.append(")")}visitPrimitiveValueList(e){this.append("(");let{values:t}=e;for(let e=0;e<t.length;++e)this.appendValue(t[e]),e!==t.length-1&&this.append(", ");this.append(")")}visitParens(e){this.append("("),this.visitNode(e.node),this.append(")")}visitJoin(e){this.append(iJ[e.joinType]),this.append(" "),this.visitNode(e.table),e.on&&(this.append(" "),this.visitNode(e.on))}visitOn(e){this.append("on "),this.visitNode(e.on)}visitRaw(e){let{sqlFragments:t,parameters:r}=e;for(let e=0;e<t.length;++e)this.append(t[e]),r.length>e&&this.visitNode(r[e])}visitOperator(e){this.append(e.operator)}visitTable(e){this.visitNode(e.table)}visitSchemableIdentifier(e){e.schema&&(this.visitNode(e.schema),this.append(".")),this.visitNode(e.identifier)}visitCreateTable(e){this.append("create "),e.frontModifiers&&e.frontModifiers.length>0&&(this.compileList(e.frontModifiers," "),this.append(" ")),e.temporary&&this.append("temporary "),this.append("table "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.table),e.selectQuery?(this.append(" as "),this.visitNode(e.selectQuery)):(this.append(" ("),this.compileList([...e.columns,...e.constraints??[]]),this.append(")"),e.onCommit&&(this.append(" on commit "),this.append(e.onCommit)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," ")))}visitColumnDefinition(e){e.ifNotExists&&this.append("if not exists "),this.visitNode(e.column),this.append(" "),this.visitNode(e.dataType),e.unsigned&&this.append(" unsigned"),e.frontModifiers&&e.frontModifiers.length>0&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.generated&&(this.append(" "),this.visitNode(e.generated)),e.identity&&this.append(" identity"),e.defaultTo&&(this.append(" "),this.visitNode(e.defaultTo)),e.notNull&&this.append(" not null"),e.unique&&this.append(" unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.primaryKey&&this.append(" primary key"),e.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),e.references&&(this.append(" "),this.visitNode(e.references)),e.check&&(this.append(" "),this.visitNode(e.check)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(e){this.append("references "),this.visitNode(e.table),this.append(" ("),this.compileList(e.columns),this.append(")"),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate))}visitDropTable(e){this.append("drop table "),e.ifExists&&this.append("if exists "),this.visitNode(e.table),e.cascade&&this.append(" cascade")}visitDataType(e){this.append(e.dataType)}visitOrderBy(e){this.append("order by "),this.compileList(e.items)}visitOrderByItem(e){this.visitNode(e.orderBy),e.collation&&(this.append(" "),this.visitNode(e.collation)),e.direction&&(this.append(" "),this.visitNode(e.direction)),e.nulls&&(this.append(" nulls "),this.append(e.nulls))}visitGroupBy(e){this.append("group by "),this.compileList(e.items)}visitGroupByItem(e){this.visitNode(e.groupBy)}visitUpdateQuery(e){let t=this.nodeStack.find(e$.is),r=t!==e;if(!r&&e.explain&&(this.visitNode(e.explain),this.append(" ")),r&&!eQ.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("update "),e.top&&(this.visitNode(e.top),this.append(" ")),e.table&&(this.visitNode(e.table),this.append(" ")),this.append("set "),e.updates&&this.compileList(e.updates),e.output&&(this.append(" "),this.visitNode(e.output)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins){if(!e.from)throw Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(e.joins," ")}e.where&&(this.append(" "),this.visitNode(e.where)),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),r&&!eQ.is(t)&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitColumnUpdate(e){this.visitNode(e.column),this.append(" = "),this.visitNode(e.value)}visitLimit(e){this.append("limit "),this.visitNode(e.limit)}visitOffset(e){this.append("offset "),this.visitNode(e.offset)}visitOnConflict(e){this.append("on conflict"),e.columns?(this.append(" ("),this.compileList(e.columns),this.append(")")):e.constraint?(this.append(" on constraint "),this.visitNode(e.constraint)):e.indexExpression&&(this.append(" ("),this.visitNode(e.indexExpression),this.append(")")),e.indexWhere&&(this.append(" "),this.visitNode(e.indexWhere)),!0===e.doNothing?this.append(" do nothing"):e.updates&&(this.append(" do update set "),this.compileList(e.updates),e.updateWhere&&(this.append(" "),this.visitNode(e.updateWhere)))}visitOnDuplicateKey(e){this.append("on duplicate key update "),this.compileList(e.updates)}visitCreateIndex(e){this.append("create "),e.unique&&this.append("unique "),this.append("index "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.using&&(this.append(" using "),this.visitNode(e.using)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.where&&(this.append(" "),this.visitNode(e.where))}visitDropIndex(e){this.append("drop index "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.cascade&&this.append(" cascade")}visitCreateSchema(e){this.append("create schema "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.schema)}visitDropSchema(e){this.append("drop schema "),e.ifExists&&this.append("if exists "),this.visitNode(e.schema),e.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("primary key ("),this.compileList(e.columns),this.append(")"),this.buildDeferrable(e)}buildDeferrable(e){void 0!==e.deferrable&&(e.deferrable?this.append(" deferrable"):this.append(" not deferrable")),void 0!==e.initiallyDeferred&&(e.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(e.columns),this.append(")"),this.buildDeferrable(e)}visitCheckConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("check ("),this.visitNode(e.expression),this.append(")")}visitForeignKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("foreign key ("),this.compileList(e.columns),this.append(") "),this.visitNode(e.references),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate)),this.buildDeferrable(e)}visitList(e){this.compileList(e.items)}visitWith(e){this.append("with "),e.recursive&&this.append("recursive "),this.compileList(e.expressions)}visitCommonTableExpression(e){this.visitNode(e.name),this.append(" as "),s(e.materialized)&&(e.materialized||this.append("not "),this.append("materialized ")),this.visitNode(e.expression)}visitCommonTableExpressionName(e){this.visitNode(e.table),e.columns&&(this.append("("),this.compileList(e.columns),this.append(")"))}visitAlterTable(e){this.append("alter table "),this.visitNode(e.table),this.append(" "),e.renameTo&&(this.append("rename to "),this.visitNode(e.renameTo)),e.setSchema&&(this.append("set schema "),this.visitNode(e.setSchema)),e.addConstraint&&this.visitNode(e.addConstraint),e.dropConstraint&&this.visitNode(e.dropConstraint),e.renameConstraint&&this.visitNode(e.renameConstraint),e.columnAlterations&&this.compileColumnAlterations(e.columnAlterations),e.addIndex&&this.visitNode(e.addIndex),e.dropIndex&&this.visitNode(e.dropIndex)}visitAddColumn(e){this.append("add column "),this.visitNode(e.column)}visitRenameColumn(e){this.append("rename column "),this.visitNode(e.column),this.append(" to "),this.visitNode(e.renameTo)}visitDropColumn(e){this.append("drop column "),this.visitNode(e.column)}visitAlterColumn(e){this.append("alter column "),this.visitNode(e.column),this.append(" "),e.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(e.dataType),e.dataTypeExpression&&(this.append("using "),this.visitNode(e.dataTypeExpression))),e.setDefault&&(this.append("set default "),this.visitNode(e.setDefault)),e.dropDefault&&this.append("drop default"),e.setNotNull&&this.append("set not null"),e.dropNotNull&&this.append("drop not null")}visitModifyColumn(e){this.append("modify column "),this.visitNode(e.column)}visitAddConstraint(e){this.append("add "),this.visitNode(e.constraint)}visitDropConstraint(e){this.append("drop constraint "),e.ifExists&&this.append("if exists "),this.visitNode(e.constraintName),"cascade"===e.modifier?this.append(" cascade"):"restrict"===e.modifier&&this.append(" restrict")}visitRenameConstraint(e){this.append("rename constraint "),this.visitNode(e.oldName),this.append(" to "),this.visitNode(e.newName)}visitSetOperation(e){this.append(e.operator),this.append(" "),e.all&&this.append("all "),this.visitNode(e.expression)}visitCreateView(e){this.append("create "),e.orReplace&&this.append("or replace "),e.materialized&&this.append("materialized "),e.temporary&&this.append("temporary "),this.append("view "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),this.append(" "),e.columns&&(this.append("("),this.compileList(e.columns),this.append(") ")),e.as&&(this.append("as "),this.visitNode(e.as))}visitRefreshMaterializedView(e){this.append("refresh materialized view "),e.concurrently&&this.append("concurrently "),this.visitNode(e.name),e.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(e){this.append("drop "),e.materialized&&this.append("materialized "),this.append("view "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.cascade&&this.append(" cascade")}visitGenerated(e){this.append("generated "),e.always&&this.append("always "),e.byDefault&&this.append("by default "),this.append("as "),e.identity&&this.append("identity"),e.expression&&(this.append("("),this.visitNode(e.expression),this.append(")")),e.stored&&this.append(" stored")}visitDefaultValue(e){this.append("default "),this.visitNode(e.defaultValue)}visitSelectModifier(e){e.rawModifier?this.visitNode(e.rawModifier):this.append(iU[e.modifier]),e.of&&(this.append(" of "),this.compileList(e.of,", "))}visitCreateType(e){this.append("create type "),this.visitNode(e.name),e.enum&&(this.append(" as enum "),this.visitNode(e.enum))}visitDropType(e){this.append("drop type "),e.ifExists&&this.append("if exists "),this.visitNode(e.name)}visitExplain(e){this.append("explain"),(e.options||e.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),e.options&&(this.visitNode(e.options),e.format&&this.append(this.getExplainOptionsDelimiter())),e.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(e.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(e){this.append("default")}visitAggregateFunction(e){this.append(e.func),this.append("("),e.distinct&&this.append("distinct "),this.compileList(e.aggregated),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),this.append(")"),e.withinGroup&&(this.append(" within group ("),this.visitNode(e.withinGroup),this.append(")")),e.filter&&(this.append(" filter("),this.visitNode(e.filter),this.append(")")),e.over&&(this.append(" "),this.visitNode(e.over))}visitOver(e){this.append("over("),e.partitionBy&&(this.visitNode(e.partitionBy),e.orderBy&&this.append(" ")),e.orderBy&&this.visitNode(e.orderBy),this.append(")")}visitPartitionBy(e){this.append("partition by "),this.compileList(e.items)}visitPartitionByItem(e){this.visitNode(e.partitionBy)}visitBinaryOperation(e){this.visitNode(e.leftOperand),this.append(" "),this.visitNode(e.operator),this.append(" "),this.visitNode(e.rightOperand)}visitUnaryOperation(e){this.visitNode(e.operator),this.isMinusOperator(e.operator)||this.append(" "),this.visitNode(e.operand)}isMinusOperator(e){return M.is(e)&&"-"===e.operator}visitUsing(e){this.append("using "),this.compileList(e.tables)}visitFunction(e){this.append(e.func),this.append("("),this.compileList(e.arguments),this.append(")")}visitCase(e){this.append("case"),e.value&&(this.append(" "),this.visitNode(e.value)),e.when&&(this.append(" "),this.compileList(e.when," ")),e.else&&(this.append(" else "),this.visitNode(e.else)),this.append(" end"),e.isStatement&&this.append(" case")}visitWhen(e){this.append("when "),this.visitNode(e.condition),e.result&&(this.append(" then "),this.visitNode(e.result))}visitJSONReference(e){this.visitNode(e.reference),this.visitNode(e.traversal)}visitJSONPath(e){for(let t of(e.inOperator&&this.visitNode(e.inOperator),this.append("'$"),e.pathLegs))this.visitNode(t);this.append("'")}visitJSONPathLeg(e){let t="ArrayLocation"===e.type;this.append(t?"[":"."),this.append(String(e.value)),t&&this.append("]")}visitJSONOperatorChain(e){for(let t=0,r=e.values.length;t<r;t++)t===r-1?this.visitNode(e.operator):this.append("->"),this.visitNode(e.values[t])}visitMergeQuery(e){e.with&&(this.visitNode(e.with),this.append(" ")),this.append("merge "),e.top&&(this.visitNode(e.top),this.append(" ")),this.append("into "),this.visitNode(e.into),e.using&&(this.append(" "),this.visitNode(e.using)),e.whens&&(this.append(" "),this.compileList(e.whens," ")),e.returning&&(this.append(" "),this.visitNode(e.returning)),e.output&&(this.append(" "),this.visitNode(e.output)),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitMatched(e){e.not&&this.append("not "),this.append("matched"),e.bySource&&this.append(" by source")}visitAddIndex(e){this.append("add "),e.unique&&this.append("unique "),this.append("index "),this.visitNode(e.name),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.using&&(this.append(" using "),this.visitNode(e.using))}visitCast(e){this.append("cast("),this.visitNode(e.expression),this.append(" as "),this.visitNode(e.dataType),this.append(")")}visitFetch(e){this.append("fetch next "),this.visitNode(e.rowCount),this.append(` rows ${e.modifier}`)}visitOutput(e){this.append("output "),this.compileList(e.selections)}visitTop(e){this.append(`top(${e.expression})`),e.modifiers&&this.append(` ${e.modifiers}`)}visitOrAction(e){this.append(e.action)}visitCollate(e){this.append("collate "),this.visitNode(e.collation)}append(e){this.#ec+=e}appendValue(e){this.addParameter(e),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(e){let t=this.getLeftIdentifierWrapper(),r=this.getRightIdentifierWrapper(),i="";for(let n of e)i+=n,n===t?i+=t:n===r&&(i+=r);return i}sanitizeStringLiteral(e){return e.replace(iF,"''")}addParameter(e){this.#el.push(e)}appendImmediateValue(e){if(n(e))this.appendStringLiteral(e);else if(o(e)||s(e))this.append(e.toString());else if(null===e)this.append("null");else if(e instanceof Date)this.appendImmediateValue(e.toISOString());else if(a(e))this.appendImmediateValue(e.toString());else throw Error(`invalid immediate value ${e}`)}appendStringLiteral(e){this.append("'"),this.append(this.sanitizeStringLiteral(e)),this.append("'")}sortSelectModifiers(e){return e.sort((e,t)=>e.modifier&&t.modifier?iV[e.modifier]-iV[t.modifier]:1),h(e)}compileColumnAlterations(e){this.compileList(e)}announcesNewColumnDataType(){return!0}}let iU=h({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),iV=h({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),iJ=h({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"}),ij=/"/g;class iK extends i${sanitizeIdentifier(e){return e.replace(ij,'""')}}class iz{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}let i_=BigInt("3853314791062309107");class iG extends iz{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(e,t){await iP`select pg_advisory_xact_lock(${iP.lit(i_)})`.execute(e)}async releaseMigrationLock(e,t){}}class iH{#et;constructor(e){this.#et=e}createDriver(){return new iD(this.#et)}createQueryCompiler(){return new iK}createAdapter(){return new iG}createIntrospector(e){return new iR(e)}}class iX extends tw{#em;constructor(e){super(),this.#em=e}transformIdentifier(e,t){return{...e=super.transformIdentifier(e,t),name:this.#em(e.name)}}}function iY(e){return e>="0"&&e<="9"}function iZ(e){let t=new Map;return r=>{let i=t.get(r);return i||(i=e(r),t.set(r,i)),i}}class i0{opt;#eN;#em;#ef;constructor(e={}){this.opt=e,this.#eN=function({upperCase:e=!1}={}){return iZ(t=>{if(0===t.length)return t;e&&function(e){for(let t=1,r=e.length;t<r;++t){let r=e[t];if("_"!==r&&r!==r.toUpperCase())return!1}return!0}(t)&&(t=t.toLowerCase());let r=t[0];for(let e=1,i=t.length;e<i;++e){let i=t[e],n=t[e-1];"_"!==i&&("_"===n?r+=i.toUpperCase():r+=i)}return r})}(e),this.#em=function({upperCase:e=!1,underscoreBeforeDigits:t=!1,underscoreBetweenUppercaseLetters:r=!1}={}){return iZ(i=>{if(0===i.length)return i;let n=i.toUpperCase(),o=i.toLowerCase(),s=o[0];for(let e=1,a=i.length;e<a;++e){let a=i[e],d=i[e-1],p=n[e],h=n[e-1],u=o[e],c=o[e-1];if(t&&iY(a)&&!iY(d)&&!s.endsWith("_")){s+="_"+a;continue}if(a===p&&p!==u){let e=d===h&&h!==c;r||!e?s+="_"+u:s+=u}else s+=a}return e?s.toUpperCase():s})}(e),this.#ef=new iX(this.snakeCase.bind(this))}transformQuery(e){return this.#ef.transformNode(e.node,e.queryId)}async transformResult(e){return e.result.rows&&Array.isArray(e.result.rows)?{...e.result,rows:e.result.rows.map(e=>this.mapRow(e))}:e.result}mapRow(e){return Object.keys(e).reduce((t,r)=>{let i=e[r];return Array.isArray(i)?i=i.map(e=>i1(e,this.opt)?this.mapRow(e):e):i1(i,this.opt)&&(i=this.mapRow(i)),t[this.camelCase(r)]=i,t},{})}snakeCase(e){return this.#em(e)}camelCase(e){return this.#eN(e)}}function i1(e,t){return function(e){var t;if(!p(e)||"[object Object]"!==(null==(t=e)?void 0===t?"[object Undefined]":"[object Null]":m.call(t)))return!1;if(null===Object.getPrototypeOf(e))return!0;let r=e;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}(e)&&!t?.maintainNestedObjectKeys}var i2=e.i(967255);let i3=new Map,i8=new Map,{databaseUrl:i4}=(0,r.getDatabaseSecrets)(),i5=function(e){if(i8.has(e))return i8.get(e);let t=i3.get(e);t||(t=new i2.Pool({connectionString:e,max:10}),i3.set(e,t));let r=new ig({dialect:new iH({pool:t}),plugins:[new i0]});return i8.set(e,r),r}(i4);(t=i3.get(i4))||(t=new i2.Pool({connectionString:i4,max:10}),i3.set(i4,t)),e.s(["postgresDb",0,i5],36480);class i6{db;constructor(e=i5){this.db=e}}e.s(["BaseRepository",()=>i6],46308)}];

//# sourceMappingURL=packages_shared_src_server_repositories_baseRepository_ts_70a9cadc._.js.map