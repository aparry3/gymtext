module.exports=[363890,(a,b,c)=>{b.exports=a.x("stream/web",()=>require("stream/web"))},60438,(a,b,c)=>{b.exports=a.x("perf_hooks",()=>require("perf_hooks"))},178249,(a,b,c)=>{b.exports=a.x("util/types",()=>require("util/types"))},687769,(a,b,c)=>{b.exports=a.x("node:events",()=>require("node:events"))},154993,(a,b,c)=>{b.exports=a.x("diagnostics_channel",()=>require("diagnostics_channel"))},925328,(a,b,c)=>{b.exports=a.x("http2",()=>require("http2"))},99348,(a,b,c)=>{b.exports=a.x("string_decoder",()=>require("string_decoder"))},410430,(a,b,c)=>{b.exports=a.x("async_hooks",()=>require("async_hooks"))},611913,(a,b,c)=>{b.exports=a.x("console",()=>require("console"))},37702,(a,b,c)=>{b.exports=a.x("worker_threads",()=>require("worker_threads"))},812057,(a,b,c)=>{b.exports=a.x("node:util",()=>require("node:util"))},449719,(a,b,c)=>{b.exports=a.x("assert",()=>require("assert"))},870722,(a,b,c)=>{b.exports=a.x("tty",()=>require("tty"))},967255,(a,b,c)=>{b.exports=a.x("pg",()=>require("pg"))},500874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},522734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},427699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},145706,(a,b,c)=>{b.exports=a.x("querystring",()=>require("querystring"))},406461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},524836,(a,b,c)=>{b.exports=a.x("https",()=>require("https"))},446786,(a,b,c)=>{b.exports=a.x("os",()=>require("os"))},921517,(a,b,c)=>{b.exports=a.x("http",()=>require("http"))},504446,(a,b,c)=>{b.exports=a.x("net",()=>require("net"))},755004,(a,b,c)=>{b.exports=a.x("tls",()=>require("tls"))},792509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},254799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},81111,(a,b,c)=>{b.exports=a.x("node:stream",()=>require("node:stream"))},666680,(a,b,c)=>{b.exports=a.x("node:crypto",()=>require("node:crypto"))},233405,(a,b,c)=>{b.exports=a.x("child_process",()=>require("child_process"))},564621,a=>{a.v({name:"gaxios",version:"7.1.3",description:"A simple common HTTP client specifically for Google APIs and services.",main:"build/cjs/src/index.js",types:"build/cjs/src/index.d.ts",files:["build/"],exports:{".":{import:{types:"./build/esm/src/index.d.ts",default:"./build/esm/src/index.js"},require:{types:"./build/cjs/src/index.d.ts",default:"./build/cjs/src/index.js"}}},scripts:{lint:"gts check --no-inline-config",test:"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000",compile:"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs",fix:"gts fix",prepare:"npm run compile",pretest:"npm run compile",webpack:"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js",docs:"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../",prelint:"cd samples; npm link ../; npm install",clean:"gts clean"},repository:{type:"git",directory:"packages/gaxios",url:"https://github.com/googleapis/google-cloud-node-core.git"},keywords:["google"],engines:{node:">=18"},author:"Google, LLC",license:"Apache-2.0",devDependencies:{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6",assert:"^2.0.0",browserify:"^17.0.0",c8:"^10.0.0",cors:"^2.8.5",express:"^5.0.0",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",linkinator:"^6.1.2",mocha:"^11.1.0",multiparty:"^4.2.1",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","stream-browserify":"^3.0.0",tmp:"0.2.5","ts-loader":"^9.5.2",typescript:"^5.8.3",webpack:"^5.35.0","webpack-cli":"^6.0.1"},dependencies:{extend:"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2",rimraf:"^5.0.1"},homepage:"https://github.com/googleapis/google-cloud-node-core/tree/main/packages/gaxios"})},605365,(a,b,c)=>{b.exports=a.x("process",()=>require("process"))},885083,a=>{a.v({name:"google-auth-library",version:"10.5.0",author:"Google Inc.",description:"Google APIs Authentication Client Library for Node.js",engines:{node:">=18"},main:"./build/src/index.js",types:"./build/src/index.d.ts",repository:"googleapis/google-auth-library-nodejs.git",keywords:["google","api","google apis","client","client library"],dependencies:{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11",gaxios:"^7.0.0","gcp-metadata":"^8.0.0","google-logging-utils":"^1.0.0",gtoken:"^8.0.0",jws:"^4.0.0"},devDependencies:{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0",c8:"^10.0.0",codecov:"^3.0.2",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",keypair:"^1.0.4",mocha:"^11.1.0",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.5","null-loader":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","ts-loader":"^8.0.0",typescript:"5.8.2",webpack:"^5.21.2","webpack-cli":"^4.0.0"},files:["build/src","!build/src/**/*.map"],scripts:{test:"c8 mocha build/test",clean:"gts clean",prepare:"npm run compile",lint:"gts check --no-inline-config",compile:"tsc -p .",fix:"gts fix",pretest:"npm run compile -- --sourceMap",docs:"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap",webpack:"webpack","browser-test":"karma start","docs-test":"echo 'disabled until linkinator is fixed'","predocs-test":"npm run docs",prelint:"cd samples; npm link ../; npm install"},license:"Apache-2.0"})},924868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},188646,(a,b,c)=>{b.exports=a.x("node:stream/promises",()=>require("node:stream/promises"))},558528,(a,b,c)=>{var d=a.r(500874),e=d.Buffer;function f(a,b){for(var c in a)b[c]=a[c]}function g(a,b,c){return e(a,b,c)}e.from&&e.alloc&&e.allocUnsafe&&e.allocUnsafeSlow?b.exports=d:(f(d,c),c.Buffer=g),g.prototype=Object.create(e.prototype),f(e,g),g.from=function(a,b,c){if("number"==typeof a)throw TypeError("Argument must not be a number");return e(a,b,c)},g.alloc=function(a,b,c){if("number"!=typeof a)throw TypeError("Argument must be a number");var d=e(a);return void 0!==b?"string"==typeof c?d.fill(b,c):d.fill(b):d.fill(0),d},g.allocUnsafe=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return e(a)},g.allocUnsafeSlow=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return d.SlowBuffer(a)}},713489,(a,b,c)=>{"use strict";function d(a){return(a/8|0)+ +(a%8!=0)}var e={ES256:d(256),ES384:d(384),ES512:d(521)};b.exports=function(a){var b=e[a];if(b)return b;throw Error('Unknown algorithm "'+a+'"')}},389397,(a,b,c)=>{"use strict";var d=a.r(558528).Buffer,e=a.r(713489);function f(a){if(d.isBuffer(a))return a;if("string"==typeof a)return d.from(a,"base64");throw TypeError("ECDSA signature must be a Base64 string or a Buffer")}function g(a,b,c){for(var d=0;b+d<c&&0===a[b+d];)++d;return a[b+d]>=128&&--d,d}b.exports={derToJose:function(a,b){a=f(a);var c=e(b),g=c+1,h=a.length,i=0;if(48!==a[i++])throw Error('Could not find expected "seq"');var j=a[i++];if(129===j&&(j=a[i++]),h-i<j)throw Error('"seq" specified length of "'+j+'", only "'+(h-i)+'" remaining');if(2!==a[i++])throw Error('Could not find expected "int" for "r"');var k=a[i++];if(h-i-2<k)throw Error('"r" specified length of "'+k+'", only "'+(h-i-2)+'" available');if(g<k)throw Error('"r" specified length of "'+k+'", max of "'+g+'" is acceptable');var l=i;if(i+=k,2!==a[i++])throw Error('Could not find expected "int" for "s"');var m=a[i++];if(h-i!==m)throw Error('"s" specified length of "'+m+'", expected "'+(h-i)+'"');if(g<m)throw Error('"s" specified length of "'+m+'", max of "'+g+'" is acceptable');var n=i;if((i+=m)!==h)throw Error('Expected to consume entire buffer, but "'+(h-i)+'" bytes remain');var o=c-k,p=c-m,q=d.allocUnsafe(o+k+p+m);for(i=0;i<o;++i)q[i]=0;a.copy(q,i,l+Math.max(-o,0),l+k),i=c;for(var r=i;i<r+p;++i)q[i]=0;return a.copy(q,i,n+Math.max(-p,0),n+m),q=(q=q.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(a,b){a=f(a);var c=e(b),h=a.length;if(h!==2*c)throw TypeError('"'+b+'" signatures must be "'+2*c+'" bytes, saw "'+h+'"');var i=g(a,0,c),j=g(a,c,a.length),k=c-i,l=c-j,m=2+k+1+1+l,n=m<128,o=d.allocUnsafe((n?2:3)+m),p=0;return o[p++]=48,n?o[p++]=m:(o[p++]=129,o[p++]=255&m),o[p++]=2,o[p++]=k,i<0?(o[p++]=0,p+=a.copy(o,p,0,c)):p+=a.copy(o,p,i,c),o[p++]=2,o[p++]=l,j<0?(o[p++]=0,a.copy(o,p,c)):a.copy(o,p,c+j),o}}},620542,(a,b,c)=>{"use strict";var d=a.r(500874).Buffer,e=a.r(500874).SlowBuffer;function f(a,b){if(!d.isBuffer(a)||!d.isBuffer(b)||a.length!==b.length)return!1;for(var c=0,e=0;e<a.length;e++)c|=a[e]^b[e];return 0===c}b.exports=f,f.install=function(){d.prototype.equal=e.prototype.equal=function(a){return f(this,a)}};var g=d.prototype.equal,h=e.prototype.equal;f.restore=function(){d.prototype.equal=g,e.prototype.equal=h}},555977,a=>{"use strict";a.i(458093);var b=a.i(647727);let c=b.z.object({messageHistoryLimit:b.z.number().int().positive().default(5),includeSystemMessages:b.z.boolean().default(!0),maxContextTokens:b.z.number().int().positive().default(1e3),reserveTokensForResponse:b.z.number().int().positive().default(1500),conversationGapMinutes:b.z.number().int().positive().default(30),enableCaching:b.z.boolean().default(!0),cacheTTLSeconds:b.z.number().int().nonnegative().default(600)}),d=b.z.object({smsMaxLength:b.z.number().int().positive().default(1600),contextMinutes:b.z.number().int().positive().default(10)}),e=b.z.enum(["twilio","local"]),f=b.z.object({provider:e.default("twilio")}),g=b.z.object({agentLogging:b.z.boolean().default(!1),enableConversationStorage:b.z.boolean().default(!0)}),h=b.z.object({timeoutMinutes:b.z.number().int().positive().default(30),maxLength:b.z.number().int().positive().default(100),inactiveThresholdDays:b.z.number().int().positive().default(7)}),i=b.z.object({defaultExpiryDays:b.z.number().int().positive().default(7),domain:b.z.string().optional()}),j=b.z.object({priceId:b.z.string().min(1)}),k=b.z.object({phoneNumbers:b.z.array(b.z.string()).default([]),maxRequestsPerWindow:b.z.number().int().positive().default(3),rateLimitWindowMinutes:b.z.number().int().positive().default(15),codeExpiryMinutes:b.z.number().int().positive().default(10),codeLength:b.z.number().int().positive().default(6),devBypassCode:b.z.string().optional()}),l=b.z.object({baseUrl:b.z.string().optional(),publicBaseUrl:b.z.string().optional()}),m=b.z.object({environment:b.z.enum(["development","staging","production"]),context:c,chat:d,messaging:f,features:g,conversation:h,shortLinks:i,stripe:j,admin:k,urls:l});function n(a){if(!a)return;let b=parseInt(a,10);return isNaN(b)?void 0:b}function o(a){if(void 0!==a)return"true"===a}let p=null;function q(){return p||(p=function(){var a;let b="staging"===process.env.APP_ENV?"staging":"production",c={environment:b,context:{messageHistoryLimit:n(process.env.CONTEXT_MESSAGE_HISTORY_LIMIT),includeSystemMessages:o(process.env.CONTEXT_INCLUDE_SYSTEM_MESSAGES),maxContextTokens:n(process.env.CONTEXT_MAX_TOKENS),reserveTokensForResponse:n(process.env.CONTEXT_RESERVE_TOKENS),conversationGapMinutes:n(process.env.CONTEXT_CONVERSATION_GAP_MINUTES),enableCaching:o(process.env.CONTEXT_ENABLE_CACHING),cacheTTLSeconds:n(process.env.CONTEXT_CACHE_TTL)},chat:{smsMaxLength:n(process.env.SMS_MAX_LENGTH),contextMinutes:n(process.env.CHAT_CONTEXT_MINUTES)},messaging:{provider:process.env.MESSAGING_PROVIDER},features:{agentLogging:o(process.env.AGENT_LOGGING),enableConversationStorage:o(process.env.ENABLE_CONVERSATION_STORAGE)},conversation:{timeoutMinutes:n(process.env.CONVERSATION_TIMEOUT_MINUTES),maxLength:n(process.env.MAX_CONVERSATION_LENGTH),inactiveThresholdDays:n(process.env.INACTIVE_THRESHOLD_DAYS)},shortLinks:{defaultExpiryDays:n(process.env.SHORT_LINK_DEFAULT_EXPIRY_DAYS),domain:process.env.SHORT_LINK_DOMAIN},stripe:{priceId:process.env.STRIPE_PRICE_ID},admin:{phoneNumbers:process.env.ADMIN_PHONE_NUMBERS?(a=process.env.ADMIN_PHONE_NUMBERS)?a.split(",").map(a=>a.trim()).filter(a=>a.length>0):[]:void 0,devBypassCode:process.env.DEV_BYPASS_CODE},urls:{baseUrl:process.env.BASE_URL,publicBaseUrl:"http://localhost:3001"}},d=m.safeParse(c);if(!d.success){let a=d.error.errors.map(a=>`  - ${a.path.join(".")}: ${a.message}`).join("\n");throw Error(`Configuration validation failed:
${a}

Environment: ${b}
Check your environment variables.`)}return d.data}()),p}b.z.object({NEXT_PUBLIC_BASE_URL:b.z.string().optional(),NEXT_PUBLIC_ANALYTICS_WRITE_KEY:b.z.string().optional(),NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY:b.z.string().optional()});let r=null;function s(){return q().chat}function t(){return q().messaging}function u(){return q().features}function v(){return q().shortLinks}function w(){return q().stripe}function x(){return q().urls}new Proxy({},{get:(a,b)=>(!r&&(r=q()),r)[b]}),a.s(["getChatConfig",()=>s,"getFeatureFlags",()=>u,"getMessagingConfig",()=>t,"getShortLinksConfig",()=>v,"getStripeConfig",()=>w,"getUrlsConfig",()=>x],555977)},1392,(a,b,c)=>{function d(a,b,c,d){return Math.round(a/c)+" "+d+(b>=1.5*c?"s":"")}b.exports=function(a,b){b=b||{};var c,e,f,g,h=typeof a;if("string"===h&&a.length>0){var i=a;if(!((i=String(i)).length>100)){var j=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i);if(j){var k=parseFloat(j[1]);switch((j[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*k;case"weeks":case"week":case"w":return 6048e5*k;case"days":case"day":case"d":return 864e5*k;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*k;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*k;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*k;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return k;default:break}}}return}if("number"===h&&isFinite(a)){return b.long?(e=Math.abs(c=a))>=864e5?d(c,e,864e5,"day"):e>=36e5?d(c,e,36e5,"hour"):e>=6e4?d(c,e,6e4,"minute"):e>=1e3?d(c,e,1e3,"second"):c+" ms":(g=Math.abs(f=a))>=864e5?Math.round(f/864e5)+"d":g>=36e5?Math.round(f/36e5)+"h":g>=6e4?Math.round(f/6e4)+"m":g>=1e3?Math.round(f/1e3)+"s":f+"ms"}throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))}},788136,(a,b,c)=>{"use strict";b.exports=(a,b=process.argv)=>{let c=a.startsWith("-")?"":1===a.length?"-":"--",d=b.indexOf(c+a),e=b.indexOf("--");return -1!==d&&(-1===e||d<e)}},309040,(a,b,c)=>{"use strict";let d;a.r(446786);let e=a.r(870722),f=a.r(788136),{env:g}=process;function h(a){return 0!==a&&{level:a,hasBasic:!0,has256:a>=2,has16m:a>=3}}function i(a,b){if(0===d)return 0;if(f("color=16m")||f("color=full")||f("color=truecolor"))return 3;if(f("color=256"))return 2;if(a&&!b&&void 0===d)return 0;let c=d||0;if("dumb"===g.TERM)return c;if("CI"in g)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(a=>a in g)||"codeship"===g.CI_NAME?1:c;if("TEAMCITY_VERSION"in g)return+!!/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(g.TEAMCITY_VERSION);if("truecolor"===g.COLORTERM)return 3;if("TERM_PROGRAM"in g){let a=parseInt((g.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(g.TERM_PROGRAM){case"iTerm.app":return a>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(g.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(g.TERM)||"COLORTERM"in g?1:c}f("no-color")||f("no-colors")||f("color=false")||f("color=never")?d=0:(f("color")||f("colors")||f("color=true")||f("color=always"))&&(d=1),"FORCE_COLOR"in g&&(d="true"===g.FORCE_COLOR?1:"false"===g.FORCE_COLOR?0:0===g.FORCE_COLOR.length?1:Math.min(parseInt(g.FORCE_COLOR,10),3)),b.exports={supportsColor:function(a){return h(i(a,a&&a.isTTY))},stdout:h(i(!0,e.isatty(1))),stderr:h(i(!0,e.isatty(2)))}},451797,(a,b,c)=>{b.exports=function(b){function c(a){let b,e,f,g=null;function h(...a){if(!h.enabled)return;let d=Number(new Date);h.diff=d-(b||d),h.prev=b,h.curr=d,b=d,a[0]=c.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");let e=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(b,d)=>{if("%%"===b)return"%";e++;let f=c.formatters[d];if("function"==typeof f){let c=a[e];b=f.call(h,c),a.splice(e,1),e--}return b}),c.formatArgs.call(h,a),(h.log||c.log).apply(h,a)}return h.namespace=a,h.useColors=c.useColors(),h.color=c.selectColor(a),h.extend=d,h.destroy=c.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==g?g:(e!==c.namespaces&&(e=c.namespaces,f=c.enabled(a)),f),set:a=>{g=a}}),"function"==typeof c.init&&c.init(h),h}function d(a,b){let d=c(this.namespace+(void 0===b?":":b)+a);return d.log=this.log,d}function e(a,b){let c=0,d=0,e=-1,f=0;for(;c<a.length;)if(d<b.length&&(b[d]===a[c]||"*"===b[d]))"*"===b[d]?(e=d,f=c):c++,d++;else{if(-1===e)return!1;d=e+1,c=++f}for(;d<b.length&&"*"===b[d];)d++;return d===b.length}return c.debug=c,c.default=c,c.coerce=function(a){return a instanceof Error?a.stack||a.message:a},c.disable=function(){let a=[...c.names,...c.skips.map(a=>"-"+a)].join(",");return c.enable(""),a},c.enable=function(a){for(let b of(c.save(a),c.namespaces=a,c.names=[],c.skips=[],("string"==typeof a?a:"").trim().replace(/\s+/g,",").split(",").filter(Boolean)))"-"===b[0]?c.skips.push(b.slice(1)):c.names.push(b)},c.enabled=function(a){for(let b of c.skips)if(e(a,b))return!1;for(let b of c.names)if(e(a,b))return!0;return!1},c.humanize=a.r(1392),c.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(b).forEach(a=>{c[a]=b[a]}),c.names=[],c.skips=[],c.formatters={},c.selectColor=function(a){let b=0;for(let c=0;c<a.length;c++)b=(b<<5)-b+a.charCodeAt(c)|0;return c.colors[Math.abs(b)%c.colors.length]},c.enable(c.load()),c}},295548,(a,b,c)=>{let d=a.r(870722),e=a.r(224361);c.init=function(a){a.inspectOpts={};let b=Object.keys(c.inspectOpts);for(let d=0;d<b.length;d++)a.inspectOpts[b[d]]=c.inspectOpts[b[d]]},c.log=function(...a){return process.stderr.write(e.formatWithOptions(c.inspectOpts,...a)+"\n")},c.formatArgs=function(a){let{namespace:d,useColors:e}=this;if(e){let c=this.color,e="\x1b[3"+(c<8?c:"8;5;"+c),f=`  ${e};1m${d} \u001B[0m`;a[0]=f+a[0].split("\n").join("\n"+f),a.push(e+"m+"+b.exports.humanize(this.diff)+"\x1b[0m")}else a[0]=(c.inspectOpts.hideDate?"":new Date().toISOString()+" ")+d+" "+a[0]},c.save=function(a){a?process.env.DEBUG=a:delete process.env.DEBUG},c.load=function(){return process.env.DEBUG},c.useColors=function(){return"colors"in c.inspectOpts?!!c.inspectOpts.colors:d.isatty(process.stderr.fd)},c.destroy=e.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),c.colors=[6,2,3,4,5,1];try{let b=a.r(309040);b&&(b.stderr||b).level>=2&&(c.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(a){}c.inspectOpts=Object.keys(process.env).filter(a=>/^debug_/i.test(a)).reduce((a,b)=>{let c=b.substring(6).toLowerCase().replace(/_([a-z])/g,(a,b)=>b.toUpperCase()),d=process.env[b];return d=!!/^(yes|on|true|enabled)$/i.test(d)||!/^(no|off|false|disabled)$/i.test(d)&&("null"===d?null:Number(d)),a[c]=d,a},{}),b.exports=a.r(451797)(c);let{formatters:f}=b.exports;f.o=function(a){return this.inspectOpts.colors=this.useColors,e.inspect(a,this.inspectOpts).split("\n").map(a=>a.trim()).join(" ")},f.O=function(a){return this.inspectOpts.colors=this.useColors,e.inspect(a,this.inspectOpts)}},446517,(a,b,c)=>{let d;c.formatArgs=function(a){if(a[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+a[0]+(this.useColors?"%c ":" ")+"+"+b.exports.humanize(this.diff),!this.useColors)return;let c="color: "+this.color;a.splice(1,0,c,"color: inherit");let d=0,e=0;a[0].replace(/%[a-zA-Z%]/g,a=>{"%%"!==a&&(d++,"%c"===a&&(e=d))}),a.splice(e,0,c)},c.save=function(a){try{a?c.storage.setItem("debug",a):c.storage.removeItem("debug")}catch(a){}},c.load=function(){let a;try{a=c.storage.getItem("debug")||c.storage.getItem("DEBUG")}catch(a){}return!a&&"undefined"!=typeof process&&"env"in process&&(a=process.env.DEBUG),a},c.useColors=function(){let a;return!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof navigator&&navigator.userAgent&&(a=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(a[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},c.storage=function(){try{return localStorage}catch(a){}}(),d=!1,c.destroy=()=>{d||(d=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))},c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),b.exports=a.r(451797)(c);let{formatters:e}=b.exports;e.j=function(a){try{return JSON.stringify(a)}catch(a){return"[UnexpectedJSONParseError]: "+a.message}}},320201,(a,b,c)=>{"undefined"==typeof process||"renderer"===process.type||process.__nwjs?b.exports=a.r(446517):b.exports=a.r(295548)},380320,399077,a=>{"use strict";var b=a.i(449083);class c extends b.BaseRepository{async create(a){return await this.db.insertInto("messageQueues").values(a).returningAll().executeTakeFirstOrThrow()}async createMany(a){return 0===a.length?[]:await this.db.insertInto("messageQueues").values(a).returningAll().execute()}async findById(a){return await this.db.selectFrom("messageQueues").selectAll().where("id","=",a).executeTakeFirst()}async findByMessageId(a){return await this.db.selectFrom("messageQueues").selectAll().where("messageId","=",a).executeTakeFirst()}async findPendingByClient(a,b){return await this.db.selectFrom("messageQueues").selectAll().where("clientId","=",a).where("queueName","=",b).where("status","=","pending").orderBy("sequenceNumber","asc").execute()}async findAllPending(a){let b=this.db.selectFrom("messageQueues").selectAll().where("status","=","pending");return a.clientId&&(b=b.where("clientId","=",a.clientId)),await b.orderBy("createdAt","desc").limit(a.limit||100).offset(a.offset||0).execute()}async findAllPendingWithUserInfo(a){let b=this.db.selectFrom("messageQueues").innerJoin("users","users.id","messageQueues.clientId").select(["messageQueues.id","messageQueues.clientId","messageQueues.queueName","messageQueues.sequenceNumber","messageQueues.messageContent","messageQueues.mediaUrls","messageQueues.status","messageQueues.messageId","messageQueues.retryCount","messageQueues.maxRetries","messageQueues.timeoutMinutes","messageQueues.errorMessage","messageQueues.createdAt","messageQueues.sentAt","messageQueues.deliveredAt","users.name as userName","users.phoneNumber as userPhone"]).where("messageQueues.status","=","pending");return a.clientId&&(b=b.where("messageQueues.clientId","=",a.clientId)),await b.orderBy("messageQueues.createdAt","desc").limit(a.limit||100).execute()}async findNextPending(a,b){return await this.db.selectFrom("messageQueues").selectAll().where("clientId","=",a).where("queueName","=",b).where("status","=","pending").orderBy("sequenceNumber","asc").limit(1).executeTakeFirst()}async findStalled(a){return await this.db.selectFrom("messageQueues").selectAll().where("status","=","sent").where("sentAt","<",a).execute()}async updateStatus(a,b,c,d){return await this.db.updateTable("messageQueues").set({status:b,...c?.sentAt&&{sentAt:c.sentAt},...c?.deliveredAt&&{deliveredAt:c.deliveredAt},...d&&{errorMessage:d}}).where("id","=",a).returningAll().executeTakeFirstOrThrow()}async linkMessage(a,b){return await this.db.updateTable("messageQueues").set({messageId:b,status:"sent",sentAt:new Date}).where("id","=",a).returningAll().executeTakeFirstOrThrow()}async incrementRetry(a){let b=await this.findById(a);if(!b)throw Error(`Queue entry ${a} not found`);return await this.db.updateTable("messageQueues").set({retryCount:b.retryCount+1}).where("id","=",a).returningAll().executeTakeFirstOrThrow()}async deleteCompleted(a,b){await this.db.deleteFrom("messageQueues").where("clientId","=",a).where("queueName","=",b).where("status","in",["delivered","failed"]).execute()}async getQueueStatus(a,b){let c=await this.db.selectFrom("messageQueues").select(["status"]).where("clientId","=",a).where("queueName","=",b).execute();return{total:c.length,pending:c.filter(a=>"pending"===a.status).length,sent:c.filter(a=>"sent"===a.status).length,delivered:c.filter(a=>"delivered"===a.status).length,failed:c.filter(a=>"failed"===a.status).length}}}a.s(["MessageQueueRepository",()=>c],399077);var d=a.i(964081),e=a.i(34889),f=a.i(624486);class g{static instance;messageQueueRepo;constructor(){this.messageQueueRepo=new c(d.postgresDb)}static getInstance(){return g.instance||(g.instance=new g),g.instance}async enqueueMessages(a,b,c){if(0===b.length)return;console.log(`[MessageQueueService] Enqueueing ${b.length} messages for client ${a} in queue '${c}'`);let d=b.map((b,d)=>({clientId:a,queueName:c,sequenceNumber:d+1,messageContent:b.content||null,mediaUrls:b.mediaUrls?JSON.stringify(b.mediaUrls):null,status:"pending"}));await this.messageQueueRepo.createMany(d),console.log(`[MessageQueueService] Created ${d.length} queue entries`),await e.inngest.send({name:"message-queue/process-next",data:{clientId:a,queueName:c}})}async processNextMessage(a,b){console.log(`[MessageQueueService] Processing next message for client ${a} in queue '${b}'`);let c=await this.messageQueueRepo.findNextPending(a,b);if(!c){console.log(`[MessageQueueService] No more pending messages in queue '${b}' for client ${a}`),await this.clearQueue(a,b);return}console.log(`[MessageQueueService] Found next message (sequence ${c.sequenceNumber})`),await e.inngest.send({name:"message-queue/send-message",data:{queueEntryId:c.id,clientId:c.clientId,queueName:c.queueName}})}async sendQueuedMessage(b){let c,d=await this.messageQueueRepo.findById(b);if(!d)throw Error(`Queue entry ${b} not found`);let{messageService:e}=await a.A(500897),{userService:f}=await a.A(850162),g=await f.getUser(d.clientId);if(!g)throw Error(`Client ${d.clientId} not found`);if(d.mediaUrls)if("string"==typeof d.mediaUrls)try{c=JSON.parse(d.mediaUrls)}catch(a){console.error("[MessageQueueService] Failed to parse media URLs:",a)}else c=d.mediaUrls;console.log(`[MessageQueueService] Sending queued message ${b}`);let h=await e.sendMessage(g,d.messageContent||void 0,c);return await this.messageQueueRepo.linkMessage(d.id,h.id),console.log("[MessageQueueService] Queued message sent successfully",{queueEntryId:b,messageId:h.id}),h}async markMessageDelivered(a){let b=await this.messageQueueRepo.findByMessageId(a);b?(console.log(`[MessageQueueService] Marking message ${a} as delivered`),await this.messageQueueRepo.updateStatus(b.id,"delivered",{deliveredAt:new Date}),await e.inngest.send({name:"message-queue/process-next",data:{clientId:b.clientId,queueName:b.queueName}}),console.log(`[MessageQueueService] Triggered next message for queue '${b.queueName}'`)):console.log(`[MessageQueueService] No queue entry found for message ${a}`)}async markMessageFailed(a,b){let c=await this.messageQueueRepo.findByMessageId(a);c?(console.log(`[MessageQueueService] Message ${a} failed:`,b),c.retryCount<c.maxRetries?(console.log(`[MessageQueueService] Retrying message (attempt ${c.retryCount+1}/${c.maxRetries})`),await this.messageQueueRepo.incrementRetry(c.id),await this.messageQueueRepo.updateStatus(c.id,"pending",void 0,b),await e.inngest.send({name:"message/delivery-failed",data:{messageId:a,clientId:c.clientId,providerMessageId:a,error:b||"Unknown error"}})):(console.log("[MessageQueueService] Max retries reached, marking as failed and moving to next"),await this.messageQueueRepo.updateStatus(c.id,"failed",void 0,b||"Max retries exceeded"),await e.inngest.send({name:"message-queue/process-next",data:{clientId:c.clientId,queueName:c.queueName}}))):console.log(`[MessageQueueService] No queue entry found for message ${a}`)}async checkStalledMessages(){let b=new Date(Date.now()-6e5),c=await this.messageQueueRepo.findStalled(b);if(0===c.length)return void console.log("[MessageQueueService] No stalled messages found");for(let b of(console.log(`[MessageQueueService] Found ${c.length} stalled messages`),c))try{if(!b.messageId){console.warn(`[MessageQueueService] Stalled entry ${b.id} has no messageId, marking as failed`),await this.messageQueueRepo.updateStatus(b.id,"failed",void 0,"No message ID found");continue}let{messageService:c}=await a.A(500897),d=c.messageRepo,e=await d.findById(b.messageId);if(!e||!e.providerMessageId){console.warn(`[MessageQueueService] Message ${b.messageId} not found or has no provider ID`),await this.messageQueueRepo.updateStatus(b.id,"delivered",{deliveredAt:new Date}),await this.processNextMessage(b.clientId,b.queueName);continue}console.log(`[MessageQueueService] Checking Twilio status for ${e.providerMessageId}`);let g=await f.twilioClient.getMessageStatus(e.providerMessageId);"delivered"===g.status?(console.log("[MessageQueueService] Twilio confirms delivery, updating queue"),await this.markMessageDelivered(b.messageId)):"failed"===g.status||"undelivered"===g.status?(console.log("[MessageQueueService] Twilio confirms failure, updating queue"),await this.markMessageFailed(b.messageId,`Stalled message status: ${g.status}`)):(console.log(`[MessageQueueService] Message still in transit (${g.status}), assuming delivered`),await this.messageQueueRepo.updateStatus(b.id,"delivered",{deliveredAt:new Date}),await this.processNextMessage(b.clientId,b.queueName))}catch(a){console.error(`[MessageQueueService] Error checking stalled message ${b.id}:`,a),await this.messageQueueRepo.updateStatus(b.id,"delivered",{deliveredAt:new Date}),await this.processNextMessage(b.clientId,b.queueName)}}async getQueueStatus(a,b){return await this.messageQueueRepo.getQueueStatus(a,b)}async clearQueue(a,b){console.log(`[MessageQueueService] Clearing completed queue '${b}' for client ${a}`),await this.messageQueueRepo.deleteCompleted(a,b)}}let h=g.getInstance();a.s(["MessageQueueService",()=>g,"messageQueueService",0,h],380320)},485685,a=>{a.v(a=>Promise.resolve().then(()=>a(254799)))},384577,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules__pnpm_40492e16._.js"].map(b=>a.l(b))).then(()=>b(231677)))},241638,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__6fc67eb4._.js","server/chunks/ssr/node_modules__pnpm_63a57326._.js","server/chunks/ssr/3f000_node-fetch_src_index_be51e317.js"].map(b=>a.l(b))).then(()=>b(880518)))},540881,a=>{a.v(a=>Promise.resolve().then(()=>a(901251)))},5389,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[externals]_node:async_hooks_b485b2a4._.js"].map(b=>a.l(b))).then(()=>b(478500)))},205662,a=>{a.v(a=>Promise.resolve().then(()=>a(380320)))},500897,a=>{a.v(a=>Promise.resolve().then(()=>a(939993)))},850162,a=>{a.v(a=>Promise.resolve().then(()=>a(608635)))},557803,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_shared_src_server_services_agents_training_index_ts_18449fe5._.js"].map(b=>a.l(b))).then(()=>b(912278)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__4afef38a._.js.map