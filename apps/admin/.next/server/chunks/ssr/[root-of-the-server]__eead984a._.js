module.exports=[556704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},120635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},69794,(a,b,c)=>{"use strict";b.exports=a.r(679777).vendored.contexts.AppRouterContext},707287,(a,b,c)=>{"use strict";b.exports=a.r(679777).vendored.contexts.HooksClientContext},595393,(a,b,c)=>{"use strict";b.exports=a.r(679777).vendored.contexts.ServerInsertedHtml},618411,(a,b,c)=>{"use strict";b.exports=a.r(679777).vendored["react-ssr"].ReactServerDOMTurbopackClient},422065,a=>{"use strict";var b=a.i(281156);let c=a.i(387286).forwardRef(({className:a="",...c},d)=>(0,b.jsx)("div",{ref:d,className:`animate-pulse rounded-md bg-muted ${a}`,...c}));c.displayName="Skeleton",a.s(["Skeleton",()=>c])},453593,a=>{"use strict";var b=a.i(281156);let c=a.i(387286).forwardRef(({className:a="",variant:c="default",size:d="default",...e},f)=>(0,b.jsx)("button",{className:`inline-flex items-center justify-center whitespace-nowrap rounded-xl text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 shadow-sm ${{default:"bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-600/25 hover:shadow-xl hover:shadow-blue-600/30 hover:scale-[1.02]",destructive:"bg-red-600 text-white hover:bg-red-700 shadow-lg shadow-red-600/25 hover:shadow-xl hover:shadow-red-600/30 hover:scale-[1.02]",outline:"border border-gray-200 bg-white text-gray-700 hover:bg-gray-50 shadow-sm hover:shadow-md hover:border-gray-300",secondary:"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:scale-[1.02]",ghost:"text-gray-600 hover:bg-gray-100 hover:text-gray-900",link:"text-blue-600 underline-offset-4 hover:underline hover:text-blue-700"}[c]} ${{default:"h-10 px-4 py-2",sm:"h-9 rounded-xl px-3 text-sm",lg:"h-11 rounded-xl px-8 text-base",icon:"h-10 w-10"}[d]} ${a}`,ref:f,...e}));c.displayName="Button",a.s(["Button",()=>c])},699235,a=>{"use strict";var b=a.i(281156),c=a.i(387286);let d=c.forwardRef(({className:a="",...c},d)=>(0,b.jsx)("div",{ref:d,className:`rounded-2xl border-0 bg-white shadow-lg shadow-black/[0.03] ring-1 ring-black/[0.05] ${a}`,...c}));d.displayName="Card",c.forwardRef(({className:a="",...c},d)=>(0,b.jsx)("div",{ref:d,className:`flex flex-col space-y-1.5 p-6 ${a}`,...c})).displayName="CardHeader",c.forwardRef(({className:a="",...c},d)=>(0,b.jsx)("h3",{ref:d,className:`text-2xl font-semibold leading-none tracking-tight ${a}`,...c})).displayName="CardTitle",c.forwardRef(({className:a="",...c},d)=>(0,b.jsx)("p",{ref:d,className:`text-sm text-muted-foreground ${a}`,...c})).displayName="CardDescription",c.forwardRef(({className:a="",...c},d)=>(0,b.jsx)("div",{ref:d,className:`p-6 pt-0 ${a}`,...c})).displayName="CardContent",c.forwardRef(({className:a="",...c},d)=>(0,b.jsx)("div",{ref:d,className:`flex items-center p-6 pt-0 ${a}`,...c})).displayName="CardFooter",a.s(["Card",()=>d])},574672,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"useMergedRef",{enumerable:!0,get:function(){return e}});let d=a.r(387286);function e(a,b){let c=(0,d.useRef)(null),e=(0,d.useRef)(null);return(0,d.useCallback)(d=>{if(null===d){let a=c.current;a&&(c.current=null,a());let b=e.current;b&&(e.current=null,b())}else a&&(c.current=f(a,d)),b&&(e.current=f(b,d))},[a,b])}function f(a,b){if("function"!=typeof a)return a.current=b,()=>{a.current=null};{let c=a(b);return"function"==typeof c?c:()=>a(null)}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},134790,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"warnOnce",{enumerable:!0,get:function(){return d}});let d=a=>{}},531435,a=>{"use strict";var b=a.i(281156),c=a.i(387286),d=a.i(376246);let e=c.forwardRef(({className:a="",...c},d)=>(0,b.jsx)("nav",{ref:d,"aria-label":"breadcrumb",className:a,...c}));e.displayName="Breadcrumb";let f=c.forwardRef(({className:a="",...c},d)=>(0,b.jsx)("ol",{ref:d,className:`flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5 ${a}`,...c}));f.displayName="BreadcrumbList";let g=c.forwardRef(({className:a="",...c},d)=>(0,b.jsx)("li",{ref:d,className:`inline-flex items-center gap-1.5 ${a}`,...c}));g.displayName="BreadcrumbItem";let h=c.forwardRef(({className:a="",...c},e)=>(0,b.jsx)(d.default,{ref:e,className:`transition-colors hover:text-foreground ${a}`,...c}));h.displayName="BreadcrumbLink";let i=c.forwardRef(({className:a="",...c},d)=>(0,b.jsx)("span",{ref:d,role:"link","aria-disabled":"true","aria-current":"page",className:`font-normal text-foreground ${a}`,...c}));i.displayName="BreadcrumbPage";let j=({children:a,className:c="",...d})=>(0,b.jsx)("li",{role:"presentation","aria-hidden":"true",className:`[&>svg]:size-3.5 ${c}`,...d,children:a??(0,b.jsx)(k,{})});j.displayName="BreadcrumbSeparator";let k=()=>(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})});a.s(["Breadcrumb",()=>e,"BreadcrumbItem",()=>g,"BreadcrumbLink",()=>h,"BreadcrumbList",()=>f,"BreadcrumbPage",()=>i,"BreadcrumbSeparator",()=>j])},966401,a=>{"use strict";var b=a.i(281156),c=a.i(387286),d=a.i(530341),e=a.i(699235),f=a.i(453593),g=a.i(422065),h=a.i(531435);function i(){let{id:a}=(0,d.useParams)(),g=(0,d.useRouter)(),[i,o]=(0,c.useState)([]),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(!0),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(0),H=(0,c.useRef)(null),I=(0,c.useRef)(null),J=(0,c.useRef)(null),K=(0,c.useCallback)(()=>{setTimeout(()=>{H.current?.scrollIntoView({behavior:"smooth"})},100)},[]);(0,c.useEffect)(()=>{K()},[i,K]);let L=(0,c.useCallback)(async(b=!1)=>{b&&s(!0);try{let c=await fetch(`/api/admin/users/${a}/chat?limit=20&offset=0`),d=await c.json();if(!c.ok||!d.success)throw Error(d.error||"Failed to fetch messages");let e=d.data.messages??[];if(o(e),C(d.data.pagination?.hasMore??!1),G(20),b){let b=await fetch(`/api/admin/users/${a}`),c=await b.json();c.success&&(w(c.data.user.name||"User"),y(c.data.user.phoneNumber||""))}}catch(a){console.error("Error fetching messages:",a)}finally{b&&s(!1)}},[a,20]),M=(0,c.useCallback)(async()=>{if(B&&!D){E(!0);try{let b=await fetch(`/api/admin/users/${a}/chat?limit=20&offset=${F}`),c=await b.json();if(!b.ok||!c.success)throw Error(c.error||"Failed to fetch more messages");let d=c.data.messages??[];o(a=>[...d,...a]),C(c.data.pagination?.hasMore??!1),G(a=>a+20)}catch(a){console.error("Error loading more messages:",a)}finally{E(!1)}}},[a,F,B,D,20]);(0,c.useEffect)(()=>{a&&L(!0)},[a,L]),(0,c.useEffect)(()=>{let a=I.current;if(!a)return;let b=()=>{if(a.scrollTop<100&&B&&!D){let b=a.scrollHeight,c=a.scrollTop;M().then(()=>{requestAnimationFrame(()=>{let d=a.scrollHeight;a.scrollTop=c+(d-b)})})}};return a.addEventListener("scroll",b),()=>a.removeEventListener("scroll",b)},[B,D,M]),(0,c.useEffect)(()=>{if(!a||!x)return;let b=new EventSource(`/api/messages/stream?phoneNumber=${encodeURIComponent(x)}`);return J.current=b,b.onopen=()=>{console.log("[SSE] Connected to message stream"),A(!0)},b.addEventListener("message",a=>{try{let b=JSON.parse(a.data);if("connected"===b.type)console.log("[SSE] Stream ready:",b);else if("message"===b.type&&b.message){let a={id:b.message.id,content:b.message.content,direction:"outbound",timestamp:b.message.timestamp,from:b.message.from,to:b.message.to};o(b=>{let c=b.filter(a=>!a.id.startsWith("temp-ack-"));return c.some(b=>b.id===a.id)?b:[...c,a]}),console.log("[SSE] Received message:",a)}}catch(a){console.error("[SSE] Error parsing message:",a)}}),b.onerror=a=>{console.log("[SSE] Connection error (may not be using local provider):",a),A(!1),b.close()},()=>{console.log("[SSE] Disconnecting"),b.close(),A(!1)}},[a,x]);let N=async b=>{if(b.preventDefault(),!p.trim()||t)return;let c=p.trim();q(""),u(!0);let d={id:`temp-user-${Date.now()}`,content:c,direction:"inbound",timestamp:new Date().toISOString(),from:"user",to:"system"};o(a=>[...a,d]);try{let b=await fetch(`/api/admin/users/${a}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:c,userId:a})}),d=await b.json();if(!b.ok||!d.success)throw Error(d.error||"Failed to send message");let e={id:`temp-ack-${d.data.jobId}`,content:d.data.ackMessage,direction:"outbound",timestamp:d.data.timestamp,from:"system",to:"user"};o(a=>[...a,e]),console.log("[Admin Chat] Message queued:",{jobId:d.data.jobId,conversationId:d.data.conversationId})}catch(a){console.error("Failed to send message:",a),o(a=>a.filter(a=>a.id!==d.id))}finally{u(!1)}};return r?(0,b.jsx)(k,{}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-50/50",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-6 max-w-4xl",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(h.Breadcrumb,{children:(0,b.jsxs)(h.BreadcrumbList,{children:[(0,b.jsx)(h.BreadcrumbItem,{children:(0,b.jsx)(h.BreadcrumbLink,{href:"/admin/users",children:"Users"})}),(0,b.jsx)(h.BreadcrumbSeparator,{}),(0,b.jsx)(h.BreadcrumbItem,{children:(0,b.jsx)(h.BreadcrumbLink,{href:`/admin/users/${a}`,children:v||"User"})}),(0,b.jsx)(h.BreadcrumbSeparator,{}),(0,b.jsx)(h.BreadcrumbItem,{children:(0,b.jsx)(h.BreadcrumbPage,{children:"Chat"})})]})}),(0,b.jsxs)(e.Card,{className:"flex flex-col h-[calc(100vh-200px)]",children:[(0,b.jsx)("div",{className:"p-4 border-b bg-white",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-semibold",children:v}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Admin Chat Simulator",z&&(0,b.jsxs)("span",{className:"ml-2 inline-flex items-center gap-1 text-green-600",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-green-600 animate-pulse"}),"Live"]})]})]}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>g.push(`/admin/users/${a}`),children:"Back to Profile"})]})}),(0,b.jsxs)("div",{ref:I,className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[D&&(0,b.jsx)("div",{className:"flex justify-center py-2",children:(0,b.jsx)(m,{className:"h-5 w-5 animate-spin text-muted-foreground"})}),!B&&i.length>0&&(0,b.jsx)("div",{className:"flex justify-center py-2",children:(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"No more messages"})}),0===i.length?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(n,{className:"h-12 w-12 text-muted-foreground mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"No messages yet. Start a conversation!"})]})}):i.map(a=>(0,b.jsx)(j,{message:a},a.id)),(0,b.jsx)("div",{ref:H})]}),(0,b.jsx)("div",{className:"p-4 border-t bg-white",children:(0,b.jsxs)("form",{onSubmit:N,className:"flex gap-2",children:[(0,b.jsx)("input",{type:"text",value:p,onChange:a=>q(a.target.value),placeholder:"Type a message...",disabled:t,className:"flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50"}),(0,b.jsx)(f.Button,{type:"submit",disabled:!p.trim()||t,className:"gap-2",children:t?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m,{className:"h-4 w-4 animate-spin"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l,{className:"h-4 w-4"}),"Send"]})})]})})]})]})})})}function j({message:a}){let c="inbound"===a.direction,d=new Date(a.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return(0,b.jsx)("div",{className:`flex ${c?"justify-end":"justify-start"}`,children:(0,b.jsxs)("div",{className:`max-w-[70%] rounded-2xl px-4 py-2 ${c?"bg-blue-500 text-white rounded-br-sm":"bg-white border border-gray-200 text-gray-900 rounded-bl-sm"}`,children:[(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:a.content}),(0,b.jsx)("p",{className:`text-xs mt-1 ${c?"text-blue-100":"text-gray-500"}`,children:d})]})})}function k(){return(0,b.jsx)("div",{className:"min-h-screen bg-gray-50/50",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-6 max-w-4xl",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(g.Skeleton,{className:"h-6 w-64"}),(0,b.jsxs)(e.Card,{className:"h-[calc(100vh-200px)]",children:[(0,b.jsxs)("div",{className:"p-4 border-b",children:[(0,b.jsx)(g.Skeleton,{className:"h-6 w-32 mb-2"}),(0,b.jsx)(g.Skeleton,{className:"h-4 w-48"})]}),(0,b.jsx)("div",{className:"p-4 space-y-4",children:Array.from({length:5}).map((a,c)=>(0,b.jsx)("div",{className:`flex ${c%2==0?"justify-end":"justify-start"}`,children:(0,b.jsx)(g.Skeleton,{className:"h-16 w-64 rounded-2xl"})},c))})]})]})})})}let l=({className:a})=>(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})}),m=({className:a})=>(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:a,children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n=({className:a})=>(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z"})});a.s(["default",()=>i])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__eead984a._.js.map