module.exports=[997239,263926,a=>{"use strict";a.i(458093);var b=a.i(647727);let c=b.z.array(b.z.object({day:b.z.string(),focus:b.z.string().default(""),rationale:b.z.string().default("")})).describe("The ideal/default weekly rhythm"),d=b.z.object({name:b.z.string().describe("e.g. 'Strength + Lean Build Phase'"),type:b.z.string().describe("e.g. 'Powerbuilding'").default(""),coreStrategy:b.z.string().default(""),progressionStrategy:b.z.array(b.z.string()).default([]),adjustmentStrategy:b.z.string().default(""),conditioning:b.z.array(b.z.string()).default([]),scheduleTemplate:c.default([]),durationWeeks:b.z.number().default(-1),frequencyPerWeek:b.z.number().default(-1)}),e=b.z.object({description:b.z.string({description:"Structured text fitness plan containing split, frequency, deload rules, goals, and progression principles"}),message:b.z.string({description:"Brief summary of the fitness plan for SMS messages"}).nullish()});a.s(["PlanStructureSchema",0,d,"_FitnessPlanSchema",0,e],263926);class f{id;clientId;description;message;structured;startDate;createdAt;updatedAt;constructor(a,b,c,d,e,f,g,h){this.id=a,this.clientId=b,this.description=c,this.message=d,this.structured=e,this.startDate=f,this.createdAt=g,this.updatedAt=h}static fromDB(a){return{id:a.id,clientId:a.clientId,description:a.description||"",message:a.message,structured:a.structured,startDate:new Date(a.startDate),createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)}}static fromFitnessPlanOverview(a,b){return{clientId:a.id,description:b.description,message:b.message||null,structured:b.structure||null,startDate:new Date}}static schema=e}a.s(["FitnessPlanModel",()=>f],997239)},830769,(a,b,c)=>{function d(a,b){"boolean"==typeof b&&(b={forever:b}),this._originalTimeouts=JSON.parse(JSON.stringify(a)),this._timeouts=a,this._options=b||{},this._maxRetryTime=b&&b.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}b.exports=d,d.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},d.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},d.prototype.retry=function(a){if(this._timeout&&clearTimeout(this._timeout),!a)return!1;var b=new Date().getTime();if(a&&b-this._operationStart>=this._maxRetryTime)return this._errors.push(a),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(a);var c=this._timeouts.shift();if(void 0===c)if(!this._cachedTimeouts)return!1;else this._errors.splice(0,this._errors.length-1),c=this._cachedTimeouts.slice(-1);var d=this;return this._timer=setTimeout(function(){d._attempts++,d._operationTimeoutCb&&(d._timeout=setTimeout(function(){d._operationTimeoutCb(d._attempts)},d._operationTimeout),d._options.unref&&d._timeout.unref()),d._fn(d._attempts)},c),this._options.unref&&this._timer.unref(),!0},d.prototype.attempt=function(a,b){this._fn=a,b&&(b.timeout&&(this._operationTimeout=b.timeout),b.cb&&(this._operationTimeoutCb=b.cb));var c=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){c._operationTimeoutCb()},c._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},d.prototype.try=function(a){console.log("Using RetryOperation.try() is deprecated"),this.attempt(a)},d.prototype.start=function(a){console.log("Using RetryOperation.start() is deprecated"),this.attempt(a)},d.prototype.start=d.prototype.try,d.prototype.errors=function(){return this._errors},d.prototype.attempts=function(){return this._attempts},d.prototype.mainError=function(){if(0===this._errors.length)return null;for(var a={},b=null,c=0,d=0;d<this._errors.length;d++){var e=this._errors[d],f=e.message,g=(a[f]||0)+1;a[f]=g,g>=c&&(b=e,c=g)}return b}},211563,(a,b,c)=>{var d=a.r(830769);c.operation=function(a){return new d(c.timeouts(a),{forever:a&&(a.forever||a.retries===1/0),unref:a&&a.unref,maxRetryTime:a&&a.maxRetryTime})},c.timeouts=function(a){if(a instanceof Array)return[].concat(a);var b={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var c in a)b[c]=a[c];if(b.minTimeout>b.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var d=[],e=0;e<b.retries;e++)d.push(this.createTimeout(e,b));return a&&a.forever&&!d.length&&d.push(this.createTimeout(e,b)),d.sort(function(a,b){return a-b}),d},c.createTimeout=function(a,b){var c=Math.round((b.randomize?Math.random()+1:1)*Math.max(b.minTimeout,1)*Math.pow(b.factor,a));return Math.min(c,b.maxTimeout)},c.wrap=function(a,b,d){if(b instanceof Array&&(d=b,b=null),!d)for(var e in d=[],a)"function"==typeof a[e]&&d.push(e);for(var f=0;f<d.length;f++){var g=d[f],h=a[g];a[g]=(function(d){var e=c.operation(b),f=Array.prototype.slice.call(arguments,1),g=f.pop();f.push(function(a){e.retry(a)||(a&&(arguments[0]=e.mainError()),g.apply(this,arguments))}),e.attempt(function(){d.apply(a,f)})}).bind(a,h),a[g].options=b}}},292889,(a,b,c)=>{b.exports=a.r(211563)},203210,(a,b,c)=>{"use strict";let d=a.r(292889),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class f extends Error{constructor(a){super(),a instanceof Error?(this.originalError=a,{message:a}=a):(this.originalError=Error(a),this.originalError.stack=this.stack),this.name="AbortError",this.message=a}}let g=(a,b)=>new Promise((c,g)=>{b={onFailedAttempt:()=>{},retries:10,...b};let h=d.operation(b);h.attempt(async d=>{try{c(await a(d))}catch(a){if(!(a instanceof Error))return void g(TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));if(a instanceof f)h.stop(),g(a.originalError);else{let c;if(a instanceof TypeError&&(c=a.message,!e.includes(c)))h.stop(),g(a);else{let c;c=b.retries-(d-1),a.attemptNumber=d,a.retriesLeft=c;try{await b.onFailedAttempt(a)}catch(a){g(a);return}h.retry(a)||g(h.mainError())}}}})});b.exports=g,b.exports.default=g,b.exports.AbortError=f},505823,(a,b,c)=>{"use strict";var d=Object.prototype.hasOwnProperty,e="~";function f(){}function g(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function h(a,b,c,d,f){if("function"!=typeof c)throw TypeError("The listener must be a function");var h=new g(c,d||a,f),i=e?e+b:b;return a._events[i]?a._events[i].fn?a._events[i]=[a._events[i],h]:a._events[i].push(h):(a._events[i]=h,a._eventsCount++),a}function i(a,b){0==--a._eventsCount?a._events=new f:delete a._events[b]}function j(){this._events=new f,this._eventsCount=0}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(e=!1)),j.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)d.call(a,b)&&c.push(e?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},j.prototype.listeners=function(a){var b=e?e+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,g=Array(f);d<f;d++)g[d]=c[d].fn;return g},j.prototype.listenerCount=function(a){var b=e?e+a:a,c=this._events[b];return c?c.fn?1:c.length:0},j.prototype.emit=function(a,b,c,d,f,g){var h=e?e+a:a;if(!this._events[h])return!1;var i,j,k=this._events[h],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,f),!0;case 6:return k.fn.call(k.context,b,c,d,f,g),!0}for(j=1,i=Array(l-1);j<l;j++)i[j-1]=arguments[j];k.fn.apply(k.context,i)}else{var m,n=k.length;for(j=0;j<n;j++)switch(k[j].once&&this.removeListener(a,k[j].fn,void 0,!0),l){case 1:k[j].fn.call(k[j].context);break;case 2:k[j].fn.call(k[j].context,b);break;case 3:k[j].fn.call(k[j].context,b,c);break;case 4:k[j].fn.call(k[j].context,b,c,d);break;default:if(!i)for(m=1,i=Array(l-1);m<l;m++)i[m-1]=arguments[m];k[j].fn.apply(k[j].context,i)}}return!0},j.prototype.on=function(a,b,c){return h(this,a,b,c,!1)},j.prototype.once=function(a,b,c){return h(this,a,b,c,!0)},j.prototype.removeListener=function(a,b,c,d){var f=e?e+a:a;if(!this._events[f])return this;if(!b)return i(this,f),this;var g=this._events[f];if(g.fn)g.fn!==b||d&&!g.once||c&&g.context!==c||i(this,f);else{for(var h=0,j=[],k=g.length;h<k;h++)(g[h].fn!==b||d&&!g[h].once||c&&g[h].context!==c)&&j.push(g[h]);j.length?this._events[f]=1===j.length?j[0]:j:i(this,f)}return this},j.prototype.removeAllListeners=function(a){var b;return a?(b=e?e+a:a,this._events[b]&&i(this,b)):(this._events=new f,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=e,j.EventEmitter=j,b.exports=j},76014,(a,b,c)=>{"use strict";b.exports=(a,b)=>(b=b||(()=>{}),a.then(a=>new Promise(a=>{a(b())}).then(()=>a),a=>new Promise(a=>{a(b())}).then(()=>{throw a})))},448475,(a,b,c)=>{"use strict";let d=a.r(76014);class e extends Error{constructor(a){super(a),this.name="TimeoutError"}}let f=(a,b,c)=>new Promise((f,g)=>{if("number"!=typeof b||b<0)throw TypeError("Expected `milliseconds` to be a positive number");if(b===1/0)return void f(a);let h=setTimeout(()=>{if("function"==typeof c){try{f(c())}catch(a){g(a)}return}let d="string"==typeof c?c:`Promise timed out after ${b} milliseconds`,h=c instanceof Error?c:new e(d);"function"==typeof a.cancel&&a.cancel(),g(h)},b);d(a.then(f,g),()=>{clearTimeout(h)})});b.exports=f,b.exports.default=f,b.exports.TimeoutError=e},134822,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=function(a,b,c){let d=0,e=a.length;for(;e>0;){let f=e/2|0,g=d+f;0>=c(a[g],b)?(d=++g,e-=f+1):e=f}return d}},547548,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(134822);c.default=class{constructor(){this._queue=[]}enqueue(a,b){let c={priority:(b=Object.assign({priority:0},b)).priority,run:a};if(this.size&&this._queue[this.size-1].priority>=b.priority)return void this._queue.push(c);let e=d.default(this._queue,c,(a,b)=>b.priority-a.priority);this._queue.splice(e,0,c)}dequeue(){let a=this._queue.shift();return null==a?void 0:a.run}filter(a){return this._queue.filter(b=>b.priority===a.priority).map(a=>a.run)}get size(){return this._queue.length}}},67158,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(505823),e=a.r(448475),f=a.r(547548),g=()=>{},h=new e.TimeoutError;c.default=class extends d{constructor(a){var b,c,d,e;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=g,this._resolveIdle=g,!("number"==typeof(a=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:f.default},a)).intervalCap&&a.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!=(c=null==(b=a.intervalCap)?void 0:b.toString())?c:""}\` (${typeof a.intervalCap})`);if(void 0===a.interval||!(Number.isFinite(a.interval)&&a.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!=(e=null==(d=a.interval)?void 0:d.toString())?e:""}\` (${typeof a.interval})`);this._carryoverConcurrencyCount=a.carryoverConcurrencyCount,this._isIntervalIgnored=a.intervalCap===1/0||0===a.interval,this._intervalCap=a.intervalCap,this._interval=a.interval,this._queue=new a.queueClass,this._queueClass=a.queueClass,this.concurrency=a.concurrency,this._timeout=a.timeout,this._throwOnTimeout=!0===a.throwOnTimeout,this._isPaused=!1===a.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=g,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=g,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let a=Date.now();if(void 0===this._intervalId){let b=this._intervalEnd-a;if(!(b<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},b)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let a=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let b=this._queue.dequeue();return!!b&&(this.emit("active"),b(),a&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(a){if(!("number"==typeof a&&a>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${a}\` (${typeof a})`);this._concurrency=a,this._processQueue()}async add(a,b={}){return new Promise((c,d)=>{let f=async()=>{this._pendingCount++,this._intervalCount++;try{let f=void 0===this._timeout&&void 0===b.timeout?a():e.default(Promise.resolve(a()),void 0===b.timeout?this._timeout:b.timeout,()=>{(void 0===b.throwOnTimeout?this._throwOnTimeout:b.throwOnTimeout)&&d(h)});c(await f)}catch(a){d(a)}this._next()};this._queue.enqueue(f,b),this._tryToStartAnother(),this.emit("add")})}async addAll(a,b){return Promise.all(a.map(async a=>this.add(a,b)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(a=>{let b=this._resolveEmpty;this._resolveEmpty=()=>{b(),a()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(a=>{let b=this._resolveIdle;this._resolveIdle=()=>{b(),a()}})}get size(){return this._queue.size}sizeBy(a){return this._queue.filter(a).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(a){this._timeout=a}}},359827,(a,b,c)=>{"use strict";b.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||0x1fffffffffffff,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},208263,(a,b,c)=>{"use strict";b.exports="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...a)=>console.error("SEMVER",...a):()=>{}},504927,(a,b,c)=>{"use strict";let{MAX_SAFE_COMPONENT_LENGTH:d,MAX_SAFE_BUILD_LENGTH:e,MAX_LENGTH:f}=a.r(359827),g=a.r(208263),h=(c=b.exports={}).re=[],i=c.safeRe=[],j=c.src=[],k=c.safeSrc=[],l=c.t={},m=0,n="[a-zA-Z0-9-]",o=[["\\s",1],["\\d",f],[n,e]],p=(a,b,c)=>{let d=(a=>{for(let[b,c]of o)a=a.split(`${b}*`).join(`${b}{0,${c}}`).split(`${b}+`).join(`${b}{1,${c}}`);return a})(b),e=m++;g(a,e,b),l[a]=e,j[e]=b,k[e]=d,h[e]=new RegExp(b,c?"g":void 0),i[e]=new RegExp(d,c?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${n}*`),p("MAINVERSION",`(${j[l.NUMERICIDENTIFIER]})\\.(${j[l.NUMERICIDENTIFIER]})\\.(${j[l.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${j[l.NUMERICIDENTIFIERLOOSE]})\\.(${j[l.NUMERICIDENTIFIERLOOSE]})\\.(${j[l.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${j[l.NONNUMERICIDENTIFIER]}|${j[l.NUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${j[l.NONNUMERICIDENTIFIER]}|${j[l.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASE",`(?:-(${j[l.PRERELEASEIDENTIFIER]}(?:\\.${j[l.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${j[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${j[l.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${n}+`),p("BUILD",`(?:\\+(${j[l.BUILDIDENTIFIER]}(?:\\.${j[l.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${j[l.MAINVERSION]}${j[l.PRERELEASE]}?${j[l.BUILD]}?`),p("FULL",`^${j[l.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${j[l.MAINVERSIONLOOSE]}${j[l.PRERELEASELOOSE]}?${j[l.BUILD]}?`),p("LOOSE",`^${j[l.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${j[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${j[l.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${j[l.XRANGEIDENTIFIER]})(?:\\.(${j[l.XRANGEIDENTIFIER]})(?:\\.(${j[l.XRANGEIDENTIFIER]})(?:${j[l.PRERELEASE]})?${j[l.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${j[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${j[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${j[l.XRANGEIDENTIFIERLOOSE]})(?:${j[l.PRERELEASELOOSE]})?${j[l.BUILD]}?)?)?`),p("XRANGE",`^${j[l.GTLT]}\\s*${j[l.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${j[l.GTLT]}\\s*${j[l.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${d}})(?:\\.(\\d{1,${d}}))?(?:\\.(\\d{1,${d}}))?`),p("COERCE",`${j[l.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",j[l.COERCEPLAIN]+`(?:${j[l.PRERELEASE]})?`+`(?:${j[l.BUILD]})?`+"(?:$|[^\\d])"),p("COERCERTL",j[l.COERCE],!0),p("COERCERTLFULL",j[l.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${j[l.LONETILDE]}\\s+`,!0),c.tildeTrimReplace="$1~",p("TILDE",`^${j[l.LONETILDE]}${j[l.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${j[l.LONETILDE]}${j[l.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${j[l.LONECARET]}\\s+`,!0),c.caretTrimReplace="$1^",p("CARET",`^${j[l.LONECARET]}${j[l.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${j[l.LONECARET]}${j[l.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${j[l.GTLT]}\\s*(${j[l.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${j[l.GTLT]}\\s*(${j[l.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${j[l.GTLT]}\\s*(${j[l.LOOSEPLAIN]}|${j[l.XRANGEPLAIN]})`,!0),c.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${j[l.XRANGEPLAIN]})\\s+-\\s+(${j[l.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${j[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${j[l.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},418866,(a,b,c)=>{"use strict";let d=Object.freeze({loose:!0}),e=Object.freeze({});b.exports=a=>a?"object"!=typeof a?d:a:e},99291,(a,b,c)=>{"use strict";let d=/^[0-9]+$/,e=(a,b)=>{if("number"==typeof a&&"number"==typeof b)return a===b?0:a<b?-1:1;let c=d.test(a),e=d.test(b);return c&&e&&(a*=1,b*=1),a===b?0:c&&!e?-1:e&&!c?1:a<b?-1:1};b.exports={compareIdentifiers:e,rcompareIdentifiers:(a,b)=>e(b,a)}},464858,(a,b,c)=>{"use strict";let d=a.r(208263),{MAX_LENGTH:e,MAX_SAFE_INTEGER:f}=a.r(359827),{safeRe:g,t:h}=a.r(504927),i=a.r(418866),{compareIdentifiers:j}=a.r(99291);class k{constructor(a,b){if(b=i(b),a instanceof k)if(!!b.loose===a.loose&&!!b.includePrerelease===a.includePrerelease)return a;else a=a.version;else if("string"!=typeof a)throw TypeError(`Invalid version. Must be a string. Got type "${typeof a}".`);if(a.length>e)throw TypeError(`version is longer than ${e} characters`);d("SemVer",a,b),this.options=b,this.loose=!!b.loose,this.includePrerelease=!!b.includePrerelease;const c=a.trim().match(b.loose?g[h.LOOSE]:g[h.FULL]);if(!c)throw TypeError(`Invalid Version: ${a}`);if(this.raw=a,this.major=+c[1],this.minor=+c[2],this.patch=+c[3],this.major>f||this.major<0)throw TypeError("Invalid major version");if(this.minor>f||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>f||this.patch<0)throw TypeError("Invalid patch version");c[4]?this.prerelease=c[4].split(".").map(a=>{if(/^[0-9]+$/.test(a)){let b=+a;if(b>=0&&b<f)return b}return a}):this.prerelease=[],this.build=c[5]?c[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(a){if(d("SemVer.compare",this.version,this.options,a),!(a instanceof k)){if("string"==typeof a&&a===this.version)return 0;a=new k(a,this.options)}return a.version===this.version?0:this.compareMain(a)||this.comparePre(a)}compareMain(a){return(a instanceof k||(a=new k(a,this.options)),this.major<a.major)?-1:this.major>a.major?1:this.minor<a.minor?-1:this.minor>a.minor?1:this.patch<a.patch?-1:+(this.patch>a.patch)}comparePre(a){if(a instanceof k||(a=new k(a,this.options)),this.prerelease.length&&!a.prerelease.length)return -1;if(!this.prerelease.length&&a.prerelease.length)return 1;if(!this.prerelease.length&&!a.prerelease.length)return 0;let b=0;do{let c=this.prerelease[b],e=a.prerelease[b];if(d("prerelease compare",b,c,e),void 0===c&&void 0===e)return 0;if(void 0===e)return 1;if(void 0===c)return -1;else if(c===e)continue;else return j(c,e)}while(++b)}compareBuild(a){a instanceof k||(a=new k(a,this.options));let b=0;do{let c=this.build[b],e=a.build[b];if(d("build compare",b,c,e),void 0===c&&void 0===e)return 0;if(void 0===e)return 1;if(void 0===c)return -1;else if(c===e)continue;else return j(c,e)}while(++b)}inc(a,b,c){if(a.startsWith("pre")){if(!b&&!1===c)throw Error("invalid increment argument: identifier is empty");if(b){let a=`-${b}`.match(this.options.loose?g[h.PRERELEASELOOSE]:g[h.PRERELEASE]);if(!a||a[1]!==b)throw Error(`invalid identifier: ${b}`)}}switch(a){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",b,c);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",b,c);break;case"prepatch":this.prerelease.length=0,this.inc("patch",b,c),this.inc("pre",b,c);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",b,c),this.inc("pre",b,c);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let a=+!!Number(c);if(0===this.prerelease.length)this.prerelease=[a];else{let d=this.prerelease.length;for(;--d>=0;)"number"==typeof this.prerelease[d]&&(this.prerelease[d]++,d=-2);if(-1===d){if(b===this.prerelease.join(".")&&!1===c)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(a)}}if(b){let d=[b,a];!1===c&&(d=[b]),0===j(this.prerelease[0],b)?isNaN(this.prerelease[1])&&(this.prerelease=d):this.prerelease=d}break}default:throw Error(`invalid increment argument: ${a}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}b.exports=k},269564,(a,b,c)=>{"use strict";let d=a.r(464858);b.exports=(a,b,c=!1)=>{if(a instanceof d)return a;try{return new d(a,b)}catch(a){if(!c)return null;throw a}}},231428,(a,b,c)=>{"use strict";let d=a.r(269564);b.exports=(a,b)=>{let c=d(a,b);return c?c.version:null}},769611,(a,b,c)=>{"use strict";let d=a.r(269564);b.exports=(a,b)=>{let c=d(a.trim().replace(/^[=v]+/,""),b);return c?c.version:null}},419734,(a,b,c)=>{"use strict";let d=a.r(464858);b.exports=(a,b,c,e,f)=>{"string"==typeof c&&(f=e,e=c,c=void 0);try{return new d(a instanceof d?a.version:a,c).inc(b,e,f).version}catch(a){return null}}},805245,(a,b,c)=>{"use strict";let d=a.r(269564);b.exports=(a,b)=>{let c=d(a,null,!0),e=d(b,null,!0),f=c.compare(e);if(0===f)return null;let g=f>0,h=g?c:e,i=g?e:c,j=!!h.prerelease.length;if(i.prerelease.length&&!j){if(!i.patch&&!i.minor)return"major";if(0===i.compareMain(h))return i.minor&&!i.patch?"minor":"patch"}let k=j?"pre":"";return c.major!==e.major?k+"major":c.minor!==e.minor?k+"minor":c.patch!==e.patch?k+"patch":"prerelease"}},259859,(a,b,c)=>{"use strict";let d=a.r(464858);b.exports=(a,b)=>new d(a,b).major},524948,(a,b,c)=>{"use strict";let d=a.r(464858);b.exports=(a,b)=>new d(a,b).minor},885830,(a,b,c)=>{"use strict";let d=a.r(464858);b.exports=(a,b)=>new d(a,b).patch},347304,(a,b,c)=>{"use strict";let d=a.r(269564);b.exports=(a,b)=>{let c=d(a,b);return c&&c.prerelease.length?c.prerelease:null}},312891,(a,b,c)=>{"use strict";let d=a.r(464858);b.exports=(a,b,c)=>new d(a,c).compare(new d(b,c))},119281,(a,b,c)=>{"use strict";let d=a.r(312891);b.exports=(a,b,c)=>d(b,a,c)},227139,(a,b,c)=>{"use strict";let d=a.r(312891);b.exports=(a,b)=>d(a,b,!0)},76233,(a,b,c)=>{"use strict";let d=a.r(464858);b.exports=(a,b,c)=>{let e=new d(a,c),f=new d(b,c);return e.compare(f)||e.compareBuild(f)}},875419,(a,b,c)=>{"use strict";let d=a.r(76233);b.exports=(a,b)=>a.sort((a,c)=>d(a,c,b))},625374,(a,b,c)=>{"use strict";let d=a.r(76233);b.exports=(a,b)=>a.sort((a,c)=>d(c,a,b))},189455,(a,b,c)=>{"use strict";let d=a.r(312891);b.exports=(a,b,c)=>d(a,b,c)>0},906736,(a,b,c)=>{"use strict";let d=a.r(312891);b.exports=(a,b,c)=>0>d(a,b,c)},91253,(a,b,c)=>{"use strict";let d=a.r(312891);b.exports=(a,b,c)=>0===d(a,b,c)},105220,(a,b,c)=>{"use strict";let d=a.r(312891);b.exports=(a,b,c)=>0!==d(a,b,c)},773062,(a,b,c)=>{"use strict";let d=a.r(312891);b.exports=(a,b,c)=>d(a,b,c)>=0},4780,(a,b,c)=>{"use strict";let d=a.r(312891);b.exports=(a,b,c)=>0>=d(a,b,c)},218319,(a,b,c)=>{"use strict";let d=a.r(91253),e=a.r(105220),f=a.r(189455),g=a.r(773062),h=a.r(906736),i=a.r(4780);b.exports=(a,b,c,j)=>{switch(b){case"===":return"object"==typeof a&&(a=a.version),"object"==typeof c&&(c=c.version),a===c;case"!==":return"object"==typeof a&&(a=a.version),"object"==typeof c&&(c=c.version),a!==c;case"":case"=":case"==":return d(a,c,j);case"!=":return e(a,c,j);case">":return f(a,c,j);case">=":return g(a,c,j);case"<":return h(a,c,j);case"<=":return i(a,c,j);default:throw TypeError(`Invalid operator: ${b}`)}}},263858,(a,b,c)=>{"use strict";let d=a.r(464858),e=a.r(269564),{safeRe:f,t:g}=a.r(504927);b.exports=(a,b)=>{if(a instanceof d)return a;if("number"==typeof a&&(a=String(a)),"string"!=typeof a)return null;let c=null;if((b=b||{}).rtl){let d,e=b.includePrerelease?f[g.COERCERTLFULL]:f[g.COERCERTL];for(;(d=e.exec(a))&&(!c||c.index+c[0].length!==a.length);)c&&d.index+d[0].length===c.index+c[0].length||(c=d),e.lastIndex=d.index+d[1].length+d[2].length;e.lastIndex=-1}else c=a.match(b.includePrerelease?f[g.COERCEFULL]:f[g.COERCE]);if(null===c)return null;let h=c[2],i=c[3]||"0",j=c[4]||"0",k=b.includePrerelease&&c[5]?`-${c[5]}`:"",l=b.includePrerelease&&c[6]?`+${c[6]}`:"";return e(`${h}.${i}.${j}${k}${l}`,b)}},799762,(a,b,c)=>{"use strict";b.exports=class{constructor(){this.max=1e3,this.map=new Map}get(a){let b=this.map.get(a);if(void 0!==b)return this.map.delete(a),this.map.set(a,b),b}delete(a){return this.map.delete(a)}set(a,b){if(!this.delete(a)&&void 0!==b){if(this.map.size>=this.max){let a=this.map.keys().next().value;this.delete(a)}this.map.set(a,b)}return this}}},205951,(a,b,c)=>{"use strict";let d=/\s+/g;class e{constructor(a,b){if(b=g(b),a instanceof e)if(!!b.loose===a.loose&&!!b.includePrerelease===a.includePrerelease)return a;else return new e(a.raw,b);if(a instanceof h)return this.raw=a.value,this.set=[[a]],this.formatted=void 0,this;if(this.options=b,this.loose=!!b.loose,this.includePrerelease=!!b.includePrerelease,this.raw=a.trim().replace(d," "),this.set=this.raw.split("||").map(a=>this.parseRange(a.trim())).filter(a=>a.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const a=this.set[0];if(this.set=this.set.filter(a=>!r(a[0])),0===this.set.length)this.set=[a];else if(this.set.length>1){for(const a of this.set)if(1===a.length&&s(a[0])){this.set=[a];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let a=0;a<this.set.length;a++){a>0&&(this.formatted+="||");let b=this.set[a];for(let a=0;a<b.length;a++)a>0&&(this.formatted+=" "),this.formatted+=b[a].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(a){let b=((this.options.includePrerelease&&p)|(this.options.loose&&q))+":"+a,c=f.get(b);if(c)return c;let d=this.options.loose,e=d?k[l.HYPHENRANGELOOSE]:k[l.HYPHENRANGE];i("hyphen replace",a=a.replace(e,E(this.options.includePrerelease))),i("comparator trim",a=a.replace(k[l.COMPARATORTRIM],m)),i("tilde trim",a=a.replace(k[l.TILDETRIM],n)),i("caret trim",a=a.replace(k[l.CARETTRIM],o));let g=a.split(" ").map(a=>u(a,this.options)).join(" ").split(/\s+/).map(a=>D(a,this.options));d&&(g=g.filter(a=>(i("loose invalid filter",a,this.options),!!a.match(k[l.COMPARATORLOOSE])))),i("range list",g);let j=new Map;for(let a of g.map(a=>new h(a,this.options))){if(r(a))return[a];j.set(a.value,a)}j.size>1&&j.has("")&&j.delete("");let s=[...j.values()];return f.set(b,s),s}intersects(a,b){if(!(a instanceof e))throw TypeError("a Range is required");return this.set.some(c=>t(c,b)&&a.set.some(a=>t(a,b)&&c.every(c=>a.every(a=>c.intersects(a,b)))))}test(a){if(!a)return!1;if("string"==typeof a)try{a=new j(a,this.options)}catch(a){return!1}for(let b=0;b<this.set.length;b++)if(F(this.set[b],a,this.options))return!0;return!1}}b.exports=e;let f=new(a.r(799762)),g=a.r(418866),h=a.r(530832),i=a.r(208263),j=a.r(464858),{safeRe:k,t:l,comparatorTrimReplace:m,tildeTrimReplace:n,caretTrimReplace:o}=a.r(504927),{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:q}=a.r(359827),r=a=>"<0.0.0-0"===a.value,s=a=>""===a.value,t=(a,b)=>{let c=!0,d=a.slice(),e=d.pop();for(;c&&d.length;)c=d.every(a=>e.intersects(a,b)),e=d.pop();return c},u=(a,b)=>(i("comp",a=a.replace(k[l.BUILD],""),b),i("caret",a=y(a,b)),i("tildes",a=w(a,b)),i("xrange",a=A(a,b)),i("stars",a=C(a,b)),a),v=a=>!a||"x"===a.toLowerCase()||"*"===a,w=(a,b)=>a.trim().split(/\s+/).map(a=>x(a,b)).join(" "),x=(a,b)=>{let c=b.loose?k[l.TILDELOOSE]:k[l.TILDE];return a.replace(c,(b,c,d,e,f)=>{let g;return i("tilde",a,b,c,d,e,f),v(c)?g="":v(d)?g=`>=${c}.0.0 <${+c+1}.0.0-0`:v(e)?g=`>=${c}.${d}.0 <${c}.${+d+1}.0-0`:f?(i("replaceTilde pr",f),g=`>=${c}.${d}.${e}-${f} <${c}.${+d+1}.0-0`):g=`>=${c}.${d}.${e} <${c}.${+d+1}.0-0`,i("tilde return",g),g})},y=(a,b)=>a.trim().split(/\s+/).map(a=>z(a,b)).join(" "),z=(a,b)=>{i("caret",a,b);let c=b.loose?k[l.CARETLOOSE]:k[l.CARET],d=b.includePrerelease?"-0":"";return a.replace(c,(b,c,e,f,g)=>{let h;return i("caret",a,b,c,e,f,g),v(c)?h="":v(e)?h=`>=${c}.0.0${d} <${+c+1}.0.0-0`:v(f)?h="0"===c?`>=${c}.${e}.0${d} <${c}.${+e+1}.0-0`:`>=${c}.${e}.0${d} <${+c+1}.0.0-0`:g?(i("replaceCaret pr",g),h="0"===c?"0"===e?`>=${c}.${e}.${f}-${g} <${c}.${e}.${+f+1}-0`:`>=${c}.${e}.${f}-${g} <${c}.${+e+1}.0-0`:`>=${c}.${e}.${f}-${g} <${+c+1}.0.0-0`):(i("no pr"),h="0"===c?"0"===e?`>=${c}.${e}.${f}${d} <${c}.${e}.${+f+1}-0`:`>=${c}.${e}.${f}${d} <${c}.${+e+1}.0-0`:`>=${c}.${e}.${f} <${+c+1}.0.0-0`),i("caret return",h),h})},A=(a,b)=>(i("replaceXRanges",a,b),a.split(/\s+/).map(a=>B(a,b)).join(" ")),B=(a,b)=>{a=a.trim();let c=b.loose?k[l.XRANGELOOSE]:k[l.XRANGE];return a.replace(c,(c,d,e,f,g,h)=>{i("xRange",a,c,d,e,f,g,h);let j=v(e),k=j||v(f),l=k||v(g);return"="===d&&l&&(d=""),h=b.includePrerelease?"-0":"",j?c=">"===d||"<"===d?"<0.0.0-0":"*":d&&l?(k&&(f=0),g=0,">"===d?(d=">=",k?(e=+e+1,f=0):f=+f+1,g=0):"<="===d&&(d="<",k?e=+e+1:f=+f+1),"<"===d&&(h="-0"),c=`${d+e}.${f}.${g}${h}`):k?c=`>=${e}.0.0${h} <${+e+1}.0.0-0`:l&&(c=`>=${e}.${f}.0${h} <${e}.${+f+1}.0-0`),i("xRange return",c),c})},C=(a,b)=>(i("replaceStars",a,b),a.trim().replace(k[l.STAR],"")),D=(a,b)=>(i("replaceGTE0",a,b),a.trim().replace(k[b.includePrerelease?l.GTE0PRE:l.GTE0],"")),E=a=>(b,c,d,e,f,g,h,i,j,k,l,m)=>(c=v(d)?"":v(e)?`>=${d}.0.0${a?"-0":""}`:v(f)?`>=${d}.${e}.0${a?"-0":""}`:g?`>=${c}`:`>=${c}${a?"-0":""}`,i=v(j)?"":v(k)?`<${+j+1}.0.0-0`:v(l)?`<${j}.${+k+1}.0-0`:m?`<=${j}.${k}.${l}-${m}`:a?`<${j}.${k}.${+l+1}-0`:`<=${i}`,`${c} ${i}`.trim()),F=(a,b,c)=>{for(let c=0;c<a.length;c++)if(!a[c].test(b))return!1;if(b.prerelease.length&&!c.includePrerelease){for(let c=0;c<a.length;c++)if(i(a[c].semver),a[c].semver!==h.ANY&&a[c].semver.prerelease.length>0){let d=a[c].semver;if(d.major===b.major&&d.minor===b.minor&&d.patch===b.patch)return!0}return!1}return!0}},530832,(a,b,c)=>{"use strict";let d=Symbol("SemVer ANY");class e{static get ANY(){return d}constructor(a,b){if(b=f(b),a instanceof e)if(!!b.loose===a.loose)return a;else a=a.value;j("comparator",a=a.trim().split(/\s+/).join(" "),b),this.options=b,this.loose=!!b.loose,this.parse(a),this.semver===d?this.value="":this.value=this.operator+this.semver.version,j("comp",this)}parse(a){let b=this.options.loose?g[h.COMPARATORLOOSE]:g[h.COMPARATOR],c=a.match(b);if(!c)throw TypeError(`Invalid comparator: ${a}`);this.operator=void 0!==c[1]?c[1]:"","="===this.operator&&(this.operator=""),c[2]?this.semver=new k(c[2],this.options.loose):this.semver=d}toString(){return this.value}test(a){if(j("Comparator.test",a,this.options.loose),this.semver===d||a===d)return!0;if("string"==typeof a)try{a=new k(a,this.options)}catch(a){return!1}return i(a,this.operator,this.semver,this.options)}intersects(a,b){if(!(a instanceof e))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new l(a.value,b).test(this.value):""===a.operator?""===a.value||new l(this.value,b).test(a.semver):!((b=f(b)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===a.value)||!b.includePrerelease&&(this.value.startsWith("<0.0.0")||a.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&a.operator.startsWith(">")||this.operator.startsWith("<")&&a.operator.startsWith("<")||this.semver.version===a.semver.version&&this.operator.includes("=")&&a.operator.includes("=")||i(this.semver,"<",a.semver,b)&&this.operator.startsWith(">")&&a.operator.startsWith("<")||i(this.semver,">",a.semver,b)&&this.operator.startsWith("<")&&a.operator.startsWith(">"))}}b.exports=e;let f=a.r(418866),{safeRe:g,t:h}=a.r(504927),i=a.r(218319),j=a.r(208263),k=a.r(464858),l=a.r(205951)},451628,(a,b,c)=>{"use strict";let d=a.r(205951);b.exports=(a,b,c)=>{try{b=new d(b,c)}catch(a){return!1}return b.test(a)}},198490,(a,b,c)=>{"use strict";let d=a.r(205951);b.exports=(a,b)=>new d(a,b).set.map(a=>a.map(a=>a.value).join(" ").trim().split(" "))},86882,(a,b,c)=>{"use strict";let d=a.r(464858),e=a.r(205951);b.exports=(a,b,c)=>{let f=null,g=null,h=null;try{h=new e(b,c)}catch(a){return null}return a.forEach(a=>{h.test(a)&&(!f||-1===g.compare(a))&&(g=new d(f=a,c))}),f}},200973,(a,b,c)=>{"use strict";let d=a.r(464858),e=a.r(205951);b.exports=(a,b,c)=>{let f=null,g=null,h=null;try{h=new e(b,c)}catch(a){return null}return a.forEach(a=>{h.test(a)&&(!f||1===g.compare(a))&&(g=new d(f=a,c))}),f}},160128,(a,b,c)=>{"use strict";let d=a.r(464858),e=a.r(205951),f=a.r(189455);b.exports=(a,b)=>{a=new e(a,b);let c=new d("0.0.0");if(a.test(c)||(c=new d("0.0.0-0"),a.test(c)))return c;c=null;for(let b=0;b<a.set.length;++b){let e=a.set[b],g=null;e.forEach(a=>{let b=new d(a.semver.version);switch(a.operator){case">":0===b.prerelease.length?b.patch++:b.prerelease.push(0),b.raw=b.format();case"":case">=":(!g||f(b,g))&&(g=b);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${a.operator}`)}}),g&&(!c||f(c,g))&&(c=g)}return c&&a.test(c)?c:null}},856425,(a,b,c)=>{"use strict";let d=a.r(205951);b.exports=(a,b)=>{try{return new d(a,b).range||"*"}catch(a){return null}}},660968,(a,b,c)=>{"use strict";let d=a.r(464858),e=a.r(530832),{ANY:f}=e,g=a.r(205951),h=a.r(451628),i=a.r(189455),j=a.r(906736),k=a.r(4780),l=a.r(773062);b.exports=(a,b,c,m)=>{let n,o,p,q,r;switch(a=new d(a,m),b=new g(b,m),c){case">":n=i,o=k,p=j,q=">",r=">=";break;case"<":n=j,o=l,p=i,q="<",r="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(h(a,b,m))return!1;for(let c=0;c<b.set.length;++c){let d=b.set[c],g=null,h=null;if(d.forEach(a=>{a.semver===f&&(a=new e(">=0.0.0")),g=g||a,h=h||a,n(a.semver,g.semver,m)?g=a:p(a.semver,h.semver,m)&&(h=a)}),g.operator===q||g.operator===r||(!h.operator||h.operator===q)&&o(a,h.semver)||h.operator===r&&p(a,h.semver))return!1}return!0}},823866,(a,b,c)=>{"use strict";let d=a.r(660968);b.exports=(a,b,c)=>d(a,b,">",c)},168835,(a,b,c)=>{"use strict";let d=a.r(660968);b.exports=(a,b,c)=>d(a,b,"<",c)},689962,(a,b,c)=>{"use strict";let d=a.r(205951);b.exports=(a,b,c)=>(a=new d(a,c),b=new d(b,c),a.intersects(b,c))},720049,(a,b,c)=>{"use strict";let d=a.r(451628),e=a.r(312891);b.exports=(a,b,c)=>{let f=[],g=null,h=null,i=a.sort((a,b)=>e(a,b,c));for(let a of i)d(a,b,c)?(h=a,g||(g=a)):(h&&f.push([g,h]),h=null,g=null);g&&f.push([g,null]);let j=[];for(let[a,b]of f)a===b?j.push(a):b||a!==i[0]?b?a===i[0]?j.push(`<=${b}`):j.push(`${a} - ${b}`):j.push(`>=${a}`):j.push("*");let k=j.join(" || "),l="string"==typeof b.raw?b.raw:String(b);return k.length<l.length?k:b}},97755,(a,b,c)=>{"use strict";let d=a.r(205951),e=a.r(530832),{ANY:f}=e,g=a.r(451628),h=a.r(312891),i=[new e(">=0.0.0-0")],j=[new e(">=0.0.0")],k=(a,b,c)=>{let d,e,k,n,o,p,q;if(a===b)return!0;if(1===a.length&&a[0].semver===f)if(1===b.length&&b[0].semver===f)return!0;else a=c.includePrerelease?i:j;if(1===b.length&&b[0].semver===f)if(c.includePrerelease)return!0;else b=j;let r=new Set;for(let b of a)">"===b.operator||">="===b.operator?d=l(d,b,c):"<"===b.operator||"<="===b.operator?e=m(e,b,c):r.add(b.semver);if(r.size>1)return null;if(d&&e&&((k=h(d.semver,e.semver,c))>0||0===k&&(">="!==d.operator||"<="!==e.operator)))return null;for(let a of r){if(d&&!g(a,String(d),c)||e&&!g(a,String(e),c))return null;for(let d of b)if(!g(a,String(d),c))return!1;return!0}let s=!!e&&!c.includePrerelease&&!!e.semver.prerelease.length&&e.semver,t=!!d&&!c.includePrerelease&&!!d.semver.prerelease.length&&d.semver;for(let a of(s&&1===s.prerelease.length&&"<"===e.operator&&0===s.prerelease[0]&&(s=!1),b)){if(q=q||">"===a.operator||">="===a.operator,p=p||"<"===a.operator||"<="===a.operator,d){if(t&&a.semver.prerelease&&a.semver.prerelease.length&&a.semver.major===t.major&&a.semver.minor===t.minor&&a.semver.patch===t.patch&&(t=!1),">"===a.operator||">="===a.operator){if((n=l(d,a,c))===a&&n!==d)return!1}else if(">="===d.operator&&!g(d.semver,String(a),c))return!1}if(e){if(s&&a.semver.prerelease&&a.semver.prerelease.length&&a.semver.major===s.major&&a.semver.minor===s.minor&&a.semver.patch===s.patch&&(s=!1),"<"===a.operator||"<="===a.operator){if((o=m(e,a,c))===a&&o!==e)return!1}else if("<="===e.operator&&!g(e.semver,String(a),c))return!1}if(!a.operator&&(e||d)&&0!==k)return!1}return(!d||!p||!!e||0===k)&&(!e||!q||!!d||0===k)&&!t&&!s&&!0},l=(a,b,c)=>{if(!a)return b;let d=h(a.semver,b.semver,c);return d>0?a:d<0||">"===b.operator&&">="===a.operator?b:a},m=(a,b,c)=>{if(!a)return b;let d=h(a.semver,b.semver,c);return d<0?a:d>0||"<"===b.operator&&"<="===a.operator?b:a};b.exports=(a,b,c={})=>{if(a===b)return!0;a=new d(a,c),b=new d(b,c);let e=!1;a:for(let d of a.set){for(let a of b.set){let b=k(d,a,c);if(e=e||null!==b,b)continue a}if(e)return!1}return!0}},139833,(a,b,c)=>{"use strict";let d=a.r(504927),e=a.r(359827),f=a.r(464858),g=a.r(99291),h=a.r(269564),i=a.r(231428),j=a.r(769611),k=a.r(419734),l=a.r(805245),m=a.r(259859),n=a.r(524948),o=a.r(885830),p=a.r(347304),q=a.r(312891),r=a.r(119281),s=a.r(227139),t=a.r(76233),u=a.r(875419),v=a.r(625374),w=a.r(189455),x=a.r(906736),y=a.r(91253),z=a.r(105220),A=a.r(773062),B=a.r(4780),C=a.r(218319),D=a.r(263858),E=a.r(530832),F=a.r(205951),G=a.r(451628),H=a.r(198490),I=a.r(86882),J=a.r(200973),K=a.r(160128),L=a.r(856425),M=a.r(660968),N=a.r(823866),O=a.r(168835),P=a.r(689962);b.exports={parse:h,valid:i,clean:j,inc:k,diff:l,major:m,minor:n,patch:o,prerelease:p,compare:q,rcompare:r,compareLoose:s,compareBuild:t,sort:u,rsort:v,gt:w,lt:x,eq:y,neq:z,gte:A,lte:B,cmp:C,coerce:D,Comparator:E,Range:F,satisfies:G,toComparators:H,maxSatisfying:I,minSatisfying:J,minVersion:K,validRange:L,outside:M,gtr:N,ltr:O,intersects:P,simplifyRange:a.r(720049),subset:a.r(97755),SemVer:f,re:d.re,src:d.src,tokens:d.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:g.compareIdentifiers,rcompareIdentifiers:g.rcompareIdentifiers}},971564,(a,b,c)=>{"use strict";var d=Object.prototype.hasOwnProperty,e="~";function f(){}function g(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function h(a,b,c,d,f){if("function"!=typeof c)throw TypeError("The listener must be a function");var h=new g(c,d||a,f),i=e?e+b:b;return a._events[i]?a._events[i].fn?a._events[i]=[a._events[i],h]:a._events[i].push(h):(a._events[i]=h,a._eventsCount++),a}function i(a,b){0==--a._eventsCount?a._events=new f:delete a._events[b]}function j(){this._events=new f,this._eventsCount=0}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(e=!1)),j.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)d.call(a,b)&&c.push(e?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},j.prototype.listeners=function(a){var b=e?e+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,g=Array(f);d<f;d++)g[d]=c[d].fn;return g},j.prototype.listenerCount=function(a){var b=e?e+a:a,c=this._events[b];return c?c.fn?1:c.length:0},j.prototype.emit=function(a,b,c,d,f,g){var h=e?e+a:a;if(!this._events[h])return!1;var i,j,k=this._events[h],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,f),!0;case 6:return k.fn.call(k.context,b,c,d,f,g),!0}for(j=1,i=Array(l-1);j<l;j++)i[j-1]=arguments[j];k.fn.apply(k.context,i)}else{var m,n=k.length;for(j=0;j<n;j++)switch(k[j].once&&this.removeListener(a,k[j].fn,void 0,!0),l){case 1:k[j].fn.call(k[j].context);break;case 2:k[j].fn.call(k[j].context,b);break;case 3:k[j].fn.call(k[j].context,b,c);break;case 4:k[j].fn.call(k[j].context,b,c,d);break;default:if(!i)for(m=1,i=Array(l-1);m<l;m++)i[m-1]=arguments[m];k[j].fn.apply(k[j].context,i)}}return!0},j.prototype.on=function(a,b,c){return h(this,a,b,c,!1)},j.prototype.once=function(a,b,c){return h(this,a,b,c,!0)},j.prototype.removeListener=function(a,b,c,d){var f=e?e+a:a;if(!this._events[f])return this;if(!b)return i(this,f),this;var g=this._events[f];if(g.fn)g.fn!==b||d&&!g.once||c&&g.context!==c||i(this,f);else{for(var h=0,j=[],k=g.length;h<k;h++)(g[h].fn!==b||d&&!g[h].once||c&&g[h].context!==c)&&j.push(g[h]);j.length?this._events[f]=1===j.length?j[0]:j:i(this,f)}return this},j.prototype.removeAllListeners=function(a){var b;return a?(b=e?e+a:a,this._events[b]&&i(this,b)):(this._events=new f,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=e,j.EventEmitter=j,b.exports=j},584709,(a,b,c)=>{"use strict";c.byteLength=function(a){var b=j(a),c=b[0],d=b[1];return(c+d)*3/4-d},c.toByteArray=function(a){var b,c,d=j(a),g=d[0],h=d[1],i=new f((g+h)*3/4-h),k=0,l=h>0?g-4:g;for(c=0;c<l;c+=4)b=e[a.charCodeAt(c)]<<18|e[a.charCodeAt(c+1)]<<12|e[a.charCodeAt(c+2)]<<6|e[a.charCodeAt(c+3)],i[k++]=b>>16&255,i[k++]=b>>8&255,i[k++]=255&b;return 2===h&&(b=e[a.charCodeAt(c)]<<2|e[a.charCodeAt(c+1)]>>4,i[k++]=255&b),1===h&&(b=e[a.charCodeAt(c)]<<10|e[a.charCodeAt(c+1)]<<4|e[a.charCodeAt(c+2)]>>2,i[k++]=b>>8&255,i[k++]=255&b),i},c.fromByteArray=function(a){for(var b,c=a.length,e=c%3,f=[],g=0,h=c-e;g<h;g+=16383)f.push(function(a,b,c){for(var e,f=[],g=b;g<c;g+=3)e=(a[g]<<16&0xff0000)+(a[g+1]<<8&65280)+(255&a[g+2]),f.push(d[e>>18&63]+d[e>>12&63]+d[e>>6&63]+d[63&e]);return f.join("")}(a,g,g+16383>h?h:g+16383));return 1===e?f.push(d[(b=a[c-1])>>2]+d[b<<4&63]+"=="):2===e&&f.push(d[(b=(a[c-2]<<8)+a[c-1])>>10]+d[b>>4&63]+d[b<<2&63]+"="),f.join("")};for(var d=[],e=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,i=g.length;h<i;++h)d[h]=g[h],e[g.charCodeAt(h)]=h;function j(a){var b=a.length;if(b%4>0)throw Error("Invalid string. Length must be a multiple of 4");var c=a.indexOf("=");-1===c&&(c=b);var d=c===b?0:4-c%4;return[c,d]}e[45]=62,e[95]=63},140384,(a,b,c)=>{"use strict";var d=Object.prototype.hasOwnProperty,e=Object.prototype.toString,f=Object.defineProperty,g=Object.getOwnPropertyDescriptor,h=function(a){return"function"==typeof Array.isArray?Array.isArray(a):"[object Array]"===e.call(a)},i=function(a){if(!a||"[object Object]"!==e.call(a))return!1;var b,c=d.call(a,"constructor"),f=a.constructor&&a.constructor.prototype&&d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!c&&!f)return!1;for(b in a);return void 0===b||d.call(a,b)},j=function(a,b){f&&"__proto__"===b.name?f(a,b.name,{enumerable:!0,configurable:!0,value:b.newValue,writable:!0}):a[b.name]=b.newValue},k=function(a,b){if("__proto__"===b){if(!d.call(a,b))return;else if(g)return g(a,b).value}return a[b]};b.exports=function a(){var b,c,d,e,f,g,l=arguments[0],m=1,n=arguments.length,o=!1;for("boolean"==typeof l&&(o=l,l=arguments[1]||{},m=2),(null==l||"object"!=typeof l&&"function"!=typeof l)&&(l={});m<n;++m)if(b=arguments[m],null!=b)for(c in b)d=k(l,c),l!==(e=k(b,c))&&(o&&e&&(i(e)||(f=h(e)))?(f?(f=!1,g=d&&h(d)?d:[]):g=d&&i(d)?d:{},j(l,{name:c,newValue:a(o,g,e)})):void 0!==e&&j(l,{name:c,newValue:e}));return l}},946411,(a,b,c)=>{"use strict";b.exports={pkg:a.r(564621)}},123555,(a,b,c)=>{"use strict";var d=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0}),c.GaxiosError=c.GAXIOS_ERROR_SYMBOL=void 0,c.defaultErrorRedactor=function a(b){let c="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function d(a){a&&a.forEach((b,d)=>{(/^authentication$/i.test(d)||/^authorization$/i.test(d)||/secret/i.test(d))&&a.set(d,c)})}function e(a,b){if("object"==typeof a&&null!==a&&"string"==typeof a[b]){let d=a[b];(/grant_type=/i.test(d)||/assertion=/i.test(d)||/secret/i.test(d))&&(a[b]=c)}}function f(a){!a||"object"!=typeof a||(a instanceof FormData||a instanceof URLSearchParams||"forEach"in a&&"set"in a?a.forEach((b,d)=>{(["grant_type","assertion"].includes(d)||/secret/.test(d))&&a.set(d,c)}):("grant_type"in a&&(a.grant_type=c),"assertion"in a&&(a.assertion=c),"client_secret"in a&&(a.client_secret=c)))}return b.config&&(d(b.config.headers),e(b.config,"data"),f(b.config.data),e(b.config,"body"),f(b.config.body),b.config.url.searchParams.has("token")&&b.config.url.searchParams.set("token",c),b.config.url.searchParams.has("client_secret")&&b.config.url.searchParams.set("client_secret",c)),b.response&&(a({config:b.response.config}),d(b.response.headers),b.response.bodyUsed&&(e(b.response,"data"),f(b.response.data))),b};let e=d(a.r(140384)),f=d(a.r(946411)).default.pkg;c.GAXIOS_ERROR_SYMBOL=Symbol.for(`${f.name}-gaxios-error`);class g extends Error{config;response;code;status;error;[c.GAXIOS_ERROR_SYMBOL]=f.version;static[Symbol.hasInstance](a){return!!a&&"object"==typeof a&&c.GAXIOS_ERROR_SYMBOL in a&&a[c.GAXIOS_ERROR_SYMBOL]===f.version||Function.prototype[Symbol.hasInstance].call(g,a)}constructor(a,b,c,d){if(super(a,{cause:d}),this.config=b,this.response=c,this.error=d instanceof Error?d:void 0,this.config=(0,e.default)(!0,{},b),this.response&&(this.response.config=(0,e.default)(!0,{},this.response.config)),this.response){try{this.response.data=function(a,b){switch(a){case"stream":default:return b;case"json":return JSON.parse(JSON.stringify(b));case"arraybuffer":return JSON.parse(Buffer.from(b).toString("utf8"));case"blob":return JSON.parse(b.text())}}(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}d instanceof DOMException?this.code=d.name:d&&"object"==typeof d&&"code"in d&&("string"==typeof d.code||"number"==typeof d.code)&&(this.code=d.code)}static extractAPIErrorFromResponse(a,b="The request failed"){let c=b;if("string"==typeof a.data&&(c=a.data),a.data&&"object"==typeof a.data&&"error"in a.data&&a.data.error&&!a.ok){if("string"==typeof a.data.error)return{message:a.data.error,code:a.status,status:a.statusText};if("object"==typeof a.data.error){c="message"in a.data.error&&"string"==typeof a.data.error.message?a.data.error.message:c;let b="status"in a.data.error&&"string"==typeof a.data.error.status?a.data.error.status:a.statusText,d="code"in a.data.error&&"number"==typeof a.data.error.code?a.data.error.code:a.status;if("errors"in a.data.error&&Array.isArray(a.data.error.errors)){let e=[];for(let b of a.data.error.errors)"object"==typeof b&&"message"in b&&"string"==typeof b.message&&e.push(b.message);return Object.assign({message:e.join("\n")||c,code:d,status:b},a.data.error)}return Object.assign({message:c,code:d,status:b},a.data.error)}}return{message:c,code:a.status,status:a.statusText}}}c.GaxiosError=g},165802,(a,b,c)=>{"use strict";async function d(a){var b;let c=f(a);if(!a||!a.config||!c&&!a.config.retry)return{shouldRetry:!1};(c=c||{}).currentRetryAttempt=c.currentRetryAttempt||0,c.retry=void 0===c.retry||null===c.retry?3:c.retry,c.httpMethodsToRetry=c.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],c.noResponseRetries=void 0===c.noResponseRetries||null===c.noResponseRetries?2:c.noResponseRetries,c.retryDelayMultiplier=c.retryDelayMultiplier?c.retryDelayMultiplier:2,c.timeOfFirstRequest=c.timeOfFirstRequest?c.timeOfFirstRequest:Date.now(),c.totalTimeout=c.totalTimeout?c.totalTimeout:Number.MAX_SAFE_INTEGER,c.maxRetryDelay=c.maxRetryDelay?c.maxRetryDelay:Number.MAX_SAFE_INTEGER,c.statusCodesToRetry=c.statusCodesToRetry||[[100,199],[408,408],[429,429],[500,599]],a.config.retryConfig=c;let d=c.shouldRetry||e;if(!await d(a))return{shouldRetry:!1,config:a.config};let g=Math.min(((b=c).currentRetryAttempt?0:b.retryDelay??100)+(Math.pow(b.retryDelayMultiplier,b.currentRetryAttempt)-1)/2*1e3,b.totalTimeout-(Date.now()-b.timeOfFirstRequest),b.maxRetryDelay);a.config.retryConfig.currentRetryAttempt+=1;let h=c.retryBackoff?c.retryBackoff(a,g):new Promise(a=>{setTimeout(a,g)});return c.onRetryAttempt&&await c.onRetryAttempt(a),await h,{shouldRetry:!0,config:a.config}}function e(a){let b=f(a);if(a.config.signal?.aborted&&"TimeoutError"!==a.code||"AbortError"===a.code||!b||0===b.retry||!a.response&&(b.currentRetryAttempt||0)>=b.noResponseRetries||!b.httpMethodsToRetry||!b.httpMethodsToRetry.includes(a.config.method?.toUpperCase()||"GET"))return!1;if(a.response&&a.response.status){let c=!1;for(let[d,e]of b.statusCodesToRetry){let b=a.response.status;if(b>=d&&b<=e){c=!0;break}}if(!c)return!1}return b.currentRetryAttempt=b.currentRetryAttempt||0,!(b.currentRetryAttempt>=b.retry)}function f(a){if(a&&a.config&&a.config.retryConfig)return a.config.retryConfig}Object.defineProperty(c,"__esModule",{value:!0}),c.getRetryConfig=d},475294,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.GaxiosInterceptorManager=void 0;class d extends Set{}c.GaxiosInterceptorManager=d},304158,(a,b,c)=>{"use strict";var d,e=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0}),c.Gaxios=void 0;let f=e(a.r(140384)),g=a.r(524836),h=a.r(123555),i=a.r(165802),j=a.r(688947),k=a.r(475294),l=async()=>globalThis.crypto?.randomUUID()||(await a.A(485685)).randomUUID();class m{agentCache=new Map;defaults;interceptors;constructor(a){this.defaults=a||{},this.interceptors={request:new k.GaxiosInterceptorManager,response:new k.GaxiosInterceptorManager}}fetch(...a){let b,c=a[0],e=a[1],f=new Headers;return("string"==typeof c?b=new URL(c):c instanceof URL?b=c:c&&c.url&&(b=new URL(c.url)),c&&"object"==typeof c&&"headers"in c&&d.mergeHeaders(f,c.headers),e&&d.mergeHeaders(f,new Headers(e.headers)),"object"!=typeof c||c instanceof URL)?this.request({...e,headers:f,url:b}):this.request({...e,...c,headers:f,url:b})}async request(a={}){let b=await this.#a(a);return b=await this.#b(b),this.#c(this._request(b))}async _defaultAdapter(a){let b=a.fetchImplementation||this.defaults.fetchImplementation||await d.#d(),c={...a};delete c.data;let e=await b(a.url,c),f=await this.getResponseData(a,e);return Object.getOwnPropertyDescriptor(e,"data")?.configurable||Object.defineProperties(e,{data:{configurable:!0,writable:!0,enumerable:!0,value:f}}),Object.assign(e,{config:a,data:f})}async _request(a){try{let b;if(b=a.adapter?await a.adapter(a,this._defaultAdapter.bind(this)):await this._defaultAdapter(a),!a.validateStatus(b.status)){if("stream"===a.responseType){let a=[];for await(let c of b.data)a.push(c);b.data=a.toString()}let c=h.GaxiosError.extractAPIErrorFromResponse(b,`Request failed with status code ${b.status}`);throw new h.GaxiosError(c?.message,a,b,c)}return b}catch(e){let b;b=e instanceof h.GaxiosError?e:e instanceof Error?new h.GaxiosError(e.message,a,void 0,e):new h.GaxiosError("Unexpected Gaxios Error",a,void 0,e);let{shouldRetry:c,config:d}=await (0,i.getRetryConfig)(b);if(c&&d)return b.config.retryConfig.currentRetryAttempt=d.retryConfig.currentRetryAttempt,a.retryConfig=b.config?.retryConfig,this.#e(a),this._request(a);throw a.errorRedactor&&a.errorRedactor(b),b}}async getResponseData(a,b){if(204===b.status)return"";if(a.maxContentLength&&b.headers.has("content-length")&&a.maxContentLength<Number.parseInt(b.headers?.get("content-length")||""))throw new h.GaxiosError("Response's `Content-Length` is over the limit.",a,Object.assign(b,{config:a}));switch(a.responseType){case"stream":return b.body;case"json":{let a=await b.text();try{return JSON.parse(a)}catch{return a}}case"arraybuffer":return b.arrayBuffer();case"blob":return b.blob();case"text":return b.text();default:return this.getResponseDataFromContentType(b)}}#f(a,b=[]){let c=new URL(a),d=[...b];for(let a of(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[])d.push(a.trim());for(let a of d)if(a instanceof RegExp){if(a.test(c.toString()))return!1}else if(a instanceof URL){if(a.origin===c.origin)return!1}else if(a.startsWith("*.")||a.startsWith(".")){let b=a.replace(/^\*\./,".");if(c.hostname.endsWith(b))return!1}else if(a===c.origin||a===c.hostname||a===c.href)return!1;return!0}async #b(a){let b=Promise.resolve(a);for(let a of this.interceptors.request.values())a&&(b=b.then(a.resolved,a.rejected));return b}async #c(a){let b=Promise.resolve(a);for(let a of this.interceptors.response.values())a&&(b=b.then(a.resolved,a.rejected));return b}async #a(a){let b=new Headers(this.defaults.headers);d.mergeHeaders(b,a.headers);let c=(0,f.default)(!0,{},this.defaults,a);if(!c.url)throw Error("URL is required.");if(c.baseURL&&(c.url=new URL(c.url,c.baseURL)),c.url=new URL(c.url),c.params)if(c.paramsSerializer){let a=c.paramsSerializer(c.params);a.startsWith("?")&&(a=a.slice(1));let b=c.url.toString().includes("?")?"&":"?";c.url=c.url+b+a}else{let a=c.url instanceof URL?c.url:new URL(c.url);for(let[b,d]of new URLSearchParams(c.params))a.searchParams.append(b,d);c.url=a}"number"==typeof a.maxContentLength&&(c.size=a.maxContentLength),"number"==typeof a.maxRedirects&&(c.follow=a.maxRedirects);let e="string"==typeof c.data||c.data instanceof ArrayBuffer||c.data instanceof Blob||globalThis.File&&c.data instanceof File||c.data instanceof FormData||c.data instanceof j.Readable||c.data instanceof ReadableStream||c.data instanceof String||c.data instanceof URLSearchParams||ArrayBuffer.isView(c.data)||["Blob","File","FormData"].includes(c.data?.constructor?.name||"");if(c.multipart?.length){let a=await l();b.set("content-type",`multipart/related; boundary=${a}`),c.body=j.Readable.from(this.getMultipartRequest(c.multipart,a))}else e?c.body=c.data:"object"==typeof c.data?"application/x-www-form-urlencoded"===b.get("Content-Type")?c.body=c.paramsSerializer?c.paramsSerializer(c.data):new URLSearchParams(c.data):(b.has("content-type")||b.set("content-type","application/json"),c.body=JSON.stringify(c.data)):c.data&&(c.body=c.data);c.validateStatus=c.validateStatus||this.validateStatus,c.responseType=c.responseType||"unknown",b.has("accept")||"json"!==c.responseType||b.set("accept","application/json");let i=c.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(c.agent);else if(i&&this.#f(c.url,c.noProxy)){let a=await d.#g();this.agentCache.has(i)?c.agent=this.agentCache.get(i):(c.agent=new a(i,{cert:c.cert,key:c.key}),this.agentCache.set(i,c.agent))}else c.cert&&c.key&&(this.agentCache.has(c.key)?c.agent=this.agentCache.get(c.key):(c.agent=new g.Agent({cert:c.cert,key:c.key}),this.agentCache.set(c.key,c.agent)));return"function"!=typeof c.errorRedactor&&!1!==c.errorRedactor&&(c.errorRedactor=h.defaultErrorRedactor),!c.body||"duplex"in c||(c.duplex="half"),this.#e(c),Object.assign(c,{headers:b,url:c.url instanceof URL?c.url:new URL(c.url)})}#e(a){if(a.timeout){let b=AbortSignal.timeout(a.timeout);a.signal&&!a.signal.aborted?a.signal=AbortSignal.any([a.signal,b]):a.signal=b}}validateStatus(a){return a>=200&&a<300}async getResponseDataFromContentType(a){let b=a.headers.get("Content-Type");if(null===b)return a.text();if((b=b.toLowerCase()).includes("application/json")){let b=await a.text();try{b=JSON.parse(b)}catch{}return b}return b.match(/^text\//)?a.text():a.blob()}async *getMultipartRequest(a,b){let c=`--${b}--`;for(let c of a){let a=c.headers.get("Content-Type")||"application/octet-stream",d=`--${b}\r
Content-Type: ${a}\r
\r
`;yield d,"string"==typeof c.content?yield c.content:yield*c.content,yield"\r\n"}yield c}static #h;static #i;static async #g(){return this.#h||=(await a.A(384577)).HttpsProxyAgent,this.#h}static async #d(){return this.#i||=(await a.A(241638)).default,this.#i}static mergeHeaders(a,...b){for(let c of(a=a instanceof Headers?a:new Headers(a),b))(c instanceof Headers?c:new Headers(c)).forEach((b,c)=>{"set-cookie"===c?a.append(c,b):a.set(c,b)});return a}}c.Gaxios=m,d=m},96857,(a,b,c)=>{"use strict";var d=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),e=a.e&&a.e.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||d(b,a,c)};Object.defineProperty(c,"__esModule",{value:!0}),c.instance=c.Gaxios=c.GaxiosError=void 0,c.request=h;let f=a.r(304158);Object.defineProperty(c,"Gaxios",{enumerable:!0,get:function(){return f.Gaxios}});var g=a.r(123555);async function h(a){return c.instance.request(a)}Object.defineProperty(c,"GaxiosError",{enumerable:!0,get:function(){return g.GaxiosError}}),e(a.r(475294),c),c.instance=new f.Gaxios},466666,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.GCE_LINUX_BIOS_PATHS=void 0,c.isGoogleCloudServerless=f,c.isGoogleComputeEngineLinux=g,c.isGoogleComputeEngineMACAddress=h,c.isGoogleComputeEngine=i,c.detectGCPResidency=function(){return f()||i()},a.r(522734);let d=a.r(446786);c.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};let e=/^42:01/;function f(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function g(){if("linux"!==(0,d.platform)())return!1}function h(){for(let a of Object.values((0,d.networkInterfaces)()))if(a){for(let{mac:b}of a)if(e.test(b))return!0}return!1}function i(){return g()||h()}},174988,(a,b,c)=>{!function(c){"use strict";var d,e=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,f=Math.ceil,g=Math.floor,h="[BigNumber Error] ",i=h+"Number primitive has more than 15 significant digits: ",j=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13];function k(a){var b=0|a;return a>0||a===b?b:b-1}function l(a){for(var b,c,d=1,e=a.length,f=a[0]+"";d<e;){for(c=14-(b=a[d++]+"").length;c--;b="0"+b);f+=b}for(e=f.length;48===f.charCodeAt(--e););return f.slice(0,e+1||1)}function m(a,b){var c,d,e=a.c,f=b.c,g=a.s,h=b.s,i=a.e,j=b.e;if(!g||!h)return null;if(c=e&&!e[0],d=f&&!f[0],c||d)return c?d?0:-h:g;if(g!=h)return g;if(c=g<0,d=i==j,!e||!f)return d?0:!e^c?1:-1;if(!d)return i>j^c?1:-1;for(g=0,h=(i=e.length)<(j=f.length)?i:j;g<h;g++)if(e[g]!=f[g])return e[g]>f[g]^c?1:-1;return i==j?0:i>j^c?1:-1}function n(a,b,c,d){if(a<b||a>c||a!==g(a))throw Error(h+(d||"Argument")+("number"==typeof a?a<b||a>c?" out of range: ":" not an integer: ":" not a primitive number: ")+String(a))}function o(a){var b=a.c.length-1;return k(a.e/14)==b&&a.c[b]%2!=0}function p(a,b){return(a.length>1?a.charAt(0)+"."+a.slice(1):a)+(b<0?"e":"e+")+b}function q(a,b,c){var d,e;if(b<0){for(e=c+".";++b;e+=c);a=e+a}else if(d=a.length,++b>d){for(e=c,b-=d;--b;e+=c);a+=e}else b<d&&(a=a.slice(0,b)+"."+a.slice(b));return a}if((d=function a(b){var c,d,r,s,t,u,v,w,x,y=M.prototype={constructor:M,toString:null,valueOf:null},z=new M(1),A=20,B=4,C=-7,D=21,E=-1e7,F=1e7,G=!1,H=1,I=0,J={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},K="0123456789abcdefghijklmnopqrstuvwxyz",L=!0;function M(a,b){var c,d,f,h,j,k,l,m,o=this;if(!(o instanceof M))return new M(a,b);if(null==b){if(a&&!0===a._isBigNumber){o.s=a.s,!a.c||a.e>F?o.c=o.e=null:a.e<E?o.c=[o.e=0]:(o.e=a.e,o.c=a.c.slice());return}if((k="number"==typeof a)&&0*a==0){if(o.s=1/a<0?(a=-a,-1):1,a===~~a){for(h=0,j=a;j>=10;j/=10,h++);h>F?o.c=o.e=null:(o.e=h,o.c=[a]);return}m=String(a)}else{if(!e.test(m=String(a)))return x(o,m,k);o.s=45==m.charCodeAt(0)?(m=m.slice(1),-1):1}(h=m.indexOf("."))>-1&&(m=m.replace(".","")),(j=m.search(/e/i))>0?(h<0&&(h=j),h+=+m.slice(j+1),m=m.substring(0,j)):h<0&&(h=m.length)}else{if(n(b,2,K.length,"Base"),10==b&&L)return Q(o=new M(a),A+o.e+1,B);if(m=String(a),k="number"==typeof a){if(0*a!=0)return x(o,m,k,b);if(o.s=1/a<0?(m=m.slice(1),-1):1,M.DEBUG&&m.replace(/^0\.0*|\./,"").length>15)throw Error(i+a)}else o.s=45===m.charCodeAt(0)?(m=m.slice(1),-1):1;for(c=K.slice(0,b),h=j=0,l=m.length;j<l;j++)if(0>c.indexOf(d=m.charAt(j))){if("."==d){if(j>h){h=l;continue}}else if(!f&&(m==m.toUpperCase()&&(m=m.toLowerCase())||m==m.toLowerCase()&&(m=m.toUpperCase()))){f=!0,j=-1,h=0;continue}return x(o,String(a),k,b)}k=!1,(h=(m=w(m,b,10,o.s)).indexOf("."))>-1?m=m.replace(".",""):h=m.length}for(j=0;48===m.charCodeAt(j);j++);for(l=m.length;48===m.charCodeAt(--l););if(m=m.slice(j,++l)){if(l-=j,k&&M.DEBUG&&l>15&&(a>0x1fffffffffffff||a!==g(a)))throw Error(i+o.s*a);if((h=h-j-1)>F)o.c=o.e=null;else if(h<E)o.c=[o.e=0];else{if(o.e=h,o.c=[],j=(h+1)%14,h<0&&(j+=14),j<l){for(j&&o.c.push(+m.slice(0,j)),l-=14;j<l;)o.c.push(+m.slice(j,j+=14));j=14-(m=m.slice(j)).length}else j-=l;for(;j--;m+="0");o.c.push(+m)}}else o.c=[o.e=0]}function N(a,b,c,d){var e,f,g,h,i;if(null==c?c=B:n(c,0,8),!a.c)return a.toString();if(e=a.c[0],g=a.e,null==b)i=l(a.c),i=1==d||2==d&&(g<=C||g>=D)?p(i,g):q(i,g,"0");else if(f=(a=Q(new M(a),b,c)).e,h=(i=l(a.c)).length,1==d||2==d&&(b<=f||f<=C)){for(;h<b;i+="0",h++);i=p(i,f)}else if(b-=g+(2===d&&f>g),i=q(i,f,"0"),f+1>h){if(--b>0)for(i+=".";b--;i+="0");}else if((b+=f-h)>0)for(f+1==h&&(i+=".");b--;i+="0");return a.s<0&&e?"-"+i:i}function O(a,b){for(var c,d,e=1,f=new M(a[0]);e<a.length;e++)(d=new M(a[e])).s&&(c=m(f,d))!==b&&(0!==c||f.s!==b)||(f=d);return f}function P(a,b,c){for(var d=1,e=b.length;!b[--e];b.pop());for(e=b[0];e>=10;e/=10,d++);return(c=d+14*c-1)>F?a.c=a.e=null:c<E?a.c=[a.e=0]:(a.e=c,a.c=b),a}function Q(a,b,c,d){var e,h,i,k,l,m,n,o=a.c;if(o){b:{for(e=1,k=o[0];k>=10;k/=10,e++);if((h=b-e)<0)h+=14,i=b,n=g((l=o[m=0])/j[e-i-1]%10);else if((m=f((h+1)/14))>=o.length)if(d){for(;o.length<=m;o.push(0));l=n=0,e=1,h%=14,i=h-14+1}else break b;else{for(e=1,l=k=o[m];k>=10;k/=10,e++);h%=14,n=(i=h-14+e)<0?0:g(l/j[e-i-1]%10)}if(d=d||b<0||null!=o[m+1]||(i<0?l:l%j[e-i-1]),d=c<4?(n||d)&&(0==c||c==(a.s<0?3:2)):n>5||5==n&&(4==c||d||6==c&&(h>0?i>0?l/j[e-i]:0:o[m-1])%10&1||c==(a.s<0?8:7)),b<1||!o[0])return o.length=0,d?(b-=a.e+1,o[0]=j[(14-b%14)%14],a.e=-b||0):o[0]=a.e=0,a;if(0==h?(o.length=m,k=1,m--):(o.length=m+1,k=j[14-h],o[m]=i>0?g(l/j[e-i]%j[i])*k:0),d)for(;;)if(0==m){for(h=1,i=o[0];i>=10;i/=10,h++);for(i=o[0]+=k,k=1;i>=10;i/=10,k++);h!=k&&(a.e++,1e14==o[0]&&(o[0]=1));break}else{if(o[m]+=k,1e14!=o[m])break;o[m--]=0,k=1}for(h=o.length;0===o[--h];o.pop());}a.e>F?a.c=a.e=null:a.e<E&&(a.c=[a.e=0])}return a}function R(a){var b,c=a.e;return null===c?a.toString():(b=l(a.c),b=c<=C||c>=D?p(b,c):q(b,c,"0"),a.s<0?"-"+b:b)}return M.clone=a,M.ROUND_UP=0,M.ROUND_DOWN=1,M.ROUND_CEIL=2,M.ROUND_FLOOR=3,M.ROUND_HALF_UP=4,M.ROUND_HALF_DOWN=5,M.ROUND_HALF_EVEN=6,M.ROUND_HALF_CEIL=7,M.ROUND_HALF_FLOOR=8,M.EUCLID=9,M.config=M.set=function(a){var b,c;if(null!=a)if("object"==typeof a){if(a.hasOwnProperty(b="DECIMAL_PLACES")&&(n(c=a[b],0,1e9,b),A=c),a.hasOwnProperty(b="ROUNDING_MODE")&&(n(c=a[b],0,8,b),B=c),a.hasOwnProperty(b="EXPONENTIAL_AT")&&((c=a[b])&&c.pop?(n(c[0],-1e9,0,b),n(c[1],0,1e9,b),C=c[0],D=c[1]):(n(c,-1e9,1e9,b),C=-(D=c<0?-c:c))),a.hasOwnProperty(b="RANGE"))if((c=a[b])&&c.pop)n(c[0],-1e9,-1,b),n(c[1],1,1e9,b),E=c[0],F=c[1];else if(n(c,-1e9,1e9,b),c)E=-(F=c<0?-c:c);else throw Error(h+b+" cannot be zero: "+c);if(a.hasOwnProperty(b="CRYPTO"))if(!!(c=a[b])===c)if(c)if("undefined"!=typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))G=c;else throw G=!c,Error(h+"crypto unavailable");else G=c;else throw Error(h+b+" not true or false: "+c);if(a.hasOwnProperty(b="MODULO_MODE")&&(n(c=a[b],0,9,b),H=c),a.hasOwnProperty(b="POW_PRECISION")&&(n(c=a[b],0,1e9,b),I=c),a.hasOwnProperty(b="FORMAT"))if("object"==typeof(c=a[b]))J=c;else throw Error(h+b+" not an object: "+c);if(a.hasOwnProperty(b="ALPHABET")){if("string"!=typeof(c=a[b])||/^.?$|[+\-.\s]|(.).*\1/.test(c))throw Error(h+b+" invalid: "+c);L="0123456789"==c.slice(0,10),K=c}}else throw Error(h+"Object expected: "+a);return{DECIMAL_PLACES:A,ROUNDING_MODE:B,EXPONENTIAL_AT:[C,D],RANGE:[E,F],CRYPTO:G,MODULO_MODE:H,POW_PRECISION:I,FORMAT:J,ALPHABET:K}},M.isBigNumber=function(a){if(!a||!0!==a._isBigNumber)return!1;if(!M.DEBUG)return!0;var b,c,d=a.c,e=a.e,f=a.s;b:if("[object Array]"==({}).toString.call(d)){if((1===f||-1===f)&&e>=-1e9&&e<=1e9&&e===g(e)){if(0===d[0]){if(0===e&&1===d.length)return!0;break b}if((b=(e+1)%14)<1&&(b+=14),String(d[0]).length==b){for(b=0;b<d.length;b++)if((c=d[b])<0||c>=1e14||c!==g(c))break b;if(0!==c)return!0}}}else if(null===d&&null===e&&(null===f||1===f||-1===f))return!0;throw Error(h+"Invalid BigNumber: "+a)},M.maximum=M.max=function(){return O(arguments,-1)},M.minimum=M.min=function(){return O(arguments,1)},c=0x20000000000000*Math.random()&2097151?function(){return g(0x20000000000000*Math.random())}:function(){return(0x40000000*Math.random()|0)*8388608+(8388608*Math.random()|0)},M.random=function(a){var b,d,e,i,k,l=0,m=[],o=new M(z);if(null==a?a=A:n(a,0,1e9),i=f(a/14),G)if(crypto.getRandomValues){for(b=crypto.getRandomValues(new Uint32Array(i*=2));l<i;)(k=131072*b[l]+(b[l+1]>>>11))>=9e15?(d=crypto.getRandomValues(new Uint32Array(2)),b[l]=d[0],b[l+1]=d[1]):(m.push(k%1e14),l+=2);l=i/2}else if(crypto.randomBytes){for(b=crypto.randomBytes(i*=7);l<i;)(k=(31&b[l])*0x1000000000000+0x10000000000*b[l+1]+0x100000000*b[l+2]+0x1000000*b[l+3]+(b[l+4]<<16)+(b[l+5]<<8)+b[l+6])>=9e15?crypto.randomBytes(7).copy(b,l):(m.push(k%1e14),l+=7);l=i/7}else throw G=!1,Error(h+"crypto unavailable");if(!G)for(;l<i;)(k=c())<9e15&&(m[l++]=k%1e14);for(i=m[--l],a%=14,i&&a&&(k=j[14-a],m[l]=g(i/k)*k);0===m[l];m.pop(),l--);if(l<0)m=[e=0];else{for(e=-1;0===m[0];m.splice(0,1),e-=14);for(l=1,k=m[0];k>=10;k/=10,l++);l<14&&(e-=14-l)}return o.e=e,o.c=m,o},M.sum=function(){for(var a=1,b=arguments,c=new M(b[0]);a<b.length;)c=c.plus(b[a++]);return c},w=function(){var a="0123456789";function b(a,b,c,d){for(var e,f,g=[0],h=0,i=a.length;h<i;){for(f=g.length;f--;g[f]*=b);for(g[0]+=d.indexOf(a.charAt(h++)),e=0;e<g.length;e++)g[e]>c-1&&(null==g[e+1]&&(g[e+1]=0),g[e+1]+=g[e]/c|0,g[e]%=c)}return g.reverse()}return function(c,d,e,f,g){var h,i,j,k,m,n,o,p,r=c.indexOf("."),s=A,t=B;for(r>=0&&(k=I,I=0,c=c.replace(".",""),n=(p=new M(d)).pow(c.length-r),I=k,p.c=b(q(l(n.c),n.e,"0"),10,e,a),p.e=p.c.length),j=k=(o=b(c,d,e,g?(h=K,a):(h=a,K))).length;0==o[--k];o.pop());if(!o[0])return h.charAt(0);if(r<0?--j:(n.c=o,n.e=j,n.s=f,o=(n=v(n,p,s,t,e)).c,m=n.r,j=n.e),r=o[i=j+s+1],k=e/2,m=m||i<0||null!=o[i+1],m=t<4?(null!=r||m)&&(0==t||t==(n.s<0?3:2)):r>k||r==k&&(4==t||m||6==t&&1&o[i-1]||t==(n.s<0?8:7)),i<1||!o[0])c=m?q(h.charAt(1),-s,h.charAt(0)):h.charAt(0);else{if(o.length=i,m)for(--e;++o[--i]>e;)o[i]=0,i||(++j,o=[1].concat(o));for(k=o.length;!o[--k];);for(r=0,c="";r<=k;c+=h.charAt(o[r++]));c=q(c,j,h.charAt(0))}return c}}(),v=function(){function a(a,b,c){var d,e,f,g,h=0,i=a.length,j=b%1e7,k=b/1e7|0;for(a=a.slice();i--;)d=k*(f=a[i]%1e7)+(g=a[i]/1e7|0)*j,h=((e=j*f+d%1e7*1e7+h)/c|0)+(d/1e7|0)+k*g,a[i]=e%c;return h&&(a=[h].concat(a)),a}function b(a,b,c,d){var e,f;if(c!=d)f=c>d?1:-1;else for(e=f=0;e<c;e++)if(a[e]!=b[e]){f=a[e]>b[e]?1:-1;break}return f}function c(a,b,c,d){for(var e=0;c--;)a[c]-=e,e=+(a[c]<b[c]),a[c]=e*d+a[c]-b[c];for(;!a[0]&&a.length>1;a.splice(0,1));}return function(d,e,f,h,i){var j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=d.s==e.s?1:-1,C=d.c,D=e.c;if(!C||!C[0]||!D||!D[0])return new M(!d.s||!e.s||(C?D&&C[0]==D[0]:!D)?NaN:C&&0==C[0]||!D?0*B:B/0);for(s=(r=new M(B)).c=[],B=f+(l=d.e-e.e)+1,i||(i=1e14,l=k(d.e/14)-k(e.e/14),B=B/14|0),m=0;D[m]==(C[m]||0);m++);if(D[m]>(C[m]||0)&&l--,B<0)s.push(1),n=!0;else{for(x=C.length,z=D.length,m=0,B+=2,(o=g(i/(D[0]+1)))>1&&(D=a(D,o,i),C=a(C,o,i),z=D.length,x=C.length),w=z,u=(t=C.slice(0,z)).length;u<z;t[u++]=0);A=[0].concat(A=D.slice()),y=D[0],D[1]>=i/2&&y++;do{if(o=0,(j=b(D,t,z,u))<0){if(v=t[0],z!=u&&(v=v*i+(t[1]||0)),(o=g(v/y))>1)for(o>=i&&(o=i-1),q=(p=a(D,o,i)).length,u=t.length;1==b(p,t,q,u);)o--,c(p,z<q?A:D,q,i),q=p.length,j=1;else 0==o&&(j=o=1),q=(p=D.slice()).length;if(q<u&&(p=[0].concat(p)),c(t,p,u,i),u=t.length,-1==j)for(;1>b(D,t,z,u);)o++,c(t,z<u?A:D,u,i),u=t.length}else 0===j&&(o++,t=[0]);s[m++]=o,t[0]?t[u++]=C[w]||0:(t=[C[w]],u=1)}while((w++<x||null!=t[0])&&B--)n=null!=t[0],s[0]||s.splice(0,1)}if(1e14==i){for(m=1,B=s[0];B>=10;B/=10,m++);Q(r,f+(r.e=m+14*l-1)+1,h,n)}else r.e=l,r.r=+n;return r}}(),d=/^(-?)0([xbo])(?=\w[\w.]*$)/i,r=/^([^.]+)\.$/,s=/^\.([^.]+)$/,t=/^-?(Infinity|NaN)$/,u=/^\s*\+(?=[\w.])|^\s+|\s+$/g,x=function(a,b,c,e){var f,g=c?b:b.replace(u,"");if(t.test(g))a.s=isNaN(g)?null:g<0?-1:1;else{if(!c&&(g=g.replace(d,function(a,b,c){return f="x"==(c=c.toLowerCase())?16:"b"==c?2:8,e&&e!=f?a:b}),e&&(f=e,g=g.replace(r,"$1").replace(s,"0.$1")),b!=g))return new M(g,f);if(M.DEBUG)throw Error(h+"Not a"+(e?" base "+e:"")+" number: "+b);a.s=null}a.c=a.e=null},y.absoluteValue=y.abs=function(){var a=new M(this);return a.s<0&&(a.s=1),a},y.comparedTo=function(a,b){return m(this,new M(a,b))},y.decimalPlaces=y.dp=function(a,b){var c,d,e;if(null!=a)return n(a,0,1e9),null==b?b=B:n(b,0,8),Q(new M(this),a+this.e+1,b);if(!(c=this.c))return null;if(d=((e=c.length-1)-k(this.e/14))*14,e=c[e])for(;e%10==0;e/=10,d--);return d<0&&(d=0),d},y.dividedBy=y.div=function(a,b){return v(this,new M(a,b),A,B)},y.dividedToIntegerBy=y.idiv=function(a,b){return v(this,new M(a,b),0,1)},y.exponentiatedBy=y.pow=function(a,b){var c,d,e,i,j,k,l,m,n,p=this;if((a=new M(a)).c&&!a.isInteger())throw Error(h+"Exponent not an integer: "+R(a));if(null!=b&&(b=new M(b)),k=a.e>14,!p.c||!p.c[0]||1==p.c[0]&&!p.e&&1==p.c.length||!a.c||!a.c[0])return n=new M(Math.pow(+R(p),k?a.s*(2-o(a)):+R(a))),b?n.mod(b):n;if(l=a.s<0,b){if(b.c?!b.c[0]:!b.s)return new M(NaN);(d=!l&&p.isInteger()&&b.isInteger())&&(p=p.mod(b))}else{if(a.e>9&&(p.e>0||p.e<-1||(0==p.e?p.c[0]>1||k&&p.c[1]>=24e7:p.c[0]<8e13||k&&p.c[0]<=9999975e7)))return i=p.s<0&&o(a)?-0:0,p.e>-1&&(i=1/i),new M(l?1/i:i);I&&(i=f(I/14+2))}for(k?(c=new M(.5),l&&(a.s=1),m=o(a)):m=(e=Math.abs(+R(a)))%2,n=new M(z);;){if(m){if(!(n=n.times(p)).c)break;i?n.c.length>i&&(n.c.length=i):d&&(n=n.mod(b))}if(e){if(0===(e=g(e/2)))break;m=e%2}else if(Q(a=a.times(c),a.e+1,1),a.e>14)m=o(a);else{if(0==(e=+R(a)))break;m=e%2}p=p.times(p),i?p.c&&p.c.length>i&&(p.c.length=i):d&&(p=p.mod(b))}return d?n:(l&&(n=z.div(n)),b?n.mod(b):i?Q(n,I,B,j):n)},y.integerValue=function(a){var b=new M(this);return null==a?a=B:n(a,0,8),Q(b,b.e+1,a)},y.isEqualTo=y.eq=function(a,b){return 0===m(this,new M(a,b))},y.isFinite=function(){return!!this.c},y.isGreaterThan=y.gt=function(a,b){return m(this,new M(a,b))>0},y.isGreaterThanOrEqualTo=y.gte=function(a,b){return 1===(b=m(this,new M(a,b)))||0===b},y.isInteger=function(){return!!this.c&&k(this.e/14)>this.c.length-2},y.isLessThan=y.lt=function(a,b){return 0>m(this,new M(a,b))},y.isLessThanOrEqualTo=y.lte=function(a,b){return -1===(b=m(this,new M(a,b)))||0===b},y.isNaN=function(){return!this.s},y.isNegative=function(){return this.s<0},y.isPositive=function(){return this.s>0},y.isZero=function(){return!!this.c&&0==this.c[0]},y.minus=function(a,b){var c,d,e,f,g=this.s;if(b=(a=new M(a,b)).s,!g||!b)return new M(NaN);if(g!=b)return a.s=-b,this.plus(a);var h=this.e/14,i=a.e/14,j=this.c,l=a.c;if(!h||!i){if(!j||!l)return j?(a.s=-b,a):new M(l?this:NaN);if(!j[0]||!l[0])return l[0]?(a.s=-b,a):new M(j[0]?this:3==B?-0:0)}if(h=k(h),i=k(i),j=j.slice(),g=h-i){for((f=g<0)?(g=-g,e=j):(i=h,e=l),e.reverse(),b=g;b--;e.push(0));e.reverse()}else for(d=(f=(g=j.length)<(b=l.length))?g:b,g=b=0;b<d;b++)if(j[b]!=l[b]){f=j[b]<l[b];break}if(f&&(e=j,j=l,l=e,a.s=-a.s),(b=(d=l.length)-(c=j.length))>0)for(;b--;j[c++]=0);for(b=1e14-1;d>g;){if(j[--d]<l[d]){for(c=d;c&&!j[--c];j[c]=b);--j[c],j[d]+=1e14}j[d]-=l[d]}for(;0==j[0];j.splice(0,1),--i);return j[0]?P(a,j,i):(a.s=3==B?-1:1,a.c=[a.e=0],a)},y.modulo=y.mod=function(a,b){var c,d;return(a=new M(a,b),this.c&&a.s&&(!a.c||a.c[0]))?a.c&&(!this.c||this.c[0])?(9==H?(d=a.s,a.s=1,c=v(this,a,0,3),a.s=d,c.s*=d):c=v(this,a,0,H),(a=this.minus(c.times(a))).c[0]||1!=H||(a.s=this.s),a):new M(this):new M(NaN)},y.multipliedBy=y.times=function(a,b){var c,d,e,f,g,h,i,j,l,m,n,o,p,q=this.c,r=(a=new M(a,b)).c;if(!q||!r||!q[0]||!r[0])return this.s&&a.s&&(!q||q[0]||r)&&(!r||r[0]||q)?(a.s*=this.s,q&&r?(a.c=[0],a.e=0):a.c=a.e=null):a.c=a.e=a.s=null,a;for(d=k(this.e/14)+k(a.e/14),a.s*=this.s,(i=q.length)<(m=r.length)&&(p=q,q=r,r=p,e=i,i=m,m=e),e=i+m,p=[];e--;p.push(0));for(e=m;--e>=0;){for(c=0,n=r[e]%1e7,o=r[e]/1e7|0,f=e+(g=i);f>e;)h=o*(j=q[--g]%1e7)+(l=q[g]/1e7|0)*n,c=((j=n*j+h%1e7*1e7+p[f]+c)/1e14|0)+(h/1e7|0)+o*l,p[f--]=j%1e14;p[f]=c}return c?++d:p.splice(0,1),P(a,p,d)},y.negated=function(){var a=new M(this);return a.s=-a.s||null,a},y.plus=function(a,b){var c,d=this.s;if(b=(a=new M(a,b)).s,!d||!b)return new M(NaN);if(d!=b)return a.s=-b,this.minus(a);var e=this.e/14,f=a.e/14,g=this.c,h=a.c;if(!e||!f){if(!g||!h)return new M(d/0);if(!g[0]||!h[0])return h[0]?a:new M(g[0]?this:0*d)}if(e=k(e),f=k(f),g=g.slice(),d=e-f){for(d>0?(f=e,c=h):(d=-d,c=g),c.reverse();d--;c.push(0));c.reverse()}for((d=g.length)-(b=h.length)<0&&(c=h,h=g,g=c,b=d),d=0;b;)d=(g[--b]=g[b]+h[b]+d)/1e14|0,g[b]=1e14===g[b]?0:g[b]%1e14;return d&&(g=[d].concat(g),++f),P(a,g,f)},y.precision=y.sd=function(a,b){var c,d,e;if(null!=a&&!!a!==a)return n(a,1,1e9),null==b?b=B:n(b,0,8),Q(new M(this),a,b);if(!(c=this.c))return null;if(d=14*(e=c.length-1)+1,e=c[e]){for(;e%10==0;e/=10,d--);for(e=c[0];e>=10;e/=10,d++);}return a&&this.e+1>d&&(d=this.e+1),d},y.shiftedBy=function(a){return n(a,-0x1fffffffffffff,0x1fffffffffffff),this.times("1e"+a)},y.squareRoot=y.sqrt=function(){var a,b,c,d,e,f=this.c,g=this.s,h=this.e,i=A+4,j=new M("0.5");if(1!==g||!f||!f[0])return new M(!g||g<0&&(!f||f[0])?NaN:f?this:1/0);if(0==(g=Math.sqrt(+R(this)))||g==1/0?(((b=l(f)).length+h)%2==0&&(b+="0"),g=Math.sqrt(+b),h=k((h+1)/2)-(h<0||h%2),c=new M(b=g==1/0?"5e"+h:(b=g.toExponential()).slice(0,b.indexOf("e")+1)+h)):c=new M(g+""),c.c[0]){for((g=(h=c.e)+i)<3&&(g=0);;)if(e=c,c=j.times(e.plus(v(this,e,i,1))),l(e.c).slice(0,g)===(b=l(c.c)).slice(0,g)){if(c.e<h&&--g,"9999"!=(b=b.slice(g-3,g+1))&&(d||"4999"!=b)){+b&&(+b.slice(1)||"5"!=b.charAt(0))||(Q(c,c.e+A+2,1),a=!c.times(c).eq(this));break}if(!d&&(Q(e,e.e+A+2,0),e.times(e).eq(this))){c=e;break}i+=4,g+=4,d=1}}return Q(c,c.e+A+1,B,a)},y.toExponential=function(a,b){return null!=a&&(n(a,0,1e9),a++),N(this,a,b,1)},y.toFixed=function(a,b){return null!=a&&(n(a,0,1e9),a=a+this.e+1),N(this,a,b)},y.toFormat=function(a,b,c){var d;if(null==c)null!=a&&b&&"object"==typeof b?(c=b,b=null):a&&"object"==typeof a?(c=a,a=b=null):c=J;else if("object"!=typeof c)throw Error(h+"Argument not an object: "+c);if(d=this.toFixed(a,b),this.c){var e,f=d.split("."),g=+c.groupSize,i=+c.secondaryGroupSize,j=c.groupSeparator||"",k=f[0],l=f[1],m=this.s<0,n=m?k.slice(1):k,o=n.length;if(i&&(e=g,g=i,i=e,o-=e),g>0&&o>0){for(e=o%g||g,k=n.substr(0,e);e<o;e+=g)k+=j+n.substr(e,g);i>0&&(k+=j+n.slice(e)),m&&(k="-"+k)}d=l?k+(c.decimalSeparator||"")+((i=+c.fractionGroupSize)?l.replace(RegExp("\\d{"+i+"}\\B","g"),"$&"+(c.fractionGroupSeparator||"")):l):k}return(c.prefix||"")+d+(c.suffix||"")},y.toFraction=function(a){var b,c,d,e,f,g,i,k,m,n,o,p,q=this.c;if(null!=a&&(!(i=new M(a)).isInteger()&&(i.c||1!==i.s)||i.lt(z)))throw Error(h+"Argument "+(i.isInteger()?"out of range: ":"not an integer: ")+R(i));if(!q)return new M(this);for(b=new M(z),m=c=new M(z),d=k=new M(z),p=l(q),f=b.e=p.length-this.e-1,b.c[0]=j[(g=f%14)<0?14+g:g],a=!a||i.comparedTo(b)>0?f>0?b:m:i,g=F,F=1/0,i=new M(p),k.c[0]=0;n=v(i,b,0,1),1!=(e=c.plus(n.times(d))).comparedTo(a);)c=d,d=e,m=k.plus(n.times(e=m)),k=e,b=i.minus(n.times(e=b)),i=e;return e=v(a.minus(c),d,0,1),k=k.plus(e.times(m)),c=c.plus(e.times(d)),k.s=m.s=this.s,f*=2,o=1>v(m,d,f,B).minus(this).abs().comparedTo(v(k,c,f,B).minus(this).abs())?[m,d]:[k,c],F=g,o},y.toNumber=function(){return+R(this)},y.toPrecision=function(a,b){return null!=a&&n(a,1,1e9),N(this,a,b,2)},y.toString=function(a){var b,c=this,d=c.s,e=c.e;return null===e?d?(b="Infinity",d<0&&(b="-"+b)):b="NaN":(null==a?b=e<=C||e>=D?p(l(c.c),e):q(l(c.c),e,"0"):10===a&&L?b=q(l((c=Q(new M(c),A+e+1,B)).c),c.e,"0"):(n(a,2,K.length,"Base"),b=w(q(l(c.c),e,"0"),10,a,d,!0)),d<0&&c.c[0]&&(b="-"+b)),b},y.valueOf=y.toJSON=function(){return R(this)},y._isBigNumber=!0,null!=b&&M.set(b),M}()).default=d.BigNumber=d,"function"==typeof define&&define.amd)a.r,void 0!==d&&a.v(d);else b.exports?b.exports=d:(c||(c="undefined"!=typeof self&&self?self:window),c.BigNumber=d)}(a.e)},8653,(a,b,c)=>{var d=a.r(174988),e=b.exports;!function(){"use strict";var a,b,c,f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function h(a){return f.lastIndex=0,f.test(a)?'"'+a.replace(f,function(a){var b=g[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}"function"!=typeof e.stringify&&(e.stringify=function(e,f,g){var i;if(a="",b="","number"==typeof g)for(i=0;i<g;i+=1)b+=" ";else"string"==typeof g&&(b=g);if(c=f,f&&"function"!=typeof f&&("object"!=typeof f||"number"!=typeof f.length))throw Error("JSON.stringify");return function e(f,g){var i,j,k,l,m,n=a,o=g[f],p=null!=o&&(o instanceof d||d.isBigNumber(o));switch(o&&"object"==typeof o&&"function"==typeof o.toJSON&&(o=o.toJSON(f)),"function"==typeof c&&(o=c.call(g,f,o)),typeof o){case"string":if(p)return o;return h(o);case"number":return isFinite(o)?String(o):"null";case"boolean":case"null":case"bigint":return String(o);case"object":if(!o)return"null";if(a+=b,m=[],"[object Array]"===Object.prototype.toString.apply(o)){for(i=0,l=o.length;i<l;i+=1)m[i]=e(i,o)||"null";return k=0===m.length?"[]":a?"[\n"+a+m.join(",\n"+a)+"\n"+n+"]":"["+m.join(",")+"]",a=n,k}if(c&&"object"==typeof c)for(i=0,l=c.length;i<l;i+=1)"string"==typeof c[i]&&(k=e(j=c[i],o))&&m.push(h(j)+(a?": ":":")+k);else Object.keys(o).forEach(function(b){var c=e(b,o);c&&m.push(h(b)+(a?": ":":")+c)});return k=0===m.length?"{}":a?"{\n"+a+m.join(",\n"+a)+"\n"+n+"}":"{"+m.join(",")+"}",a=n,k}}("",{"":e})})}()},820126,(a,b,c)=>{var d=null;let e=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,f=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/;b.exports=function(b){"use strict";var c={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(null!=b){if(!0===b.strict&&(c.strict=!0),!0===b.storeAsString&&(c.storeAsString=!0),c.alwaysParseAsBig=!0===b.alwaysParseAsBig&&b.alwaysParseAsBig,c.useNativeBigInt=!0===b.useNativeBigInt&&b.useNativeBigInt,void 0!==b.constructorAction)if("error"===b.constructorAction||"ignore"===b.constructorAction||"preserve"===b.constructorAction)c.constructorAction=b.constructorAction;else throw Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${b.constructorAction}`);if(void 0!==b.protoAction)if("error"===b.protoAction||"ignore"===b.protoAction||"preserve"===b.protoAction)c.protoAction=b.protoAction;else throw Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${b.protoAction}`)}var g,h,i,j,k={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},l=function(a){throw{name:"SyntaxError",message:a,at:g,text:i}},m=function(a){return a&&a!==h&&l("Expected '"+a+"' instead of '"+h+"'"),h=i.charAt(g),g+=1,h},n=function(){var b,e="";for("-"===h&&(e="-",m("-"));h>="0"&&h<="9";)e+=h,m();if("."===h)for(e+=".";m()&&h>="0"&&h<="9";)e+=h;if("e"===h||"E"===h)for(e+=h,m(),("-"===h||"+"===h)&&(e+=h,m());h>="0"&&h<="9";)e+=h,m();if(isFinite(b=+e))return(null==d&&(d=a.r(174988)),e.length>15)?c.storeAsString?e:c.useNativeBigInt?BigInt(e):new d(e):c.alwaysParseAsBig?c.useNativeBigInt?BigInt(b):new d(b):b;l("Bad number")},o=function(){var a,b,c,d="";if('"'===h)for(var e=g;m();){if('"'===h)return g-1>e&&(d+=i.substring(e,g-1)),m(),d;if("\\"===h){if(g-1>e&&(d+=i.substring(e,g-1)),m(),"u"===h){for(b=0,c=0;b<4&&isFinite(a=parseInt(m(),16));b+=1)c=16*c+a;d+=String.fromCharCode(c)}else if("string"==typeof k[h])d+=k[h];else break;e=g}}l("Bad string")},p=function(){for(;h&&h<=" ";)m()},q=function(){switch(h){case"t":return m("t"),m("r"),m("u"),m("e"),!0;case"f":return m("f"),m("a"),m("l"),m("s"),m("e"),!1;case"n":return m("n"),m("u"),m("l"),m("l"),null}l("Unexpected '"+h+"'")},r=function(){var a=[];if("["===h){if(m("["),p(),"]"===h)return m("]"),a;for(;h;){if(a.push(j()),p(),"]"===h)return m("]"),a;m(","),p()}}l("Bad array")},s=function(){var a,b=Object.create(null);if("{"===h){if(m("{"),p(),"}"===h)return m("}"),b;for(;h;){if(a=o(),p(),m(":"),!0===c.strict&&Object.hasOwnProperty.call(b,a)&&l('Duplicate key "'+a+'"'),!0===e.test(a)?"error"===c.protoAction?l("Object contains forbidden prototype property"):"ignore"===c.protoAction?j():b[a]=j():!0===f.test(a)?"error"===c.constructorAction?l("Object contains forbidden constructor property"):"ignore"===c.constructorAction?j():b[a]=j():b[a]=j(),p(),"}"===h)return m("}"),b;m(","),p()}}l("Bad object")};return j=function(){switch(p(),h){case"{":return s();case"[":return r();case'"':return o();case"-":return n();default:return h>="0"&&h<="9"?n():q()}},function(a,b){var c;return i=a+"",g=0,h=" ",c=j(),p(),h&&l("Syntax error"),"function"==typeof b?function a(c,d){var e,f=c[d];return f&&"object"==typeof f&&Object.keys(f).forEach(function(b){void 0!==(e=a(f,b))?f[b]=e:delete f[b]}),b.call(c,d,f)}({"":c},""):c}}},979454,(a,b,c)=>{var d=a.r(8653).stringify,e=a.r(820126);b.exports=function(a){return{parse:e(a),stringify:d}},b.exports.parse=e(),b.exports.stringify=d},734496,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Colours=void 0;class d{static isEnabled(a){return a&&a.isTTY&&("function"!=typeof a.getColorDepth||a.getColorDepth()>2)}static refresh(){d.enabled=d.isEnabled(null==process?void 0:process.stderr),this.enabled?(d.reset="\x1b[0m",d.bright="\x1b[1m",d.dim="\x1b[2m",d.red="\x1b[31m",d.green="\x1b[32m",d.yellow="\x1b[33m",d.blue="\x1b[34m",d.magenta="\x1b[35m",d.cyan="\x1b[36m",d.white="\x1b[37m",d.grey="\x1b[90m"):(d.reset="",d.bright="",d.dim="",d.red="",d.green="",d.yellow="",d.blue="",d.magenta="",d.cyan="",d.white="",d.grey="")}}c.Colours=d,d.enabled=!1,d.reset="",d.bright="",d.dim="",d.red="",d.green="",d.yellow="",d.blue="",d.magenta="",d.cyan="",d.white="",d.grey="",d.refresh()},507257,(a,b,c)=>{"use strict";let d;var e,f,g,h=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),i=a.e&&a.e.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:!0,value:b})}:function(a,b){a.default=b}),j=a.e&&a.e.__importStar||(e=function(a){return(e=Object.getOwnPropertyNames||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[b.length]=c);return b})(a)},function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c=e(a),d=0;d<c.length;d++)"default"!==c[d]&&h(b,a,c[d]);return i(b,a),b});Object.defineProperty(c,"__esModule",{value:!0}),c.env=c.DebugLogBackendBase=c.placeholder=c.AdhocDebugLogger=c.LogSeverity=void 0,c.getNodeBackend=r,c.getDebugBackend=function(a){return new s(a)},c.getStructuredBackend=function(a){return new t(a)},c.setBackend=function(a){d=a,u.clear()},c.log=v;let k=a.r(427699),l=j(a.r(605365)),m=j(a.r(224361)),n=a.r(734496);(f=g||(c.LogSeverity=g={})).DEFAULT="DEFAULT",f.DEBUG="DEBUG",f.INFO="INFO",f.WARNING="WARNING",f.ERROR="ERROR";class o extends k.EventEmitter{constructor(a,b){super(),this.namespace=a,this.upstream=b,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(a,b)=>this.on(a,b)}),this.func.debug=(...a)=>this.invokeSeverity(g.DEBUG,...a),this.func.info=(...a)=>this.invokeSeverity(g.INFO,...a),this.func.warn=(...a)=>this.invokeSeverity(g.WARNING,...a),this.func.error=(...a)=>this.invokeSeverity(g.ERROR,...a),this.func.sublog=a=>v(a,this.func)}invoke(a,...b){if(this.upstream)try{this.upstream(a,...b)}catch(a){}try{this.emit("log",a,b)}catch(a){}}invokeSeverity(a,...b){this.invoke({severity:a},...b)}}c.AdhocDebugLogger=o,c.placeholder=new o("",()=>{}).func;class p{constructor(){var a;this.cached=new Map,this.filters=[],this.filtersSet=!1;let b=null!=(a=l.env[c.env.nodeEnables])?a:"*";"all"===b&&(b="*"),this.filters=b.split(",")}log(a,b,...c){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let d=this.cached.get(a);d||(d=this.makeLogger(a),this.cached.set(a,d)),d(b,...c)}catch(a){console.error(a)}}}c.DebugLogBackendBase=p;class q extends p{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(a){return this.enabledRegexp.test(a)}makeLogger(a){return this.enabledRegexp.test(a)?(b,...c)=>{var d;let e,f=`${n.Colours.green}${a}${n.Colours.reset}`,h=`${n.Colours.yellow}${l.pid}${n.Colours.reset}`;switch(b.severity){case g.ERROR:e=`${n.Colours.red}${b.severity}${n.Colours.reset}`;break;case g.INFO:e=`${n.Colours.magenta}${b.severity}${n.Colours.reset}`;break;case g.WARNING:e=`${n.Colours.yellow}${b.severity}${n.Colours.reset}`;break;default:e=null!=(d=b.severity)?d:g.DEFAULT}let i=m.formatWithOptions({colors:n.Colours.enabled},...c),j=Object.assign({},b);delete j.severity;let k=Object.getOwnPropertyNames(j).length?JSON.stringify(j):"",o=k?`${n.Colours.grey}${k}${n.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",h,f,e,i,k?` ${o}`:"")}:()=>{}}setFilters(){let a=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=RegExp(`^${a}$`,"i")}}function r(){return new q}class s extends p{constructor(a){super(),this.debugPkg=a}makeLogger(a){let b=this.debugPkg(a);return(a,...c)=>{b(c[0],...c.slice(1))}}setFilters(){var a;let b=null!=(a=l.env.NODE_DEBUG)?a:"";l.env.NODE_DEBUG=`${b}${b?",":""}${this.filters.join(",")}`}}class t extends p{constructor(a){super(),this.upstream=null!=a?a:void 0}makeLogger(a){var b;let c=null==(b=this.upstream)?void 0:b.makeLogger(a);return(a,...b)=>{var d;let e=JSON.stringify(Object.assign({severity:null!=(d=a.severity)?d:g.INFO,message:m.format(...b)},a));c?c(a,e):console.log("%s",e)}}setFilters(){var a;null==(a=this.upstream)||a.setFilters()}}c.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};let u=new Map;function v(a,b){let e;if(!d&&!l.env[c.env.nodeEnables]||!a)return c.placeholder;b&&(a=`${b.instance.namespace}:${a}`);let f=u.get(a);if(f)return f.func;if(null===d)return c.placeholder;void 0===d&&(d=r());let g=new o(a,(b,...c)=>{if(e!==d){if(null===d)return;void 0===d&&(d=r()),e=d}null==d||d.log(a,b,...c)});return u.set(a,g),g.func}},384474,(a,b,c)=>{"use strict";var d=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),e=a.e&&a.e.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||d(b,a,c)};Object.defineProperty(c,"__esModule",{value:!0}),e(a.r(507257),c)},764733,(a,b,c)=>{"use strict";let d;var e,f=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),g=a.e&&a.e.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:!0,value:b})}:function(a,b){a.default=b}),h=a.e&&a.e.__importStar||(e=function(a){return(e=Object.getOwnPropertyNames||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[b.length]=c);return b})(a)},function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c=e(a),d=0;d<c.length;d++)"default"!==c[d]&&f(b,a,c[d]);return g(b,a),b}),i=a.e&&a.e.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||f(b,a,c)};Object.defineProperty(c,"__esModule",{value:!0}),c.gcpResidencyCache=c.METADATA_SERVER_DETECTION=c.HEADERS=c.HEADER_VALUE=c.HEADER_NAME=c.SECONDARY_HOST_ADDRESS=c.HOST_ADDRESS=c.BASE_PATH=void 0,c.instance=function(a){return p("instance",a)},c.project=function(a){return p("project",a)},c.universe=function(a){return p("universe",a)},c.bulk=r,c.isAvailable=s,c.resetIsAvailableCache=function(){d=void 0},c.getGCPResidency=t,c.setGCPResidency=u,c.requestTimeout=v;let j=a.r(96857),k=a.r(979454),l=a.r(466666),m=h(a.r(384474));c.BASE_PATH="/computeMetadata/v1",c.HOST_ADDRESS="http://169.254.169.254",c.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.",c.HEADER_NAME="Metadata-Flavor",c.HEADER_VALUE="Google",c.HEADERS=Object.freeze({[c.HEADER_NAME]:c.HEADER_VALUE});let n=m.log("gcp-metadata");function o(a){return a||(a=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||c.HOST_ADDRESS),/^https?:\/\//.test(a)||(a=`http://${a}`),new URL(c.BASE_PATH,a).href}async function p(a,b={},d=3,e=!1){let f=new Headers(c.HEADERS),g="",h={};("object"==typeof a?(new Headers(a.headers).forEach((a,b)=>f.set(b,a)),g=a.metadataKey,h=a.params||h,d=a.noResponseRetries||d,e=a.fastFail||e):g=a,"string"==typeof b)?g+=`/${b}`:(Object.keys(b).forEach(a=>{switch(a){case"params":case"property":case"headers":break;case"qs":throw Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw Error(`'${a}' is not a valid configuration option.`)}}),b.property&&(g+=`/${b.property}`),new Headers(b.headers).forEach((a,b)=>f.set(b,a)),h=b.params||h);let i=e?q:j.request,l={url:`${o()}/${g}`,headers:f,retryConfig:{noResponseRetries:d},params:h,responseType:"text",timeout:v()};n.info("instance request %j",l);let m=await i(l);n.info("instance metadata is %s",m.data);let r=m.headers.get(c.HEADER_NAME);if(r!==c.HEADER_VALUE)throw RangeError(`Invalid response from metadata service: incorrect ${c.HEADER_NAME} header. Expected '${c.HEADER_VALUE}', got ${r?`'${r}'`:"no header"}`);if("string"==typeof m.data)try{return k.parse(m.data)}catch{}return m.data}async function q(a){let b={...a,url:a.url?.toString().replace(o(),o(c.SECONDARY_HOST_ADDRESS))};return Promise.any([(0,j.request)(a),(0,j.request)(b)])}async function r(a){let b={};return await Promise.all(a.map(a=>(async()=>{let c=await p(a);b[a.metadataKey]=c})())),b}async function s(){if(process.env.METADATA_SERVER_DETECTION){let a=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(a in c.METADATA_SERVER_DETECTION))throw RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${a}\`, but it should be \`${Object.keys(c.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(a){case"assume-present":return!0;case"none":return!1;case"bios-only":return t()}}try{return void 0===d&&(d=p("instance",void 0,process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0,!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await d,!0}catch(a){if(process.env.DEBUG_AUTH&&console.info(a),"request-timeout"===a.type||a.response&&404===a.response.status)return!1;if(!(a.response&&404===a.response.status)&&(!a.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(a.code.toString()))){let b="UNKNOWN";a.code&&(b=a.code.toString()),process.emitWarning(`received unexpected error = ${a.message} code = ${b}`,"MetadataLookupWarning")}return!1}}function t(){return null===c.gcpResidencyCache&&u(),c.gcpResidencyCache}function u(a=null){c.gcpResidencyCache=null!==a?a:(0,l.detectGCPResidency)()}function v(){return 3e3*!t()}c.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"}),c.gcpResidencyCache=null,i(a.r(466666),c)},170587,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.fromArrayBufferToHex=function(a){return Array.from(new Uint8Array(a)).map(a=>a.toString(16).padStart(2,"0")).join("")}},279384,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BrowserCrypto=void 0;let d=a.r(584709),e=a.r(170587);class f{constructor(){throw Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(a){let b=new TextEncoder().encode(a),c=await window.crypto.subtle.digest("SHA-256",b);return d.fromByteArray(new Uint8Array(c))}randomBytesBase64(a){let b=new Uint8Array(a);return window.crypto.getRandomValues(b),d.fromByteArray(b)}static padBase64(a){for(;a.length%4!=0;)a+="=";return a}async verify(a,b,c){let e={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},g=new TextEncoder().encode(b),h=d.toByteArray(f.padBase64(c)),i=await window.crypto.subtle.importKey("jwk",a,e,!0,["verify"]);return await window.crypto.subtle.verify(e,i,h,g)}async sign(a,b){let c={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},e=new TextEncoder().encode(b),f=await window.crypto.subtle.importKey("jwk",a,c,!0,["sign"]),g=await window.crypto.subtle.sign(c,f,e);return d.fromByteArray(new Uint8Array(g))}decodeBase64StringUtf8(a){let b=d.toByteArray(f.padBase64(a));return new TextDecoder().decode(b)}encodeBase64StringUtf8(a){let b=new TextEncoder().encode(a);return d.fromByteArray(b)}async sha256DigestHex(a){let b=new TextEncoder().encode(a),c=await window.crypto.subtle.digest("SHA-256",b);return(0,e.fromArrayBufferToHex)(c)}async signWithHmacSha256(a,b){let c="string"==typeof a?a:String.fromCharCode(...new Uint16Array(a)),d=new TextEncoder,e=await window.crypto.subtle.importKey("raw",d.encode(c),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",e,d.encode(b))}}c.BrowserCrypto=f},19125,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.NodeCrypto=void 0;let d=a.r(254799);c.NodeCrypto=class{async sha256DigestBase64(a){return d.createHash("sha256").update(a).digest("base64")}randomBytesBase64(a){return d.randomBytes(a).toString("base64")}async verify(a,b,c){let e=d.createVerify("RSA-SHA256");return e.update(b),e.end(),e.verify(a,c,"base64")}async sign(a,b){let c=d.createSign("RSA-SHA256");return c.update(b),c.end(),c.sign(a,"base64")}decodeBase64StringUtf8(a){return Buffer.from(a,"base64").toString("utf-8")}encodeBase64StringUtf8(a){return Buffer.from(a,"utf-8").toString("base64")}async sha256DigestHex(a){return d.createHash("sha256").update(a).digest("hex")}async signWithHmacSha256(a,b){var c,e;let f="string"==typeof a?a:(c=a,Buffer.from(c));return(e=d.createHmac("sha256",f).update(b).digest()).buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}}},475638,(a,b,c)=>{"use strict";var d=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),e=a.e&&a.e.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||d(b,a,c)};Object.defineProperty(c,"__esModule",{value:!0}),c.createCrypto=function(){return function(){;}(),new f.NodeCrypto},c.hasBrowserCrypto=g,a.r(279384);let f=a.r(19125);function g(){return!1}e(a.r(170587),c)},661845,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.LRUCache=void 0,c.snakeToCamel=h,c.originalOrCamelOptions=function(a){return{get:function(b){let c=a||{};return c[b]??c[h(b)]}}},c.removeUndefinedValuesInObject=function(a){return Object.entries(a).forEach(([b,c])=>{(void 0===c||"undefined"===c)&&delete a[b]}),a},c.isValidFile=j,c.getWellKnownCertificateConfigFileLocation=function(){let a=process.env.CLOUDSDK_CONFIG||(e.platform().startsWith("win")?f.join(process.env.APPDATA||"",g):f.join(process.env.HOME||"",".config",g));return f.join(a,"certificate_config.json")};let d=a.r(522734),e=a.r(446786),f=a.r(814747),g="gcloud";function h(a){return a.replace(/([_][^_])/g,a=>a.slice(1).toUpperCase())}class i{capacity;#j=new Map;maxAge;constructor(a){this.capacity=a.capacity,this.maxAge=a.maxAge}#k(a,b){this.#j.delete(a),this.#j.set(a,{value:b,lastAccessed:Date.now()})}set(a,b){this.#k(a,b),this.#l()}get(a){let b=this.#j.get(a);if(b)return this.#k(a,b.value),this.#l(),b.value}#l(){let a=this.maxAge?Date.now()-this.maxAge:0,b=this.#j.entries().next();for(;!b.done&&(this.#j.size>this.capacity||b.value[1].lastAccessed<a);)this.#j.delete(b.value[0]),b=this.#j.entries().next()}}async function j(a){try{return(await d.promises.lstat(a)).isFile()}catch(a){return!1}}c.LRUCache=i},559222,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.USER_AGENT=c.PRODUCT_NAME=c.pkg=void 0;let d=a.r(885083);c.pkg=d;let e="google-api-nodejs-client";c.PRODUCT_NAME=e,c.USER_AGENT=`${e}/${d.version}`},69405,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.AuthClient=c.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=c.DEFAULT_UNIVERSE=void 0;let d=a.r(427699),e=a.r(96857),f=a.r(661845),g=a.r(384474),h=a.r(559222);c.DEFAULT_UNIVERSE="googleapis.com",c.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=3e5;class i extends d.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=c.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=c.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(a={}){super();const b=(0,f.originalOrCamelOptions)(a);this.apiKey=a.apiKey,this.projectId=b.get("project_id")??null,this.quotaProjectId=b.get("quota_project_id"),this.credentials=b.get("credentials")??{},this.universeDomain=b.get("universe_domain")??c.DEFAULT_UNIVERSE,this.transporter=a.transporter??new e.Gaxios(a.transporterOptions),!1!==b.get("useAuthRequestParameters")&&(this.transporter.interceptors.request.add(i.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(i.DEFAULT_RESPONSE_INTERCEPTOR)),a.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=a.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=a.forceRefreshOnFailure??!1}fetch(...a){let b,c=a[0],d=a[1],f=new Headers;return("string"==typeof c?b=new URL(c):c instanceof URL?b=c:c&&c.url&&(b=new URL(c.url)),c&&"object"==typeof c&&"headers"in c&&e.Gaxios.mergeHeaders(f,c.headers),d&&e.Gaxios.mergeHeaders(f,new Headers(d.headers)),"object"!=typeof c||c instanceof URL)?this.request({...d,headers:f,url:b}):this.request({...d,...c,headers:f,url:b})}setCredentials(a){this.credentials=a}addSharedMetadataHeaders(a){return!a.has("x-goog-user-project")&&this.quotaProjectId&&a.set("x-goog-user-project",this.quotaProjectId),a}addUserProjectAndAuthHeaders(a,b){let c=b.get("x-goog-user-project"),d=b.get("authorization");return c&&a.set("x-goog-user-project",c),d&&a.set("authorization",d),a}static log=(0,g.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async a=>{if(!a.headers.has("x-goog-api-client")){let b=process.version.replace(/^v/,"");a.headers.set("x-goog-api-client",`gl-node/${b}`)}let b=a.headers.get("User-Agent");b?b.includes(`${h.PRODUCT_NAME}/`)||a.headers.set("User-Agent",`${b} ${h.USER_AGENT}`):a.headers.set("User-Agent",h.USER_AGENT);try{let b=a[i.RequestMethodNameSymbol],c=`${Math.floor(1e3*Math.random())}`;a[i.RequestLogIdSymbol]=c;let d={url:a.url,headers:a.headers};b?i.log.info("%s [%s] request %j",b,c,d):i.log.info("[%s] request %j",c,d)}catch(a){}return a}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async a=>{try{let b=a.config,c=b[i.RequestMethodNameSymbol],d=b[i.RequestLogIdSymbol];c?i.log.info("%s [%s] response %j",c,d,a.data):i.log.info("[%s] response %j",d,a.data)}catch(a){}return a},rejected:async a=>{try{let b=a.config,c=b[i.RequestMethodNameSymbol],d=b[i.RequestLogIdSymbol];c?i.log.info("%s [%s] error %j",c,d,a.response?.data):i.log.error("[%s] error %j",d,a.response?.data)}catch(a){}throw a}};static setMethodName(a,b){try{a[i.RequestMethodNameSymbol]=b}catch(a){}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}c.AuthClient=i},263466,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.LoginTicket=void 0,c.LoginTicket=class{envelope;payload;constructor(a,b){this.envelope=a,this.payload=b}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let a=this.getPayload();return a&&a.sub?a.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}}},397033,(a,b,c)=>{"use strict";var d,e,f,g,h,i;Object.defineProperty(c,"__esModule",{value:!0}),c.OAuth2Client=c.ClientAuthentication=c.CertificateFormat=c.CodeChallengeMethod=void 0;let j=a.r(96857),k=a.r(145706),l=a.r(688947),m=a.r(389397),n=a.r(661845),o=a.r(475638),p=a.r(69405),q=a.r(263466);(g=d||(c.CodeChallengeMethod=d={})).Plain="plain",g.S256="S256",(h=e||(c.CertificateFormat=e={})).PEM="PEM",h.JWK="JWK",(i=f||(c.ClientAuthentication=f={})).ClientSecretPost="ClientSecretPost",i.ClientSecretBasic="ClientSecretBasic",i.None="None";class r extends p.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=e.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(a={},b,c){super("object"==typeof a?a:{}),"object"!=typeof a&&(a={clientId:a,clientSecret:b,redirectUri:c}),this._clientId=a.clientId||a.client_id,this._clientSecret=a.clientSecret||a.client_secret,this.redirectUri=a.redirectUri||a.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...a.endpoints},this.clientAuthentication=a.clientAuthentication||f.ClientSecretPost,this.issuers=a.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(a={}){if(a.code_challenge_method&&!a.code_challenge)throw Error("If a code_challenge_method is provided, code_challenge must be included.");return a.response_type=a.response_type||"code",a.client_id=a.client_id||this._clientId,a.redirect_uri=a.redirect_uri||this.redirectUri,Array.isArray(a.scope)&&(a.scope=a.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+k.stringify(a)}generateCodeVerifier(){throw Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let a=(0,o.createCrypto)(),b=a.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),c=(await a.sha256DigestBase64(b)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:b,codeChallenge:c}}getToken(a,b){let c="string"==typeof a?{code:a}:a;if(!b)return this.getTokenAsync(c);this.getTokenAsync(c).then(a=>b(null,a.tokens,a.res),a=>b(a,null,a.response))}async getTokenAsync(a){let b=this.endpoints.oauth2TokenUrl.toString(),c=new Headers,d={client_id:a.client_id||this._clientId,code_verifier:a.codeVerifier,code:a.code,grant_type:"authorization_code",redirect_uri:a.redirect_uri||this.redirectUri};if(this.clientAuthentication===f.ClientSecretBasic){let a=Buffer.from(`${this._clientId}:${this._clientSecret}`);c.set("authorization",`Basic ${a.toString("base64")}`)}this.clientAuthentication===f.ClientSecretPost&&(d.client_secret=this._clientSecret);let e={...r.RETRY_CONFIG,method:"POST",url:b,data:new URLSearchParams((0,n.removeUndefinedValuesInObject)(d)),headers:c};p.AuthClient.setMethodName(e,"getTokenAsync");let g=await this.transporter.request(e),h=g.data;return g.data&&g.data.expires_in&&(h.expiry_date=new Date().getTime()+1e3*g.data.expires_in,delete h.expires_in),this.emit("tokens",h),{tokens:h,res:g}}async refreshToken(a){if(!a)return this.refreshTokenNoCache(a);if(this.refreshTokenPromises.has(a))return this.refreshTokenPromises.get(a);let b=this.refreshTokenNoCache(a).then(b=>(this.refreshTokenPromises.delete(a),b),b=>{throw this.refreshTokenPromises.delete(a),b});return this.refreshTokenPromises.set(a,b),b}async refreshTokenNoCache(a){let b;if(!a)throw Error("No refresh token is set.");let c=this.endpoints.oauth2TokenUrl.toString(),d={refresh_token:a,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"};try{let a={...r.RETRY_CONFIG,method:"POST",url:c,data:new URLSearchParams((0,n.removeUndefinedValuesInObject)(d))};p.AuthClient.setMethodName(a,"refreshTokenNoCache"),b=await this.transporter.request(a)}catch(a){throw a instanceof j.GaxiosError&&"invalid_grant"===a.message&&a.response?.data&&/ReAuth/i.test(a.response.data.error_description)&&(a.message=JSON.stringify(a.response.data)),a}let e=b.data;return b.data&&b.data.expires_in&&(e.expiry_date=new Date().getTime()+1e3*b.data.expires_in,delete e.expires_in),this.emit("tokens",e),{tokens:e,res:b}}refreshAccessToken(a){if(!a)return this.refreshAccessTokenAsync();this.refreshAccessTokenAsync().then(b=>a(null,b.credentials,b.res),a)}async refreshAccessTokenAsync(){let a=await this.refreshToken(this.credentials.refresh_token),b=a.tokens;return b.refresh_token=this.credentials.refresh_token,this.credentials=b,{credentials:this.credentials,res:a.res}}getAccessToken(a){if(!a)return this.getAccessTokenAsync();this.getAccessTokenAsync().then(b=>a(null,b.token,b.res),a)}async getAccessTokenAsync(){if(!(!this.credentials.access_token||this.isTokenExpiring()))return{token:this.credentials.access_token};{if(!this.credentials.refresh_token)if(this.refreshHandler){let a=await this.processAndValidateRefreshHandler();if(a?.access_token)return this.setCredentials(a),{token:this.credentials.access_token}}else throw Error("No refresh token or refresh handler callback is set.");let a=await this.refreshAccessTokenAsync();if(!a.credentials||a.credentials&&!a.credentials.access_token)throw Error("Could not refresh access token.");return{token:a.credentials.access_token,res:a.res}}}async getRequestHeaders(a){return(await this.getRequestMetadataAsync(a)).headers}async getRequestMetadataAsync(a){let b=this.credentials;if(!b.access_token&&!b.refresh_token&&!this.apiKey&&!this.refreshHandler)throw Error("No access, refresh token, API key or refresh handler callback is set.");if(b.access_token&&!this.isTokenExpiring()){b.token_type=b.token_type||"Bearer";let a=new Headers({authorization:b.token_type+" "+b.access_token});return{headers:this.addSharedMetadataHeaders(a)}}if(this.refreshHandler){let a=await this.processAndValidateRefreshHandler();if(a?.access_token){this.setCredentials(a);let b=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(b)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let c=null,d=null;try{d=(c=await this.refreshToken(b.refresh_token)).tokens}catch(a){throw a.response&&(403===a.response.status||404===a.response.status)&&(a.message=`Could not refresh access token: ${a.message}`),a}let e=this.credentials;e.token_type=e.token_type||"Bearer",d.refresh_token=e.refresh_token,this.credentials=d;let f=new Headers({authorization:e.token_type+" "+d.access_token});return{headers:this.addSharedMetadataHeaders(f),res:c.res}}static getRevokeTokenUrl(a){return new r().getRevokeTokenURL(a).toString()}getRevokeTokenURL(a){let b=new URL(this.endpoints.oauth2RevokeUrl);return b.searchParams.append("token",a),b}revokeToken(a,b){let c={...r.RETRY_CONFIG,url:this.getRevokeTokenURL(a).toString(),method:"POST"};if(p.AuthClient.setMethodName(c,"revokeToken"),!b)return this.transporter.request(c);this.transporter.request(c).then(a=>b(null,a),b)}revokeCredentials(a){if(!a)return this.revokeCredentialsAsync();this.revokeCredentialsAsync().then(b=>a(null,b),a)}async revokeCredentialsAsync(){let a=this.credentials.access_token;if(this.credentials={},a)return this.revokeToken(a);throw Error("No access token to revoke.")}request(a,b){if(!b)return this.requestAsync(a);this.requestAsync(a).then(a=>b(null,a),a=>b(a,a.response))}async requestAsync(a,b=!1){try{let b=await this.getRequestMetadataAsync();return a.headers=j.Gaxios.mergeHeaders(a.headers),this.addUserProjectAndAuthHeaders(a.headers,b.headers),this.apiKey&&a.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(a)}catch(d){let c=d.response;if(c){let d=c.status,e=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),f=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,g=c.config.data instanceof l.Readable,h=401===d||403===d;if(!b&&h&&!g&&e)return await this.refreshAccessTokenAsync(),this.requestAsync(a,!0);if(!b&&h&&!g&&f){let b=await this.processAndValidateRefreshHandler();return b?.access_token&&this.setCredentials(b),this.requestAsync(a,!0)}}throw d}}verifyIdToken(a,b){if(b&&"function"!=typeof b)throw Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(!b)return this.verifyIdTokenAsync(a);this.verifyIdTokenAsync(a).then(a=>b(null,a),b)}async verifyIdTokenAsync(a){if(!a.idToken)throw Error("The verifyIdToken method requires an ID Token");let b=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(a.idToken,b.certs,a.audience,this.issuers,a.maxExpiry)}async getTokenInfo(a){let{data:b}=await this.transporter.request({...r.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${a}`},url:this.endpoints.tokenInfoUrl.toString()}),c=Object.assign({expiry_date:new Date().getTime()+1e3*b.expires_in,scopes:b.scope.split(" ")},b);return delete c.expires_in,delete c.scope,c}getFederatedSignonCerts(a){if(!a)return this.getFederatedSignonCertsAsync();this.getFederatedSignonCertsAsync().then(b=>a(null,b.certs,b.res),a)}async getFederatedSignonCertsAsync(){let a,b,c=new Date().getTime(),d=(0,o.hasBrowserCrypto)()?e.JWK:e.PEM;if(this.certificateExpiry&&c<this.certificateExpiry.getTime()&&this.certificateCacheFormat===d)return{certs:this.certificateCache,format:d};switch(d){case e.PEM:b=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case e.JWK:b=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw Error(`Unsupported certificate format ${d}`)}try{let c={...r.RETRY_CONFIG,url:b};p.AuthClient.setMethodName(c,"getFederatedSignonCertsAsync"),a=await this.transporter.request(c)}catch(a){throw a instanceof Error&&(a.message=`Failed to retrieve verification certificates: ${a.message}`),a}let f=a?.headers.get("cache-control"),g=-1;if(f){let a=/max-age=(?<maxAge>[0-9]+)/.exec(f)?.groups?.maxAge;a&&(g=1e3*Number(a))}let h={};switch(d){case e.PEM:h=a.data;break;case e.JWK:for(let b of a.data.keys)h[b.kid]=b;break;default:throw Error(`Unsupported certificate format ${d}`)}let i=new Date;return this.certificateExpiry=-1===g?null:new Date(i.getTime()+g),this.certificateCache=h,this.certificateCacheFormat=d,{certs:h,format:d,res:a}}getIapPublicKeys(a){if(!a)return this.getIapPublicKeysAsync();this.getIapPublicKeysAsync().then(b=>a(null,b.pubkeys,b.res),a)}async getIapPublicKeysAsync(){let a,b=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let c={...r.RETRY_CONFIG,url:b};p.AuthClient.setMethodName(c,"getIapPublicKeysAsync"),a=await this.transporter.request(c)}catch(a){throw a instanceof Error&&(a.message=`Failed to retrieve verification certificates: ${a.message}`),a}return{pubkeys:a.data,res:a}}verifySignedJwtWithCerts(){throw Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(a,b,c,d,e){let f,g,h=(0,o.createCrypto)();e||(e=r.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let i=a.split(".");if(3!==i.length)throw Error("Wrong number of segments in token: "+a);let j=i[0]+"."+i[1],k=i[2];try{f=JSON.parse(h.decodeBase64StringUtf8(i[0]))}catch(a){throw a instanceof Error&&(a.message=`Can't parse token envelope: ${i[0]}': ${a.message}`),a}if(!f)throw Error("Can't parse token envelope: "+i[0]);try{g=JSON.parse(h.decodeBase64StringUtf8(i[1]))}catch(a){throw a instanceof Error&&(a.message=`Can't parse token payload '${i[0]}`),a}if(!g)throw Error("Can't parse token payload: "+i[1]);if(!Object.prototype.hasOwnProperty.call(b,f.kid))throw Error("No pem found for envelope: "+JSON.stringify(f));let l=b[f.kid];if("ES256"===f.alg&&(k=m.joseToDer(k,"ES256").toString("base64")),!await h.verify(l,j,k))throw Error("Invalid token signature: "+a);if(!g.iat)throw Error("No issue time in token: "+JSON.stringify(g));if(!g.exp)throw Error("No expiration time in token: "+JSON.stringify(g));let n=Number(g.iat);if(isNaN(n))throw Error("iat field using invalid format");let p=Number(g.exp);if(isNaN(p))throw Error("exp field using invalid format");let s=new Date().getTime()/1e3;if(p>=s+e)throw Error("Expiration time too far in future: "+JSON.stringify(g));let t=n-r.CLOCK_SKEW_SECS_,u=p+r.CLOCK_SKEW_SECS_;if(s<t)throw Error("Token used too early, "+s+" < "+t+": "+JSON.stringify(g));if(s>u)throw Error("Token used too late, "+s+" > "+u+": "+JSON.stringify(g));if(d&&0>d.indexOf(g.iss))throw Error("Invalid issuer, expected one of ["+d+"], but got "+g.iss);if(null!=c){let a=g.aud;if(!(c.constructor===Array?c.indexOf(a)>-1:a===c))throw Error("Wrong recipient, payload audience != requiredAudience")}return new q.LoginTicket(f,g)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let a=await this.refreshHandler();if(!a.access_token)throw Error("No access token is returned by the refreshHandler callback.");return a}}isTokenExpiring(){let a=this.credentials.expiry_date;return!!a&&a<=new Date().getTime()+this.eagerRefreshThresholdMillis}}c.OAuth2Client=r},749696,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Compute=void 0;let d=a.r(96857),e=a.r(764733),f=a.r(397033);class g extends f.OAuth2Client{serviceAccountEmail;scopes;constructor(a={}){super(a),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=a.serviceAccountEmail||"default",this.scopes=Array.isArray(a.scopes)?a.scopes:a.scopes?[a.scopes]:[]}async refreshTokenNoCache(){let a,b=`service-accounts/${this.serviceAccountEmail}/token`;try{let c={property:b};this.scopes.length>0&&(c.params={scopes:this.scopes.join(",")}),a=await e.instance(c)}catch(a){throw a instanceof d.GaxiosError&&(a.message=`Could not refresh access token: ${a.message}`,this.wrapError(a)),a}let c=a;return a&&a.expires_in&&(c.expiry_date=new Date().getTime()+1e3*a.expires_in,delete c.expires_in),this.emit("tokens",c),{tokens:c,res:null}}async fetchIdToken(a){let b,c=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${a}`;try{b=await e.instance({property:c})}catch(a){throw a instanceof Error&&(a.message=`Could not fetch ID token: ${a.message}`),a}return b}wrapError(a){let b=a.response;b&&b.status&&(a.status=b.status,403===b.status?a.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+a.message:404===b.status&&(a.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+a.message))}}c.Compute=g},664364,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.IdTokenClient=void 0;let d=a.r(397033);class e extends d.OAuth2Client{targetAudience;idTokenProvider;constructor(a){super(a),this.targetAudience=a.targetAudience,this.idTokenProvider=a.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let a=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:a,expiry_date:this.getIdTokenExpiryDate(a)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(a){let b=a.split(".")[1];if(b)return 1e3*JSON.parse(Buffer.from(b,"base64").toString("ascii")).exp}}c.IdTokenClient=e},999365,(a,b,c)=>{"use strict";var d,e;let f;Object.defineProperty(c,"__esModule",{value:!0}),c.GCPEnv=void 0,c.clear=function(){f=void 0},c.getEnv=h;let g=a.r(764733);async function h(){return f||(f=i())}async function i(){d.NONE;return process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME?d.APP_ENGINE:process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET?d.CLOUD_FUNCTIONS:await k()?await j()?d.KUBERNETES_ENGINE:process.env.K_CONFIGURATION?d.CLOUD_RUN:process.env.CLOUD_RUN_JOB?d.CLOUD_RUN_JOBS:d.COMPUTE_ENGINE:d.NONE}async function j(){try{return await g.instance("attributes/cluster-name"),!0}catch(a){return!1}}async function k(){return g.isAvailable()}(e=d||(c.GCPEnv=d={})).APP_ENGINE="APP_ENGINE",e.KUBERNETES_ENGINE="KUBERNETES_ENGINE",e.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",e.COMPUTE_ENGINE="COMPUTE_ENGINE",e.CLOUD_RUN="CLOUD_RUN",e.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",e.NONE="NONE"},423801,(a,b,c)=>{var d=a.r(558528).Buffer,e=a.r(688947);function f(a){if(this.buffer=null,this.writable=!0,this.readable=!0,!a)return this.buffer=d.alloc(0),this;if("function"==typeof a.pipe)return this.buffer=d.alloc(0),a.pipe(this),this;if(a.length||"object"==typeof a)return this.buffer=a,this.writable=!1,process.nextTick((function(){this.emit("end",a),this.readable=!1,this.emit("close")}).bind(this)),this;throw TypeError("Unexpected data type ("+typeof a+")")}a.r(224361).inherits(f,e),f.prototype.write=function(a){this.buffer=d.concat([this.buffer,d.from(a)]),this.emit("data",a)},f.prototype.end=function(a){a&&this.write(a),this.emit("end",a),this.emit("close"),this.writable=!1,this.readable=!1},b.exports=f},399376,(a,b,c)=>{var d,e=a.r(558528).Buffer,f=a.r(254799),g=a.r(389397),h=a.r(224361),i="secret must be a string or buffer",j="key must be a string or a buffer",k="function"==typeof f.createPublicKey;function l(a){if(!e.isBuffer(a)&&"string"!=typeof a&&(!k||"object"!=typeof a||"string"!=typeof a.type||"string"!=typeof a.asymmetricKeyType||"function"!=typeof a.export))throw p(j)}function m(a){if(!e.isBuffer(a)&&"string"!=typeof a&&"object"!=typeof a)throw p("key must be a string, a buffer or an object")}function n(a){return a.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function o(a){var b=4-(a=a.toString()).length%4;if(4!==b)for(var c=0;c<b;++c)a+="=";return a.replace(/\-/g,"+").replace(/_/g,"/")}function p(a){var b=[].slice.call(arguments,1);return TypeError(h.format.bind(h,a).apply(null,b))}function q(a){var b;return b=a,e.isBuffer(b)||"string"==typeof b||(a=JSON.stringify(a)),a}function r(a){return function(b,c){!function(a){if(!e.isBuffer(a)){if("string"!=typeof a){if(!k||"object"!=typeof a||"secret"!==a.type||"function"!=typeof a.export)throw p(i)}}}(c),b=q(b);var d=f.createHmac("sha"+a,c);return n((d.update(b),d.digest("base64")))}}k&&(j+=" or a KeyObject",i+="or a KeyObject");var s="timingSafeEqual"in f?function(a,b){return a.byteLength===b.byteLength&&f.timingSafeEqual(a,b)}:function(b,c){return d||(d=a.r(620542)),d(b,c)};function t(a){return function(b,c,d){var f=r(a)(b,d);return s(e.from(c),e.from(f))}}function u(a){return function(b,c){m(c),b=q(b);var d=f.createSign("RSA-SHA"+a);return n((d.update(b),d.sign(c,"base64")))}}function v(a){return function(b,c,d){l(d),b=q(b),c=o(c);var e=f.createVerify("RSA-SHA"+a);return e.update(b),e.verify(d,c,"base64")}}function w(a){return function(b,c){m(c),b=q(b);var d=f.createSign("RSA-SHA"+a);return n((d.update(b),d.sign({key:c,padding:f.constants.RSA_PKCS1_PSS_PADDING,saltLength:f.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function x(a){return function(b,c,d){l(d),b=q(b),c=o(c);var e=f.createVerify("RSA-SHA"+a);return e.update(b),e.verify({key:d,padding:f.constants.RSA_PKCS1_PSS_PADDING,saltLength:f.constants.RSA_PSS_SALTLEN_DIGEST},c,"base64")}}function y(a){var b=u(a);return function(){var c=b.apply(null,arguments);return g.derToJose(c,"ES"+a)}}function z(a){var b=v(a);return function(c,d,e){return b(c,d=g.joseToDer(d,"ES"+a).toString("base64"),e)}}function A(){return function(){return""}}function B(){return function(a,b){return""===b}}b.exports=function(a){var b=a.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!b)throw p('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',a);var c=(b[1]||b[3]).toLowerCase(),d=b[2];return{sign:({hs:r,rs:u,ps:w,es:y,none:A})[c](d),verify:({hs:t,rs:v,ps:x,es:z,none:B})[c](d)}}},883122,(a,b,c)=>{var d=a.r(500874).Buffer;b.exports=function(a){return"string"==typeof a?a:"number"==typeof a||d.isBuffer(a)?a.toString():JSON.stringify(a)}},318614,(a,b,c)=>{var d=a.r(558528).Buffer,e=a.r(423801),f=a.r(399376),g=a.r(688947),h=a.r(883122),i=a.r(224361);function j(a,b){return d.from(a,b).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function k(a){var b,c,d,e=a.header,g=a.payload,k=a.secret||a.privateKey,l=a.encoding,m=f(e.alg),n=(b=(b=l)||"utf8",c=j(h(e),"binary"),d=j(h(g),b),i.format("%s.%s",c,d)),o=m.sign(n,k);return i.format("%s.%s",n,o)}function l(a){var b=a.secret;if(b=null==(b=null==b?a.privateKey:b)?a.key:b,!0===/^hs/i.test(a.header.alg)&&null==b)throw TypeError("secret must be a string or buffer or a KeyObject");var c=new e(b);this.readable=!0,this.header=a.header,this.encoding=a.encoding,this.secret=this.privateKey=this.key=c,this.payload=new e(a.payload),this.secret.once("close",(function(){!this.payload.writable&&this.readable&&this.sign()}).bind(this)),this.payload.once("close",(function(){!this.secret.writable&&this.readable&&this.sign()}).bind(this))}i.inherits(l,g),l.prototype.sign=function(){try{var a=k({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",a),this.emit("data",a),this.emit("end"),this.readable=!1,a}catch(a){this.readable=!1,this.emit("error",a),this.emit("close")}},l.sign=k,b.exports=l},196605,(a,b,c)=>{var d=a.r(558528).Buffer,e=a.r(423801),f=a.r(399376),g=a.r(688947),h=a.r(883122),i=a.r(224361),j=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function k(a){var b=a.split(".",1)[0],c=d.from(b,"base64").toString("binary");if("[object Object]"===Object.prototype.toString.call(c))return c;try{return JSON.parse(c)}catch(a){return}}function l(a){return a.split(".")[2]}function m(a){return j.test(a)&&!!k(a)}function n(a,b,c){if(!b){var d=Error("Missing algorithm parameter for jws.verify");throw d.code="MISSING_ALGORITHM",d}var e=l(a=h(a)),g=a.split(".",2).join(".");return f(b).verify(g,e,c)}function o(a,b){if(b=b||{},!m(a=h(a)))return null;var c,e,f=k(a);if(!f)return null;var g=(c=c||"utf8",e=a.split(".")[1],d.from(e,"base64").toString(c));return("JWT"===f.typ||b.json)&&(g=JSON.parse(g,b.encoding)),{header:f,payload:g,signature:l(a)}}function p(a){var b=(a=a||{}).secret;if(b=null==(b=null==b?a.publicKey:b)?a.key:b,!0===/^hs/i.test(a.algorithm)&&null==b)throw TypeError("secret must be a string or buffer or a KeyObject");var c=new e(b);this.readable=!0,this.algorithm=a.algorithm,this.encoding=a.encoding,this.secret=this.publicKey=this.key=c,this.signature=new e(a.signature),this.secret.once("close",(function(){!this.signature.writable&&this.readable&&this.verify()}).bind(this)),this.signature.once("close",(function(){!this.secret.writable&&this.readable&&this.verify()}).bind(this))}i.inherits(p,g),p.prototype.verify=function(){try{var a=n(this.signature.buffer,this.algorithm,this.key.buffer),b=o(this.signature.buffer,this.encoding);return this.emit("done",a,b),this.emit("data",a),this.emit("end"),this.readable=!1,a}catch(a){this.readable=!1,this.emit("error",a),this.emit("close")}},p.decode=o,p.isValid=m,p.verify=n,b.exports=p},623652,(a,b,c)=>{var d=a.r(318614),e=a.r(196605);c.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],c.sign=d.sign,c.verify=e.verify,c.decode=e.decode,c.isValid=e.isValid,c.createSign=function(a){return new d(a)},c.createVerify=function(a){return new e(a)}},712064,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.GoogleToken=void 0;var d,e=j(a.r(522734)),f=a.r(96857),g=j(a.r(623652)),h=j(a.r(814747)),i=a.r(224361);function j(a,b){if("function"==typeof WeakMap)var c=new WeakMap,d=new WeakMap;return(j=function(a,b){if(!b&&a&&a.__esModule)return a;var e,f,g={__proto__:null,default:a};if(null===a||"object"!=k(a)&&"function"!=typeof a)return g;if(e=b?d:c){if(e.has(a))return e.get(a);e.set(a,g)}for(var h in a)"default"!==h&&({}).hasOwnProperty.call(a,h)&&((f=(e=Object.defineProperty)&&Object.getOwnPropertyDescriptor(a,h))&&(f.get||f.set)?e(g,h,f):g[h]=a[h]);return g})(a,b)}function k(a){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function l(a,b){if(b.has(a))throw TypeError("Cannot initialize the same private elements twice on an object")}function m(a,b,c){return a.set(n(a,b),c),c}function n(a,b,c){if("function"==typeof a?a===b:a.has(b))return arguments.length<3?b:c;throw TypeError("Private element is not present on this object")}function o(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,w(d.key),d)}}function p(a,b,c){return b&&o(a.prototype,b),c&&o(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function q(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}function r(a){var b="function"==typeof Map?new Map:void 0;return(r=function(a){if(null===a||!function(a){try{return -1!==Function.toString.call(a).indexOf("[native code]")}catch(b){return"function"==typeof a}}(a))return a;if("function"!=typeof a)throw TypeError("Super expression must either be null or a function");if(void 0!==b){if(b.has(a))return b.get(a);b.set(a,c)}function c(){return function(a,b,c){if(s())return Reflect.construct.apply(null,arguments);var d=[null];d.push.apply(d,b);var e=new(a.bind.apply(a,d));return c&&t(e,c.prototype),e}(a,arguments,u(this).constructor)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),t(c,a)})(a)}function s(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(a){}return(s=function(){return!!a})()}function t(a,b){return(t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a})(a,b)}function u(a){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)})(a)}function v(a,b,c){return(b=w(b))in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function w(a){var b=function(a,b){if("object"!=k(a)||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=k(d))return d;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}(a,"string");return"symbol"==k(b)?b:b+""}function x(){var a,b,c="function"==typeof Symbol?Symbol:{},d=c.iterator||"@@iterator",e=c.toStringTag||"@@toStringTag";function f(c,d,e,f){var i=Object.create((d&&d.prototype instanceof h?d:h).prototype);return y(i,"_invoke",function(c,d,e){var f,h,i,j=0,k=e||[],l=!1,m={p:0,n:0,v:a,a:n,f:n.bind(a,4),d:function(b,c){return f=b,h=0,i=a,m.n=c,g}};function n(c,d){for(h=c,i=d,b=0;!l&&j&&!e&&b<k.length;b++){var e,f=k[b],n=m.p,o=f[2];c>3?(e=o===d)&&(i=f[(h=f[4])?5:(h=3,3)],f[4]=f[5]=a):f[0]<=n&&((e=c<2&&n<f[1])?(h=0,m.v=d,m.n=f[1]):n<o&&(e=c<3||f[0]>d||d>o)&&(f[4]=c,f[5]=d,m.n=o,h=0))}if(e||c>1)return g;throw l=!0,d}return function(e,k,o){if(j>1)throw TypeError("Generator is already running");for(l&&1===k&&n(k,o),h=k,i=o;(b=h<2?a:i)||!l;){f||(h?h<3?(h>1&&(m.n=-1),n(h,i)):m.n=i:m.v=i);try{if(j=2,f){if(h||(e="next"),b=f[e]){if(!(b=b.call(f,i)))throw TypeError("iterator result is not an object");if(!b.done)return b;i=b.value,h<2&&(h=0)}else 1===h&&(b=f.return)&&b.call(f),h<2&&(i=TypeError("The iterator does not provide a '"+e+"' method"),h=1);f=a}else if((b=(l=m.n<0)?i:c.call(d,m))!==g)break}catch(b){f=a,h=1,i=b}finally{j=1}}return{value:b,done:l}}}(c,e,f),!0),i}var g={};function h(){}function i(){}function j(){}b=Object.getPrototypeOf;var k=j.prototype=h.prototype=Object.create([][d]?b(b([][d]())):(y(b={},d,function(){return this}),b));function l(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,j):(a.__proto__=j,y(a,e,"GeneratorFunction")),a.prototype=Object.create(k),a}return i.prototype=j,y(k,"constructor",j),y(j,"constructor",i),i.displayName="GeneratorFunction",y(j,e,"GeneratorFunction"),y(k),y(k,e,"Generator"),y(k,d,function(){return this}),y(k,"toString",function(){return"[object Generator]"}),(x=function(){return{w:f,m:l}})()}function y(a,b,c,d){var e=Object.defineProperty;try{e({},"",{})}catch(a){e=0}(y=function(a,b,c,d){if(b)e?e(a,b,{value:c,enumerable:!d,configurable:!d,writable:!d}):a[b]=c;else{var f=function(b,c){y(a,b,function(a){return this._invoke(b,c,a)})};f("next",0),f("throw",1),f("return",2)}})(a,b,c,d)}function z(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function A(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var f=a.apply(b,c);function g(a){z(f,d,e,g,h,"next",a)}function h(a){z(f,d,e,g,h,"throw",a)}g(void 0)})}}var B=e.readFile?(0,i.promisify)(e.readFile):A(x().m(function a(){return x().w(function(a){for(;;)switch(a.n){case 0:throw new D("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return a.a(2)}},a)})),C="https://oauth2.googleapis.com/token",D=function(a){function b(a,c){var d,e,f;return q(this,b),e=b,f=[a],e=u(e),v(d=function(a,b){if(b&&("object"==k(b)||"function"==typeof b))return b;if(void 0!==b)throw TypeError("Derived constructors may only return object or undefined");var c=a;if(void 0===c)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return c}(this,s()?Reflect.construct(e,f||[],u(this).constructor):e.apply(this,f)),"code",void 0),d.code=c,d}if("function"!=typeof a&&null!==a)throw TypeError("Super expression must either be null or a function");return b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,writable:!0,configurable:!0}}),Object.defineProperty(b,"prototype",{writable:!1}),a&&t(b,a),p(b)}(r(Error)),E=new WeakMap,F=new WeakSet;function G(a){return H.apply(this,arguments)}function H(){return(H=A(x().m(function a(b){return x().w(function(a){for(;;)switch(a.n){case 0:if(!E.get(n(E,this))||b.forceRefresh){a.n=1;break}return a.a(2,E.get(n(E,this)));case 1:return a.p=1,a.n=2,m(E,this,n(F,this,I).call(this,b));case 2:return a.a(2,a.v);case 3:return a.p=3,m(E,this,void 0),a.f(3);case 4:return a.a(2)}},a,this,[[1,,3,4]])}))).apply(this,arguments)}function I(a){return J.apply(this,arguments)}function J(){return(J=A(x().m(function a(b){var c;return x().w(function(a){for(;;)switch(a.n){case 0:if(!1!==this.isTokenExpiring()||!1!==b.forceRefresh){a.n=1;break}return a.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){a.n=2;break}throw Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){a.n=4;break}return a.n=3,this.getCredentials(this.keyFile);case 3:c=a.v,this.key=c.privateKey,this.iss=c.clientEmail||this.iss,c.clientEmail||n(F,this,K).call(this);case 4:return a.a(2,n(F,this,O).call(this))}},a,this)}))).apply(this,arguments)}function K(){if(!this.iss)throw new D("email is required.","MISSING_CREDENTIALS")}function L(){return M.apply(this,arguments)}function M(){return(M=A(x().m(function a(){var b;return x().w(function(a){for(;;)switch(a.n){case 0:if(this.accessToken){a.n=1;break}throw Error("No token to revoke.");case 1:return b="https://oauth2.googleapis.com/revoke?token="+this.accessToken,a.n=2,this.transporter.request({url:b,retry:!0});case 2:n(F,this,N).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return a.a(2)}},a,this)}))).apply(this,arguments)}function N(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.keyFile=a.keyFile,this.key=a.key,this.rawToken=void 0,this.iss=a.email||a.iss,this.sub=a.sub,this.additionalClaims=a.additionalClaims,"object"===k(a.scope)?this.scope=a.scope.join(" "):this.scope=a.scope,this.eagerRefreshThresholdMillis=a.eagerRefreshThresholdMillis,a.transporter&&(this.transporter=a.transporter)}function O(){return P.apply(this,arguments)}function P(){return(P=A(x().m(function a(){var b,c,d,e,f,h,i,j,k,l;return x().w(function(a){for(;;)switch(a.n){case 0:return b=Math.floor(new Date().getTime()/1e3),c=this.additionalClaims||{},d=Object.assign({iss:this.iss,scope:this.scope,aud:C,exp:b+3600,iat:b,sub:this.sub},c),e=g.sign({header:{alg:"RS256"},payload:d,secret:this.key}),a.p=1,a.n=2,this.transporter.request({method:"POST",url:C,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:e}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return f=a.v,this.rawToken=f.data,this.expiresAt=null===f.data.expires_in||void 0===f.data.expires_in?void 0:(b+f.data.expires_in)*1e3,a.a(2,this.rawToken);case 3:throw a.p=3,l=a.v,this.rawToken=void 0,this.tokenExpires=void 0,(j=l.response&&null!=(h=l.response)&&h.data?null==(i=l.response)?void 0:i.data:{}).error&&(k=j.error_description?": ".concat(j.error_description):"",l.message="".concat(j.error).concat(k)),l;case 4:return a.a(2)}},a,this,[[1,3]])}))).apply(this,arguments)}c.GoogleToken=p(function a(b){q(this,a),l(this,F),F.add(this),v(this,"expiresAt",void 0),v(this,"key",void 0),v(this,"keyFile",void 0),v(this,"iss",void 0),v(this,"sub",void 0),v(this,"scope",void 0),v(this,"rawToken",void 0),v(this,"tokenExpires",void 0),v(this,"email",void 0),v(this,"additionalClaims",void 0),v(this,"eagerRefreshThresholdMillis",void 0),v(this,"transporter",{request:function(a){return(0,f.request)(a)}}),l(this,E),E.set(this,void 0),n(F,this,N).call(this,b)},[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var a=new Date().getTime();return!this.rawToken||!this.expiresAt||a>=this.expiresAt}},{key:"isTokenExpiring",value:function(){var a,b=new Date().getTime(),c=null!=(a=this.eagerRefreshThresholdMillis)?a:0;return!this.rawToken||!this.expiresAt||this.expiresAt<=b+c}},{key:"getToken",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"===k(a)&&(b=a,a=void 0),b=Object.assign({forceRefresh:!1},b),a){var c=a;n(F,this,G).call(this,b).then(function(a){return c(null,a)},a);return}return n(F,this,G).call(this,b)}},{key:"getCredentials",value:(d=A(x().m(function a(b){var c,d,e,f,g;return x().w(function(a){for(;;)switch(a.n){case 0:a.n=".json"===(g=h.extname(b))?1:".der"===g||".crt"===g||".pem"===g?4:".p12"===g||".pfx"===g?6:7;break;case 1:return a.n=2,B(b,"utf8");case 2:if(d=(c=JSON.parse(a.v)).private_key,e=c.client_email,!(!d||!e)){a.n=3;break}throw new D("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return a.a(2,{privateKey:d,clientEmail:e});case 4:return a.n=5,B(b,"utf8");case 5:return f=a.v,a.a(2,{privateKey:f});case 6:throw new D("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new D("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return a.a(2)}},a)})),function(a){return d.apply(this,arguments)})},{key:"revokeToken",value:function(a){return a?void n(F,this,L).call(this).then(function(){return a()},a):n(F,this,L).call(this)}}])},845155,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.JWTAccess=void 0;let d=a.r(623652),e=a.r(661845),f={alg:"RS256",typ:"JWT"};class g{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new e.LRUCache({capacity:500,maxAge:36e5});constructor(a,b,c,d){this.email=a,this.key=b,this.keyId=c,this.eagerRefreshThresholdMillis=d??3e5}getCachedKey(a,b){let c=a;if(b&&Array.isArray(b)&&b.length?c=a?`${a}_${b.join("_")}`:`${b.join("_")}`:"string"==typeof b&&(c=a?`${a}_${b}`:b),!c)throw Error("Scopes or url must be provided");return c}getRequestHeaders(a,b,c){let e,h=this.getCachedKey(a,c),i=this.cache.get(h),j=Date.now();if(i&&i.expiration-j>this.eagerRefreshThresholdMillis)return new Headers(i.headers);let k=Math.floor(Date.now()/1e3),l=g.getExpirationTime(k);if(Array.isArray(c)&&(c=c.join(" ")),e=c?{iss:this.email,sub:this.email,scope:c,exp:l,iat:k}:{iss:this.email,sub:this.email,aud:a,exp:l,iat:k},b){for(let a in e)if(b[a])throw Error(`The '${a}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let m=this.keyId?{...f,kid:this.keyId}:f,n=Object.assign(e,b),o=d.sign({header:m,payload:n,secret:this.key}),p=new Headers({authorization:`Bearer ${o}`});return this.cache.set(h,{expiration:1e3*l,headers:p}),p}static getExpirationTime(a){return a+3600}fromJSON(a){if(!a)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!a.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!a.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=a.client_email,this.key=a.private_key,this.keyId=a.private_key_id,this.projectId=a.project_id}fromStream(a,b){if(!b)return this.fromStreamAsync(a);this.fromStreamAsync(a).then(()=>b(),b)}fromStreamAsync(a){return new Promise((b,c)=>{a||c(Error("Must pass in a stream containing the service account auth settings."));let d="";a.setEncoding("utf8").on("data",a=>d+=a).on("error",c).on("end",()=>{try{let a=JSON.parse(d);this.fromJSON(a),b()}catch(a){c(a)}})})}}c.JWTAccess=g},283205,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.JWT=void 0;let d=a.r(712064),e=a.r(845155),f=a.r(397033),g=a.r(69405);class h extends f.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(a={}){super(a),this.email=a.email,this.keyFile=a.keyFile,this.key=a.key,this.keyId=a.keyId,this.scopes=a.scopes,this.subject=a.subject,this.additionalClaims=a.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(a){let b=new h(this);return b.scopes=a,b}async getRequestMetadataAsync(a){a=this.defaultServicePath?`https://${this.defaultServicePath}/`:a;let b=!this.hasUserScopes()&&a||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==g.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==g.DEFAULT_UNIVERSE)throw RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${g.DEFAULT_UNIVERSE}`);if(!this.apiKey&&b)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:a}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${a.id_token}`}))}}else{let b;this.access||(this.access=new e.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis)),this.hasUserScopes()?b=this.scopes:a||(b=this.defaultScopes);let c=this.useJWTAccessWithScope||this.universeDomain!==g.DEFAULT_UNIVERSE,d=await this.access.getRequestHeaders(a??void 0,this.additionalClaims,c?b:void 0);return{headers:this.addSharedMetadataHeaders(d)}}return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(a):{headers:new Headers}}async fetchIdToken(a){let b=new d.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:a},transporter:this.transporter});if(await b.getToken({forceRefresh:!0}),!b.idToken)throw Error("Unknown error: Failed to fetch ID token");return b.idToken}hasUserScopes(){return!!this.scopes&&this.scopes.length>0}hasAnyScopes(){return!!this.scopes&&!!(this.scopes.length>0)||!!this.defaultScopes&&!!(this.defaultScopes.length>0)}authorize(a){if(!a)return this.authorizeAsync();this.authorizeAsync().then(b=>a(null,b),a)}async authorizeAsync(){let a=await this.refreshToken();if(!a)throw Error("No result returned");return this.credentials=a.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,a.tokens}async refreshTokenNoCache(){let a=this.createGToken(),b={access_token:(await a.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:a.expiresAt,id_token:a.idToken};return this.emit("tokens",b),{res:null,tokens:b}}createGToken(){return this.gtoken||(this.gtoken=new d.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(a){if(!a)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!a.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!a.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=a.client_email,this.key=a.private_key,this.keyId=a.private_key_id,this.projectId=a.project_id,this.quotaProjectId=a.quota_project_id,this.universeDomain=a.universe_domain||this.universeDomain}fromStream(a,b){if(!b)return this.fromStreamAsync(a);this.fromStreamAsync(a).then(()=>b(),b)}fromStreamAsync(a){return new Promise((b,c)=>{if(!a)throw Error("Must pass in a stream containing the service account auth settings.");let d="";a.setEncoding("utf8").on("error",c).on("data",a=>d+=a).on("end",()=>{try{let a=JSON.parse(d);this.fromJSON(a),b()}catch(a){c(a)}})})}fromAPIKey(a){if("string"!=typeof a)throw Error("Must provide an API Key string.");this.apiKey=a}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let a=this.createGToken(),b=await a.getCredentials(this.keyFile);return{private_key:b.privateKey,client_email:b.clientEmail}}throw Error("A key or a keyFile must be provided to getCredentials.")}}c.JWT=h},92007,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.UserRefreshClient=c.USER_REFRESH_ACCOUNT_TYPE=void 0;let d=a.r(397033),e=a.r(69405);c.USER_REFRESH_ACCOUNT_TYPE="authorized_user";class f extends d.OAuth2Client{_refreshToken;constructor(a,b,c,d,e){const f=a&&"object"==typeof a?a:{clientId:a,clientSecret:b,refreshToken:c,eagerRefreshThresholdMillis:d,forceRefreshOnFailure:e};super(f),this._refreshToken=f.refreshToken,this.credentials.refresh_token=f.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(a){let b={...f.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:a})};return e.AuthClient.setMethodName(b,"fetchIdToken"),(await this.transporter.request(b)).data.id_token}fromJSON(a){if(!a)throw Error("Must pass in a JSON object containing the user refresh token");if("authorized_user"!==a.type)throw Error('The incoming JSON object does not have the "authorized_user" type');if(!a.client_id)throw Error("The incoming JSON object does not contain a client_id field");if(!a.client_secret)throw Error("The incoming JSON object does not contain a client_secret field");if(!a.refresh_token)throw Error("The incoming JSON object does not contain a refresh_token field");this._clientId=a.client_id,this._clientSecret=a.client_secret,this._refreshToken=a.refresh_token,this.credentials.refresh_token=a.refresh_token,this.quotaProjectId=a.quota_project_id,this.universeDomain=a.universe_domain||this.universeDomain}fromStream(a,b){if(!b)return this.fromStreamAsync(a);this.fromStreamAsync(a).then(()=>b(),b)}async fromStreamAsync(a){return new Promise((b,c)=>{if(!a)return c(Error("Must pass in a stream containing the user refresh token."));let d="";a.setEncoding("utf8").on("error",c).on("data",a=>d+=a).on("end",()=>{try{let a=JSON.parse(d);return this.fromJSON(a),b()}catch(a){return c(a)}})})}static fromJSON(a){let b=new f;return b.fromJSON(a),b}}c.UserRefreshClient=f},949901,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Impersonated=c.IMPERSONATED_ACCOUNT_TYPE=void 0;let d=a.r(397033),e=a.r(96857),f=a.r(661845);c.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";class g extends d.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(a={}){if(super(a),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=a.sourceClient??new d.OAuth2Client,this.targetPrincipal=a.targetPrincipal??"",this.delegates=a.delegates??[],this.targetScopes=a.targetScopes??[],this.lifetime=a.lifetime??3600,(0,f.originalOrCamelOptions)(a).get("universe_domain")){if(this.sourceClient.universeDomain!==this.universeDomain)throw RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`)}else this.universeDomain=this.sourceClient.universeDomain;this.endpoint=a.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(a){await this.sourceClient.getAccessToken();let b=`projects/-/serviceAccounts/${this.targetPrincipal}`,c=`${this.endpoint}/v1/${b}:signBlob`,d={delegates:this.delegates,payload:Buffer.from(a).toString("base64")};return(await this.sourceClient.request({...g.RETRY_CONFIG,url:c,data:d,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let a="projects/-/serviceAccounts/"+this.targetPrincipal,b=`${this.endpoint}/v1/${a}:generateAccessToken`,c={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},d=await this.sourceClient.request({...g.RETRY_CONFIG,url:b,data:c,method:"POST"}),e=d.data;return this.credentials.access_token=e.accessToken,this.credentials.expiry_date=Date.parse(e.expireTime),{tokens:this.credentials,res:d}}catch(c){if(!(c instanceof Error))throw c;let a=0,b="";if(c instanceof e.GaxiosError&&(a=c?.response?.data?.error?.status,b=c?.response?.data?.error?.message),a&&b)throw c.message=`${a}: unable to impersonate: ${b}`,c;throw c.message=`unable to impersonate: ${c}`,c}}async fetchIdToken(a,b){await this.sourceClient.getAccessToken();let c=`projects/-/serviceAccounts/${this.targetPrincipal}`,d=`${this.endpoint}/v1/${c}:generateIdToken`,e={delegates:this.delegates,audience:a,includeEmail:b?.includeEmail??!0,useEmailAzp:b?.includeEmail??!0};return(await this.sourceClient.request({...g.RETRY_CONFIG,url:d,data:e,method:"POST"})).data.token}}c.Impersonated=g},901650,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.OAuthClientAuthHandler=void 0,c.getErrorFromOAuthErrorResponse=function(a,b){let c=a.error,d=a.error_description,e=a.error_uri,f=`Error code ${c}`;void 0!==d&&(f+=`: ${d}`),void 0!==e&&(f+=` - ${e}`);let g=Error(f);if(b){let a=Object.keys(b);b.stack&&a.push("stack"),a.forEach(a=>{"message"!==a&&Object.defineProperty(g,a,{value:b[a],writable:!1,enumerable:!0})})}return g};let d=a.r(96857),e=a.r(475638),f=["PUT","POST","PATCH"];class g{#m=(0,e.createCrypto)();#n;transporter;constructor(a){a&&"clientId"in a?(this.#n=a,this.transporter=new d.Gaxios):(this.#n=a?.clientAuthentication,this.transporter=a?.transporter||new d.Gaxios)}applyClientAuthenticationOptions(a,b){a.headers=d.Gaxios.mergeHeaders(a.headers),this.injectAuthenticatedHeaders(a,b),b||this.injectAuthenticatedRequestBody(a)}injectAuthenticatedHeaders(a,b){if(b)a.headers=d.Gaxios.mergeHeaders(a.headers,{authorization:`Bearer ${b}`});else if(this.#n?.confidentialClientType==="basic"){a.headers=d.Gaxios.mergeHeaders(a.headers);let b=this.#n.clientId,c=this.#n.clientSecret||"",e=this.#m.encodeBase64StringUtf8(`${b}:${c}`);d.Gaxios.mergeHeaders(a.headers,{authorization:`Basic ${e}`})}}injectAuthenticatedRequestBody(a){if(this.#n?.confidentialClientType==="request-body"){let b=(a.method||"GET").toUpperCase();if(!f.includes(b))throw Error(`${b} HTTP method does not support ${this.#n.confidentialClientType} client authentication`);let c=new Headers(a.headers).get("content-type");if(c?.startsWith("application/x-www-form-urlencoded")||a.data instanceof URLSearchParams){let b=new URLSearchParams(a.data??"");b.append("client_id",this.#n.clientId),b.append("client_secret",this.#n.clientSecret||""),a.data=b}else if(c?.startsWith("application/json"))a.data=a.data||{},Object.assign(a.data,{client_id:this.#n.clientId,client_secret:this.#n.clientSecret||""});else throw Error(`${c} content-types are not supported with ${this.#n.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}c.OAuthClientAuthHandler=g},345492,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.StsCredentials=void 0;let d=a.r(96857),e=a.r(69405),f=a.r(901650),g=a.r(661845);class h extends f.OAuthClientAuthHandler{#o;constructor(a={tokenExchangeEndpoint:""},b){("object"!=typeof a||a instanceof URL)&&(a={tokenExchangeEndpoint:a,clientAuthentication:b}),super(a),this.#o=a.tokenExchangeEndpoint}async exchangeToken(a,b,c){let i={grant_type:a.grantType,resource:a.resource,audience:a.audience,scope:a.scope?.join(" "),requested_token_type:a.requestedTokenType,subject_token:a.subjectToken,subject_token_type:a.subjectTokenType,actor_token:a.actingParty?.actorToken,actor_token_type:a.actingParty?.actorTokenType,options:c&&JSON.stringify(c)},j={...h.RETRY_CONFIG,url:this.#o.toString(),method:"POST",headers:b,data:new URLSearchParams((0,g.removeUndefinedValuesInObject)(i))};e.AuthClient.setMethodName(j,"exchangeToken"),this.applyClientAuthenticationOptions(j);try{let a=await this.transporter.request(j),b=a.data;return b.res=a,b}catch(a){if(a instanceof d.GaxiosError&&a.response)throw(0,f.getErrorFromOAuthErrorResponse)(a.response.data,a);throw a}}}c.StsCredentials=h},842680,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseExternalAccountClient=c.CLOUD_RESOURCE_MANAGER=c.EXTERNAL_ACCOUNT_TYPE=c.EXPIRATION_TIME_OFFSET=void 0;let d=a.r(96857),e=a.r(688947),f=a.r(69405),g=a.r(345492),h=a.r(661845),i=a.r(559222),j="https://www.googleapis.com/auth/cloud-platform";c.EXPIRATION_TIME_OFFSET=3e5,c.EXTERNAL_ACCOUNT_TYPE="external_account",c.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";class k extends f.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#p=null;constructor(a){super(a);const b=(0,h.originalOrCamelOptions)(a),d=b.get("type");if(d&&d!==c.EXTERNAL_ACCOUNT_TYPE)throw Error(`Expected "${c.EXTERNAL_ACCOUNT_TYPE}" type but received "${a.type}"`);const e=b.get("client_id"),f=b.get("client_secret");this.tokenUrl=b.get("token_url")??"https://sts.{universeDomain}/v1/token".replace("{universeDomain}",this.universeDomain);const i=b.get("subject_token_type"),k=b.get("workforce_pool_user_project"),l=b.get("service_account_impersonation_url"),m=b.get("service_account_impersonation"),n=(0,h.originalOrCamelOptions)(m).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(b.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),e&&(this.clientAuth={confidentialClientType:"basic",clientId:e,clientSecret:f}),this.stsCredential=new g.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=b.get("scopes")||[j],this.cachedAccessToken=null,this.audience=b.get("audience"),this.subjectTokenType=i,this.workforcePoolUserProject=k;const o=RegExp("//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+");if(this.workforcePoolUserProject&&!this.audience.match(o))throw Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=l,this.serviceAccountImpersonationLifetime=n,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=3600),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let a=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return a?.groups?.email||null}return null}setCredentials(a){super.setCredentials(a),this.cachedAccessToken=a}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let a=await this.getAccessToken(),b=new Headers({authorization:`Bearer ${a.token}`});return this.addSharedMetadataHeaders(b)}request(a,b){if(!b)return this.requestAsync(a);this.requestAsync(a).then(a=>b(null,a),a=>b(a,a.response))}async getProjectId(){let a=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(a){let b=await this.getRequestHeaders(),c={...k.RETRY_CONFIG,headers:b,url:`${this.cloudResourceManagerURL.toString()}${a}`};f.AuthClient.setMethodName(c,"getProjectId");let d=await this.transporter.request(c);return this.projectId=d.data.projectId,this.projectId}return null}async requestAsync(a,b=!1){let c;try{let b=await this.getRequestHeaders();a.headers=d.Gaxios.mergeHeaders(a.headers),this.addUserProjectAndAuthHeaders(a.headers,b),c=await this.transporter.request(a)}catch(d){let c=d.response;if(c){let d=c.status,f=c.config.data instanceof e.Readable;if(!b&&(401===d||403===d)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(a,!0)}throw d}return c}async refreshAccessTokenAsync(){this.#p=this.#p||this.#q();try{return await this.#p}finally{this.#p=null}}async #q(){let a=await this.retrieveSubjectToken(),b={grantType:"urn:ietf:params:oauth:grant-type:token-exchange",audience:this.audience,requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:a,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[j]:this.getScopesArray()},c=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,d=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),e=await this.stsCredential.exchangeToken(b,d,c);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(e.access_token):e.expires_in?this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+1e3*e.expires_in,res:e.res}:this.cachedAccessToken={access_token:e.access_token,res:e.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(a){let b=a.match(/\/projects\/([^/]+)/);return b?b[1]:null}async getImpersonatedAccessToken(a){let b={...k.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${a}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};f.AuthClient.setMethodName(b,"getImpersonatedAccessToken");let c=await this.transporter.request(b),d=c.data;return{access_token:d.accessToken,expiry_date:new Date(d.expireTime).getTime(),res:c}}isExpired(a){let b=new Date().getTime();return!!a.expiry_date&&b>=a.expiry_date-this.eagerRefreshThresholdMillis}getScopesArray(){return"string"==typeof this.scopes?[this.scopes]:this.scopes||[j]}getMetricsHeaderValue(){let a=process.version.replace(/^v/,""),b=void 0!==this.serviceAccountImpersonationUrl,c=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${a} auth/${i.pkg.version} google-byoid-sdk source/${c} sa-impersonation/${b} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}}c.BaseExternalAccountClient=k},514513,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.FileSubjectTokenSupplier=void 0;let d=a.r(224361),e=a.r(522734),f=(0,d.promisify)(e.readFile??(()=>{})),g=(0,d.promisify)(e.realpath??(()=>{})),h=(0,d.promisify)(e.lstat??(()=>{}));c.FileSubjectTokenSupplier=class{filePath;formatType;subjectTokenFieldName;constructor(a){this.filePath=a.filePath,this.formatType=a.formatType,this.subjectTokenFieldName=a.subjectTokenFieldName}async getSubjectToken(){let a,b=this.filePath;try{if(b=await g(b),!(await h(b)).isFile())throw Error()}catch(a){throw a instanceof Error&&(a.message=`The file at ${b} does not exist, or it is not a file. ${a.message}`),a}let c=await f(b,{encoding:"utf8"});if("text"===this.formatType?a=c:"json"===this.formatType&&this.subjectTokenFieldName&&(a=JSON.parse(c)[this.subjectTokenFieldName]),!a)throw Error("Unable to parse the subject_token from the credential_source file");return a}}},870470,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.UrlSubjectTokenSupplier=void 0;let d=a.r(69405);c.UrlSubjectTokenSupplier=class{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(a){this.url=a.url,this.formatType=a.formatType,this.subjectTokenFieldName=a.subjectTokenFieldName,this.headers=a.headers,this.additionalGaxiosOptions=a.additionalGaxiosOptions}async getSubjectToken(a){let b,c={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};if(d.AuthClient.setMethodName(c,"getSubjectToken"),"text"===this.formatType?b=(await a.transporter.request(c)).data:"json"===this.formatType&&this.subjectTokenFieldName&&(b=(await a.transporter.request(c)).data[this.subjectTokenFieldName]),!b)throw Error("Unable to parse the subject_token from the credential_source URL");return b}}},585225,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CertificateSubjectTokenSupplier=c.InvalidConfigurationError=c.CertificateSourceUnavailableError=c.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;let d=a.r(661845),e=a.r(522734),f=a.r(254799),g=a.r(524836);c.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";class h extends Error{constructor(a){super(a),this.name="CertificateSourceUnavailableError"}}c.CertificateSourceUnavailableError=h;class i extends Error{constructor(a){super(a),this.name="InvalidConfigurationError"}}c.InvalidConfigurationError=i,c.CertificateSubjectTokenSupplier=class{certificateConfigPath;trustChainPath;cert;key;constructor(a){if(!a.useDefaultCertificateConfig&&!a.certificateConfigLocation)throw new i("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(a.useDefaultCertificateConfig&&a.certificateConfigLocation)throw new i("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=a.trustChainPath,this.certificateConfigPath=a.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new i("Cannot create mTLS Agent with missing certificate or key");return new g.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#r();let{certPath:a,keyPath:b}=await this.#s();return{cert:this.cert,key:this.key}=await this.#t(a,b),await this.#u(this.cert)}async #r(){let a=this.certificateConfigPath;if(a){if(await (0,d.isValidFile)(a))return a;throw new h(`Provided certificate config path is invalid: ${a}`)}let b=process.env[c.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(b){if(await (0,d.isValidFile)(b))return b;throw new h(`Path from environment variable "${c.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${b}`)}let e=(0,d.getWellKnownCertificateConfigFileLocation)();if(await (0,d.isValidFile)(e))return e;throw new h(`Could not find certificate configuration file. Searched override path, the "${c.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${e}).`)}async #s(){let a,b=this.certificateConfigPath;try{a=await e.promises.readFile(b,"utf8")}catch(a){throw new h(`Failed to read certificate config file at: ${b}`)}try{let c=JSON.parse(a),d=c?.cert_configs?.workload?.cert_path,e=c?.cert_configs?.workload?.key_path;if(!d||!e)throw new i(`Certificate config file (${b}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:d,keyPath:e}}catch(a){if(a instanceof i)throw a;throw new i(`Failed to parse certificate config from ${b}: ${a.message}`)}}async #t(a,b){let c,d;try{c=await e.promises.readFile(a),new f.X509Certificate(c)}catch(c){let b=c instanceof Error?c.message:String(c);throw new h(`Failed to read certificate file at ${a}: ${b}`)}try{d=await e.promises.readFile(b),(0,f.createPrivateKey)(d)}catch(c){let a=c instanceof Error?c.message:String(c);throw new h(`Failed to read private key file at ${b}: ${a}`)}return{cert:c,key:d}}async #u(a){let b=new f.X509Certificate(a);if(!this.trustChainPath)return JSON.stringify([b.raw.toString("base64")]);try{let a,c=((await e.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((a,b)=>{try{return new f.X509Certificate(a)}catch(c){let a=c instanceof Error?c.message:String(c);throw new i(`Failed to parse certificate at index ${b} in trust chain file ${this.trustChainPath}: ${a}`)}}),d=c.findIndex(a=>b.raw.equals(a.raw));if(-1===d)a=[b,...c];else if(0===d)a=c;else throw new i(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${d}).`);return JSON.stringify(a.map(a=>a.raw.toString("base64")))}catch(b){if(b instanceof i)throw b;let a=b instanceof Error?b.message:String(b);throw new h(`Failed to process certificate chain from ${this.trustChainPath}: ${a}`)}}}},998207,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.IdentityPoolClient=void 0;let d=a.r(842680),e=a.r(661845),f=a.r(514513),g=a.r(870470),h=a.r(585225),i=a.r(345492),j=a.r(96857);class k extends d.BaseExternalAccountClient{subjectTokenSupplier;constructor(a){super(a);const b=(0,e.originalOrCamelOptions)(a),c=b.get("credential_source"),d=b.get("subject_token_supplier");if(!c&&!d)throw Error("A credential source or subject token supplier must be specified.");if(c&&d)throw Error("Only one of credential source or subject token supplier can be specified.");if(d)this.subjectTokenSupplier=d,this.credentialSourceType="programmatic";else{const a=(0,e.originalOrCamelOptions)(c),b=(0,e.originalOrCamelOptions)(a.get("format")),d=b.get("type")||"text",i=b.get("subject_token_field_name");if("json"!==d&&"text"!==d)throw Error(`Invalid credential_source format "${d}"`);if("json"===d&&!i)throw Error("Missing subject_token_field_name for JSON credential_source format");const j=a.get("file"),l=a.get("url"),m=a.get("certificate"),n=a.get("headers");if(j&&l||l&&m||j&&m)throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(j)this.credentialSourceType="file",this.subjectTokenSupplier=new f.FileSubjectTokenSupplier({filePath:j,formatType:d,subjectTokenFieldName:i});else if(l)this.credentialSourceType="url",this.subjectTokenSupplier=new g.UrlSubjectTokenSupplier({url:l,formatType:d,subjectTokenFieldName:i,headers:n,additionalGaxiosOptions:k.RETRY_CONFIG});else if(m){this.credentialSourceType="certificate";const a=new h.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:m.use_default_certificate_config,certificateConfigLocation:m.certificate_config_location,trustChainPath:m.trust_chain_path});this.subjectTokenSupplier=a}else throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let a=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof h.CertificateSubjectTokenSupplier){let a=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new i.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new j.Gaxios({agent:a})}),this.transporter=new j.Gaxios({...this.transporter.defaults||{},agent:a})}return a}}c.IdentityPoolClient=k},575559,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.AwsRequestSigner=void 0;let d=a.r(96857),e=a.r(475638),f="AWS4-HMAC-SHA256";async function g(a,b,c){return await a.signWithHmacSha256(b,c)}async function h(a,b,c,d,e){let f=await g(a,`AWS4${b}`,c),h=await g(a,f,d),i=await g(a,h,e);return await g(a,i,"aws4_request")}async function i(a){let b=d.Gaxios.mergeHeaders(a.additionalAmzHeaders),c=a.requestPayload||"",i=a.host.split(".")[0],j=new Date,k=j.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),l=j.toISOString().replace(/[-]/g,"").replace(/T.*/,"");a.securityCredentials.token&&b.set("x-amz-security-token",a.securityCredentials.token);let m=d.Gaxios.mergeHeaders({host:a.host},b.has("date")?{}:{"x-amz-date":k},b),n="",o=[...m.keys()].sort();o.forEach(a=>{n+=`${a}:${m.get(a)}
`});let p=o.join(";"),q=await a.crypto.sha256DigestHex(c),r=`${a.method.toUpperCase()}
${a.canonicalUri}
${a.canonicalQuerystring}
${n}
${p}
${q}`,s=`${l}/${a.region}/${i}/aws4_request`,t=`${f}
${k}
${s}
`+await a.crypto.sha256DigestHex(r),u=await h(a.crypto,a.securityCredentials.secretAccessKey,l,a.region,i),v=await g(a.crypto,u,t),w=`${f} Credential=${a.securityCredentials.accessKeyId}/${s}, SignedHeaders=${p}, Signature=${(0,e.fromArrayBufferToHex)(v)}`;return{amzDate:b.has("date")?void 0:k,authorizationHeader:w,canonicalQuerystring:a.canonicalQuerystring}}c.AwsRequestSigner=class{getCredentials;region;crypto;constructor(a,b){this.getCredentials=a,this.region=b,this.crypto=(0,e.createCrypto)()}async getRequestOptions(a){if(!a.url)throw RangeError('"url" is required in "amzOptions"');let b="object"==typeof a.data?JSON.stringify(a.data):a.data,c=a.url,e=a.method||"GET",f=a.body||b,g=a.headers,h=await this.getCredentials(),j=new URL(c);if("string"!=typeof f&&void 0!==f)throw TypeError(`'requestPayload' is expected to be a string if provided. Got: ${f}`);let k=await i({crypto:this.crypto,host:j.host,canonicalUri:j.pathname,canonicalQuerystring:j.search.slice(1),method:e,region:this.region,securityCredentials:h,requestPayload:f,additionalAmzHeaders:g}),l=d.Gaxios.mergeHeaders(k.amzDate?{"x-amz-date":k.amzDate}:{},{authorization:k.authorizationHeader,host:j.host},g||{});h.token&&d.Gaxios.mergeHeaders(l,{"x-amz-security-token":h.token});let m={url:c,method:e,headers:l};return void 0!==f&&(m.body=f),m}}},366305,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.DefaultAwsSecurityCredentialsSupplier=void 0;let d=a.r(69405);c.DefaultAwsSecurityCredentialsSupplier=class{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(a){this.regionUrl=a.regionUrl,this.securityCredentialsUrl=a.securityCredentialsUrl,this.imdsV2SessionTokenUrl=a.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=a.additionalGaxiosOptions}async getAwsRegion(a){if(this.#v)return this.#v;let b=new Headers;if(!this.#v&&this.imdsV2SessionTokenUrl&&b.set("x-aws-ec2-metadata-token",await this.#w(a.transporter)),!this.regionUrl)throw RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let c={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:b};d.AuthClient.setMethodName(c,"getAwsRegion");let e=await a.transporter.request(c);return e.data.substr(0,e.data.length-1)}async getAwsSecurityCredentials(a){if(this.#x)return this.#x;let b=new Headers;this.imdsV2SessionTokenUrl&&b.set("x-aws-ec2-metadata-token",await this.#w(a.transporter));let c=await this.#y(b,a.transporter),d=await this.#z(c,b,a.transporter);return{accessKeyId:d.AccessKeyId,secretAccessKey:d.SecretAccessKey,token:d.Token}}async #w(a){let b={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return d.AuthClient.setMethodName(b,"#getImdsV2SessionToken"),(await a.request(b)).data}async #y(a,b){if(!this.securityCredentialsUrl)throw Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let c={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:a};return d.AuthClient.setMethodName(c,"#getAwsRoleName"),(await b.request(c)).data}async #z(a,b,c){let e={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${a}`,headers:b};return d.AuthClient.setMethodName(e,"#retrieveAwsSecurityCredentials"),(await c.request(e)).data}get #v(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get #x(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}}},725722,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.AwsClient=void 0;let d=a.r(575559),e=a.r(842680),f=a.r(366305),g=a.r(661845),h=a.r(96857);class i extends e.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static #A="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(a){super(a);const b=(0,g.originalOrCamelOptions)(a),c=b.get("credential_source"),d=b.get("aws_security_credentials_supplier");if(!c&&!d)throw Error("A credential source or AWS security credentials supplier must be specified.");if(c&&d)throw Error("Only one of credential source or AWS security credentials supplier can be specified.");if(d)this.awsSecurityCredentialsSupplier=d,this.regionalCredVerificationUrl=i.#A,this.credentialSourceType="programmatic";else{const a=(0,g.originalOrCamelOptions)(c);this.environmentId=a.get("environment_id");const b=a.get("region_url"),d=a.get("url"),e=a.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new f.DefaultAwsSecurityCredentialsSupplier({regionUrl:b,securityCredentialsUrl:d,imdsV2SessionTokenUrl:e}),this.regionalCredVerificationUrl=a.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let a=this.environmentId?.match(/^(aws)(\d+)$/);if(a&&this.regionalCredVerificationUrl){if(1!==parseInt(a[2],10))throw Error(`aws version "${a[2]}" is not supported in the current build.`)}else throw Error('No valid AWS "credential_source" provided')}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new d.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let a=await this.awsRequestSigner.getRequestOptions({...i.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),b=[];return h.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},a.headers).forEach((a,c)=>b.push({key:c,value:a})),encodeURIComponent(JSON.stringify({url:a.url,method:a.method,headers:b}))}}c.AwsClient=i},691168,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InvalidSubjectTokenError=c.InvalidMessageFieldError=c.InvalidCodeFieldError=c.InvalidTokenTypeFieldError=c.InvalidExpirationTimeFieldError=c.InvalidSuccessFieldError=c.InvalidVersionFieldError=c.ExecutableResponseError=c.ExecutableResponse=void 0;let d="urn:ietf:params:oauth:token-type:saml2",e="urn:ietf:params:oauth:token-type:id_token",f="urn:ietf:params:oauth:token-type:jwt";c.ExecutableResponse=class{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(a){if(!a.version)throw new h("Executable response must contain a 'version' field.");if(void 0===a.success)throw new i("Executable response must contain a 'success' field.");if(this.version=a.version,this.success=a.success,this.success){if(this.expirationTime=a.expiration_time,this.tokenType=a.token_type,this.tokenType!==d&&this.tokenType!==e&&this.tokenType!==f)throw new j(`Executable response must contain a 'token_type' field when successful and it must be one of ${e}, ${f}, or ${d}.`);if(this.tokenType===d){if(!a.saml_response)throw new m(`Executable response must contain a 'saml_response' field when token_type=${d}.`);this.subjectToken=a.saml_response}else{if(!a.id_token)throw new m(`Executable response must contain a 'id_token' field when token_type=${e} or ${f}.`);this.subjectToken=a.id_token}}else{if(!a.code)throw new k("Executable response must contain a 'code' field when unsuccessful.");if(!a.message)throw new l("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=a.code,this.errorMessage=a.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return void 0!==this.expirationTime&&this.expirationTime<Math.round(Date.now()/1e3)}};class g extends Error{constructor(a){super(a),Object.setPrototypeOf(this,new.target.prototype)}}c.ExecutableResponseError=g;class h extends g{}c.InvalidVersionFieldError=h;class i extends g{}c.InvalidSuccessFieldError=i,c.InvalidExpirationTimeFieldError=class extends g{};class j extends g{}c.InvalidTokenTypeFieldError=j;class k extends g{}c.InvalidCodeFieldError=k;class l extends g{}c.InvalidMessageFieldError=l;class m extends g{}c.InvalidSubjectTokenError=m},549,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.PluggableAuthHandler=c.ExecutableError=void 0;let d=a.r(691168),e=a.r(233405),f=a.r(522734);class g extends Error{code;constructor(a,b){super(`The executable failed with exit code: ${b} and error message: ${a}.`),this.code=b,Object.setPrototypeOf(this,new.target.prototype)}}c.ExecutableError=g;class h{commandComponents;timeoutMillis;outputFile;constructor(a){if(!a.command)throw Error("No command provided.");if(this.commandComponents=h.parseCommand(a.command),this.timeoutMillis=a.timeoutMillis,!this.timeoutMillis)throw Error("No timeoutMillis provided.");this.outputFile=a.outputFile}retrieveResponseFromExecutable(a){return new Promise((b,c)=>{let f=e.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(a)}}),h="";f.stdout.on("data",a=>{h+=a}),f.stderr.on("data",a=>{h+=a});let i=setTimeout(()=>(f.removeAllListeners(),f.kill(),c(Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);f.on("close",a=>{if(clearTimeout(i),0!==a)return c(new g(h,a.toString()));try{let a=JSON.parse(h),c=new d.ExecutableResponse(a);return b(c)}catch(a){if(a instanceof d.ExecutableResponseError)return c(a);return c(new d.ExecutableResponseError(`The executable returned an invalid response: ${h}`))}})})}async retrieveCachedResponse(){let a;if(!this.outputFile||0===this.outputFile.length)return;try{a=await f.promises.realpath(this.outputFile)}catch{return}if(!(await f.promises.lstat(a)).isFile())return;let b=await f.promises.readFile(a,{encoding:"utf8"});if(""!==b)try{let a=JSON.parse(b);if(new d.ExecutableResponse(a).isValid())return new d.ExecutableResponse(a);return}catch(a){if(a instanceof d.ExecutableResponseError)throw a;throw new d.ExecutableResponseError(`The output file contained an invalid response: ${b}`)}}static parseCommand(a){let b=a.match(/(?:[^\s"]+|"[^"]*")+/g);if(!b)throw Error(`Provided command: "${a}" could not be parsed.`);for(let a=0;a<b.length;a++)'"'===b[a][0]&&'"'===b[a].slice(-1)&&(b[a]=b[a].slice(1,-1));return b}}c.PluggableAuthHandler=h},605314,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.PluggableAuthClient=c.ExecutableError=void 0;let d=a.r(842680),e=a.r(691168),f=a.r(549);var g=a.r(549);Object.defineProperty(c,"ExecutableError",{enumerable:!0,get:function(){return g.ExecutableError}});class h extends d.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(a){if(super(a),!a.credential_source.executable||(this.command=a.credential_source.executable.command,!this.command))throw Error('No valid Pluggable Auth "credential_source" provided.');if(void 0===a.credential_source.executable.timeout_millis)this.timeoutMillis=3e4;else if(this.timeoutMillis=a.credential_source.executable.timeout_millis,this.timeoutMillis<5e3||this.timeoutMillis>12e4)throw Error("Timeout must be between 5000120000 milliseconds.");this.outputFile=a.credential_source.executable.output_file,this.handler=new f.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){let a;if("1"!==process.env.GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES)throw Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");if(this.outputFile&&(a=await this.handler.retrieveCachedResponse()),!a){let b=new Map;b.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),b.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),b.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&b.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let c=this.getServiceAccountEmail();c&&b.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",c),a=await this.handler.retrieveResponseFromExecutable(b)}if(a.version>1)throw Error("Version of executable is not currently supported, maximum supported version is 1.");if(!a.success)throw new f.ExecutableError(a.errorMessage,a.errorCode);if(this.outputFile&&!a.expirationTime)throw new e.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(a.isExpired())throw Error("Executable response is expired.");return a.subjectToken}}c.PluggableAuthClient=h},22415,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ExternalAccountClient=void 0;let d=a.r(842680),e=a.r(998207),f=a.r(725722),g=a.r(605314);c.ExternalAccountClient=class{constructor(){throw Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(a){return a&&a.type===d.EXTERNAL_ACCOUNT_TYPE?a.credential_source?.environment_id?new f.AwsClient(a):a.credential_source?.executable?new g.PluggableAuthClient(a):new e.IdentityPoolClient(a):null}}},910390,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ExternalAccountAuthorizedUserClient=c.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;let d=a.r(69405),e=a.r(901650),f=a.r(96857),g=a.r(688947),h=a.r(842680);c.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";class i extends e.OAuthClientAuthHandler{#B;constructor(a){super(a),this.#B=a.tokenRefreshEndpoint}async refreshToken(a,b){let c={...i.RETRY_CONFIG,url:this.#B,method:"POST",headers:b,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:a})};d.AuthClient.setMethodName(c,"refreshToken"),this.applyClientAuthenticationOptions(c);try{let a=await this.transporter.request(c),b=a.data;return b.res=a,b}catch(a){if(a instanceof f.GaxiosError&&a.response)throw(0,e.getErrorFromOAuthErrorResponse)(a.response.data,a);throw a}}}class j extends d.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(a){super(a),a.universe_domain&&(this.universeDomain=a.universe_domain),this.refreshToken=a.refresh_token;const b={confidentialClientType:"basic",clientId:a.client_id,clientSecret:a.client_secret};this.externalAccountAuthorizedUserHandler=new i({tokenRefreshEndpoint:a.token_url??"https://sts.{universeDomain}/v1/oauthtoken".replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:b}),this.cachedAccessToken=null,this.quotaProjectId=a.quota_project_id,"number"!=typeof a?.eagerRefreshThresholdMillis?this.eagerRefreshThresholdMillis=h.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=a.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!a?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let a=await this.getAccessToken(),b=new Headers({authorization:`Bearer ${a.token}`});return this.addSharedMetadataHeaders(b)}request(a,b){if(!b)return this.requestAsync(a);this.requestAsync(a).then(a=>b(null,a),a=>b(a,a.response))}async requestAsync(a,b=!1){let c;try{let b=await this.getRequestHeaders();a.headers=f.Gaxios.mergeHeaders(a.headers),this.addUserProjectAndAuthHeaders(a.headers,b),c=await this.transporter.request(a)}catch(d){let c=d.response;if(c){let d=c.status,e=c.config.data instanceof g.Readable;if(!b&&(401===d||403===d)&&!e&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(a,!0)}throw d}return c}async refreshAccessTokenAsync(){let a=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:a.access_token,expiry_date:new Date().getTime()+1e3*a.expires_in,res:a.res},void 0!==a.refresh_token&&(this.refreshToken=a.refresh_token),this.cachedAccessToken}isExpired(a){let b=new Date().getTime();return!!a.expiry_date&&b>=a.expiry_date-this.eagerRefreshThresholdMillis}}c.ExternalAccountAuthorizedUserClient=j},367848,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.GoogleAuth=c.GoogleAuthExceptionMessages=void 0;let d=a.r(233405),e=a.r(522734),f=a.r(96857),g=a.r(764733),h=a.r(446786),i=a.r(814747),j=a.r(475638),k=a.r(749696),l=a.r(664364),m=a.r(999365),n=a.r(283205),o=a.r(92007),p=a.r(949901),q=a.r(22415),r=a.r(842680),s=a.r(69405),t=a.r(910390),u=a.r(661845);c.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:"Unable to detect a Project Id in the current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_CREDENTIALS_FOUND:"Unable to find credentials in current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:"Unable to detect a Universe Domain in the current environment.\nTo learn more about Universe Domain retrieval, visit: \nhttps://cloud.google.com/compute/docs/metadata/predefined-metadata-keys"},c.GoogleAuth=class{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#C=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(a={}){if(this._cachedProjectId=a.projectId||null,this.cachedCredential=a.authClient||null,this.keyFilename=a.keyFilename||a.keyFile,this.scopes=a.scopes,this.clientOptions=a.clientOptions||{},this.jsonContent=a.credentials||null,this.apiKey=a.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw RangeError(c.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);a.universeDomain&&(this.clientOptions.universeDomain=a.universeDomain)}setGapicJWTValues(a){a.defaultServicePath=this.defaultServicePath,a.useJWTAccessWithScope=this.useJWTAccessWithScope,a.defaultScopes=this.defaultScopes}getProjectId(a){if(!a)return this.getProjectIdAsync();this.getProjectIdAsync().then(b=>a(null,b),a)}async getProjectIdOptional(){try{return await this.getProjectId()}catch(a){if(a instanceof Error&&a.message===c.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw a}}async findAndCacheProjectId(){let a=null;if(a||=await this.getProductionProjectId(),a||=await this.getFileProjectId(),a||=await this.getDefaultServiceProjectId(),a||=await this.getGCEProjectId(),a||=await this.getExternalAccountClientProjectId())return this._cachedProjectId=a,a;throw Error(c.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let a;try{a=await g.universe("universe-domain"),a||=s.DEFAULT_UNIVERSE}catch(b){if(b&&b?.response?.status===404)a=s.DEFAULT_UNIVERSE;else throw b}return a}async getUniverseDomain(){let a=(0,u.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{a??=(await this.getClient()).universeDomain}catch{a??=s.DEFAULT_UNIVERSE}return a}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(a={},b){let c;if("function"==typeof a?b=a:c=a,!b)return this.getApplicationDefaultAsync(c);this.getApplicationDefaultAsync(c).then(a=>b(null,a.credential,a.projectId),b)}async getApplicationDefaultAsync(a={}){let b;if(this.cachedCredential)return await this.#D(this.cachedCredential,null);if((b=await this._tryGetApplicationCredentialsFromEnvironmentVariable(a))||(b=await this._tryGetApplicationCredentialsFromWellKnownFile(a)))return b instanceof n.JWT?b.scopes=this.scopes:b instanceof r.BaseExternalAccountClient&&(b.scopes=this.getAnyScopes()),await this.#D(b);if(await this._checkIsGCE())return a.scopes=this.getAnyScopes(),await this.#D(new k.Compute(a));throw Error(c.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async #D(a,b=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let c=await this.getProjectIdOptional();return b&&(a.quotaProjectId=b),this.cachedCredential=a,{credential:a,projectId:c}}async _checkIsGCE(){return void 0===this.checkIsGCE&&(this.checkIsGCE=g.getGCPResidency()||await g.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(a){let b=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!b||0===b.length)return null;try{return this._getApplicationCredentialsFromFilePath(b,a)}catch(a){throw a instanceof Error&&(a.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${a.message}`),a}}async _tryGetApplicationCredentialsFromWellKnownFile(a){let b=null;if(this._isWindows())b=process.env.APPDATA;else{let a=process.env.HOME;a&&(b=i.join(a,".config"))}return(b&&(b=i.join(b,"gcloud","application_default_credentials.json"),e.existsSync(b)||(b=null)),b)?await this._getApplicationCredentialsFromFilePath(b,a):null}async _getApplicationCredentialsFromFilePath(a,b={}){if(!a||0===a.length)throw Error("The file path is invalid.");try{if(a=e.realpathSync(a),!e.lstatSync(a).isFile())throw Error()}catch(b){throw b instanceof Error&&(b.message=`The file at ${a} does not exist, or it is not a file. ${b.message}`),b}let c=e.createReadStream(a);return this.fromStream(c,b)}fromImpersonatedJSON(a){if(!a)throw Error("Must pass in a JSON object containing an  impersonated refresh token");if(a.type!==p.IMPERSONATED_ACCOUNT_TYPE)throw Error(`The incoming JSON object does not have the "${p.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!a.source_credentials)throw Error("The incoming JSON object does not contain a source_credentials field");if(!a.service_account_impersonation_url)throw Error("The incoming JSON object does not contain a service_account_impersonation_url field");let b=this.fromJSON(a.source_credentials);if(a.service_account_impersonation_url?.length>256)throw RangeError(`Target principal is too long: ${a.service_account_impersonation_url}`);let c=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(a.service_account_impersonation_url)?.groups?.target;if(!c)throw RangeError(`Cannot extract target principal from ${a.service_account_impersonation_url}`);let d=(this.scopes||a.scopes||this.defaultScopes)??[];return new p.Impersonated({...a,sourceClient:b,targetPrincipal:c,targetScopes:Array.isArray(d)?d:[d]})}fromJSON(a,b={}){let c,d=(0,u.originalOrCamelOptions)(b).get("universe_domain");return a.type===o.USER_REFRESH_ACCOUNT_TYPE?(c=new o.UserRefreshClient(b)).fromJSON(a):a.type===p.IMPERSONATED_ACCOUNT_TYPE?c=this.fromImpersonatedJSON(a):a.type===r.EXTERNAL_ACCOUNT_TYPE?(c=q.ExternalAccountClient.fromJSON({...a,...b})).scopes=this.getAnyScopes():a.type===t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?c=new t.ExternalAccountAuthorizedUserClient({...a,...b}):(b.scopes=this.scopes,c=new n.JWT(b),this.setGapicJWTValues(c),c.fromJSON(a)),d&&(c.universeDomain=d),c}_cacheClientFromJSON(a,b){let c=this.fromJSON(a,b);return this.jsonContent=a,this.cachedCredential=c,c}fromStream(a,b={},c){let d={};if("function"==typeof b?c=b:d=b,!c)return this.fromStreamAsync(a,d);this.fromStreamAsync(a,d).then(a=>c(null,a),c)}fromStreamAsync(a,b){return new Promise((c,d)=>{if(!a)throw Error("Must pass in a stream containing the Google auth settings.");let e=[];a.setEncoding("utf8").on("error",d).on("data",a=>e.push(a)).on("end",()=>{try{try{let a=JSON.parse(e.join("")),d=this._cacheClientFromJSON(a,b);return c(d)}catch(b){if(!this.keyFilename)throw b;let a=new n.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=a,this.setGapicJWTValues(a),c(a)}}catch(a){return d(a)}})})}fromAPIKey(a,b={}){return new n.JWT({...b,apiKey:a})}_isWindows(){let a=h.platform();return!!a&&!!(a.length>=3)&&"win"===a.substring(0,3).toLowerCase()}async getDefaultServiceProjectId(){return new Promise(a=>{(0,d.exec)("gcloud config config-helper --format json",(b,c)=>{if(!b&&c)try{let b=JSON.parse(c).configuration.properties.core.project;a(b);return}catch(a){}a(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let a=await this.getClient();if(a&&a.projectId)return a.projectId}let a=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return a?a.projectId:null}async getExternalAccountClientProjectId(){if(!this.jsonContent||this.jsonContent.type!==r.EXTERNAL_ACCOUNT_TYPE)return null;let a=await this.getClient();return await a.getProjectId()}async getGCEProjectId(){try{return await g.project("project-id")}catch(a){return null}}getCredentials(a){if(!a)return this.getCredentialsAsync();this.getCredentialsAsync().then(b=>a(null,b),a)}async getCredentialsAsync(){let a=await this.getClient();if(a instanceof p.Impersonated)return{client_email:a.getTargetPrincipal()};if(a instanceof r.BaseExternalAccountClient){let b=a.getServiceAccountEmail();if(b)return{client_email:b,universe_domain:a.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[a,b]=await Promise.all([g.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:a,universe_domain:b}}throw Error(c.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#C=this.#C||this.#E();try{return await this.#C}finally{this.#C=null}}async #E(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let a=i.resolve(this.keyFilename),b=e.createReadStream(a);return await this.fromStreamAsync(b,this.clientOptions)}if(this.apiKey){let a=await this.fromAPIKey(this.apiKey,this.clientOptions);a.scopes=this.scopes;let{credential:b}=await this.#D(a);return b}{let{credential:a}=await this.getApplicationDefaultAsync(this.clientOptions);return a}}async getIdTokenClient(a){let b=await this.getClient();if(!("fetchIdToken"in b))throw Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new l.IdTokenClient({targetAudience:a,idTokenProvider:b})}async getAccessToken(){let a=await this.getClient();return(await a.getAccessToken()).token}async getRequestHeaders(a){return(await this.getClient()).getRequestHeaders(a)}async authorizeRequest(a={}){let b=a.url,c=await this.getClient(),d=await c.getRequestHeaders(b);return a.headers=f.Gaxios.mergeHeaders(a.headers,d),a}async fetch(...a){return(await this.getClient()).fetch(...a)}async request(a){return(await this.getClient()).request(a)}getEnv(){return(0,m.getEnv)()}async sign(a,b){let c=await this.getClient(),d=await this.getUniverseDomain();if(b=b||`https://iamcredentials.${d}/v1/projects/-/serviceAccounts/`,c instanceof p.Impersonated)return(await c.sign(a)).signedBlob;let e=(0,j.createCrypto)();if(c instanceof n.JWT&&c.key)return await e.sign(c.key,a);let f=await this.getCredentials();if(!f.client_email)throw Error("Cannot sign data without `client_email`.");return this.signBlob(e,f.client_email,a,b)}async signBlob(a,b,c,d){let e=new URL(d+`${b}:signBlob`);return(await this.request({method:"POST",url:e.href,data:{payload:a.encodeBase64StringUtf8(c)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}}},222763,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.IAMAuth=void 0,c.IAMAuth=class{selector;token;constructor(a,b){this.selector=a,this.token=b,this.selector=a,this.token=b}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}}},962361,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.DownscopedClient=c.EXPIRATION_TIME_OFFSET=c.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;let d=a.r(96857),e=a.r(688947),f=a.r(69405),g=a.r(345492);c.MAX_ACCESS_BOUNDARY_RULES_COUNT=10,c.EXPIRATION_TIME_OFFSET=3e5;class h extends f.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(a,b={accessBoundary:{accessBoundaryRules:[]}}){if(super(a instanceof f.AuthClient?{}:a),a instanceof f.AuthClient?(this.authClient=a,this.credentialAccessBoundary=b):(this.authClient=a.authClient,this.credentialAccessBoundary=a.credentialAccessBoundary),0===this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length)throw Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>c.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw Error(`The provided access boundary has more than ${c.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(const a of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(0===a.availablePermissions.length)throw Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new g.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(a){if(!a.expiry_date)throw Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(a),this.cachedDownscopedAccessToken=a}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let a=await this.getAccessToken(),b=new Headers({authorization:`Bearer ${a.token}`});return this.addSharedMetadataHeaders(b)}request(a,b){if(!b)return this.requestAsync(a);this.requestAsync(a).then(a=>b(null,a),a=>b(a,a.response))}async requestAsync(a,b=!1){let c;try{let b=await this.getRequestHeaders();a.headers=d.Gaxios.mergeHeaders(a.headers),this.addUserProjectAndAuthHeaders(a.headers,b),c=await this.transporter.request(a)}catch(d){let c=d.response;if(c){let d=c.status,f=c.config.data instanceof e.Readable;if(!b&&(401===d||403===d)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(a,!0)}throw d}return c}async refreshAccessTokenAsync(){let a=(await this.authClient.getAccessToken()).token,b=await this.stsCredential.exchangeToken({grantType:"urn:ietf:params:oauth:grant-type:token-exchange",requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:a,subjectTokenType:"urn:ietf:params:oauth:token-type:access_token"},void 0,this.credentialAccessBoundary),c=this.authClient.credentials?.expiry_date||null,d=b.expires_in?new Date().getTime()+1e3*b.expires_in:c;return this.cachedDownscopedAccessToken={access_token:b.access_token,expiry_date:d,res:b.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(a){let b=new Date().getTime();return!!a.expiry_date&&b>=a.expiry_date-this.eagerRefreshThresholdMillis}}c.DownscopedClient=h},712917,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.PassThroughClient=void 0;let d=a.r(69405);class e extends d.AuthClient{async request(a){return this.transporter.request(a)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}}c.PassThroughClient=e},974685,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.GoogleAuth=c.auth=c.PassThroughClient=c.ExternalAccountAuthorizedUserClient=c.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=c.ExecutableError=c.PluggableAuthClient=c.DownscopedClient=c.BaseExternalAccountClient=c.ExternalAccountClient=c.IdentityPoolClient=c.AwsRequestSigner=c.AwsClient=c.UserRefreshClient=c.LoginTicket=c.ClientAuthentication=c.OAuth2Client=c.CodeChallengeMethod=c.Impersonated=c.JWT=c.JWTAccess=c.IdTokenClient=c.IAMAuth=c.GCPEnv=c.Compute=c.DEFAULT_UNIVERSE=c.AuthClient=c.gaxios=c.gcpMetadata=void 0;let d=a.r(367848);Object.defineProperty(c,"GoogleAuth",{enumerable:!0,get:function(){return d.GoogleAuth}}),c.gcpMetadata=a.r(764733),c.gaxios=a.r(96857);var e=a.r(69405);Object.defineProperty(c,"AuthClient",{enumerable:!0,get:function(){return e.AuthClient}}),Object.defineProperty(c,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return e.DEFAULT_UNIVERSE}});var f=a.r(749696);Object.defineProperty(c,"Compute",{enumerable:!0,get:function(){return f.Compute}});var g=a.r(999365);Object.defineProperty(c,"GCPEnv",{enumerable:!0,get:function(){return g.GCPEnv}});var h=a.r(222763);Object.defineProperty(c,"IAMAuth",{enumerable:!0,get:function(){return h.IAMAuth}});var i=a.r(664364);Object.defineProperty(c,"IdTokenClient",{enumerable:!0,get:function(){return i.IdTokenClient}});var j=a.r(845155);Object.defineProperty(c,"JWTAccess",{enumerable:!0,get:function(){return j.JWTAccess}});var k=a.r(283205);Object.defineProperty(c,"JWT",{enumerable:!0,get:function(){return k.JWT}});var l=a.r(949901);Object.defineProperty(c,"Impersonated",{enumerable:!0,get:function(){return l.Impersonated}});var m=a.r(397033);Object.defineProperty(c,"CodeChallengeMethod",{enumerable:!0,get:function(){return m.CodeChallengeMethod}}),Object.defineProperty(c,"OAuth2Client",{enumerable:!0,get:function(){return m.OAuth2Client}}),Object.defineProperty(c,"ClientAuthentication",{enumerable:!0,get:function(){return m.ClientAuthentication}});var n=a.r(263466);Object.defineProperty(c,"LoginTicket",{enumerable:!0,get:function(){return n.LoginTicket}});var o=a.r(92007);Object.defineProperty(c,"UserRefreshClient",{enumerable:!0,get:function(){return o.UserRefreshClient}});var p=a.r(725722);Object.defineProperty(c,"AwsClient",{enumerable:!0,get:function(){return p.AwsClient}});var q=a.r(575559);Object.defineProperty(c,"AwsRequestSigner",{enumerable:!0,get:function(){return q.AwsRequestSigner}});var r=a.r(998207);Object.defineProperty(c,"IdentityPoolClient",{enumerable:!0,get:function(){return r.IdentityPoolClient}});var s=a.r(22415);Object.defineProperty(c,"ExternalAccountClient",{enumerable:!0,get:function(){return s.ExternalAccountClient}});var t=a.r(842680);Object.defineProperty(c,"BaseExternalAccountClient",{enumerable:!0,get:function(){return t.BaseExternalAccountClient}});var u=a.r(962361);Object.defineProperty(c,"DownscopedClient",{enumerable:!0,get:function(){return u.DownscopedClient}});var v=a.r(605314);Object.defineProperty(c,"PluggableAuthClient",{enumerable:!0,get:function(){return v.PluggableAuthClient}}),Object.defineProperty(c,"ExecutableError",{enumerable:!0,get:function(){return v.ExecutableError}});var w=a.r(910390);Object.defineProperty(c,"EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE",{enumerable:!0,get:function(){return w.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE}}),Object.defineProperty(c,"ExternalAccountAuthorizedUserClient",{enumerable:!0,get:function(){return w.ExternalAccountAuthorizedUserClient}});var x=a.r(712917);Object.defineProperty(c,"PassThroughClient",{enumerable:!0,get:function(){return x.PassThroughClient}}),c.auth=new d.GoogleAuth},671951,(a,b,c)=>{"use strict";let d=["nodebuffer","arraybuffer","fragments"],e="undefined"!=typeof Blob;e&&d.push("blob"),b.exports={BINARY_TYPES:d,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:e,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},569691,(a,b,c)=>{"use strict";let{EMPTY_BUFFER:d}=a.r(671951),e=Buffer[Symbol.species];function f(a,b,c,d,e){for(let f=0;f<e;f++)c[d+f]=a[f]^b[3&f]}function g(a,b){for(let c=0;c<a.length;c++)a[c]^=b[3&c]}function h(a){let b;return(h.readOnly=!0,Buffer.isBuffer(a))?a:(a instanceof ArrayBuffer?b=new e(a):ArrayBuffer.isView(a)?b=new e(a.buffer,a.byteOffset,a.byteLength):(b=Buffer.from(a),h.readOnly=!1),b)}if(b.exports={concat:function(a,b){if(0===a.length)return d;if(1===a.length)return a[0];let c=Buffer.allocUnsafe(b),f=0;for(let b=0;b<a.length;b++){let d=a[b];c.set(d,f),f+=d.length}return f<b?new e(c.buffer,c.byteOffset,f):c},mask:f,toArrayBuffer:function(a){return a.length===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.length)},toBuffer:h,unmask:g},!process.env.WS_NO_BUFFER_UTIL)try{let a=(()=>{let a=Error("Cannot find module 'bufferutil'");throw a.code="MODULE_NOT_FOUND",a})();b.exports.mask=function(b,c,d,e,g){g<48?f(b,c,d,e,g):a.mask(b,c,d,e,g)},b.exports.unmask=function(b,c){b.length<32?g(b,c):a.unmask(b,c)}}catch(a){}},284337,(a,b,c)=>{"use strict";let d=Symbol("kDone"),e=Symbol("kRun");b.exports=class{constructor(a){this[d]=()=>{this.pending--,this[e]()},this.concurrency=a||1/0,this.jobs=[],this.pending=0}add(a){this.jobs.push(a),this[e]()}[e](){if(this.pending!==this.concurrency&&this.jobs.length){let a=this.jobs.shift();this.pending++,a(this[d])}}}},308343,(a,b,c)=>{"use strict";let d,e=a.r(406461),f=a.r(569691),g=a.r(284337),{kStatusCode:h}=a.r(671951),i=Buffer[Symbol.species],j=Buffer.from([0,0,255,255]),k=Symbol("permessage-deflate"),l=Symbol("total-length"),m=Symbol("callback"),n=Symbol("buffers"),o=Symbol("error");function p(a){this[n].push(a),this[l]+=a.length}function q(a){(this[l]+=a.length,this[k]._maxPayload<1||this[l]<=this[k]._maxPayload)?this[n].push(a):(this[o]=RangeError("Max payload size exceeded"),this[o].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[o][h]=1009,this.removeListener("data",q),this.reset())}function r(a){(this[k]._inflate=null,this[o])?this[m](this[o]):(a[h]=1007,this[m](a))}b.exports=class{constructor(a,b,c){this._maxPayload=0|c,this._options=a||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!b,this._deflate=null,this._inflate=null,this.params=null,d||(d=new g(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let a={};return this._options.serverNoContextTakeover&&(a.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(a.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(a.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?a.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(a.client_max_window_bits=!0),a}accept(a){return a=this.normalizeParams(a),this.params=this._isServer?this.acceptAsServer(a):this.acceptAsClient(a),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let a=this._deflate[m];this._deflate.close(),this._deflate=null,a&&a(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(a){let b=this._options,c=a.find(a=>(!1!==b.serverNoContextTakeover||!a.server_no_context_takeover)&&(!a.server_max_window_bits||!1!==b.serverMaxWindowBits&&("number"!=typeof b.serverMaxWindowBits||!(b.serverMaxWindowBits>a.server_max_window_bits)))&&("number"!=typeof b.clientMaxWindowBits||!!a.client_max_window_bits));if(!c)throw Error("None of the extension offers can be accepted");return b.serverNoContextTakeover&&(c.server_no_context_takeover=!0),b.clientNoContextTakeover&&(c.client_no_context_takeover=!0),"number"==typeof b.serverMaxWindowBits&&(c.server_max_window_bits=b.serverMaxWindowBits),"number"==typeof b.clientMaxWindowBits?c.client_max_window_bits=b.clientMaxWindowBits:(!0===c.client_max_window_bits||!1===b.clientMaxWindowBits)&&delete c.client_max_window_bits,c}acceptAsClient(a){let b=a[0];if(!1===this._options.clientNoContextTakeover&&b.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(b.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&b.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(b.client_max_window_bits=this._options.clientMaxWindowBits);return b}normalizeParams(a){return a.forEach(a=>{Object.keys(a).forEach(b=>{let c=a[b];if(c.length>1)throw Error(`Parameter "${b}" must have only a single value`);if(c=c[0],"client_max_window_bits"===b){if(!0!==c){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else if("server_max_window_bits"===b){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if("client_no_context_takeover"===b||"server_no_context_takeover"===b){if(!0!==c)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else throw Error(`Unknown parameter "${b}"`);a[b]=c})}),a}decompress(a,b,c){d.add(d=>{this._decompress(a,b,(a,b)=>{d(),c(a,b)})})}compress(a,b,c){d.add(d=>{this._compress(a,b,(a,b)=>{d(),c(a,b)})})}_decompress(a,b,c){let d=this._isServer?"client":"server";if(!this._inflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._inflate=e.createInflateRaw({...this._options.zlibInflateOptions,windowBits:b}),this._inflate[k]=this,this._inflate[l]=0,this._inflate[n]=[],this._inflate.on("error",r),this._inflate.on("data",q)}this._inflate[m]=c,this._inflate.write(a),b&&this._inflate.write(j),this._inflate.flush(()=>{let a=this._inflate[o];if(a){this._inflate.close(),this._inflate=null,c(a);return}let e=f.concat(this._inflate[n],this._inflate[l]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[l]=0,this._inflate[n]=[],b&&this.params[`${d}_no_context_takeover`]&&this._inflate.reset()),c(null,e)})}_compress(a,b,c){let d=this._isServer?"server":"client";if(!this._deflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._deflate=e.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:b}),this._deflate[l]=0,this._deflate[n]=[],this._deflate.on("data",p)}this._deflate[m]=c,this._deflate.write(a),this._deflate.flush(e.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let a=f.concat(this._deflate[n],this._deflate[l]);b&&(a=new i(a.buffer,a.byteOffset,a.length-4)),this._deflate[m]=null,this._deflate[l]=0,this._deflate[n]=[],b&&this.params[`${d}_no_context_takeover`]&&this._deflate.reset(),c(null,a)})}}},195122,(a,b,c)=>{"use strict";let{isUtf8:d}=a.r(500874),{hasBlob:e}=a.r(671951);function f(a){let b=a.length,c=0;for(;c<b;)if((128&a[c])==0)c++;else if((224&a[c])==192){if(c+1===b||(192&a[c+1])!=128||(254&a[c])==192)return!1;c+=2}else if((240&a[c])==224){if(c+2>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||224===a[c]&&(224&a[c+1])==128||237===a[c]&&(224&a[c+1])==160)return!1;c+=3}else{if((248&a[c])!=240||c+3>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||(192&a[c+3])!=128||240===a[c]&&(240&a[c+1])==128||244===a[c]&&a[c+1]>143||a[c]>244)return!1;c+=4}return!0}if(b.exports={isBlob:function(a){return e&&"object"==typeof a&&"function"==typeof a.arrayBuffer&&"string"==typeof a.type&&"function"==typeof a.stream&&("Blob"===a[Symbol.toStringTag]||"File"===a[Symbol.toStringTag])},isValidStatusCode:function(a){return a>=1e3&&a<=1014&&1004!==a&&1005!==a&&1006!==a||a>=3e3&&a<=4999},isValidUTF8:f,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},d)b.exports.isValidUTF8=function(a){return a.length<24?f(a):d(a)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let a=(()=>{let a=Error("Cannot find module 'utf-8-validate'");throw a.code="MODULE_NOT_FOUND",a})();b.exports.isValidUTF8=function(b){return b.length<32?f(b):a(b)}}catch(a){}},593909,(a,b,c)=>{"use strict";let{Writable:d}=a.r(688947),e=a.r(308343),{BINARY_TYPES:f,EMPTY_BUFFER:g,kStatusCode:h,kWebSocket:i}=a.r(671951),{concat:j,toArrayBuffer:k,unmask:l}=a.r(569691),{isValidStatusCode:m,isValidUTF8:n}=a.r(195122),o=Buffer[Symbol.species];b.exports=class extends d{constructor(a={}){super(),this._allowSynchronousEvents=void 0===a.allowSynchronousEvents||a.allowSynchronousEvents,this._binaryType=a.binaryType||f[0],this._extensions=a.extensions||{},this._isServer=!!a.isServer,this._maxPayload=0|a.maxPayload,this._skipUTF8Validation=!!a.skipUTF8Validation,this[i]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(a,b,c){if(8===this._opcode&&0==this._state)return c();this._bufferedBytes+=a.length,this._buffers.push(a),this.startLoop(c)}consume(a){if(this._bufferedBytes-=a,a===this._buffers[0].length)return this._buffers.shift();if(a<this._buffers[0].length){let b=this._buffers[0];return this._buffers[0]=new o(b.buffer,b.byteOffset+a,b.length-a),new o(b.buffer,b.byteOffset,a)}let b=Buffer.allocUnsafe(a);do{let c=this._buffers[0],d=b.length-a;a>=c.length?b.set(this._buffers.shift(),d):(b.set(new Uint8Array(c.buffer,c.byteOffset,a),d),this._buffers[0]=new o(c.buffer,c.byteOffset+a,c.length-a)),a-=c.length}while(a>0)return b}startLoop(a){this._loop=!0;do switch(this._state){case 0:this.getInfo(a);break;case 1:this.getPayloadLength16(a);break;case 2:this.getPayloadLength64(a);break;case 3:this.getMask();break;case 4:this.getData(a);break;case 5:case 6:this._loop=!1;return}while(this._loop)this._errored||a()}getInfo(a){if(this._bufferedBytes<2){this._loop=!1;return}let b=this.consume(2);if((48&b[0])!=0)return void a(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));let c=(64&b[0])==64;if(c&&!this._extensions[e.extensionName])return void a(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._fin=(128&b[0])==128,this._opcode=15&b[0],this._payloadLength=127&b[1],0===this._opcode){if(c)return void a(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void a(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void a(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=c}else{if(!(this._opcode>7)||!(this._opcode<11))return void a(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void a(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(c)return void a(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void a(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&b[1])==128,this._isServer){if(!this._masked)return void a(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void a(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(a)}getPayloadLength16(a){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(a)}getPayloadLength64(a){if(this._bufferedBytes<8){this._loop=!1;return}let b=this.consume(8),c=b.readUInt32BE(0);c>2097151?a(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*c+b.readUInt32BE(4),this.haveLength(a))}haveLength(a){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?a(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(a){let b=g;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}b=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&l(b,this._mask)}if(this._opcode>7)return void this.controlMessage(b,a);if(this._compressed){this._state=5,this.decompress(b,a);return}b.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(b)),this.dataMessage(a)}decompress(a,b){this._extensions[e.extensionName].decompress(a,this._fin,(a,c)=>{if(a)return b(a);if(c.length){if(this._messageLength+=c.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return void b(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(c)}this.dataMessage(b),0===this._state&&this.startLoop(b)})}dataMessage(a){if(!this._fin){this._state=0;return}let b=this._messageLength,c=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let d;d="nodebuffer"===this._binaryType?j(c,b):"arraybuffer"===this._binaryType?k(j(c,b)):"blob"===this._binaryType?new Blob(c):c,this._allowSynchronousEvents?(this.emit("message",d,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",d,!0),this._state=0,this.startLoop(a)}))}else{let d=j(c,b);if(!this._skipUTF8Validation&&!n(d))return void a(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));5===this._state||this._allowSynchronousEvents?(this.emit("message",d,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",d,!1),this._state=0,this.startLoop(a)}))}}controlMessage(a,b){if(8===this._opcode){if(0===a.length)this._loop=!1,this.emit("conclude",1005,g),this.end();else{let c=a.readUInt16BE(0);if(!m(c))return void b(this.createError(RangeError,`invalid status code ${c}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));let d=new o(a.buffer,a.byteOffset+2,a.length-2);if(!this._skipUTF8Validation&&!n(d))return void b(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));this._loop=!1,this.emit("conclude",c,d),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",a),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",a),this._state=0,this.startLoop(b)}))}createError(a,b,c,d,e){this._loop=!1,this._errored=!0;let f=new a(c?`Invalid WebSocket frame: ${b}`:b);return Error.captureStackTrace(f,this.createError),f.code=e,f[h]=d,f}}},162612,(a,b,c)=>{"use strict";let d,{Duplex:e}=a.r(688947),{randomFillSync:f}=a.r(254799),g=a.r(308343),{EMPTY_BUFFER:h,kWebSocket:i,NOOP:j}=a.r(671951),{isBlob:k,isValidStatusCode:l}=a.r(195122),{mask:m,toBuffer:n}=a.r(569691),o=Symbol("kByteLength"),p=Buffer.alloc(4),q=8192;class r{constructor(a,b,c){this._extensions=b||{},c&&(this._generateMask=c,this._maskBuffer=Buffer.alloc(4)),this._socket=a,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=j,this[i]=void 0}static frame(a,b){let c,e,g=!1,h=2,i=!1;b.mask&&(c=b.maskBuffer||p,b.generateMask?b.generateMask(c):(8192===q&&(void 0===d&&(d=Buffer.alloc(8192)),f(d,0,8192),q=0),c[0]=d[q++],c[1]=d[q++],c[2]=d[q++],c[3]=d[q++]),i=(c[0]|c[1]|c[2]|c[3])==0,h=6),"string"==typeof a?e=(!b.mask||i)&&void 0!==b[o]?b[o]:(a=Buffer.from(a)).length:(e=a.length,g=b.mask&&b.readOnly&&!i);let j=e;e>=65536?(h+=8,j=127):e>125&&(h+=2,j=126);let k=Buffer.allocUnsafe(g?e+h:h);return(k[0]=b.fin?128|b.opcode:b.opcode,b.rsv1&&(k[0]|=64),k[1]=j,126===j?k.writeUInt16BE(e,2):127===j&&(k[2]=k[3]=0,k.writeUIntBE(e,4,6)),b.mask)?(k[1]|=128,k[h-4]=c[0],k[h-3]=c[1],k[h-2]=c[2],k[h-1]=c[3],i)?[k,a]:g?(m(a,c,k,h,e),[k]):(m(a,c,a,0,e),[k,a]):[k,a]}close(a,b,c,d){let e;if(void 0===a)e=h;else if("number"==typeof a&&l(a))if(void 0!==b&&b.length){let c=Buffer.byteLength(b);if(c>123)throw RangeError("The message must not be greater than 123 bytes");(e=Buffer.allocUnsafe(2+c)).writeUInt16BE(a,0),"string"==typeof b?e.write(b,2):e.set(b,2)}else(e=Buffer.allocUnsafe(2)).writeUInt16BE(a,0);else throw TypeError("First argument must be a valid error code number");let f={[o]:e.length,fin:!0,generateMask:this._generateMask,mask:c,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,e,!1,f,d]):this.sendFrame(r.frame(e,f),d)}ping(a,b,c){let d,e;if("string"==typeof a?(d=Buffer.byteLength(a),e=!1):k(a)?(d=a.size,e=!1):(d=(a=n(a)).length,e=n.readOnly),d>125)throw RangeError("The data size must not be greater than 125 bytes");let f={[o]:d,fin:!0,generateMask:this._generateMask,mask:b,maskBuffer:this._maskBuffer,opcode:9,readOnly:e,rsv1:!1};k(a)?0!==this._state?this.enqueue([this.getBlobData,a,!1,f,c]):this.getBlobData(a,!1,f,c):0!==this._state?this.enqueue([this.dispatch,a,!1,f,c]):this.sendFrame(r.frame(a,f),c)}pong(a,b,c){let d,e;if("string"==typeof a?(d=Buffer.byteLength(a),e=!1):k(a)?(d=a.size,e=!1):(d=(a=n(a)).length,e=n.readOnly),d>125)throw RangeError("The data size must not be greater than 125 bytes");let f={[o]:d,fin:!0,generateMask:this._generateMask,mask:b,maskBuffer:this._maskBuffer,opcode:10,readOnly:e,rsv1:!1};k(a)?0!==this._state?this.enqueue([this.getBlobData,a,!1,f,c]):this.getBlobData(a,!1,f,c):0!==this._state?this.enqueue([this.dispatch,a,!1,f,c]):this.sendFrame(r.frame(a,f),c)}send(a,b,c){let d,e,f=this._extensions[g.extensionName],h=b.binary?2:1,i=b.compress;"string"==typeof a?(d=Buffer.byteLength(a),e=!1):k(a)?(d=a.size,e=!1):(d=(a=n(a)).length,e=n.readOnly),this._firstFragment?(this._firstFragment=!1,i&&f&&f.params[f._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(i=d>=f._threshold),this._compress=i):(i=!1,h=0),b.fin&&(this._firstFragment=!0);let j={[o]:d,fin:b.fin,generateMask:this._generateMask,mask:b.mask,maskBuffer:this._maskBuffer,opcode:h,readOnly:e,rsv1:i};k(a)?0!==this._state?this.enqueue([this.getBlobData,a,this._compress,j,c]):this.getBlobData(a,this._compress,j,c):0!==this._state?this.enqueue([this.dispatch,a,this._compress,j,c]):this.dispatch(a,this._compress,j,c)}getBlobData(a,b,c,d){this._bufferedBytes+=c[o],this._state=2,a.arrayBuffer().then(a=>{if(this._socket.destroyed){let a=Error("The socket was closed while the blob was being read");process.nextTick(s,this,a,d);return}this._bufferedBytes-=c[o];let e=n(a);b?this.dispatch(e,b,c,d):(this._state=0,this.sendFrame(r.frame(e,c),d),this.dequeue())}).catch(a=>{process.nextTick(t,this,a,d)})}dispatch(a,b,c,d){if(!b)return void this.sendFrame(r.frame(a,c),d);let e=this._extensions[g.extensionName];this._bufferedBytes+=c[o],this._state=1,e.compress(a,c.fin,(a,b)=>{this._socket.destroyed?s(this,Error("The socket was closed while data was being compressed"),d):(this._bufferedBytes-=c[o],this._state=0,c.readOnly=!1,this.sendFrame(r.frame(b,c),d),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){let a=this._queue.shift();this._bufferedBytes-=a[3][o],Reflect.apply(a[0],this,a.slice(1))}}enqueue(a){this._bufferedBytes+=a[3][o],this._queue.push(a)}sendFrame(a,b){2===a.length?(this._socket.cork(),this._socket.write(a[0]),this._socket.write(a[1],b),this._socket.uncork()):this._socket.write(a[0],b)}}function s(a,b,c){"function"==typeof c&&c(b);for(let c=0;c<a._queue.length;c++){let d=a._queue[c],e=d[d.length-1];"function"==typeof e&&e(b)}}function t(a,b,c){s(a,b,c),a.onerror(b)}b.exports=r},38031,(a,b,c)=>{"use strict";let{kForOnEventAttribute:d,kListener:e}=a.r(671951),f=Symbol("kCode"),g=Symbol("kData"),h=Symbol("kError"),i=Symbol("kMessage"),j=Symbol("kReason"),k=Symbol("kTarget"),l=Symbol("kType"),m=Symbol("kWasClean");class n{constructor(a){this[k]=null,this[l]=a}get target(){return this[k]}get type(){return this[l]}}Object.defineProperty(n.prototype,"target",{enumerable:!0}),Object.defineProperty(n.prototype,"type",{enumerable:!0});class o extends n{constructor(a,b={}){super(a),this[f]=void 0===b.code?0:b.code,this[j]=void 0===b.reason?"":b.reason,this[m]=void 0!==b.wasClean&&b.wasClean}get code(){return this[f]}get reason(){return this[j]}get wasClean(){return this[m]}}Object.defineProperty(o.prototype,"code",{enumerable:!0}),Object.defineProperty(o.prototype,"reason",{enumerable:!0}),Object.defineProperty(o.prototype,"wasClean",{enumerable:!0});class p extends n{constructor(a,b={}){super(a),this[h]=void 0===b.error?null:b.error,this[i]=void 0===b.message?"":b.message}get error(){return this[h]}get message(){return this[i]}}Object.defineProperty(p.prototype,"error",{enumerable:!0}),Object.defineProperty(p.prototype,"message",{enumerable:!0});class q extends n{constructor(a,b={}){super(a),this[g]=void 0===b.data?null:b.data}get data(){return this[g]}}function r(a,b,c){"object"==typeof a&&a.handleEvent?a.handleEvent.call(a,c):a.call(b,c)}Object.defineProperty(q.prototype,"data",{enumerable:!0}),b.exports={CloseEvent:o,ErrorEvent:p,Event:n,EventTarget:{addEventListener(a,b,c={}){let f;for(let f of this.listeners(a))if(!c[d]&&f[e]===b&&!f[d])return;if("message"===a)f=function(a,c){let d=new q("message",{data:c?a:a.toString()});d[k]=this,r(b,this,d)};else if("close"===a)f=function(a,c){let d=new o("close",{code:a,reason:c.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});d[k]=this,r(b,this,d)};else if("error"===a)f=function(a){let c=new p("error",{error:a,message:a.message});c[k]=this,r(b,this,c)};else{if("open"!==a)return;f=function(){let a=new n("open");a[k]=this,r(b,this,a)}}f[d]=!!c[d],f[e]=b,c.once?this.once(a,f):this.on(a,f)},removeEventListener(a,b){for(let c of this.listeners(a))if(c[e]===b&&!c[d]){this.removeListener(a,c);break}}},MessageEvent:q}},366157,(a,b,c)=>{"use strict";let{tokenChars:d}=a.r(195122);function e(a,b,c){void 0===a[b]?a[b]=[c]:a[b].push(c)}b.exports={format:function(a){return Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>[b].concat(Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>!0===a?b:`${b}=${a}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(a){let b,c,f=Object.create(null),g=Object.create(null),h=!1,i=!1,j=!1,k=-1,l=-1,m=-1,n=0;for(;n<a.length;n++)if(l=a.charCodeAt(n),void 0===b)if(-1===m&&1===d[l])-1===k&&(k=n);else if(0!==n&&(32===l||9===l))-1===m&&-1!==k&&(m=n);else if(59===l||44===l){if(-1===k)throw SyntaxError(`Unexpected character at index ${n}`);-1===m&&(m=n);let c=a.slice(k,m);44===l?(e(f,c,g),g=Object.create(null)):b=c,k=m=-1}else throw SyntaxError(`Unexpected character at index ${n}`);else if(void 0===c)if(-1===m&&1===d[l])-1===k&&(k=n);else if(32===l||9===l)-1===m&&-1!==k&&(m=n);else if(59===l||44===l){if(-1===k)throw SyntaxError(`Unexpected character at index ${n}`);-1===m&&(m=n),e(g,a.slice(k,m),!0),44===l&&(e(f,b,g),g=Object.create(null),b=void 0),k=m=-1}else if(61===l&&-1!==k&&-1===m)c=a.slice(k,n),k=m=-1;else throw SyntaxError(`Unexpected character at index ${n}`);else if(i){if(1!==d[l])throw SyntaxError(`Unexpected character at index ${n}`);-1===k?k=n:h||(h=!0),i=!1}else if(j)if(1===d[l])-1===k&&(k=n);else if(34===l&&-1!==k)j=!1,m=n;else if(92===l)i=!0;else throw SyntaxError(`Unexpected character at index ${n}`);else if(34===l&&61===a.charCodeAt(n-1))j=!0;else if(-1===m&&1===d[l])-1===k&&(k=n);else if(-1!==k&&(32===l||9===l))-1===m&&(m=n);else if(59===l||44===l){if(-1===k)throw SyntaxError(`Unexpected character at index ${n}`);-1===m&&(m=n);let d=a.slice(k,m);h&&(d=d.replace(/\\/g,""),h=!1),e(g,c,d),44===l&&(e(f,b,g),g=Object.create(null),b=void 0),c=void 0,k=m=-1}else throw SyntaxError(`Unexpected character at index ${n}`);if(-1===k||j||32===l||9===l)throw SyntaxError("Unexpected end of input");-1===m&&(m=n);let o=a.slice(k,m);return void 0===b?e(f,o,g):(void 0===c?e(g,o,!0):h?e(g,c,o.replace(/\\/g,"")):e(g,c,o),e(f,b,g)),f}}},413187,(a,b,c)=>{"use strict";let d=a.r(427699),e=a.r(524836),f=a.r(921517),g=a.r(504446),h=a.r(755004),{randomBytes:i,createHash:j}=a.r(254799),{Duplex:k,Readable:l}=a.r(688947),{URL:m}=a.r(792509),n=a.r(308343),o=a.r(593909),p=a.r(162612),{isBlob:q}=a.r(195122),{BINARY_TYPES:r,EMPTY_BUFFER:s,GUID:t,kForOnEventAttribute:u,kListener:v,kStatusCode:w,kWebSocket:x,NOOP:y}=a.r(671951),{EventTarget:{addEventListener:z,removeEventListener:A}}=a.r(38031),{format:B,parse:C}=a.r(366157),{toBuffer:D}=a.r(569691),E=Symbol("kAborted"),F=[8,13],G=["CONNECTING","OPEN","CLOSING","CLOSED"],H=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class I extends d{constructor(a,b,c){super(),this._binaryType=r[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=s,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=I.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==a?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===b?b=[]:Array.isArray(b)||("object"==typeof b&&null!==b?(c=b,b=[]):b=[b]),function a(b,c,d,g){let h,k,l,o,p={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:F[1],maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...g,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(b._autoPong=p.autoPong,!F.includes(p.protocolVersion))throw RangeError(`Unsupported protocol version: ${p.protocolVersion} (supported versions: ${F.join(", ")})`);if(c instanceof m)h=c;else try{h=new m(c)}catch(a){throw SyntaxError(`Invalid URL: ${c}`)}"http:"===h.protocol?h.protocol="ws:":"https:"===h.protocol&&(h.protocol="wss:"),b._url=h.href;let q="wss:"===h.protocol,r="ws+unix:"===h.protocol;if("ws:"===h.protocol||q||r?r&&!h.pathname?k="The URL's pathname is empty":h.hash&&(k="The URL contains a fragment identifier"):k='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',k){let a=SyntaxError(k);if(0!==b._redirects)return void J(b,a);throw a}let s=q?443:80,u=i(16).toString("base64"),v=q?e.request:f.request,w=new Set;if(p.createConnection=p.createConnection||(q?L:K),p.defaultPort=p.defaultPort||s,p.port=h.port||s,p.host=h.hostname.startsWith("[")?h.hostname.slice(1,-1):h.hostname,p.headers={...p.headers,"Sec-WebSocket-Version":p.protocolVersion,"Sec-WebSocket-Key":u,Connection:"Upgrade",Upgrade:"websocket"},p.path=h.pathname+h.search,p.timeout=p.handshakeTimeout,p.perMessageDeflate&&(l=new n(!0!==p.perMessageDeflate?p.perMessageDeflate:{},!1,p.maxPayload),p.headers["Sec-WebSocket-Extensions"]=B({[n.extensionName]:l.offer()})),d.length){for(let a of d){if("string"!=typeof a||!H.test(a)||w.has(a))throw SyntaxError("An invalid or duplicated subprotocol was specified");w.add(a)}p.headers["Sec-WebSocket-Protocol"]=d.join(",")}if(p.origin&&(p.protocolVersion<13?p.headers["Sec-WebSocket-Origin"]=p.origin:p.headers.Origin=p.origin),(h.username||h.password)&&(p.auth=`${h.username}:${h.password}`),r){let a=p.path.split(":");p.socketPath=a[0],p.path=a[1]}if(p.followRedirects){if(0===b._redirects){b._originalIpc=r,b._originalSecure=q,b._originalHostOrSocketPath=r?p.socketPath:h.host;let a=g&&g.headers;if(g={...g,headers:{}},a)for(let[b,c]of Object.entries(a))g.headers[b.toLowerCase()]=c}else if(0===b.listenerCount("redirect")){let a=r?!!b._originalIpc&&p.socketPath===b._originalHostOrSocketPath:!b._originalIpc&&h.host===b._originalHostOrSocketPath;a&&(!b._originalSecure||q)||(delete p.headers.authorization,delete p.headers.cookie,a||delete p.headers.host,p.auth=void 0)}p.auth&&!g.headers.authorization&&(g.headers.authorization="Basic "+Buffer.from(p.auth).toString("base64")),o=b._req=v(p),b._redirects&&b.emit("redirect",b.url,o)}else o=b._req=v(p);p.timeout&&o.on("timeout",()=>{M(b,o,"Opening handshake has timed out")}),o.on("error",a=>{null===o||o[E]||(o=b._req=null,J(b,a))}),o.on("response",e=>{let f=e.headers.location,h=e.statusCode;if(f&&p.followRedirects&&h>=300&&h<400){let e;if(++b._redirects>p.maxRedirects)return void M(b,o,"Maximum redirects exceeded");o.abort();try{e=new m(f,c)}catch(a){J(b,SyntaxError(`Invalid URL: ${f}`));return}a(b,e,d,g)}else b.emit("unexpected-response",o,e)||M(b,o,`Unexpected server response: ${e.statusCode}`)}),o.on("upgrade",(a,c,d)=>{let e;if(b.emit("upgrade",a),b.readyState!==I.CONNECTING)return;o=b._req=null;let f=a.headers.upgrade;if(void 0===f||"websocket"!==f.toLowerCase())return void M(b,c,"Invalid Upgrade header");let g=j("sha1").update(u+t).digest("base64");if(a.headers["sec-websocket-accept"]!==g)return void M(b,c,"Invalid Sec-WebSocket-Accept header");let h=a.headers["sec-websocket-protocol"];if(void 0!==h?w.size?w.has(h)||(e="Server sent an invalid subprotocol"):e="Server sent a subprotocol but none was requested":w.size&&(e="Server sent no subprotocol"),e)return void M(b,c,e);h&&(b._protocol=h);let i=a.headers["sec-websocket-extensions"];if(void 0!==i){let a;if(!l)return void M(b,c,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{a=C(i)}catch(a){M(b,c,"Invalid Sec-WebSocket-Extensions header");return}let d=Object.keys(a);if(1!==d.length||d[0]!==n.extensionName)return void M(b,c,"Server indicated an extension that was not requested");try{l.accept(a[n.extensionName])}catch(a){M(b,c,"Invalid Sec-WebSocket-Extensions header");return}b._extensions[n.extensionName]=l}b.setSocket(c,d,{allowSynchronousEvents:p.allowSynchronousEvents,generateMask:p.generateMask,maxPayload:p.maxPayload,skipUTF8Validation:p.skipUTF8Validation})}),p.finishRequest?p.finishRequest(o,b):o.end()}(this,a,b,c)):(this._autoPong=c.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(a){r.includes(a)&&(this._binaryType=a,this._receiver&&(this._receiver._binaryType=a))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(a,b,c){let d=new o({allowSynchronousEvents:c.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:c.maxPayload,skipUTF8Validation:c.skipUTF8Validation}),e=new p(a,this._extensions,c.generateMask);this._receiver=d,this._sender=e,this._socket=a,d[x]=this,e[x]=this,a[x]=this,d.on("conclude",O),d.on("drain",P),d.on("error",Q),d.on("message",S),d.on("ping",T),d.on("pong",U),e.onerror=W,a.setTimeout&&a.setTimeout(0),a.setNoDelay&&a.setNoDelay(),b.length>0&&a.unshift(b),a.on("close",Y),a.on("data",Z),a.on("end",$),a.on("error",_),this._readyState=I.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=I.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[n.extensionName]&&this._extensions[n.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=I.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(a,b){if(this.readyState!==I.CLOSED){if(this.readyState===I.CONNECTING)return void M(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===I.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=I.CLOSING,this._sender.close(a,b,!this._isServer,a=>{!a&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),X(this)}}pause(){this.readyState!==I.CONNECTING&&this.readyState!==I.CLOSED&&(this._paused=!0,this._socket.pause())}ping(a,b,c){if(this.readyState===I.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==I.OPEN)?N(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.ping(a||s,b,c))}pong(a,b,c){if(this.readyState===I.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==I.OPEN)?N(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.pong(a||s,b,c))}resume(){this.readyState!==I.CONNECTING&&this.readyState!==I.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(a,b,c){if(this.readyState===I.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof b&&(c=b,b={}),"number"==typeof a&&(a=a.toString()),this.readyState!==I.OPEN)return void N(this,a,c);let d={binary:"string"!=typeof a,mask:!this._isServer,compress:!0,fin:!0,...b};this._extensions[n.extensionName]||(d.compress=!1),this._sender.send(a||s,d,c)}terminate(){if(this.readyState!==I.CLOSED){if(this.readyState===I.CONNECTING)return void M(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=I.CLOSING,this._socket.destroy())}}}function J(a,b){a._readyState=I.CLOSING,a._errorEmitted=!0,a.emit("error",b),a.emitClose()}function K(a){return a.path=a.socketPath,g.connect(a)}function L(a){return a.path=void 0,a.servername||""===a.servername||(a.servername=g.isIP(a.host)?"":a.host),h.connect(a)}function M(a,b,c){a._readyState=I.CLOSING;let d=Error(c);Error.captureStackTrace(d,M),b.setHeader?(b[E]=!0,b.abort(),b.socket&&!b.socket.destroyed&&b.socket.destroy(),process.nextTick(J,a,d)):(b.destroy(d),b.once("error",a.emit.bind(a,"error")),b.once("close",a.emitClose.bind(a)))}function N(a,b,c){if(b){let c=q(b)?b.size:D(b).length;a._socket?a._sender._bufferedBytes+=c:a._bufferedAmount+=c}if(c){let b=Error(`WebSocket is not open: readyState ${a.readyState} (${G[a.readyState]})`);process.nextTick(c,b)}}function O(a,b){let c=this[x];c._closeFrameReceived=!0,c._closeMessage=b,c._closeCode=a,void 0!==c._socket[x]&&(c._socket.removeListener("data",Z),process.nextTick(V,c._socket),1005===a?c.close():c.close(a,b))}function P(){let a=this[x];a.isPaused||a._socket.resume()}function Q(a){let b=this[x];void 0!==b._socket[x]&&(b._socket.removeListener("data",Z),process.nextTick(V,b._socket),b.close(a[w])),b._errorEmitted||(b._errorEmitted=!0,b.emit("error",a))}function R(){this[x].emitClose()}function S(a,b){this[x].emit("message",a,b)}function T(a){let b=this[x];b._autoPong&&b.pong(a,!this._isServer,y),b.emit("ping",a)}function U(a){this[x].emit("pong",a)}function V(a){a.resume()}function W(a){let b=this[x];b.readyState!==I.CLOSED&&(b.readyState===I.OPEN&&(b._readyState=I.CLOSING,X(b)),this._socket.end(),b._errorEmitted||(b._errorEmitted=!0,b.emit("error",a)))}function X(a){a._closeTimer=setTimeout(a._socket.destroy.bind(a._socket),3e4)}function Y(){let a,b=this[x];this.removeListener("close",Y),this.removeListener("data",Z),this.removeListener("end",$),b._readyState=I.CLOSING,this._readableState.endEmitted||b._closeFrameReceived||b._receiver._writableState.errorEmitted||null===(a=b._socket.read())||b._receiver.write(a),b._receiver.end(),this[x]=void 0,clearTimeout(b._closeTimer),b._receiver._writableState.finished||b._receiver._writableState.errorEmitted?b.emitClose():(b._receiver.on("error",R),b._receiver.on("finish",R))}function Z(a){this[x]._receiver.write(a)||this.pause()}function $(){let a=this[x];a._readyState=I.CLOSING,a._receiver.end(),this.end()}function _(){let a=this[x];this.removeListener("error",_),this.on("error",y),a&&(a._readyState=I.CLOSING,this.destroy())}Object.defineProperty(I,"CONNECTING",{enumerable:!0,value:G.indexOf("CONNECTING")}),Object.defineProperty(I.prototype,"CONNECTING",{enumerable:!0,value:G.indexOf("CONNECTING")}),Object.defineProperty(I,"OPEN",{enumerable:!0,value:G.indexOf("OPEN")}),Object.defineProperty(I.prototype,"OPEN",{enumerable:!0,value:G.indexOf("OPEN")}),Object.defineProperty(I,"CLOSING",{enumerable:!0,value:G.indexOf("CLOSING")}),Object.defineProperty(I.prototype,"CLOSING",{enumerable:!0,value:G.indexOf("CLOSING")}),Object.defineProperty(I,"CLOSED",{enumerable:!0,value:G.indexOf("CLOSED")}),Object.defineProperty(I.prototype,"CLOSED",{enumerable:!0,value:G.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(a=>{Object.defineProperty(I.prototype,a,{enumerable:!0})}),["open","error","close","message"].forEach(a=>{Object.defineProperty(I.prototype,`on${a}`,{enumerable:!0,get(){for(let b of this.listeners(a))if(b[u])return b[v];return null},set(b){for(let b of this.listeners(a))if(b[u]){this.removeListener(a,b);break}"function"==typeof b&&this.addEventListener(a,b,{[u]:!0})}})}),I.prototype.addEventListener=z,I.prototype.removeEventListener=A,b.exports=I},544270,(a,b,c)=>{"use strict";a.r(413187);let{Duplex:d}=a.r(688947);function e(a){a.emit("close")}function f(){!this.destroyed&&this._writableState.finished&&this.destroy()}function g(a){this.removeListener("error",g),this.destroy(),0===this.listenerCount("error")&&this.emit("error",a)}b.exports=function(a,b){let c=!0,h=new d({...b,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return a.on("message",function(b,c){let d=!c&&h._readableState.objectMode?b.toString():b;h.push(d)||a.pause()}),a.once("error",function(a){h.destroyed||(c=!1,h.destroy(a))}),a.once("close",function(){h.destroyed||h.push(null)}),h._destroy=function(b,d){if(a.readyState===a.CLOSED){d(b),process.nextTick(e,h);return}let f=!1;a.once("error",function(a){f=!0,d(a)}),a.once("close",function(){f||d(b),process.nextTick(e,h)}),c&&a.terminate()},h._final=function(b){a.readyState===a.CONNECTING?a.once("open",function(){h._final(b)}):null!==a._socket&&(a._socket._writableState.finished?(b(),h._readableState.endEmitted&&h.destroy()):(a._socket.once("finish",function(){b()}),a.close()))},h._read=function(){a.isPaused&&a.resume()},h._write=function(b,c,d){a.readyState===a.CONNECTING?a.once("open",function(){h._write(b,c,d)}):a.send(b,d)},h.on("end",f),h.on("error",g),h}},44813,(a,b,c)=>{"use strict";let{tokenChars:d}=a.r(195122);b.exports={parse:function(a){let b=new Set,c=-1,e=-1,f=0;for(;f<a.length;f++){let g=a.charCodeAt(f);if(-1===e&&1===d[g])-1===c&&(c=f);else if(0!==f&&(32===g||9===g))-1===e&&-1!==c&&(e=f);else if(44===g){if(-1===c)throw SyntaxError(`Unexpected character at index ${f}`);-1===e&&(e=f);let d=a.slice(c,e);if(b.has(d))throw SyntaxError(`The "${d}" subprotocol is duplicated`);b.add(d),c=e=-1}else throw SyntaxError(`Unexpected character at index ${f}`)}if(-1===c||-1!==e)throw SyntaxError("Unexpected end of input");let g=a.slice(c,f);if(b.has(g))throw SyntaxError(`The "${g}" subprotocol is duplicated`);return b.add(g),b}}},784442,(a,b,c)=>{"use strict";let d=a.r(427699),e=a.r(921517),{Duplex:f}=a.r(688947),{createHash:g}=a.r(254799),h=a.r(366157),i=a.r(308343),j=a.r(44813),k=a.r(413187),{GUID:l,kWebSocket:m}=a.r(671951),n=/^[+/0-9A-Za-z]{22}==$/;function o(a){a._state=2,a.emit("close")}function p(){this.destroy()}function q(a,b,c,d){c=c||e.STATUS_CODES[b],d={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(c),...d},a.once("finish",a.destroy),a.end(`HTTP/1.1 ${b} ${e.STATUS_CODES[b]}\r
`+Object.keys(d).map(a=>`${a}: ${d[a]}`).join("\r\n")+"\r\n\r\n"+c)}function r(a,b,c,d,e,f){if(a.listenerCount("wsClientError")){let d=Error(e);Error.captureStackTrace(d,r),a.emit("wsClientError",d,c,b)}else q(c,d,e,f)}b.exports=class extends d{constructor(a,b){if(super(),null==(a={allowSynchronousEvents:!0,autoPong:!0,maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:k,...a}).port&&!a.server&&!a.noServer||null!=a.port&&(a.server||a.noServer)||a.server&&a.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=a.port?(this._server=e.createServer((a,b)=>{let c=e.STATUS_CODES[426];b.writeHead(426,{"Content-Length":c.length,"Content-Type":"text/plain"}),b.end(c)}),this._server.listen(a.port,a.host,a.backlog,b)):a.server&&(this._server=a.server),this._server){const a=this.emit.bind(this,"connection");this._removeListeners=function(a,b){for(let c of Object.keys(b))a.on(c,b[c]);return function(){for(let c of Object.keys(b))a.removeListener(c,b[c])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(b,c,d)=>{this.handleUpgrade(b,c,d,a)}})}!0===a.perMessageDeflate&&(a.perMessageDeflate={}),a.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=a,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(a){if(2===this._state){a&&this.once("close",()=>{a(Error("The server is not running"))}),process.nextTick(o,this);return}if(a&&this.once("close",a),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(o,this);else{let a=this._server;this._removeListeners(),this._removeListeners=this._server=null,a.close(()=>{o(this)})}}shouldHandle(a){if(this.options.path){let b=a.url.indexOf("?");if((-1!==b?a.url.slice(0,b):a.url)!==this.options.path)return!1}return!0}handleUpgrade(a,b,c,d){b.on("error",p);let e=a.headers["sec-websocket-key"],f=a.headers.upgrade,g=+a.headers["sec-websocket-version"];if("GET"!==a.method)return void r(this,a,b,405,"Invalid HTTP method");if(void 0===f||"websocket"!==f.toLowerCase())return void r(this,a,b,400,"Invalid Upgrade header");if(void 0===e||!n.test(e))return void r(this,a,b,400,"Missing or invalid Sec-WebSocket-Key header");if(13!==g&&8!==g)return void r(this,a,b,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});if(!this.shouldHandle(a))return void q(b,400);let k=a.headers["sec-websocket-protocol"],l=new Set;if(void 0!==k)try{l=j.parse(k)}catch(c){r(this,a,b,400,"Invalid Sec-WebSocket-Protocol header");return}let m=a.headers["sec-websocket-extensions"],o={};if(this.options.perMessageDeflate&&void 0!==m){let c=new i(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let a=h.parse(m);a[i.extensionName]&&(c.accept(a[i.extensionName]),o[i.extensionName]=c)}catch(c){r(this,a,b,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let f={origin:a.headers[`${8===g?"sec-websocket-origin":"origin"}`],secure:!!(a.socket.authorized||a.socket.encrypted),req:a};if(2===this.options.verifyClient.length)return void this.options.verifyClient(f,(f,g,h,i)=>{if(!f)return q(b,g||401,h,i);this.completeUpgrade(o,e,l,a,b,c,d)});if(!this.options.verifyClient(f))return q(b,401)}this.completeUpgrade(o,e,l,a,b,c,d)}completeUpgrade(a,b,c,d,e,f,j){if(!e.readable||!e.writable)return e.destroy();if(e[m])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return q(e,503);let k=g("sha1").update(b+l).digest("base64"),n=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${k}`],r=new this.options.WebSocket(null,void 0,this.options);if(c.size){let a=this.options.handleProtocols?this.options.handleProtocols(c,d):c.values().next().value;a&&(n.push(`Sec-WebSocket-Protocol: ${a}`),r._protocol=a)}if(a[i.extensionName]){let b=a[i.extensionName].params,c=h.format({[i.extensionName]:[b]});n.push(`Sec-WebSocket-Extensions: ${c}`),r._extensions=a}this.emit("headers",n,d),e.write(n.concat("\r\n").join("\r\n")),e.removeListener("error",p),r.setSocket(e,f,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(r),r.on("close",()=>{this.clients.delete(r),this._shouldEmitClose&&!this.clients.size&&process.nextTick(o,this)})),j(r,d)}}},187361,527833,905636,56859,388592,870107,574791,235570,873400,32875,257563,938987,242357,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m,n,o;(a3=bf||(bf={})).STRING="string",a3.NUMBER="number",a3.INTEGER="integer",a3.BOOLEAN="boolean",a3.ARRAY="array",a3.OBJECT="object",(a4=bg||(bg={})).LANGUAGE_UNSPECIFIED="language_unspecified",a4.PYTHON="python",(a5=bh||(bh={})).OUTCOME_UNSPECIFIED="outcome_unspecified",a5.OUTCOME_OK="outcome_ok",a5.OUTCOME_FAILED="outcome_failed",a5.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";let p=["user","model","function","system"];(a6=bi||(bi={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",a6.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",a6.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",a6.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",a6.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",a6.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(a7=bj||(bj={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",a7.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",a7.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",a7.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",a7.BLOCK_NONE="BLOCK_NONE",(a8=bk||(bk={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",a8.NEGLIGIBLE="NEGLIGIBLE",a8.LOW="LOW",a8.MEDIUM="MEDIUM",a8.HIGH="HIGH",(a9=bl||(bl={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",a9.SAFETY="SAFETY",a9.OTHER="OTHER",(ba=bm||(bm={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",ba.STOP="STOP",ba.MAX_TOKENS="MAX_TOKENS",ba.SAFETY="SAFETY",ba.RECITATION="RECITATION",ba.LANGUAGE="LANGUAGE",ba.BLOCKLIST="BLOCKLIST",ba.PROHIBITED_CONTENT="PROHIBITED_CONTENT",ba.SPII="SPII",ba.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",ba.OTHER="OTHER",(bb=bn||(bn={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",bb.RETRIEVAL_QUERY="RETRIEVAL_QUERY",bb.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",bb.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",bb.CLASSIFICATION="CLASSIFICATION",bb.CLUSTERING="CLUSTERING",(bc=bo||(bo={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",bc.AUTO="AUTO",bc.ANY="ANY",bc.NONE="NONE",(bd=bp||(bp={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",bd.MODE_DYNAMIC="MODE_DYNAMIC";class q extends Error{constructor(a){super(`[GoogleGenerativeAI Error]: ${a}`)}}class r extends q{constructor(a,b){super(a),this.response=b}}class s extends q{constructor(a,b,c,d){super(a),this.status=b,this.statusText=c,this.errorDetails=d}}class t extends q{}class u extends q{}(be=bq||(bq={})).GENERATE_CONTENT="generateContent",be.STREAM_GENERATE_CONTENT="streamGenerateContent",be.COUNT_TOKENS="countTokens",be.EMBED_CONTENT="embedContent",be.BATCH_EMBED_CONTENTS="batchEmbedContents";class v{constructor(a,b,c,d,e){this.model=a,this.task=b,this.apiKey=c,this.stream=d,this.requestOptions=e}toString(){var a,b;let c=(null==(a=this.requestOptions)?void 0:a.apiVersion)||"v1beta",d=(null==(b=this.requestOptions)?void 0:b.baseUrl)||"https://generativelanguage.googleapis.com",e=`${d}/${c}/${this.model}:${this.task}`;return this.stream&&(e+="?alt=sse"),e}}async function w(a){var b,c;let d,e=new Headers;e.append("Content-Type","application/json"),e.append("x-goog-api-client",(c=a.requestOptions,d=[],(null==c?void 0:c.apiClient)&&d.push(c.apiClient),d.push("genai-js/0.24.0"),d.join(" "))),e.append("x-goog-api-key",a.apiKey);let f=null==(b=a.requestOptions)?void 0:b.customHeaders;if(f){if(!(f instanceof Headers))try{f=new Headers(f)}catch(a){throw new t(`unable to convert customHeaders value ${JSON.stringify(f)} to Headers: ${a.message}`)}for(let[a,b]of f.entries()){if("x-goog-api-key"===a)throw new t(`Cannot set reserved header name ${a}`);if("x-goog-api-client"===a)throw new t(`Header name ${a} can only be set using the apiClient field`);e.append(a,b)}}return e}async function x(a,b,c,d,e,f){let g=new v(a,b,c,d,f);return{url:g.toString(),fetchOptions:Object.assign(Object.assign({},function(a){let b={};if((null==a?void 0:a.signal)!==void 0||(null==a?void 0:a.timeout)>=0){let c=new AbortController;(null==a?void 0:a.timeout)>=0&&setTimeout(()=>c.abort(),a.timeout),(null==a?void 0:a.signal)&&a.signal.addEventListener("abort",()=>{c.abort()}),b.signal=c.signal}return b}(f)),{method:"POST",headers:await w(g),body:e})}}async function y(a,b,c,d,e,f={},g=fetch){let{url:h,fetchOptions:i}=await x(a,b,c,d,e,f);return z(h,i,g)}async function z(a,b,c=fetch){let d;try{d=await c(a,b)}catch(c){var e=c,f=a;let b=e;throw"AbortError"===b.name?(b=new u(`Request aborted when fetching ${f.toString()}: ${e.message}`)).stack=e.stack:e instanceof s||e instanceof t||((b=new q(`Error fetching from ${f.toString()}: ${e.message}`)).stack=e.stack),b}return d.ok||await A(d,a),d}async function A(a,b){let c,d="";try{let b=await a.json();d=b.error.message,b.error.details&&(d+=` ${JSON.stringify(b.error.details)}`,c=b.error.details)}catch(a){}throw new s(`Error fetching from ${b.toString()}: [${a.status} ${a.statusText}] ${d}`,a.status,a.statusText,c)}function B(a){return a.text=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),E(a.candidates[0]))throw new r(`${F(a)}`,a);return function(a){var b,c,d,e;let f=[];if(null==(c=null==(b=a.candidates)?void 0:b[0].content)?void 0:c.parts)for(let b of null==(e=null==(d=a.candidates)?void 0:d[0].content)?void 0:e.parts)b.text&&f.push(b.text),b.executableCode&&f.push("\n```"+b.executableCode.language+"\n"+b.executableCode.code+"\n```\n"),b.codeExecutionResult&&f.push("\n```\n"+b.codeExecutionResult.output+"\n```\n");return f.length>0?f.join(""):""}(a)}if(a.promptFeedback)throw new r(`Text not available. ${F(a)}`,a);return""},a.functionCall=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),E(a.candidates[0]))throw new r(`${F(a)}`,a);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),C(a)[0]}if(a.promptFeedback)throw new r(`Function call not available. ${F(a)}`,a)},a.functionCalls=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),E(a.candidates[0]))throw new r(`${F(a)}`,a);return C(a)}if(a.promptFeedback)throw new r(`Function call not available. ${F(a)}`,a)},a}function C(a){var b,c,d,e;let f=[];if(null==(c=null==(b=a.candidates)?void 0:b[0].content)?void 0:c.parts)for(let b of null==(e=null==(d=a.candidates)?void 0:d[0].content)?void 0:e.parts)b.functionCall&&f.push(b.functionCall);return f.length>0?f:void 0}let D=[bm.RECITATION,bm.SAFETY,bm.LANGUAGE];function E(a){return!!a.finishReason&&D.includes(a.finishReason)}function F(a){var b,c,d;let e="";if((!a.candidates||0===a.candidates.length)&&a.promptFeedback)e+="Response was blocked",(null==(b=a.promptFeedback)?void 0:b.blockReason)&&(e+=` due to ${a.promptFeedback.blockReason}`),(null==(c=a.promptFeedback)?void 0:c.blockReasonMessage)&&(e+=`: ${a.promptFeedback.blockReasonMessage}`);else if(null==(d=a.candidates)?void 0:d[0]){let b=a.candidates[0];E(b)&&(e+=`Candidate was blocked due to ${b.finishReason}`,b.finishMessage&&(e+=`: ${b.finishMessage}`))}return e}function G(a){return this instanceof G?(this.v=a,this):new G(a)}"function"==typeof SuppressedError&&SuppressedError;let H=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function I(a){let b=[],c=a.getReader();for(;;){let{done:a,value:d}=await c.read();if(a)return B(function(a){let b=a[a.length-1],c={promptFeedback:null==b?void 0:b.promptFeedback};for(let b of a){if(b.candidates){let a=0;for(let d of b.candidates)if(c.candidates||(c.candidates=[]),c.candidates[a]||(c.candidates[a]={index:a}),c.candidates[a].citationMetadata=d.citationMetadata,c.candidates[a].groundingMetadata=d.groundingMetadata,c.candidates[a].finishReason=d.finishReason,c.candidates[a].finishMessage=d.finishMessage,c.candidates[a].safetyRatings=d.safetyRatings,d.content&&d.content.parts){c.candidates[a].content||(c.candidates[a].content={role:d.content.role||"user",parts:[]});let b={};for(let e of d.content.parts)e.text&&(b.text=e.text),e.functionCall&&(b.functionCall=e.functionCall),e.executableCode&&(b.executableCode=e.executableCode),e.codeExecutionResult&&(b.codeExecutionResult=e.codeExecutionResult),0===Object.keys(b).length&&(b.text=""),c.candidates[a].content.parts.push(b)}a++}b.usageMetadata&&(c.usageMetadata=b.usageMetadata)}return c}(b));b.push(d)}}async function J(a,b,c,d){return function(a){let b,[c,d]=(b=a.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})).getReader(),new ReadableStream({start(a){let c="";return function d(){return b.read().then(({value:b,done:e})=>{let f;if(e)return c.trim()?void a.error(new q("Failed to parse stream")):void a.close();let g=(c+=b).match(H);for(;g;){try{f=JSON.parse(g[1])}catch(b){a.error(new q(`Error parsing JSON response: "${g[1]}"`));return}a.enqueue(f),g=(c=c.substring(g[0].length)).match(H)}return d()}).catch(a=>{let b=a;throw b.stack=a.stack,b="AbortError"===b.name?new u("Request aborted when reading from the stream"):new q("Error reading from the stream")})}()}})).tee();return{stream:function(a){return function(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof G?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}(this,arguments,function*(){let b=a.getReader();for(;;){let{value:a,done:c}=yield G(b.read());if(c)break;yield yield G(B(a))}})}(c),response:I(d)}}(await y(b,bq.STREAM_GENERATE_CONTENT,a,!0,JSON.stringify(c),d))}async function K(a,b,c,d){let e=await y(b,bq.GENERATE_CONTENT,a,!1,JSON.stringify(c),d);return{response:B(await e.json())}}function L(a){if(null!=a){if("string"==typeof a)return{role:"system",parts:[{text:a}]};if(a.text)return{role:"system",parts:[a]};if(a.parts)if(!a.role)return{role:"system",parts:a.parts};else return a}}function M(a){let b=[];if("string"==typeof a)b=[{text:a}];else for(let c of a)"string"==typeof c?b.push({text:c}):b.push(c);var c=b;let d={role:"user",parts:[]},e={role:"function",parts:[]},f=!1,g=!1;for(let a of c)"functionResponse"in a?(e.parts.push(a),g=!0):(d.parts.push(a),f=!0);if(f&&g)throw new q("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!f&&!g)throw new q("No content is provided for sending chat message.");return f?d:e}function N(a){let b;return b=a.contents?a:{contents:[M(a)]},a.systemInstruction&&(b.systemInstruction=L(a.systemInstruction)),b}let O=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],P={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Q(a){var b;if(void 0===a.candidates||0===a.candidates.length)return!1;let c=null==(b=a.candidates[0])?void 0:b.content;if(void 0===c||void 0===c.parts||0===c.parts.length)return!1;for(let a of c.parts)if(void 0===a||0===Object.keys(a).length||void 0!==a.text&&""===a.text)return!1;return!0}let R="SILENT_ERROR";class S{constructor(a,b,c,d={}){this.model=b,this.params=c,this._requestOptions=d,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=a,(null==c?void 0:c.history)&&(!function(a){let b=!1;for(let c of a){let{role:a,parts:d}=c;if(!b&&"user"!==a)throw new q(`First content should be with role 'user', got ${a}`);if(!p.includes(a))throw new q(`Each item should include role field. Got ${a} but valid roles are: ${JSON.stringify(p)}`);if(!Array.isArray(d))throw new q("Content should have 'parts' property with an array of Parts");if(0===d.length)throw new q("Each Content should have at least one part");let e={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let a of d)for(let b of O)b in a&&(e[b]+=1);let f=P[a];for(let b of O)if(!f.includes(b)&&e[b]>0)throw new q(`Content with role '${a}' can't contain '${b}' part`);b=!0}}(c.history),this._history=c.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(a,b={}){var c,d,e,f,g,h;let i;await this._sendPromise;let j=M(a),k={safetySettings:null==(c=this.params)?void 0:c.safetySettings,generationConfig:null==(d=this.params)?void 0:d.generationConfig,tools:null==(e=this.params)?void 0:e.tools,toolConfig:null==(f=this.params)?void 0:f.toolConfig,systemInstruction:null==(g=this.params)?void 0:g.systemInstruction,cachedContent:null==(h=this.params)?void 0:h.cachedContent,contents:[...this._history,j]},l=Object.assign(Object.assign({},this._requestOptions),b);return this._sendPromise=this._sendPromise.then(()=>K(this._apiKey,this.model,k,l)).then(a=>{var b;if(Q(a.response)){this._history.push(j);let c=Object.assign({parts:[],role:"model"},null==(b=a.response.candidates)?void 0:b[0].content);this._history.push(c)}else{let b=F(a.response);b&&console.warn(`sendMessage() was unsuccessful. ${b}. Inspect response object for details.`)}i=a}),await this._sendPromise,i}async sendMessageStream(a,b={}){var c,d,e,f,g,h;await this._sendPromise;let i=M(a),j={safetySettings:null==(c=this.params)?void 0:c.safetySettings,generationConfig:null==(d=this.params)?void 0:d.generationConfig,tools:null==(e=this.params)?void 0:e.tools,toolConfig:null==(f=this.params)?void 0:f.toolConfig,systemInstruction:null==(g=this.params)?void 0:g.systemInstruction,cachedContent:null==(h=this.params)?void 0:h.cachedContent,contents:[...this._history,i]},k=Object.assign(Object.assign({},this._requestOptions),b),l=J(this._apiKey,this.model,j,k);return this._sendPromise=this._sendPromise.then(()=>l).catch(a=>{throw Error(R)}).then(a=>a.response).then(a=>{if(Q(a)){this._history.push(i);let b=Object.assign({},a.candidates[0].content);b.role||(b.role="model"),this._history.push(b)}else{let b=F(a);b&&console.warn(`sendMessageStream() was unsuccessful. ${b}. Inspect response object for details.`)}}).catch(a=>{a.message!==R&&console.error(a)}),l}}async function T(a,b,c,d){return(await y(b,bq.COUNT_TOKENS,a,!1,JSON.stringify(c),d)).json()}async function U(a,b,c,d){return(await y(b,bq.EMBED_CONTENT,a,!1,JSON.stringify(c),d)).json()}async function V(a,b,c,d){let e=c.requests.map(a=>Object.assign(Object.assign({},a),{model:b}));return(await y(b,bq.BATCH_EMBED_CONTENTS,a,!1,JSON.stringify({requests:e}),d)).json()}class W{constructor(a,b,c={}){this.apiKey=a,this._requestOptions=c,b.model.includes("/")?this.model=b.model:this.model=`models/${b.model}`,this.generationConfig=b.generationConfig||{},this.safetySettings=b.safetySettings||[],this.tools=b.tools,this.toolConfig=b.toolConfig,this.systemInstruction=L(b.systemInstruction),this.cachedContent=b.cachedContent}async generateContent(a,b={}){var c;let d=N(a),e=Object.assign(Object.assign({},this._requestOptions),b);return K(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(c=this.cachedContent)?void 0:c.name},d),e)}async generateContentStream(a,b={}){var c;let d=N(a),e=Object.assign(Object.assign({},this._requestOptions),b);return J(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(c=this.cachedContent)?void 0:c.name},d),e)}startChat(a){var b;return new S(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(b=this.cachedContent)?void 0:b.name},a),this._requestOptions)}async countTokens(a,b={}){let c=function(a,b){var c;let d={model:null==b?void 0:b.model,generationConfig:null==b?void 0:b.generationConfig,safetySettings:null==b?void 0:b.safetySettings,tools:null==b?void 0:b.tools,toolConfig:null==b?void 0:b.toolConfig,systemInstruction:null==b?void 0:b.systemInstruction,cachedContent:null==(c=null==b?void 0:b.cachedContent)?void 0:c.name,contents:[]},e=null!=a.generateContentRequest;if(a.contents){if(e)throw new t("CountTokensRequest must have one of contents or generateContentRequest, not both.");d.contents=a.contents}else if(e)d=Object.assign(Object.assign({},d),a.generateContentRequest);else{let b=M(a);d.contents=[b]}return{generateContentRequest:d}}(a,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),d=Object.assign(Object.assign({},this._requestOptions),b);return T(this.apiKey,this.model,c,d)}async embedContent(a,b={}){let c="string"==typeof a||Array.isArray(a)?{content:M(a)}:a,d=Object.assign(Object.assign({},this._requestOptions),b);return U(this.apiKey,this.model,c,d)}async batchEmbedContents(a,b={}){let c=Object.assign(Object.assign({},this._requestOptions),b);return V(this.apiKey,this.model,a,c)}}class X{constructor(a){this.apiKey=a}getGenerativeModel(a,b){if(!a.model)throw new q("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new W(this.apiKey,a,b)}getGenerativeModelFromCachedContent(a,b,c){if(!a.name)throw new t("Cached content must contain a `name` field.");if(!a.model)throw new t("Cached content must contain a `model` field.");for(let c of["model","systemInstruction"])if((null==b?void 0:b[c])&&a[c]&&(null==b?void 0:b[c])!==a[c]){if("model"===c&&(b.model.startsWith("models/")?b.model.replace("models/",""):b.model)===(a.model.startsWith("models/")?a.model.replace("models/",""):a.model))continue;throw new t(`Different value for "${c}" specified in modelParams (${b[c]}) and cachedContent (${a[c]})`)}let d=Object.assign(Object.assign({},b),{model:a.model,tools:a.tools,toolConfig:a.toolConfig,systemInstruction:a.systemInstruction,cachedContent:a});return new W(this.apiKey,d,c)}}var Y,Z,$,_,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a$,a_,a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b$,b_,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c$,c_,c0,c1,c2,c3,c4,c5,c6,c7,c8,c9,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm,dn,dp,dq,dr,ds,dt,du,dv,dw,dx=Object.defineProperty,dy=(a,b)=>{for(var c in b)dx(a,c,{get:b[c],enumerable:!0})};dy({},{getEnv:()=>dE,getEnvironmentVariable:()=>dG,getRuntimeEnvironment:()=>dF,isBrowser:()=>dz,isDeno:()=>dC,isJsDom:()=>dB,isNode:()=>dD,isWebWorker:()=>dA});let dz=()=>!1,dA=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,dB=()=>"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom"),dC=()=>"undefined"!=typeof Deno,dD=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!dC(),dE=()=>dz()?"browser":dD()?"node":dA()?"webworker":dB()?"jsdom":dC()?"deno":"other";function dF(){return void 0===b&&(b={library:"langchain-js",runtime:dE()}),b}function dG(a){try{if("undefined"!=typeof process)return process.env?.[a];if(dC())return Deno?.env.get(a);return}catch{return}}function dH(a){return"object"==typeof a&&null!==a&&"type"in a&&"string"==typeof a.type&&"source_type"in a&&("url"===a.source_type||"base64"===a.source_type||"text"===a.source_type||"id"===a.source_type)}function dI(a){return dH(a)&&"url"===a.source_type&&"url"in a&&"string"==typeof a.url}function dJ(a){return dH(a)&&"base64"===a.source_type&&"data"in a&&"string"==typeof a.data}function dK(a){return dH(a)&&"text"===a.source_type&&"text"in a&&"string"==typeof a.text}function dL(a){return dH(a)&&"id"===a.source_type&&"id"in a&&"string"==typeof a.id}function dM(a){if(dH(a)){if("url"===a.source_type)return{type:"image_url",image_url:{url:a.url}};if("base64"===a.source_type){if(!a.mime_type)throw Error("mime_type key is required for base64 data.");let b=a.mime_type;return{type:"image_url",image_url:{url:`data:${b};base64,${a.data}`}}}}throw Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function dN(a){let b=a.split(";")[0].split("/");if(2!==b.length)throw Error(`Invalid mime type: "${a}" - does not match type/subtype format.`);let c=b[0].trim(),d=b[1].trim();if(""===c||""===d)throw Error(`Invalid mime type: "${a}" - type or subtype is empty.`);let e={};for(let b of a.split(";").slice(1)){let c=b.split("=");if(2!==c.length)throw Error(`Invalid parameter syntax in mime type: "${a}".`);let d=c[0].trim(),f=c[1].trim();if(""===d)throw Error(`Invalid parameter syntax in mime type: "${a}".`);e[d]=f}return{type:c,subtype:d,parameters:e}}function dO({dataUrl:a,asTypedArray:b=!1}){let c=a.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);if(c)return{mime_type:c[1].toLowerCase(),data:b?Uint8Array.from(atob(c[2]),a=>a.charCodeAt(0)):c[2]}}function dP(a,b){if("text"===a.type){if(!b.fromStandardTextBlock)throw Error(`Converter for ${b.providerName} does not implement \`fromStandardTextBlock\` method.`);return b.fromStandardTextBlock(a)}if("image"===a.type){if(!b.fromStandardImageBlock)throw Error(`Converter for ${b.providerName} does not implement \`fromStandardImageBlock\` method.`);return b.fromStandardImageBlock(a)}if("audio"===a.type){if(!b.fromStandardAudioBlock)throw Error(`Converter for ${b.providerName} does not implement \`fromStandardAudioBlock\` method.`);return b.fromStandardAudioBlock(a)}if("file"===a.type){if(!b.fromStandardFileBlock)throw Error(`Converter for ${b.providerName} does not implement \`fromStandardFileBlock\` method.`);return b.fromStandardFileBlock(a)}throw Error(`Unable to convert content block type '${a.type}' to provider-specific format: not recognized.`)}let dQ=/([\p{Alpha}\p{N}_]|$)/u;function dR(a,b){return b?.[a]||function(a,{separator:b="_",preserveConsecutiveUppercase:c=!1}={}){if("string"!=typeof a||"string"!=typeof b)throw TypeError("The `text` and `separator` arguments should be of type `string`");if(a.length<2)return c?a:a.toLowerCase();let d=`$1${b}$2`,e=a.replace(/([\p{Lowercase_Letter}\d])(\p{Uppercase_Letter})/gu,d);if(c){var f;return(f=e.replace(/((?<![\p{Uppercase_Letter}\d])[\p{Uppercase_Letter}\d](?![\p{Uppercase_Letter}\d]))/gu,a=>a.toLowerCase())).replace(/(?<!\p{Uppercase_Letter})(\p{Uppercase_Letter}+)(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,(a,c,d)=>c+b+d.toLowerCase())}return e.replace(/(\p{Uppercase_Letter})(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,d).toLowerCase()}(a)}function dS(a){return Array.isArray(a)?[...a]:{...a}}function dT(a){let b=Object.getPrototypeOf(a);return"function"==typeof a.lc_name&&("function"!=typeof b.lc_name||a.lc_name()!==b.lc_name())?a.lc_name():a.name}RegExp(/[_.\- ]+/.source+dQ.source,"gu"),RegExp(String.raw`\d+`+dQ.source,"gu"),dy({},{Serializable:()=>dU,get_lc_unique_name:()=>dT});var dU=class a{lc_serializable=!1;lc_kwargs;static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,dT(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(a,...b){void 0!==this.lc_serializable_keys?this.lc_kwargs=Object.fromEntries(Object.entries(a||{}).filter(([a])=>this.lc_serializable_keys?.includes(a))):this.lc_kwargs=a??{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof a||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let b={},c={},d=Object.keys(this.lc_kwargs).reduce((a,b)=>(a[b]=b in this?this[b]:this.lc_kwargs[b],a),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(b,Reflect.get(a,"lc_aliases",this)),Object.assign(c,Reflect.get(a,"lc_secrets",this)),Object.assign(d,Reflect.get(a,"lc_attributes",this));return Object.keys(c).forEach(a=>{let b=this,c=d,[e,...f]=a.split(".").reverse();for(let a of f.reverse()){if(!(a in b)||void 0===b[a])return;a in c&&void 0!==c[a]||("object"==typeof b[a]&&null!=b[a]?c[a]={}:Array.isArray(b[a])&&(c[a]=[])),b=b[a],c=c[a]}e in b&&void 0!==b[e]&&(c[e]=c[e]||b[e])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:function(a,b,c){let d={};for(let e in a)Object.hasOwn(a,e)&&(d[b(e,c)]=a[e]);return d}(Object.keys(c).length?function(a,b){let c=dS(a);for(let[a,d]of Object.entries(b)){let[b,...e]=a.split(".").reverse(),f=c;for(let a of e.reverse()){if(void 0===f[a])break;f[a]=dS(f[a]),f=f[a]}void 0!==f[b]&&(f[b]={lc:1,type:"secret",id:[d]})}return c}(d,c):d,dR,b)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function dV(a,b){return dW(a)&&a.type===b}function dW(a){return"object"==typeof a&&null!==a}function dX(a){return Array.isArray(a)}function dY(a){return"string"==typeof a}function dZ(a){return"number"==typeof a}function d$(a){return a instanceof Uint8Array}function d_(a){try{return JSON.parse(a)}catch{return}}let d0=a=>a();function d1(a){if(dV(a,"document")&&dW(a.source)&&"type"in a.source){if("base64"===a.source.type&&dY(a.source.media_type)&&dY(a.source.data))return{type:"file",mimeType:a.source.media_type,data:a.source.data};else if("url"===a.source.type&&dY(a.source.url))return{type:"file",url:a.source.url};else if("file"===a.source.type&&dY(a.source.file_id))return{type:"file",fileId:a.source.file_id};else if("text"===a.source.type&&dY(a.source.data))return{type:"file",mimeType:String(a.source.media_type??"text/plain"),data:a.source.data}}else if(dV(a,"image")&&dW(a.source)&&"type"in a.source){if("base64"===a.source.type&&dY(a.source.media_type)&&dY(a.source.data))return{type:"image",mimeType:a.source.media_type,data:a.source.data};else if("url"===a.source.type&&dY(a.source.url))return{type:"image",url:a.source.url};else if("file"===a.source.type&&dY(a.source.file_id))return{type:"image",fileId:a.source.file_id}}}function d2(a){return Array.from(function*(){for(let b of a){let a=d1(b);a?yield a:yield b}}())}function d3(a){return Array.from(function*(){for(let c of"string"==typeof a.content?[{type:"text",text:a.content}]:a.content){if(dV(c,"text")&&dY(c.text)){let{text:a,citations:b,...d}=c;if(dX(b)&&b.length){let c=b.reduce((a,b)=>{let c=function(a){if("char_location"===a.type&&dY(a.document_title)&&dZ(a.start_char_index)&&dZ(a.end_char_index)&&dY(a.cited_text)){let{document_title:b,start_char_index:c,end_char_index:d,cited_text:e,...f}=a;return{...f,type:"citation",source:"char",title:b??void 0,startIndex:c,endIndex:d,citedText:e}}if("page_location"===a.type&&dY(a.document_title)&&dZ(a.start_page_number)&&dZ(a.end_page_number)&&dY(a.cited_text)){let{document_title:b,start_page_number:c,end_page_number:d,cited_text:e,...f}=a;return{...f,type:"citation",source:"page",title:b??void 0,startIndex:c,endIndex:d,citedText:e}}if("content_block_location"===a.type&&dY(a.document_title)&&dZ(a.start_block_index)&&dZ(a.end_block_index)&&dY(a.cited_text)){let{document_title:b,start_block_index:c,end_block_index:d,cited_text:e,...f}=a;return{...f,type:"citation",source:"block",title:b??void 0,startIndex:c,endIndex:d,citedText:e}}if("web_search_result_location"===a.type&&dY(a.url)&&dY(a.title)&&dY(a.encrypted_index)&&dY(a.cited_text)){let{url:b,title:c,encrypted_index:d,cited_text:e,...f}=a;return{...f,type:"citation",source:"url",url:b,title:c,startIndex:Number(d),endIndex:Number(d),citedText:e}}if("search_result_location"===a.type&&dY(a.source)&&dY(a.title)&&dZ(a.start_block_index)&&dZ(a.end_block_index)&&dY(a.cited_text)){let{source:b,title:c,start_block_index:d,end_block_index:e,cited_text:f,...g}=a;return{...g,type:"citation",source:"search",url:b,title:c??void 0,startIndex:d,endIndex:e,citedText:f}}}(b);return c?[...a,c]:a},[]);yield{...d,type:"text",text:a,annotations:c};continue}yield{...d,type:"text",text:a};continue}if(dV(c,"thinking")&&dY(c.thinking)){let{thinking:a,signature:b,...d}=c;yield{...d,type:"reasoning",reasoning:a,signature:b};continue}if(dV(c,"redacted_thinking")){yield{type:"non_standard",value:c};continue}else if(dV(c,"tool_use")&&dY(c.name)&&dY(c.id)){yield{type:"tool_call",id:c.id,name:c.name,args:c.input};continue}else if(dV(c,"input_json_delta")){var b;if(b=a,"function"==typeof b?._getType&&"function"==typeof b.concat&&"ai"===b._getType()&&a.tool_call_chunks?.length){let b=a.tool_call_chunks[0];yield{type:"tool_call_chunk",id:b.id,name:b.name,args:b.args,index:b.index};continue}}else if(dV(c,"server_tool_use")&&dY(c.name)&&dY(c.id)){let{name:a,id:b}=c;if("web_search"===a){let a=d0(()=>{if("string"==typeof c.input)return c.input;if(dW(c.input)&&dY(c.input.query))return c.input.query;if(dY(c.partial_json)){let a=d_(c.partial_json);if(a?.query)return a.query}return""});yield{id:b,type:"server_tool_call",name:"web_search",args:{query:a}};continue}if("code_execution"===c.name){let a=d0(()=>{if("string"==typeof c.input)return c.input;if(dW(c.input)&&dY(c.input.code))return c.input.code;if(dY(c.partial_json)){let a=d_(c.partial_json);if(a?.code)return a.code}return""});yield{id:b,type:"server_tool_call",name:"code_execution",args:{code:a}};continue}}else if(dV(c,"web_search_tool_result")&&dY(c.tool_use_id)&&dX(c.content)){let{content:a,tool_use_id:b}=c,d=a.reduce((a,b)=>dV(b,"web_search_result")?[...a,b.url]:a,[]);yield{type:"server_tool_call_result",name:"web_search",toolCallId:b,status:"success",output:{urls:d}};continue}else if(dV(c,"code_execution_tool_result")&&dY(c.tool_use_id)&&dW(c.content)){yield{type:"server_tool_call_result",name:"code_execution",toolCallId:c.tool_use_id,status:"success",output:c.content};continue}else if(dV(c,"mcp_tool_use")){yield{id:c.id,type:"server_tool_call",name:"mcp_tool_use",args:c.input};continue}else if(dV(c,"mcp_tool_result")&&dY(c.tool_use_id)&&dW(c.content)){yield{type:"server_tool_call_result",name:"mcp_tool_use",toolCallId:c.tool_use_id,status:"success",output:c.content};continue}else if(dV(c,"container_upload")){yield{type:"server_tool_call",name:"container_upload",args:c.input};continue}else if(dV(c,"search_result")){yield{id:c.id,type:"non_standard",value:c};continue}else if(dV(c,"tool_result")){yield{id:c.id,type:"non_standard",value:c};continue}else{let a=d1(c);if(a){yield a;continue}}yield{type:"non_standard",value:c}}}())}function d4(a){return dI(a)?{type:a.type,mimeType:a.mime_type,url:a.url,metadata:a.metadata}:dJ(a)?{type:a.type,mimeType:a.mime_type??"application/octet-stream",data:a.data,metadata:a.metadata}:dL(a)?{type:a.type,mimeType:a.mime_type,fileId:a.id,metadata:a.metadata}:a}function d5(a){return a.map(d4)}function d6(a){let b=[];for(let c of a)(dV(c,"image_url")&&dW(c.image_url)||dV(c,"input_audio")&&dW(c.input_audio)||dV(c,"file")&&dW(c.file)?0:1)?b.push(c):b.push(function(a){if(dV(a,"image_url")&&dW(a.image_url)&&dY(a.image_url.url)){let b=dO({dataUrl:a.image_url.url});return b?{type:"image",mimeType:b.mime_type,data:b.data}:{type:"image",url:a.image_url.url}}if(dV(a,"input_audio")&&dW(a.input_audio)&&dY(a.input_audio.data)&&dY(a.input_audio.format))return{type:"audio",data:a.input_audio.data,mimeType:`audio/${a.input_audio.format}`};if(dV(a,"file")&&dW(a.file)&&dY(a.file.data)){let b=dO({dataUrl:a.file.data});if(b)return{type:"file",data:b.data,mimeType:b.mime_type};if(dY(a.file.file_id))return{type:"file",fileId:a.file.file_id}}return a}(c));return b}function d7(a){if("url_citation"===a.type){let{url:b,title:c,start_index:d,end_index:e}=a;return{type:"citation",url:b,title:c,startIndex:d,endIndex:e}}if("file_citation"===a.type){let{file_id:b,filename:c,index:d}=a;return{type:"citation",title:c,startIndex:d,endIndex:d,fileId:b}}return a}function d8(a){return Array.from(function*(){if(dW(a.additional_kwargs?.reasoning)&&dX(a.additional_kwargs.reasoning.summary)){let b=a.additional_kwargs.reasoning.summary.reduce((a,b)=>dW(b)&&dY(b.text)?`${a}${b.text}`:a,"");yield{type:"reasoning",reasoning:b}}for(let b of"string"==typeof a.content?[{type:"text",text:a.content}]:a.content)if(dV(b,"text")){let{text:a,annotations:c,...d}=b;Array.isArray(c)?yield{...d,type:"text",text:String(a),annotations:c.map(d7)}:yield{...d,type:"text",text:String(a)}}for(let b of a.tool_calls??[])yield{type:"tool_call",id:b.id,name:b.name,args:b.args};if(dW(a.additional_kwargs)&&dX(a.additional_kwargs.tool_outputs))for(let b of a.additional_kwargs.tool_outputs){if(dV(b,"web_search_call")){yield{id:b.id,type:"server_tool_call",name:"web_search",args:{query:b.query}};continue}if(dV(b,"file_search_call")){yield{id:b.id,type:"server_tool_call",name:"file_search",args:{query:b.query}};continue}if(dV(b,"computer_call")){yield{type:"non_standard",value:b};continue}else if(dV(b,"code_interpreter_call")){if(dY(b.code)&&(yield{id:b.id,type:"server_tool_call",name:"code_interpreter",args:{code:b.code}}),dX(b.outputs)){let a=d0(()=>{if("in_progress"!==b.status){if("completed"===b.status)return 0;if("incomplete"===b.status)return 127;if("interpreting"!==b.status&&"failed"===b.status)return 1}});for(let c of b.outputs)if(dV(c,"logs")){yield{type:"server_tool_call_result",toolCallId:b.id??"",status:"success",output:{type:"code_interpreter_output",returnCode:a??0,stderr:[0,void 0].includes(a)?void 0:String(c.logs),stdout:[0,void 0].includes(a)?String(c.logs):void 0}};continue}}continue}else if(dV(b,"mcp_call")){yield{id:b.id,type:"server_tool_call",name:"mcp_call",args:b.input};continue}else if(dV(b,"mcp_list_tools")){yield{id:b.id,type:"server_tool_call",name:"mcp_list_tools",args:b.input};continue}else if(dV(b,"mcp_approval_request")){yield{type:"non_standard",value:b};continue}else if(dV(b,"image_generation_call")){yield{type:"non_standard",value:b};continue}dW(b)&&(yield{type:"non_standard",value:b})}}())}function d9(a){return"object"==typeof a&&null!==a&&"type"in a&&"content"in a&&("string"==typeof a.content||Array.isArray(a.content))}let ea=Symbol.for("langchain.message");function eb(a,b){if("string"==typeof a)return""===a?b:"string"==typeof b?a+b:Array.isArray(b)&&0===b.length?a:Array.isArray(b)&&b.some(a=>dH(a))?[{type:"text",source_type:"text",text:a},...b]:[{type:"text",text:a},...b];return Array.isArray(b)?eg(a,b)??[...a,...b]:""===b?a:Array.isArray(a)&&a.some(a=>dH(a))?[...a,{type:"file",source_type:"text",text:b}]:[...a,{type:"text",text:b}]}function ec(a,b){return"error"===a||"error"===b?"error":"success"}var ed=class extends dU{lc_namespace=["langchain_core","messages"];lc_serializable=!0;get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}[ea]=!0;id;name;content;additional_kwargs;response_metadata;_getType(){return this.type}getType(){return this._getType()}constructor(a){const b="string"==typeof a||Array.isArray(a)?{content:a}:a;b.additional_kwargs||(b.additional_kwargs={}),b.response_metadata||(b.response_metadata={}),super(b),this.name=b.name,void 0===b.content&&void 0!==b.contentBlocks?(this.content=b.contentBlocks,this.response_metadata={output_version:"v1",...b.response_metadata}):(void 0!==b.content?this.content=b.content??[]:this.content=[],this.response_metadata=b.response_metadata),this.additional_kwargs=b.additional_kwargs,this.id=b.id}get text(){return"string"==typeof this.content?this.content:Array.isArray(this.content)?this.content.map(a=>"string"==typeof a?a:"text"===a.type?a.text:"").join(""):""}get contentBlocks(){return[d5,d6,d2].reduce((a,b)=>b(a),"string"==typeof this.content?[{type:"text",text:this.content}]:this.content)}toDict(){return{type:this.getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}static isInstance(a){return"object"==typeof a&&null!==a&&ea in a&&!0===a[ea]&&d9(a)}_updateId(a){this.id=a,this.lc_kwargs.id=a}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](a){var b,c;if(null===a)return this;let d=(b=this._printableFields,c=Math.max(4,a),JSON.stringify(function a(b,d){if("object"!=typeof b||null==b)return b;if(d>=c)return Array.isArray(b)?"[Array]":"[Object]";if(Array.isArray(b))return b.map(b=>a(b,d+1));let e={};for(let c of Object.keys(b))e[c]=a(b[c],d+1);return e}(b,0),null,2));return`${this.constructor.lc_name()} ${d}`}toFormattedString(a="pretty"){return function(a,b="pretty"){return"pretty"===b?function(a){let b=[],c=` ${a.type.charAt(0).toUpperCase()+a.type.slice(1)} Message `,d=Math.floor((80-c.length)/2),e="=".repeat(d),f=c.length%2==0?e:`${e}=`;if(b.push(`${e}${c}${f}`),"ai"===a.type&&a.tool_calls&&a.tool_calls.length>0)for(let c of(b.push("Tool Calls:"),a.tool_calls))for(let[a,d]of(b.push(`  ${c.name} (${c.id})`),b.push(` Call ID: ${c.id}`),b.push("  Args:"),Object.entries(c.args)))b.push(`    ${a}: ${d}`);return"tool"===a.type&&a.name&&b.push(`Name: ${a.name}`),"string"==typeof a.content&&a.content.trim()&&(b.length>1&&b.push(""),b.push(a.content)),b.join("\n")}(a):JSON.stringify(a)}(this,a)}};function ee(a){return Array.isArray(a)&&a.every(a=>"number"==typeof a.index)}function ef(a={},b={}){let c={...a};for(let[a,d]of Object.entries(b))if(null==c[a])c[a]=d;else if(null==d)continue;else if(typeof c[a]!=typeof d||Array.isArray(c[a])!==Array.isArray(d))throw Error(`field[${a}] already exists in the message chunk, but with a different type.`);else if("string"==typeof c[a])if("type"===a)continue;else["id","name","output_version","model_provider"].includes(a)?d&&(c[a]=d):c[a]+=d;else if("object"!=typeof c[a]||Array.isArray(c[a]))if(Array.isArray(c[a]))c[a]=eg(c[a],d);else{if(c[a]===d)continue;console.warn(`field[${a}] already exists in this message chunk and value has unsupported type.`)}else c[a]=ef(c[a],d);return c}function eg(a,b){if(void 0!==a||void 0!==b){if(void 0===a||void 0===b)return a||b;let c=[...a];for(let a of b)if("object"==typeof a&&null!==a&&"index"in a&&"number"==typeof a.index){let b=c.findIndex(b=>{let c="object"==typeof b,d="index"in b&&b.index===a.index,e="id"in b&&"id"in a&&b?.id===a?.id,f=!("id"in b)||!b?.id||!("id"in a)||!a?.id;return c&&d&&(e||f)});-1!==b&&"object"==typeof c[b]&&null!==c[b]?c[b]=ef(c[b],a):c.push(a)}else{if("object"==typeof a&&null!==a&&"text"in a&&""===a.text)continue;c.push(a)}return c}}function eh(a,b){if(!a&&!b)throw Error("Cannot merge two undefined objects.");if(!a||!b)return a||b;if(typeof a!=typeof b)throw Error(`Cannot merge objects of different types.
Left ${typeof a}
Right ${typeof b}`);if("string"==typeof a&&"string"==typeof b)return a+b;if(Array.isArray(a)&&Array.isArray(b))return eg(a,b);if("object"==typeof a&&"object"==typeof b)return ef(a,b);else if(a===b)return a;else throw Error(`Can not merge objects of different types.
Left ${a}
Right ${b}`)}var ei=class a extends ed{static isInstance(b){if(!super.isInstance(b))return!1;let c=Object.getPrototypeOf(b);for(;null!==c;){if(c===a.prototype)return!0;c=Object.getPrototypeOf(c)}return!1}};function ej(a){return"string"==typeof a.role}function ek(a){return"function"==typeof a?._getType}function el(a){return ei.isInstance(a)}function em(a){return null!=a&&"object"==typeof a&&"lc_direct_tool_output"in a&&!0===a.lc_direct_tool_output}dy({},{ToolMessage:()=>en,ToolMessageChunk:()=>eo,defaultToolCallParser:()=>ep,isDirectToolOutput:()=>em,isToolMessage:()=>eq,isToolMessageChunk:()=>er});var en=class extends ed{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}lc_direct_tool_output=!0;type="tool";status;tool_call_id;metadata;artifact;constructor(a,b,c){const d="string"==typeof a||Array.isArray(a)?{content:a,name:c,tool_call_id:b}:a;super(d),this.tool_call_id=d.tool_call_id,this.artifact=d.artifact,this.status=d.status,this.metadata=d.metadata}static isInstance(a){return super.isInstance(a)&&"tool"===a.type}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},eo=class extends ei{type="tool";tool_call_id;status;artifact;constructor(a){super(a),this.tool_call_id=a.tool_call_id,this.artifact=a.artifact,this.status=a.status}static lc_name(){return"ToolMessageChunk"}concat(a){return new this.constructor({content:eb(this.content,a.content),additional_kwargs:ef(this.additional_kwargs,a.additional_kwargs),response_metadata:ef(this.response_metadata,a.response_metadata),artifact:eh(this.artifact,a.artifact),tool_call_id:this.tool_call_id,id:this.id??a.id,status:ec(this.status,a.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function ep(a){let b=[],c=[];for(let d of a)if(!d.function)continue;else{let a=d.function.name;try{let c=JSON.parse(d.function.arguments);b.push({name:a||"",args:c||{},id:d.id})}catch{c.push({name:a,args:d.function.arguments,id:d.id,error:"Malformed args."})}}return[b,c]}function eq(a){return"object"==typeof a&&null!==a&&"getType"in a&&"function"==typeof a.getType&&"tool"===a.getType()}function er(a){return"tool"===a._getType()}function es(a,b){return a.lc_error_code=b,a.message=`${a.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${b}/
`,a}function et(a){return!!(a&&"object"==typeof a&&"type"in a&&"tool_call"===a.type)}var eu=class extends Error{output;constructor(a,b){super(a),this.output=b}};function ev(a,b=ew){let c=(a=a.trim()).indexOf("```");if(-1===c)return b(a);let d=a.substring(c+3);d.startsWith("json\n")?d=d.substring(5):d.startsWith("json")?d=d.substring(4):d.startsWith("\n")&&(d=d.substring(1));let e=d.indexOf("```"),f=d;return -1!==e&&(f=d.substring(0,e)),b(f.trim())}function ew(a){try{if(void 0===a)return null;return function(a){try{return JSON.parse(a)}catch{}let b=a.trim();if(0===b.length)throw Error("Unexpected end of JSON input");let c=0;function d(){for(;c<b.length&&/\s/.test(b[c]);)c+=1}function e(){if('"'!==b[c])throw Error(`Expected '"' at position ${c}, got '${b[c]}'`);c+=1;let a="",d=!1;for(;c<b.length;){let e=b[c];if(d){if("n"===e)a+="\n";else if("t"===e)a+="	";else if("r"===e)a+="\r";else if("\\"===e)a+="\\";else if('"'===e)a+='"';else if("b"===e)a+="\b";else if("f"===e)a+="\f";else if("/"===e)a+="/";else if("u"===e){let d=b.substring(c+1,c+5);if(/^[0-9A-Fa-f]{0,4}$/.test(d))4===d.length?a+=String.fromCharCode(Number.parseInt(d,16)):a+=`u${d}`,c+=d.length;else throw Error(`Invalid unicode escape sequence '\\u${d}' at position ${c}`)}else throw Error(`Invalid escape sequence '\\${e}' at position ${c}`);d=!1}else if("\\"===e)d=!0;else{if('"'===e)return c+=1,a;a+=e}c+=1}return d&&(a+="\\"),a}let f=function a(){if(d(),c>=b.length)throw Error(`Unexpected end of input at position ${c}`);let f=b[c];if("{"===f){if("{"!==b[c])throw Error(`Expected '{' at position ${c}, got '${b[c]}'`);let f={};if(c+=1,d(),c>=b.length)return f;if("}"===b[c])return c+=1,f;for(;c<b.length&&(d(),!(c>=b.length));){let g=e();if(d(),c>=b.length)break;if(":"!==b[c])throw Error(`Expected ':' at position ${c}, got '${b[c]}'`);if(c+=1,d(),c>=b.length||(f[g]=a(),d(),c>=b.length))break;if("}"===b[c]){c+=1;break}if(","===b[c]){c+=1;continue}throw Error(`Expected ',' or '}' at position ${c}, got '${b[c]}'`)}return f}if("["===f){if("["!==b[c])throw Error(`Expected '[' at position ${c}, got '${b[c]}'`);let e=[];if(c+=1,d(),c>=b.length)return e;if("]"===b[c])return c+=1,e;for(;c<b.length&&(d(),!(c>=b.length))&&(e.push(a()),d(),!(c>=b.length));){;if("]"===b[c]){c+=1;break}if(","===b[c]){c+=1;continue}throw Error(`Expected ',' or ']' at position ${c}, got '${b[c]}'`)}return e}if('"'===f)return e();if("null".startsWith(b.substring(c,c+4)))return c+=Math.min(4,b.length-c),null;if("true".startsWith(b.substring(c,c+4)))return c+=Math.min(4,b.length-c),!0;if("false".startsWith(b.substring(c,c+5)))return c+=Math.min(5,b.length-c),!1;if("-"===f||f>="0"&&f<="9"){let a=c,d="";if("-"===b[c]&&(d+="-",c+=1),c<b.length&&"0"===b[c]&&(d+="0",b[c+=1]>="0"&&b[c]<="9"))throw Error(`Invalid number at position ${a}`);if(c<b.length&&b[c]>="1"&&b[c]<="9")for(;c<b.length&&b[c]>="0"&&b[c]<="9";)d+=b[c],c+=1;if(c<b.length&&"."===b[c])for(d+=".",c+=1;c<b.length&&b[c]>="0"&&b[c]<="9";)d+=b[c],c+=1;if(c<b.length&&("e"===b[c]||"E"===b[c]))for(d+=b[c],(c+=1)<b.length&&("+"===b[c]||"-"===b[c])&&(d+=b[c],c+=1);c<b.length&&b[c]>="0"&&b[c]<="9";)d+=b[c],c+=1;if("-"===d)return -0;let e=Number.parseFloat(d);if(Number.isNaN(e))throw c=a,Error(`Invalid number '${d}' at position ${a}`);return e}throw Error(`Unexpected character '${f}' at position ${c}`)}();if(d(),c<b.length)throw Error(`Unexpected character '${b[c]}' at position ${c}`);return f}(a)}catch{return null}}var ex=class a extends ed{static lc_name(){return"ChatMessage"}type="generic";role;static _chatMessageClass(){return a}constructor(a,b){("string"==typeof a||Array.isArray(a))&&(a={content:a,role:b}),super(a),this.role=a.role}static isInstance(a){return super.isInstance(a)&&"generic"===a.type}get _printableFields(){return{...super._printableFields,role:this.role}}},ey=class extends ei{static lc_name(){return"ChatMessageChunk"}type="generic";role;constructor(a,b){("string"==typeof a||Array.isArray(a))&&(a={content:a,role:b}),super(a),this.role=a.role}concat(a){return new this.constructor({content:eb(this.content,a.content),additional_kwargs:ef(this.additional_kwargs,a.additional_kwargs),response_metadata:ef(this.response_metadata,a.response_metadata),role:this.role,id:this.id??a.id})}static isInstance(a){return super.isInstance(a)&&"generic"===a.type}get _printableFields(){return{...super._printableFields,role:this.role}}};function ez(a){return"generic"===a._getType()}function eA(a){return"generic"===a._getType()}var eB=class extends ed{static lc_name(){return"FunctionMessage"}type="function";name;constructor(a){super(a),this.name=a.name}},eC=class extends ei{static lc_name(){return"FunctionMessageChunk"}type="function";concat(a){return new this.constructor({content:eb(this.content,a.content),additional_kwargs:ef(this.additional_kwargs,a.additional_kwargs),response_metadata:ef(this.response_metadata,a.response_metadata),name:this.name??"",id:this.id??a.id})}};function eD(a){return"function"===a._getType()}function eE(a){return"function"===a._getType()}var eF=class extends ed{static lc_name(){return"HumanMessage"}type="human";constructor(a){super(a)}static isInstance(a){return super.isInstance(a)&&"human"===a.type}},eG=class extends ei{static lc_name(){return"HumanMessageChunk"}type="human";constructor(a){super(a)}concat(a){return new this.constructor({content:eb(this.content,a.content),additional_kwargs:ef(this.additional_kwargs,a.additional_kwargs),response_metadata:ef(this.response_metadata,a.response_metadata),id:this.id??a.id})}static isInstance(a){return super.isInstance(a)&&"human"===a.type}};function eH(a){return"human"===a.getType()}function eI(a){return"human"===a.getType()}var eJ=class extends ed{type="remove";id;constructor(a){super({...a,content:[]}),this.id=a.id}get _printableFields(){return{...super._printableFields,id:this.id}}static isInstance(a){return super.isInstance(a)&&"remove"===a.type}},eK=class a extends ed{static lc_name(){return"SystemMessage"}type="system";constructor(a){super(a)}concat(b){if("string"==typeof b)return new a({...this,content:eb(this.content,b)});if(a.isInstance(b))return new a({...this,additional_kwargs:{...this.additional_kwargs,...b.additional_kwargs},response_metadata:{...this.response_metadata,...b.response_metadata},content:eb(this.content,b.content)});throw Error("Unexpected chunk type for system message")}static isInstance(a){return super.isInstance(a)&&"system"===a.type}},eL=class extends ei{static lc_name(){return"SystemMessageChunk"}type="system";constructor(a){super(a)}concat(a){return new this.constructor({content:eb(this.content,a.content),additional_kwargs:ef(this.additional_kwargs,a.additional_kwargs),response_metadata:ef(this.response_metadata,a.response_metadata),id:this.id??a.id})}static isInstance(a){return super.isInstance(a)&&"system"===a.type}};function eM(a){return"system"===a._getType()}function eN(a){return"system"===a._getType()}function eO(a){switch(a){case"csv":return"text/csv";case"doc":case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"html":return"text/html";case"md":return"text/markdown";case"pdf":return"application/pdf";case"txt":return"text/plain";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"gif":return"image/gif";case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"flv":return"video/flv";case"mkv":return"video/mkv";case"mov":return"video/mov";case"mp4":return"video/mp4";case"mpeg":return"video/mpeg";case"mpg":return"video/mpg";case"three_gp":return"video/three_gp";case"webm":return"video/webm";case"wmv":return"video/wmv";default:return"application/octet-stream"}}function eP(a){return Array.from(function*(){for(let b of"string"==typeof a.content?[{type:"text",text:a.content}]:a.content){if(dV(b,"cache_point")){yield{type:"non_standard",value:b};continue}if(dV(b,"citations_content")&&dW(b.citationsContent)){let a=dX(b.citationsContent.content)?b.citationsContent.content.reduce((a,b)=>dW(b)&&dY(b.text)?a+b.text:a,""):"",c=dX(b.citationsContent.citations)?b.citationsContent.citations.reduce((a,b)=>{if(dW(b)){let c=dX(b.sourceContent)?b.sourceContent.reduce((a,b)=>dW(b)&&dY(b.text)?a+b.text:a,""):"",d=d0(()=>{if(dW(b.location)){let a=b.location.documentChar||b.location.documentPage||b.location.documentChunk;if(dW(a))return{source:dZ(a.documentIndex)?a.documentIndex.toString():void 0,startIndex:dZ(a.start)?a.start:void 0,endIndex:dZ(a.end)?a.end:void 0}}return{}});a.push({type:"citation",citedText:c,...d})}return a},[]):[];yield{type:"text",text:a,annotations:c};continue}if(dV(b,"document")&&dW(b.document)){yield function(a){if(dW(a.document)&&dW(a.document.source)){let b=eO(dW(a.document)&&dY(a.document.format)?a.document.format:"");if(dW(a.document.source)){if(dW(a.document.source.s3Location)&&dY(a.document.source.s3Location.uri))return{type:"file",mimeType:b,fileId:a.document.source.s3Location.uri};if(d$(a.document.source.bytes))return{type:"file",mimeType:b,data:a.document.source.bytes};if(dY(a.document.source.text))return{type:"file",mimeType:b,data:Buffer.from(a.document.source.text).toString("base64")};if(dX(a.document.source.content))return{type:"file",mimeType:b,data:a.document.source.content.reduce((a,b)=>dW(b)&&dY(b.text)?a+b.text:a,"")}}}return{type:"non_standard",value:a}}(b);continue}else if(dV(b,"guard_content")){yield{type:"non_standard",value:b};continue}else if(dV(b,"image")&&dW(b.image)){yield function(a){if(dV(a,"image")&&dW(a.image)){let b=eO(dW(a.image)&&dY(a.image.format)?a.image.format:"");if(dW(a.image.source)){if(dW(a.image.source.s3Location)&&dY(a.image.source.s3Location.uri))return{type:"image",mimeType:b,fileId:a.image.source.s3Location.uri};if(d$(a.image.source.bytes))return{type:"image",mimeType:b,data:a.image.source.bytes}}}return{type:"non_standard",value:a}}(b);continue}else if(dV(b,"reasoning_content")&&dY(b.reasoningText)){yield{type:"reasoning",reasoning:b.reasoningText};continue}else if(dV(b,"text")&&dY(b.text)){yield{type:"text",text:b.text};continue}else if(dV(b,"tool_result")){yield{type:"non_standard",value:b};continue}else if(dV(b,"tool_call"))continue;else if(dV(b,"video")&&dW(b.video)){yield function(a){if(dV(a,"video")&&dW(a.video)){let b=eO(dW(a.video)&&dY(a.video.format)?a.video.format:"");if(dW(a.video.source)){if(dW(a.video.source.s3Location)&&dY(a.video.source.s3Location.uri))return{type:"video",mimeType:b,fileId:a.video.source.s3Location.uri};if(d$(a.video.source.bytes))return{type:"video",mimeType:b,data:a.video.source.bytes}}}return{type:"non_standard",value:a}}(b);continue}yield{type:"non_standard",value:b}}}())}function eQ(a){return Array.from(function*(){for(let b of"string"==typeof a.content?[{type:"text",text:a.content}]:a.content){if(dV(b,"text")&&dY(b.text)){yield{type:"text",text:b.text};continue}if(dV(b,"inlineData")&&dW(b.inlineData)&&dY(b.inlineData.mimeType)&&dY(b.inlineData.data)){yield{type:"file",mimeType:b.inlineData.mimeType,data:b.inlineData.data};continue}if(dV(b,"functionCall")&&dW(b.functionCall)&&dY(b.functionCall.name)&&dW(b.functionCall.args)){yield{type:"tool_call",id:a.id,name:b.functionCall.name,args:b.functionCall.args};continue}else if(dV(b,"functionResponse")){yield{type:"non_standard",value:b};continue}else if(dV(b,"fileData")&&dW(b.fileData)&&dY(b.fileData.mimeType)&&dY(b.fileData.fileUri)){yield{type:"file",mimeType:b.fileData.mimeType,fileId:b.fileData.fileUri};continue}else if(dV(b,"executableCode")){yield{type:"non_standard",value:b};continue}else if(dV(b,"codeExecutionResult")){yield{type:"non_standard",value:b};continue}yield{type:"non_standard",value:b}}}())}function eR(a){return Array.from(function*(){let b="string"==typeof a.content?[{type:"text",text:a.content}]:a.content;for(let c of b){if(dV(c,"reasoning")&&dY(c.reasoning)){let d=d0(()=>{let d=b.indexOf(c);if(dX(a.additional_kwargs?.signatures)&&d>=0)return a.additional_kwargs.signatures.at(d)});dY(d)?yield{type:"reasoning",reasoning:c.reasoning,signature:d}:yield{type:"reasoning",reasoning:c.reasoning};continue}if(dV(c,"text")&&dY(c.text)){yield{type:"text",text:c.text};continue}if(dV(c,"image_url")){if(dY(c.image_url))if(c.image_url.startsWith("data:")){let a=/^data:([^;]+);base64,(.+)$/,b=c.image_url.match(a);b?yield{type:"image",data:b[2],mimeType:b[1]}:yield{type:"image",url:c.image_url}}else yield{type:"image",url:c.image_url};continue}else if(dV(c,"media")&&dY(c.mimeType)&&dY(c.data)){yield{type:"file",mimeType:c.mimeType,data:c.data};continue}yield{type:"non_standard",value:c}}}())}function eS(a){return globalThis.lc_block_translators_registry.get(a)}function eT(a,b){return ef(a??{},b??{})}function eU(a,b){let c={};return(a?.audio!==void 0||b?.audio!==void 0)&&(c.audio=(a?.audio??0)+(b?.audio??0)),(a?.image!==void 0||b?.image!==void 0)&&(c.image=(a?.image??0)+(b?.image??0)),(a?.video!==void 0||b?.video!==void 0)&&(c.video=(a?.video??0)+(b?.video??0)),(a?.document!==void 0||b?.document!==void 0)&&(c.document=(a?.document??0)+(b?.document??0)),(a?.text!==void 0||b?.text!==void 0)&&(c.text=(a?.text??0)+(b?.text??0)),c}function eV(a,b){var c,d,e,f;let g,h;return{input_tokens:(a?.input_tokens??0)+(b?.input_tokens??0),output_tokens:(a?.output_tokens??0)+(b?.output_tokens??0),total_tokens:(a?.total_tokens??0)+(b?.total_tokens??0),input_token_details:(g={...eU(c=a?.input_token_details,d=b?.input_token_details)},(c?.cache_read!==void 0||d?.cache_read!==void 0)&&(g.cache_read=(c?.cache_read??0)+(d?.cache_read??0)),(c?.cache_creation!==void 0||d?.cache_creation!==void 0)&&(g.cache_creation=(c?.cache_creation??0)+(d?.cache_creation??0)),g),output_token_details:(h={...eU(e=a?.output_token_details,f=b?.output_token_details)},(e?.reasoning!==void 0||f?.reasoning!==void 0)&&(h.reasoning=(e?.reasoning??0)+(f?.reasoning??0)),h)}}globalThis.lc_block_translators_registry??=new Map([["anthropic",{translateContent:d3,translateContentChunk:d3}],["bedrock-converse",{translateContent:eP,translateContentChunk:eP}],["google-genai",{translateContent:eQ,translateContentChunk:eQ}],["google-vertexai",{translateContent:eR,translateContentChunk:eR}],["openai",{translateContent:a=>{if("string"==typeof a.content){let b=[];for(let c of("string"==typeof a.content?b.push({type:"text",text:a.content}):b.push(...d6(a.content)),a.tool_calls??[]))b.push({type:"tool_call",id:c.id,name:c.name,args:c.args});return b}return d8(a)},translateContentChunk:a=>{if("string"==typeof a.content){let b=[];for(let c of("string"==typeof a.content?b.push({type:"text",text:a.content}):b.push(...d6(a.content)),a.tool_calls??[]))b.push({type:"tool_call",id:c.id,name:c.name,args:c.args});return b}return Array.from(function*(){for(let b of(yield*d8(a),a.tool_call_chunks??[]))yield{type:"tool_call_chunk",id:b.id,name:b.name,args:b.args}}())}}]]);var eW=class extends ed{type="ai";tool_calls=[];invalid_tool_calls=[];usage_metadata;get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(a){let b;if("string"==typeof a||Array.isArray(a))b={content:a,tool_calls:[],invalid_tool_calls:[],additional_kwargs:{}};else{b=a;const c=b.additional_kwargs?.tool_calls,d=b.tool_calls;null!=c&&c.length>0&&(void 0===d||0===d.length)&&console.warn("New LangChain packages are available that more efficiently handle tool calling.\n\nPlease upgrade your packages to versions that set message tool calls. e.g., `pnpm install @langchain/anthropic`, pnpm install @langchain/openai`, etc.");try{if(null!=c&&void 0===d){const[a,d]=ep(c);b.tool_calls=a??[],b.invalid_tool_calls=d??[]}else b.tool_calls=b.tool_calls??[],b.invalid_tool_calls=b.invalid_tool_calls??[]}catch{b.tool_calls=[],b.invalid_tool_calls=[]}if(void 0!==b.response_metadata&&"output_version"in b.response_metadata&&"v1"===b.response_metadata.output_version&&(b.contentBlocks=b.content,b.content=void 0),void 0!==b.contentBlocks){b.contentBlocks.push(...b.tool_calls.map(a=>({type:"tool_call",id:a.id,name:a.name,args:a.args})));const a=b.contentBlocks.filter(a=>"tool_call"===a.type).filter(a=>!b.tool_calls?.some(b=>b.id===a.id&&b.name===a.name));a.length>0&&(b.tool_calls=a.map(a=>({type:"tool_call",id:a.id,name:a.name,args:a.args})))}}super(b),"string"!=typeof b&&(this.tool_calls=b.tool_calls??this.tool_calls,this.invalid_tool_calls=b.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=b.usage_metadata}static lc_name(){return"AIMessage"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&"v1"===this.response_metadata.output_version)return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&"string"==typeof this.response_metadata.model_provider){let a=eS(this.response_metadata.model_provider);if(a)return a.translateContent(this)}let a=super.contentBlocks;if(this.tool_calls){let b=this.tool_calls.filter(b=>!a.some(a=>a.id===b.id&&a.name===b.name));a.push(...b.map(a=>({...a,type:"tool_call",id:a.id,name:a.name,args:a.args})))}return a}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}static isInstance(a){return super.isInstance(a)&&"ai"===a.type}};function eX(a){return"ai"===a._getType()}function eY(a){return"ai"===a._getType()}var eZ=class extends ei{type="ai";tool_calls=[];invalid_tool_calls=[];tool_call_chunks=[];usage_metadata;constructor(a){let b;super(b="string"==typeof a||Array.isArray(a)?{content:a,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]}:void 0===a.tool_call_chunks||0===a.tool_call_chunks.length?{...a,tool_calls:a.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:void 0!==a.usage_metadata?a.usage_metadata:void 0}:{...a,...e7(a.tool_call_chunks??[]),usage_metadata:void 0!==a.usage_metadata?a.usage_metadata:void 0}),this.tool_call_chunks=b.tool_call_chunks??this.tool_call_chunks,this.tool_calls=b.tool_calls??this.tool_calls,this.invalid_tool_calls=b.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=b.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&"v1"===this.response_metadata.output_version)return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&"string"==typeof this.response_metadata.model_provider){let a=eS(this.response_metadata.model_provider);if(a)return a.translateContent(this)}let a=super.contentBlocks;if(this.tool_calls&&"string"!=typeof this.content){let b=this.content.filter(a=>"tool_call"===a.type).map(a=>a.id);for(let c of this.tool_calls)c.id&&!b.includes(c.id)&&a.push({...c,type:"tool_call",id:c.id,name:c.name,args:c.args})}return a}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(a){let b={content:eb(this.content,a.content),additional_kwargs:ef(this.additional_kwargs,a.additional_kwargs),response_metadata:eT(this.response_metadata,a.response_metadata),tool_call_chunks:[],id:this.id??a.id};if(void 0!==this.tool_call_chunks||void 0!==a.tool_call_chunks){let c=eg(this.tool_call_chunks,a.tool_call_chunks);void 0!==c&&c.length>0&&(b.tool_call_chunks=c)}return(void 0!==this.usage_metadata||void 0!==a.usage_metadata)&&(b.usage_metadata=eV(this.usage_metadata,a.usage_metadata)),new this.constructor(b)}static isInstance(a){return super.isInstance(a)&&"ai"===a.type}};let e$=a=>a();function e_(a){return et(a)?a:"string"==typeof a.id&&"function"===a.type&&"object"==typeof a.function&&null!==a.function&&"arguments"in a.function&&"string"==typeof a.function.arguments&&"name"in a.function&&"string"==typeof a.function.name?{id:a.id,args:JSON.parse(a.function.arguments),name:a.function.name,type:"tool_call"}:a}function e0(a){let b,c;if("object"==typeof a&&null!=a&&1===a.lc&&Array.isArray(a.id)&&null!=a.kwargs&&"object"==typeof a.kwargs){let d=a.id.at(-1);b="HumanMessage"===d||"HumanMessageChunk"===d?"user":"AIMessage"===d||"AIMessageChunk"===d?"assistant":"SystemMessage"===d||"SystemMessageChunk"===d?"system":"FunctionMessage"===d||"FunctionMessageChunk"===d?"function":"ToolMessage"===d||"ToolMessageChunk"===d?"tool":"unknown",c=a.kwargs}else{let{type:d,...e}=a;b=d,c=e}if("human"===b||"user"===b)return new eF(c);if("ai"===b||"assistant"===b){let{tool_calls:a,...b}=c;if(!Array.isArray(a))return new eW(c);let d=a.map(e_);return new eW({...b,tool_calls:d})}if("system"===b)return new eK(c);if("developer"===b)return new eK({...c,additional_kwargs:{...c.additional_kwargs,__openai_role__:"developer"}});if("tool"===b&&"tool_call_id"in c)return new en({...c,content:c.content,tool_call_id:c.tool_call_id,name:c.name});if("remove"===b&&"id"in c&&"string"==typeof c.id)return new eJ({...c,id:c.id});throw es(Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(a,null,2)}`),"MESSAGE_COERCION_FAILURE")}function e1(a){if("string"==typeof a)return new eF(a);if(ek(a))return a;if(Array.isArray(a)){let[b,c]=a;return e0({type:b,content:c})}if(!ej(a))return e0(a);{let{role:b,...c}=a;return e0({...c,type:b})}}function e2(a,b="Human",c="AI"){let d=[];for(let e of a){let a;if("human"===e._getType())a=b;else if("ai"===e._getType())a=c;else if("system"===e._getType())a="System";else if("tool"===e._getType())a="Tool";else if("generic"===e._getType())a=e.role;else throw Error(`Got unsupported message type: ${e._getType()}`);let f=e.name?`${e.name}, `:"",g="string"==typeof e.content?e.content:JSON.stringify(e.content,null,2);d.push(`${a}: ${f}${g}`)}return d.join("\n")}function e3(a){let b=void 0!==a.data?a:{type:a.type,data:{content:a.text,role:a.role,name:void 0,tool_call_id:void 0}};switch(b.type){case"human":return new eF(b.data);case"ai":return new eW(b.data);case"system":return new eK(b.data);case"function":if(void 0===b.data.name)throw Error("Name must be defined for function messages");return new eB(b.data);case"tool":if(void 0===b.data.tool_call_id)throw Error("Tool call ID must be defined for tool messages");return new en(b.data);case"generic":if(void 0===b.data.role)throw Error("Role must be defined for chat messages");return new ex(b.data);default:throw Error(`Got unexpected type: ${b.type}`)}}function e4(a){return a.map(e3)}function e5(a){return a.map(a=>a.toDict())}function e6(a){let b=a._getType();if("human"===b)return new eG({...a});if("ai"===b){let b={...a};return"tool_calls"in b&&(b={...b,tool_call_chunks:b.tool_calls?.map(a=>({...a,type:"tool_call_chunk",index:void 0,args:JSON.stringify(a.args)}))}),new eZ({...b})}if("system"===b)return new eL({...a});if("function"===b)return new eC({...a});if(ex.isInstance(a))return new ey({...a});else throw Error("Unknown message type.")}function e7(a){let b=a.reduce((a,b)=>{let c=a.findIndex(([a])=>"id"in b&&b.id&&"index"in b&&void 0!==b.index?b.id===a.id&&b.index===a.index:"id"in b&&b.id?b.id===a.id:"index"in b&&void 0!==b.index&&b.index===a.index);return -1!==c?a[c].push(b):a.push([b]),a},[]),c=[],d=[];for(let a of b){let b=null,e=a[0]?.name??"",f=a.map(a=>a.args||"").join("").trim(),g=f.length?f:"{}",h=a[0]?.id;try{if(b=ew(g),!h||null===b||"object"!=typeof b||Array.isArray(b))throw Error("Malformed tool call chunk args.");c.push({name:e,args:b,id:h,type:"tool_call"})}catch{d.push({name:e,args:g,id:h,error:"Malformed args.",type:"invalid_tool_call"})}}return{tool_call_chunks:a,tool_calls:c,invalid_tool_calls:d}}var e8=a.i(666680);let e9={randomUUID:e8.default.randomUUID},fa=new Uint8Array(256),fb=fa.length,fc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,fd=function(a){return"string"==typeof a&&fc.test(a)},fe=[];for(let a=0;a<256;++a)fe.push((a+256).toString(16).slice(1));function ff(a,b=0){return(fe[a[b+0]]+fe[a[b+1]]+fe[a[b+2]]+fe[a[b+3]]+"-"+fe[a[b+4]]+fe[a[b+5]]+"-"+fe[a[b+6]]+fe[a[b+7]]+"-"+fe[a[b+8]]+fe[a[b+9]]+"-"+fe[a[b+10]]+fe[a[b+11]]+fe[a[b+12]]+fe[a[b+13]]+fe[a[b+14]]+fe[a[b+15]]).toLowerCase()}let fg=function(a,b,c){if(e9.randomUUID&&!b&&!a)return e9.randomUUID();let d=(a=a||{}).random||(a.rng||function(){return fb>fa.length-16&&(e8.default.randomFillSync(fa),fb=0),fa.slice(fb,fb+=16)})();if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,b){c=c||0;for(let a=0;a<16;++a)b[c+a]=d[a];return b}return ff(d)};dy({},{BaseCallbackHandler:()=>fj,callbackHandlerPrefersStreaming:()=>fi,isBaseCallbackHandler:()=>fk});var fh=class{};function fi(a){return"lc_prefer_streaming"in a&&a.lc_prefer_streaming}var fj=class extends fh{lc_serializable=!1;get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,dT(this.constructor)]}lc_kwargs;ignoreLLM=!1;ignoreChain=!1;ignoreAgent=!1;ignoreRetriever=!1;ignoreCustomEvent=!1;raiseError=!1;awaitHandlers="false"===dG("LANGCHAIN_CALLBACKS_BACKGROUND");constructor(a){super(),this.lc_kwargs=a||{},a&&(this.ignoreLLM=a.ignoreLLM??this.ignoreLLM,this.ignoreChain=a.ignoreChain??this.ignoreChain,this.ignoreAgent=a.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=a.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=a.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=a.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(a._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return dU.prototype.toJSON.call(this)}toJSONNotImplemented(){return dU.prototype.toJSONNotImplemented.call(this)}static fromMethods(a){class b extends fj{name=fg();constructor(){super(),Object.assign(this,a)}}return new b}};let fk=a=>void 0!==a&&"function"==typeof a.copy&&"string"==typeof a.name&&"boolean"==typeof a.awaitHandlers,fl=function(a){let b;if(!fd(a))throw TypeError("Invalid UUID");let c=new Uint8Array(16);return c[0]=(b=parseInt(a.slice(0,8),16))>>>24,c[1]=b>>>16&255,c[2]=b>>>8&255,c[3]=255&b,c[4]=(b=parseInt(a.slice(9,13),16))>>>8,c[5]=255&b,c[6]=(b=parseInt(a.slice(14,18),16))>>>8,c[7]=255&b,c[8]=(b=parseInt(a.slice(19,23),16))>>>8,c[9]=255&b,c[10]=(b=parseInt(a.slice(24,36),16))/0x10000000000&255,c[11]=b/0x100000000&255,c[12]=b>>>24&255,c[13]=b>>>16&255,c[14]=b>>>8&255,c[15]=255&b,c},fm=function(a,b,c){function d(a,b,d,e){var f;if("string"==typeof a&&(a=function(a){a=unescape(encodeURIComponent(a));let b=[];for(let c=0;c<a.length;++c)b.push(a.charCodeAt(c));return b}(a)),"string"==typeof b&&(b=fl(b)),(null==(f=b)?void 0:f.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let g=new Uint8Array(16+a.length);if(g.set(b),g.set(a,b.length),(g=c(g))[6]=15&g[6]|80,g[8]=63&g[8]|128,d){e=e||0;for(let a=0;a<16;++a)d[e+a]=g[a];return d}return ff(g)}try{d.name="v5"}catch(a){}return d.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",d.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",d}(0,0,function(a){return Array.isArray(a)?a=Buffer.from(a):"string"==typeof a&&(a=Buffer.from(a,"utf8")),e8.default.createHash("sha1").update(a).digest()}),fn="gen_ai.request.model",fo="gen_ai.usage.input_tokens",fp="gen_ai.usage.output_tokens",fq="gen_ai.usage.total_tokens",fr="langsmith.span.tags";a.s(["__version__",()=>fu],762767);let fs=Symbol.for("ls:fetch_implementation"),ft=()=>fy("PROJECT")??fx("LANGCHAIN_SESSION")??"default",fu="0.3.72",fv=()=>c||(c="undefined"!=typeof Bun?"bun":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||"undefined"!=typeof Deno?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom")?"jsdom":"undefined"!=typeof Deno?"deno":"other":"node");function fw(){return void 0===d&&(d={library:"langsmith",runtime:fv(),sdk:"langsmith-js",sdk_version:fu,...function(){if(void 0!==e)return e;let a={};for(let b of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let c=fx(b);void 0!==c&&(a[b]=c)}return e=a,a}()}),d}function fx(a){try{return"undefined"!=typeof process?process.env?.[a]:void 0}catch(a){return}}function fy(a){return fx(`LANGSMITH_${a}`)||fx(`LANGCHAIN_${a}`)}function fz(){return"true"===fx("OTEL_ENABLED")||"true"===fy("OTEL_ENABLED")}class fA{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(a,...b){let c;if(!this.hasWarned&&fz()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0),1===b.length&&"function"==typeof b[0]?c=b[0]:2===b.length&&"function"==typeof b[1]?c=b[1]:3===b.length&&"function"==typeof b[2]&&(c=b[2]),"function"==typeof c)return c()}}let fB=Symbol.for("ls:otel_trace"),fC=Symbol.for("ls:otel_context"),fD=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),fE=new class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new fA})}getTracer(a,b){return this.mockTracer}getActiveSpan(){}setSpan(a,b){return a}getSpan(a){}setSpanContext(a,b){return a}getTracerProvider(){}setGlobalTracerProvider(a){return!1}},fF=new class{active(){return{}}with(a,b){return b()}},fG=new class{getTraceInstance(){return globalThis[fB]??fE}getContextInstance(){return globalThis[fC]??fF}initializeGlobalInstances(a){void 0===globalThis[fB]&&(globalThis[fB]=a.trace),void 0===globalThis[fC]&&(globalThis[fC]=a.context)}setDefaultOTLPTracerComponents(a){globalThis[fD]=a}getDefaultOTLPTracerComponents(){return globalThis[fD]??void 0}};function fH(){return fG.getTraceInstance()}let fI={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};class fJ{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(a,b){for(let c of a)try{if(!c.run)continue;if("post"===c.operation){let a=this.createSpanForRun(c,c.run,b.get(c.id));a&&!c.run.end_time&&this.spans.set(c.id,a)}else this.updateSpanForRun(c,c.run)}catch(a){console.error(`Error processing operation ${c.id}:`,a)}}createSpanForRun(a,b,c){let d=c&&fH().getSpan(c);if(d)try{return this.finishSpanSetup(d,b,a)}catch(b){console.error(`Failed to create span for run ${a.id}:`,b);return}}finishSpanSetup(a,b,c){return this.setSpanAttributes(a,b,c),b.error?(a.setStatus({code:2}),a.recordException(Error(b.error))):a.setStatus({code:1}),b.end_time&&a.end(new Date(b.end_time)),a}updateSpanForRun(a,b){try{let c=this.spans.get(a.id);if(!c)return void console.debug(`No span found for run ${a.id} during update`);this.setSpanAttributes(c,b,a),b.error?(c.setStatus({code:2}),c.recordException(Error(b.error))):c.setStatus({code:1});let d=b.end_time;d&&(c.end(new Date(d)),this.spans.delete(a.id))}catch(b){console.error(`Failed to update span for run ${a.id}:`,b)}}extractModelName(a){if(a.extra?.metadata){let b=a.extra.metadata;if(b.ls_model_name)return b.ls_model_name;if(b.invocation_params){let a=b.invocation_params;if(a.model)return a.model;if(a.model_name)return a.model_name}}}setSpanAttributes(a,b,c){if("run_type"in b&&b.run_type){var d;a.setAttribute("langsmith.span.kind",b.run_type);let c=fI[d=b.run_type||"chain"]||d;a.setAttribute("gen_ai.operation.name",c)}"name"in b&&b.name&&a.setAttribute("langsmith.trace.name",b.name),"session_id"in b&&b.session_id&&a.setAttribute("langsmith.trace.session_id",b.session_id),"session_name"in b&&b.session_name&&a.setAttribute("langsmith.trace.session_name",b.session_name),this.setGenAiSystem(a,b);let e=this.extractModelName(b);for(let[c,d]of(e&&a.setAttribute(fn,e),"prompt_tokens"in b&&"number"==typeof b.prompt_tokens&&a.setAttribute(fo,b.prompt_tokens),"completion_tokens"in b&&"number"==typeof b.completion_tokens&&a.setAttribute(fp,b.completion_tokens),"total_tokens"in b&&"number"==typeof b.total_tokens&&a.setAttribute(fq,b.total_tokens),this.setInvocationParameters(a,b),Object.entries(b.extra?.metadata||{})))null!=d&&a.setAttribute(`langsmith.metadata.${c}`,String(d));let f=b.tags;if(f&&Array.isArray(f)?a.setAttribute(fr,f.join(", ")):f&&a.setAttribute(fr,String(f)),"serialized"in b&&"object"==typeof b.serialized){let c=b.serialized;c.name&&a.setAttribute("gen_ai.serialized.name",String(c.name)),c.signature&&a.setAttribute("gen_ai.serialized.signature",String(c.signature)),c.doc&&a.setAttribute("gen_ai.serialized.doc",String(c.doc))}this.setIOAttributes(a,c)}setGenAiSystem(a,b){let c="langchain",d=this.extractModelName(b);if(d){let a=d.toLowerCase();a.includes("anthropic")||a.startsWith("claude")?c="anthropic":a.includes("bedrock")?c="aws.bedrock":a.includes("azure")&&a.includes("openai")?c="az.ai.openai":a.includes("azure")&&a.includes("inference")?c="az.ai.inference":a.includes("cohere")?c="cohere":a.includes("deepseek")?c="deepseek":a.includes("gemini")?c="gemini":a.includes("groq")?c="groq":a.includes("watson")||a.includes("ibm")?c="ibm.watsonx.ai":a.includes("mistral")?c="mistral_ai":a.includes("gpt")||a.includes("openai")?c="openai":a.includes("perplexity")||a.includes("sonar")?c="perplexity":a.includes("vertex")?c="vertex_ai":(a.includes("xai")||a.includes("grok"))&&(c="xai")}a.setAttribute("gen_ai.system",c)}setInvocationParameters(a,b){if(!b.extra?.metadata?.invocation_params)return;let c=b.extra.metadata.invocation_params;void 0!==c.max_tokens&&a.setAttribute("gen_ai.request.max_tokens",c.max_tokens),void 0!==c.temperature&&a.setAttribute("gen_ai.request.temperature",c.temperature),void 0!==c.top_p&&a.setAttribute("gen_ai.request.top_p",c.top_p),void 0!==c.frequency_penalty&&a.setAttribute("gen_ai.request.frequency_penalty",c.frequency_penalty),void 0!==c.presence_penalty&&a.setAttribute("gen_ai.request.presence_penalty",c.presence_penalty)}setIOAttributes(a,b){if(b.run.inputs)try{let c=b.run.inputs;"object"==typeof c&&null!==c&&(c.model&&Array.isArray(c.messages)&&a.setAttribute(fn,c.model),void 0!==c.stream&&a.setAttribute("langsmith.request.streaming",c.stream),c.extra_headers&&a.setAttribute("langsmith.request.headers",JSON.stringify(c.extra_headers)),c.extra_query&&a.setAttribute("gen_ai.request.extra_query",JSON.stringify(c.extra_query)),c.extra_body&&a.setAttribute("gen_ai.request.extra_body",JSON.stringify(c.extra_body))),a.setAttribute("gen_ai.prompt",JSON.stringify(c))}catch(a){console.debug(`Failed to process inputs for run ${b.id}`,a)}if(b.run.outputs)try{let c=b.run.outputs,d=this.getUnifiedRunTokens(c);if(d&&(a.setAttribute(fo,d[0]),a.setAttribute(fp,d[1]),a.setAttribute(fq,d[0]+d[1])),c&&"object"==typeof c){if(c.model&&a.setAttribute("gen_ai.response.model",String(c.model)),c.id&&a.setAttribute("gen_ai.response.id",c.id),c.choices&&Array.isArray(c.choices)){let b=c.choices.map(a=>a.finish_reason).filter(a=>a).map(String);b.length>0&&a.setAttribute("gen_ai.response.finish_reasons",b.join(", "))}if(c.service_tier&&a.setAttribute("gen_ai.response.service_tier",c.service_tier),c.system_fingerprint&&a.setAttribute("gen_ai.response.system_fingerprint",c.system_fingerprint),c.usage_metadata&&"object"==typeof c.usage_metadata){let b=c.usage_metadata;b.input_token_details&&a.setAttribute("gen_ai.usage.input_token_details",JSON.stringify(b.input_token_details)),b.output_token_details&&a.setAttribute("gen_ai.usage.output_token_details",JSON.stringify(b.output_token_details))}}a.setAttribute("gen_ai.completion",JSON.stringify(c))}catch(a){console.debug(`Failed to process outputs for run ${b.id}`,a)}}getUnifiedRunTokens(a){if(!a)return null;let b=this.extractUnifiedRunTokens(a.usage_metadata);if(b)return b;for(let c of Object.keys(a)){let d=a[c];if(d&&"object"==typeof d&&((b=this.extractUnifiedRunTokens(d.usage_metadata))||1===d.lc&&d.kwargs&&"object"==typeof d.kwargs&&(b=this.extractUnifiedRunTokens(d.kwargs.usage_metadata))))return b}let c=a.generations||[];if(!Array.isArray(c))return null;for(let a of Array.isArray(c[0])?c.flat():c)if("object"==typeof a&&a.message&&"object"==typeof a.message&&a.message.kwargs&&"object"==typeof a.message.kwargs&&(b=this.extractUnifiedRunTokens(a.message.kwargs.usage_metadata)))return b;return null}extractUnifiedRunTokens(a){return a&&"object"==typeof a&&"number"==typeof a.input_tokens&&"number"==typeof a.output_tokens?[a.input_tokens,a.output_tokens]:null}}var fK=a.i(203210),fL=a.i(67158);let fM=[429,500,502,503,504];class fN{constructor(a){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=a.maxConcurrency??1/0,this.maxRetries=a.maxRetries??6,"default"in fL.default?this.queue=new fL.default.default({concurrency:this.maxConcurrency}):this.queue=new fL.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=a?.onFailedResponseHook}call(a,...b){let c=this.onFailedResponseHook;return this.queue.add(()=>(0,fK.default)(()=>a(...b).catch(a=>{if(a instanceof Error)throw a;throw Error(a)}),{async onFailedAttempt(a){if(a.message.startsWith("Cancel")||a.message.startsWith("TimeoutError")||"TimeoutError"===a.name||a.message.startsWith("AbortError")||a?.code==="ECONNABORTED")throw a;let b=a?.response;if(c&&await c(b))return;let d=b?.status??a?.status;if(d&&!fM.includes(+d))throw a},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(a,b,...c){return a.signal?Promise.race([this.call(b,...c),new Promise((b,c)=>{a.signal?.addEventListener("abort",()=>{c(Error("AbortError"))})})]):this.call(b,...c)}}function fO(a){return"function"==typeof a?._getType}function fP(a){let b={type:a._getType(),data:{content:a.content}};return a?.additional_kwargs&&Object.keys(a.additional_kwargs).length>0&&(b.data.additional_kwargs={...a.additional_kwargs}),b}let fQ=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function fR(a,b){if(!fQ.test(a))throw Error(void 0!==b?`Invalid UUID for ${b}: ${a}`:`Invalid UUID: ${a}`);return a}let fS={};function fT(a){fS[a]||(console.warn(a),fS[a]=!0)}function fU(a){if(!a||a.split("/").length>2||a.startsWith("/")||a.endsWith("/")||a.split(":").length>2)throw Error(`Invalid identifier format: ${a}`);let[b,c]=a.split(":"),d=c||"latest";if(b.includes("/")){let[c,e]=b.split("/",2);if(!c||!e)throw Error(`Invalid identifier format: ${a}`);return[c,e,d]}if(!b)throw Error(`Invalid identifier format: ${a}`);return["-",b,d]}a.i(139833);class fV extends Error{constructor(a){super(a),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function fW(a,b,c){let d;if(a.ok){c&&(d=await a.text());return}if(403===a.status)try{let b=await a.json(),c=b?.error;"org_scoped_key_requires_workspace"===c&&(d="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch(c){let b=Error(`${a.status} ${a.statusText}`);throw b.status=a?.status,b}if(void 0===d)try{d=await a.text()}catch(a){d=""}let e=`Failed to ${b}. Received status [${a.status}]: ${a.statusText}. Message: ${d}`;if(409===a.status)throw new fV(e);let f=Error(e);throw f.status=a.status,f}let fX="ERR_CONFLICTING_ENDPOINTS";class fY extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:fX}),this.name="ConflictingEndpointsError"}}var fZ={result:"[Circular]"},f$=[],f_=[];let f0=new TextEncoder;function f1(a){return f0.encode(a)}function f2(a){if(a&&"object"==typeof a&&null!==a){if(a instanceof Map)return Object.fromEntries(a);else if(a instanceof Set)return Array.from(a);else if(a instanceof Date)return a.toISOString();else if(a instanceof RegExp)return a.toString();else if(a instanceof Error)return{name:a.name,message:a.message}}else if("bigint"==typeof a)return a.toString();return a}function f3(a,b,c,d,e){try{let b=JSON.stringify(a,function(a,b){if(c){let d=c.call(this,a,b);if(void 0!==d)return d}return f2(b)},d);return f1(b)}catch(h){let g;if(!h.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${b?`
Context: ${b}`:""}`),f1("[Unserializable]");"true"!==fy("SUPPRESS_CIRCULAR_JSON_WARNINGS")&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${b?`
Context: ${b}`:""}`),void 0===e&&(e={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function a(b,c,d,e,f,g,h){if(g+=1,"object"==typeof b&&null!==b){for(i=0;i<e.length;i++)if(e[i]===b)return void f4(fZ,b,c,f);if(void 0!==h.depthLimit&&g>h.depthLimit||void 0!==h.edgesLimit&&d+1>h.edgesLimit)return void f4("[...]",b,c,f);if(e.push(b),Array.isArray(b))for(i=0;i<b.length;i++)a(b[i],i,i,e,b,g,h);else{var i,j=Object.keys(b=f2(b));for(i=0;i<j.length;i++){var k=j[i];a(b[k],k,i,e,b,g,h)}}e.pop()}}(a,"",0,[],void 0,0,e);try{var f;g=0===f_.length?JSON.stringify(a,c,d):JSON.stringify(a,(f=c,f=void 0!==f?f:function(a,b){return b},function(a,b){if(f_.length>0)for(var c=0;c<f_.length;c++){var d=f_[c];if(d[1]===a&&d[0]===b){b=d[2],f_.splice(c,1);break}}return f.call(this,a,b)}),d)}catch(a){return f1("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==f$.length;){let a=f$.pop();4===a.length?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return f1(g)}}function f4(a,b,c,d){var e=Object.getOwnPropertyDescriptor(d,c);void 0!==e.get?e.configurable?(Object.defineProperty(d,c,{value:a}),f$.push([d,c,b,e])):f_.push([b,c,a]):(d[c]=a,f$.push([d,c,b]))}function f5(a){let b=fw(),c=function(){let a=function(){try{if("undefined"!=typeof process&&process.env)return Object.entries(process.env).reduce((a,[b,c])=>(a[b]=String(c),a),{});return}catch(a){return}}()||{},b={},c=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[d,e]of Object.entries(a))(d.startsWith("LANGCHAIN_")||d.startsWith("LANGSMITH_"))&&"string"==typeof e&&!c.includes(d)&&!d.toLowerCase().includes("key")&&!d.toLowerCase().includes("secret")&&!d.toLowerCase().includes("token")&&("LANGCHAIN_REVISION_ID"===d?b.revision_id=e:b[d]=e);return b}(),d=a.extra??{},e=d.metadata;return a.extra={...d,runtime:{...b,...d?.runtime},metadata:{...c,...c.revision_id||"revision_id"in a&&a.revision_id?{revision_id:("revision_id"in a?a.revision_id:void 0)??c.revision_id}:{},...e}},a}async function f6(a){let b=[];for await(let c of a)b.push(c);return b}function f7(a){if(void 0!==a)return a.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}let f8=async a=>{if(a?.status===429){let b=1e3*parseInt(a.headers.get("retry-after")??"10",10);if(b>0)return await new Promise(a=>setTimeout(a,b)),!0}return!1};function f9(a){return"number"==typeof a?Number(a.toFixed(4)):a}class ga{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(a){let b,c=new Promise(a=>{b=a}),d=f3(a.item,`Serializing run with id: ${a.item.id}`).length;return this.items.push({action:a.action,payload:a.item,otelContext:a.otelContext,apiKey:a.apiKey,apiUrl:a.apiUrl,itemPromiseResolve:b,itemPromise:c,size:d}),this.sizeBytes+=d,c}pop({upToSizeBytes:a,upToSize:b}){if(a<1)throw Error("Number of bytes to pop off may not be less than 1.");let c=[],d=0;for(;d+(this.peek()?.size??0)<a&&this.items.length>0&&c.length<b;){let a=this.items.shift();a&&(c.push(a),d+=a.size,this.sizeBytes-=a.size)}if(0===c.length&&this.items.length>0){let a=this.items.shift();c.push(a),d+=a.size,this.sizeBytes-=a.size}return[c.map(a=>({action:a.action,item:a.payload,otelContext:a.otelContext,apiKey:a.apiKey,apiUrl:a.apiUrl})),()=>c.forEach(a=>a.itemPromiseResolve())]}}let gb="https://api.smith.langchain.com";class gc{get _fetch(){let a;return this.fetchImplementation||(a=this.debug,async(...b)=>{if(a||"true"===fy("DEBUG")){let[a,c]=b;console.log(` ${c?.method||"GET"} ${a}`)}let c=await (globalThis[fs]??((...a)=>fetch(...a)))(...b);return(a||"true"===fy("DEBUG"))&&console.log(` ${c.status} ${c.statusText} ${c.url}`),c})}constructor(a={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new ga}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===fx("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:"true"===fx("LANGSMITH_DEBUG")});const b=gc.getDefaultClientConfig();if(this.tracingSampleRate=(a=>{let b=a?.toString()??fy("TRACING_SAMPLING_RATE");if(void 0===b)return;let c=parseFloat(b);if(c<0||c>1)throw Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${c}`);return c})(a.tracingSamplingRate),this.apiUrl=f7(a.apiUrl??b.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=f7(a.apiKey??b.apiKey),this.webUrl=f7(a.webUrl??b.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=f7(a.workspaceId??fy("WORKSPACE_ID")),this.timeout_ms=a.timeout_ms??9e4,this.caller=new fN({...a.callerOptions??{},maxRetries:4,debug:a.debug??this.debug}),this.traceBatchConcurrency=a.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw Error("Trace batch concurrency must be positive.");this.debug=a.debug??this.debug,this.fetchImplementation=a.fetchImplementation,this.batchIngestCaller=new fN({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...a.callerOptions??{},onFailedResponseHook:f8,debug:a.debug??this.debug}),this.hideInputs=a.hideInputs??a.anonymizer??b.hideInputs,this.hideOutputs=a.hideOutputs??a.anonymizer??b.hideOutputs,this.autoBatchTracing=a.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=a.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=a.batchSizeBytesLimit,this.batchSizeLimit=a.batchSizeLimit,this.fetchOptions=a.fetchOptions||{},this.manualFlushMode=a.manualFlushMode??this.manualFlushMode,fz()&&(this.langSmithToOTELTranslator=new fJ)}static getDefaultClientConfig(){let a=fy("API_KEY");return{apiUrl:fy("ENDPOINT")??gb,apiKey:a,webUrl:void 0,hideInputs:"true"===fy("HIDE_INPUTS"),hideOutputs:"true"===fy("HIDE_OUTPUTS")}}getHostUrl(){let a;if(this.webUrl)return this.webUrl;if("localhost"===(a=this.apiUrl.replace("http://","").replace("https://","").split("/")[0].split(":")[0])||"127.0.0.1"===a||"::1"===a)return this.webUrl="http://localhost:3000",this.webUrl;if(this.apiUrl.endsWith("/api/v1"))return this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl;if(this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api"))return this.webUrl=this.apiUrl.replace("/api",""),this.webUrl;if(this.apiUrl.split(".",1)[0].includes("dev"))return this.webUrl="https://dev.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("eu"))return this.webUrl="https://eu.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("beta"))return this.webUrl="https://beta.smith.langchain.com",this.webUrl;else return this.webUrl="https://smith.langchain.com",this.webUrl}get headers(){let a={"User-Agent":`langsmith-js/${fu}`};return this.apiKey&&(a["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(a["x-tenant-id"]=this.workspaceId),a}_getPlatformEndpointPath(a){return"/v1"!==this.apiUrl.slice(-3)&&"/v1/"!==this.apiUrl.slice(-4)?`/v1/platform/${a}`:`/platform/${a}`}async processInputs(a){return!1===this.hideInputs?a:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(a):a}async processOutputs(a){return!1===this.hideOutputs?a:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(a):a}async prepareRunCreateOrUpdateInputs(a){let b={...a};return void 0!==b.inputs&&(b.inputs=await this.processInputs(b.inputs)),void 0!==b.outputs&&(b.outputs=await this.processOutputs(b.outputs)),b}async _getResponse(a,b){let c=b?.toString()??"",d=`${this.apiUrl}${a}?${c}`;return await this.caller.call(async()=>{let b=await this._fetch(d,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,`fetch ${a}`),b})}async _get(a,b){return(await this._getResponse(a,b)).json()}async *_getPaginated(a,b=new URLSearchParams,c){let d=Number(b.get("offset"))||0,e=Number(b.get("limit"))||100;for(;;){b.set("offset",String(d)),b.set("limit",String(e));let f=`${this.apiUrl}${a}?${b}`,g=await this.caller.call(async()=>{let b=await this._fetch(f,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,`fetch ${a}`),b}),h=c?c(await g.json()):await g.json();if(0===h.length||(yield h,h.length<e))break;d+=h.length}}async *_getCursorPaginatedList(a,b=null,c="POST",d="runs"){let e=b?{...b}:{};for(;;){let b=JSON.stringify(e),f=await this.caller.call(async()=>{let d=await this._fetch(`${this.apiUrl}${a}`,{method:c,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:b});return await fW(d,`fetch ${a}`),d}),g=await f.json();if(!g||!g[d])break;yield g[d];let h=g.cursors;if(!h||!h.next)break;e.cursor=h.next}}_shouldSample(){return void 0===this.tracingSampleRate||Math.random()<this.tracingSampleRate}_filterForSampling(a,b=!1){if(void 0===this.tracingSampleRate)return a;if(b){let b=[];for(let c of a)this.filteredPostUuids.has(c.trace_id)?c.id===c.trace_id&&this.filteredPostUuids.delete(c.trace_id):b.push(c);return b}{let b=[];for(let c of a){let a=c.trace_id??c.id;this.filteredPostUuids.has(a)||(c.id===a?this._shouldSample()?b.push(c):this.filteredPostUuids.add(a):b.push(c))}return b}}async _getBatchSizeLimitBytes(){let a=await this._ensureServerInfo();return this.batchSizeBytesLimit??a.batch_ingest_config?.size_limit_bytes??0x1800000}async _getBatchSizeLimit(){let a=await this._ensureServerInfo();return this.batchSizeLimit??a.batch_ingest_config?.size_limit??100}async _getDatasetExamplesMultiPartSupport(){let a=await this._ensureServerInfo();return a.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue({batchSizeLimitBytes:a,batchSizeLimit:b}){let c=[];for(;this.autoBatchQueue.items.length>0;){let[d,e]=this.autoBatchQueue.pop({upToSizeBytes:a,upToSize:b});if(!d.length){e();break}let f=d.reduce((a,b)=>{let c=b.apiUrl??this.apiUrl,d=b.apiKey??this.apiKey,e=b.apiKey===this.apiKey&&b.apiUrl===this.apiUrl?"default":`${c}|${d}`;return a[e]||(a[e]=[]),a[e].push(b),a},{}),g=[];for(let[a,b]of Object.entries(f)){let c=this._processBatch(b,{apiUrl:"default"===a?void 0:a.split("|")[0],apiKey:"default"===a?void 0:a.split("|")[1]});g.push(c)}let h=Promise.all(g).finally(e);c.push(h)}return Promise.all(c)}async _processBatch(a,b){if(a.length)try{if(void 0!==this.langSmithToOTELTranslator)this._sendBatchToOTELTranslator(a);else{let c={runCreates:a.filter(a=>"create"===a.action).map(a=>a.item),runUpdates:a.filter(a=>"update"===a.action).map(a=>a.item)},d=await this._ensureServerInfo();if(d?.batch_ingest_config?.use_multipart_endpoint){let a=d?.instance_flags?.gzip_body_enabled;await this.multipartIngestRuns(c,{...b,useGzip:a})}else await this.batchIngestRuns(c,b)}}catch(a){console.error("Error exporting batch:",a)}}_sendBatchToOTELTranslator(a){if(void 0!==this.langSmithToOTELTranslator){let b=new Map,c=[];for(let d of a)d.item.id&&d.otelContext&&(b.set(d.item.id,d.otelContext),"create"===d.action?c.push({operation:"post",id:d.item.id,trace_id:d.item.trace_id??d.item.id,run:d.item}):c.push({operation:"patch",id:d.item.id,trace_id:d.item.trace_id??d.item.id,run:d.item}));this.langSmithToOTELTranslator.exportBatch(c,b)}}async processRunOperation(a){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,a.item=f5(a.item);let b=this.autoBatchQueue.push(a);if(this.manualFlushMode)return b;let c=await this._getBatchSizeLimitBytes(),d=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>c||this.autoBatchQueue.items.length>d)&&this.drainAutoBatchQueue({batchSizeLimitBytes:c,batchSizeLimit:d}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:c,batchSizeLimit:d})},this.autoBatchAggregationDelayMs)),b}async _getServerInfo(){let a=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4),...this.fetchOptions});return await fW(a,"get server info"),a}),b=await a.json();return this.debug&&console.log("\n=== LangSmith Server Configuration ===\n"+JSON.stringify(b,null,2)+"\n"),b}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(a){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${a.status??"Unspecified status code"} ${a.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(a=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),a))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let a=await this._getBatchSizeLimitBytes(),b=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:a,batchSizeLimit:b})}_cloneCurrentOTELContext(){let a=fH(),b=fG.getContextInstance();if(void 0!==this.langSmithToOTELTranslator){let c=a.getActiveSpan();if(c)return a.setSpan(b.active(),c)}}async createRun(a,b){if(!this._filterForSampling([a]).length)return;let c={...this.headers,"Content-Type":"application/json"},d=a.project_name;delete a.project_name;let e=await this.prepareRunCreateOrUpdateInputs({session_name:d,...a,start_time:a.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==e.trace_id&&void 0!==e.dotted_order){let a=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:e,otelContext:a,apiKey:b?.apiKey,apiUrl:b?.apiUrl}).catch(console.error);return}let f=f5(e);b?.apiKey!==void 0&&(c["x-api-key"]=b.apiKey),b?.workspaceId!==void 0&&(c["x-tenant-id"]=b.workspaceId);let g=f3(f,`Creating run with id: ${f.id}`);await this.caller.call(async()=>{let a=await this._fetch(`${b?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:g});return await fW(a,"create run",!0),a})}async batchIngestRuns({runCreates:a,runUpdates:b},c){if(void 0===a&&void 0===b)return;let d=await Promise.all(a?.map(a=>this.prepareRunCreateOrUpdateInputs(a))??[]),e=await Promise.all(b?.map(a=>this.prepareRunCreateOrUpdateInputs(a))??[]);if(d.length>0&&e.length>0){let a=d.reduce((a,b)=>(b.id&&(a[b.id]=b),a),{}),b=[];for(let c of e)void 0!==c.id&&a[c.id]?a[c.id]={...a[c.id],...c}:b.push(c);d=Object.values(a),e=b}let f={post:d,patch:e};if(!f.post.length&&!f.patch.length)return;let g={post:[],patch:[]};for(let a of["post","patch"]){let b=f[a].reverse(),c=b.pop();for(;void 0!==c;)g[a].push(c),c=b.pop()}if(g.post.length>0||g.patch.length>0){let a=g.post.map(a=>a.id).concat(g.patch.map(a=>a.id)).join(",");await this._postBatchIngestRuns(f3(g,`Ingesting runs with ids: ${a}`),c)}}async _postBatchIngestRuns(a,b){let c={...this.headers,"Content-Type":"application/json",Accept:"application/json"};b?.apiKey!==void 0&&(c["x-api-key"]=b.apiKey),await this.batchIngestCaller.call(async()=>{let d=await this._fetch(`${b?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await fW(d,"batch create run",!0),d})}async multipartIngestRuns({runCreates:a,runUpdates:b},c){if(void 0===a&&void 0===b)return;let d={},e=[];for(let b of a??[]){let a=await this.prepareRunCreateOrUpdateInputs(b);void 0!==a.id&&void 0!==a.attachments&&(d[a.id]=a.attachments),delete a.attachments,e.push(a)}let f=[];for(let a of b??[])f.push(await this.prepareRunCreateOrUpdateInputs(a));if(void 0!==e.find(a=>void 0===a.trace_id||void 0===a.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==f.find(a=>void 0===a.trace_id||void 0===a.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(e.length>0&&f.length>0){let a=e.reduce((a,b)=>(b.id&&(a[b.id]=b),a),{}),b=[];for(let c of f)void 0!==c.id&&a[c.id]?a[c.id]={...a[c.id],...c}:b.push(c);e=Object.values(a),f=b}if(0===e.length&&0===f.length)return;let g=[],h=[];for(let[a,b]of[["post",e],["patch",f]])for(let c of b){let{inputs:b,outputs:e,events:f,extra:i,error:j,serialized:k,attachments:l,...m}=c,n={inputs:b,outputs:e,events:f,extra:i,error:j,serialized:k},o=f3(m,`Serializing for multipart ingestion of run with id: ${m.id}`);for(let[b,c]of(h.push({name:`${a}.${m.id}`,payload:new Blob([o],{type:`application/json; length=${o.length}`})}),Object.entries(n))){if(void 0===c)continue;let d=f3(c,`Serializing ${b} for multipart ingestion of run with id: ${m.id}`);h.push({name:`${a}.${m.id}.${b}`,payload:new Blob([d],{type:`application/json; length=${d.length}`})})}if(void 0!==m.id){let a=d[m.id];if(a)for(let[b,c]of(delete d[m.id],Object.entries(a))){let a,d;if(Array.isArray(c)?[a,d]=c:(a=c.mimeType,d=c.data),b.includes(".")){console.warn(`Skipping attachment '${b}' for run ${m.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}h.push({name:`attachment.${m.id}.${b}`,payload:new Blob([d],{type:`${a}; length=${d.byteLength}`})})}}g.push(`trace=${m.trace_id},id=${m.id}`)}await this._sendMultipartRequest(h,g.join("; "),c)}async _createNodeFetchBody(a,b){let c=[];for(let d of a)c.push(new Blob([`--${b}\r
`])),c.push(new Blob([`Content-Disposition: form-data; name="${d.name}"\r
`,`Content-Type: ${d.payload.type}\r
\r
`])),c.push(d.payload),c.push(new Blob(["\r\n"]));c.push(new Blob([`--${b}--\r
`]));let d=new Blob(c);return await d.arrayBuffer()}async _createMultipartStream(a,b){let c=new TextEncoder;return new ReadableStream({async start(d){let e=async a=>{"string"==typeof a?d.enqueue(c.encode(a)):d.enqueue(a)};for(let c of a){await e(`--${b}\r
`),await e(`Content-Disposition: form-data; name="${c.name}"\r
`),await e(`Content-Type: ${c.payload.type}\r
\r
`);let a=c.payload.stream().getReader();try{let b;for(;!(b=await a.read()).done;)d.enqueue(b.value)}finally{a.releaseLock()}await e("\r\n")}await e(`--${b}--\r
`),d.close()}})}async _sendMultipartRequest(a,b,c){let d,e="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),f=!!(d=globalThis[fs])&&"function"==typeof d&&"Headers"in d&&"Request"in d&&"Response"in d,g=()=>this._createNodeFetchBody(a,e),h=()=>this._createMultipartStream(a,e),i=async a=>this.batchIngestCaller.call(async()=>{let b=await a(),d={...this.headers,"Content-Type":`multipart/form-data; boundary=${e}`};c?.apiKey!==void 0&&(d["x-api-key"]=c.apiKey);let f=b;c?.useGzip&&"object"==typeof b&&"pipeThrough"in b&&(f=b.pipeThrough(new CompressionStream("gzip")),d["Content-Encoding"]="gzip");let g=await this._fetch(`${c?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:d,body:f,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(g,"Failed to send multipart request",!0),g});try{let a,d=!1;f||this.multipartStreamingDisabled||"bun"===fv()?a=await i(g):(d=!0,a=await i(h)),(!this.multipartStreamingDisabled||d)&&422===a.status&&(c?.apiUrl??this.apiUrl)!==gb&&(console.warn(`Streaming multipart upload to ${c?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${b}".`),this.multipartStreamingDisabled=!0,a=await i(g))}catch(a){console.warn(`${a.message.trim()}

Context: ${b}`)}}async updateRun(a,b,c){fR(a),b.inputs&&(b.inputs=await this.processInputs(b.inputs)),b.outputs&&(b.outputs=await this.processOutputs(b.outputs));let d={...b,id:a};if(!this._filterForSampling([d],!0).length)return;if(this.autoBatchTracing&&void 0!==d.trace_id&&void 0!==d.dotted_order){let a=this._cloneCurrentOTELContext();return void 0!==b.end_time&&void 0===d.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?void await this.processRunOperation({action:"update",item:d,otelContext:a,apiKey:c?.apiKey,apiUrl:c?.apiUrl}).catch(console.error):void this.processRunOperation({action:"update",item:d,otelContext:a,apiKey:c?.apiKey,apiUrl:c?.apiUrl}).catch(console.error)}let e={...this.headers,"Content-Type":"application/json"};c?.apiKey!==void 0&&(e["x-api-key"]=c.apiKey),c?.workspaceId!==void 0&&(e["x-tenant-id"]=c.workspaceId);let f=f3(b,`Serializing payload to update run with id: ${a}`);await this.caller.call(async()=>{let b=await this._fetch(`${c?.apiUrl??this.apiUrl}/runs/${a}`,{method:"PATCH",headers:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:f});return await fW(b,"update run",!0),b})}async readRun(a,{loadChildRuns:b}={loadChildRuns:!1}){fR(a);let c=await this._get(`/runs/${a}`);return b&&(c=await this._loadChildRuns(c)),c}async getRunUrl({runId:a,run:b,projectOpts:c}){if(void 0!==b){let a;a=b.session_id?b.session_id:c?.projectName?(await this.readProject({projectName:c?.projectName})).id:c?.projectId?c?.projectId:(await this.readProject({projectName:fy("PROJECT")||"default"})).id;let d=await this._getTenantId();return`${this.getHostUrl()}/o/${d}/projects/p/${a}/r/${b.id}?poll=true`}if(void 0!==a){let b=await this.readRun(a);if(!b.app_path)throw Error(`Run ${a} has no app_path`);let c=this.getHostUrl();return`${c}${b.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(a){let b=await f6(this.listRuns({isRoot:!1,projectId:a.session_id,traceId:a.trace_id})),c={},d={};for(let e of(b.sort((a,b)=>(a?.dotted_order??"").localeCompare(b?.dotted_order??"")),b)){if(null===e.parent_run_id||void 0===e.parent_run_id)throw Error(`Child run ${e.id} has no parent`);e.dotted_order?.startsWith(a.dotted_order??"")&&e.id!==a.id&&(e.parent_run_id in c||(c[e.parent_run_id]=[]),c[e.parent_run_id].push(e),d[e.id]=e)}for(let b in a.child_runs=c[a.id]||[],c)b!==a.id&&(d[b].child_runs=c[b]);return a}async *listRuns(a){let{projectId:b,projectName:c,parentRunId:d,traceId:e,referenceExampleId:f,startTime:g,executionOrder:h,isRoot:i,runType:j,error:k,id:l,query:m,filter:n,traceFilter:o,treeFilter:p,limit:q,select:r,order:s}=a,t=[];if(b&&(t=Array.isArray(b)?b:[b]),c){let a=Array.isArray(c)?c:[c],b=await Promise.all(a.map(a=>this.readProject({projectName:a}).then(a=>a.id)));t.push(...b)}let u={session:t.length?t:null,run_type:j,reference_example:f,query:m,filter:n,trace_filter:o,tree_filter:p,execution_order:h,parent_run:d,start_time:g?g.toISOString():null,error:k,id:l,limit:q,trace:e,select:r||["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:i,order:s},v=0;for await(let a of this._getCursorPaginatedList("/runs/query",u))if(q){if(v>=q)break;if(a.length+v>q){let b=a.slice(0,q-v);yield*b;break}v+=a.length,yield*a}else yield*a}async *listGroupRuns(a){let{projectId:b,projectName:c,groupBy:d,filter:e,startTime:f,endTime:g,limit:h,offset:i}=a,j={session_id:b||(await this.readProject({projectName:c})).id,group_by:d,filter:e,start_time:f?f.toISOString():null,end_time:g?g.toISOString():null,limit:Number(h)||100},k=Number(i)||0,l="/runs/group",m=`${this.apiUrl}${l}`;for(;;){let a=JSON.stringify(Object.fromEntries(Object.entries({...j,offset:k}).filter(([a,b])=>void 0!==b))),b=await this.caller.call(async()=>{let b=await this._fetch(m,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await fW(b,`Failed to fetch ${l}`),b}),{groups:c,total:d}=await b.json();if(0===c.length)break;for(let a of c)yield a;if((k+=c.length)>=d)break}}async getRunStats({id:a,trace:b,parentRun:c,runType:d,projectNames:e,projectIds:f,referenceExampleIds:g,startTime:h,endTime:i,error:j,query:k,filter:l,traceFilter:m,treeFilter:n,isRoot:o,dataSourceType:p}){let q=f||[];e&&(q=[...f||[],...await Promise.all(e.map(a=>this.readProject({projectName:a}).then(a=>a.id)))]);let r=JSON.stringify(Object.fromEntries(Object.entries({id:a,trace:b,parent_run:c,run_type:d,session:q,reference_example:g,start_time:h,end_time:i,error:j,query:k,filter:l,trace_filter:m,tree_filter:n,is_root:o,data_source_type:p}).filter(([a,b])=>void 0!==b))),s=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await fW(a,"get run stats"),a});return await s.json()}async shareRun(a,{shareId:b}={}){let c={run_id:a,share_token:b||fg()};fR(a);let d=JSON.stringify(c),e=await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/runs/${a}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:d});return await fW(b,"share run"),b}),f=await e.json();if(null===f||!("share_token"in f))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${f.share_token}/r`}async unshareRun(a){fR(a),await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/runs/${a}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,"unshare run",!0),b})}async readRunSharedLink(a){fR(a);let b=await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/runs/${a}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,"read run shared link"),b}),c=await b.json();if(null!==c&&"share_token"in c)return`${this.getHostUrl()}/public/${c.share_token}/r`}async listSharedRuns(a,{runIds:b}={}){let c=new URLSearchParams({share_token:a});if(void 0!==b)for(let a of b)c.append("id",a);fR(a);let d=await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/public/${a}/runs${c}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,"list shared runs"),b});return await d.json()}async readDatasetSharedSchema(a,b){if(!a&&!b)throw Error("Either datasetId or datasetName must be given");a||(a=(await this.readDataset({datasetName:b})).id),fR(a);let c=await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/datasets/${a}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,"read dataset shared schema"),b}),d=await c.json();return d.url=`${this.getHostUrl()}/public/${d.share_token}/d`,d}async shareDataset(a,b){if(!a&&!b)throw Error("Either datasetId or datasetName must be given");a||(a=(await this.readDataset({datasetName:b})).id);let c={dataset_id:a};fR(a);let d=JSON.stringify(c),e=await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/datasets/${a}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:d});return await fW(b,"share dataset"),b}),f=await e.json();return f.url=`${this.getHostUrl()}/public/${f.share_token}/d`,f}async unshareDataset(a){fR(a),await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/datasets/${a}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,"unshare dataset",!0),b})}async readSharedDataset(a){fR(a);let b=await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/public/${a}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,"read shared dataset"),b});return await b.json()}async listSharedExamples(a,b){let c={};b?.exampleIds&&(c.id=b.exampleIds);let d=new URLSearchParams;Object.entries(c).forEach(([a,b])=>{Array.isArray(b)?b.forEach(b=>d.append(a,b)):d.append(a,b)});let e=await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/public/${a}/examples?${d.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,"list shared examples"),b}),f=await e.json();if(!e.ok){if("detail"in f)throw Error(`Failed to list shared examples.
Status: ${e.status}
Message: ${Array.isArray(f.detail)?f.detail.join("\n"):"Unspecified error"}`);throw Error(`Failed to list shared examples: ${e.status} ${e.statusText}`)}return f.map(a=>({...a,_hostUrl:this.getHostUrl()}))}async createProject({projectName:a,description:b=null,metadata:c=null,upsert:d=!1,projectExtra:e=null,referenceDatasetId:f=null}){let g=`${this.apiUrl}/sessions${d?"?upsert=true":""}`,h=e||{};c&&(h.metadata=c);let i={name:a,extra:h,description:b};null!==f&&(i.reference_dataset_id=f);let j=JSON.stringify(i),k=await this.caller.call(async()=>{let a=await this._fetch(g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:j});return await fW(a,"create project"),a});return await k.json()}async updateProject(a,{name:b=null,description:c=null,metadata:d=null,projectExtra:e=null,endTime:f=null}){let g=`${this.apiUrl}/sessions/${a}`,h=e;d&&(h={...h||{},metadata:d});let i=JSON.stringify({name:b,extra:h,description:c,end_time:f?new Date(f).toISOString():null}),j=await this.caller.call(async()=>{let a=await this._fetch(g,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await fW(a,"update project"),a});return await j.json()}async hasProject({projectId:a,projectName:b}){let c="/sessions",d=new URLSearchParams;if(void 0!==a&&void 0!==b)throw Error("Must provide either projectName or projectId, not both");if(void 0!==a)fR(a),c+=`/${a}`;else if(void 0!==b)d.append("name",b);else throw Error("Must provide projectName or projectId");let e=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}${c}?${d}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(a,"has project"),a});try{let a=await e.json();if(!e.ok)return!1;if(Array.isArray(a))return a.length>0;return!0}catch(a){return!1}}async readProject({projectId:a,projectName:b,includeStats:c}){let d,e="/sessions",f=new URLSearchParams;if(void 0!==a&&void 0!==b)throw Error("Must provide either projectName or projectId, not both");if(void 0!==a)fR(a),e+=`/${a}`;else if(void 0!==b)f.append("name",b);else throw Error("Must provide projectName or projectId");void 0!==c&&f.append("include_stats",c.toString());let g=await this._get(e,f);if(Array.isArray(g)){if(0===g.length)throw Error(`Project[id=${a}, name=${b}] not found`);d=g[0]}else d=g;return d}async getProjectUrl({projectId:a,projectName:b}){if(void 0===a&&void 0===b)throw Error("Must provide either projectName or projectId");let c=await this.readProject({projectId:a,projectName:b}),d=await this._getTenantId();return`${this.getHostUrl()}/o/${d}/projects/p/${c.id}`}async getDatasetUrl({datasetId:a,datasetName:b}){if(void 0===a&&void 0===b)throw Error("Must provide either datasetName or datasetId");let c=await this.readDataset({datasetId:a,datasetName:b}),d=await this._getTenantId();return`${this.getHostUrl()}/o/${d}/datasets/${c.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let a=new URLSearchParams({limit:"1"});for await(let b of this._getPaginated("/sessions",a))return this._tenantId=b[0].tenant_id,b[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:a,name:b,nameContains:c,referenceDatasetId:d,referenceDatasetName:e,includeStats:f,datasetVersion:g,referenceFree:h,metadata:i}={}){let j=new URLSearchParams;if(void 0!==a)for(let b of a)j.append("id",b);if(void 0!==b&&j.append("name",b),void 0!==c&&j.append("name_contains",c),void 0!==d)j.append("reference_dataset",d);else if(void 0!==e){let a=await this.readDataset({datasetName:e});j.append("reference_dataset",a.id)}for await(let a of(void 0!==f&&j.append("include_stats",f.toString()),void 0!==g&&j.append("dataset_version",g),void 0!==h&&j.append("reference_free",h.toString()),void 0!==i&&j.append("metadata",JSON.stringify(i)),this._getPaginated("/sessions",j)))yield*a}async deleteProject({projectId:a,projectName:b}){let c;if(void 0===a&&void 0===b)throw Error("Must provide projectName or projectId");if(void 0!==a&&void 0!==b)throw Error("Must provide either projectName or projectId, not both");fR(c=void 0===a?(await this.readProject({projectName:b})).id:a),await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/sessions/${c}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(a,`delete session ${c} (${b})`,!0),a})}async uploadCsv({csvFile:a,fileName:b,inputKeys:c,outputKeys:d,description:e,dataType:f,name:g}){let h=`${this.apiUrl}/datasets/upload`,i=new FormData;i.append("file",a,b),c.forEach(a=>{i.append("input_keys",a)}),d.forEach(a=>{i.append("output_keys",a)}),e&&i.append("description",e),f&&i.append("data_type",f),g&&i.append("name",g);let j=await this.caller.call(async()=>{let a=await this._fetch(h,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await fW(a,"upload CSV"),a});return await j.json()}async createDataset(a,{description:b,dataType:c,inputsSchema:d,outputsSchema:e,metadata:f}={}){let g={name:a,description:b,extra:f?{metadata:f}:void 0};c&&(g.data_type=c),d&&(g.inputs_schema_definition=d),e&&(g.outputs_schema_definition=e);let h=JSON.stringify(g),i=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:h});return await fW(a,"create dataset"),a});return await i.json()}async readDataset({datasetId:a,datasetName:b}){let c,d="/datasets",e=new URLSearchParams({limit:"1"});if(a&&b)throw Error("Must provide either datasetName or datasetId, not both");if(a)fR(a),d+=`/${a}`;else if(b)e.append("name",b);else throw Error("Must provide datasetName or datasetId");let f=await this._get(d,e);if(Array.isArray(f)){if(0===f.length)throw Error(`Dataset[id=${a}, name=${b}] not found`);c=f[0]}else c=f;return c}async hasDataset({datasetId:a,datasetName:b}){try{return await this.readDataset({datasetId:a,datasetName:b}),!0}catch(a){if(a instanceof Error&&a.message.toLocaleLowerCase().includes("not found"))return!1;throw a}}async diffDatasetVersions({datasetId:a,datasetName:b,fromVersion:c,toVersion:d}){let e=a;if(void 0===e&&void 0===b)throw Error("Must provide either datasetName or datasetId");if(void 0!==e&&void 0!==b)throw Error("Must provide either datasetName or datasetId, not both");void 0===e&&(e=(await this.readDataset({datasetName:b})).id);let f=new URLSearchParams({from_version:"string"==typeof c?c:c.toISOString(),to_version:"string"==typeof d?d:d.toISOString()});return await this._get(`/datasets/${e}/versions/diff`,f)}async readDatasetOpenaiFinetuning({datasetId:a,datasetName:b}){if(void 0!==a);else if(void 0!==b)a=(await this.readDataset({datasetName:b})).id;else throw Error("Must provide either datasetName or datasetId");let c=await this._getResponse(`/datasets/${a}/openai_ft`);return(await c.text()).trim().split("\n").map(a=>JSON.parse(a))}async *listDatasets({limit:a=100,offset:b=0,datasetIds:c,datasetName:d,datasetNameContains:e,metadata:f}={}){let g=new URLSearchParams({limit:a.toString(),offset:b.toString()});if(void 0!==c)for(let a of c)g.append("id",a);for await(let a of(void 0!==d&&g.append("name",d),void 0!==e&&g.append("name_contains",e),void 0!==f&&g.append("metadata",JSON.stringify(f)),this._getPaginated("/datasets",g)))yield*a}async updateDataset(a){let{datasetId:b,datasetName:c,...d}=a;if(!b&&!c)throw Error("Must provide either datasetName or datasetId");let e=b??(await this.readDataset({datasetName:c})).id;fR(e);let f=JSON.stringify(d),g=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/datasets/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:f});return await fW(a,"update dataset"),a});return await g.json()}async updateDatasetTag(a){let{datasetId:b,datasetName:c,asOf:d,tag:e}=a;if(!b&&!c)throw Error("Must provide either datasetName or datasetId");let f=b??(await this.readDataset({datasetName:c})).id;fR(f);let g=JSON.stringify({as_of:"string"==typeof d?d:d.toISOString(),tag:e});await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/datasets/${f}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:g});return await fW(a,"update dataset tags",!0),a})}async deleteDataset({datasetId:a,datasetName:b}){let c="/datasets",d=a;if(void 0!==a&&void 0!==b)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==b&&(d=(await this.readDataset({datasetName:b})).id),void 0!==d)fR(d),c+=`/${d}`;else throw Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{let a=await this._fetch(this.apiUrl+c,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(a,`delete ${c}`,!0),a})}async indexDataset({datasetId:a,datasetName:b,tag:c}){let d=a;if(d||b)if(d&&b)throw Error("Must provide either datasetName or datasetId, not both");else d||(d=(await this.readDataset({datasetName:b})).id);else throw Error("Must provide either datasetName or datasetId");fR(d);let e=JSON.stringify({tag:c}),f=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/datasets/${d}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await fW(a,"index dataset"),a});await f.json()}async similarExamples(a,b,c,{filter:d}={}){let e={limit:c,inputs:a};void 0!==d&&(e.filter=d),fR(b);let f=JSON.stringify(e),g=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/datasets/${b}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:f});return await fW(a,"fetch similar examples"),a});return(await g.json()).examples}async createExample(a,b,c){let d;if(gd(a)&&(void 0!==b||void 0!==c))throw Error("Cannot provide outputs or options when using ExampleCreate object");let e=b?c?.datasetId:a.dataset_id,f=b?c?.datasetName:a.dataset_name;if(void 0===e&&void 0===f)throw Error("Must provide either datasetName or datasetId");if(void 0!==e&&void 0!==f)throw Error("Must provide either datasetName or datasetId, not both");void 0===e&&(e=(await this.readDataset({datasetName:f})).id);let g=(b?c?.createdAt:a.created_at)||new Date;d=gd(a)?a:{inputs:a,outputs:b,created_at:g?.toISOString(),id:c?.exampleId,metadata:c?.metadata,split:c?.split,source_run_id:c?.sourceRunId,use_source_run_io:c?.useSourceRunIO,use_source_run_attachments:c?.useSourceRunAttachments,attachments:c?.attachments};let h=await this._uploadExamplesMultipart(e,[d]);return await this.readExample(h.example_ids?.[0]??fg())}async createExamples(a){if(Array.isArray(a)){if(0===a.length)return[];let b=a[0].dataset_id,c=a[0].dataset_name;if(void 0===b&&void 0===c)throw Error("Must provide either datasetName or datasetId");if(void 0!==b&&void 0!==c)throw Error("Must provide either datasetName or datasetId, not both");void 0===b&&(b=(await this.readDataset({datasetName:c})).id);let d=await this._uploadExamplesMultipart(b,a);return await Promise.all(d.example_ids.map(a=>this.readExample(a)))}let{inputs:b,outputs:c,metadata:d,splits:e,sourceRunIds:f,useSourceRunIOs:g,useSourceRunAttachments:h,attachments:i,exampleIds:j,datasetId:k,datasetName:l}=a;if(void 0===b)throw Error("Must provide inputs when using legacy parameters");let m=k;if(void 0===m&&void 0===l)throw Error("Must provide either datasetName or datasetId");if(void 0!==m&&void 0!==l)throw Error("Must provide either datasetName or datasetId, not both");void 0===m&&(m=(await this.readDataset({datasetName:l})).id);let n=b.map((a,b)=>({dataset_id:m,inputs:a,outputs:c?.[b],metadata:d?.[b],split:e?.[b],id:j?.[b],attachments:i?.[b],source_run_id:f?.[b],use_source_run_io:g?.[b],use_source_run_attachments:h?.[b]})),o=await this._uploadExamplesMultipart(m,n);return await Promise.all(o.example_ids.map(a=>this.readExample(a)))}async createLLMExample(a,b,c){return this.createExample({input:a},{output:b},c)}async createChatExample(a,b,c){let d=a.map(a=>fO(a)?fP(a):a),e=fO(b)?fP(b):b;return this.createExample({input:d},{output:e},c)}async readExample(a){fR(a);let b=`/examples/${a}`,{attachment_urls:c,...d}=await this._get(b);return c&&(d.attachments=Object.entries(c).reduce((a,[b,c])=>(a[b.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},a),{})),d}async *listExamples({datasetId:a,datasetName:b,exampleIds:c,asOf:d,splits:e,inlineS3Urls:f,metadata:g,limit:h,offset:i,filter:j,includeAttachments:k}={}){let l;if(void 0!==a&&void 0!==b)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==a)l=a;else if(void 0!==b)l=(await this.readDataset({datasetName:b})).id;else throw Error("Must provide a datasetName or datasetId");let m=new URLSearchParams({dataset:l}),n=d?"string"==typeof d?d:d?.toISOString():void 0;if(n&&m.append("as_of",n),m.append("inline_s3_urls",(f??!0).toString()),void 0!==c)for(let a of c)m.append("id",a);if(void 0!==e)for(let a of e)m.append("splits",a);if(void 0!==g){let a=JSON.stringify(g);m.append("metadata",a)}void 0!==h&&m.append("limit",h.toString()),void 0!==i&&m.append("offset",i.toString()),void 0!==j&&m.append("filter",j),!0===k&&["attachment_urls","outputs","metadata"].forEach(a=>m.append("select",a));let o=0;for await(let a of this._getPaginated("/examples",m)){for(let b of a){let{attachment_urls:a,...c}=b;a&&(c.attachments=Object.entries(a).reduce((a,[b,c])=>(a[b.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type||void 0},a),{})),yield c,o++}if(void 0!==h&&o>=h)break}}async deleteExample(a){fR(a);let b=`/examples/${a}`;await this.caller.call(async()=>{let a=await this._fetch(this.apiUrl+b,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(a,`delete ${b}`,!0),a})}async updateExample(a,b){let c,d,e;return fR(c=b?a:a.id),e=void 0!==(d=b?{id:c,...b}:a).dataset_id?d.dataset_id:(await this.readExample(c)).dataset_id,this._updateExamplesMultipart(e,[d])}async updateExamples(a){let b;return b=void 0===a[0].dataset_id?(await this.readExample(a[0].id)).dataset_id:a[0].dataset_id,this._updateExamplesMultipart(b,a)}async readDatasetVersion({datasetId:a,datasetName:b,asOf:c,tag:d}){let e;if(fR(e=a||(await this.readDataset({datasetName:b})).id),c&&d||!c&&!d)throw Error("Exactly one of asOf and tag must be specified.");let f=new URLSearchParams;void 0!==c&&f.append("as_of","string"==typeof c?c:c.toISOString()),void 0!==d&&f.append("tag",d);let g=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/datasets/${e}/version?${f.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(a,"read dataset version"),a});return await g.json()}async listDatasetSplits({datasetId:a,datasetName:b,asOf:c}){let d;if(void 0===a&&void 0===b)throw Error("Must provide dataset name or ID");if(void 0!==a&&void 0!==b)throw Error("Must provide either datasetName or datasetId, not both");fR(d=void 0===a?(await this.readDataset({datasetName:b})).id:a);let e=new URLSearchParams,f=c?"string"==typeof c?c:c?.toISOString():void 0;return f&&e.append("as_of",f),await this._get(`/datasets/${d}/splits`,e)}async updateDatasetSplits({datasetId:a,datasetName:b,splitName:c,exampleIds:d,remove:e=!1}){let f;if(void 0===a&&void 0===b)throw Error("Must provide dataset name or ID");if(void 0!==a&&void 0!==b)throw Error("Must provide either datasetName or datasetId, not both");fR(f=void 0===a?(await this.readDataset({datasetName:b})).id:a);let g=JSON.stringify({split_name:c,examples:d.map(a=>(fR(a),a)),remove:e});await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/datasets/${f}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:g});return await fW(a,"update dataset splits",!0),a})}async evaluateRun(a,b,{sourceInfo:c,loadChildRuns:d,referenceExample:e}={loadChildRuns:!1}){let f;if(fT("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof a)f=await this.readRun(a,{loadChildRuns:d});else if("object"==typeof a&&"id"in a)f=a;else throw Error(`Invalid run type: ${typeof a}`);null!==f.reference_example_id&&void 0!==f.reference_example_id&&(e=await this.readExample(f.reference_example_id));let g=await b.evaluateRun(f,e),[h,i]=await this._logEvaluationFeedback(g,f,c);return i[0]}async createFeedback(a,b,{score:c,value:d,correction:e,comment:f,sourceInfo:g,feedbackSourceType:h="api",sourceRunId:i,feedbackId:j,feedbackConfig:k,projectId:l,comparativeExperimentId:m}){if(!a&&!l)throw Error("One of runId or projectId must be provided");if(a&&l)throw Error("Only one of runId or projectId can be provided");let n={type:h??"api",metadata:g??{}};void 0===i||n?.metadata===void 0||n.metadata.__run||(n.metadata.__run={run_id:i}),n?.metadata!==void 0&&n.metadata.__run?.run_id!==void 0&&fR(n.metadata.__run.run_id);let o={id:j??fg(),run_id:a,key:b,score:f9(c),value:d,correction:e,comment:f,feedback_source:n,comparative_experiment_id:m,feedbackConfig:k,session_id:l},p=JSON.stringify(o),q=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{let a=await this._fetch(q,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:p});return await fW(a,"create feedback",!0),a}),o}async updateFeedback(a,{score:b,value:c,correction:d,comment:e}){let f={};null!=b&&(f.score=f9(b)),null!=c&&(f.value=c),null!=d&&(f.correction=d),null!=e&&(f.comment=e),fR(a);let g=JSON.stringify(f);await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/feedback/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:g});return await fW(b,"update feedback",!0),b})}async readFeedback(a){fR(a);let b=`/feedback/${a}`;return await this._get(b)}async deleteFeedback(a){fR(a);let b=`/feedback/${a}`;await this.caller.call(async()=>{let a=await this._fetch(this.apiUrl+b,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(a,`delete ${b}`,!0),a})}async *listFeedback({runIds:a,feedbackKeys:b,feedbackSourceTypes:c}={}){let d=new URLSearchParams;if(a)for(let b of a)fR(b),d.append("run",b);if(b)for(let a of b)d.append("key",a);if(c)for(let a of c)d.append("source",a);for await(let a of this._getPaginated("/feedback",d))yield*a}async createPresignedFeedbackToken(a,b,{expiration:c,feedbackConfig:d}={}){let e={run_id:a,feedback_key:b,feedback_config:d};c?"string"==typeof c?e.expires_at=c:(c?.hours||c?.minutes||c?.days)&&(e.expires_in=c):e.expires_in={hours:3};let f=JSON.stringify(e),g=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:f});return await fW(a,"create presigned feedback token"),a});return await g.json()}async createComparativeExperiment({name:a,experimentIds:b,referenceDatasetId:c,createdAt:d,description:e,metadata:f,id:g}){if(0===b.length)throw Error("At least one experiment is required");if(c||(c=(await this.readProject({projectId:b[0]})).reference_dataset_id),null==!c)throw Error("A reference dataset is required");let h={id:g,name:a,experiment_ids:b,reference_dataset_id:c,description:e,created_at:(d??new Date)?.toISOString(),extra:{}};f&&(h.extra.metadata=f);let i=JSON.stringify(h);return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await fW(a,"create comparative experiment"),a})).json()}async *listPresignedFeedbackTokens(a){fR(a);let b=new URLSearchParams({run_id:a});for await(let a of this._getPaginated("/feedback/tokens",b))yield*a}_selectEvalResults(a){return"results"in a?a.results:Array.isArray(a)?a:[a]}async _logEvaluationFeedback(a,b,c){let d=this._selectEvalResults(a),e=[];for(let a of d){let d=c||{};a.evaluatorInfo&&(d={...a.evaluatorInfo,...d});let f=null;a.targetRunId?f=a.targetRunId:b&&(f=b.id),e.push(await this.createFeedback(f,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:d,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[d,e]}async logEvaluationFeedback(a,b,c){let[d]=await this._logEvaluationFeedback(a,b,c);return d}async *listAnnotationQueues(a={}){let{queueIds:b,name:c,nameContains:d,limit:e}=a,f=new URLSearchParams;b&&b.forEach((a,b)=>{fR(a,`queueIds[${b}]`),f.append("ids",a)}),c&&f.append("name",c),d&&f.append("name_contains",d),f.append("limit",(void 0!==e?Math.min(e,100):100).toString());let g=0;for await(let a of this._getPaginated("/annotation-queues",f))if(yield*a,g++,void 0!==e&&g>=e)break}async createAnnotationQueue(a){let{name:b,description:c,queueId:d,rubricInstructions:e}=a,f=JSON.stringify(Object.fromEntries(Object.entries({name:b,description:c,id:d||fg(),rubric_instructions:e}).filter(([a,b])=>void 0!==b)));return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:f});return await fW(a,"create annotation queue"),a})).json()}async readAnnotationQueue(a){return(await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/annotation-queues/${fR(a,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,"read annotation queue"),b})).json()}async updateAnnotationQueue(a,b){let{name:c,description:d,rubricInstructions:e}=b,f=JSON.stringify({name:c,description:d,rubric_instructions:e});await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/annotation-queues/${fR(a,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:f});return await fW(b,"update annotation queue",!0),b})}async deleteAnnotationQueue(a){await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/annotation-queues/${fR(a,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,"delete annotation queue",!0),b})}async addRunsToAnnotationQueue(a,b){let c=JSON.stringify(b.map((a,b)=>fR(a,`runIds[${b}]`).toString()));await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/annotation-queues/${fR(a,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await fW(b,"add runs to annotation queue",!0),b})}async getRunFromAnnotationQueue(a,b){let c=`/annotation-queues/${fR(a,"queueId")}/run`;return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}${c}/${b}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(a,"get run from annotation queue"),a})).json()}async deleteRunFromAnnotationQueue(a,b){await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/annotation-queues/${fR(a,"queueId")}/runs/${fR(b,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(c,"delete run from annotation queue",!0),c})}async getSizeFromAnnotationQueue(a){return(await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/annotation-queues/${fR(a,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,"get size from annotation queue"),b})).json()}async _currentTenantIsOwner(a){let b=await this._getSettings();return"-"==a||b.tenant_handle===a}async _ownerConflictError(a,b){let c=await this._getSettings();return Error(`Cannot ${a} for another tenant.

      Current tenant: ${c.tenant_handle}

      Requested tenant: ${b}`)}async _getLatestCommitHash(a){let b=await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}/commits/${a}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(b,"get latest commit hash"),b}),c=await b.json();if(0!==c.commits.length)return c.commits[0].commit_hash}async _likeOrUnlikePrompt(a,b){let[c,d,e]=fU(a),f=JSON.stringify({like:b});return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/likes/${c}/${d}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:f});return await fW(a,`${b?"like":"unlike"} prompt`),a})).json()}async _getPromptUrl(a){let[b,c,d]=fU(a);if(await this._currentTenantIsOwner(b)){let a=await this._getSettings();return"latest"!==d?`${this.getHostUrl()}/prompts/${c}/${d.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${c}?organizationId=${a.id}`}return"latest"!==d?`${this.getHostUrl()}/hub/${b}/${c}/${d.substring(0,8)}`:`${this.getHostUrl()}/hub/${b}/${c}`}async promptExists(a){return!!await this.getPrompt(a)}async likePrompt(a){return this._likeOrUnlikePrompt(a,!0)}async unlikePrompt(a){return this._likeOrUnlikePrompt(a,!1)}async *listCommits(a){for await(let b of this._getPaginated(`/commits/${a}/`,new URLSearchParams,a=>a.commits))yield*b}async *listPrompts(a){let b=new URLSearchParams;for await(let c of(b.append("sort_field",a?.sortField??"updated_at"),b.append("sort_direction","desc"),b.append("is_archived",(!!a?.isArchived).toString()),a?.isPublic!==void 0&&b.append("is_public",a.isPublic.toString()),a?.query&&b.append("query",a.query),this._getPaginated("/repos",b,a=>a.repos)))yield*c}async getPrompt(a){let[b,c,d]=fU(a),e=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/repos/${b}/${c}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return a?.status===404?null:(await fW(a,"get prompt"),a)}),f=await e?.json();return f?.repo?f.repo:null}async createPrompt(a,b){let c=await this._getSettings();if(b?.isPublic&&!c.tenant_handle)throw Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[d,e,f]=fU(a);if(!await this._currentTenantIsOwner(d))throw await this._ownerConflictError("create a prompt",d);let g=JSON.stringify({repo_handle:e,...b?.description&&{description:b.description},...b?.readme&&{readme:b.readme},...b?.tags&&{tags:b.tags},is_public:!!b?.isPublic}),h=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:g});return await fW(a,"create prompt"),a}),{repo:i}=await h.json();return i}async createCommit(a,b,c){if(!await this.promptExists(a))throw Error("Prompt does not exist, you must create it first.");let[d,e,f]=fU(a),g=c?.parentCommitHash!=="latest"&&c?.parentCommitHash?c?.parentCommitHash:await this._getLatestCommitHash(`${d}/${e}`),h=JSON.stringify({manifest:JSON.parse(JSON.stringify(b)),parent_commit:g}),i=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/commits/${d}/${e}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:h});return await fW(a,"create commit"),a}),j=await i.json();return this._getPromptUrl(`${d}/${e}${j.commit_hash?`:${j.commit_hash}`:""}`)}async updateExamplesMultipart(a,b=[]){return this._updateExamplesMultipart(a,b)}async _updateExamplesMultipart(a,b=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let c=new FormData;for(let a of b){let b=a.id,d=new Blob([f3({...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split}},`Serializing body for example with id: ${b}`)],{type:"application/json"});if(c.append(b,d),a.inputs){let d=new Blob([f3(a.inputs,`Serializing inputs for example with id: ${b}`)],{type:"application/json"});c.append(`${b}.inputs`,d)}if(a.outputs){let d=new Blob([f3(a.outputs,`Serializing outputs whle updating example with id: ${b}`)],{type:"application/json"});c.append(`${b}.outputs`,d)}if(a.attachments)for(let[d,e]of Object.entries(a.attachments)){let a,f;Array.isArray(e)?[a,f]=e:(a=e.mimeType,f=e.data);let g=new Blob([f],{type:`${a}; length=${f.byteLength}`});c.append(`${b}.attachment.${d}`,g)}if(a.attachments_operations){let d=new Blob([f3(a.attachments_operations,`Serializing attachments while updating example with id: ${b}`)],{type:"application/json"});c.append(`${b}.attachments_operations`,d)}}let d=a??b[0]?.dataset_id;return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${d}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await fW(a,"update examples"),a})).json()}async uploadExamplesMultipart(a,b=[]){return this._uploadExamplesMultipart(a,b)}async _uploadExamplesMultipart(a,b=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let c=new FormData;for(let a of b){let b=(a.id??fg()).toString(),d=new Blob([f3({created_at:a.created_at,...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split},...a.source_run_id&&{source_run_id:a.source_run_id},...a.use_source_run_io&&{use_source_run_io:a.use_source_run_io},...a.use_source_run_attachments&&{use_source_run_attachments:a.use_source_run_attachments}},`Serializing body for uploaded example with id: ${b}`)],{type:"application/json"});if(c.append(b,d),a.inputs){let d=new Blob([f3(a.inputs,`Serializing inputs for uploaded example with id: ${b}`)],{type:"application/json"});c.append(`${b}.inputs`,d)}if(a.outputs){let d=new Blob([f3(a.outputs,`Serializing outputs for uploaded example with id: ${b}`)],{type:"application/json"});c.append(`${b}.outputs`,d)}if(a.attachments)for(let[d,e]of Object.entries(a.attachments)){let a,f;Array.isArray(e)?[a,f]=e:(a=e.mimeType,f=e.data);let g=new Blob([f],{type:`${a}; length=${f.byteLength}`});c.append(`${b}.attachment.${d}`,g)}}return(await this.caller.call(async()=>{let b=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${a}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await fW(b,"upload examples"),b})).json()}async updatePrompt(a,b){if(!await this.promptExists(a))throw Error("Prompt does not exist, you must create it first.");let[c,d]=fU(a);if(!await this._currentTenantIsOwner(c))throw await this._ownerConflictError("update a prompt",c);let e={};if(b?.description!==void 0&&(e.description=b.description),b?.readme!==void 0&&(e.readme=b.readme),b?.tags!==void 0&&(e.tags=b.tags),b?.isPublic!==void 0&&(e.is_public=b.isPublic),b?.isArchived!==void 0&&(e.is_archived=b.isArchived),0===Object.keys(e).length)throw Error("No valid update options provided");let f=JSON.stringify(e);return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/repos/${c}/${d}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:f});return await fW(a,"update prompt"),a})).json()}async deletePrompt(a){if(!await this.promptExists(a))throw Error("Prompt does not exist, you must create it first.");let[b,c,d]=fU(a);if(!await this._currentTenantIsOwner(b))throw await this._ownerConflictError("delete a prompt",b);return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/repos/${b}/${c}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(a,"delete prompt"),a})).json()}async pullPromptCommit(a,b){let[c,d,e]=fU(a),f=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/commits/${c}/${d}/${e}${b?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await fW(a,"pull prompt commit"),a}),g=await f.json();return{owner:c,repo:d,commit_hash:g.commit_hash,manifest:g.manifest,examples:g.examples}}async _pullPrompt(a,b){return JSON.stringify((await this.pullPromptCommit(a,{includeModel:b?.includeModel})).manifest)}async pushPrompt(a,b){return(await this.promptExists(a)?b&&Object.keys(b).some(a=>"object"!==a)&&await this.updatePrompt(a,{description:b?.description,readme:b?.readme,tags:b?.tags,isPublic:b?.isPublic}):await this.createPrompt(a,{description:b?.description,readme:b?.readme,tags:b?.tags,isPublic:b?.isPublic}),b?.object)?await this.createCommit(a,b?.object,{parentCommitHash:b?.parentCommitHash}):await this._getPromptUrl(a)}async clonePublicDataset(a,b={}){let{sourceApiUrl:c=this.apiUrl,datasetName:d}=b,[e,f]=this.parseTokenOrUrl(a,c),g=new gc({apiUrl:e,apiKey:"placeholder"}),h=await g.readSharedDataset(f),i=d||h.name;try{if(await this.hasDataset({datasetId:i}))return void console.log(`Dataset ${i} already exists in your tenant. Skipping.`)}catch(a){}let j=await g.listSharedExamples(f),k=await this.createDataset(i,{description:h.description,dataType:h.data_type||"kv",inputsSchema:h.inputs_schema_definition??void 0,outputsSchema:h.outputs_schema_definition??void 0});try{await this.createExamples({inputs:j.map(a=>a.inputs),outputs:j.flatMap(a=>a.outputs?[a.outputs]:[]),datasetId:k.id})}catch(a){throw console.error(`An error occurred while creating dataset ${i}. You should delete it manually.`),a}}parseTokenOrUrl(a,b,c=2,d="dataset"){try{return fR(a),[b,a]}catch(a){}try{let e=new URL(a).pathname.split("/").filter(a=>""!==a);if(e.length>=c){let a=e[e.length-c];return[b,a]}throw Error(`Invalid public ${d} URL: ${a}`)}catch(b){throw Error(`Invalid public ${d} URL or token: ${a}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:a})=>a),this.batchIngestCaller.queue.onIdle()]),void 0!==this.langSmithToOTELTranslator&&await fG.getDefaultOTLPTracerComponents()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}}function gd(a){return"dataset_id"in a||"dataset_name"in a}let ge=Symbol.for("lc:context_variables");function gf(a,b,c=1){let d=c.toFixed(0).slice(0,3).padStart(3,"0"),e=`${new Date(a).toISOString().slice(0,-1)}${d}Z`;return{dottedOrder:e.replace(/[-:.]/g,"")+b,microsecondPrecisionDatestring:e}}class gg{constructor(a,b,c,d){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=a,this.tags=b,this.project_name=c,this.replicas=d}static fromHeader(a){let b,c,d=a.split(","),e={},f=[];for(let a of d){let[d,g]=a.split("="),h=decodeURIComponent(g);"langsmith-metadata"===d?e=JSON.parse(h):"langsmith-tags"===d?f=h.split(","):"langsmith-project"===d?b=h:"langsmith-replicas"===d&&(c=JSON.parse(h))}return new gg(e,f,b,c)}toHeader(){let a=[];return this.metadata&&Object.keys(this.metadata).length>0&&a.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&a.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&a.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),a.join(",")}}class gh{constructor(a){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(a){return null!=a&&"function"==typeof a.createChild&&"function"==typeof a.postRun}(a))return void Object.assign(this,{...a});const b=gh.getDefaultConfig(),{metadata:c,...d}=a,e=d.client??gh.getSharedClient(),f={...c,...d?.extra?.metadata};if(d.extra={...d.extra,metadata:f},Object.assign(this,{...b,...d,client:e}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=function(a){return a?a.map(a=>Array.isArray(a)?{projectName:a[0],updates:a[1]}:a):function(){let a=fx("LANGSMITH_RUNS_ENDPOINTS");if(!a)return[];try{let c=JSON.parse(a);if(Array.isArray(c)){let a=[];for(let b of c){if("object"!=typeof b||null===b){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof b}`);continue}if("string"!=typeof b.api_url){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof b.api_url}`);continue}if("string"!=typeof b.api_key){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof b.api_key}`);continue}a.push({apiUrl:b.api_url.replace(/\/$/,""),apiKey:b.api_key})}return a}if("object"!=typeof c||null===c)return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof c}`),[];{var b=c;if(Object.keys(b).length>0&&fy("ENDPOINT"))throw new fY;let a=[];for(let[b,d]of Object.entries(c)){let c=b.replace(/\/$/,"");if("string"==typeof d)a.push({apiUrl:c,apiKey:d});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${b}: expected string, got ${typeof d}`);continue}}return a}}catch(a){if("object"==typeof a&&null!==a&&a.code===fX)throw a;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}()}(this.replicas),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){const{dottedOrder:a,microsecondPrecisionDatestring:b}=gf(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+a:this.dotted_order=a,this._serialized_start_time=b}}set metadata(a){this.extra={...this.extra,metadata:{...this.extra?.metadata,...a}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:fg(),run_type:"chain",project_name:ft(),child_runs:[],api_url:fx("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:fx("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return gh.sharedClient||(gh.sharedClient=new gc),gh.sharedClient}createChild(a){var b,c;let d=this.child_execution_order+1,e=new gh({...a,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:d,child_execution_order:d});ge in this&&(e[ge]=this[ge]);let f=Symbol.for("lc:child_config"),g=a.extra?.[f]??this.extra[f];if(null!=(b=g)&&"object"==typeof b.callbacks&&(gj(b.callbacks?.handlers)||gj(b.callbacks))){let a={...g},b="object"==typeof(c=a.callbacks)&&null!=c&&Array.isArray(c.handlers)?a.callbacks.copy?.():void 0;b&&(Object.assign(b,{_parentRunId:e.id}),b.handlers?.find(gi)?.updateFromRunTree?.(e),a.callbacks=b),e.extra[f]=a}let h=new Set,i=this;for(;null!=i&&!h.has(i.id);)h.add(i.id),i.child_execution_order=Math.max(i.child_execution_order,d),i=i.parent_run;return this.child_runs.push(e),e}async end(a,b,c=Date.now(),d){this.outputs=this.outputs??a,this.error=this.error??b,this.end_time=this.end_time??c,d&&Object.keys(d).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...d}}:{metadata:d})}_convertToCreate(a,b,c=!0){let d,e,f=a.extra??{};if(f?.runtime?.library===void 0&&(f.runtime||(f.runtime={}),b))for(let[a,c]of Object.entries(b))f.runtime[a]||(f.runtime[a]=c);return c?(e=a.parent_run?.id??a.parent_run_id,d=[]):(d=a.child_runs.map(a=>this._convertToCreate(a,b,c)),e=void 0),{id:a.id,name:a.name,start_time:a._serialized_start_time??a.start_time,end_time:a.end_time,run_type:a.run_type,reference_example_id:a.reference_example_id,extra:f,serialized:a.serialized,error:a.error,inputs:a.inputs,outputs:a.outputs,session_name:a.project_name,child_runs:d,parent_run_id:e,trace_id:a.trace_id,dotted_order:a.dotted_order,tags:a.tags,attachments:a.attachments,events:a.events}}_remapForProject(a,b,c=!0){let d,e=this._convertToCreate(this,b,c);if(a===this.project_name)return e;let f=b=>fm(`${b}:${a}`,fm.DNS),g=f(e.id),h=e.trace_id?f(e.trace_id):void 0,i=e.parent_run_id?f(e.parent_run_id):void 0;if(e.dotted_order){let a=e.dotted_order.split(".").map(a=>{let b=a.slice(0,-36),c=a.slice(-36);return[new Date(parseInt(b.slice(0,4)),parseInt(b.slice(4,6))-1,parseInt(b.slice(6,8)),parseInt(b.slice(9,11)),parseInt(b.slice(11,13)),parseInt(b.slice(13,15)),parseInt(b.slice(15,21))/1e3),c]}),b=[];for(let c=0;c<a.length-1;c++){let[d,e]=a[c],g=f(e);b.push(d.toISOString().replace(/[-:]/g,"").replace(".","")+g)}let[c]=a[a.length-1];b.push(c.toISOString().replace(/[-:]/g,"").replace(".","")+g),d=b.join(".")}else d=void 0;return{...e,id:g,trace_id:h,parent_run_id:i,dotted_order:d,session_name:a}}async postRun(a=!0){try{let b=fw();if(this.replicas&&this.replicas.length>0)for(let{projectName:a,apiKey:c,apiUrl:d,workspaceId:e}of this.replicas){let f=this._remapForProject(a??this.project_name,b,!0);await this.client.createRun(f,{apiKey:c,apiUrl:d,workspaceId:e})}else{let c=this._convertToCreate(this,b,a);await this.client.createRun(c)}if(!a)for(let a of(fT("Posting with excludeChildRuns=false is deprecated and will be removed in a future version."),this.child_runs))await a.postRun(!1)}catch(a){console.error(`Error in postRun for run ${this.id}:`,a)}}async patchRun(a){if(this.replicas&&this.replicas.length>0)for(let{projectName:b,apiKey:c,apiUrl:d,workspaceId:e,updates:f}of this.replicas){let g=this._remapForProject(b??this.project_name),h={id:g.id,outputs:g.outputs,error:g.error,parent_run_id:g.parent_run_id,session_name:g.session_name,reference_example_id:g.reference_example_id,end_time:g.end_time,dotted_order:g.dotted_order,trace_id:g.trace_id,events:g.events,tags:g.tags,extra:g.extra,attachments:this.attachments,...f};a?.excludeInputs||(h.inputs=g.inputs),await this.client.updateRun(g.id,h,{apiKey:c,apiUrl:d,workspaceId:e})}else try{let b={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};a?.excludeInputs||(b.inputs=this.inputs),await this.client.updateRun(this.id,b)}catch(a){console.error(`Error in patchRun for run ${this.id}`,a)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(a){this.events||(this.events=[]),"string"==typeof a?this.events.push({name:"event",time:new Date().toISOString(),message:a}):this.events.push({...a,time:a.time??new Date().toISOString()})}static fromRunnableConfig(a,b){var c;let d,e,f,g=a?.callbacks,h=void 0!==c?c:!!["TRACING_V2","TRACING"].find(a=>"true"===fy(a));if(g){let a=g?.getParentRunId?.()??"",b=g?.handlers?.find(a=>a?.name=="langchain_tracer");d=b?.getRun?.(a),e=b?.projectName,f=b?.client,h=h||!!b}return d?new gh({name:d.name,id:d.id,trace_id:d.trace_id,dotted_order:d.dotted_order,client:f,tracingEnabled:h,project_name:e,tags:[...new Set((d?.tags??[]).concat(a?.tags??[]))],extra:{metadata:{...d?.extra?.metadata,...a?.metadata}}}).createChild(b):new gh({...b,client:f,tracingEnabled:h,project_name:e})}static fromDottedOrder(a){return this.fromHeaders({"langsmith-trace":a})}static fromHeaders(a,b){let c="get"in a&&"function"==typeof a.get?{"langsmith-trace":a.get("langsmith-trace"),baggage:a.get("baggage")}:a,d=c["langsmith-trace"];if(!d||"string"!=typeof d)return;let e=d.trim(),f=e.split(".").map(a=>{let[b,c]=a.split("Z");return{strTime:b,time:Date.parse(b+"Z"),uuid:c}}),g=f[0].uuid,h={...b,name:b?.name??"parent",run_type:b?.run_type??"chain",start_time:b?.start_time??Date.now(),id:f.at(-1)?.uuid,trace_id:g,dotted_order:e};if(c.baggage&&"string"==typeof c.baggage){let a=gg.fromHeader(c.baggage);h.metadata=a.metadata,h.tags=a.tags,h.project_name=a.project_name,h.replicas=a.replicas}return new gh(h)}toHeaders(a){let b={"langsmith-trace":this.dotted_order,baggage:new gg(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(a)for(let[c,d]of Object.entries(b))a.set(c,d);return b}}function gi(a){return"object"==typeof a&&null!=a&&"string"==typeof a.name&&"langchain_tracer"===a.name}function gj(a){return Array.isArray(a)&&a.some(a=>gi(a))}function gk(a,b){return a&&!Array.isArray(a)&&"object"==typeof a?a:{[b]:a}}function gl(a){return"function"==typeof a._addRunToRunMap}Object.defineProperty(gh,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null}),dy({},{BaseTracer:()=>gm,isBaseTracer:()=>gl});var gm=class extends fj{runMap=new Map;runTreeMap=new Map;usesRunTreeMap=!1;constructor(a){super(...arguments)}copy(){return this}getRunById(a){if(void 0!==a)return this.usesRunTreeMap?(a=>{if(a)return a.events=a.events??[],a.child_runs=a.child_runs??[],a})(this.runTreeMap.get(a)):this.runMap.get(a)}stringifyError(a){return a instanceof Error?a.message+(a?.stack?`

${a.stack}`:""):"string"==typeof a?a:`${a}`}_addChildRun(a,b){a.child_runs.push(b)}_addRunToRunMap(a){let{dottedOrder:b,microsecondPrecisionDatestring:c}=gf(new Date(a.start_time).getTime(),a.id,a.execution_order),d={...a},e=this.getRunById(d.parent_run_id);if(void 0!==d.parent_run_id?e&&(this._addChildRun(e,d),e.child_execution_order=Math.max(e.child_execution_order,d.child_execution_order),d.trace_id=e.trace_id,void 0!==e.dotted_order&&(d.dotted_order=[e.dotted_order,b].join("."),d._serialized_start_time=c)):(d.trace_id=d.id,d.dotted_order=b,d._serialized_start_time=c),this.usesRunTreeMap){let a=function a(b,c){if(b)return new gh({...b,start_time:b._serialized_start_time??b.start_time,parent_run:a(c),child_runs:b.child_runs.map(b=>a(b)).filter(a=>void 0!==a),extra:{...b.extra,runtime:dF()},tracingEnabled:!1})}(d,e);void 0!==a&&this.runTreeMap.set(d.id,a)}else this.runMap.set(d.id,d);return d}async _endTrace(a){let b=void 0!==a.parent_run_id&&this.getRunById(a.parent_run_id);b?b.child_execution_order=Math.max(b.child_execution_order,a.child_execution_order):await this.persistRun(a),await this.onRunUpdate?.(a),this.usesRunTreeMap?this.runTreeMap.delete(a.id):this.runMap.delete(a.id)}_getExecutionOrder(a){let b=void 0!==a&&this.getRunById(a);return b?b.child_execution_order+1:1}_createRunForLLMStart(a,b,c,d,e,f,g,h){let i=this._getExecutionOrder(d),j=Date.now(),k=g?{...e,metadata:g}:e,l={id:c,name:h??a.id[a.id.length-1],parent_run_id:d,start_time:j,serialized:a,events:[{name:"start",time:new Date(j).toISOString()}],inputs:{prompts:b},execution_order:i,child_runs:[],child_execution_order:i,run_type:"llm",extra:k??{},tags:f||[]};return this._addRunToRunMap(l)}async handleLLMStart(a,b,c,d,e,f,g,h){let i=this.getRunById(c)??this._createRunForLLMStart(a,b,c,d,e,f,g,h);return await this.onRunCreate?.(i),await this.onLLMStart?.(i),i}_createRunForChatModelStart(a,b,c,d,e,f,g,h){let i=this._getExecutionOrder(d),j=Date.now(),k=g?{...e,metadata:g}:e,l={id:c,name:h??a.id[a.id.length-1],parent_run_id:d,start_time:j,serialized:a,events:[{name:"start",time:new Date(j).toISOString()}],inputs:{messages:b},execution_order:i,child_runs:[],child_execution_order:i,run_type:"llm",extra:k??{},tags:f||[]};return this._addRunToRunMap(l)}async handleChatModelStart(a,b,c,d,e,f,g,h){let i=this.getRunById(c)??this._createRunForChatModelStart(a,b,c,d,e,f,g,h);return await this.onRunCreate?.(i),await this.onLLMStart?.(i),i}async handleLLMEnd(a,b,c,d,e){let f=this.getRunById(b);if(!f||f?.run_type!=="llm")throw Error("No LLM run to end.");return f.end_time=Date.now(),f.outputs=a,f.events.push({name:"end",time:new Date(f.end_time).toISOString()}),f.extra={...f.extra,...e},await this.onLLMEnd?.(f),await this._endTrace(f),f}async handleLLMError(a,b,c,d,e){let f=this.getRunById(b);if(!f||f?.run_type!=="llm")throw Error("No LLM run to end.");return f.end_time=Date.now(),f.error=this.stringifyError(a),f.events.push({name:"error",time:new Date(f.end_time).toISOString()}),f.extra={...f.extra,...e},await this.onLLMError?.(f),await this._endTrace(f),f}_createRunForChainStart(a,b,c,d,e,f,g,h){let i=this._getExecutionOrder(d),j=Date.now(),k={id:c,name:h??a.id[a.id.length-1],parent_run_id:d,start_time:j,serialized:a,events:[{name:"start",time:new Date(j).toISOString()}],inputs:b,execution_order:i,child_execution_order:i,run_type:g??"chain",child_runs:[],extra:f?{metadata:f}:{},tags:e||[]};return this._addRunToRunMap(k)}async handleChainStart(a,b,c,d,e,f,g,h){let i=this.getRunById(c)??this._createRunForChainStart(a,b,c,d,e,f,g,h);return await this.onRunCreate?.(i),await this.onChainStart?.(i),i}async handleChainEnd(a,b,c,d,e){let f=this.getRunById(b);if(!f)throw Error("No chain run to end.");return f.end_time=Date.now(),f.outputs=gk(a,"output"),f.events.push({name:"end",time:new Date(f.end_time).toISOString()}),e?.inputs!==void 0&&(f.inputs=gk(e.inputs,"input")),await this.onChainEnd?.(f),await this._endTrace(f),f}async handleChainError(a,b,c,d,e){let f=this.getRunById(b);if(!f)throw Error("No chain run to end.");return f.end_time=Date.now(),f.error=this.stringifyError(a),f.events.push({name:"error",time:new Date(f.end_time).toISOString()}),e?.inputs!==void 0&&(f.inputs=gk(e.inputs,"input")),await this.onChainError?.(f),await this._endTrace(f),f}_createRunForToolStart(a,b,c,d,e,f,g){let h=this._getExecutionOrder(d),i=Date.now(),j={id:c,name:g??a.id[a.id.length-1],parent_run_id:d,start_time:i,serialized:a,events:[{name:"start",time:new Date(i).toISOString()}],inputs:{input:b},execution_order:h,child_execution_order:h,run_type:"tool",child_runs:[],extra:f?{metadata:f}:{},tags:e||[]};return this._addRunToRunMap(j)}async handleToolStart(a,b,c,d,e,f,g){let h=this.getRunById(c)??this._createRunForToolStart(a,b,c,d,e,f,g);return await this.onRunCreate?.(h),await this.onToolStart?.(h),h}async handleToolEnd(a,b){let c=this.getRunById(b);if(!c||c?.run_type!=="tool")throw Error("No tool run to end");return c.end_time=Date.now(),c.outputs={output:a},c.events.push({name:"end",time:new Date(c.end_time).toISOString()}),await this.onToolEnd?.(c),await this._endTrace(c),c}async handleToolError(a,b){let c=this.getRunById(b);if(!c||c?.run_type!=="tool")throw Error("No tool run to end");return c.end_time=Date.now(),c.error=this.stringifyError(a),c.events.push({name:"error",time:new Date(c.end_time).toISOString()}),await this.onToolError?.(c),await this._endTrace(c),c}async handleAgentAction(a,b){let c=this.getRunById(b);c&&c?.run_type==="chain"&&(c.actions=c.actions||[],c.actions.push(a),c.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:a}}),await this.onAgentAction?.(c))}async handleAgentEnd(a,b){let c=this.getRunById(b);c&&c?.run_type==="chain"&&(c.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:a}}),await this.onAgentEnd?.(c))}_createRunForRetrieverStart(a,b,c,d,e,f,g){let h=this._getExecutionOrder(d),i=Date.now(),j={id:c,name:g??a.id[a.id.length-1],parent_run_id:d,start_time:i,serialized:a,events:[{name:"start",time:new Date(i).toISOString()}],inputs:{query:b},execution_order:h,child_execution_order:h,run_type:"retriever",child_runs:[],extra:f?{metadata:f}:{},tags:e||[]};return this._addRunToRunMap(j)}async handleRetrieverStart(a,b,c,d,e,f,g){let h=this.getRunById(c)??this._createRunForRetrieverStart(a,b,c,d,e,f,g);return await this.onRunCreate?.(h),await this.onRetrieverStart?.(h),h}async handleRetrieverEnd(a,b){let c=this.getRunById(b);if(!c||c?.run_type!=="retriever")throw Error("No retriever run to end");return c.end_time=Date.now(),c.outputs={documents:a},c.events.push({name:"end",time:new Date(c.end_time).toISOString()}),await this.onRetrieverEnd?.(c),await this._endTrace(c),c}async handleRetrieverError(a,b){let c=this.getRunById(b);if(!c||c?.run_type!=="retriever")throw Error("No retriever run to end");return c.end_time=Date.now(),c.error=this.stringifyError(a),c.events.push({name:"error",time:new Date(c.end_time).toISOString()}),await this.onRetrieverError?.(c),await this._endTrace(c),c}async handleText(a,b){let c=this.getRunById(b);c&&c?.run_type==="chain"&&(c.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:a}}),await this.onText?.(c))}async handleLLMNewToken(a,b,c,d,e,f){let g=this.getRunById(c);if(!g||g?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return g.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:a,idx:b,chunk:f?.chunk}}),await this.onLLMNewToken?.(g,a,{chunk:f?.chunk}),g}};let gn=(a=0)=>b=>`\u001B[${b+a}m`,go=(a=0)=>b=>`\u001B[${38+a};5;${b}m`,gp=(a=0)=>(b,c,d)=>`\u001B[${38+a};2;${b};${c};${d}m`,gq={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};Object.keys(gq.modifier),[...Object.keys(gq.color),...Object.keys(gq.bgColor)];let gr=function(){let a=new Map;for(let[b,c]of Object.entries(gq)){for(let[b,d]of Object.entries(c))gq[b]={open:`\u001B[${d[0]}m`,close:`\u001B[${d[1]}m`},c[b]=gq[b],a.set(d[0],d[1]);Object.defineProperty(gq,b,{value:c,enumerable:!1})}return Object.defineProperty(gq,"codes",{value:a,enumerable:!1}),gq.color.close="\x1b[39m",gq.bgColor.close="\x1b[49m",gq.color.ansi=gn(),gq.color.ansi256=go(),gq.color.ansi16m=gp(),gq.bgColor.ansi=gn(10),gq.bgColor.ansi256=go(10),gq.bgColor.ansi16m=gp(10),Object.defineProperties(gq,{rgbToAnsi256:{value:(a,b,c)=>a===b&&b===c?a<8?16:a>248?231:Math.round((a-8)/247*24)+232:16+36*Math.round(a/255*5)+6*Math.round(b/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value(a){let b=/[a-f\d]{6}|[a-f\d]{3}/i.exec(a.toString(16));if(!b)return[0,0,0];let[c]=b;3===c.length&&(c=[...c].map(a=>a+a).join(""));let d=Number.parseInt(c,16);return[d>>16&255,d>>8&255,255&d]},enumerable:!1},hexToAnsi256:{value:a=>gq.rgbToAnsi256(...gq.hexToRgb(a)),enumerable:!1},ansi256ToAnsi:{value(a){let b,c,d;if(a<8)return 30+a;if(a<16)return 90+(a-8);if(a>=232)c=b=((a-232)*10+8)/255,d=b;else{let e=(a-=16)%36;b=Math.floor(a/36)/5,c=Math.floor(e/6)/5,d=e%6/5}let e=2*Math.max(b,c,d);if(0===e)return 30;let f=30+(Math.round(d)<<2|Math.round(c)<<1|Math.round(b));return 2===e&&(f+=60),f},enumerable:!1},rgbToAnsi:{value:(a,b,c)=>gq.ansi256ToAnsi(gq.rgbToAnsi256(a,b,c)),enumerable:!1},hexToAnsi:{value:a=>gq.ansi256ToAnsi(gq.hexToAnsi256(a)),enumerable:!1}}),gq}();function gs(a,b){return`${a.open}${b}${a.close}`}function gt(a,b){try{return JSON.stringify(a,null,2)}catch{return b}}function gu(a){return"string"==typeof a?a.trim():null==a?a:gt(a,a.toString())}function gv(a){if(!a.end_time)return"";let b=a.end_time-a.start_time;return b<1e3?`${b}ms`:`${(b/1e3).toFixed(2)}s`}dy({},{ConsoleCallbackHandler:()=>gx});let{color:gw}=gr;var gx=class extends gm{name="console_callback_handler";persistRun(a){return Promise.resolve()}getParents(a){let b=[],c=a;for(;c.parent_run_id;){let a=this.runMap.get(c.parent_run_id);if(a)b.push(a),c=a;else break}return b}getBreadcrumbs(a){let b=[...this.getParents(a).reverse(),a].map((a,b,c)=>{let d=`${a.execution_order}:${a.run_type}:${a.name}`;return b===c.length-1?gs(gr.bold,d):d}).join(" > ");return gs(gw.grey,b)}onChainStart(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.green,"[chain/start]")} [${b}] Entering Chain run with input: ${gt(a.inputs,"[inputs]")}`)}onChainEnd(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.cyan,"[chain/end]")} [${b}] [${gv(a)}] Exiting Chain run with output: ${gt(a.outputs,"[outputs]")}`)}onChainError(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.red,"[chain/error]")} [${b}] [${gv(a)}] Chain run errored with error: ${gt(a.error,"[error]")}`)}onLLMStart(a){let b=this.getBreadcrumbs(a),c="prompts"in a.inputs?{prompts:a.inputs.prompts.map(a=>a.trim())}:a.inputs;console.log(`${gs(gw.green,"[llm/start]")} [${b}] Entering LLM run with input: ${gt(c,"[inputs]")}`)}onLLMEnd(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.cyan,"[llm/end]")} [${b}] [${gv(a)}] Exiting LLM run with output: ${gt(a.outputs,"[response]")}`)}onLLMError(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.red,"[llm/error]")} [${b}] [${gv(a)}] LLM run errored with error: ${gt(a.error,"[error]")}`)}onToolStart(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.green,"[tool/start]")} [${b}] Entering Tool run with input: "${gu(a.inputs.input)}"`)}onToolEnd(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.cyan,"[tool/end]")} [${b}] [${gv(a)}] Exiting Tool run with output: "${gu(a.outputs?.output)}"`)}onToolError(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.red,"[tool/error]")} [${b}] [${gv(a)}] Tool run errored with error: ${gt(a.error,"[error]")}`)}onRetrieverStart(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.green,"[retriever/start]")} [${b}] Entering Retriever run with input: ${gt(a.inputs,"[inputs]")}`)}onRetrieverEnd(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.cyan,"[retriever/end]")} [${b}] [${gv(a)}] Exiting Retriever run with output: ${gt(a.outputs,"[outputs]")}`)}onRetrieverError(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.red,"[retriever/error]")} [${b}] [${gv(a)}] Retriever run errored with error: ${gt(a.error,"[error]")}`)}onAgentAction(a){let b=this.getBreadcrumbs(a);console.log(`${gs(gw.blue,"[agent/action]")} [${b}] Agent selected action: ${gt(a.actions[a.actions.length-1],"[action]")}`)}};a.i(762767);let gy=()=>(void 0===f&&(f=new gc("false"===dG("LANGCHAIN_CALLBACKS_BACKGROUND")?{blockOnRootRunFinalization:!0}:{})),f),gz=Symbol.for("ls:tracing_async_local_storage"),gA=new class{getStore(){}run(a,b){return b()}},gB=new class{getInstance(){return globalThis[gz]??gA}initializeGlobalInstance(a){void 0===globalThis[gz]&&(globalThis[gz]=a)}};function gC(a){return"function"==typeof a&&"langsmith:traceable"in a}Symbol.for("langsmith:traceable:root"),dy({},{LangChainTracer:()=>gD});var gD=class a extends gm{name="langchain_tracer";projectName;exampleId;client;replicas;usesRunTreeMap=!0;constructor(b={}){super(b);const{exampleId:c,projectName:d,client:e,replicas:f}=b;this.projectName=d??ft(),this.replicas=f,this.exampleId=c,this.client=e??gy();const g=a.getTraceableRunTree();g&&this.updateFromRunTree(g)}async persistRun(a){}async onRunCreate(a){let b=this.getRunTreeWithTracingConfig(a.id);await b?.postRun()}async onRunUpdate(a){let b=this.getRunTreeWithTracingConfig(a.id);await b?.patchRun()}getRun(a){return this.runTreeMap.get(a)}updateFromRunTree(a){this.runTreeMap.set(a.id,a);let b=a,c=new Set;for(;b.parent_run&&!c.has(b.id)&&(c.add(b.id),b.parent_run);){;b=b.parent_run}c.clear();let d=[b];for(;d.length>0;){let a=d.shift();!(!a||c.has(a.id))&&(c.add(a.id),this.runTreeMap.set(a.id,a),a.child_runs&&d.push(...a.child_runs))}this.client=a.client??this.client,this.replicas=a.replicas??this.replicas,this.projectName=a.project_name??this.projectName,this.exampleId=a.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(a){let b=this.runTreeMap.get(a);if(b)return new gh({...b,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return function(a=!1){let b=gB.getInstance().getStore();if(!a&&void 0===b)throw Error("Could not get the current run tree.\n\nPlease make sure you are calling this method within a traceable function and that tracing is enabled.");return b}(!0)}catch{return}}};let gE=Symbol.for("ls:tracing_async_local_storage"),gF=Symbol.for("lc:context_variables"),gG=()=>globalThis[gE];var gH=a.i(971564);gH.default;var gI=gH;class gJ extends Error{name="TimeoutError";constructor(a,b){super(a,b),Error.captureStackTrace?.(this,gJ)}}let gK=a=>a.reason??new DOMException("This operation was aborted.","AbortError");class gL{#F=[];enqueue(a,b){let{priority:c=0,id:d}=b??{},e={priority:c,id:d,run:a};if(0===this.size||this.#F[this.size-1].priority>=c)return void this.#F.push(e);let f=function(a,b,c){let d=0,e=a.length;for(;e>0;){let f=Math.trunc(e/2),g=d+f;0>=c(a[g],b)?(d=++g,e-=f+1):e=f}return d}(this.#F,e,(a,b)=>b.priority-a.priority);this.#F.splice(f,0,e)}setPriority(a,b){let c=this.#F.findIndex(b=>b.id===a);if(-1===c)throw ReferenceError(`No promise function with the id "${a}" exists in the queue.`);let[d]=this.#F.splice(c,1);this.enqueue(d.run,{priority:b,id:a})}dequeue(){let a=this.#F.shift();return a?.run}filter(a){return this.#F.filter(b=>b.priority===a.priority).map(a=>a.run)}get size(){return this.#F.length}}class gM extends gI.default{#G;#H;#I=0;#J;#K=!1;#L=!1;#M;#N=0;#O=0;#P;#Q;#F;#R;#S=0;#T;#U;#V=1n;#W=new Map;timeout;constructor(a){if(super(),!("number"==typeof(a={carryoverIntervalCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:gL,...a}).intervalCap&&a.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${a.intervalCap?.toString()??""}\` (${typeof a.intervalCap})`);if(void 0===a.interval||!(Number.isFinite(a.interval)&&a.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${a.interval?.toString()??""}\` (${typeof a.interval})`);if(this.#G=a.carryoverIntervalCount??a.carryoverConcurrencyCount??!1,this.#H=a.intervalCap===1/0||0===a.interval,this.#J=a.intervalCap,this.#M=a.interval,this.#F=new a.queueClass,this.#R=a.queueClass,this.concurrency=a.concurrency,void 0!==a.timeout&&!(Number.isFinite(a.timeout)&&a.timeout>0))throw TypeError(`Expected \`timeout\` to be a positive finite number, got \`${a.timeout}\` (${typeof a.timeout})`);this.timeout=a.timeout,this.#U=!1===a.autoStart,this.#X()}get #Y(){return this.#H||this.#I<this.#J}get #Z(){return this.#S<this.#T}#$(){this.#S--,0===this.#S&&this.emit("pendingZero"),this.#_(),this.emit("next")}#aa(){this.#ab(),this.#ac(),this.#Q=void 0}get #ad(){let a=Date.now();if(void 0===this.#P){let b=this.#N-a;if(!(b<0))return this.#ae(b),!0;if(this.#O>0){let b=a-this.#O;if(b<this.#M)return this.#ae(this.#M-b),!0}this.#I=this.#G?this.#S:0}return!1}#ae(a){void 0===this.#Q&&(this.#Q=setTimeout(()=>{this.#aa()},a))}#af(){this.#P&&(clearInterval(this.#P),this.#P=void 0)}#ag(){this.#Q&&(clearTimeout(this.#Q),this.#Q=void 0)}#_(){if(0===this.#F.size)return this.#af(),this.emit("empty"),0===this.#S&&(this.#ag(),this.emit("idle")),!1;let a=!1;if(!this.#U){let b=!this.#ad;if(this.#Y&&this.#Z){let c=this.#F.dequeue();this.#H||(this.#I++,this.#ah()),this.emit("active"),this.#O=Date.now(),c(),b&&this.#ac(),a=!0}}return a}#ac(){this.#H||void 0!==this.#P||(this.#P=setInterval(()=>{this.#ab()},this.#M),this.#N=Date.now()+this.#M)}#ab(){0===this.#I&&0===this.#S&&this.#P&&this.#af(),this.#I=this.#G?this.#S:0,this.#ai(),this.#ah()}#ai(){for(;this.#_(););}get concurrency(){return this.#T}set concurrency(a){if(!("number"==typeof a&&a>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${a}\` (${typeof a})`);this.#T=a,this.#ai()}setPriority(a,b){if("number"!=typeof b||!Number.isFinite(b))throw TypeError(`Expected \`priority\` to be a finite number, got \`${b}\` (${typeof b})`);this.#F.setPriority(a,b)}async add(a,b={}){return b.id??=(this.#V++).toString(),b={timeout:this.timeout,...b},new Promise((c,d)=>{let e=Symbol(`task-${b.id}`);this.#F.enqueue(async()=>{let f;this.#S++,this.#W.set(e,{id:b.id,priority:b.priority??0,startTime:Date.now(),timeout:b.timeout});try{try{b.signal?.throwIfAborted()}catch(a){throw!this.#H&&this.#I--,this.#W.delete(e),a}let d=a({signal:b.signal});if(b.timeout&&(d=function(a,b){let c,d,{milliseconds:e,fallback:f,message:g,customTimers:h={setTimeout,clearTimeout},signal:i}=b,j=new Promise((b,j)=>{if("number"!=typeof e||1!==Math.sign(e))throw TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(i?.aborted)return void j(gK(i));if(i&&(d=()=>{j(gK(i))},i.addEventListener("abort",d,{once:!0})),a.then(b,j),e===1/0)return;let k=new gJ;c=h.setTimeout.call(void 0,()=>{if(f){try{b(f())}catch(a){j(a)}return}"function"==typeof a.cancel&&a.cancel(),!1===g?b():g instanceof Error?j(g):(k.message=g??`Promise timed out after ${e} milliseconds`,j(k))},e)}).finally(()=>{j.clear(),d&&i&&i.removeEventListener("abort",d)});return j.clear=()=>{h.clearTimeout.call(void 0,c),c=void 0},j}(Promise.resolve(d),{milliseconds:b.timeout,message:`Task timed out after ${b.timeout}ms (queue has ${this.#S} running, ${this.#F.size} waiting)`})),b.signal){let{signal:a}=b;d=Promise.race([d,new Promise((b,c)=>{f=()=>{c(a.reason)},a.addEventListener("abort",f,{once:!0})})])}let g=await d;c(g),this.emit("completed",g)}catch(a){d(a),this.emit("error",a)}finally{f&&b.signal?.removeEventListener("abort",f),this.#W.delete(e),queueMicrotask(()=>{this.#$()})}},b),this.emit("add"),this.#_()})}async addAll(a,b){return Promise.all(a.map(async a=>this.add(a,b)))}start(){return this.#U&&(this.#U=!1,this.#ai()),this}pause(){this.#U=!0}clear(){this.#F=new this.#R,this.#aj()}async onEmpty(){0!==this.#F.size&&await this.#ak("empty")}async onSizeLessThan(a){this.#F.size<a||await this.#ak("next",()=>this.#F.size<a)}async onIdle(){(0!==this.#S||0!==this.#F.size)&&await this.#ak("idle")}async onPendingZero(){0!==this.#S&&await this.#ak("pendingZero")}async onRateLimit(){this.isRateLimited||await this.#ak("rateLimit")}async onRateLimitCleared(){this.isRateLimited&&await this.#ak("rateLimitCleared")}async onError(){return new Promise((a,b)=>{let c=a=>{this.off("error",c),b(a)};this.on("error",c)})}async #ak(a,b){return new Promise(c=>{let d=()=>{(!b||b())&&(this.off(a,d),c())};this.on(a,d)})}get size(){return this.#F.size}sizeBy(a){return this.#F.filter(a).length}get pending(){return this.#S}get isPaused(){return this.#U}#X(){this.#H||(this.on("add",()=>{this.#F.size>0&&this.#ah()}),this.on("next",()=>{this.#ah()}))}#ah(){this.#H||this.#L||(this.#L=!0,queueMicrotask(()=>{this.#L=!1,this.#aj()}))}#aj(){let a=this.#K,b=!this.#H&&this.#I>=this.#J&&this.#F.size>0;b!==a&&(this.#K=b,this.emit(b?"rateLimit":"rateLimitCleared"))}get isRateLimited(){return this.#K}get isSaturated(){return this.#S===this.#T&&this.#F.size>0||this.isRateLimited&&this.#F.size>0}get runningTasks(){return[...this.#W.values()].map(a=>({...a}))}}async function gN(a,b){if(!0===b){let b=gG();void 0!==b?await b.run(void 0,async()=>a()):await a()}else void 0===g&&(g=new("default"in gM?gM.default:gM)({autoStart:!0,concurrency:1})),g.add(async()=>{let b=gG();void 0!==b?await b.run(void 0,async()=>a()):await a()})}async function gO(){let a=gy();await Promise.allSettled([void 0!==g?g.onIdle():Promise.resolve(),a.awaitPendingTraceBatches()])}function gP(a){let b=gG();if(void 0===b)return;let c=b.getStore();return c?.[gF]?.[a]}dy({},{awaitAllCallbacks:()=>gO,consumeCallback:()=>gN});let gQ=Symbol("lc:configure_hooks");function gR(a){return a?Array.isArray(a)||"name"in a?{callbacks:a}:a:{}}dy({},{BaseCallbackManager:()=>gS,BaseRunManager:()=>gT,CallbackManager:()=>gY,CallbackManagerForChainRun:()=>gW,CallbackManagerForLLMRun:()=>gV,CallbackManagerForRetrieverRun:()=>gU,CallbackManagerForToolRun:()=>gX,ensureHandler:()=>gZ,parseCallbackConfigArg:()=>gR});var gS=class{setHandler(a){return this.setHandlers([a])}},gT=class{constructor(a,b,c,d,e,f,g,h){this.runId=a,this.handlers=b,this.inheritableHandlers=c,this.tags=d,this.inheritableTags=e,this.metadata=f,this.inheritableMetadata=g,this._parentRunId=h}get parentRunId(){return this._parentRunId}async handleText(a){await Promise.all(this.handlers.map(b=>gN(async()=>{try{await b.handleText?.(a,this.runId,this._parentRunId,this.tags)}catch(a){if((b.raiseError?console.error:console.warn)(`Error in handler ${b.constructor.name}, handleText: ${a}`),b.raiseError)throw a}},b.awaitHandlers)))}async handleCustomEvent(a,b,c,d,e){await Promise.all(this.handlers.map(c=>gN(async()=>{try{await c.handleCustomEvent?.(a,b,this.runId,this.tags,this.metadata)}catch(a){if((c.raiseError?console.error:console.warn)(`Error in handler ${c.constructor.name}, handleCustomEvent: ${a}`),c.raiseError)throw a}},c.awaitHandlers)))}},gU=class extends gT{getChild(a){let b=new gY(this.runId);return b.setHandlers(this.inheritableHandlers),b.addTags(this.inheritableTags),b.addMetadata(this.inheritableMetadata),a&&b.addTags([a],!1),b}async handleRetrieverEnd(a){await Promise.all(this.handlers.map(b=>gN(async()=>{if(!b.ignoreRetriever)try{await b.handleRetrieverEnd?.(a,this.runId,this._parentRunId,this.tags)}catch(a){if((b.raiseError?console.error:console.warn)(`Error in handler ${b.constructor.name}, handleRetriever`),b.raiseError)throw a}},b.awaitHandlers)))}async handleRetrieverError(a){await Promise.all(this.handlers.map(b=>gN(async()=>{if(!b.ignoreRetriever)try{await b.handleRetrieverError?.(a,this.runId,this._parentRunId,this.tags)}catch(c){if((b.raiseError?console.error:console.warn)(`Error in handler ${b.constructor.name}, handleRetrieverError: ${c}`),b.raiseError)throw a}},b.awaitHandlers)))}},gV=class extends gT{async handleLLMNewToken(a,b,c,d,e,f){await Promise.all(this.handlers.map(c=>gN(async()=>{if(!c.ignoreLLM)try{await c.handleLLMNewToken?.(a,b??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,f)}catch(a){if((c.raiseError?console.error:console.warn)(`Error in handler ${c.constructor.name}, handleLLMNewToken: ${a}`),c.raiseError)throw a}},c.awaitHandlers)))}async handleLLMError(a,b,c,d,e){await Promise.all(this.handlers.map(b=>gN(async()=>{if(!b.ignoreLLM)try{await b.handleLLMError?.(a,this.runId,this._parentRunId,this.tags,e)}catch(a){if((b.raiseError?console.error:console.warn)(`Error in handler ${b.constructor.name}, handleLLMError: ${a}`),b.raiseError)throw a}},b.awaitHandlers)))}async handleLLMEnd(a,b,c,d,e){await Promise.all(this.handlers.map(b=>gN(async()=>{if(!b.ignoreLLM)try{await b.handleLLMEnd?.(a,this.runId,this._parentRunId,this.tags,e)}catch(a){if((b.raiseError?console.error:console.warn)(`Error in handler ${b.constructor.name}, handleLLMEnd: ${a}`),b.raiseError)throw a}},b.awaitHandlers)))}},gW=class extends gT{getChild(a){let b=new gY(this.runId);return b.setHandlers(this.inheritableHandlers),b.addTags(this.inheritableTags),b.addMetadata(this.inheritableMetadata),a&&b.addTags([a],!1),b}async handleChainError(a,b,c,d,e){await Promise.all(this.handlers.map(b=>gN(async()=>{if(!b.ignoreChain)try{await b.handleChainError?.(a,this.runId,this._parentRunId,this.tags,e)}catch(a){if((b.raiseError?console.error:console.warn)(`Error in handler ${b.constructor.name}, handleChainError: ${a}`),b.raiseError)throw a}},b.awaitHandlers)))}async handleChainEnd(a,b,c,d,e){await Promise.all(this.handlers.map(b=>gN(async()=>{if(!b.ignoreChain)try{await b.handleChainEnd?.(a,this.runId,this._parentRunId,this.tags,e)}catch(a){if((b.raiseError?console.error:console.warn)(`Error in handler ${b.constructor.name}, handleChainEnd: ${a}`),b.raiseError)throw a}},b.awaitHandlers)))}async handleAgentAction(a){await Promise.all(this.handlers.map(b=>gN(async()=>{if(!b.ignoreAgent)try{await b.handleAgentAction?.(a,this.runId,this._parentRunId,this.tags)}catch(a){if((b.raiseError?console.error:console.warn)(`Error in handler ${b.constructor.name}, handleAgentAction: ${a}`),b.raiseError)throw a}},b.awaitHandlers)))}async handleAgentEnd(a){await Promise.all(this.handlers.map(b=>gN(async()=>{if(!b.ignoreAgent)try{await b.handleAgentEnd?.(a,this.runId,this._parentRunId,this.tags)}catch(a){if((b.raiseError?console.error:console.warn)(`Error in handler ${b.constructor.name}, handleAgentEnd: ${a}`),b.raiseError)throw a}},b.awaitHandlers)))}},gX=class extends gT{getChild(a){let b=new gY(this.runId);return b.setHandlers(this.inheritableHandlers),b.addTags(this.inheritableTags),b.addMetadata(this.inheritableMetadata),a&&b.addTags([a],!1),b}async handleToolError(a){await Promise.all(this.handlers.map(b=>gN(async()=>{if(!b.ignoreAgent)try{await b.handleToolError?.(a,this.runId,this._parentRunId,this.tags)}catch(a){if((b.raiseError?console.error:console.warn)(`Error in handler ${b.constructor.name}, handleToolError: ${a}`),b.raiseError)throw a}},b.awaitHandlers)))}async handleToolEnd(a){await Promise.all(this.handlers.map(b=>gN(async()=>{if(!b.ignoreAgent)try{await b.handleToolEnd?.(a,this.runId,this._parentRunId,this.tags)}catch(a){if((b.raiseError?console.error:console.warn)(`Error in handler ${b.constructor.name}, handleToolEnd: ${a}`),b.raiseError)throw a}},b.awaitHandlers)))}},gY=class a extends gS{handlers=[];inheritableHandlers=[];tags=[];inheritableTags=[];metadata={};inheritableMetadata={};name="callback_manager";_parentRunId;constructor(a,b){super(),this.handlers=b?.handlers??this.handlers,this.inheritableHandlers=b?.inheritableHandlers??this.inheritableHandlers,this.tags=b?.tags??this.tags,this.inheritableTags=b?.inheritableTags??this.inheritableTags,this.metadata=b?.metadata??this.metadata,this.inheritableMetadata=b?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=a}getParentRunId(){return this._parentRunId}async handleLLMStart(a,b,c,d,e,f,g,h){return Promise.all(b.map(async(b,d)=>{let f=0===d&&c?c:fg();return await Promise.all(this.handlers.map(c=>{if(!c.ignoreLLM)return gl(c)&&c._createRunForLLMStart(a,[b],f,this._parentRunId,e,this.tags,this.metadata,h),gN(async()=>{try{await c.handleLLMStart?.(a,[b],f,this._parentRunId,e,this.tags,this.metadata,h)}catch(a){if((c.raiseError?console.error:console.warn)(`Error in handler ${c.constructor.name}, handleLLMStart: ${a}`),c.raiseError)throw a}},c.awaitHandlers)})),new gV(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(a,b,c,d,e,f,g,h){return Promise.all(b.map(async(b,d)=>{let f=0===d&&c?c:fg();return await Promise.all(this.handlers.map(c=>{if(!c.ignoreLLM)return gl(c)&&c._createRunForChatModelStart(a,[b],f,this._parentRunId,e,this.tags,this.metadata,h),gN(async()=>{try{if(c.handleChatModelStart)await c.handleChatModelStart?.(a,[b],f,this._parentRunId,e,this.tags,this.metadata,h);else if(c.handleLLMStart){let d=e2(b);await c.handleLLMStart?.(a,[d],f,this._parentRunId,e,this.tags,this.metadata,h)}}catch(a){if((c.raiseError?console.error:console.warn)(`Error in handler ${c.constructor.name}, handleLLMStart: ${a}`),c.raiseError)throw a}},c.awaitHandlers)})),new gV(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(a,b,c=fg(),d,e,f,g){return await Promise.all(this.handlers.map(e=>{if(!e.ignoreChain)return gl(e)&&e._createRunForChainStart(a,b,c,this._parentRunId,this.tags,this.metadata,d,g),gN(async()=>{try{await e.handleChainStart?.(a,b,c,this._parentRunId,this.tags,this.metadata,d,g)}catch(a){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleChainStart: ${a}`),e.raiseError)throw a}},e.awaitHandlers)})),new gW(c,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(a,b,c=fg(),d,e,f,g){return await Promise.all(this.handlers.map(d=>{if(!d.ignoreAgent)return gl(d)&&d._createRunForToolStart(a,b,c,this._parentRunId,this.tags,this.metadata,g),gN(async()=>{try{await d.handleToolStart?.(a,b,c,this._parentRunId,this.tags,this.metadata,g)}catch(a){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleToolStart: ${a}`),d.raiseError)throw a}},d.awaitHandlers)})),new gX(c,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(a,b,c=fg(),d,e,f,g){return await Promise.all(this.handlers.map(d=>{if(!d.ignoreRetriever)return gl(d)&&d._createRunForRetrieverStart(a,b,c,this._parentRunId,this.tags,this.metadata,g),gN(async()=>{try{await d.handleRetrieverStart?.(a,b,c,this._parentRunId,this.tags,this.metadata,g)}catch(a){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleRetrieverStart: ${a}`),d.raiseError)throw a}},d.awaitHandlers)})),new gU(c,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(a,b,c,d,e){await Promise.all(this.handlers.map(d=>gN(async()=>{if(!d.ignoreCustomEvent)try{await d.handleCustomEvent?.(a,b,c,this.tags,this.metadata)}catch(a){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleCustomEvent: ${a}`),d.raiseError)throw a}},d.awaitHandlers)))}addHandler(a,b=!0){this.handlers.push(a),b&&this.inheritableHandlers.push(a)}removeHandler(a){this.handlers=this.handlers.filter(b=>b!==a),this.inheritableHandlers=this.inheritableHandlers.filter(b=>b!==a)}setHandlers(a,b=!0){for(let c of(this.handlers=[],this.inheritableHandlers=[],a))this.addHandler(c,b)}addTags(a,b=!0){this.removeTags(a),this.tags.push(...a),b&&this.inheritableTags.push(...a)}removeTags(a){this.tags=this.tags.filter(b=>!a.includes(b)),this.inheritableTags=this.inheritableTags.filter(b=>!a.includes(b))}addMetadata(a,b=!0){this.metadata={...this.metadata,...a},b&&(this.inheritableMetadata={...this.inheritableMetadata,...a})}removeMetadata(a){for(let b of Object.keys(a))delete this.metadata[b],delete this.inheritableMetadata[b]}copy(b=[],c=!0){let d=new a(this._parentRunId);for(let a of this.handlers){let b=this.inheritableHandlers.includes(a);d.addHandler(a,b)}for(let a of this.tags){let b=this.inheritableTags.includes(a);d.addTags([a],b)}for(let a of Object.keys(this.metadata)){let b=Object.keys(this.inheritableMetadata).includes(a);d.addMetadata({[a]:this.metadata[a]},b)}for(let a of b)d.handlers.filter(a=>"console_callback_handler"===a.name).some(b=>b.name===a.name)||d.addHandler(a,c);return d}static fromHandlers(a){class b extends fj{name=fg();constructor(){super(),Object.assign(this,a)}}let c=new this;return c.addHandler(new b),c}static configure(a,b,c,d,e,f,g){return this._configureSync(a,b,c,d,e,f,g)}static _configureSync(b,c,d,e,f,g,h){var i;let j;(b||c)&&(Array.isArray(b)||!b?(j=new a).setHandlers(b?.map(gZ)??[],!0):j=b,j=j.copy(Array.isArray(c)?c.map(gZ):c?.handlers,!1));let k="true"===dG("LANGCHAIN_VERBOSE")||h?.verbose,l=gD.getTraceableRunTree()?.tracingEnabled||(void 0!==i?i:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(a=>"true"===dG(a))),m=l||(dG("LANGCHAIN_TRACING")??!1);if(k||m){if(j||(j=new a),k&&!j.handlers.some(a=>a.name===gx.prototype.name)){let a=new gx;j.addHandler(a,!0)}if(m&&!j.handlers.some(a=>"langchain_tracer"===a.name)&&l){let a=new gD;j.addHandler(a,!0)}if(l){let a=gD.getTraceableRunTree();if(a&&void 0===j._parentRunId){j._parentRunId=a.id;let b=j.handlers.find(a=>"langchain_tracer"===a.name);b?.updateFromRunTree(a)}}}for(let{contextVar:b,inheritable:c=!0,handlerClass:d,envVar:e}of gP(gQ)||[]){let f,g=e&&"true"===dG(e)&&d,h=void 0!==b?gP(b):void 0;h&&fk(h)?f=h:g&&(f=new d({})),void 0!==f&&(j||(j=new a),j.handlers.some(a=>a.name===f.name)||j.addHandler(f,c))}return(d||e)&&j&&(j.addTags(d??[]),j.addTags(e??[],!1)),(f||g)&&j&&(j.addMetadata(f??{}),j.addMetadata(g??{},!1)),j}};function gZ(a){return"name"in a?a:fj.fromMethods(a)}var g$=class{getStore(){}run(a,b){return b()}enterWith(a){}};let g_=new g$,g0=Symbol.for("lc:child_config"),g1=new class{getInstance(){return gG()??g_}getRunnableConfig(){let a=this.getInstance();return a.getStore()?.extra?.[g0]}runWithConfig(a,b,c){let d,e=gY._configureSync(a?.callbacks,void 0,a?.tags,void 0,a?.metadata),f=this.getInstance(),g=f.getStore(),h=e?.getParentRunId(),i=e?.handlers?.find(a=>a?.name==="langchain_tracer");return i&&h?d=i.getRunTreeWithTracingConfig(h):c||(d=new gh({name:"<runnable_lambda>",tracingEnabled:!1})),d&&(d.extra={...d.extra,[g0]:a}),void 0!==g&&void 0!==g[gF]&&(void 0===d&&(d={}),d[gF]=g[gF]),f.run(d,b)}initializeGlobalInstance(a){void 0===gG()&&(globalThis[gE]=a)}};async function g2(a){return gY._configureSync(a?.callbacks,void 0,a?.tags,void 0,a?.metadata)}function g3(...a){let b={};for(let c of a.filter(a=>!!a))for(let a of Object.keys(c))if("metadata"===a)b[a]={...b[a],...c[a]};else if("tags"===a){let d=b[a]??[];b[a]=[...new Set(d.concat(c[a]??[]))]}else if("configurable"===a)b[a]={...b[a],...c[a]};else if("timeout"===a)void 0===b.timeout?b.timeout=c.timeout:void 0!==c.timeout&&(b.timeout=Math.min(b.timeout,c.timeout));else if("signal"===a)void 0===b.signal?b.signal=c.signal:void 0!==c.signal&&("any"in AbortSignal?b.signal=AbortSignal.any([b.signal,c.signal]):b.signal=c.signal);else if("callbacks"===a){let a=b.callbacks,d=c.callbacks;if(Array.isArray(d))if(a)if(Array.isArray(a))b.callbacks=a.concat(d);else{let c=a.copy();for(let a of d)c.addHandler(gZ(a),!0);b.callbacks=c}else b.callbacks=d;else if(d)if(a)if(Array.isArray(a)){let c=d.copy();for(let b of a)c.addHandler(gZ(b),!0);b.callbacks=c}else b.callbacks=new gY(d._parentRunId,{handlers:a.handlers.concat(d.handlers),inheritableHandlers:a.inheritableHandlers.concat(d.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(d.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(d.inheritableTags))),metadata:{...a.metadata,...d.metadata}});else b.callbacks=d}else b[a]=c[a]??b[a];return b}dy({},{AsyncLocalStorageProviderSingleton:()=>g1,MockAsyncLocalStorage:()=>g$,_CONTEXT_VARIABLES_KEY:()=>gF});let g4=new Set(["string","number","boolean"]);function g5(a){let b=g1.getRunnableConfig(),c={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(b){let{runId:a,runName:d,...e}=b;c=Object.entries(e).reduce((a,[b,c])=>(void 0!==c&&(a[b]=c),a),c)}if(a&&(c=Object.entries(a).reduce((a,[b,c])=>(void 0!==c&&(a[b]=c),a),c)),c?.configurable)for(let a of Object.keys(c.configurable))g4.has(typeof c.configurable[a])&&!c.metadata?.[a]&&(c.metadata||(c.metadata={}),c.metadata[a]=c.configurable[a]);if(void 0!==c.timeout){if(c.timeout<=0)throw Error("Timeout must be a positive number");let a=AbortSignal.timeout(c.timeout);void 0!==c.signal?"any"in AbortSignal&&(c.signal=AbortSignal.any([c.signal,a])):c.signal=a,delete c.timeout}return c}function g6(a={},{callbacks:b,maxConcurrency:c,recursionLimit:d,runName:e,configurable:f,runId:g}={}){let h=g5(a);return void 0!==b&&(delete h.runName,h.callbacks=b),void 0!==d&&(h.recursionLimit=d),void 0!==c&&(h.maxConcurrency=c),void 0!==e&&(h.runName=e),void 0!==f&&(h.configurable={...h.configurable,...f}),void 0!==g&&delete h.runId,h}function g7(a){if(a)return{configurable:a.configurable,recursionLimit:a.recursionLimit,callbacks:a.callbacks,tags:a.tags,metadata:a.metadata,maxConcurrency:a.maxConcurrency,timeout:a.timeout,signal:a.signal,store:a.store}}async function g8(a,b){let c;return void 0===b?a:Promise.race([a.catch(a=>{if(!b?.aborted)throw a}),new Promise((a,d)=>{c=()=>{d(g9(b))},b.addEventListener("abort",c),b.aborted&&d(g9(b))})]).finally(()=>b.removeEventListener("abort",c))}function g9(a){return a?.reason instanceof Error?a.reason:"string"==typeof a?.reason?Error(a.reason):Error("Aborted")}dy({},{AsyncGeneratorWithSetup:()=>hd,IterableReadableStream:()=>ha,atee:()=>hb,concat:()=>hc,pipeGeneratorWithSetup:()=>he});var ha=class a extends ReadableStream{reader;ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let a=await this.reader.read();if(a.done)return this.reader.releaseLock(),{done:!0,value:void 0};return{done:!1,value:a.value}}catch(a){throw this.reader.releaseLock(),a}}async return(){if(this.ensureReader(),this.locked){let a=this.reader.cancel();this.reader.releaseLock(),await a}return{done:!0,value:void 0}}async throw(a){if(this.ensureReader(),this.locked){let a=this.reader.cancel();this.reader.releaseLock(),await a}throw a}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}static fromReadableStream(b){let c=b.getReader();return new a({start:a=>(function b(){return c.read().then(({done:c,value:d})=>c?void a.close():(a.enqueue(d),b()))})(),cancel(){c.releaseLock()}})}static fromAsyncGenerator(b){return new a({async pull(a){let{value:c,done:d}=await b.next();d&&a.close(),a.enqueue(c)},async cancel(a){await b.return(a)}})}};function hb(a,b=2){let c=Array.from({length:b},()=>[]);return c.map(async function*(b){for(;;)if(0===b.length){let b=await a.next();for(let a of c)a.push(b)}else{if(b[0].done)return;yield b.shift().value}})}function hc(a,b){if(Array.isArray(a)&&Array.isArray(b))return a.concat(b);if("string"==typeof a&&"string"==typeof b)return a+b;if("number"==typeof a&&"number"==typeof b)return a+b;if("concat"in a&&"function"==typeof a.concat)return a.concat(b);if("object"==typeof a&&"object"==typeof b){let c={...a};for(let[a,d]of Object.entries(b))a in c&&!Array.isArray(c[a])?c[a]=hc(c[a],d):c[a]=d;return c}else throw Error(`Cannot concat ${typeof a} and ${typeof b}`)}var hd=class{generator;setup;config;signal;firstResult;firstResultUsed=!1;constructor(a){this.generator=a.generator,this.config=a.config,this.signal=a.signal??this.config?.signal,this.setup=new Promise((b,c)=>{g1.runWithConfig(g7(a.config),async()=>{this.firstResult=a.generator.next(),a.startSetup?this.firstResult.then(a.startSetup).then(b,c):this.firstResult.then(a=>b(void 0),c)},!0)})}async next(...a){return(this.signal?.throwIfAborted(),this.firstResultUsed)?g1.runWithConfig(g7(this.config),this.signal?async()=>g8(this.generator.next(...a),this.signal):async()=>this.generator.next(...a),!0):(this.firstResultUsed=!0,this.firstResult)}async return(a){return this.generator.return(a)}async throw(a){return this.generator.throw(a)}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}};async function he(a,b,c,d,...e){let f=new hd({generator:b,startSetup:c,signal:d}),g=await f.setup;return{output:a(f,g,...e),setup:g}}dy({},{ChatGenerationChunk:()=>hh,GenerationChunk:()=>hg,RUN_KEY:()=>hf});let hf="__run";var hg=class a{text;generationInfo;constructor(a){this.text=a.text,this.generationInfo=a.generationInfo}concat(b){return new a({text:this.text+b.text,generationInfo:{...this.generationInfo,...b.generationInfo}})}},hh=class a extends hg{message;constructor(a){super(a),this.message=a.message}concat(b){return new a({text:this.text+b.text,generationInfo:{...this.generationInfo,...b.generationInfo},message:this.message.concat(b.message)})}};function hi(a,b,c){function d(c,d){var e;for(let f in Object.defineProperty(c,"_zod",{value:c._zod??{},enumerable:!1}),(e=c._zod).traits??(e.traits=new Set),c._zod.traits.add(a),b(c,d),g.prototype)f in c||Object.defineProperty(c,f,{value:g.prototype[f].bind(c)});c._zod.constr=g,c._zod.def=d}let e=c?.Parent??Object;class f extends e{}function g(a){var b;let e=c?.Parent?new f:this;for(let c of(d(e,a),(b=e._zod).deferred??(b.deferred=[]),e._zod.deferred))c();return e}return Object.defineProperty(f,"name",{value:a}),Object.defineProperty(g,"init",{value:d}),Object.defineProperty(g,Symbol.hasInstance,{value:b=>!!c?.Parent&&b instanceof c.Parent||b?._zod?.traits?.has(a)}),Object.defineProperty(g,"name",{value:a}),g}let hj=Symbol("zod_brand");class hk extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}let hl={};function hm(a){return a&&Object.assign(hl,a),hl}function hn(a){return a}function ho(a){return a}function hp(a){}function hq(a){throw Error()}function hr(a){}function hs(a){let b=Object.values(a).filter(a=>"number"==typeof a);return Object.entries(a).filter(([a,c])=>-1===b.indexOf(+a)).map(([a,b])=>b)}function ht(a,b="|"){return a.map(a=>hQ(a)).join(b)}function hu(a,b){return"bigint"==typeof b?b.toString():b}function hv(a){return{get value(){{let b=a();return Object.defineProperty(this,"value",{value:b}),b}}}}function hw(a){return null==a}function hx(a){let b=+!!a.startsWith("^"),c=a.endsWith("$")?a.length-1:a.length;return a.slice(b,c)}function hy(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}function hz(a,b,c){Object.defineProperty(a,b,{get(){{let d=c();return a[b]=d,d}},set(c){Object.defineProperty(a,b,{value:c})},configurable:!0})}function hA(a,b,c){Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}function hB(a,b){return b?b.reduce((a,b)=>a?.[b],a):a}function hC(a){let b=Object.keys(a);return Promise.all(b.map(b=>a[b])).then(a=>{let c={};for(let d=0;d<b.length;d++)c[b[d]]=a[d];return c})}function hD(a=10){let b="abcdefghijklmnopqrstuvwxyz",c="";for(let d=0;d<a;d++)c+=b[Math.floor(Math.random()*b.length)];return c}function hE(a){return JSON.stringify(a)}a.s(["$ZodAsyncError",()=>hk,"$brand",0,hj,"$constructor",()=>hi,"config",()=>hm,"globalConfig",0,hl],231994);let hF=Error.captureStackTrace?Error.captureStackTrace:(...a)=>{};function hG(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}let hH=hv(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(a){return!1}});function hI(a){if(!1===hG(a))return!1;let b=a.constructor;if(void 0===b)return!0;let c=b.prototype;return!1!==hG(c)&&!1!==Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")}function hJ(a){let b=0;for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}let hK=new Set(["string","number","symbol"]),hL=new Set(["string","number","bigint","boolean","symbol","undefined"]);function hM(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function hN(a,b,c){let d=new a._zod.constr(b??a._zod.def);return(!b||c?.parent)&&(d._zod.parent=a),d}function hO(a){if(!a)return{};if("string"==typeof a)return{error:()=>a};if(a?.message!==void 0){if(a?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");a.error=a.message}return(delete a.message,"string"==typeof a.error)?{...a,error:()=>a.error}:a}function hP(a){let b;return new Proxy({},{get:(c,d,e)=>(b??(b=a()),Reflect.get(b,d,e)),set:(c,d,e,f)=>(b??(b=a()),Reflect.set(b,d,e,f)),has:(c,d)=>(b??(b=a()),Reflect.has(b,d)),deleteProperty:(c,d)=>(b??(b=a()),Reflect.deleteProperty(b,d)),ownKeys:c=>(b??(b=a()),Reflect.ownKeys(b)),getOwnPropertyDescriptor:(c,d)=>(b??(b=a()),Reflect.getOwnPropertyDescriptor(b,d)),defineProperty:(c,d,e)=>(b??(b=a()),Reflect.defineProperty(b,d,e))})}function hQ(a){return"bigint"==typeof a?a.toString()+"n":"string"==typeof a?`"${a}"`:`${a}`}function hR(a){return Object.keys(a).filter(b=>"optional"===a[b]._zod.optin&&"optional"===a[b]._zod.optout)}let hS={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},hT={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function hU(a,b){let c={},d=a._zod.def;for(let a in b){if(!(a in d.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&(c[a]=d.shape[a])}return hN(a,{...a._zod.def,shape:c,checks:[]})}function hV(a,b){let c={...a._zod.def.shape},d=a._zod.def;for(let a in b){if(!(a in d.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&delete c[a]}return hN(a,{...a._zod.def,shape:c,checks:[]})}function hW(a,b){let c={...a._zod.def,get shape(){let c={...a._zod.def.shape,...b};return hA(this,"shape",c),c},checks:[]};return hN(a,c)}function hX(a,b){return hN(a,{...a._zod.def,get shape(){let c={...a._zod.def.shape,...b._zod.def.shape};return hA(this,"shape",c),c},catchall:b._zod.def.catchall,checks:[]})}function hY(a,b,c){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in d))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=a?new a({type:"optional",innerType:d[b]}):d[b])}else for(let b in d)e[b]=a?new a({type:"optional",innerType:d[b]}):d[b];return hN(b,{...b._zod.def,shape:e,checks:[]})}function hZ(a,b,c){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in e))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=new a({type:"nonoptional",innerType:d[b]}))}else for(let b in d)e[b]=new a({type:"nonoptional",innerType:d[b]});return hN(b,{...b._zod.def,shape:e,checks:[]})}function h$(a,b=0){for(let c=b;c<a.issues.length;c++)if(!0!==a.issues[c].continue)return!0;return!1}function h_(a,b){return b.map(b=>(b.path??(b.path=[]),b.path.unshift(a),b))}function h0(a){return"string"==typeof a?a:a?.message}function h1(a,b,c){let d={...a,path:a.path??[]};return a.message||(d.message=h0(a.inst?._zod.def?.error?.(a))??h0(b?.error?.(a))??h0(c.customError?.(a))??h0(c.localeError?.(a))??"Invalid input"),delete d.inst,delete d.continue,b?.reportInput||delete d.input,d}function h2(a){return a instanceof Set?"set":a instanceof Map?"map":a instanceof File?"file":"unknown"}function h3(a){return Array.isArray(a)?"array":"string"==typeof a?"string":"unknown"}function h4(...a){let[b,c,d]=a;return"string"==typeof b?{message:b,code:"custom",input:c,inst:d}:{...b}}function h5(a){return Object.entries(a).filter(([a,b])=>Number.isNaN(Number.parseInt(a,10))).map(a=>a[1])}class h6{constructor(...a){}}a.s(["BIGINT_FORMAT_RANGES",0,hT,"Class",()=>h6,"NUMBER_FORMAT_RANGES",0,hS,"aborted",()=>h$,"allowsEval",0,hH,"assert",()=>hr,"assertEqual",()=>hn,"assertIs",()=>hp,"assertNever",()=>hq,"assertNotEqual",()=>ho,"assignProp",()=>hA,"cached",()=>hv,"captureStackTrace",0,hF,"cleanEnum",()=>h5,"cleanRegex",()=>hx,"clone",()=>hN,"createTransparentProxy",()=>hP,"defineLazy",()=>hz,"esc",()=>hE,"escapeRegex",()=>hM,"extend",()=>hW,"finalizeIssue",()=>h1,"floatSafeRemainder",()=>hy,"getElementAtPath",()=>hB,"getEnumValues",()=>hs,"getLengthableOrigin",()=>h3,"getParsedType",0,a=>{let b=typeof a;switch(b){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(a)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return"promise";if("undefined"!=typeof Map&&a instanceof Map)return"map";if("undefined"!=typeof Set&&a instanceof Set)return"set";if("undefined"!=typeof Date&&a instanceof Date)return"date";if("undefined"!=typeof File&&a instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${b}`)}},"getSizableOrigin",()=>h2,"isObject",()=>hG,"isPlainObject",()=>hI,"issue",()=>h4,"joinValues",()=>ht,"jsonStringifyReplacer",()=>hu,"merge",()=>hX,"normalizeParams",()=>hO,"nullish",()=>hw,"numKeys",()=>hJ,"omit",()=>hV,"optionalKeys",()=>hR,"partial",()=>hY,"pick",()=>hU,"prefixIssues",()=>h_,"primitiveTypes",0,hL,"promiseAllObject",()=>hC,"propertyKeyTypes",0,hK,"randomString",()=>hD,"required",()=>hZ,"stringifyPrimitive",()=>hQ,"unwrapMessage",()=>h0],32333);let h7=(a,b)=>{a.name="$ZodError",Object.defineProperty(a,"_zod",{value:a._zod,enumerable:!1}),Object.defineProperty(a,"issues",{value:b,enumerable:!1}),Object.defineProperty(a,"message",{get:()=>JSON.stringify(b,hu,2),enumerable:!0})},h8=hi("$ZodError",h7),h9=hi("$ZodError",h7,{Parent:Error});function ia(a,b=a=>a.message){let c={},d=[];for(let e of a.issues)e.path.length>0?(c[e.path[0]]=c[e.path[0]]||[],c[e.path[0]].push(b(e))):d.push(b(e));return{formErrors:d,fieldErrors:c}}function ib(a,b){let c=b||function(a){return a.message},d={_errors:[]},e=a=>{for(let b of a.issues)if("invalid_union"===b.code&&b.errors.length)b.errors.map(a=>e({issues:a}));else if("invalid_key"===b.code)e({issues:b.issues});else if("invalid_element"===b.code)e({issues:b.issues});else if(0===b.path.length)d._errors.push(c(b));else{let a=d,e=0;for(;e<b.path.length;){let d=b.path[e];e===b.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(c(b))):a[d]=a[d]||{_errors:[]},a=a[d],e++}}};return e(a),d}function ic(a,b){let c=b||function(a){return a.message},d={errors:[]},e=(a,b=[])=>{var f,g;for(let h of a.issues)if("invalid_union"===h.code&&h.errors.length)h.errors.map(a=>e({issues:a},h.path));else if("invalid_key"===h.code)e({issues:h.issues},h.path);else if("invalid_element"===h.code)e({issues:h.issues},h.path);else{let a=[...b,...h.path];if(0===a.length){d.errors.push(c(h));continue}let e=d,i=0;for(;i<a.length;){let b=a[i],d=i===a.length-1;"string"==typeof b?(e.properties??(e.properties={}),(f=e.properties)[b]??(f[b]={errors:[]}),e=e.properties[b]):(e.items??(e.items=[]),(g=e.items)[b]??(g[b]={errors:[]}),e=e.items[b]),d&&e.errors.push(c(h)),i++}}};return e(a),d}function id(a){let b=[];for(let c of a)"number"==typeof c?b.push(`[${c}]`):"symbol"==typeof c?b.push(`[${JSON.stringify(String(c))}]`):/[^\w$]/.test(c)?b.push(`[${JSON.stringify(c)}]`):(b.length&&b.push("."),b.push(c));return b.join("")}function ie(a){let b=[];for(let c of[...a.issues].sort((a,b)=>a.path.length-b.path.length))b.push(` ${c.message}`),c.path?.length&&b.push(`   at ${id(c.path)}`);return b.join("\n")}a.s(["$ZodError",0,h8,"$ZodRealError",0,h9,"flattenError",()=>ia,"formatError",()=>ib,"prettifyError",()=>ie,"toDotPath",()=>id,"treeifyError",()=>ic],585726);let ig=a=>(b,c,d,e)=>{let f=d?Object.assign(d,{async:!1}):{async:!1},g=b._zod.run({value:c,issues:[]},f);if(g instanceof Promise)throw new hk;if(g.issues.length){let b=new(e?.Err??a)(g.issues.map(a=>h1(a,f,hm())));throw hF(b,e?.callee),b}return g.value},ih=ig(h9),ii=a=>async(b,c,d,e)=>{let f=d?Object.assign(d,{async:!0}):{async:!0},g=b._zod.run({value:c,issues:[]},f);if(g instanceof Promise&&(g=await g),g.issues.length){let b=new(e?.Err??a)(g.issues.map(a=>h1(a,f,hm())));throw hF(b,e?.callee),b}return g.value},ij=ii(h9),ik=a=>(b,c,d)=>{let e=d?{...d,async:!1}:{async:!1},f=b._zod.run({value:c,issues:[]},e);if(f instanceof Promise)throw new hk;return f.issues.length?{success:!1,error:new(a??h8)(f.issues.map(a=>h1(a,e,hm())))}:{success:!0,data:f.value}},il=ik(h9),im=a=>async(b,c,d)=>{let e=d?Object.assign(d,{async:!0}):{async:!0},f=b._zod.run({value:c,issues:[]},e);return f instanceof Promise&&(f=await f),f.issues.length?{success:!1,error:new a(f.issues.map(a=>h1(a,e,hm())))}:{success:!0,data:f.value}},io=im(h9);a.s(["_parse",0,ig,"_parseAsync",0,ii,"_safeParse",0,ik,"_safeParseAsync",0,im,"parse",0,ih,"parseAsync",0,ij,"safeParse",0,il,"safeParseAsync",0,io],295449);let ip=/^[cC][^\s-]{8,}$/,iq=/^[0-9a-z]+$/,ir=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,is=/^[0-9a-vA-V]{20}$/,it=/^[A-Za-z0-9]{27}$/,iu=/^[a-zA-Z0-9_-]{21}$/,iv=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,iw=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ix=a=>a?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${a}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,iy=ix(4),iz=ix(6),iA=ix(7),iB=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,iC="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function iD(){return RegExp(iC,"u")}let iE=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iF=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,iG=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,iH=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,iI=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,iJ=/^[A-Za-z0-9_-]*$/,iK=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,iL=/^\+(?:[0-9]){6,14}[0-9]$/,iM="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",iN=RegExp(`^${iM}$`);function iO(a){let b="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof a.precision?-1===a.precision?`${b}`:0===a.precision?`${b}:[0-5]\\d`:`${b}:[0-5]\\d\\.\\d{${a.precision}}`:`${b}(?::[0-5]\\d(?:\\.\\d+)?)?`}function iP(a){return RegExp(`^${iO(a)}$`)}function iQ(a){let b=iO({precision:a.precision}),c=["Z"];a.local&&c.push(""),a.offset&&c.push("([+-]\\d{2}:\\d{2})");let d=`${b}(?:${c.join("|")})`;return RegExp(`^${iM}T(?:${d})$`)}let iR=a=>{let b=a?`[\\s\\S]{${a?.minimum??0},${a?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${b}$`)},iS=/^\d+n?$/,iT=/^\d+$/,iU=/^-?\d+(?:\.\d+)?/i,iV=/true|false/i,iW=/null/i,iX=/undefined/i,iY=/^[^A-Z]*$/,iZ=/^[^a-z]*$/;a.s(["_emoji",0,iC,"base64",0,iI,"base64url",0,iJ,"bigint",0,iS,"boolean",0,iV,"browserEmail",0,/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,"cidrv4",0,iG,"cidrv6",0,iH,"cuid",0,ip,"cuid2",0,iq,"date",0,iN,"datetime",()=>iQ,"domain",0,/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,"duration",0,iv,"e164",0,iL,"email",0,iB,"emoji",()=>iD,"extendedDuration",0,/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,"guid",0,iw,"hostname",0,iK,"html5Email",0,/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,"integer",0,iT,"ipv4",0,iE,"ipv6",0,iF,"ksuid",0,it,"lowercase",0,iY,"nanoid",0,iu,"null",()=>iW,"number",0,iU,"rfc5322Email",0,/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,"string",0,iR,"time",()=>iP,"ulid",0,ir,"undefined",()=>iX,"unicodeEmail",0,/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,"uppercase",0,iZ,"uuid",0,ix,"uuid4",0,iy,"uuid6",0,iz,"uuid7",0,iA,"xid",0,is],780743);let i$=hi("$ZodCheck",(a,b)=>{var c;a._zod??(a._zod={}),a._zod.def=b,(c=a._zod).onattach??(c.onattach=[])}),i_={number:"number",bigint:"bigint",object:"date"},i0=hi("$ZodCheckLessThan",(a,b)=>{i$.init(a,b);let c=i_[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.maximum:c.exclusiveMaximum)??1/0;b.value<d&&(b.inclusive?c.maximum=b.value:c.exclusiveMaximum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value<=b.value:d.value<b.value)||d.issues.push({origin:c,code:"too_big",maximum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),i1=hi("$ZodCheckGreaterThan",(a,b)=>{i$.init(a,b);let c=i_[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.minimum:c.exclusiveMinimum)??-1/0;b.value>d&&(b.inclusive?c.minimum=b.value:c.exclusiveMinimum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value>=b.value:d.value>b.value)||d.issues.push({origin:c,code:"too_small",minimum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),i2=hi("$ZodCheckMultipleOf",(a,b)=>{i$.init(a,b),a._zod.onattach.push(a=>{var c;(c=a._zod.bag).multipleOf??(c.multipleOf=b.value)}),a._zod.check=c=>{if(typeof c.value!=typeof b.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof c.value?c.value%b.value===BigInt(0):0===hy(c.value,b.value))||c.issues.push({origin:typeof c.value,code:"not_multiple_of",divisor:b.value,input:c.value,inst:a,continue:!b.abort})}}),i3=hi("$ZodCheckNumberFormat",(a,b)=>{i$.init(a,b),b.format=b.format||"float64";let c=b.format?.includes("int"),d=c?"int":"number",[e,f]=hS[b.format];a._zod.onattach.push(a=>{let d=a._zod.bag;d.format=b.format,d.minimum=e,d.maximum=f,c&&(d.pattern=iT)}),a._zod.check=g=>{let h=g.value;if(c){if(!Number.isInteger(h))return void g.issues.push({expected:d,format:b.format,code:"invalid_type",input:h,inst:a});if(!Number.isSafeInteger(h))return void(h>0?g.issues.push({input:h,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}):g.issues.push({input:h,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}))}h<e&&g.issues.push({origin:"number",input:h,code:"too_small",minimum:e,inclusive:!0,inst:a,continue:!b.abort}),h>f&&g.issues.push({origin:"number",input:h,code:"too_big",maximum:f,inst:a})}}),i4=hi("$ZodCheckBigIntFormat",(a,b)=>{i$.init(a,b);let[c,d]=hT[b.format];a._zod.onattach.push(a=>{let e=a._zod.bag;e.format=b.format,e.minimum=c,e.maximum=d}),a._zod.check=e=>{let f=e.value;f<c&&e.issues.push({origin:"bigint",input:f,code:"too_small",minimum:c,inclusive:!0,inst:a,continue:!b.abort}),f>d&&e.issues.push({origin:"bigint",input:f,code:"too_big",maximum:d,inst:a})}}),i5=hi("$ZodCheckMaxSize",(a,b)=>{i$.init(a,b),a._zod.when=a=>{let b=a.value;return!hw(b)&&void 0!==b.size},a._zod.onattach.push(a=>{let c=a._zod.bag.maximum??1/0;b.maximum<c&&(a._zod.bag.maximum=b.maximum)}),a._zod.check=c=>{let d=c.value;d.size<=b.maximum||c.issues.push({origin:h2(d),code:"too_big",maximum:b.maximum,input:d,inst:a,continue:!b.abort})}}),i6=hi("$ZodCheckMinSize",(a,b)=>{i$.init(a,b),a._zod.when=a=>{let b=a.value;return!hw(b)&&void 0!==b.size},a._zod.onattach.push(a=>{let c=a._zod.bag.minimum??-1/0;b.minimum>c&&(a._zod.bag.minimum=b.minimum)}),a._zod.check=c=>{let d=c.value;d.size>=b.minimum||c.issues.push({origin:h2(d),code:"too_small",minimum:b.minimum,input:d,inst:a,continue:!b.abort})}}),i7=hi("$ZodCheckSizeEquals",(a,b)=>{i$.init(a,b),a._zod.when=a=>{let b=a.value;return!hw(b)&&void 0!==b.size},a._zod.onattach.push(a=>{let c=a._zod.bag;c.minimum=b.size,c.maximum=b.size,c.size=b.size}),a._zod.check=c=>{let d=c.value,e=d.size;if(e===b.size)return;let f=e>b.size;c.issues.push({origin:h2(d),...f?{code:"too_big",maximum:b.size}:{code:"too_small",minimum:b.size},input:c.value,inst:a,continue:!b.abort})}}),i8=hi("$ZodCheckMaxLength",(a,b)=>{i$.init(a,b),a._zod.when=a=>{let b=a.value;return!hw(b)&&void 0!==b.length},a._zod.onattach.push(a=>{let c=a._zod.bag.maximum??1/0;b.maximum<c&&(a._zod.bag.maximum=b.maximum)}),a._zod.check=c=>{let d=c.value;if(d.length<=b.maximum)return;let e=h3(d);c.issues.push({origin:e,code:"too_big",maximum:b.maximum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),i9=hi("$ZodCheckMinLength",(a,b)=>{i$.init(a,b),a._zod.when=a=>{let b=a.value;return!hw(b)&&void 0!==b.length},a._zod.onattach.push(a=>{let c=a._zod.bag.minimum??-1/0;b.minimum>c&&(a._zod.bag.minimum=b.minimum)}),a._zod.check=c=>{let d=c.value;if(d.length>=b.minimum)return;let e=h3(d);c.issues.push({origin:e,code:"too_small",minimum:b.minimum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),ja=hi("$ZodCheckLengthEquals",(a,b)=>{i$.init(a,b),a._zod.when=a=>{let b=a.value;return!hw(b)&&void 0!==b.length},a._zod.onattach.push(a=>{let c=a._zod.bag;c.minimum=b.length,c.maximum=b.length,c.length=b.length}),a._zod.check=c=>{let d=c.value,e=d.length;if(e===b.length)return;let f=h3(d),g=e>b.length;c.issues.push({origin:f,...g?{code:"too_big",maximum:b.length}:{code:"too_small",minimum:b.length},input:c.value,inst:a,continue:!b.abort})}}),jb=hi("$ZodCheckStringFormat",(a,b)=>{var c;i$.init(a,b),a._zod.onattach.push(a=>{let c=a._zod.bag;c.format=b.format,b.pattern&&(c.patterns??(c.patterns=new Set),c.patterns.add(b.pattern))}),(c=a._zod).check??(c.check=c=>{if(!b.pattern)throw Error("Not implemented.");b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:b.format,input:c.value,...b.pattern?{pattern:b.pattern.toString()}:{},inst:a,continue:!b.abort})})}),jc=hi("$ZodCheckRegex",(a,b)=>{jb.init(a,b),a._zod.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:"regex",input:c.value,pattern:b.pattern.toString(),inst:a,continue:!b.abort})}}),jd=hi("$ZodCheckLowerCase",(a,b)=>{b.pattern??(b.pattern=iY),jb.init(a,b)}),je=hi("$ZodCheckUpperCase",(a,b)=>{b.pattern??(b.pattern=iZ),jb.init(a,b)}),jf=hi("$ZodCheckIncludes",(a,b)=>{i$.init(a,b);let c=hM(b.includes),d=new RegExp("number"==typeof b.position?`^.{${b.position}}${c}`:c);b.pattern=d,a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(d)}),a._zod.check=c=>{c.value.includes(b.includes,b.position)||c.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:b.includes,input:c.value,inst:a,continue:!b.abort})}}),jg=hi("$ZodCheckStartsWith",(a,b)=>{i$.init(a,b);let c=RegExp(`^${hM(b.prefix)}.*`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.startsWith(b.prefix)||c.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:b.prefix,input:c.value,inst:a,continue:!b.abort})}}),jh=hi("$ZodCheckEndsWith",(a,b)=>{i$.init(a,b);let c=RegExp(`.*${hM(b.suffix)}$`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.endsWith(b.suffix)||c.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:b.suffix,input:c.value,inst:a,continue:!b.abort})}});function ji(a,b,c){a.issues.length&&b.issues.push(...h_(c,a.issues))}let jj=hi("$ZodCheckProperty",(a,b)=>{i$.init(a,b),a._zod.check=a=>{let c=b.schema._zod.run({value:a.value[b.property],issues:[]},{});if(c instanceof Promise)return c.then(c=>ji(c,a,b.property));ji(c,a,b.property)}}),jk=hi("$ZodCheckMimeType",(a,b)=>{i$.init(a,b);let c=new Set(b.mime);a._zod.onattach.push(a=>{a._zod.bag.mime=b.mime}),a._zod.check=d=>{c.has(d.value.type)||d.issues.push({code:"invalid_value",values:b.mime,input:d.value.type,inst:a})}}),jl=hi("$ZodCheckOverwrite",(a,b)=>{i$.init(a,b),a._zod.check=a=>{a.value=b.tx(a.value)}});a.s(["$ZodCheck",0,i$,"$ZodCheckBigIntFormat",0,i4,"$ZodCheckEndsWith",0,jh,"$ZodCheckGreaterThan",0,i1,"$ZodCheckIncludes",0,jf,"$ZodCheckLengthEquals",0,ja,"$ZodCheckLessThan",0,i0,"$ZodCheckLowerCase",0,jd,"$ZodCheckMaxLength",0,i8,"$ZodCheckMaxSize",0,i5,"$ZodCheckMimeType",0,jk,"$ZodCheckMinLength",0,i9,"$ZodCheckMinSize",0,i6,"$ZodCheckMultipleOf",0,i2,"$ZodCheckNumberFormat",0,i3,"$ZodCheckOverwrite",0,jl,"$ZodCheckProperty",0,jj,"$ZodCheckRegex",0,jc,"$ZodCheckSizeEquals",0,i7,"$ZodCheckStartsWith",0,jg,"$ZodCheckStringFormat",0,jb,"$ZodCheckUpperCase",0,je],909920);class jm{constructor(a=[]){this.content=[],this.indent=0,this&&(this.args=a)}indented(a){this.indent+=1,a(this),this.indent-=1}write(a){if("function"==typeof a){a(this,{execution:"sync"}),a(this,{execution:"async"});return}let b=a.split("\n").filter(a=>a),c=Math.min(...b.map(a=>a.length-a.trimStart().length));for(let a of b.map(a=>a.slice(c)).map(a=>" ".repeat(2*this.indent)+a))this.content.push(a)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(a=>`  ${a}`)].join("\n"))}}a.s(["Doc",()=>jm],963164);let jn={major:4,minor:0,patch:0};a.s(["version",0,jn],530112);let jo=hi("$ZodType",(a,b)=>{var c;a??(a={}),hz(a._zod,"id",()=>b.type+"_"+hD(10)),a._zod.def=b,a._zod.bag=a._zod.bag||{},a._zod.version=jn;let d=[...a._zod.def.checks??[]];for(let b of(a._zod.traits.has("$ZodCheck")&&d.unshift(a),d))for(let c of b._zod.onattach)c(a);if(0===d.length)(c=a._zod).deferred??(c.deferred=[]),a._zod.deferred?.push(()=>{a._zod.run=a._zod.parse});else{let b=(a,b,c)=>{let d,e=h$(a);for(let f of b){if(f._zod.when){if(!f._zod.when(a))continue}else if(e)continue;let b=a.issues.length,g=f._zod.check(a);if(g instanceof Promise&&c?.async===!1)throw new hk;if(d||g instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await g,a.issues.length!==b&&(e||(e=h$(a,b)))});else{if(a.issues.length===b)continue;e||(e=h$(a,b))}}return d?d.then(()=>a):a};a._zod.run=(c,e)=>{let f=a._zod.parse(c,e);if(f instanceof Promise){if(!1===e.async)throw new hk;return f.then(a=>b(a,d,e))}return b(f,d,e)}}a["~standard"]={validate:b=>{try{let c=il(a,b);return c.success?{value:c.data}:{issues:c.error?.issues}}catch(c){return io(a,b).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),jp=hi("$ZodString",(a,b)=>{jo.init(a,b),a._zod.pattern=[...a?._zod.bag?.patterns??[]].pop()??iR(a._zod.bag),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=String(c.value)}catch(a){}return"string"==typeof c.value||c.issues.push({expected:"string",code:"invalid_type",input:c.value,inst:a}),c}}),jq=hi("$ZodStringFormat",(a,b)=>{jb.init(a,b),jp.init(a,b)}),jr=hi("$ZodGUID",(a,b)=>{b.pattern??(b.pattern=iw),jq.init(a,b)}),js=hi("$ZodUUID",(a,b)=>{if(b.version){let a={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[b.version];if(void 0===a)throw Error(`Invalid UUID version: "${b.version}"`);b.pattern??(b.pattern=ix(a))}else b.pattern??(b.pattern=ix());jq.init(a,b)}),jt=hi("$ZodEmail",(a,b)=>{b.pattern??(b.pattern=iB),jq.init(a,b)}),ju=hi("$ZodURL",(a,b)=>{jq.init(a,b),a._zod.check=c=>{try{let d=new URL(c.value);b.hostname&&(b.hostname.lastIndex=0,b.hostname.test(d.hostname)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:iK.source,input:c.value,inst:a,continue:!b.abort})),b.protocol&&(b.protocol.lastIndex=0,b.protocol.test(d.protocol.endsWith(":")?d.protocol.slice(0,-1):d.protocol)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:b.protocol.source,input:c.value,inst:a,continue:!b.abort}));return}catch(d){c.issues.push({code:"invalid_format",format:"url",input:c.value,inst:a,continue:!b.abort})}}}),jv=hi("$ZodEmoji",(a,b)=>{b.pattern??(b.pattern=iD()),jq.init(a,b)}),jw=hi("$ZodNanoID",(a,b)=>{b.pattern??(b.pattern=iu),jq.init(a,b)}),jx=hi("$ZodCUID",(a,b)=>{b.pattern??(b.pattern=ip),jq.init(a,b)}),jy=hi("$ZodCUID2",(a,b)=>{b.pattern??(b.pattern=iq),jq.init(a,b)}),jz=hi("$ZodULID",(a,b)=>{b.pattern??(b.pattern=ir),jq.init(a,b)}),jA=hi("$ZodXID",(a,b)=>{b.pattern??(b.pattern=is),jq.init(a,b)}),jB=hi("$ZodKSUID",(a,b)=>{b.pattern??(b.pattern=it),jq.init(a,b)}),jC=hi("$ZodISODateTime",(a,b)=>{b.pattern??(b.pattern=iQ(b)),jq.init(a,b),a._zod.check}),jD=hi("$ZodISODate",(a,b)=>{b.pattern??(b.pattern=iN),jq.init(a,b)}),jE=hi("$ZodISOTime",(a,b)=>{b.pattern??(b.pattern=iP(b)),jq.init(a,b),a._zod.check}),jF=hi("$ZodISODuration",(a,b)=>{b.pattern??(b.pattern=iv),jq.init(a,b)}),jG=hi("$ZodIPv4",(a,b)=>{b.pattern??(b.pattern=iE),jq.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv4"})}),jH=hi("$ZodIPv6",(a,b)=>{b.pattern??(b.pattern=iF),jq.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv6"}),a._zod.check=c=>{try{new URL(`http://[${c.value}]`)}catch{c.issues.push({code:"invalid_format",format:"ipv6",input:c.value,inst:a,continue:!b.abort})}}}),jI=hi("$ZodCIDRv4",(a,b)=>{b.pattern??(b.pattern=iG),jq.init(a,b)}),jJ=hi("$ZodCIDRv6",(a,b)=>{b.pattern??(b.pattern=iH),jq.init(a,b),a._zod.check=c=>{let[d,e]=c.value.split("/");try{if(!e)throw Error();let a=Number(e);if(`${a}`!==e||a<0||a>128)throw Error();new URL(`http://[${d}]`)}catch{c.issues.push({code:"invalid_format",format:"cidrv6",input:c.value,inst:a,continue:!b.abort})}}});function jK(a){if(""===a)return!0;if(a.length%4!=0)return!1;try{return atob(a),!0}catch{return!1}}let jL=hi("$ZodBase64",(a,b)=>{b.pattern??(b.pattern=iI),jq.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64"}),a._zod.check=c=>{jK(c.value)||c.issues.push({code:"invalid_format",format:"base64",input:c.value,inst:a,continue:!b.abort})}});function jM(a){if(!iJ.test(a))return!1;let b=a.replace(/[-_]/g,a=>"-"===a?"+":"/");return jK(b.padEnd(4*Math.ceil(b.length/4),"="))}let jN=hi("$ZodBase64URL",(a,b)=>{b.pattern??(b.pattern=iJ),jq.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64url"}),a._zod.check=c=>{jM(c.value)||c.issues.push({code:"invalid_format",format:"base64url",input:c.value,inst:a,continue:!b.abort})}}),jO=hi("$ZodE164",(a,b)=>{b.pattern??(b.pattern=iL),jq.init(a,b)});function jP(a,b=null){try{let c=a.split(".");if(3!==c.length)return!1;let[d]=c,e=JSON.parse(atob(d));if("typ"in e&&e?.typ!=="JWT"||!e.alg||b&&(!("alg"in e)||e.alg!==b))return!1;return!0}catch{return!1}}let jQ=hi("$ZodJWT",(a,b)=>{jq.init(a,b),a._zod.check=c=>{jP(c.value,b.alg)||c.issues.push({code:"invalid_format",format:"jwt",input:c.value,inst:a,continue:!b.abort})}}),jR=hi("$ZodNumber",(a,b)=>{jo.init(a,b),a._zod.pattern=a._zod.bag.pattern??iU,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=Number(c.value)}catch(a){}let e=c.value;if("number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e))return c;let f="number"==typeof e?Number.isNaN(e)?"NaN":Number.isFinite(e)?void 0:"Infinity":void 0;return c.issues.push({expected:"number",code:"invalid_type",input:e,inst:a,...f?{received:f}:{}}),c}}),jS=hi("$ZodNumber",(a,b)=>{i3.init(a,b),jR.init(a,b)}),jT=hi("$ZodBoolean",(a,b)=>{jo.init(a,b),a._zod.pattern=iV,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=!!c.value}catch(a){}let e=c.value;return"boolean"==typeof e||c.issues.push({expected:"boolean",code:"invalid_type",input:e,inst:a}),c}}),jU=hi("$ZodBigInt",(a,b)=>{jo.init(a,b),a._zod.pattern=iS,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=BigInt(c.value)}catch(a){}let{value:e}=c;return"bigint"==typeof e||c.issues.push({expected:"bigint",code:"invalid_type",input:e,inst:a}),c}}),jV=hi("$ZodBigInt",(a,b)=>{i4.init(a,b),jU.init(a,b)}),jW=hi("$ZodSymbol",(a,b)=>{jo.init(a,b),a._zod.parse=(b,c)=>{let{value:d}=b;return"symbol"==typeof d||b.issues.push({expected:"symbol",code:"invalid_type",input:d,inst:a}),b}}),jX=hi("$ZodUndefined",(a,b)=>{jo.init(a,b),a._zod.pattern=iX,a._zod.values=new Set([void 0]),a._zod.parse=(b,c)=>{let{value:d}=b;return void 0===d||b.issues.push({expected:"undefined",code:"invalid_type",input:d,inst:a}),b}}),jY=hi("$ZodNull",(a,b)=>{jo.init(a,b),a._zod.pattern=iW,a._zod.values=new Set([null]),a._zod.parse=(b,c)=>{let{value:d}=b;return null===d||b.issues.push({expected:"null",code:"invalid_type",input:d,inst:a}),b}}),jZ=hi("$ZodAny",(a,b)=>{jo.init(a,b),a._zod.parse=a=>a}),j$=hi("$ZodUnknown",(a,b)=>{jo.init(a,b),a._zod.parse=a=>a}),j_=hi("$ZodNever",(a,b)=>{jo.init(a,b),a._zod.parse=(b,c)=>(b.issues.push({expected:"never",code:"invalid_type",input:b.value,inst:a}),b)}),j0=hi("$ZodVoid",(a,b)=>{jo.init(a,b),a._zod.parse=(b,c)=>{let{value:d}=b;return void 0===d||b.issues.push({expected:"void",code:"invalid_type",input:d,inst:a}),b}}),j1=hi("$ZodDate",(a,b)=>{jo.init(a,b),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=new Date(c.value)}catch(a){}let e=c.value,f=e instanceof Date;return f&&!Number.isNaN(e.getTime())||c.issues.push({expected:"date",code:"invalid_type",input:e,...f?{received:"Invalid Date"}:{},inst:a}),c}});function j2(a,b,c){a.issues.length&&b.issues.push(...h_(c,a.issues)),b.value[c]=a.value}let j3=hi("$ZodArray",(a,b)=>{jo.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!Array.isArray(e))return c.issues.push({expected:"array",code:"invalid_type",input:e,inst:a}),c;c.value=Array(e.length);let f=[];for(let a=0;a<e.length;a++){let g=e[a],h=b.element._zod.run({value:g,issues:[]},d);h instanceof Promise?f.push(h.then(b=>j2(b,c,a))):j2(h,c,a)}return f.length?Promise.all(f).then(()=>c):c}});function j4(a,b,c){a.issues.length&&b.issues.push(...h_(c,a.issues)),b.value[c]=a.value}function j5(a,b,c,d){a.issues.length?void 0===d[c]?c in d?b.value[c]=void 0:b.value[c]=a.value:b.issues.push(...h_(c,a.issues)):void 0===a.value?c in d&&(b.value[c]=void 0):b.value[c]=a.value}let j6=hi("$ZodObject",(a,b)=>{let c,d;jo.init(a,b);let e=hv(()=>{let a=Object.keys(b.shape);for(let c of a)if(!(b.shape[c]instanceof jo))throw Error(`Invalid element at key "${c}": expected a Zod schema`);let c=hR(b.shape);return{shape:b.shape,keys:a,keySet:new Set(a),numKeys:a.length,optionalKeys:new Set(c)}});hz(a._zod,"propValues",()=>{let a=b.shape,c={};for(let b in a){let d=a[b]._zod;if(d.values)for(let a of(c[b]??(c[b]=new Set),d.values))c[b].add(a)}return c});let f=!hl.jitless,g=f&&hH.value,{catchall:h}=b;a._zod.parse=(i,j)=>{d??(d=e.value);let k=i.value;if(!hG(k))return i.issues.push({expected:"object",code:"invalid_type",input:k,inst:a}),i;let l=[];if(f&&g&&j?.async===!1&&!0!==j.jitless)c||(c=(a=>{let b=new jm(["shape","payload","ctx"]),{keys:c,optionalKeys:d}=e.value,f=a=>{let b=hE(a);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};b.write("const input = payload.value;");let g=Object.create(null);for(let a of c)g[a]=hD(15);for(let a of(b.write("const newResult = {}"),c))if(d.has(a)){let c=g[a];b.write(`const ${c} = ${f(a)};`);let d=hE(a);b.write(`
        if (${c}.issues.length) {
          if (input[${d}] === undefined) {
            if (${d} in input) {
              newResult[${d}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${c}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${d}, ...iss.path] : [${d}],
              }))
            );
          }
        } else if (${c}.value === undefined) {
          if (${d} in input) newResult[${d}] = undefined;
        } else {
          newResult[${d}] = ${c}.value;
        }
        `)}else{let c=g[a];b.write(`const ${c} = ${f(a)};`),b.write(`
          if (${c}.issues.length) payload.issues = payload.issues.concat(${c}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${hE(a)}, ...iss.path] : [${hE(a)}]
          })));`),b.write(`newResult[${hE(a)}] = ${c}.value`)}b.write("payload.value = newResult;"),b.write("return payload;");let h=b.compile();return(b,c)=>h(a,b,c)})(b.shape)),i=c(i,j);else{i.value={};let a=d.shape;for(let b of d.keys){let c=a[b],d=c._zod.run({value:k[b],issues:[]},j),e="optional"===c._zod.optin&&"optional"===c._zod.optout;d instanceof Promise?l.push(d.then(a=>e?j5(a,i,b,k):j4(a,i,b))):e?j5(d,i,b,k):j4(d,i,b)}}if(!h)return l.length?Promise.all(l).then(()=>i):i;let m=[],n=d.keySet,o=h._zod,p=o.def.type;for(let a of Object.keys(k)){if(n.has(a))continue;if("never"===p){m.push(a);continue}let b=o.run({value:k[a],issues:[]},j);b instanceof Promise?l.push(b.then(b=>j4(b,i,a))):j4(b,i,a)}return(m.length&&i.issues.push({code:"unrecognized_keys",keys:m,input:k,inst:a}),l.length)?Promise.all(l).then(()=>i):i}});function j7(a,b,c,d){for(let c of a)if(0===c.issues.length)return b.value=c.value,b;return b.issues.push({code:"invalid_union",input:b.value,inst:c,errors:a.map(a=>a.issues.map(a=>h1(a,d,hm())))}),b}let j8=hi("$ZodUnion",(a,b)=>{jo.init(a,b),hz(a._zod,"values",()=>{if(b.options.every(a=>a._zod.values))return new Set(b.options.flatMap(a=>Array.from(a._zod.values)))}),hz(a._zod,"pattern",()=>{if(b.options.every(a=>a._zod.pattern)){let a=b.options.map(a=>a._zod.pattern);return RegExp(`^(${a.map(a=>hx(a.source)).join("|")})$`)}}),a._zod.parse=(c,d)=>{let e=!1,f=[];for(let a of b.options){let b=a._zod.run({value:c.value,issues:[]},d);if(b instanceof Promise)f.push(b),e=!0;else{if(0===b.issues.length)return b;f.push(b)}}return e?Promise.all(f).then(b=>j7(b,c,a,d)):j7(f,c,a,d)}}),j9=hi("$ZodDiscriminatedUnion",(a,b)=>{j8.init(a,b);let c=a._zod.parse;hz(a._zod,"propValues",()=>{let a={};for(let c of b.options){let d=c._zod.propValues;if(!d||0===Object.keys(d).length)throw Error(`Invalid discriminated union option at index "${b.options.indexOf(c)}"`);for(let[b,c]of Object.entries(d))for(let d of(a[b]||(a[b]=new Set),c))a[b].add(d)}return a});let d=hv(()=>{let a=b.options,c=new Map;for(let d of a){let a=d._zod.propValues[b.discriminator];if(!a||0===a.size)throw Error(`Invalid discriminated union option at index "${b.options.indexOf(d)}"`);for(let b of a){if(c.has(b))throw Error(`Duplicate discriminator value "${String(b)}"`);c.set(b,d)}}return c});a._zod.parse=(e,f)=>{let g=e.value;if(!hG(g))return e.issues.push({code:"invalid_type",expected:"object",input:g,inst:a}),e;let h=d.value.get(g?.[b.discriminator]);return h?h._zod.run(e,f):b.unionFallback?c(e,f):(e.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:g,path:[b.discriminator],inst:a}),e)}}),ka=hi("$ZodIntersection",(a,b)=>{jo.init(a,b),a._zod.parse=(a,c)=>{let{value:d}=a,e=b.left._zod.run({value:d,issues:[]},c),f=b.right._zod.run({value:d,issues:[]},c);return e instanceof Promise||f instanceof Promise?Promise.all([e,f]).then(([b,c])=>kb(a,b,c)):kb(a,e,f)}});function kb(a,b,c){if(b.issues.length&&a.issues.push(...b.issues),c.issues.length&&a.issues.push(...c.issues),h$(a))return a;let d=function a(b,c){if(b===c||b instanceof Date&&c instanceof Date&&+b==+c)return{valid:!0,data:b};if(hI(b)&&hI(c)){let d=Object.keys(c),e=Object.keys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1,mergeErrorPath:[d,...e.mergeErrorPath]};f[d]=e.data}return{valid:!0,data:f}}if(Array.isArray(b)&&Array.isArray(c)){if(b.length!==c.length)return{valid:!1,mergeErrorPath:[]};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1,mergeErrorPath:[e,...f.mergeErrorPath]};d.push(f.data)}return{valid:!0,data:d}}return{valid:!1,mergeErrorPath:[]}}(b.value,c.value);if(!d.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(d.mergeErrorPath)}`);return a.value=d.data,a}let kc=hi("$ZodTuple",(a,b)=>{jo.init(a,b);let c=b.items,d=c.length-[...c].reverse().findIndex(a=>"optional"!==a._zod.optin);a._zod.parse=(e,f)=>{let g=e.value;if(!Array.isArray(g))return e.issues.push({input:g,inst:a,expected:"tuple",code:"invalid_type"}),e;e.value=[];let h=[];if(!b.rest){let b=g.length>c.length,f=g.length<d-1;if(b||f)return e.issues.push({input:g,inst:a,origin:"array",...b?{code:"too_big",maximum:c.length}:{code:"too_small",minimum:c.length}}),e}let i=-1;for(let a of c){if(++i>=g.length&&i>=d)continue;let b=a._zod.run({value:g[i],issues:[]},f);b instanceof Promise?h.push(b.then(a=>kd(a,e,i))):kd(b,e,i)}if(b.rest)for(let a of g.slice(c.length)){i++;let c=b.rest._zod.run({value:a,issues:[]},f);c instanceof Promise?h.push(c.then(a=>kd(a,e,i))):kd(c,e,i)}return h.length?Promise.all(h).then(()=>e):e}});function kd(a,b,c){a.issues.length&&b.issues.push(...h_(c,a.issues)),b.value[c]=a.value}let ke=hi("$ZodRecord",(a,b)=>{jo.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!hI(e))return c.issues.push({expected:"record",code:"invalid_type",input:e,inst:a}),c;let f=[];if(b.keyType._zod.values){let g,h=b.keyType._zod.values;for(let a of(c.value={},h))if("string"==typeof a||"number"==typeof a||"symbol"==typeof a){let g=b.valueType._zod.run({value:e[a],issues:[]},d);g instanceof Promise?f.push(g.then(b=>{b.issues.length&&c.issues.push(...h_(a,b.issues)),c.value[a]=b.value})):(g.issues.length&&c.issues.push(...h_(a,g.issues)),c.value[a]=g.value)}for(let a in e)h.has(a)||(g=g??[]).push(a);g&&g.length>0&&c.issues.push({code:"unrecognized_keys",input:e,inst:a,keys:g})}else for(let g of(c.value={},Reflect.ownKeys(e))){if("__proto__"===g)continue;let h=b.keyType._zod.run({value:g,issues:[]},d);if(h instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(h.issues.length){c.issues.push({origin:"record",code:"invalid_key",issues:h.issues.map(a=>h1(a,d,hm())),input:g,path:[g],inst:a}),c.value[h.value]=h.value;continue}let i=b.valueType._zod.run({value:e[g],issues:[]},d);i instanceof Promise?f.push(i.then(a=>{a.issues.length&&c.issues.push(...h_(g,a.issues)),c.value[h.value]=a.value})):(i.issues.length&&c.issues.push(...h_(g,i.issues)),c.value[h.value]=i.value)}return f.length?Promise.all(f).then(()=>c):c}}),kf=hi("$ZodMap",(a,b)=>{jo.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!(e instanceof Map))return c.issues.push({expected:"map",code:"invalid_type",input:e,inst:a}),c;let f=[];for(let[g,h]of(c.value=new Map,e)){let i=b.keyType._zod.run({value:g,issues:[]},d),j=b.valueType._zod.run({value:h,issues:[]},d);i instanceof Promise||j instanceof Promise?f.push(Promise.all([i,j]).then(([b,f])=>{kg(b,f,c,g,e,a,d)})):kg(i,j,c,g,e,a,d)}return f.length?Promise.all(f).then(()=>c):c}});function kg(a,b,c,d,e,f,g){a.issues.length&&(hK.has(typeof d)?c.issues.push(...h_(d,a.issues)):c.issues.push({origin:"map",code:"invalid_key",input:e,inst:f,issues:a.issues.map(a=>h1(a,g,hm()))})),b.issues.length&&(hK.has(typeof d)?c.issues.push(...h_(d,b.issues)):c.issues.push({origin:"map",code:"invalid_element",input:e,inst:f,key:d,issues:b.issues.map(a=>h1(a,g,hm()))})),c.value.set(a.value,b.value)}let kh=hi("$ZodSet",(a,b)=>{jo.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!(e instanceof Set))return c.issues.push({input:e,inst:a,expected:"set",code:"invalid_type"}),c;let f=[];for(let a of(c.value=new Set,e)){let e=b.valueType._zod.run({value:a,issues:[]},d);e instanceof Promise?f.push(e.then(a=>ki(a,c))):ki(e,c)}return f.length?Promise.all(f).then(()=>c):c}});function ki(a,b){a.issues.length&&b.issues.push(...a.issues),b.value.add(a.value)}let kj=hi("$ZodEnum",(a,b)=>{jo.init(a,b);let c=hs(b.entries);a._zod.values=new Set(c),a._zod.pattern=RegExp(`^(${c.filter(a=>hK.has(typeof a)).map(a=>"string"==typeof a?hM(a):a.toString()).join("|")})$`),a._zod.parse=(b,d)=>{let e=b.value;return a._zod.values.has(e)||b.issues.push({code:"invalid_value",values:c,input:e,inst:a}),b}}),kk=hi("$ZodLiteral",(a,b)=>{jo.init(a,b),a._zod.values=new Set(b.values),a._zod.pattern=RegExp(`^(${b.values.map(a=>"string"==typeof a?hM(a):a?a.toString():String(a)).join("|")})$`),a._zod.parse=(c,d)=>{let e=c.value;return a._zod.values.has(e)||c.issues.push({code:"invalid_value",values:b.values,input:e,inst:a}),c}}),kl=hi("$ZodFile",(a,b)=>{jo.init(a,b),a._zod.parse=(b,c)=>{let d=b.value;return d instanceof File||b.issues.push({expected:"file",code:"invalid_type",input:d,inst:a}),b}}),km=hi("$ZodTransform",(a,b)=>{jo.init(a,b),a._zod.parse=(a,c)=>{let d=b.transform(a.value,a);if(c.async)return(d instanceof Promise?d:Promise.resolve(d)).then(b=>(a.value=b,a));if(d instanceof Promise)throw new hk;return a.value=d,a}}),kn=hi("$ZodOptional",(a,b)=>{jo.init(a,b),a._zod.optin="optional",a._zod.optout="optional",hz(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,void 0]):void 0),hz(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${hx(a.source)})?$`):void 0}),a._zod.parse=(a,c)=>void 0===a.value?a:b.innerType._zod.run(a,c)}),ko=hi("$ZodNullable",(a,b)=>{jo.init(a,b),hz(a._zod,"optin",()=>b.innerType._zod.optin),hz(a._zod,"optout",()=>b.innerType._zod.optout),hz(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${hx(a.source)}|null)$`):void 0}),hz(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,null]):void 0),a._zod.parse=(a,c)=>null===a.value?a:b.innerType._zod.run(a,c)}),kp=hi("$ZodDefault",(a,b)=>{jo.init(a,b),a._zod.optin="optional",hz(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if(void 0===a.value)return a.value=b.defaultValue,a;let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(a=>kq(a,b)):kq(d,b)}});function kq(a,b){return void 0===a.value&&(a.value=b.defaultValue),a}let kr=hi("$ZodPrefault",(a,b)=>{jo.init(a,b),a._zod.optin="optional",hz(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>(void 0===a.value&&(a.value=b.defaultValue),b.innerType._zod.run(a,c))}),ks=hi("$ZodNonOptional",(a,b)=>{jo.init(a,b),hz(a._zod,"values",()=>{let a=b.innerType._zod.values;return a?new Set([...a].filter(a=>void 0!==a)):void 0}),a._zod.parse=(c,d)=>{let e=b.innerType._zod.run(c,d);return e instanceof Promise?e.then(b=>kt(b,a)):kt(e,a)}});function kt(a,b){return a.issues.length||void 0!==a.value||a.issues.push({code:"invalid_type",expected:"nonoptional",input:a.value,inst:b}),a}let ku=hi("$ZodSuccess",(a,b)=>{jo.init(a,b),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(b=>(a.value=0===b.issues.length,a)):(a.value=0===d.issues.length,a)}}),kv=hi("$ZodCatch",(a,b)=>{jo.init(a,b),hz(a._zod,"optin",()=>b.innerType._zod.optin),hz(a._zod,"optout",()=>b.innerType._zod.optout),hz(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(d=>(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>h1(a,c,hm()))},input:a.value}),a.issues=[]),a)):(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>h1(a,c,hm()))},input:a.value}),a.issues=[]),a)}}),kw=hi("$ZodNaN",(a,b)=>{jo.init(a,b),a._zod.parse=(b,c)=>("number"==typeof b.value&&Number.isNaN(b.value)||b.issues.push({input:b.value,inst:a,expected:"nan",code:"invalid_type"}),b)}),kx=hi("$ZodPipe",(a,b)=>{jo.init(a,b),hz(a._zod,"values",()=>b.in._zod.values),hz(a._zod,"optin",()=>b.in._zod.optin),hz(a._zod,"optout",()=>b.out._zod.optout),a._zod.parse=(a,c)=>{let d=b.in._zod.run(a,c);return d instanceof Promise?d.then(a=>ky(a,b,c)):ky(d,b,c)}});function ky(a,b,c){return h$(a)?a:b.out._zod.run({value:a.value,issues:a.issues},c)}let kz=hi("$ZodReadonly",(a,b)=>{jo.init(a,b),hz(a._zod,"propValues",()=>b.innerType._zod.propValues),hz(a._zod,"optin",()=>b.innerType._zod.optin),hz(a._zod,"optout",()=>b.innerType._zod.optout),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(kA):kA(d)}});function kA(a){return a.value=Object.freeze(a.value),a}let kB=hi("$ZodTemplateLiteral",(a,b)=>{jo.init(a,b);let c=[];for(let a of b.parts)if(a instanceof jo){if(!a._zod.pattern)throw Error(`Invalid template literal part, no pattern found: ${[...a._zod.traits].shift()}`);let b=a._zod.pattern instanceof RegExp?a._zod.pattern.source:a._zod.pattern;if(!b)throw Error(`Invalid template literal part: ${a._zod.traits}`);let d=+!!b.startsWith("^"),e=b.endsWith("$")?b.length-1:b.length;c.push(b.slice(d,e))}else if(null===a||hL.has(typeof a))c.push(hM(`${a}`));else throw Error(`Invalid template literal part: ${a}`);a._zod.pattern=RegExp(`^${c.join("")}$`),a._zod.parse=(b,c)=>("string"!=typeof b.value?b.issues.push({input:b.value,inst:a,expected:"template_literal",code:"invalid_type"}):(a._zod.pattern.lastIndex=0,a._zod.pattern.test(b.value)||b.issues.push({input:b.value,inst:a,code:"invalid_format",format:"template_literal",pattern:a._zod.pattern.source})),b)}),kC=hi("$ZodPromise",(a,b)=>{jo.init(a,b),a._zod.parse=(a,c)=>Promise.resolve(a.value).then(a=>b.innerType._zod.run({value:a,issues:[]},c))}),kD=hi("$ZodLazy",(a,b)=>{jo.init(a,b),hz(a._zod,"innerType",()=>b.getter()),hz(a._zod,"pattern",()=>a._zod.innerType._zod.pattern),hz(a._zod,"propValues",()=>a._zod.innerType._zod.propValues),hz(a._zod,"optin",()=>a._zod.innerType._zod.optin),hz(a._zod,"optout",()=>a._zod.innerType._zod.optout),a._zod.parse=(b,c)=>a._zod.innerType._zod.run(b,c)}),kE=hi("$ZodCustom",(a,b)=>{i$.init(a,b),jo.init(a,b),a._zod.parse=(a,b)=>a,a._zod.check=c=>{let d=c.value,e=b.fn(d);if(e instanceof Promise)return e.then(b=>kF(b,c,d,a));kF(e,c,d,a)}});function kF(a,b,c,d){if(!a){let a={code:"custom",input:c,inst:d,path:[...d._zod.def.path??[]],continue:!d._zod.def.abort};d._zod.def.params&&(a.params=d._zod.def.params),b.issues.push(h4(a))}}function kG(a,b,c,d){let e=Math.abs(a),f=e%10,g=e%100;return g>=11&&g<=19?d:1===f?b:f>=2&&f<=4?c:d}function kH(){let a,b;return{localeError:(a={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}},b={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},c=>{switch(c.code){case"invalid_type":return`Invalid input: expected ${c.expected}, received ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Invalid input: expected ${hQ(c.values[0])}`;return`Invalid option: expected one of ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Too big: expected ${c.origin??"value"} to have ${b}${c.maximum.toString()} ${d.unit??"elements"}`;return`Too big: expected ${c.origin??"value"} to be ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Too small: expected ${c.origin} to have ${b}${c.minimum.toString()} ${d.unit}`;return`Too small: expected ${c.origin} to be ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Invalid string: must start with "${c.prefix}"`;if("ends_with"===c.format)return`Invalid string: must end with "${c.suffix}"`;if("includes"===c.format)return`Invalid string: must include "${c.includes}"`;if("regex"===c.format)return`Invalid string: must match pattern ${c.pattern}`;return`Invalid ${b[c.format]??c.format}`;case"not_multiple_of":return`Invalid number: must be a multiple of ${c.divisor}`;case"unrecognized_keys":return`Unrecognized key${c.keys.length>1?"s":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`Invalid key in ${c.origin}`;case"invalid_union":default:return"Invalid input";case"invalid_element":return`Invalid value in ${c.origin}`}})}}function kI(a,b,c,d){let e=Math.abs(a),f=e%10,g=e%100;return g>=11&&g<=19?d:1===f?b:f>=2&&f<=4?c:d}a.s(["$ZodAny",0,jZ,"$ZodArray",0,j3,"$ZodBase64",0,jL,"$ZodBase64URL",0,jN,"$ZodBigInt",0,jU,"$ZodBigIntFormat",0,jV,"$ZodBoolean",0,jT,"$ZodCIDRv4",0,jI,"$ZodCIDRv6",0,jJ,"$ZodCUID",0,jx,"$ZodCUID2",0,jy,"$ZodCatch",0,kv,"$ZodCustom",0,kE,"$ZodDate",0,j1,"$ZodDefault",0,kp,"$ZodDiscriminatedUnion",0,j9,"$ZodE164",0,jO,"$ZodEmail",0,jt,"$ZodEmoji",0,jv,"$ZodEnum",0,kj,"$ZodFile",0,kl,"$ZodGUID",0,jr,"$ZodIPv4",0,jG,"$ZodIPv6",0,jH,"$ZodISODate",0,jD,"$ZodISODateTime",0,jC,"$ZodISODuration",0,jF,"$ZodISOTime",0,jE,"$ZodIntersection",0,ka,"$ZodJWT",0,jQ,"$ZodKSUID",0,jB,"$ZodLazy",0,kD,"$ZodLiteral",0,kk,"$ZodMap",0,kf,"$ZodNaN",0,kw,"$ZodNanoID",0,jw,"$ZodNever",0,j_,"$ZodNonOptional",0,ks,"$ZodNull",0,jY,"$ZodNullable",0,ko,"$ZodNumber",0,jR,"$ZodNumberFormat",0,jS,"$ZodObject",0,j6,"$ZodOptional",0,kn,"$ZodPipe",0,kx,"$ZodPrefault",0,kr,"$ZodPromise",0,kC,"$ZodReadonly",0,kz,"$ZodRecord",0,ke,"$ZodSet",0,kh,"$ZodString",0,jp,"$ZodStringFormat",0,jq,"$ZodSuccess",0,ku,"$ZodSymbol",0,jW,"$ZodTemplateLiteral",0,kB,"$ZodTransform",0,km,"$ZodTuple",0,kc,"$ZodType",0,jo,"$ZodULID",0,jz,"$ZodURL",0,ju,"$ZodUUID",0,js,"$ZodUndefined",0,jX,"$ZodUnion",0,j8,"$ZodUnknown",0,j$,"$ZodVoid",0,j0,"$ZodXID",0,jA,"isValidBase64",()=>jK,"isValidBase64URL",()=>jM,"isValidJWT",()=>jP],907680),a.s([],604663);let kJ=Symbol("ZodOutput"),kK=Symbol("ZodInput");class kL{constructor(){this._map=new WeakMap,this._idmap=new Map}add(a,...b){let c=b[0];if(this._map.set(a,c),c&&"object"==typeof c&&"id"in c){if(this._idmap.has(c.id))throw Error(`ID ${c.id} already exists in the registry`);this._idmap.set(c.id,a)}return this}remove(a){return this._map.delete(a),this}get(a){let b=a._zod.parent;if(b){let c={...this.get(b)??{}};return delete c.id,{...c,...this._map.get(a)}}return this._map.get(a)}has(a){return this._map.has(a)}}function kM(){return new kL}let kN=kM();function kO(a,b){return new a({type:"string",...hO(b)})}function kP(a,b){return new a({type:"string",coerce:!0,...hO(b)})}function kQ(a,b){return new a({type:"string",format:"email",check:"string_format",abort:!1,...hO(b)})}function kR(a,b){return new a({type:"string",format:"guid",check:"string_format",abort:!1,...hO(b)})}function kS(a,b){return new a({type:"string",format:"uuid",check:"string_format",abort:!1,...hO(b)})}function kT(a,b){return new a({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...hO(b)})}function kU(a,b){return new a({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...hO(b)})}function kV(a,b){return new a({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...hO(b)})}function kW(a,b){return new a({type:"string",format:"url",check:"string_format",abort:!1,...hO(b)})}function kX(a,b){return new a({type:"string",format:"emoji",check:"string_format",abort:!1,...hO(b)})}function kY(a,b){return new a({type:"string",format:"nanoid",check:"string_format",abort:!1,...hO(b)})}function kZ(a,b){return new a({type:"string",format:"cuid",check:"string_format",abort:!1,...hO(b)})}function k$(a,b){return new a({type:"string",format:"cuid2",check:"string_format",abort:!1,...hO(b)})}function k_(a,b){return new a({type:"string",format:"ulid",check:"string_format",abort:!1,...hO(b)})}function k0(a,b){return new a({type:"string",format:"xid",check:"string_format",abort:!1,...hO(b)})}function k1(a,b){return new a({type:"string",format:"ksuid",check:"string_format",abort:!1,...hO(b)})}function k2(a,b){return new a({type:"string",format:"ipv4",check:"string_format",abort:!1,...hO(b)})}function k3(a,b){return new a({type:"string",format:"ipv6",check:"string_format",abort:!1,...hO(b)})}function k4(a,b){return new a({type:"string",format:"cidrv4",check:"string_format",abort:!1,...hO(b)})}function k5(a,b){return new a({type:"string",format:"cidrv6",check:"string_format",abort:!1,...hO(b)})}function k6(a,b){return new a({type:"string",format:"base64",check:"string_format",abort:!1,...hO(b)})}function k7(a,b){return new a({type:"string",format:"base64url",check:"string_format",abort:!1,...hO(b)})}function k8(a,b){return new a({type:"string",format:"e164",check:"string_format",abort:!1,...hO(b)})}function k9(a,b){return new a({type:"string",format:"jwt",check:"string_format",abort:!1,...hO(b)})}a.s(["$ZodRegistry",()=>kL,"$input",0,kK,"$output",0,kJ,"globalRegistry",0,kN,"registry",()=>kM],656075);let la={Any:null,Minute:-1,Second:0,Millisecond:3,Microsecond:6};function lb(a,b){return new a({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...hO(b)})}function lc(a,b){return new a({type:"string",format:"date",check:"string_format",...hO(b)})}function ld(a,b){return new a({type:"string",format:"time",check:"string_format",precision:null,...hO(b)})}function le(a,b){return new a({type:"string",format:"duration",check:"string_format",...hO(b)})}function lf(a,b){return new a({type:"number",checks:[],...hO(b)})}function lg(a,b){return new a({type:"number",coerce:!0,checks:[],...hO(b)})}function lh(a,b){return new a({type:"number",check:"number_format",abort:!1,format:"safeint",...hO(b)})}function li(a,b){return new a({type:"number",check:"number_format",abort:!1,format:"float32",...hO(b)})}function lj(a,b){return new a({type:"number",check:"number_format",abort:!1,format:"float64",...hO(b)})}function lk(a,b){return new a({type:"number",check:"number_format",abort:!1,format:"int32",...hO(b)})}function ll(a,b){return new a({type:"number",check:"number_format",abort:!1,format:"uint32",...hO(b)})}function lm(a,b){return new a({type:"boolean",...hO(b)})}function ln(a,b){return new a({type:"boolean",coerce:!0,...hO(b)})}function lo(a,b){return new a({type:"bigint",...hO(b)})}function lp(a,b){return new a({type:"bigint",coerce:!0,...hO(b)})}function lq(a,b){return new a({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...hO(b)})}function lr(a,b){return new a({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...hO(b)})}function ls(a,b){return new a({type:"symbol",...hO(b)})}function lt(a,b){return new a({type:"undefined",...hO(b)})}function lu(a,b){return new a({type:"null",...hO(b)})}function lv(a){return new a({type:"any"})}function lw(a){return new a({type:"unknown"})}function lx(a,b){return new a({type:"never",...hO(b)})}function ly(a,b){return new a({type:"void",...hO(b)})}function lz(a,b){return new a({type:"date",...hO(b)})}function lA(a,b){return new a({type:"date",coerce:!0,...hO(b)})}function lB(a,b){return new a({type:"nan",...hO(b)})}function lC(a,b){return new i0({check:"less_than",...hO(b),value:a,inclusive:!1})}function lD(a,b){return new i0({check:"less_than",...hO(b),value:a,inclusive:!0})}function lE(a,b){return new i1({check:"greater_than",...hO(b),value:a,inclusive:!1})}function lF(a,b){return new i1({check:"greater_than",...hO(b),value:a,inclusive:!0})}function lG(a){return lE(0,a)}function lH(a){return lC(0,a)}function lI(a){return lD(0,a)}function lJ(a){return lF(0,a)}function lK(a,b){return new i2({check:"multiple_of",...hO(b),value:a})}function lL(a,b){return new i5({check:"max_size",...hO(b),maximum:a})}function lM(a,b){return new i6({check:"min_size",...hO(b),minimum:a})}function lN(a,b){return new i7({check:"size_equals",...hO(b),size:a})}function lO(a,b){return new i8({check:"max_length",...hO(b),maximum:a})}function lP(a,b){return new i9({check:"min_length",...hO(b),minimum:a})}function lQ(a,b){return new ja({check:"length_equals",...hO(b),length:a})}function lR(a,b){return new jc({check:"string_format",format:"regex",...hO(b),pattern:a})}function lS(a){return new jd({check:"string_format",format:"lowercase",...hO(a)})}function lT(a){return new je({check:"string_format",format:"uppercase",...hO(a)})}function lU(a,b){return new jf({check:"string_format",format:"includes",...hO(b),includes:a})}function lV(a,b){return new jg({check:"string_format",format:"starts_with",...hO(b),prefix:a})}function lW(a,b){return new jh({check:"string_format",format:"ends_with",...hO(b),suffix:a})}function lX(a,b,c){return new jj({check:"property",property:a,schema:b,...hO(c)})}function lY(a,b){return new jk({check:"mime_type",mime:a,...hO(b)})}function lZ(a){return new jl({check:"overwrite",tx:a})}function l$(a){return lZ(b=>b.normalize(a))}function l_(){return lZ(a=>a.trim())}function l0(){return lZ(a=>a.toLowerCase())}function l1(){return lZ(a=>a.toUpperCase())}function l2(a,b,c){return new a({type:"array",element:b,...hO(c)})}function l3(a,b,c){return new a({type:"union",options:b,...hO(c)})}function l4(a,b,c,d){return new a({type:"union",options:c,discriminator:b,...hO(d)})}function l5(a,b,c){return new a({type:"intersection",left:b,right:c})}function l6(a,b,c,d){let e=c instanceof jo,f=e?d:c;return new a({type:"tuple",items:b,rest:e?c:null,...hO(f)})}function l7(a,b,c,d){return new a({type:"record",keyType:b,valueType:c,...hO(d)})}function l8(a,b,c,d){return new a({type:"map",keyType:b,valueType:c,...hO(d)})}function l9(a,b,c){return new a({type:"set",valueType:b,...hO(c)})}function ma(a,b,c){return new a({type:"enum",entries:Array.isArray(b)?Object.fromEntries(b.map(a=>[a,a])):b,...hO(c)})}function mb(a,b,c){return new a({type:"enum",entries:b,...hO(c)})}function mc(a,b,c){return new a({type:"literal",values:Array.isArray(b)?b:[b],...hO(c)})}function md(a,b){return new a({type:"file",...hO(b)})}function me(a,b){return new a({type:"transform",transform:b})}function mf(a,b){return new a({type:"optional",innerType:b})}function mg(a,b){return new a({type:"nullable",innerType:b})}function mh(a,b,c){return new a({type:"default",innerType:b,get defaultValue(){return"function"==typeof c?c():c}})}function mi(a,b,c){return new a({type:"nonoptional",innerType:b,...hO(c)})}function mj(a,b){return new a({type:"success",innerType:b})}function mk(a,b,c){return new a({type:"catch",innerType:b,catchValue:"function"==typeof c?c:()=>c})}function ml(a,b,c){return new a({type:"pipe",in:b,out:c})}function mm(a,b){return new a({type:"readonly",innerType:b})}function mn(a,b,c){return new a({type:"template_literal",parts:b,...hO(c)})}function mo(a,b){return new a({type:"lazy",getter:b})}function mp(a,b){return new a({type:"promise",innerType:b})}function mq(a,b,c){let d=hO(c);return d.abort??(d.abort=!0),new a({type:"custom",check:"custom",fn:b,...d})}function mr(a,b,c){return new a({type:"custom",check:"custom",fn:b,...hO(c)})}function ms(a,b){let{case:c,error:d,truthy:e,falsy:f}=hO(b),g=e??["true","1","yes","on","y","enabled"],h=f??["false","0","no","off","n","disabled"];"sensitive"!==c&&(g=g.map(a=>"string"==typeof a?a.toLowerCase():a),h=h.map(a=>"string"==typeof a?a.toLowerCase():a));let i=new Set(g),j=new Set(h),k=a.Pipe??kx,l=a.Boolean??jT,m=a.String??jp,n=new(a.Transform??km)({type:"transform",transform:(a,b)=>{let d=a;return"sensitive"!==c&&(d=d.toLowerCase()),!!i.has(d)||!j.has(d)&&(b.issues.push({code:"invalid_value",expected:"stringbool",values:[...i,...j],input:b.value,inst:n}),{})},error:d}),o=new k({type:"pipe",in:new m({type:"string",error:d}),out:n,error:d});return new k({type:"pipe",in:o,out:new l({type:"boolean",error:d}),error:d})}a.s(["TimePrecision",0,la,"_any",()=>lv,"_array",()=>l2,"_base64",()=>k6,"_base64url",()=>k7,"_bigint",()=>lo,"_boolean",()=>lm,"_catch",()=>mk,"_cidrv4",()=>k4,"_cidrv6",()=>k5,"_coercedBigint",()=>lp,"_coercedBoolean",()=>ln,"_coercedDate",()=>lA,"_coercedNumber",()=>lg,"_coercedString",()=>kP,"_cuid",()=>kZ,"_cuid2",()=>k$,"_custom",()=>mq,"_date",()=>lz,"_default",()=>mh,"_discriminatedUnion",()=>l4,"_e164",()=>k8,"_email",()=>kQ,"_emoji",()=>kX,"_endsWith",()=>lW,"_enum",()=>ma,"_file",()=>md,"_float32",()=>li,"_float64",()=>lj,"_gt",()=>lE,"_gte",()=>lF,"_guid",()=>kR,"_includes",()=>lU,"_int",()=>lh,"_int32",()=>lk,"_int64",()=>lq,"_intersection",()=>l5,"_ipv4",()=>k2,"_ipv6",()=>k3,"_isoDate",()=>lc,"_isoDateTime",()=>lb,"_isoDuration",()=>le,"_isoTime",()=>ld,"_jwt",()=>k9,"_ksuid",()=>k1,"_lazy",()=>mo,"_length",()=>lQ,"_literal",()=>mc,"_lowercase",()=>lS,"_lt",()=>lC,"_lte",()=>lD,"_map",()=>l8,"_max",()=>lD,"_maxLength",()=>lO,"_maxSize",()=>lL,"_mime",()=>lY,"_min",()=>lF,"_minLength",()=>lP,"_minSize",()=>lM,"_multipleOf",()=>lK,"_nan",()=>lB,"_nanoid",()=>kY,"_nativeEnum",()=>mb,"_negative",()=>lH,"_never",()=>lx,"_nonnegative",()=>lJ,"_nonoptional",()=>mi,"_nonpositive",()=>lI,"_normalize",()=>l$,"_null",()=>lu,"_nullable",()=>mg,"_number",()=>lf,"_optional",()=>mf,"_overwrite",()=>lZ,"_pipe",()=>ml,"_positive",()=>lG,"_promise",()=>mp,"_property",()=>lX,"_readonly",()=>mm,"_record",()=>l7,"_refine",()=>mr,"_regex",()=>lR,"_set",()=>l9,"_size",()=>lN,"_startsWith",()=>lV,"_string",()=>kO,"_stringbool",()=>ms,"_success",()=>mj,"_symbol",()=>ls,"_templateLiteral",()=>mn,"_toLowerCase",()=>l0,"_toUpperCase",()=>l1,"_transform",()=>me,"_trim",()=>l_,"_tuple",()=>l6,"_uint32",()=>ll,"_uint64",()=>lr,"_ulid",()=>k_,"_undefined",()=>lt,"_union",()=>l3,"_unknown",()=>lw,"_uppercase",()=>lT,"_url",()=>kW,"_uuid",()=>kS,"_uuidv4",()=>kT,"_uuidv6",()=>kU,"_uuidv7",()=>kV,"_void",()=>ly,"_xid",()=>k0],504223);class mt{constructor(a){this._def=a,this.def=a}implement(a){if("function"!=typeof a)throw Error("implement() must be called with a function");let b=(...c)=>{let d=this._def.input?ih(this._def.input,c,void 0,{callee:b}):c;if(!Array.isArray(d))throw Error("Invalid arguments schema: not an array or tuple schema.");let e=a(...d);return this._def.output?ih(this._def.output,e,void 0,{callee:b}):e};return b}implementAsync(a){if("function"!=typeof a)throw Error("implement() must be called with a function");let b=async(...c)=>{let d=this._def.input?await ij(this._def.input,c,void 0,{callee:b}):c;if(!Array.isArray(d))throw Error("Invalid arguments schema: not an array or tuple schema.");let e=await a(...d);return this._def.output?ij(this._def.output,e,void 0,{callee:b}):e};return b}input(...a){let b=this.constructor;return new b(Array.isArray(a[0])?{type:"function",input:new kc({type:"tuple",items:a[0],rest:a[1]}),output:this._def.output}:{type:"function",input:a[0],output:this._def.output})}output(a){return new this.constructor({type:"function",input:this._def.input,output:a})}}function mu(a){return new mt({type:"function",input:Array.isArray(a?.input)?l6(kc,a?.input):a?.input??l2(j3,lw(j$)),output:a?.output??lw(j$)})}a.s(["$ZodFunction",()=>mt,"function",()=>mu],111018);class mv{constructor(a){this.counter=0,this.metadataRegistry=a?.metadata??kN,this.target=a?.target??"draft-2020-12",this.unrepresentable=a?.unrepresentable??"throw",this.override=a?.override??(()=>{}),this.io=a?.io??"output",this.seen=new Map}process(a,b={path:[],schemaPath:[]}){var c;let d=a._zod.def,e=this.seen.get(a);if(e)return e.count++,b.schemaPath.includes(a)&&(e.cycle=b.path),e.schema;let f={schema:{},count:1,cycle:void 0};this.seen.set(a,f);let g=a._zod.toJSONSchema?.();if(g)f.schema=g;else{let c={...b,schemaPath:[...b.schemaPath,a],path:b.path},e=a._zod.parent;if(e)f.ref=e,this.process(e,c),this.seen.get(e).isParent=!0;else{let b=f.schema;switch(d.type){case"string":{b.type="string";let{minimum:c,maximum:d,format:e,patterns:g,contentEncoding:h}=a._zod.bag;if("number"==typeof c&&(b.minLength=c),"number"==typeof d&&(b.maxLength=d),e&&(b.format=({guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""})[e]??e,""===b.format&&delete b.format),h&&(b.contentEncoding=h),g&&g.size>0){let a=[...g];1===a.length?b.pattern=a[0].source:a.length>1&&(f.schema.allOf=[...a.map(a=>({..."draft-7"===this.target?{type:"string"}:{},pattern:a.source}))])}break}case"number":{let{minimum:c,maximum:d,format:e,multipleOf:f,exclusiveMaximum:g,exclusiveMinimum:h}=a._zod.bag;"string"==typeof e&&e.includes("int")?b.type="integer":b.type="number","number"==typeof h&&(b.exclusiveMinimum=h),"number"==typeof c&&(b.minimum=c,"number"==typeof h&&(h>=c?delete b.minimum:delete b.exclusiveMinimum)),"number"==typeof g&&(b.exclusiveMaximum=g),"number"==typeof d&&(b.maximum=d,"number"==typeof g&&(g<=d?delete b.maximum:delete b.exclusiveMaximum)),"number"==typeof f&&(b.multipleOf=f);break}case"boolean":case"success":b.type="boolean";break;case"bigint":if("throw"===this.unrepresentable)throw Error("BigInt cannot be represented in JSON Schema");break;case"symbol":if("throw"===this.unrepresentable)throw Error("Symbols cannot be represented in JSON Schema");break;case"undefined":case"null":b.type="null";break;case"any":case"unknown":break;case"never":b.not={};break;case"void":if("throw"===this.unrepresentable)throw Error("Void cannot be represented in JSON Schema");break;case"date":if("throw"===this.unrepresentable)throw Error("Date cannot be represented in JSON Schema");break;case"array":{let{minimum:e,maximum:f}=a._zod.bag;"number"==typeof e&&(b.minItems=e),"number"==typeof f&&(b.maxItems=f),b.type="array",b.items=this.process(d.element,{...c,path:[...c.path,"items"]});break}case"object":{b.type="object",b.properties={};let a=d.shape;for(let d in a)b.properties[d]=this.process(a[d],{...c,path:[...c.path,"properties",d]});let e=new Set([...new Set(Object.keys(a))].filter(a=>{let b=d.shape[a]._zod;return"input"===this.io?void 0===b.optin:void 0===b.optout}));e.size>0&&(b.required=Array.from(e)),d.catchall?._zod.def.type==="never"?b.additionalProperties=!1:d.catchall?d.catchall&&(b.additionalProperties=this.process(d.catchall,{...c,path:[...c.path,"additionalProperties"]})):"output"===this.io&&(b.additionalProperties=!1);break}case"union":b.anyOf=d.options.map((a,b)=>this.process(a,{...c,path:[...c.path,"anyOf",b]}));break;case"intersection":{let a=this.process(d.left,{...c,path:[...c.path,"allOf",0]}),e=this.process(d.right,{...c,path:[...c.path,"allOf",1]}),f=a=>"allOf"in a&&1===Object.keys(a).length;b.allOf=[...f(a)?a.allOf:[a],...f(e)?e.allOf:[e]];break}case"tuple":{b.type="array";let e=d.items.map((a,b)=>this.process(a,{...c,path:[...c.path,"prefixItems",b]}));if("draft-2020-12"===this.target?b.prefixItems=e:b.items=e,d.rest){let a=this.process(d.rest,{...c,path:[...c.path,"items"]});"draft-2020-12"===this.target?b.items=a:b.additionalItems=a}d.rest&&(b.items=this.process(d.rest,{...c,path:[...c.path,"items"]}));let{minimum:f,maximum:g}=a._zod.bag;"number"==typeof f&&(b.minItems=f),"number"==typeof g&&(b.maxItems=g);break}case"record":b.type="object",b.propertyNames=this.process(d.keyType,{...c,path:[...c.path,"propertyNames"]}),b.additionalProperties=this.process(d.valueType,{...c,path:[...c.path,"additionalProperties"]});break;case"map":if("throw"===this.unrepresentable)throw Error("Map cannot be represented in JSON Schema");break;case"set":if("throw"===this.unrepresentable)throw Error("Set cannot be represented in JSON Schema");break;case"enum":{let a=hs(d.entries);a.every(a=>"number"==typeof a)&&(b.type="number"),a.every(a=>"string"==typeof a)&&(b.type="string"),b.enum=a;break}case"literal":{let a=[];for(let b of d.values)if(void 0===b){if("throw"===this.unrepresentable)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof b)if("throw"===this.unrepresentable)throw Error("BigInt literals cannot be represented in JSON Schema");else a.push(Number(b));else a.push(b);if(0===a.length);else if(1===a.length){let c=a[0];b.type=null===c?"null":typeof c,b.const=c}else a.every(a=>"number"==typeof a)&&(b.type="number"),a.every(a=>"string"==typeof a)&&(b.type="string"),a.every(a=>"boolean"==typeof a)&&(b.type="string"),a.every(a=>null===a)&&(b.type="null"),b.enum=a;break}case"file":{let c={type:"string",format:"binary",contentEncoding:"binary"},{minimum:d,maximum:e,mime:f}=a._zod.bag;void 0!==d&&(c.minLength=d),void 0!==e&&(c.maxLength=e),f?1===f.length?(c.contentMediaType=f[0],Object.assign(b,c)):b.anyOf=f.map(a=>({...c,contentMediaType:a})):Object.assign(b,c);break}case"transform":if("throw"===this.unrepresentable)throw Error("Transforms cannot be represented in JSON Schema");break;case"nullable":b.anyOf=[this.process(d.innerType,c),{type:"null"}];break;case"nonoptional":case"promise":case"optional":this.process(d.innerType,c),f.ref=d.innerType;break;case"default":this.process(d.innerType,c),f.ref=d.innerType,b.default=JSON.parse(JSON.stringify(d.defaultValue));break;case"prefault":this.process(d.innerType,c),f.ref=d.innerType,"input"===this.io&&(b._prefault=JSON.parse(JSON.stringify(d.defaultValue)));break;case"catch":{let a;this.process(d.innerType,c),f.ref=d.innerType;try{a=d.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}b.default=a;break}case"nan":if("throw"===this.unrepresentable)throw Error("NaN cannot be represented in JSON Schema");break;case"template_literal":{let c=a._zod.pattern;if(!c)throw Error("Pattern not found in template literal");b.type="string",b.pattern=c.source;break}case"pipe":{let a="input"===this.io?"transform"===d.in._zod.def.type?d.out:d.in:d.out;this.process(a,c),f.ref=a;break}case"readonly":this.process(d.innerType,c),f.ref=d.innerType,b.readOnly=!0;break;case"lazy":{let b=a._zod.innerType;this.process(b,c),f.ref=b;break}case"custom":if("throw"===this.unrepresentable)throw Error("Custom types cannot be represented in JSON Schema")}}}let h=this.metadataRegistry.get(a);return h&&Object.assign(f.schema,h),"input"===this.io&&function a(b,c){let d=c??{seen:new Set};if(d.seen.has(b))return!1;d.seen.add(b);let e=b._zod.def;switch(e.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":case"custom":case"success":case"catch":return!1;case"array":return a(e.element,d);case"object":for(let b in e.shape)if(a(e.shape[b],d))return!0;return!1;case"union":for(let b of e.options)if(a(b,d))return!0;return!1;case"intersection":return a(e.left,d)||a(e.right,d);case"tuple":for(let b of e.items)if(a(b,d))return!0;if(e.rest&&a(e.rest,d))return!0;return!1;case"record":case"map":return a(e.keyType,d)||a(e.valueType,d);case"set":return a(e.valueType,d);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":case"default":case"prefault":return a(e.innerType,d);case"lazy":return a(e.getter(),d);case"transform":return!0;case"pipe":return a(e.in,d)||a(e.out,d)}throw Error(`Unknown schema type: ${e.type}`)}(a)&&(delete f.schema.examples,delete f.schema.default),"input"===this.io&&f.schema._prefault&&((c=f.schema).default??(c.default=f.schema._prefault)),delete f.schema._prefault,this.seen.get(a).schema}emit(a,b){let c={cycles:b?.cycles??"ref",reused:b?.reused??"inline",external:b?.external??void 0},d=this.seen.get(a);if(!d)throw Error("Unprocessed schema. This is a bug in Zod.");let e=a=>{let b="draft-2020-12"===this.target?"$defs":"definitions";if(c.external){let d=c.external.registry.get(a[0])?.id;if(d)return{ref:c.external.uri(d)};let e=a[1].defId??a[1].schema.id??`schema${this.counter++}`;return a[1].defId=e,{defId:e,ref:`${c.external.uri("__shared")}#/${b}/${e}`}}if(a[1]===d)return{ref:"#"};let e=`#/${b}/`,f=a[1].schema.id??`__schema${this.counter++}`;return{defId:f,ref:e+f}},f=a=>{if(a[1].schema.$ref)return;let b=a[1],{ref:c,defId:d}=e(a);b.def={...b.schema},d&&(b.defId=d);let f=b.schema;for(let a in f)delete f[a];f.$ref=c};for(let b of this.seen.entries()){let d=b[1];if(a===b[0]){f(b);continue}if(c.external){let d=c.external.registry.get(b[0])?.id;if(a!==b[0]&&d){f(b);continue}}if(this.metadataRegistry.get(b[0])?.id){f(b);continue}if(d.cycle){if("throw"===c.cycles)throw Error(`Cycle detected: #/${d.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`);"ref"===c.cycles&&f(b);continue}if(d.count>1&&"ref"===c.reused){f(b);continue}}let g=(a,b)=>{let c=this.seen.get(a),d=c.def??c.schema,e={...d};if(null===c.ref)return;let f=c.ref;if(c.ref=null,f){g(f,b);let a=this.seen.get(f).schema;a.$ref&&"draft-7"===b.target?(d.allOf=d.allOf??[],d.allOf.push(a)):(Object.assign(d,a),Object.assign(d,e))}c.isParent||this.override({zodSchema:a,jsonSchema:d})};for(let a of[...this.seen.entries()].reverse())g(a[0],{target:this.target});let h={};"draft-2020-12"===this.target?h.$schema="https://json-schema.org/draft/2020-12/schema":"draft-7"===this.target?h.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),Object.assign(h,d.def);let i=c.external?.defs??{};for(let a of this.seen.entries()){let b=a[1];b.def&&b.defId&&(i[b.defId]=b.def)}!c.external&&Object.keys(i).length>0&&("draft-2020-12"===this.target?h.$defs=i:h.definitions=i);try{return JSON.parse(JSON.stringify(h))}catch(a){throw Error("Error converting schema to JSON.")}}}function mw(a,b){if(a instanceof kL){let c=new mv(b),d={};for(let b of a._idmap.entries()){let[a,d]=b;c.process(d)}let e={},f={registry:a,uri:b?.uri||(a=>a),defs:d};for(let d of a._idmap.entries()){let[a,g]=d;e[a]=c.emit(g,{...b,external:f})}return Object.keys(d).length>0&&(e.__shared={["draft-2020-12"===c.target?"$defs":"definitions"]:d}),{schemas:e}}let c=new mv(b);return c.process(a),c.emit(a,b)}a.s(["JSONSchemaGenerator",()=>mv,"toJSONSchema",()=>mw],246794),a.s([],70101),a.s([],974116),a.i(907680),a.s(["$ZodAny",0,jZ,"$ZodArray",0,j3,"$ZodBase64",0,jL,"$ZodBase64URL",0,jN,"$ZodBigInt",0,jU,"$ZodBigIntFormat",0,jV,"$ZodBoolean",0,jT,"$ZodCIDRv4",0,jI,"$ZodCIDRv6",0,jJ,"$ZodCUID",0,jx,"$ZodCUID2",0,jy,"$ZodCatch",0,kv,"$ZodCustom",0,kE,"$ZodDate",0,j1,"$ZodDefault",0,kp,"$ZodDiscriminatedUnion",0,j9,"$ZodE164",0,jO,"$ZodEmail",0,jt,"$ZodEmoji",0,jv,"$ZodEnum",0,kj,"$ZodFile",0,kl,"$ZodGUID",0,jr,"$ZodIPv4",0,jG,"$ZodIPv6",0,jH,"$ZodISODate",0,jD,"$ZodISODateTime",0,jC,"$ZodISODuration",0,jF,"$ZodISOTime",0,jE,"$ZodIntersection",0,ka,"$ZodJWT",0,jQ,"$ZodKSUID",0,jB,"$ZodLazy",0,kD,"$ZodLiteral",0,kk,"$ZodMap",0,kf,"$ZodNaN",0,kw,"$ZodNanoID",0,jw,"$ZodNever",0,j_,"$ZodNonOptional",0,ks,"$ZodNull",0,jY,"$ZodNullable",0,ko,"$ZodNumber",0,jR,"$ZodNumberFormat",0,jS,"$ZodObject",0,j6,"$ZodOptional",0,kn,"$ZodPipe",0,kx,"$ZodPrefault",0,kr,"$ZodPromise",0,kC,"$ZodReadonly",0,kz,"$ZodRecord",0,ke,"$ZodSet",0,kh,"$ZodString",0,jp,"$ZodStringFormat",0,jq,"$ZodSuccess",0,ku,"$ZodSymbol",0,jW,"$ZodTemplateLiteral",0,kB,"$ZodTransform",0,km,"$ZodTuple",0,kc,"$ZodType",0,jo,"$ZodULID",0,jz,"$ZodURL",0,ju,"$ZodUUID",0,js,"$ZodUndefined",0,jX,"$ZodUnion",0,j8,"$ZodUnknown",0,j$,"$ZodVoid",0,j0,"$ZodXID",0,jA,"clone",()=>hN,"isValidBase64",()=>jK,"isValidBase64URL",()=>jM,"isValidJWT",()=>jP],537571);var mx=a.i(32333),mx=mx;function my(a){if("object"!=typeof a||null===a||!("_zod"in a))return!1;let b=a._zod;return"object"==typeof b&&null!==b&&"def"in b}function mz(a){if("object"!=typeof a||null===a||!("_def"in a)||"_zod"in a)return!1;let b=a._def;return"object"==typeof b&&null!=b&&"typeName"in b}function mA(a){return my(a)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),mz(a)}function mB(a){return!(!a||"object"!=typeof a||Array.isArray(a))&&!!(my(a)||mz(a))}function mC(a){return"object"==typeof a&&null!==a&&"_def"in a&&"object"==typeof a._def&&null!==a._def&&"typeName"in a._def&&"ZodLiteral"===a._def.typeName||!1}function mD(a){return!!my(a)&&("object"==typeof a&&null!==a&&"_zod"in a&&"object"==typeof a._zod&&null!==a._zod&&"def"in a._zod&&"object"==typeof a._zod.def&&null!==a._zod.def&&"type"in a._zod.def&&"literal"===a._zod.def.type||!1)}function mE(a){return!!(mC(a)||mD(a))}async function mF(a,b){if(my(a))try{let c=await ij(a,b);return{success:!0,data:c}}catch(a){return{success:!1,error:a}}if(mz(a))return await a.safeParseAsync(b);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function mG(a,b){if(my(a))return await ij(a,b);if(mz(a))return await a.parseAsync(b);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function mH(a,b){if(my(a))try{let c=ih(a,b);return{success:!0,data:c}}catch(a){return{success:!1,error:a}}if(mz(a))return a.safeParse(b);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function mI(a,b){if(my(a))return ih(a,b);if(mz(a))return a.parse(b);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function mJ(a){return my(a)?kN.get(a)?.description:mz(a)||"description"in a&&"string"==typeof a.description?a.description:void 0}function mK(a){if(!mB(a))return!1;if(mz(a)){let b=a._def;if("ZodObject"===b.typeName)return!a.shape||0===Object.keys(a.shape).length;if("ZodRecord"===b.typeName)return!0}if(my(a)){let b=a._zod.def;if("object"===b.type)return!a.shape||0===Object.keys(a.shape).length;if("record"===b.type)return!0}return"object"==typeof a&&null!==a&&!("shape"in a)}function mL(a){return!!mB(a)&&(mz(a)?"ZodString"===a._def.typeName:!!my(a)&&"string"===a._zod.def.type)}function mM(a){return"object"==typeof a&&null!==a&&"_def"in a&&"object"==typeof a._def&&null!==a._def&&"typeName"in a._def&&"ZodObject"===a._def.typeName||!1}function mN(a){return!!my(a)&&("object"==typeof a&&null!==a&&"_zod"in a&&"object"==typeof a._zod&&null!==a._zod&&"def"in a._zod&&"object"==typeof a._zod.def&&null!==a._zod.def&&"type"in a._zod.def&&"object"===a._zod.def.type||!1)}function mO(a){return!!my(a)&&("object"==typeof a&&null!==a&&"_zod"in a&&"object"==typeof a._zod&&null!==a._zod&&"def"in a._zod&&"object"==typeof a._zod.def&&null!==a._zod.def&&"type"in a._zod.def&&"array"===a._zod.def.type||!1)}function mP(a){return!!my(a)&&("object"==typeof a&&null!==a&&"_zod"in a&&"object"==typeof a._zod&&null!==a._zod&&"def"in a._zod&&"object"==typeof a._zod.def&&null!==a._zod.def&&"type"in a._zod.def&&"optional"===a._zod.def.type||!1)}function mQ(a){return!!my(a)&&("object"==typeof a&&null!==a&&"_zod"in a&&"object"==typeof a._zod&&null!==a._zod&&"def"in a._zod&&"object"==typeof a._zod.def&&null!==a._zod.def&&"type"in a._zod.def&&"nullable"===a._zod.def.type||!1)}function mR(a){return!!(mM(a)||mN(a))}function mS(a){if(mz(a))return a.shape;if(my(a))return a._zod.def.shape;throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function mT(a,b){if(mz(a))return a.extend(b);if(my(a))return mx.extend(a,b);throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function mU(a){if(mz(a))return a.partial();if(my(a))return mx.partial(kn,a,void 0);throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function mV(a,b=!1){if(mz(a))return a.strict();if(mN(a)){let c=a._zod.def.shape;if(b)for(let[d,e]of Object.entries(a._zod.def.shape)){if(mN(e)){let a=mV(e,b);c[d]=a}else if(mO(e)){let a=e._zod.def.element;mN(a)&&(a=mV(a,b)),c[d]=hN(e,{...e._zod.def,element:a})}else c[d]=e;let a=kN.get(e);a&&kN.add(c[d],a)}let d=hN(a,{...a._zod.def,shape:c,catchall:lx(j_)}),e=kN.get(a);return e&&kN.add(d,e),d}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function mW(a){if(mz(a))try{let b=a.parse(void 0);return()=>b}catch{return}if(my(a))try{let b=ih(a,void 0);return()=>b}catch{}}function mX(a,b=!1){return function a(b,c,d){let e=d.get(b);if(void 0!==e)return e;if(mz(b))return mz(b)&&"typeName"in b._def&&"ZodEffects"===b._def.typeName?a(b._def.schema,c,d):b;if(my(b)){let e=b;if(my(b)&&"pipe"===b._zod.def.type&&(e=a(b._zod.def.in,c,d)),c){if(mN(e)){let b=e._zod.def.shape;for(let[f,g]of Object.entries(e._zod.def.shape))b[f]=a(g,c,d);e=hN(e,{...e._zod.def,shape:b})}else if(mO(e)){let b=a(e._zod.def.element,c,d);e=hN(e,{...e._zod.def,element:b})}else if(mP(e)){let b=a(e._zod.def.innerType,c,d);e=hN(e,{...e._zod.def,innerType:b})}else if(mQ(e)){let b=a(e._zod.def.innerType,c,d);e=hN(e,{...e._zod.def,innerType:b})}}let f=kN.get(b);return f&&kN.add(e,f),d.set(b,e),e}throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}(a,b,new WeakMap)}function mY(a,b){if(mz(a)){let c=mS(a),d={};for(let[a,e]of Object.entries(c))b(a,e)?d[a]=e.optional():d[a]=e;return a.extend(d)}if(my(a)){let c=mS(a),d={...a._zod.def.shape};for(let[a,e]of Object.entries(c))b(a,e)&&(d[a]=new kn({type:"optional",innerType:e}));let e=hN(a,{...a._zod.def,shape:d}),f=kN.get(a);return f&&kN.add(e,f),e}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function mZ(a){return a instanceof Error&&("ZodError"===a.constructor.name||"$ZodError"===a.constructor.name)}let m$=Symbol("Let zodToJsonSchema decide on which parser to use"),m_={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},m0=(a,b)=>{let c=0;for(;c<a.length&&c<b.length&&a[c]===b[c];c++);return[(a.length-c).toString(),...b.slice(c)].join("/")};function m1(a){if("openAi"!==a.target)return{};let b=[...a.basePath,a.definitionPath,a.openAiAnyTypeName];return a.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===a.$refStrategy?m0(b,a.currentPath):b.join("/")}}function m2(a,b,c,d){d?.errorMessages&&c&&(a.errorMessage={...a.errorMessage,[b]:c})}function m3(a,b,c,d,e){a[b]=c,m2(a,b,d,e)}a.i(458093);var m4=a.i(316215);function m5(a,b){return nq(a.type._def,b)}let m6=/^[cC][^\s-]{8,}$/,m7=/^[0-9a-z]+$/,m8=/^[0-9A-HJKMNP-TV-Z]{26}$/,m9=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,na=()=>(void 0===m&&(m=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),m),nb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,nc=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,nd=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ne=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nf=/^[a-zA-Z0-9_-]{21}$/,ng=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function nh(a,b){let c={type:"string"};if(a.checks)for(let d of a.checks)switch(d.kind){case"min":m3(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b);break;case"max":m3(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"email":switch(b.emailStrategy){case"format:email":nk(c,"email",d.message,b);break;case"format:idn-email":nk(c,"idn-email",d.message,b);break;case"pattern:zod":nl(c,m9,d.message,b)}break;case"url":nk(c,"uri",d.message,b);break;case"uuid":nk(c,"uuid",d.message,b);break;case"regex":nl(c,d.regex,d.message,b);break;case"cuid":nl(c,m6,d.message,b);break;case"cuid2":nl(c,m7,d.message,b);break;case"startsWith":nl(c,RegExp(`^${ni(d.value,b)}`),d.message,b);break;case"endsWith":nl(c,RegExp(`${ni(d.value,b)}$`),d.message,b);break;case"datetime":nk(c,"date-time",d.message,b);break;case"date":nk(c,"date",d.message,b);break;case"time":nk(c,"time",d.message,b);break;case"duration":nk(c,"duration",d.message,b);break;case"length":m3(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b),m3(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"includes":nl(c,RegExp(ni(d.value,b)),d.message,b);break;case"ip":"v6"!==d.version&&nk(c,"ipv4",d.message,b),"v4"!==d.version&&nk(c,"ipv6",d.message,b);break;case"base64url":nl(c,ne,d.message,b);break;case"jwt":nl(c,ng,d.message,b);break;case"cidr":"v6"!==d.version&&nl(c,nb,d.message,b),"v4"!==d.version&&nl(c,nc,d.message,b);break;case"emoji":nl(c,na(),d.message,b);break;case"ulid":nl(c,m8,d.message,b);break;case"base64":switch(b.base64Strategy){case"format:binary":nk(c,"binary",d.message,b);break;case"contentEncoding:base64":m3(c,"contentEncoding","base64",d.message,b);break;case"pattern:zod":nl(c,nd,d.message,b)}break;case"nanoid":nl(c,nf,d.message,b)}return c}function ni(a,b){return"escape"===b.patternStrategy?function(a){let b="";for(let c=0;c<a.length;c++)nj.has(a[c])||(b+="\\"),b+=a[c];return b}(a):a}let nj=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function nk(a,b,c,d){a.format||a.anyOf?.some(a=>a.format)?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push({format:a.format,...a.errorMessage&&d.errorMessages&&{errorMessage:{format:a.errorMessage.format}}}),delete a.format,a.errorMessage&&(delete a.errorMessage.format,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.anyOf.push({format:b,...c&&d.errorMessages&&{errorMessage:{format:c}}})):m3(a,"format",b,c,d)}function nl(a,b,c,d){a.pattern||a.allOf?.some(a=>a.pattern)?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push({pattern:a.pattern,...a.errorMessage&&d.errorMessages&&{errorMessage:{pattern:a.errorMessage.pattern}}}),delete a.pattern,a.errorMessage&&(delete a.errorMessage.pattern,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.allOf.push({pattern:nm(b,d),...c&&d.errorMessages&&{errorMessage:{pattern:c}}})):m3(a,"pattern",nm(b,d),c,d)}function nm(a,b){if(!b.applyRegexFlags||!a.flags)return a.source;let c={i:a.flags.includes("i"),m:a.flags.includes("m"),s:a.flags.includes("s")},d=c.i?a.source.toLowerCase():a.source,e="",f=!1,g=!1,h=!1;for(let a=0;a<d.length;a++){if(f){e+=d[a],f=!1;continue}if(c.i){if(g){if(d[a].match(/[a-z]/)){h?(e+=d[a],e+=`${d[a-2]}-${d[a]}`.toUpperCase(),h=!1):"-"===d[a+1]&&d[a+2]?.match(/[a-z]/)?(e+=d[a],h=!0):e+=`${d[a]}${d[a].toUpperCase()}`;continue}}else if(d[a].match(/[a-z]/)){e+=`[${d[a]}${d[a].toUpperCase()}]`;continue}}if(c.m){if("^"===d[a]){e+=`(^|(?<=[\r
]))`;continue}else if("$"===d[a]){e+=`($|(?=[\r
]))`;continue}}if(c.s&&"."===d[a]){e+=g?`${d[a]}\r
`:`[${d[a]}\r
]`;continue}e+=d[a],"\\"===d[a]?f=!0:g&&"]"===d[a]?g=!1:g||"["!==d[a]||(g=!0)}try{new RegExp(e)}catch{return console.warn(`Could not convert regex pattern at ${b.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),a.source}return e}function nn(a,b){if("openAi"===b.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===b.target&&a.keyType?._def.typeName===m4.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:a.keyType._def.values,properties:a.keyType._def.values.reduce((c,d)=>({...c,[d]:nq(a.valueType._def,{...b,currentPath:[...b.currentPath,"properties",d]})??m1(b)}),{}),additionalProperties:b.rejectedAdditionalProperties};let c={type:"object",additionalProperties:nq(a.valueType._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]})??b.allowedAdditionalProperties};if("openApi3"===b.target)return c;if(a.keyType?._def.typeName===m4.ZodFirstPartyTypeKind.ZodString&&a.keyType._def.checks?.length){let{type:d,...e}=nh(a.keyType._def,b);return{...c,propertyNames:e}}if(a.keyType?._def.typeName===m4.ZodFirstPartyTypeKind.ZodEnum)return{...c,propertyNames:{enum:a.keyType._def.values}};if(a.keyType?._def.typeName===m4.ZodFirstPartyTypeKind.ZodBranded&&a.keyType._def.type._def.typeName===m4.ZodFirstPartyTypeKind.ZodString&&a.keyType._def.type._def.checks?.length){let{type:d,...e}=m5(a.keyType._def,b);return{...c,propertyNames:e}}return c}let no={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},np=(a,b)=>{let c=(a.options instanceof Map?Array.from(a.options.values()):a.options).map((a,c)=>nq(a._def,{...b,currentPath:[...b.currentPath,"anyOf",`${c}`]})).filter(a=>!!a&&(!b.strictUnions||"object"==typeof a&&Object.keys(a).length>0));return c.length?{anyOf:c}:void 0};function nq(a,b,c=!1){let d=b.seen.get(a);if(b.override){let e=b.override?.(a,b,d,c);if(e!==m$)return e}if(d&&!c){let a=nr(d,b);if(void 0!==a)return a}let e={def:a,path:b.currentPath,jsonSchema:void 0};b.seen.set(a,e);let f=((a,b,c)=>{switch(b){case m4.ZodFirstPartyTypeKind.ZodString:return nh(a,c);case m4.ZodFirstPartyTypeKind.ZodNumber:let d={type:"number"};if(!a.checks)return d;for(let b of a.checks)switch(b.kind){case"int":d.type="integer",m2(d,"type",b.message,c);break;case"min":"jsonSchema7"===c.target?b.inclusive?m3(d,"minimum",b.value,b.message,c):m3(d,"exclusiveMinimum",b.value,b.message,c):(b.inclusive||(d.exclusiveMinimum=!0),m3(d,"minimum",b.value,b.message,c));break;case"max":"jsonSchema7"===c.target?b.inclusive?m3(d,"maximum",b.value,b.message,c):m3(d,"exclusiveMaximum",b.value,b.message,c):(b.inclusive||(d.exclusiveMaximum=!0),m3(d,"maximum",b.value,b.message,c));break;case"multipleOf":m3(d,"multipleOf",b.value,b.message,c)}return d;case m4.ZodFirstPartyTypeKind.ZodObject:return function(a,b){let c="openAi"===b.target,d={type:"object",properties:{}},e=[],f=a.shape();for(let a in f){let g=f[a];if(void 0===g||void 0===g._def)continue;let h=function(a){try{return a.isOptional()}catch{return!0}}(g);h&&c&&("ZodOptional"===g._def.typeName&&(g=g._def.innerType),g.isNullable()||(g=g.nullable()),h=!1);let i=nq(g._def,{...b,currentPath:[...b.currentPath,"properties",a],propertyPath:[...b.currentPath,"properties",a]});void 0!==i&&(d.properties[a]=i,h||e.push(a))}e.length&&(d.required=e);let g=function(a,b){if("ZodNever"!==a.catchall._def.typeName)return nq(a.catchall._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]});switch(a.unknownKeys){case"passthrough":return b.allowedAdditionalProperties;case"strict":return b.rejectedAdditionalProperties;case"strip":return"strict"===b.removeAdditionalStrategy?b.allowedAdditionalProperties:b.rejectedAdditionalProperties}}(a,b);return void 0!==g&&(d.additionalProperties=g),d}(a,c);case m4.ZodFirstPartyTypeKind.ZodBigInt:let e={type:"integer",format:"int64"};if(!a.checks)return e;for(let b of a.checks)switch(b.kind){case"min":"jsonSchema7"===c.target?b.inclusive?m3(e,"minimum",b.value,b.message,c):m3(e,"exclusiveMinimum",b.value,b.message,c):(b.inclusive||(e.exclusiveMinimum=!0),m3(e,"minimum",b.value,b.message,c));break;case"max":"jsonSchema7"===c.target?b.inclusive?m3(e,"maximum",b.value,b.message,c):m3(e,"exclusiveMaximum",b.value,b.message,c):(b.inclusive||(e.exclusiveMaximum=!0),m3(e,"maximum",b.value,b.message,c));break;case"multipleOf":m3(e,"multipleOf",b.value,b.message,c)}return e;case m4.ZodFirstPartyTypeKind.ZodBoolean:return{type:"boolean"};case m4.ZodFirstPartyTypeKind.ZodDate:return function a(b,c,d){let e=d??c.dateStrategy;if(Array.isArray(e))return{anyOf:e.map(d=>a(b,c,d))};switch(e){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var f=b,g=c;let h={type:"integer",format:"unix-time"};if("openApi3"===g.target)return h;for(let a of f.checks)switch(a.kind){case"min":m3(h,"minimum",a.value,a.message,g);break;case"max":m3(h,"maximum",a.value,a.message,g)}return h}}(a,c);case m4.ZodFirstPartyTypeKind.ZodUndefined:return{not:m1(c)};case m4.ZodFirstPartyTypeKind.ZodNull:return"openApi3"===c.target?{enum:["null"],nullable:!0}:{type:"null"};case m4.ZodFirstPartyTypeKind.ZodArray:let f;return f={type:"array"},a.type?._def&&a.type?._def?.typeName!==m4.ZodFirstPartyTypeKind.ZodAny&&(f.items=nq(a.type._def,{...c,currentPath:[...c.currentPath,"items"]})),a.minLength&&m3(f,"minItems",a.minLength.value,a.minLength.message,c),a.maxLength&&m3(f,"maxItems",a.maxLength.value,a.maxLength.message,c),a.exactLength&&(m3(f,"minItems",a.exactLength.value,a.exactLength.message,c),m3(f,"maxItems",a.exactLength.value,a.exactLength.message,c)),f;case m4.ZodFirstPartyTypeKind.ZodUnion:case m4.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:if("openApi3"===c.target)return np(a,c);let g=a.options instanceof Map?Array.from(a.options.values()):a.options;if(g.every(a=>a._def.typeName in no&&(!a._def.checks||!a._def.checks.length))){let a=g.reduce((a,b)=>{let c=no[b._def.typeName];return c&&!a.includes(c)?[...a,c]:a},[]);return{type:a.length>1?a:a[0]}}if(g.every(a=>"ZodLiteral"===a._def.typeName&&!a.description)){let a=g.reduce((a,b)=>{let c=typeof b._def.value;switch(c){case"string":case"number":case"boolean":return[...a,c];case"bigint":return[...a,"integer"];case"object":if(null===b._def.value)return[...a,"null"];return a;default:return a}},[]);if(a.length===g.length){let b=a.filter((a,b,c)=>c.indexOf(a)===b);return{type:b.length>1?b:b[0],enum:g.reduce((a,b)=>a.includes(b._def.value)?a:[...a,b._def.value],[])}}}else if(g.every(a=>"ZodEnum"===a._def.typeName))return{type:"string",enum:g.reduce((a,b)=>[...a,...b._def.values.filter(b=>!a.includes(b))],[])};return np(a,c);case m4.ZodFirstPartyTypeKind.ZodIntersection:let h,i,j;return h=[nq(a.left._def,{...c,currentPath:[...c.currentPath,"allOf","0"]}),nq(a.right._def,{...c,currentPath:[...c.currentPath,"allOf","1"]})].filter(a=>!!a),i="jsonSchema2019-09"===c.target?{unevaluatedProperties:!1}:void 0,j=[],h.forEach(a=>{if((!("type"in a)||"string"!==a.type)&&"allOf"in a)j.push(...a.allOf),void 0===a.unevaluatedProperties&&(i=void 0);else{let b=a;if("additionalProperties"in a&&!1===a.additionalProperties){let{additionalProperties:c,...d}=a;b=d}else i=void 0;j.push(b)}}),j.length?{allOf:j,...i}:void 0;case m4.ZodFirstPartyTypeKind.ZodTuple:return a.rest?{type:"array",minItems:a.items.length,items:a.items.map((a,b)=>nq(a._def,{...c,currentPath:[...c.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[]),additionalItems:nq(a.rest._def,{...c,currentPath:[...c.currentPath,"additionalItems"]})}:{type:"array",minItems:a.items.length,maxItems:a.items.length,items:a.items.map((a,b)=>nq(a._def,{...c,currentPath:[...c.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[])};case m4.ZodFirstPartyTypeKind.ZodRecord:return nn(a,c);case m4.ZodFirstPartyTypeKind.ZodLiteral:let k;return"bigint"!=(k=typeof a.value)&&"number"!==k&&"boolean"!==k&&"string"!==k?{type:Array.isArray(a.value)?"array":"object"}:"openApi3"===c.target?{type:"bigint"===k?"integer":k,enum:[a.value]}:{type:"bigint"===k?"integer":k,const:a.value};case m4.ZodFirstPartyTypeKind.ZodEnum:return{type:"string",enum:Array.from(a.values)};case m4.ZodFirstPartyTypeKind.ZodNativeEnum:let l,m,n;return l=a.values,{type:1===(n=Array.from(new Set((m=Object.keys(a.values).filter(a=>"number"!=typeof l[l[a]]).map(a=>l[a])).map(a=>typeof a)))).length?"string"===n[0]?"string":"number":["string","number"],enum:m};case m4.ZodFirstPartyTypeKind.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(a.innerType._def.typeName)&&(!a.innerType._def.checks||!a.innerType._def.checks.length))return"openApi3"===c.target?{type:no[a.innerType._def.typeName],nullable:!0}:{type:[no[a.innerType._def.typeName],"null"]};if("openApi3"===c.target){let b=nq(a.innerType._def,{...c,currentPath:[...c.currentPath]});return b&&"$ref"in b?{allOf:[b],nullable:!0}:b&&{...b,nullable:!0}}let o=nq(a.innerType._def,{...c,currentPath:[...c.currentPath,"anyOf","0"]});return o&&{anyOf:[o,{type:"null"}]};case m4.ZodFirstPartyTypeKind.ZodOptional:if(c.currentPath.toString()===c.propertyPath?.toString())return nq(a.innerType._def,c);let p=nq(a.innerType._def,{...c,currentPath:[...c.currentPath,"anyOf","1"]});return p?{anyOf:[{not:m1(c)},p]}:m1(c);case m4.ZodFirstPartyTypeKind.ZodMap:if("record"===c.mapStrategy)return nn(a,c);return{type:"array",maxItems:125,items:{type:"array",items:[nq(a.keyType._def,{...c,currentPath:[...c.currentPath,"items","items","0"]})||m1(c),nq(a.valueType._def,{...c,currentPath:[...c.currentPath,"items","items","1"]})||m1(c)],minItems:2,maxItems:2}};case m4.ZodFirstPartyTypeKind.ZodSet:let q;return q={type:"array",uniqueItems:!0,items:nq(a.valueType._def,{...c,currentPath:[...c.currentPath,"items"]})},a.minSize&&m3(q,"minItems",a.minSize.value,a.minSize.message,c),a.maxSize&&m3(q,"maxItems",a.maxSize.value,a.maxSize.message,c),q;case m4.ZodFirstPartyTypeKind.ZodLazy:return()=>a.getter()._def;case m4.ZodFirstPartyTypeKind.ZodPromise:return nq(a.type._def,c);case m4.ZodFirstPartyTypeKind.ZodNaN:case m4.ZodFirstPartyTypeKind.ZodNever:return"openAi"===c.target?void 0:{not:m1({...c,currentPath:[...c.currentPath,"not"]})};case m4.ZodFirstPartyTypeKind.ZodEffects:return"input"===c.effectStrategy?nq(a.schema._def,c):m1(c);case m4.ZodFirstPartyTypeKind.ZodAny:case m4.ZodFirstPartyTypeKind.ZodUnknown:return m1(c);case m4.ZodFirstPartyTypeKind.ZodDefault:return{...nq(a.innerType._def,c),default:a.defaultValue()};case m4.ZodFirstPartyTypeKind.ZodBranded:return m5(a,c);case m4.ZodFirstPartyTypeKind.ZodReadonly:case m4.ZodFirstPartyTypeKind.ZodCatch:return nq(a.innerType._def,c);case m4.ZodFirstPartyTypeKind.ZodPipeline:if("input"===c.pipeStrategy)return nq(a.in._def,c);if("output"===c.pipeStrategy)return nq(a.out._def,c);let r=nq(a.in._def,{...c,currentPath:[...c.currentPath,"allOf","0"]}),s=nq(a.out._def,{...c,currentPath:[...c.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,s].filter(a=>void 0!==a)};case m4.ZodFirstPartyTypeKind.ZodFunction:case m4.ZodFirstPartyTypeKind.ZodVoid:case m4.ZodFirstPartyTypeKind.ZodSymbol:default:return}})(a,a.typeName,b),g="function"==typeof f?nq(f(),b):f;if(g&&ns(a,b,g),b.postProcess){let c=b.postProcess(g,a,b);return e.jsonSchema=g,c}return e.jsonSchema=g,g}let nr=(a,b)=>{switch(b.$refStrategy){case"root":return{$ref:a.path.join("/")};case"relative":return{$ref:m0(b.currentPath,a.path)};case"none":case"seen":if(a.path.length<b.currentPath.length&&a.path.every((a,c)=>b.currentPath[c]===a))return console.warn(`Recursive reference detected at ${b.currentPath.join("/")}! Defaulting to any`),m1(b);return"seen"===b.$refStrategy?m1(b):void 0}},ns=(a,b,c)=>(a.description&&(c.description=a.description,b.markdownDescription&&(c.markdownDescription=a.description)),c);function nt(a,b){let c=typeof a;if(c!==typeof b)return!1;if(Array.isArray(a)){if(!Array.isArray(b))return!1;let c=a.length;if(c!==b.length)return!1;for(let d=0;d<c;d++)if(!nt(a[d],b[d]))return!1;return!0}if("object"===c){if(!a||!b)return a===b;let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(let d of c)if(!nt(a[d],b[d]))return!1;return!0}return a===b}function nu(a){return encodeURI(a.replace(/~/g,"~0").replace(/\//g,"~1"))}let nv={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},nw={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},nx={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},ny="undefined"!=typeof self&&self.location&&"null"!==self.location.origin?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function nz(a,b=Object.create(null),c=ny,d=""){if(a&&"object"==typeof a&&!Array.isArray(a)){let e=a.$id||a.id;if(e){let f=new URL(e,c.href);f.hash.length>1?b[f.href]=a:(f.hash="",""===d?c=f:nz(a,b,c))}}else if(!0!==a&&!1!==a)return b;let e=c.href+(d?"#"+d:"");if(void 0!==b[e])throw Error(`Duplicate schema URI "${e}".`);if(b[e]=a,!0===a||!1===a)return b;if(void 0===a.__absolute_uri__&&Object.defineProperty(a,"__absolute_uri__",{enumerable:!1,value:e}),a.$ref&&void 0===a.__absolute_ref__){let b=new URL(a.$ref,c.href);b.hash=b.hash,Object.defineProperty(a,"__absolute_ref__",{enumerable:!1,value:b.href})}if(a.$recursiveRef&&void 0===a.__absolute_recursive_ref__){let b=new URL(a.$recursiveRef,c.href);b.hash=b.hash,Object.defineProperty(a,"__absolute_recursive_ref__",{enumerable:!1,value:b.href})}for(let e in a.$anchor&&(b[new URL("#"+a.$anchor,c.href).href]=a),a){if(nx[e])continue;let f=`${d}/${nu(e)}`,g=a[e];if(Array.isArray(g)){if(nv[e]){let a=g.length;for(let d=0;d<a;d++)nz(g[d],b,c,`${f}/${d}`)}}else if(nw[e])for(let a in g)nz(g[a],b,c,`${f}/${nu(a)}`);else nz(g,b,c,f)}return b}let nA=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,nB=[0,31,28,31,30,31,30,31,31,30,31,30,31],nC=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function nD(a){return a.test.bind(a)}let nE={date:nF,time:nG.bind(void 0,!1),"date-time":function(a){let b=a.split(nH);return 2==b.length&&nF(b[0])&&nG(!0,b[1])},duration:a=>a.length>1&&a.length<80&&(/^P\d+([.,]\d+)?W$/.test(a)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(a)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(a)),uri:function(a){return nI.test(a)&&nJ.test(a)},"uri-reference":nD(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),"uri-template":nD(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),url:nD(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),email:a=>{if('"'===a[0])return!1;let[b,c,...d]=a.split("@");return!(!b||!c||0!==d.length||b.length>64||c.length>253||"."===b[0]||b.endsWith(".")||b.includes(".."))&&!!/^[a-z0-9.-]+$/i.test(c)&&!!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(b)&&c.split(".").every(a=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(a))},hostname:nD(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),ipv4:nD(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),ipv6:nD(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),regex:function(a){if(nK.test(a))return!1;try{return RegExp(a,"u"),!0}catch(a){return!1}},uuid:nD(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),"json-pointer":nD(/^(?:\/(?:[^~/]|~0|~1)*)*$/),"json-pointer-uri-fragment":nD(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),"relative-json-pointer":nD(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/)};function nF(a){var b;let c=a.match(nA);if(!c)return!1;let d=+c[1],e=+c[2],f=+c[3];return e>=1&&e<=12&&f>=1&&f<=(2==e&&(b=d)%4==0&&(b%100!=0||b%400==0)?29:nB[e])}function nG(a,b){let c=b.match(nC);if(!c)return!1;let d=+c[1],e=+c[2],f=+c[3],g=!!c[5];return(d<=23&&e<=59&&f<=59||23==d&&59==e&&60==f)&&(!a||g)}let nH=/t|\s/i,nI=/\/|:/,nJ=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,nK=/[^\\]\\Z/;function nL(a,b,c="2019-09",d=nz(b),e=!0,f=null,g="#",h="#",i=Object.create(null)){let j;if(!0===b)return{valid:!0,errors:[]};if(!1===b)return{valid:!1,errors:[{instanceLocation:g,keyword:"false",keywordLocation:g,error:"False boolean schema."}]};let k=typeof a;switch(k){case"boolean":case"number":case"string":j=k;break;case"object":j=null===a?"null":Array.isArray(a)?"array":"object";break;default:throw Error(`Instances of "${k}" type are not supported.`)}let{$ref:l,$recursiveRef:m,$recursiveAnchor:n,type:o,const:p,enum:q,required:r,not:s,anyOf:t,allOf:u,oneOf:v,if:w,then:x,else:y,format:z,properties:A,patternProperties:B,additionalProperties:C,unevaluatedProperties:D,minProperties:E,maxProperties:F,propertyNames:G,dependentRequired:H,dependentSchemas:I,dependencies:J,prefixItems:K,items:L,additionalItems:M,unevaluatedItems:N,contains:O,minContains:P,maxContains:Q,minItems:R,maxItems:S,uniqueItems:T,minimum:U,maximum:V,exclusiveMinimum:W,exclusiveMaximum:X,multipleOf:Y,minLength:Z,maxLength:$,pattern:_,__absolute_ref__:aa,__absolute_recursive_ref__:ab}=b,ac=[];if(!0===n&&null===f&&(f=b),"#"===m){let j=null===f?d[ab]:f,k=`${h}/$recursiveRef`,l=nL(a,null===f?b:f,c,d,e,j,g,k,i);l.valid||ac.push({instanceLocation:g,keyword:"$recursiveRef",keywordLocation:k,error:"A subschema had errors."},...l.errors)}if(void 0!==l){let b=d[aa||l];if(void 0===b){let a=`Unresolved $ref "${l}".`;throw aa&&aa!==l&&(a+=`  Absolute URI "${aa}".`),Error(a+=`
Known schemas:
- ${Object.keys(d).join("\n- ")}`)}let j=`${h}/$ref`,k=nL(a,b,c,d,e,f,g,j,i);if(k.valid||ac.push({instanceLocation:g,keyword:"$ref",keywordLocation:j,error:"A subschema had errors."},...k.errors),"4"===c||"7"===c)return{valid:0===ac.length,errors:ac}}if(Array.isArray(o)){let b=o.length,c=!1;for(let d=0;d<b;d++)if(j===o[d]||"integer"===o[d]&&"number"===j&&a%1==0&&a==a){c=!0;break}c||ac.push({instanceLocation:g,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${j}" is invalid. Expected "${o.join('", "')}".`})}else"integer"===o?("number"!==j||a%1||a!=a)&&ac.push({instanceLocation:g,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${j}" is invalid. Expected "${o}".`}):void 0!==o&&j!==o&&ac.push({instanceLocation:g,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${j}" is invalid. Expected "${o}".`});if(void 0!==p&&("object"===j||"array"===j?nt(a,p)||ac.push({instanceLocation:g,keyword:"const",keywordLocation:`${h}/const`,error:`Instance does not match ${JSON.stringify(p)}.`}):a!==p&&ac.push({instanceLocation:g,keyword:"const",keywordLocation:`${h}/const`,error:`Instance does not match ${JSON.stringify(p)}.`})),void 0!==q&&("object"===j||"array"===j?q.some(b=>nt(a,b))||ac.push({instanceLocation:g,keyword:"enum",keywordLocation:`${h}/enum`,error:`Instance does not match any of ${JSON.stringify(q)}.`}):q.some(b=>a===b)||ac.push({instanceLocation:g,keyword:"enum",keywordLocation:`${h}/enum`,error:`Instance does not match any of ${JSON.stringify(q)}.`})),void 0!==s){let b=`${h}/not`;nL(a,s,c,d,e,f,g,b).valid&&ac.push({instanceLocation:g,keyword:"not",keywordLocation:b,error:'Instance matched "not" schema.'})}let ad=[];if(void 0!==t){let b=`${h}/anyOf`,j=ac.length,k=!1;for(let h=0;h<t.length;h++){let j=t[h],l=Object.create(i),m=nL(a,j,c,d,e,!0===n?f:null,g,`${b}/${h}`,l);ac.push(...m.errors),k=k||m.valid,m.valid&&ad.push(l)}k?ac.length=j:ac.splice(j,0,{instanceLocation:g,keyword:"anyOf",keywordLocation:b,error:"Instance does not match any subschemas."})}if(void 0!==u){let b=`${h}/allOf`,j=ac.length,k=!0;for(let h=0;h<u.length;h++){let j=u[h],l=Object.create(i),m=nL(a,j,c,d,e,!0===n?f:null,g,`${b}/${h}`,l);ac.push(...m.errors),k=k&&m.valid,m.valid&&ad.push(l)}k?ac.length=j:ac.splice(j,0,{instanceLocation:g,keyword:"allOf",keywordLocation:b,error:"Instance does not match every subschema."})}if(void 0!==v){let b=`${h}/oneOf`,j=ac.length,k=v.filter((h,j)=>{let k=Object.create(i),l=nL(a,h,c,d,e,!0===n?f:null,g,`${b}/${j}`,k);return ac.push(...l.errors),l.valid&&ad.push(k),l.valid}).length;1===k?ac.length=j:ac.splice(j,0,{instanceLocation:g,keyword:"oneOf",keywordLocation:b,error:`Instance does not match exactly one subschema (${k} matches).`})}if(("object"===j||"array"===j)&&Object.assign(i,...ad),void 0!==w){let b=`${h}/if`;if(nL(a,w,c,d,e,f,g,b,i).valid){if(void 0!==x){let j=nL(a,x,c,d,e,f,g,`${h}/then`,i);j.valid||ac.push({instanceLocation:g,keyword:"if",keywordLocation:b,error:'Instance does not match "then" schema.'},...j.errors)}}else if(void 0!==y){let j=nL(a,y,c,d,e,f,g,`${h}/else`,i);j.valid||ac.push({instanceLocation:g,keyword:"if",keywordLocation:b,error:'Instance does not match "else" schema.'},...j.errors)}}if("object"===j){if(void 0!==r)for(let b of r)b in a||ac.push({instanceLocation:g,keyword:"required",keywordLocation:`${h}/required`,error:`Instance does not have required property "${b}".`});let b=Object.keys(a);if(void 0!==E&&b.length<E&&ac.push({instanceLocation:g,keyword:"minProperties",keywordLocation:`${h}/minProperties`,error:`Instance does not have at least ${E} properties.`}),void 0!==F&&b.length>F&&ac.push({instanceLocation:g,keyword:"maxProperties",keywordLocation:`${h}/maxProperties`,error:`Instance does not have at least ${F} properties.`}),void 0!==G){let b=`${h}/propertyNames`;for(let h in a){let a=`${g}/${nu(h)}`,i=nL(h,G,c,d,e,f,a,b);i.valid||ac.push({instanceLocation:g,keyword:"propertyNames",keywordLocation:b,error:`Property name "${h}" does not match schema.`},...i.errors)}}if(void 0!==H){let b=`${h}/dependantRequired`;for(let c in H)if(c in a)for(let d of H[c])d in a||ac.push({instanceLocation:g,keyword:"dependentRequired",keywordLocation:b,error:`Instance has "${c}" but does not have "${d}".`})}if(void 0!==I)for(let b in I){let j=`${h}/dependentSchemas`;if(b in a){let h=nL(a,I[b],c,d,e,f,g,`${j}/${nu(b)}`,i);h.valid||ac.push({instanceLocation:g,keyword:"dependentSchemas",keywordLocation:j,error:`Instance has "${b}" but does not match dependant schema.`},...h.errors)}}if(void 0!==J){let b=`${h}/dependencies`;for(let h in J)if(h in a){let i=J[h];if(Array.isArray(i))for(let c of i)c in a||ac.push({instanceLocation:g,keyword:"dependencies",keywordLocation:b,error:`Instance has "${h}" but does not have "${c}".`});else{let j=nL(a,i,c,d,e,f,g,`${b}/${nu(h)}`);j.valid||ac.push({instanceLocation:g,keyword:"dependencies",keywordLocation:b,error:`Instance has "${h}" but does not match dependant schema.`},...j.errors)}}}let j=Object.create(null),k=!1;if(void 0!==A){let b=`${h}/properties`;for(let h in A){if(!(h in a))continue;let l=`${g}/${nu(h)}`,m=nL(a[h],A[h],c,d,e,f,l,`${b}/${nu(h)}`);if(m.valid)i[h]=j[h]=!0;else if(k=e,ac.push({instanceLocation:g,keyword:"properties",keywordLocation:b,error:`Property "${h}" does not match schema.`},...m.errors),k)break}}if(!k&&void 0!==B){let b=`${h}/patternProperties`;for(let h in B){let l=RegExp(h,"u"),m=B[h];for(let n in a){if(!l.test(n))continue;let o=`${g}/${nu(n)}`,p=nL(a[n],m,c,d,e,f,o,`${b}/${nu(h)}`);p.valid?i[n]=j[n]=!0:(k=e,ac.push({instanceLocation:g,keyword:"patternProperties",keywordLocation:b,error:`Property "${n}" matches pattern "${h}" but does not match associated schema.`},...p.errors))}}}if(k||void 0===C){if(!k&&void 0!==D){let b=`${h}/unevaluatedProperties`;for(let h in a)if(!i[h]){let j=`${g}/${nu(h)}`,k=nL(a[h],D,c,d,e,f,j,b);k.valid?i[h]=!0:ac.push({instanceLocation:g,keyword:"unevaluatedProperties",keywordLocation:b,error:`Property "${h}" does not match unevaluated properties schema.`},...k.errors)}}}else{let b=`${h}/additionalProperties`;for(let h in a){if(j[h])continue;let l=`${g}/${nu(h)}`,m=nL(a[h],C,c,d,e,f,l,b);m.valid?i[h]=!0:(k=e,ac.push({instanceLocation:g,keyword:"additionalProperties",keywordLocation:b,error:`Property "${h}" does not match additional properties schema.`},...m.errors))}}}else if("array"===j){void 0!==S&&a.length>S&&ac.push({instanceLocation:g,keyword:"maxItems",keywordLocation:`${h}/maxItems`,error:`Array has too many items (${a.length} > ${S}).`}),void 0!==R&&a.length<R&&ac.push({instanceLocation:g,keyword:"minItems",keywordLocation:`${h}/minItems`,error:`Array has too few items (${a.length} < ${R}).`});let b=a.length,j=0,k=!1;if(void 0!==K){let l=`${h}/prefixItems`,m=Math.min(K.length,b);for(;j<m;j++){let b=nL(a[j],K[j],c,d,e,f,`${g}/${j}`,`${l}/${j}`);if(i[j]=!0,!b.valid&&(k=e,ac.push({instanceLocation:g,keyword:"prefixItems",keywordLocation:l,error:"Items did not match schema."},...b.errors),k))break}}if(void 0!==L){let l=`${h}/items`;if(Array.isArray(L)){let h=Math.min(L.length,b);for(;j<h;j++){let b=nL(a[j],L[j],c,d,e,f,`${g}/${j}`,`${l}/${j}`);if(i[j]=!0,!b.valid&&(k=e,ac.push({instanceLocation:g,keyword:"items",keywordLocation:l,error:"Items did not match schema."},...b.errors),k))break}}else for(;j<b;j++){let b=nL(a[j],L,c,d,e,f,`${g}/${j}`,l);if(i[j]=!0,!b.valid&&(k=e,ac.push({instanceLocation:g,keyword:"items",keywordLocation:l,error:"Items did not match schema."},...b.errors),k))break}if(!k&&void 0!==M){let l=`${h}/additionalItems`;for(;j<b;j++){let b=nL(a[j],M,c,d,e,f,`${g}/${j}`,l);i[j]=!0,b.valid||(k=e,ac.push({instanceLocation:g,keyword:"additionalItems",keywordLocation:l,error:"Items did not match additional items schema."},...b.errors))}}}if(void 0!==O)if(0===b&&void 0===P)ac.push({instanceLocation:g,keyword:"contains",keywordLocation:`${h}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(void 0!==P&&b<P)ac.push({instanceLocation:g,keyword:"minContains",keywordLocation:`${h}/minContains`,error:`Array has less items (${b}) than minContains (${P}).`});else{let j=`${h}/contains`,k=ac.length,l=0;for(let h=0;h<b;h++){let b=nL(a[h],O,c,d,e,f,`${g}/${h}`,j);b.valid?(i[h]=!0,l++):ac.push(...b.errors)}l>=(P||0)&&(ac.length=k),void 0===P&&void 0===Q&&0===l?ac.splice(k,0,{instanceLocation:g,keyword:"contains",keywordLocation:j,error:"Array does not contain item matching schema."}):void 0!==P&&l<P?ac.push({instanceLocation:g,keyword:"minContains",keywordLocation:`${h}/minContains`,error:`Array must contain at least ${P} items matching schema. Only ${l} items were found.`}):void 0!==Q&&l>Q&&ac.push({instanceLocation:g,keyword:"maxContains",keywordLocation:`${h}/maxContains`,error:`Array may contain at most ${Q} items matching schema. ${l} items were found.`})}if(!k&&void 0!==N){let k=`${h}/unevaluatedItems`;for(;j<b;j++){if(i[j])continue;let b=nL(a[j],N,c,d,e,f,`${g}/${j}`,k);i[j]=!0,b.valid||ac.push({instanceLocation:g,keyword:"unevaluatedItems",keywordLocation:k,error:"Items did not match unevaluated items schema."},...b.errors)}}if(T)for(let c=0;c<b;c++){let d=a[c],e="object"==typeof d&&null!==d;for(let f=0;f<b;f++){if(c===f)continue;let b=a[f],i="object"==typeof b&&null!==b;(d===b||e&&i&&nt(d,b))&&(ac.push({instanceLocation:g,keyword:"uniqueItems",keywordLocation:`${h}/uniqueItems`,error:`Duplicate items at indexes ${c} and ${f}.`}),c=Number.MAX_SAFE_INTEGER,f=Number.MAX_SAFE_INTEGER)}}}else if("number"===j){if("4"===c?(void 0!==U&&(!0===W&&a<=U||a<U)&&ac.push({instanceLocation:g,keyword:"minimum",keywordLocation:`${h}/minimum`,error:`${a} is less than ${W?"or equal to ":""} ${U}.`}),void 0!==V&&(!0===X&&a>=V||a>V)&&ac.push({instanceLocation:g,keyword:"maximum",keywordLocation:`${h}/maximum`,error:`${a} is greater than ${X?"or equal to ":""} ${V}.`})):(void 0!==U&&a<U&&ac.push({instanceLocation:g,keyword:"minimum",keywordLocation:`${h}/minimum`,error:`${a} is less than ${U}.`}),void 0!==V&&a>V&&ac.push({instanceLocation:g,keyword:"maximum",keywordLocation:`${h}/maximum`,error:`${a} is greater than ${V}.`}),void 0!==W&&a<=W&&ac.push({instanceLocation:g,keyword:"exclusiveMinimum",keywordLocation:`${h}/exclusiveMinimum`,error:`${a} is less than ${W}.`}),void 0!==X&&a>=X&&ac.push({instanceLocation:g,keyword:"exclusiveMaximum",keywordLocation:`${h}/exclusiveMaximum`,error:`${a} is greater than or equal to ${X}.`})),void 0!==Y){let b=a%Y;Math.abs(0-b)>=11920929e-14&&Math.abs(Y-b)>=11920929e-14&&ac.push({instanceLocation:g,keyword:"multipleOf",keywordLocation:`${h}/multipleOf`,error:`${a} is not a multiple of ${Y}.`})}}else if("string"===j){let b=void 0===Z&&void 0===$?0:function(a){let b,c=0,d=a.length,e=0;for(;e<d;)c++,(b=a.charCodeAt(e++))>=55296&&b<=56319&&e<d&&(64512&(b=a.charCodeAt(e)))==56320&&e++;return c}(a);void 0!==Z&&b<Z&&ac.push({instanceLocation:g,keyword:"minLength",keywordLocation:`${h}/minLength`,error:`String is too short (${b} < ${Z}).`}),void 0!==$&&b>$&&ac.push({instanceLocation:g,keyword:"maxLength",keywordLocation:`${h}/maxLength`,error:`String is too long (${b} > ${$}).`}),void 0===_||RegExp(_,"u").test(a)||ac.push({instanceLocation:g,keyword:"pattern",keywordLocation:`${h}/pattern`,error:"String does not match pattern."}),void 0!==z&&nE[z]&&!nE[z](a)&&ac.push({instanceLocation:g,keyword:"format",keywordLocation:`${h}/format`,error:`String does not match format "${z}".`})}return{valid:0===ac.length,errors:ac}}(Y=br||(br={}))[Y.Flag=1]="Flag",Y[Y.Basic=2]="Basic",Y[Y.Detailed=4]="Detailed";class nM{schema;draft;shortCircuit;lookup;constructor(a,b="2019-09",c=!0){this.schema=a,this.draft=b,this.shortCircuit=c,this.lookup=nz(a)}validate(a){return nL(a,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(a,b){b&&(a={...a,$id:b}),nz(a,this.lookup)}}function nN(a){if(my(a)){let b=mX(a,!0);return mN(b)?mw(mV(b,!0)):mw(a)}return mz(a)?((a,b)=>{let c,d,e=(d=void 0!==(c="string"==typeof b?{...m_,name:b}:{...m_,...b}).name?[...c.basePath,c.definitionPath,c.name]:c.basePath,{...c,flags:{hasReferencedOpenAiAnyType:!1},currentPath:d,propertyPath:void 0,seen:new Map(Object.entries(c.definitions).map(([a,b])=>[b._def,{def:b._def,path:[...c.basePath,c.definitionPath,a],jsonSchema:void 0}]))}),f="object"==typeof b&&b.definitions?Object.entries(b.definitions).reduce((a,[b,c])=>({...a,[b]:nq(c._def,{...e,currentPath:[...e.basePath,e.definitionPath,b]},!0)??m1(e)}),{}):void 0,g="string"==typeof b?b:b?.nameStrategy==="title"?void 0:b?.name,h=nq(a._def,void 0===g?e:{...e,currentPath:[...e.basePath,e.definitionPath,g]},!1)??m1(e),i="object"==typeof b&&void 0!==b.name&&"title"===b.nameStrategy?b.name:void 0;void 0!==i&&(h.title=i),e.flags.hasReferencedOpenAiAnyType&&(f||(f={}),f[e.openAiAnyTypeName]||(f[e.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===e.$refStrategy?"1":[...e.basePath,e.definitionPath,e.openAiAnyTypeName].join("/")}}));let j=void 0===g?f?{...h,[e.definitionPath]:f}:h:{$ref:[..."relative"===e.$refStrategy?[]:e.basePath,e.definitionPath,g].join("/"),[e.definitionPath]:{...f,[g]:h}};return"jsonSchema7"===e.target?j.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===e.target||"openAi"===e.target)&&(j.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===e.target&&("anyOf"in j||"oneOf"in j||"allOf"in j||"type"in j&&Array.isArray(j.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),j})(a):a}function nO(a){if(!a||"object"!=typeof a||0===Object.keys(a).length||Array.isArray(a))return!1;if("type"in a)return"string"==typeof a.type?"string"===a.type:!!Array.isArray(a.type)&&a.type.every(a=>"string"===a);if("enum"in a)return Array.isArray(a.enum)&&a.enum.length>0&&a.enum.every(a=>"string"==typeof a);if("const"in a)return"string"==typeof a.const;if("allOf"in a&&Array.isArray(a.allOf))return a.allOf.some(a=>nO(a));if("anyOf"in a&&Array.isArray(a.anyOf)||"oneOf"in a&&Array.isArray(a.oneOf)){let b="anyOf"in a?a.anyOf:a.oneOf;return b.length>0&&b.every(a=>nO(a))}if("not"in a)return!1;if("$ref"in a&&"string"==typeof a.$ref){let b=a.$ref,c=nz(a);if(c[b])return nO(c[b])}return!1}dy({},{Validator:()=>nM,deepCompareStrict:()=>nt,toJsonSchema:()=>nN,validatesOnlyStrings:()=>nO});let nP=Object.prototype.toString,nQ=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function nR(a,b,{min:c=0,allowInfinity:d=!1}={}){if(void 0!==b){if("number"!=typeof b||Number.isNaN(b))throw TypeError(`Expected \`${a}\` to be a number${d?" or Infinity":""}.`);if(!d&&!Number.isFinite(b))throw TypeError(`Expected \`${a}\` to be a finite number.`);if(b<c)throw TypeError(`Expected \`${a}\` to be \u2265 ${c}.`)}}var nS=class extends Error{constructor(a){super(),a instanceof Error?(this.originalError=a,{message:a}=a):(this.originalError=Error(a),this.originalError.stack=this.stack),this.name="AbortError",this.message=a}};function nT(a,b){return Number.isFinite(b)?b-(performance.now()-a):b}async function nU({error:a,attemptNumber:b,retriesConsumed:c,startTime:d,options:e}){let f,g=a instanceof Error?a:TypeError(`Non-error was thrown: "${a}". You should only throw errors.`);if(g instanceof nS)throw g.originalError;let h=Number.isFinite(e.retries)?Math.max(0,e.retries-c):e.retries,i=e.maxRetryTime??1/0,j=Object.freeze({error:g,attemptNumber:b,retriesLeft:h,retriesConsumed:c});if(await e.onFailedAttempt(j),0>=nT(d,i))throw g;let k=await e.shouldConsumeRetry(j),l=nT(d,i);if(l<=0||h<=0)throw g;if(g instanceof TypeError&&!function(a){if(!(a&&"[object Error]"===nP.call(a)&&"TypeError"===a.name&&"string"==typeof a.message))return!1;let{message:b,stack:c}=a;return"Load failed"===b?void 0===c||"__sentry_captured__"in a:!!b.startsWith("error sending request for url")||nQ.has(b)}(g)){if(k)throw g;return e.signal?.throwIfAborted(),!1}if(!await e.shouldRetry(j))throw g;if(!k)return e.signal?.throwIfAborted(),!1;let m=Math.min((f=Math.max(1,c+1),Math.min(Math.round((e.randomize?Math.random()+1:1)*e.minTimeout*e.factor**(f-1)),e.maxTimeout)),l);return m>0&&await new Promise((a,b)=>{let c=()=>{clearTimeout(d),e.signal?.removeEventListener("abort",c),b(e.signal.reason)},d=setTimeout(()=>{e.signal?.removeEventListener("abort",c),a()},m);e.unref&&d.unref?.(),e.signal?.addEventListener("abort",c,{once:!0})}),e.signal?.throwIfAborted(),!0}async function nV(a,b={}){var c=(b={...b}).retries;if("number"==typeof c){if(c<0)throw TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(c))throw TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(void 0!==c)throw TypeError("Expected `retries` to be a number or Infinity.");if(Object.hasOwn(b,"forever"))throw Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");b.retries??=10,b.factor??=2,b.minTimeout??=1e3,b.maxTimeout??=1/0,b.maxRetryTime??=1/0,b.randomize??=!1,b.onFailedAttempt??=()=>{},b.shouldRetry??=()=>!0,b.shouldConsumeRetry??=()=>!0,nR("factor",b.factor,{min:0,allowInfinity:!1}),nR("minTimeout",b.minTimeout,{min:0,allowInfinity:!1}),nR("maxTimeout",b.maxTimeout,{min:0,allowInfinity:!0}),nR("maxRetryTime",b.maxRetryTime,{min:0,allowInfinity:!0}),b.factor>0||(b.factor=1),b.signal?.throwIfAborted();let d=0,e=0,f=performance.now();for(;!Number.isFinite(b.retries)||e<=b.retries;){d++;try{b.signal?.throwIfAborted();let c=await a(d);return b.signal?.throwIfAborted(),c}catch(a){await nU({error:a,attemptNumber:d,retriesConsumed:e,startTime:f,options:b})&&e++}}throw Error("Retry attempts exhausted without throwing an error.")}let nW=Object.prototype.hasOwnProperty;function nX(a,b){return nW.call(a,b)}function nY(a){if(Array.isArray(a)){let b=Array(a.length);for(let a=0;a<b.length;a++)b[a]=""+a;return b}if(Object.keys)return Object.keys(a);let b=[];for(let c in a)nX(a,c)&&b.push(c);return b}function nZ(a){switch(typeof a){case"object":return JSON.parse(JSON.stringify(a));case"undefined":return null;default:return a}}function n$(a){let b,c=0,d=a.length;for(;c<d;){if((b=a.charCodeAt(c))>=48&&b<=57){c++;continue}return!1}return!0}function n_(a){return -1===a.indexOf("/")&&-1===a.indexOf("~")?a:a.replace(/~/g,"~0").replace(/\//g,"~1")}function n0(a){return a.replace(/~1/g,"/").replace(/~0/g,"~")}function n1(a,b){let c=[a];for(let a in b){let d="object"==typeof b[a]?JSON.stringify(b[a],null,2):b[a];void 0!==d&&c.push(`${a}: ${d}`)}return c.join("\n")}var n2=class extends Error{constructor(a,b,c,d,e){super(n1(a,{name:b,index:c,operation:d,tree:e})),this.name=b,this.index=c,this.operation=d,this.tree=e,Object.setPrototypeOf(this,new.target.prototype),this.message=n1(a,{name:b,index:c,operation:d,tree:e})}},n3={};dy(n3,{JsonPatchError:()=>n4,_areEquals:()=>oe,applyOperation:()=>n9,applyPatch:()=>oa,applyReducer:()=>ob,deepClone:()=>n5,getValueByPointer:()=>n8,validate:()=>od,validator:()=>oc});let n4=n2,n5=nZ,n6={add:function(a,b,c){return a[b]=this.value,{newDocument:c}},remove:function(a,b,c){var d=a[b];return delete a[b],{newDocument:c,removed:d}},replace:function(a,b,c){var d=a[b];return a[b]=this.value,{newDocument:c,removed:d}},move:function(a,b,c){let d=n8(c,this.path);d&&(d=nZ(d));let e=n9(c,{op:"remove",path:this.from}).removed;return n9(c,{op:"add",path:this.path,value:e}),{newDocument:c,removed:d}},copy:function(a,b,c){let d=n8(c,this.from);return n9(c,{op:"add",path:this.path,value:nZ(d)}),{newDocument:c}},test:function(a,b,c){return{newDocument:c,test:oe(a[b],this.value)}},_get:function(a,b,c){return this.value=a[b],{newDocument:c}}};var n7={add:function(a,b,c){return n$(b)?a.splice(b,0,this.value):a[b]=this.value,{newDocument:c,index:b}},remove:function(a,b,c){return{newDocument:c,removed:a.splice(b,1)[0]}},replace:function(a,b,c){var d=a[b];return a[b]=this.value,{newDocument:c,removed:d}},move:n6.move,copy:n6.copy,test:n6.test,_get:n6._get};function n8(a,b){if(""==b)return a;var c={op:"_get",path:b};return n9(a,c),c.value}function n9(a,b,c=!1,d=!0,e=!0,f=0){if(c&&("function"==typeof c?c(b,0,a,b.path):oc(b,0)),""===b.path){let d={newDocument:a};if("add"===b.op)return d.newDocument=b.value,d;if("replace"===b.op)return d.newDocument=b.value,d.removed=a,d;if("move"===b.op||"copy"===b.op)return d.newDocument=n8(a,b.from),"move"===b.op&&(d.removed=a),d;else if("test"===b.op){if(d.test=oe(a,b.value),!1===d.test)throw new n4("Test operation failed","TEST_OPERATION_FAILED",f,b,a);return d.newDocument=a,d}else if("remove"===b.op)return d.removed=a,d.newDocument=null,d;else if("_get"===b.op)return b.value=a,d;else if(!c)return d;else throw new n4("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",f,b,a)}{let g,h,i;d||(a=nZ(a));let j=(b.path||"").split("/"),k=a,l=1,m=j.length;for(h="function"==typeof c?c:oc;;){if((g=j[l])&&-1!=g.indexOf("~")&&(g=n0(g)),e&&("__proto__"==g||"prototype"==g&&l>0&&"constructor"==j[l-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(c&&void 0===i&&(void 0===k[g]?i=j.slice(0,l).join("/"):l==m-1&&(i=b.path),void 0!==i&&h(b,0,a,i)),l++,Array.isArray(k)){if("-"===g)g=k.length;else if(c&&!n$(g))throw new n4("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",f,b,a);else n$(g)&&(g=~~g);if(l>=m){if(c&&"add"===b.op&&g>k.length)throw new n4("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",f,b,a);let d=n7[b.op].call(b,k,g,a);if(!1===d.test)throw new n4("Test operation failed","TEST_OPERATION_FAILED",f,b,a);return d}}else if(l>=m){let c=n6[b.op].call(b,k,g,a);if(!1===c.test)throw new n4("Test operation failed","TEST_OPERATION_FAILED",f,b,a);return c}if(k=k[g],c&&l<m&&(!k||"object"!=typeof k))throw new n4("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",f,b,a)}}}function oa(a,b,c,d=!0,e=!0){if(c&&!Array.isArray(b))throw new n4("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");d||(a=nZ(a));let f=Array(b.length);for(let d=0,g=b.length;d<g;d++)f[d]=n9(a,b[d],c,!0,e,d),a=f[d].newDocument;return f.newDocument=a,f}function ob(a,b,c){let d=n9(a,b);if(!1===d.test)throw new n4("Test operation failed","TEST_OPERATION_FAILED",c,b,a);return d.newDocument}function oc(a,b,c,d){if("object"!=typeof a||null===a||Array.isArray(a))throw new n4("Operation is not an object","OPERATION_NOT_AN_OBJECT",b,a,c);if(n6[a.op]){if("string"!=typeof a.path)throw new n4("Operation `path` property is not a string","OPERATION_PATH_INVALID",b,a,c);else if(0!==a.path.indexOf("/")&&a.path.length>0)throw new n4('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",b,a,c);else if(("move"===a.op||"copy"===a.op)&&"string"!=typeof a.from)throw new n4("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",b,a,c);else if(("add"===a.op||"replace"===a.op||"test"===a.op)&&void 0===a.value)throw new n4("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",b,a,c);else if(("add"===a.op||"replace"===a.op||"test"===a.op)&&function a(b){if(void 0===b)return!0;if(b){if(Array.isArray(b)){for(let c=0,d=b.length;c<d;c++)if(a(b[c]))return!0}else if("object"==typeof b){let d=nY(b),e=d.length;for(var c=0;c<e;c++)if(a(b[d[c]]))return!0}}return!1}(a.value))throw new n4("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",b,a,c);else if(c){if("add"==a.op){var e=a.path.split("/").length,f=d.split("/").length;if(e!==f+1&&e!==f)throw new n4("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",b,a,c)}else if("replace"===a.op||"remove"===a.op||"_get"===a.op){if(a.path!==d)throw new n4("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",b,a,c)}else if("move"===a.op||"copy"===a.op){var g=od([{op:"_get",path:a.from,value:void 0}],c);if(g&&"OPERATION_PATH_UNRESOLVABLE"===g.name)throw new n4("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",b,a,c)}}}else throw new n4("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",b,a,c)}function od(a,b,c){try{if(!Array.isArray(a))throw new n4("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(b)oa(nZ(b),nZ(a),c||!0);else{c=c||oc;for(var d=0;d<a.length;d++)c(a[d],d,b,void 0)}}catch(a){if(a instanceof n4)return a;throw a}}function oe(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){var c,d,e,f=Array.isArray(a),g=Array.isArray(b);if(f&&g){if((d=a.length)!=b.length)return!1;for(c=d;0!=c--;)if(!oe(a[c],b[c]))return!1;return!0}if(f!=g)return!1;var h=Object.keys(a);if((d=h.length)!==Object.keys(b).length)return!1;for(c=d;0!=c--;)if(!b.hasOwnProperty(h[c]))return!1;for(c=d;0!=c--;)if(!oe(a[e=h[c]],b[e]))return!1;return!0}return a!=a&&b!=b}function of(a,b,c=!1){var d=[];return!function a(b,c,d,e,f){if(c!==b){"function"==typeof c.toJSON&&(c=c.toJSON());for(var g=nY(c),h=nY(b),i=!1,j=h.length-1;j>=0;j--){var k=h[j],l=b[k];if(nX(c,k)&&(void 0!==c[k]||void 0===l||!1!==Array.isArray(c))){var m=c[k];"object"==typeof l&&null!=l&&"object"==typeof m&&null!=m&&Array.isArray(l)===Array.isArray(m)?a(l,m,d,e+"/"+n_(k),f):l!==m&&(f&&d.push({op:"test",path:e+"/"+n_(k),value:nZ(l)}),d.push({op:"replace",path:e+"/"+n_(k),value:nZ(m)}))}else Array.isArray(b)===Array.isArray(c)?(f&&d.push({op:"test",path:e+"/"+n_(k),value:nZ(l)}),d.push({op:"remove",path:e+"/"+n_(k)}),i=!0):(f&&d.push({op:"test",path:e,value:b}),d.push({op:"replace",path:e,value:c}))}if(i||g.length!=h.length)for(var j=0;j<g.length;j++){var k=g[j];nX(b,k)||void 0===c[k]||d.push({op:"add",path:e+"/"+n_(k),value:nZ(c[k])})}}}(a,b,d,"",c),d}({...n3,JsonPatchError:n2,deepClone:nZ,escapePathComponent:n_,unescapePathComponent:n0}),dy({},{LogStreamCallbackHandler:()=>ol,RunLog:()=>oh,RunLogPatch:()=>og,isLogStreamHandler:()=>oi});var og=class{ops;constructor(a){this.ops=a.ops??[]}concat(a){let b=this.ops.concat(a.ops),c=oa({},b);return new oh({ops:b,state:c[c.length-1].newDocument})}},oh=class a extends og{state;constructor(a){super(a),this.state=a.state}concat(b){let c=this.ops.concat(b.ops),d=oa(this.state,b.ops);return new a({ops:c,state:d[d.length-1].newDocument})}static fromRunLogPatch(b){let c=oa({},b.ops);return new a({ops:b.ops,state:c[c.length-1].newDocument})}};let oi=a=>"log_stream_tracer"===a.name;async function oj(a,b){if("original"===b)throw Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:c}=a;return["retriever","llm","prompt"].includes(a.run_type)?c:1!==Object.keys(c).length||c?.input!==""?c.input:void 0}async function ok(a,b){let{outputs:c}=a;return"original"===b||["retriever","llm","prompt"].includes(a.run_type)?c:void 0!==c&&1===Object.keys(c).length&&c?.output!==void 0?c.output:c}var ol=class extends gm{autoClose=!0;includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;_schemaFormat="original";rootId;keyMapByRunId={};counterMapByRunName={};transformStream;writer;receiveStream;name="log_stream_tracer";lc_prefer_streaming=!0;constructor(a){super({_awaitHandler:!0,...a}),this.autoClose=a?.autoClose??!0,this.includeNames=a?.includeNames,this.includeTypes=a?.includeTypes,this.includeTags=a?.includeTags,this.excludeNames=a?.excludeNames,this.excludeTypes=a?.excludeTypes,this.excludeTags=a?.excludeTags,this._schemaFormat=a?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ha.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(a){}_includeRun(a){if(a.id===this.rootId)return!1;let b=a.tags??[],c=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(c=c||this.includeNames.includes(a.name)),void 0!==this.includeTypes&&(c=c||this.includeTypes.includes(a.run_type)),void 0!==this.includeTags&&(c=c||void 0!==b.find(a=>this.includeTags?.includes(a))),void 0!==this.excludeNames&&(c=c&&!this.excludeNames.includes(a.name)),void 0!==this.excludeTypes&&(c=c&&!this.excludeTypes.includes(a.run_type)),void 0!==this.excludeTags&&(c=c&&b.every(a=>!this.excludeTags?.includes(a))),c}async *tapOutputIterable(a,b){for await(let c of b){if(a!==this.rootId){let b=this.keyMapByRunId[a];b&&await this.writer.write(new og({ops:[{op:"add",path:`/logs/${b}/streamed_output/-`,value:c}]}))}yield c}}async onRunCreate(a){if(void 0===this.rootId&&(this.rootId=a.id,await this.writer.write(new og({ops:[{op:"replace",path:"",value:{id:a.id,name:a.name,type:a.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(a))return;void 0===this.counterMapByRunName[a.name]&&(this.counterMapByRunName[a.name]=0),this.counterMapByRunName[a.name]+=1;let b=this.counterMapByRunName[a.name];this.keyMapByRunId[a.id]=1===b?a.name:`${a.name}:${b}`;let c={id:a.id,name:a.name,type:a.run_type,tags:a.tags??[],metadata:a.extra?.metadata??{},start_time:new Date(a.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(c.inputs=await oj(a,this._schemaFormat)),await this.writer.write(new og({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[a.id]}`,value:c}]}))}async onRunUpdate(a){try{let b=this.keyMapByRunId[a.id];if(void 0===b)return;let c=[];"streaming_events"===this._schemaFormat&&c.push({op:"replace",path:`/logs/${b}/inputs`,value:await oj(a,this._schemaFormat)}),c.push({op:"add",path:`/logs/${b}/final_output`,value:await ok(a,this._schemaFormat)}),void 0!==a.end_time&&c.push({op:"add",path:`/logs/${b}/end_time`,value:new Date(a.end_time).toISOString()});let d=new og({ops:c});await this.writer.write(d)}finally{if(a.id===this.rootId){let b=new og({ops:[{op:"replace",path:"/final_output",value:await ok(a,this._schemaFormat)}]});await this.writer.write(b),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(a,b,c){let d,e=this.keyMapByRunId[a.id];if(void 0===e)return;if(void 0!==a.inputs.messages){var f;d=void 0!==(f=c?.chunk)&&void 0!==f.message?c?.chunk:new eZ({id:`run-${a.id}`,content:b})}else d=b;let g=new og({ops:[{op:"add",path:`/logs/${e}/streamed_output_str/-`,value:b},{op:"add",path:`/logs/${e}/streamed_output/-`,value:d}]});await this.writer.write(g)}};function om({name:a,serialized:b}){return void 0!==a?a:b?.name!==void 0?b.name:b?.id!==void 0&&Array.isArray(b?.id)?b.id[b.id.length-1]:"Unnamed"}let on=a=>"event_stream_tracer"===a.name;var oo=class extends gm{autoClose=!0;includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;runInfoMap=new Map;tappedPromises=new Map;transformStream;writer;receiveStream;name="event_stream_tracer";lc_prefer_streaming=!0;constructor(a){super({_awaitHandler:!0,...a}),this.autoClose=a?.autoClose??!0,this.includeNames=a?.includeNames,this.includeTypes=a?.includeTypes,this.includeTags=a?.includeTags,this.excludeNames=a?.excludeNames,this.excludeTypes=a?.excludeTypes,this.excludeTags=a?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ha.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(a){}_includeRun(a){let b=a.tags??[],c=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(c=c||this.includeNames.includes(a.name)),void 0!==this.includeTypes&&(c=c||this.includeTypes.includes(a.runType)),void 0!==this.includeTags&&(c=c||void 0!==b.find(a=>this.includeTags?.includes(a))),void 0!==this.excludeNames&&(c=c&&!this.excludeNames.includes(a.name)),void 0!==this.excludeTypes&&(c=c&&!this.excludeTypes.includes(a.runType)),void 0!==this.excludeTags&&(c=c&&b.every(a=>!this.excludeTags?.includes(a))),c}async *tapOutputIterable(a,b){let c=await b.next();if(c.done)return;let d=this.runInfoMap.get(a);if(void 0===d)return void(yield c.value);function e(a,b){return"llm"===a&&"string"==typeof b?new hg({text:b}):b}let f=this.tappedPromises.get(a);if(void 0===f){let g;f=new Promise(a=>{g=a}),this.tappedPromises.set(a,f);try{let f={event:`on_${d.runType}_stream`,run_id:a,name:d.name,tags:d.tags,metadata:d.metadata,data:{}};for await(let a of(await this.send({...f,data:{chunk:e(d.runType,c.value)}},d),yield c.value,b))"tool"!==d.runType&&"retriever"!==d.runType&&await this.send({...f,data:{chunk:e(d.runType,a)}},d),yield a}finally{g?.()}}else for await(let a of(yield c.value,b))yield a}async send(a,b){this._includeRun(b)&&await this.writer.write(a)}async sendEndEvent(a,b){let c=this.tappedPromises.get(a.run_id);void 0!==c?c.then(()=>{this.send(a,b)}):await this.send(a,b)}async onLLMStart(a){let b=om(a),c=void 0!==a.inputs.messages?"chat_model":"llm",d={tags:a.tags??[],metadata:a.extra?.metadata??{},name:b,runType:c,inputs:a.inputs};this.runInfoMap.set(a.id,d);let e=`on_${c}_start`;await this.send({event:e,data:{input:a.inputs},name:b,tags:a.tags??[],run_id:a.id,metadata:a.extra?.metadata??{}},d)}async onLLMNewToken(a,b,c){let d,e,f=this.runInfoMap.get(a.id);if(void 0===f)throw Error(`onLLMNewToken: Run ID ${a.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===f.runType)e="on_chat_model_stream",d=c?.chunk===void 0?new eZ({content:b,id:`run-${a.id}`}):c.chunk.message;else if("llm"===f.runType)e="on_llm_stream",d=c?.chunk===void 0?new hg({text:b}):c.chunk;else throw Error(`Unexpected run type ${f.runType}`);await this.send({event:e,data:{chunk:d},run_id:a.id,name:f.name,tags:f.tags,metadata:f.metadata},f)}}async onLLMEnd(a){let b,c,d=this.runInfoMap.get(a.id);if(this.runInfoMap.delete(a.id),void 0===d)throw Error(`onLLMEnd: Run ID ${a.id} not found in run map.`);let e=a.outputs?.generations;if("chat_model"===d.runType){for(let a of e??[]){if(void 0!==c)break;c=a[0]?.message}b="on_chat_model_end"}else if("llm"===d.runType)c={generations:e?.map(a=>a.map(a=>({text:a.text,generationInfo:a.generationInfo}))),llmOutput:a.outputs?.llmOutput??{}},b="on_llm_end";else throw Error(`onLLMEnd: Unexpected run type: ${d.runType}`);await this.sendEndEvent({event:b,data:{output:c,input:d.inputs},run_id:a.id,name:d.name,tags:d.tags,metadata:d.metadata},d)}async onChainStart(a){let b=om(a),c=a.run_type??"chain",d={tags:a.tags??[],metadata:a.extra?.metadata??{},name:b,runType:a.run_type},e={};""===a.inputs.input&&1===Object.keys(a.inputs).length?(e={},d.inputs={}):void 0!==a.inputs.input?(e.input=a.inputs.input,d.inputs=a.inputs.input):(e.input=a.inputs,d.inputs=a.inputs),this.runInfoMap.set(a.id,d),await this.send({event:`on_${c}_start`,data:e,name:b,tags:a.tags??[],run_id:a.id,metadata:a.extra?.metadata??{}},d)}async onChainEnd(a){let b=this.runInfoMap.get(a.id);if(this.runInfoMap.delete(a.id),void 0===b)throw Error(`onChainEnd: Run ID ${a.id} not found in run map.`);let c=`on_${a.run_type}_end`,d=a.inputs??b.inputs??{},e={output:a.outputs?.output??a.outputs,input:d};d.input&&1===Object.keys(d).length&&(e.input=d.input,b.inputs=d.input),await this.sendEndEvent({event:c,data:e,run_id:a.id,name:b.name,tags:b.tags,metadata:b.metadata??{}},b)}async onToolStart(a){let b=om(a),c={tags:a.tags??[],metadata:a.extra?.metadata??{},name:b,runType:"tool",inputs:a.inputs??{}};this.runInfoMap.set(a.id,c),await this.send({event:"on_tool_start",data:{input:a.inputs??{}},name:b,run_id:a.id,tags:a.tags??[],metadata:a.extra?.metadata??{}},c)}async onToolEnd(a){let b=this.runInfoMap.get(a.id);if(this.runInfoMap.delete(a.id),void 0===b)throw Error(`onToolEnd: Run ID ${a.id} not found in run map.`);if(void 0===b.inputs)throw Error(`onToolEnd: Run ID ${a.id} is a tool call, and is expected to have traced inputs.`);let c=a.outputs?.output===void 0?a.outputs:a.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:c,input:b.inputs},run_id:a.id,name:b.name,tags:b.tags,metadata:b.metadata},b)}async onRetrieverStart(a){let b=om(a),c={tags:a.tags??[],metadata:a.extra?.metadata??{},name:b,runType:"retriever",inputs:{query:a.inputs.query}};this.runInfoMap.set(a.id,c),await this.send({event:"on_retriever_start",data:{input:{query:a.inputs.query}},name:b,tags:a.tags??[],run_id:a.id,metadata:a.extra?.metadata??{}},c)}async onRetrieverEnd(a){let b=this.runInfoMap.get(a.id);if(this.runInfoMap.delete(a.id),void 0===b)throw Error(`onRetrieverEnd: Run ID ${a.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:a.outputs?.documents??a.outputs,input:b.inputs},run_id:a.id,name:b.name,tags:b.tags,metadata:b.metadata},b)}async handleCustomEvent(a,b,c){let d=this.runInfoMap.get(c);if(void 0===d)throw Error(`handleCustomEvent: Run ID ${c} not found in run map.`);await this.send({event:"on_custom_event",run_id:c,name:a,tags:d.tags,metadata:d.metadata,data:b},d)}async finish(){Promise.all([...this.tappedPromises.values()]).finally(()=>{this.writer.close()})}};dy({},{AsyncCaller:()=>or});let op=[400,401,402,403,404,405,406,407,409],oq=a=>{if(a.message.startsWith("Cancel")||a.message.startsWith("AbortError")||"AbortError"===a.name||a?.code==="ECONNABORTED")throw a;let b=a?.response?.status??a?.status;if(b&&op.includes(+b))throw a;if(a?.error?.code==="insufficient_quota"){let b=Error(a?.message);throw b.name="InsufficientQuotaError",b}};var or=class{maxConcurrency;maxRetries;onFailedAttempt;queue;constructor(a){this.maxConcurrency=a.maxConcurrency??1/0,this.maxRetries=a.maxRetries??6,this.onFailedAttempt=a.onFailedAttempt??oq;const b="default"in gM?gM.default:gM;this.queue=new b({concurrency:this.maxConcurrency})}async call(a,...b){return this.queue.add(()=>nV(()=>a(...b).catch(a=>{if(a instanceof Error)throw a;throw Error(a)}),{onFailedAttempt:({error:a})=>this.onFailedAttempt?.(a),retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(a,b,...c){if(a.signal){let d;return Promise.race([this.call(b,...c),new Promise((b,c)=>{d=()=>{c(g9(a.signal))},a.signal?.addEventListener("abort",d)})]).finally(()=>{a.signal&&d&&a.signal.removeEventListener("abort",d)})}return this.call(b,...c)}fetch(...a){return this.call(()=>fetch(...a).then(a=>a.ok?a:Promise.reject(a)))}},os=class extends gm{name="RootListenersTracer";rootId;config;argOnStart;argOnEnd;argOnError;constructor({config:a,onStart:b,onEnd:c,onError:d}){super({_awaitHandler:!0}),this.config=a,this.argOnStart=b,this.argOnEnd=c,this.argOnError=d}persistRun(a){return Promise.resolve()}async onRunCreate(a){!this.rootId&&(this.rootId=a.id,this.argOnStart&&await this.argOnStart(a,this.config))}async onRunUpdate(a){a.id===this.rootId&&(a.error?this.argOnError&&await this.argOnError(a,this.config):this.argOnEnd&&await this.argOnEnd(a,this.config))}};function ot(a){return!!a&&a.lc_runnable}var ou=class{includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;constructor(a){this.includeNames=a.includeNames,this.includeTypes=a.includeTypes,this.includeTags=a.includeTags,this.excludeNames=a.excludeNames,this.excludeTypes=a.excludeTypes,this.excludeTags=a.excludeTags}includeEvent(a,b){let c=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags,d=a.tags??[];return void 0!==this.includeNames&&(c=c||this.includeNames.includes(a.name)),void 0!==this.includeTypes&&(c=c||this.includeTypes.includes(b)),void 0!==this.includeTags&&(c=c||d.some(a=>this.includeTags?.includes(a))),void 0!==this.excludeNames&&(c=c&&!this.excludeNames.includes(a.name)),void 0!==this.excludeTypes&&(c=c&&!this.excludeTypes.includes(b)),void 0!==this.excludeTags&&(c=c&&d.every(a=>!this.excludeTags?.includes(a))),c}};function ov(a){return a.replace(/[^a-zA-Z-_0-9]/g,"_")}let ow=["*","_","`"];async function ox(a,b){let c=b?.backgroundColor??"white",d=b?.imageType??"png",e=btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");void 0!==c&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(c)||(c=`!${c}`));let f=`https://mermaid.ink/img/${e}?bgColor=${c}&type=${d}`,g=await fetch(f);if(!g.ok)throw Error(`Failed to render the graph using the Mermaid.INK API.
Status code: ${g.status}
Status text: ${g.statusText}`);return await g.blob()}dy({},{Graph:()=>oy});var oy=class a{nodes={};edges=[];constructor(a){this.nodes=a?.nodes??this.nodes,this.edges=a?.edges??this.edges}toJSON(){let a={};return Object.values(this.nodes).forEach((b,c)=>{a[b.id]=fd(b.id)?c:b.id}),{nodes:Object.values(this.nodes).map(b=>({id:a[b.id],...ot(b.data)?{type:"runnable",data:{id:b.data.lc_id,name:b.data.getName()}}:{type:"schema",data:{...nN(b.data.schema),title:b.data.name}}})),edges:this.edges.map(b=>{let c={source:a[b.source],target:a[b.target]};return void 0!==b.data&&(c.data=b.data),void 0!==b.conditional&&(c.conditional=b.conditional),c})}}addNode(a,b,c){if(void 0!==b&&void 0!==this.nodes[b])throw Error(`Node with id ${b} already exists`);let d=b??fg(),e={id:d,data:a,name:function(a,b){if(void 0!==a&&!fd(a))return a;if(!ot(b))return b.name??"UnknownSchema";try{let a=b.getName();return a=a.startsWith("Runnable")?a.slice(8):a}catch{return b.getName()}}(b,a),metadata:c};return this.nodes[d]=e,e}removeNode(a){delete this.nodes[a.id],this.edges=this.edges.filter(b=>b.source!==a.id&&b.target!==a.id)}addEdge(a,b,c,d){if(void 0===this.nodes[a.id])throw Error(`Source node ${a.id} not in graph`);if(void 0===this.nodes[b.id])throw Error(`Target node ${b.id} not in graph`);let e={source:a.id,target:b.id,data:c,conditional:d};return this.edges.push(e),e}firstNode(){return oz(this)}lastNode(){return oA(this)}extend(a,b=""){let c=b;Object.values(a.nodes).map(a=>a.id).every(fd)&&(c="");let d=a=>c?`${c}:${a}`:a;Object.entries(a.nodes).forEach(([a,b])=>{this.nodes[d(a)]={...b,id:d(a)}});let e=a.edges.map(a=>({...a,source:d(a.source),target:d(a.target)}));this.edges=[...this.edges,...e];let f=a.firstNode(),g=a.lastNode();return[f?{id:d(f.id),data:f.data}:void 0,g?{id:d(g.id),data:g.data}:void 0]}trimFirstNode(){let a=this.firstNode();a&&oz(this,[a.id])&&this.removeNode(a)}trimLastNode(){let a=this.lastNode();a&&oA(this,[a.id])&&this.removeNode(a)}reid(){let b=Object.fromEntries(Object.values(this.nodes).map(a=>[a.id,a.name])),c=new Map;Object.values(b).forEach(a=>{c.set(a,(c.get(a)||0)+1)});let d=a=>{let d=b[a];return fd(a)&&1===c.get(d)?d:a};return new a({nodes:Object.fromEntries(Object.entries(this.nodes).map(([a,b])=>[d(a),{...b,id:d(a)}])),edges:this.edges.map(a=>({...a,source:d(a.source),target:d(a.target)}))})}drawMermaid(a){let{withStyles:b,curveStyle:c,nodeColors:d={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:e}=a??{},f=this.reid(),g=f.firstNode(),h=f.lastNode();return function(a,b,c){let{firstNode:d,lastNode:e,nodeColors:f,withStyles:g=!0,curveStyle:h="linear",wrapLabelNWords:i=9}=c??{},j=g?`%%{init: {'flowchart': {'curve': '${h}'}}}%%
graph TD;
`:"graph TD;\n";if(g){let b="default",c={[b]:"{0}({1})"};for(let[f,g]of(void 0!==d&&(c[d]="{0}([{1}]):::first"),void 0!==e&&(c[e]="{0}([{1}]):::last"),Object.entries(a))){let a=g.name.split(":").pop()??"",d=ow.some(b=>a.startsWith(b)&&a.endsWith(b))?`<p>${a}</p>`:a;Object.keys(g.metadata??{}).length&&(d+=`<hr/><small><em>${Object.entries(g.metadata??{}).map(([a,b])=>`${a} = ${b}`).join("\n")}</em></small>`);let e=(c[f]??c[b]).replace("{0}",ov(f)).replace("{1}",d);j+=`	${e}
`}}let k={};for(let a of b){let b=a.source.split(":"),c=a.target.split(":"),d=b.filter((a,b)=>a===c[b]).join(":");k[d]||(k[d]=[]),k[d].push(a)}let l=new Set;function m(a,b){let c=1===a.length&&a[0].source===a[0].target;if(b&&!c){let a=b.split(":").pop();if(l.has(a))throw Error(`Found duplicate subgraph '${a}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);l.add(a),j+=`	subgraph ${a}
`}for(let b of a){let{source:a,target:c,data:d,conditional:e}=b,f="";if(void 0!==d){let a=d,b=a.split(" ");b.length>i&&(a=Array.from({length:Math.ceil(b.length/i)},(a,c)=>b.slice(c*i,(c+1)*i).join(" ")).join("&nbsp;<br>&nbsp;")),f=e?` -. &nbsp;${a}&nbsp; .-> `:` -- &nbsp;${a}&nbsp; --> `}else f=e?" -.-> ":" --> ";j+=`	${ov(a)}${f}${ov(c)};
`}for(let a in k)a.startsWith(`${b}:`)&&a!==b&&m(k[a],a);b&&!c&&(j+="	end\n")}for(let a in m(k[""]??[],""),k)a.includes(":")||""===a||m(k[a],a);return g&&(j+=function(a){let b="";for(let[c,d]of Object.entries(a))b+=`	classDef ${c} ${d};
`;return b}(f??{})),j}(f.nodes,f.edges,{firstNode:g?.id,lastNode:h?.id,withStyles:b,curveStyle:c,nodeColors:d,wrapLabelNWords:e})}async drawMermaidPng(a){return ox(this.drawMermaid(a),{backgroundColor:a?.backgroundColor})}};function oz(a,b=[]){let c=new Set(a.edges.filter(a=>!b.includes(a.source)).map(a=>a.target)),d=[];for(let e of Object.values(a.nodes))b.includes(e.id)||c.has(e.id)||d.push(e);return 1===d.length?d[0]:void 0}function oA(a,b=[]){let c=new Set(a.edges.filter(a=>!b.includes(a.target)).map(a=>a.source)),d=[];for(let e of Object.values(a.nodes))b.includes(e.id)||c.has(e.id)||d.push(e);return 1===d.length?d[0]:void 0}function oB(a){return"object"==typeof a&&null!==a&&"function"==typeof a[Symbol.iterator]&&"function"==typeof a.next}function oC(a){return"object"==typeof a&&null!==a&&"function"==typeof a[Symbol.asyncIterator]}function*oD(a,b){for(;;){let{value:c,done:d}=g1.runWithConfig(g7(a),b.next.bind(b),!0);if(d)break;yield c}}async function*oE(a,b){let c=b[Symbol.asyncIterator]();for(;;){let{value:d,done:e}=await g1.runWithConfig(g7(a),c.next.bind(b),!0);if(e)break;yield d}}var oF=a.i(647727);function oG(a,b){return!a||Array.isArray(a)||a instanceof Date||"object"!=typeof a?{[b]:a}:a}var oH=class extends dU{lc_runnable=!0;name;getName(a){let b=this.name??this.constructor.lc_name()??this.constructor.name;return a?`${b}${a}`:b}withRetry(a){return new oK({bound:this,kwargs:{},config:{},maxAttemptNumber:a?.stopAfterAttempt,...a})}withConfig(a){return new oI({bound:this,config:a,kwargs:{}})}withFallbacks(a){return new oQ({runnable:this,fallbacks:Array.isArray(a)?a:a.fallbacks})}_getOptionsList(a,b=0){if(Array.isArray(a)&&a.length!==b)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${a.length} options for ${b} inputs`);if(Array.isArray(a))return a.map(g5);if(b>1&&!Array.isArray(a)&&a.runId){console.warn("Provided runId will be used only for the first element of the batch.");let c=Object.fromEntries(Object.entries(a).filter(([a])=>"runId"!==a));return Array.from({length:b},(b,d)=>g5(0===d?a:c))}return Array.from({length:b},()=>g5(a))}async batch(a,b,c){let d=this._getOptionsList(b??{},a.length),e=new or({maxConcurrency:d[0]?.maxConcurrency??c?.maxConcurrency,onFailedAttempt:a=>{throw a}});return Promise.all(a.map((a,b)=>e.call(async()=>{try{return await this.invoke(a,d[b])}catch(a){if(c?.returnExceptions)return a;throw a}})))}async *_streamIterator(a,b){yield this.invoke(a,b)}async stream(a,b){let c=g5(b),d=new hd({generator:this._streamIterator(a,c),config:c});return await d.setup,ha.fromAsyncGenerator(d)}_separateRunnableConfigFromCallOptions(a){let b;b=void 0===a?g5(a):g5({callbacks:a.callbacks,tags:a.tags,metadata:a.metadata,runName:a.runName,configurable:a.configurable,recursionLimit:a.recursionLimit,maxConcurrency:a.maxConcurrency,runId:a.runId,timeout:a.timeout,signal:a.signal});let c={...a};return delete c.callbacks,delete c.tags,delete c.metadata,delete c.runName,delete c.configurable,delete c.recursionLimit,delete c.maxConcurrency,delete c.runId,delete c.timeout,delete c.signal,[b,c]}async _callWithConfig(a,b,c){let d,e=g5(c),f=await g2(e),g=await f?.handleChainStart(this.toJSON(),oG(b,"input"),e.runId,e?.runType,void 0,void 0,e?.runName??this.getName());delete e.runId;try{let f=a.call(this,b,e,g);d=await g8(f,c?.signal)}catch(a){throw await g?.handleChainError(a),a}return await g?.handleChainEnd(oG(d,"output")),d}async _batchWithConfig(a,b,c,d){let e,f=this._getOptionsList(c??{},b.length),g=await Promise.all(f.map(g2)),h=await Promise.all(g.map(async(a,c)=>{let d=await a?.handleChainStart(this.toJSON(),oG(b[c],"input"),f[c].runId,f[c].runType,void 0,void 0,f[c].runName??this.getName());return delete f[c].runId,d}));try{let c=a.call(this,b,f,h,d);e=await g8(c,f?.[0]?.signal)}catch(a){throw await Promise.all(h.map(b=>b?.handleChainError(a))),a}return await Promise.all(h.map(a=>a?.handleChainEnd(oG(e,"output")))),e}_concatOutputChunks(a,b){return hc(a,b)}async *_transformStreamWithConfig(a,b,c){let d,e,f,g=!0,h=!0,i=g5(c),j=await g2(i),k=this;async function*l(){for await(let b of a){if(g)if(void 0===d)d=b;else try{d=k._concatOutputChunks(d,b)}catch{d=void 0,g=!1}yield b}}try{let a=await he(b.bind(this),l(),async()=>j?.handleChainStart(this.toJSON(),{input:""},i.runId,i.runType,void 0,void 0,i.runName??this.getName()),c?.signal,i);delete i.runId,f=a.setup;let d=f?.handlers.find(on),g=a.output;void 0!==d&&void 0!==f&&(g=d.tapOutputIterable(f.runId,g));let k=f?.handlers.find(oi);for await(let a of(void 0!==k&&void 0!==f&&(g=k.tapOutputIterable(f.runId,g)),g))if(yield a,h)if(void 0===e)e=a;else try{e=this._concatOutputChunks(e,a)}catch{e=void 0,h=!1}}catch(a){throw await f?.handleChainError(a,void 0,void 0,void 0,{inputs:oG(d,"input")}),a}await f?.handleChainEnd(e??{},void 0,void 0,void 0,{inputs:oG(d,"input")})}getGraph(a){let b=new oy,c=b.addNode({name:`${this.getName()}Input`,schema:oF.z.any()}),d=b.addNode(this),e=b.addNode({name:`${this.getName()}Output`,schema:oF.z.any()});return b.addEdge(c,d),b.addEdge(d,e),b}pipe(a){return new oL({first:this,last:oR(a)})}pick(a){return this.pipe(new oT(a))}assign(a){return this.pipe(new oS(new oM({steps:a})))}async *transform(a,b){let c;for await(let b of a)c=void 0===c?b:this._concatOutputChunks(c,b);yield*this._streamIterator(c,g5(b))}async *streamLog(a,b,c){let d=new ol({...c,autoClose:!1,_schemaFormat:"original"}),e=g5(b);yield*this._streamLog(a,d,e)}async *_streamLog(a,b,c){let{callbacks:d}=c;if(void 0===d)c.callbacks=[b];else if(Array.isArray(d))c.callbacks=d.concat([b]);else{let a=d.copy();a.addHandler(b,!0),c.callbacks=a}let e=this.stream(a,c),f=async function(){try{for await(let a of(await e)){let c=new og({ops:[{op:"add",path:"/streamed_output/-",value:a}]});await b.writer.write(c)}}finally{await b.writer.close()}}();try{for await(let a of b)yield a}finally{await f}}streamEvents(a,b,c){var d;let e,f,g;if("v1"===b.version)e=this._streamEventsV1(a,b,c);else if("v2"===b.version)e=this._streamEventsV2(a,b,c);else throw Error('Only versions "v1" and "v2" of the schema are currently supported.');if("text/event-stream"!==b.encoding)return ha.fromAsyncGenerator(e);return d=e,f=new TextEncoder,g=new ReadableStream({async start(a){for await(let b of d)a.enqueue(f.encode(`event: data
data: ${JSON.stringify(b)}

`));a.enqueue(f.encode("event: end\n\n")),a.close()}}),ha.fromReadableStream(g)}async *_streamEventsV2(a,b,c){let d,e=new oo({...c,autoClose:!1}),f=g5(b),g=f.runId??fg();f.runId=g;let h=f.callbacks;if(void 0===h)f.callbacks=[e];else if(Array.isArray(h))f.callbacks=h.concat(e);else{let a=h.copy();a.addHandler(e,!0),f.callbacks=a}let i=new AbortController,j=this,k=async function(){let c,d=null;try{b?.signal?"any"in AbortSignal?c=AbortSignal.any([i.signal,b.signal]):(c=b.signal,d=()=>{i.abort()},b.signal.addEventListener("abort",d,{once:!0})):c=i.signal;let h=await j.stream(a,{...f,signal:c});for await(let a of e.tapOutputIterable(g,h))if(i.signal.aborted)break}finally{await e.finish(),c&&d&&c.removeEventListener("abort",d)}}(),l=!1;try{for await(let b of e){if(!l){b.data.input=a,l=!0,d=b.run_id,yield b;continue}b.run_id===d&&b.event.endsWith("_end")&&b.data?.input&&delete b.data.input,yield b}}finally{i.abort(),await k}}async *_streamEventsV1(a,b,c){let d,e=!1,f=g5(b),g=f.tags??[],h=f.metadata??{},i=f.runName??this.getName(),j=new ol({...c,autoClose:!1,_schemaFormat:"streaming_events"}),k=new ou({...c});for await(let b of this._streamLog(a,j,f)){if(void 0===(d=d?d.concat(b):oh.fromRunLogPatch(b)).state)throw Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!e){e=!0;let b={...d.state},c={run_id:b.id,event:`on_${b.type}_start`,name:i,tags:g,metadata:h,data:{input:a}};k.includeEvent(c,b.type)&&(yield c)}for(let a of[...new Set(b.ops.filter(a=>a.path.startsWith("/logs/")).map(a=>a.path.split("/")[2]))]){let b,c={},e=d.state.logs[a];if("start"==(b=void 0===e.end_time?e.streamed_output.length>0?"stream":"start":"end"))void 0!==e.inputs&&(c.input=e.inputs);else if("end"===b)void 0!==e.inputs&&(c.input=e.inputs),c.output=e.final_output;else if("stream"===b){let a=e.streamed_output.length;if(1!==a)throw Error(`Expected exactly one chunk of streamed output, got ${a} instead. Encountered in: "${e.name}"`);c={chunk:e.streamed_output[0]},e.streamed_output=[]}yield{event:`on_${e.type}_${b}`,name:e.name,run_id:e.id,tags:e.tags,metadata:e.metadata,data:c}}let{state:c}=d;if(c.streamed_output.length>0){let a=c.streamed_output.length;if(1!==a)throw Error(`Expected exactly one chunk of streamed output, got ${a} instead. Encountered in: "${c.name}"`);let b={chunk:c.streamed_output[0]};c.streamed_output=[];let d={event:`on_${c.type}_stream`,run_id:c.id,tags:g,metadata:h,name:i,data:b};k.includeEvent(d,c.type)&&(yield d)}}let l=d?.state;if(void 0!==l){let a={event:`on_${l.type}_end`,name:i,run_id:l.id,tags:g,metadata:h,data:{output:l.final_output}};k.includeEvent(a,l.type)&&(yield a)}}static isRunnable(a){return ot(a)}withListeners({onStart:a,onEnd:b,onError:c}){return new oI({bound:this,config:{},configFactories:[d=>({callbacks:[new os({config:d,onStart:a,onEnd:b,onError:c})]})]})}asTool(a){var b,c;let d,e;return b=this,d=(c=a).name??b.getName(),e=c.description??mJ(c.schema),new oU(mL(c.schema)?{name:d,description:e,schema:oF.z.object({input:oF.z.string()}).transform(a=>a.input),bound:b}:{name:d,description:e,schema:c.schema,bound:b})}},oI=class a extends oH{static lc_name(){return"RunnableBinding"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;bound;config;kwargs;configFactories;constructor(a){super(a),this.bound=a.bound,this.kwargs=a.kwargs,this.config=a.config,this.configFactories=a.configFactories}getName(a){return this.bound.getName(a)}async _mergeConfig(...a){let b=g3(this.config,...a);return g3(b,...this.configFactories?await Promise.all(this.configFactories.map(async a=>await a(b))):[])}withConfig(a){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...a}})}withRetry(a){return new oK({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:a?.stopAfterAttempt,...a})}async invoke(a,b){return this.bound.invoke(a,await this._mergeConfig(b,this.kwargs))}async batch(a,b,c){let d=Array.isArray(b)?await Promise.all(b.map(async a=>this._mergeConfig(g5(a),this.kwargs))):await this._mergeConfig(g5(b),this.kwargs);return this.bound.batch(a,d,c)}_concatOutputChunks(a,b){return this.bound._concatOutputChunks(a,b)}async *_streamIterator(a,b){yield*this.bound._streamIterator(a,await this._mergeConfig(g5(b),this.kwargs))}async stream(a,b){return this.bound.stream(a,await this._mergeConfig(g5(b),this.kwargs))}async *transform(a,b){yield*this.bound.transform(a,await this._mergeConfig(g5(b),this.kwargs))}streamEvents(a,b,c){let d=this,e=async function*(){yield*d.bound.streamEvents(a,{...await d._mergeConfig(g5(b),d.kwargs),version:b.version},c)};return ha.fromAsyncGenerator(e())}static isRunnableBinding(a){return a.bound&&oH.isRunnable(a.bound)}withListeners({onStart:b,onEnd:c,onError:d}){return new a({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new os({config:a,onStart:b,onEnd:c,onError:d})]})]})}},oJ=class a extends oH{static lc_name(){return"RunnableEach"}lc_serializable=!0;lc_namespace=["langchain_core","runnables"];bound;constructor(a){super(a),this.bound=a.bound}async invoke(a,b){return this._callWithConfig(this._invoke.bind(this),a,b)}async _invoke(a,b,c){return this.bound.batch(a,g6(b,{callbacks:c?.getChild()}))}withListeners({onStart:b,onEnd:c,onError:d}){return new a({bound:this.bound.withListeners({onStart:b,onEnd:c,onError:d})})}},oK=class extends oI{static lc_name(){return"RunnableRetry"}lc_namespace=["langchain_core","runnables"];maxAttemptNumber=3;onFailedAttempt=()=>{};constructor(a){super(a),this.maxAttemptNumber=a.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=a.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(a,b,c){let d=a>1?`retry:attempt:${a}`:void 0;return g6(b,{callbacks:c?.getChild(d)})}async _invoke(a,b,c){return nV(d=>super.invoke(a,this._patchConfigForRetry(d,b,c)),{onFailedAttempt:({error:b})=>this.onFailedAttempt(b,a),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(a,b){return this._callWithConfig(this._invoke.bind(this),a,b)}async _batch(a,b,c,d){let e={};try{await nV(async f=>{let g,h=a.map((a,b)=>b).filter(a=>void 0===e[a.toString()]||e[a.toString()]instanceof Error),i=h.map(b=>a[b]),j=h.map(a=>this._patchConfigForRetry(f,b?.[a],c?.[a])),k=await super.batch(i,j,{...d,returnExceptions:!0});for(let a=0;a<k.length;a+=1){let b=k[a],c=h[a];b instanceof Error&&void 0===g&&((g=b).input=i[a]),e[c.toString()]=b}if(g)throw g;return k},{onFailedAttempt:({error:a})=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if(d?.returnExceptions!==!0)throw a}return Object.keys(e).sort((a,b)=>parseInt(a,10)-parseInt(b,10)).map(a=>e[parseInt(a,10)])}async batch(a,b,c){return this._batchWithConfig(this._batch.bind(this),a,b,c)}},oL=class a extends oH{static lc_name(){return"RunnableSequence"}first;middle=[];last;omitSequenceTags=!1;lc_serializable=!0;lc_namespace=["langchain_core","runnables"];constructor(a){super(a),this.first=a.first,this.middle=a.middle??this.middle,this.last=a.last,this.name=a.name,this.omitSequenceTags=a.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(a,b){let c,d=g5(b),e=await g2(d),f=await e?.handleChainStart(this.toJSON(),oG(a,"input"),d.runId,void 0,void 0,void 0,d?.runName);delete d.runId;let g=a;try{let a=[this.first,...this.middle];for(let c=0;c<a.length;c+=1){let e=a[c].invoke(g,g6(d,{callbacks:f?.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));g=await g8(e,b?.signal)}if(b?.signal?.aborted)throw g9(b.signal);c=await this.last.invoke(g,g6(d,{callbacks:f?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(a){throw await f?.handleChainError(a),a}return await f?.handleChainEnd(oG(c,"output")),c}async batch(a,b,c){let d=this._getOptionsList(b??{},a.length),e=await Promise.all(d.map(g2)),f=await Promise.all(e.map(async(b,c)=>{let e=await b?.handleChainStart(this.toJSON(),oG(a[c],"input"),d[c].runId,void 0,void 0,void 0,d[c].runName);return delete d[c].runId,e})),g=a;try{for(let a=0;a<this.steps.length;a+=1){let b=this.steps[a].batch(g,f.map((b,c)=>{let e=b?.getChild(this.omitSequenceTags?void 0:`seq:step:${a+1}`);return g6(d[c],{callbacks:e})}),c);g=await g8(b,d[0]?.signal)}}catch(a){throw await Promise.all(f.map(b=>b?.handleChainError(a))),a}return await Promise.all(f.map(a=>a?.handleChainEnd(oG(g,"output")))),g}_concatOutputChunks(a,b){return this.last._concatOutputChunks(a,b)}async *_streamIterator(a,b){let c,d=await g2(b),{runId:e,...f}=b??{},g=await d?.handleChainStart(this.toJSON(),oG(a,"input"),e,void 0,void 0,void 0,f?.runName),h=[this.first,...this.middle,this.last],i=!0;async function*j(){yield a}try{let a=h[0].transform(j(),g6(f,{callbacks:g?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let b=1;b<h.length;b+=1){let c=h[b];a=await c.transform(a,g6(f,{callbacks:g?.getChild(this.omitSequenceTags?void 0:`seq:step:${b+1}`)}))}for await(let d of a)if(b?.signal?.throwIfAborted(),yield d,i)if(void 0===c)c=d;else try{c=this._concatOutputChunks(c,d)}catch{c=void 0,i=!1}}catch(a){throw await g?.handleChainError(a),a}await g?.handleChainEnd(oG(c,"output"))}getGraph(a){let b=new oy,c=null;return this.steps.forEach((d,e)=>{let f=d.getGraph(a);0!==e&&f.trimFirstNode(),e!==this.steps.length-1&&f.trimLastNode(),b.extend(f);let g=f.firstNode();if(!g)throw Error(`Runnable ${d} has no first node`);c&&b.addEdge(c,g),c=f.lastNode()}),b}pipe(b){return new a(a.isRunnableSequence(b)?{first:this.first,middle:this.middle.concat([this.last,b.first,...b.middle]),last:b.last,name:this.name??b.name}:{first:this.first,middle:[...this.middle,this.last],last:oR(b),name:this.name})}static isRunnableSequence(a){return Array.isArray(a.middle)&&oH.isRunnable(a)}static from([b,...c],d){let e={};return"string"==typeof d?e.name=d:void 0!==d&&(e=d),new a({...e,first:oR(b),middle:c.slice(0,-1).map(oR),last:oR(c[c.length-1])})}},oM=class a extends oH{static lc_name(){return"RunnableMap"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;steps;getStepsKeys(){return Object.keys(this.steps)}constructor(a){for(const[b,c]of(super(a),this.steps={},Object.entries(a.steps)))this.steps[b]=oR(c)}static from(b){return new a({steps:b})}async invoke(a,b){let c=g5(b),d=await g2(c),e=await d?.handleChainStart(this.toJSON(),{input:a},c.runId,void 0,void 0,void 0,c?.runName);delete c.runId;let f={};try{let d=Object.entries(this.steps).map(async([b,d])=>{f[b]=await d.invoke(a,g6(c,{callbacks:e?.getChild(`map:key:${b}`)}))});await g8(Promise.all(d),b?.signal)}catch(a){throw await e?.handleChainError(a),a}return await e?.handleChainEnd(f),f}async *_transform(a,b,c){let d={...this.steps},e=hb(a,Object.keys(d).length),f=new Map(Object.entries(d).map(([a,d],f)=>{let g=d.transform(e[f],g6(c,{callbacks:b?.getChild(`map:key:${a}`)}));return[a,g.next().then(b=>({key:a,gen:g,result:b}))]}));for(;f.size;){let a=Promise.race(f.values()),{key:b,result:d,gen:e}=await g8(a,c?.signal);f.delete(b),d.done||(yield{[b]:d.value},f.set(b,e.next().then(a=>({key:b,gen:e,result:a}))))}}transform(a,b){return this._transformStreamWithConfig(a,this._transform.bind(this),b)}async stream(a,b){async function*c(){yield a}let d=g5(b),e=new hd({generator:this.transform(c(),d),config:d});return await e.setup,ha.fromAsyncGenerator(e)}},oN=class a extends oH{lc_serializable=!1;lc_namespace=["langchain_core","runnables"];func;constructor(a){if(super(a),!gC(a.func))throw Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=a.func}async invoke(a,b){let[c]=this._getOptionsList(b??{},1),d=await g2(c);return g8(this.func(g6(c,{callbacks:d}),a),c?.signal)}async *_streamIterator(a,b){let[c]=this._getOptionsList(b??{},1),d=await this.invoke(a,b);if(oC(d)){for await(let a of d)c?.signal?.throwIfAborted(),yield a;return}if(null!=d&&"object"==typeof d&&"next"in d&&"function"==typeof d.next){for(;;){c?.signal?.throwIfAborted();let a=d.next();if(a.done)break;yield a.value}return}yield d}static from(b){return new a({func:b})}},oO=class a extends oH{static lc_name(){return"RunnableLambda"}lc_namespace=["langchain_core","runnables"];func;constructor(a){if(gC(a.func))return oN.from(a.func);if(super(a),gC(a.func))throw Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.");this.func=a.func}static from(b){return new a({func:b})}async _invoke(a,b,c){return new Promise((d,e)=>{let f=g6(b,{callbacks:c?.getChild(),recursionLimit:(b?.recursionLimit??25)-1});g1.runWithConfig(g7(f),async()=>{try{let c=await this.func(a,{...f});if(c&&oH.isRunnable(c)){if(b?.recursionLimit===0)throw Error("Recursion limit reached.");c=await c.invoke(a,{...f,recursionLimit:(f.recursionLimit??25)-1})}else if(oC(c)){let a;for await(let d of oE(f,c))if(b?.signal?.throwIfAborted(),void 0===a)a=d;else try{a=this._concatOutputChunks(a,d)}catch{a=d}c=a}else if(oB(c)){let a;for(let d of oD(f,c))if(b?.signal?.throwIfAborted(),void 0===a)a=d;else try{a=this._concatOutputChunks(a,d)}catch{a=d}c=a}d(c)}catch(a){e(a)}})})}async invoke(a,b){return this._callWithConfig(this._invoke.bind(this),a,b)}async *_transform(a,b,c){let d;for await(let b of a)if(void 0===d)d=b;else try{d=this._concatOutputChunks(d,b)}catch{d=b}let e=g6(c,{callbacks:b?.getChild(),recursionLimit:(c?.recursionLimit??25)-1}),f=await new Promise((a,b)=>{g1.runWithConfig(g7(e),async()=>{try{let b=await this.func(d,{...e,config:e});a(b)}catch(a){b(a)}})});if(f&&oH.isRunnable(f)){if(c?.recursionLimit===0)throw Error("Recursion limit reached.");for await(let a of(await f.stream(d,e)))yield a}else if(oC(f))for await(let a of oE(e,f))c?.signal?.throwIfAborted(),yield a;else if(oB(f))for(let a of oD(e,f))c?.signal?.throwIfAborted(),yield a;else yield f}transform(a,b){return this._transformStreamWithConfig(a,this._transform.bind(this),b)}async stream(a,b){async function*c(){yield a}let d=g5(b),e=new hd({generator:this.transform(c(),d),config:d});return await e.setup,ha.fromAsyncGenerator(e)}},oP=class extends oM{},oQ=class extends oH{static lc_name(){return"RunnableWithFallbacks"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;runnable;fallbacks;constructor(a){super(a),this.runnable=a.runnable,this.fallbacks=a.fallbacks}*runnables(){for(let a of(yield this.runnable,this.fallbacks))yield a}async invoke(a,b){let c=g5(b),d=await g2(c),{runId:e,...f}=c,g=await d?.handleChainStart(this.toJSON(),oG(a,"input"),e,void 0,void 0,void 0,f?.runName),h=g6(f,{callbacks:g?.getChild()});return await g1.runWithConfig(h,async()=>{let b;for(let d of this.runnables()){c?.signal?.throwIfAborted();try{let b=await d.invoke(a,h);return await g?.handleChainEnd(oG(b,"output")),b}catch(a){void 0===b&&(b=a)}}if(void 0===b)throw Error("No error stored at end of fallback.");throw await g?.handleChainError(b),b})}async *_streamIterator(a,b){let c,d,e,f=g5(b),g=await g2(f),{runId:h,...i}=f,j=await g?.handleChainStart(this.toJSON(),oG(a,"input"),h,void 0,void 0,void 0,i?.runName);for(let b of this.runnables()){f?.signal?.throwIfAborted();let e=g6(i,{callbacks:j?.getChild()});try{let c=await b.stream(a,e);d=oE(e,c);break}catch(a){void 0===c&&(c=a)}}if(void 0===d){let a=c??Error("No error stored at end of fallback.");throw await j?.handleChainError(a),a}try{for await(let a of d){yield a;try{e=void 0===e?e:this._concatOutputChunks(e,a)}catch{e=void 0}}}catch(a){throw await j?.handleChainError(a),a}await j?.handleChainEnd(oG(e,"output"))}async batch(a,b,c){let d;if(c?.returnExceptions)throw Error("Not implemented.");let e=this._getOptionsList(b??{},a.length),f=await Promise.all(e.map(a=>g2(a))),g=await Promise.all(f.map(async(b,c)=>{let d=await b?.handleChainStart(this.toJSON(),oG(a[c],"input"),e[c].runId,void 0,void 0,void 0,e[c].runName);return delete e[c].runId,d}));for(let b of this.runnables()){e[0].signal?.throwIfAborted();try{let d=await b.batch(a,g.map((a,b)=>g6(e[b],{callbacks:a?.getChild()})),c);return await Promise.all(g.map((a,b)=>a?.handleChainEnd(oG(d[b],"output")))),d}catch(a){void 0===d&&(d=a)}}if(!d)throw Error("No error stored at end of fallbacks.");throw await Promise.all(g.map(a=>a?.handleChainError(d))),d}};function oR(a){if("function"==typeof a)return new oO({func:a});if(oH.isRunnable(a))return a;if(Array.isArray(a)||"object"!=typeof a)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let b={};for(let[c,d]of Object.entries(a))b[c]=oR(d);return new oM({steps:b})}}var oS=class extends oH{static lc_name(){return"RunnableAssign"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;mapper;constructor(a){a instanceof oM&&(a={mapper:a}),super(a),this.mapper=a.mapper}async invoke(a,b){let c=await this.mapper.invoke(a,b);return{...a,...c}}async *_transform(a,b,c){let d=this.mapper.getStepsKeys(),[e,f]=hb(a),g=this.mapper.transform(f,g6(c,{callbacks:b?.getChild()})),h=g.next();for await(let a of e){if("object"!=typeof a||Array.isArray(a))throw Error(`RunnableAssign can only be used with objects as input, got ${typeof a}`);let b=Object.fromEntries(Object.entries(a).filter(([a])=>!d.includes(a)));Object.keys(b).length>0&&(yield b)}for await(let a of(yield(await h).value,g))yield a}transform(a,b){return this._transformStreamWithConfig(a,this._transform.bind(this),b)}async stream(a,b){async function*c(){yield a}let d=g5(b),e=new hd({generator:this.transform(c(),d),config:d});return await e.setup,ha.fromAsyncGenerator(e)}},oT=class extends oH{static lc_name(){return"RunnablePick"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;keys;constructor(a){("string"==typeof a||Array.isArray(a))&&(a={keys:a}),super(a),this.keys=a.keys}async _pick(a){if("string"==typeof this.keys)return a[this.keys];{let b=this.keys.map(b=>[b,a[b]]).filter(a=>void 0!==a[1]);return 0===b.length?void 0:Object.fromEntries(b)}}async invoke(a,b){return this._callWithConfig(this._pick.bind(this),a,b)}async *_transform(a){for await(let b of a){let a=await this._pick(b);void 0!==a&&(yield a)}}transform(a,b){return this._transformStreamWithConfig(a,this._transform.bind(this),b)}async stream(a,b){async function*c(){yield a}let d=g5(b),e=new hd({generator:this.transform(c(),d),config:d});return await e.setup,ha.fromAsyncGenerator(e)}},oU=class extends oI{name;description;schema;constructor(a){super({bound:oL.from([oO.from(async a=>{let b;if(et(a))try{b=await mG(this.schema,a.args)}catch{throw new eu("Received tool input did not match expected schema",JSON.stringify(a.args))}else b=a;return b}).withConfig({runName:`${a.name}:parse_input`}),a.bound]).withConfig({runName:a.name}),config:a.config??{}}),this.name=a.name,this.description=a.description,this.schema=a.schema}static lc_name(){return"RunnableToolLike"}};let oV=(a,b)=>{let c=[...new Set(b?.map(a=>{if("string"==typeof a)return a;let b=new a({});if(!("getType"in b)||"function"!=typeof b.getType)throw Error("Invalid type provided.");return b.getType()}))],d=a.getType();return c.some(a=>a===d)};function oW(a,b){return Array.isArray(a)?oX(a,b):oO.from(b=>oX(b,a))}function oX(a,b={}){let{includeNames:c,excludeNames:d,includeTypes:e,excludeTypes:f,includeIds:g,excludeIds:h}=b,i=[];for(let b of a)if(!(d&&b.name&&d.includes(b.name))){if(f&&oV(b,f))continue;if(h&&b.id&&h.includes(b.id))continue;e||g||c?c&&b.name&&c.some(a=>a===b.name)||e&&oV(b,e)?i.push(b):g&&b.id&&g.some(a=>a===b.id)&&i.push(b):i.push(b)}return i}function oY(a){return Array.isArray(a)?oZ(a):oO.from(oZ)}function oZ(a){if(!a.length)return[];let b=[];for(let c of a){let a=b.pop();if(a)if("tool"===c.getType()||c.getType()!==a.getType())b.push(a,c);else{let d=e6(a),e=e6(c),f=d.concat(e);"string"==typeof d.content&&"string"==typeof e.content&&(f.content=`${d.content}
${e.content}`),b.push(function(a){let b,c=a.getType(),d=Object.fromEntries(Object.entries(a).filter(([a])=>!["type","tool_call_chunks"].includes(a)&&!a.startsWith("lc_")));if(c in o2&&(b=o3(c,d)),!b)throw Error(`Unrecognized message chunk class ${c}. Supported classes are ${Object.keys(o2)}`);return b}(f))}else b.push(c)}return b}function o$(a,b){if(!Array.isArray(a))return oO.from(b=>o_(b,a)).withConfig({runName:"trim_messages"});if(!b)throw Error("Options parameter is required when providing messages.");return o_(a,b)}async function o_(a,b){let c,{maxTokens:d,tokenCounter:e,strategy:f="last",allowPartial:g=!1,endOn:h,startOn:i,includeSystem:j=!1,textSplitter:k}=b;if(i&&"first"===f)throw Error("`startOn` should only be specified if `strategy` is 'last'.");if(j&&"first"===f)throw Error("`includeSystem` should only be specified if `strategy` is 'last'.");c="getNumTokens"in e?async a=>(await Promise.all(a.map(a=>e.getNumTokens(a.content)))).reduce((a,b)=>a+b,0):async a=>e(a);let l=o4;if(k&&(l="splitText"in k?k.splitText:async a=>k(a)),"first"===f)return o0(a,{maxTokens:d,tokenCounter:c,textSplitter:l,partialStrategy:g?"first":void 0,endOn:h});if("last"===f)return o1(a,{maxTokens:d,tokenCounter:c,textSplitter:l,allowPartial:g,includeSystem:j,startOn:i,endOn:h});throw Error(`Unrecognized strategy: '${f}'. Must be one of 'first' or 'last'.`)}async function o0(a,b){let{maxTokens:c,tokenCounter:d,textSplitter:e,partialStrategy:f,endOn:g}=b,h=[...a],i=0;for(let a=0;a<h.length;a+=1){let b=a>0?h.slice(0,-a):h;if(await d(b)<=c){i=h.length-a;break}}if(i<h.length&&f){let a=!1;if(Array.isArray(h[i].content)){let b=h[i];if("string"==typeof b.content)throw Error("Expected content to be an array.");let e=b.content.length,g="last"===f?[...b.content].reverse():b.content;for(let j=1;j<=e;j+=1){let e="first"===f?g.slice(0,j):g.slice(-j),k=Object.fromEntries(Object.entries(b).filter(([a])=>"type"!==a&&!a.startsWith("lc_"))),l=o3(b.getType(),{...k,content:e}),m=[...h.slice(0,i),l];if(await d(m)<=c)h=m,i+=1,a=!0;else break}a&&"last"===f&&(b.content=[...g].reverse())}if(!a){let a,b=h[i];if(Array.isArray(b.content)&&b.content.some(a=>"string"==typeof a||"text"===a.type)){let c=b.content.find(a=>"text"===a.type&&a.text);a=c?.text}else"string"==typeof b.content&&(a=b.content);if(a){let g=await e(a),j=g.length;"last"===f&&g.reverse();for(let a=0;a<j-1;a+=1)if(g.pop(),b.content=g.join(""),await d([...h.slice(0,i),b])<=c){"last"===f&&(b.content=[...g].reverse().join("")),h=[...h.slice(0,i),b],i+=1;break}}}}if(g){let a=Array.isArray(g)?g:[g];for(;i>0&&!oV(h[i-1],a);)i-=1}return h.slice(0,i)}async function o1(a,b){let{allowPartial:c=!1,includeSystem:d=!1,endOn:e,startOn:f,...g}=b,h=a.map(a=>{let b=Object.fromEntries(Object.entries(a).filter(([a])=>"type"!==a&&!a.startsWith("lc_")));return o3(a.getType(),b,el(a))});if(e){let a=Array.isArray(e)?e:[e];for(;h.length>0&&!oV(h[h.length-1],a);)h=h.slice(0,-1)}let i=d&&h[0]?.getType()==="system",j=i?h.slice(0,1).concat(h.slice(1).reverse()):h.reverse();return(j=await o0(j,{...g,partialStrategy:c?"last":void 0,endOn:f}),i)?[j[0],...j.slice(1).reverse()]:j.reverse()}let o2={human:{message:eF,messageChunk:eG},ai:{message:eW,messageChunk:eZ},system:{message:eK,messageChunk:eL},developer:{message:eK,messageChunk:eL},tool:{message:en,messageChunk:eo},function:{message:eB,messageChunk:eC},generic:{message:ex,messageChunk:ey},remove:{message:eJ,messageChunk:eJ}};function o3(a,b,c){let d,e;switch(a){case"human":c?d=new eG(b):e=new eF(b);break;case"ai":if(c){let a={...b};"tool_calls"in a&&(a={...a,tool_call_chunks:a.tool_calls?.map(a=>({...a,type:"tool_call_chunk",index:void 0,args:JSON.stringify(a.args)}))}),d=new eZ(a)}else e=new eW(b);break;case"system":c?d=new eL(b):e=new eK(b);break;case"developer":c?d=new eL({...b,additional_kwargs:{...b.additional_kwargs,__openai_role__:"developer"}}):e=new eK({...b,additional_kwargs:{...b.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in b)c?d=new eo(b):e=new en(b);else throw Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(c)d=new eC(b);else{if(!b.name)throw Error("FunctionMessage must have a 'name' field");e=new eB(b)}break;case"generic":if("role"in b)c?d=new ey(b):e=new ex(b);else throw Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw Error(`Unrecognized message type ${a}`)}if(c&&d)return d;if(e)return e;throw Error(`Unrecognized message type ${a}`)}function o4(a){let b=a.split("\n");return Promise.resolve([...b.slice(0,-1).map(a=>`${a}
`),b[b.length-1]])}let o5=["text","reasoning","tool_call","tool_call_chunk","invalid_tool_call","server_tool_call","server_tool_call_chunk","server_tool_call_result","image","video","audio","text-plain","file"];dy({},{AIMessage:()=>eW,AIMessageChunk:()=>eZ,BaseMessage:()=>ed,BaseMessageChunk:()=>ei,ChatMessage:()=>ex,ChatMessageChunk:()=>ey,FunctionMessage:()=>eB,FunctionMessageChunk:()=>eC,HumanMessage:()=>eF,HumanMessageChunk:()=>eG,KNOWN_BLOCK_TYPES:()=>o5,RemoveMessage:()=>eJ,SystemMessage:()=>eK,SystemMessageChunk:()=>eL,ToolMessage:()=>en,ToolMessageChunk:()=>eo,_isMessageFieldWithRole:()=>ej,_mergeDicts:()=>ef,_mergeLists:()=>eg,_mergeObj:()=>eh,_mergeStatus:()=>ec,coerceMessageLikeToMessage:()=>e1,collapseToolCallChunks:()=>e7,convertToChunk:()=>e6,convertToOpenAIImageBlock:()=>dM,convertToProviderContentBlock:()=>dP,defaultTextSplitter:()=>o4,defaultToolCallParser:()=>ep,filterMessages:()=>oW,getBufferString:()=>e2,iife:()=>e$,isAIMessage:()=>eX,isAIMessageChunk:()=>eY,isBase64ContentBlock:()=>dJ,isBaseMessage:()=>ek,isBaseMessageChunk:()=>el,isChatMessage:()=>ez,isChatMessageChunk:()=>eA,isDataContentBlock:()=>dH,isDirectToolOutput:()=>em,isFunctionMessage:()=>eD,isFunctionMessageChunk:()=>eE,isHumanMessage:()=>eH,isHumanMessageChunk:()=>eI,isIDContentBlock:()=>dL,isMessage:()=>d9,isOpenAIToolCallArray:()=>ee,isPlainTextContentBlock:()=>dK,isSystemMessage:()=>eM,isSystemMessageChunk:()=>eN,isToolMessage:()=>eq,isToolMessageChunk:()=>er,isURLContentBlock:()=>dI,mapChatMessagesToStoredMessages:()=>e5,mapStoredMessageToChatMessage:()=>e3,mapStoredMessagesToChatMessages:()=>e4,mergeContent:()=>eb,mergeMessageRuns:()=>oY,mergeResponseMetadata:()=>eT,mergeUsageMetadata:()=>eV,parseBase64DataUrl:()=>dO,parseMimeType:()=>dN,trimMessages:()=>o$}),dy({},{BasePromptValue:()=>o6,ChatPromptValue:()=>o8,ImagePromptValue:()=>o9,StringPromptValue:()=>o7});var o6=class extends dU{},o7=class extends o6{static lc_name(){return"StringPromptValue"}lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;value;constructor(a){super({value:a}),this.value=a}toString(){return this.value}toChatMessages(){return[new eF(this.value)]}},o8=class extends o6{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ChatPromptValue"}messages;constructor(a){Array.isArray(a)&&(a={messages:a}),super(a),this.messages=a.messages}toString(){return e2(this.messages)}toChatMessages(){return this.messages}},o9=class extends o6{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ImagePromptValue"}imageUrl;value;constructor(a){"imageUrl"in a||(a={imageUrl:a}),super(a),this.imageUrl=a.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new eF({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}},pa="0123456789abcdef".split(""),pb=[-0x80000000,8388608,32768,128],pc=[24,16,8,0],pd=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2],pe=[];function pf(a,b){b?(pe[0]=pe[16]=pe[1]=pe[2]=pe[3]=pe[4]=pe[5]=pe[6]=pe[7]=pe[8]=pe[9]=pe[10]=pe[11]=pe[12]=pe[13]=pe[14]=pe[15]=0,this.blocks=pe):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a?(this.h0=0xc1059ed8,this.h1=0x367cd507,this.h2=0x3070dd17,this.h3=0xf70e5939,this.h4=0xffc00b31,this.h5=0x68581511,this.h6=0x64f98fa7,this.h7=0xbefa4fa4):(this.h0=0x6a09e667,this.h1=0xbb67ae85,this.h2=0x3c6ef372,this.h3=0xa54ff53a,this.h4=0x510e527f,this.h5=0x9b05688c,this.h6=0x1f83d9ab,this.h7=0x5be0cd19),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=a}pf.prototype.update=function(a){if(!this.finalized){var b,c=typeof a;if("string"!==c){if("object"===c){if(null===a)throw Error(ERROR);else if(ARRAY_BUFFER&&a.constructor===ArrayBuffer)a=new Uint8Array(a);else if(!Array.isArray(a)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(a)))throw Error(ERROR)}else throw Error(ERROR);b=!0}for(var d,e,f=0,g=a.length,h=this.blocks;f<g;){if(this.hashed&&(this.hashed=!1,h[0]=this.block,this.block=h[16]=h[1]=h[2]=h[3]=h[4]=h[5]=h[6]=h[7]=h[8]=h[9]=h[10]=h[11]=h[12]=h[13]=h[14]=h[15]=0),b)for(e=this.start;f<g&&e<64;++f)h[e>>>2]|=a[f]<<pc[3&e++];else for(e=this.start;f<g&&e<64;++f)(d=a.charCodeAt(f))<128?h[e>>>2]|=d<<pc[3&e++]:(d<2048?h[e>>>2]|=(192|d>>>6)<<pc[3&e++]:(d<55296||d>=57344?h[e>>>2]|=(224|d>>>12)<<pc[3&e++]:(d=65536+((1023&d)<<10|1023&a.charCodeAt(++f)),h[e>>>2]|=(240|d>>>18)<<pc[3&e++],h[e>>>2]|=(128|d>>>12&63)<<pc[3&e++]),h[e>>>2]|=(128|d>>>6&63)<<pc[3&e++]),h[e>>>2]|=(128|63&d)<<pc[3&e++]);this.lastByteIndex=e,this.bytes+=e-this.start,e>=64?(this.block=h[16],this.start=e-64,this.hash(),this.hashed=!0):this.start=e}return this.bytes>0xffffffff&&(this.hBytes+=this.bytes/0x100000000|0,this.bytes=this.bytes%0x100000000),this}},pf.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var a=this.blocks,b=this.lastByteIndex;a[16]=this.block,a[b>>>2]|=pb[3&b],this.block=a[16],b>=56&&(this.hashed||this.hash(),a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),a[14]=this.hBytes<<3|this.bytes>>>29,a[15]=this.bytes<<3,this.hash()}},pf.prototype.hash=function(){var a,b,c,d,e,f,g,h,i,j,k=this.h0,l=this.h1,m=this.h2,n=this.h3,o=this.h4,p=this.h5,q=this.h6,r=this.h7,s=this.blocks;for(a=16;a<64;++a)b=((e=s[a-15])>>>7|e<<25)^(e>>>18|e<<14)^e>>>3,c=((e=s[a-2])>>>17|e<<15)^(e>>>19|e<<13)^e>>>10,s[a]=s[a-16]+b+s[a-7]+c|0;for(a=0,j=l&m;a<64;a+=4)this.first?(this.is224?(g=300032,r=(e=s[0]-0x543c9a5b)-0x8f1a6c7|0,n=e+0x170e9b5|0):(g=0x2a01a605,r=(e=s[0]-0xc881298)-0x5ab00ac6|0,n=e+0x8909ae5|0),this.first=!1):(b=(k>>>2|k<<30)^(k>>>13|k<<19)^(k>>>22|k<<10),c=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),d=(g=k&l)^k&m^j,e=r+c+(o&p^~o&q)+pd[a]+s[a],f=b+d,r=n+e|0,n=e+f|0),b=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),c=(r>>>6|r<<26)^(r>>>11|r<<21)^(r>>>25|r<<7),d=(h=n&k)^n&l^g,e=p+c+(q&r^~q&o)+pd[a+1]+s[a+1],f=b+d,q=m+e|0,b=((m=e+f|0)>>>2|m<<30)^(m>>>13|m<<19)^(m>>>22|m<<10),c=(q>>>6|q<<26)^(q>>>11|q<<21)^(q>>>25|q<<7),d=(i=m&n)^m&k^h,e=o+c+(p&q^~p&r)+pd[a+2]+s[a+2],f=b+d,p=l+e|0,b=((l=e+f|0)>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),c=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),d=(j=l&m)^l&n^i,e=o+c+(p&q^~p&r)+pd[a+3]+s[a+3],f=b+d,o=k+e|0,k=e+f|0,this.chromeBugWorkAround=!0;this.h0=this.h0+k|0,this.h1=this.h1+l|0,this.h2=this.h2+m|0,this.h3=this.h3+n|0,this.h4=this.h4+o|0,this.h5=this.h5+p|0,this.h6=this.h6+q|0,this.h7=this.h7+r|0},pf.prototype.hex=function(){this.finalize();var a=this.h0,b=this.h1,c=this.h2,d=this.h3,e=this.h4,f=this.h5,g=this.h6,h=this.h7,i=pa[a>>>28&15]+pa[a>>>24&15]+pa[a>>>20&15]+pa[a>>>16&15]+pa[a>>>12&15]+pa[a>>>8&15]+pa[a>>>4&15]+pa[15&a]+pa[b>>>28&15]+pa[b>>>24&15]+pa[b>>>20&15]+pa[b>>>16&15]+pa[b>>>12&15]+pa[b>>>8&15]+pa[b>>>4&15]+pa[15&b]+pa[c>>>28&15]+pa[c>>>24&15]+pa[c>>>20&15]+pa[c>>>16&15]+pa[c>>>12&15]+pa[c>>>8&15]+pa[c>>>4&15]+pa[15&c]+pa[d>>>28&15]+pa[d>>>24&15]+pa[d>>>20&15]+pa[d>>>16&15]+pa[d>>>12&15]+pa[d>>>8&15]+pa[d>>>4&15]+pa[15&d]+pa[e>>>28&15]+pa[e>>>24&15]+pa[e>>>20&15]+pa[e>>>16&15]+pa[e>>>12&15]+pa[e>>>8&15]+pa[e>>>4&15]+pa[15&e]+pa[f>>>28&15]+pa[f>>>24&15]+pa[f>>>20&15]+pa[f>>>16&15]+pa[f>>>12&15]+pa[f>>>8&15]+pa[f>>>4&15]+pa[15&f]+pa[g>>>28&15]+pa[g>>>24&15]+pa[g>>>20&15]+pa[g>>>16&15]+pa[g>>>12&15]+pa[g>>>8&15]+pa[g>>>4&15]+pa[15&g];return this.is224||(i+=pa[h>>>28&15]+pa[h>>>24&15]+pa[h>>>20&15]+pa[h>>>16&15]+pa[h>>>12&15]+pa[h>>>8&15]+pa[h>>>4&15]+pa[15&h]),i},pf.prototype.toString=pf.prototype.hex,pf.prototype.digest=function(){this.finalize();var a=this.h0,b=this.h1,c=this.h2,d=this.h3,e=this.h4,f=this.h5,g=this.h6,h=this.h7,i=[a>>>24&255,a>>>16&255,a>>>8&255,255&a,b>>>24&255,b>>>16&255,b>>>8&255,255&b,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d>>>24&255,d>>>16&255,d>>>8&255,255&d,e>>>24&255,e>>>16&255,e>>>8&255,255&e,f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g];return this.is224||i.push(h>>>24&255,h>>>16&255,h>>>8&255,255&h),i},pf.prototype.array=pf.prototype.digest,pf.prototype.arrayBuffer=function(){this.finalize();var a=new ArrayBuffer(this.is224?28:32),b=new DataView(a);return b.setUint32(0,this.h0),b.setUint32(4,this.h1),b.setUint32(8,this.h2),b.setUint32(12,this.h3),b.setUint32(16,this.h4),b.setUint32(20,this.h5),b.setUint32(24,this.h6),this.is224||b.setUint32(28,this.h7),a};let pg=(...a)=>new pf(!1,!0).update(a.join("")).hex();dy({},{sha256:()=>pg}),dy({},{BaseCache:()=>pk,InMemoryCache:()=>pm,defaultHashKeyEncoder:()=>ph,deserializeStoredGeneration:()=>pi,serializeGeneration:()=>pj});let ph=(...a)=>pg(a.join("_"));function pi(a){return void 0!==a.message?{text:a.text,message:e3(a.message)}:{text:a.text}}function pj(a){let b={text:a.text};return void 0!==a.message&&(b.message=a.message.toDict()),b}var pk=class{keyEncoder=ph;makeDefaultKeyEncoder(a){this.keyEncoder=a}};let pl=new Map;var pm=class a extends pk{cache;constructor(a){super(),this.cache=a??new Map}lookup(a,b){return Promise.resolve(this.cache.get(this.keyEncoder(a,b))??null)}async update(a,b,c){this.cache.set(this.keyEncoder(a,b),c)}static global(){return new a(pl)}},pn=a.i(584709),po=Object.defineProperty,pp=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(a,b){for(const[b,c]of(this.patStr=a.pat_str,Object.entries(a.bpe_ranks.split("\n").filter(Boolean).reduce((a,b)=>{let[c,d,...e]=b.split(" "),f=Number.parseInt(d,10);return e.forEach((b,c)=>a[b]=f+c),a},{})))){const a=pn.default.toByteArray(b);this.rankMap.set(a.join(","),c),this.textMap.set(c,a)}this.specialTokens={...a.special_tokens,...b},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((a,[b,c])=>(a[c]=this.textEncoder.encode(b),a),{})}encode(a,b=[],c="all"){let d=RegExp(this.patStr,"ug"),e=pp.specialTokenRegex(Object.keys(this.specialTokens)),f=[],g=new Set("all"===b?Object.keys(this.specialTokens):b),h=new Set("all"===c?Object.keys(this.specialTokens).filter(a=>!g.has(a)):c);if(h.size>0){let b=pp.specialTokenRegex([...h]),c=a.match(b);if(null!=c)throw Error(`The text contains a special token that is not allowed: ${c[0]}`)}let i=0;for(;;){let b=null,c=i;for(;e.lastIndex=c,!(null==(b=e.exec(a))||g.has(b[0]));)c=b.index+1;let h=b?.index??a.length;for(let b of a.substring(i,h).matchAll(d)){let a=this.textEncoder.encode(b[0]),c=this.rankMap.get(a.join(","));if(null!=c){f.push(c);continue}f.push(...function(a,b){return 1===a.length?[b.get(a.join(","))]:(function(a,b){let c=Array.from({length:a.length},(a,b)=>({start:b,end:b+1}));for(;c.length>1;){let d=null;for(let e=0;e<c.length-1;e++){let f=a.slice(c[e].start,c[e+1].end),g=b.get(f.join(","));null!=g&&(null==d||g<d[0])&&(d=[g,e])}if(null!=d){let a=d[1];c[a]={start:c[a].start,end:c[a+1].end},c.splice(a+1,1)}else break}return c})(a,b).map(c=>b.get(a.slice(c.start,c.end).join(","))).filter(a=>null!=a)}(a,this.rankMap))}if(null==b)break;let j=this.specialTokens[b[0]];f.push(j),i=b.index+b[0].length}return f}decode(a){let b=[],c=0;for(let d=0;d<a.length;++d){let e=a[d],f=this.textMap.get(e)??this.inverseSpecialTokens[e];null!=f&&(b.push(f),c+=f.length)}let d=new Uint8Array(c),e=0;for(let a of b)d.set(a,e),e+=a.length;return this.textDecoder.decode(d)}};Z="specialTokenRegex",$=a=>RegExp(a.map(a=>a.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"g"),(n="symbol"!=typeof Z?Z+"":Z)in pp?po(pp,n,{enumerable:!0,configurable:!0,writable:!0,value:$}):pp[n]=$,dy({},{encodingForModel:()=>pt,getEncoding:()=>ps});let pq={},pr=new or({});async function ps(a){return a in pq||(pq[a]=pr.fetch(`https://tiktoken.pages.dev/js/${a}.json`).then(a=>a.json()).then(a=>new pp(a)).catch(b=>{throw delete pq[a],b})),await pq[a]}async function pt(a){return ps(function(a){switch(a){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw Error("Unknown model")}}(a))}dy({},{BaseLangChain:()=>pz,BaseLanguageModel:()=>pA,calculateMaxTokens:()=>py,getEmbeddingContextSize:()=>pv,getModelContextSize:()=>pw,getModelNameForTiktoken:()=>pu,isOpenAITool:()=>px});let pu=a=>a.startsWith("gpt-5")?"gpt-5":a.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":a.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":a.startsWith("gpt-4-32k")?"gpt-4-32k":a.startsWith("gpt-4-")?"gpt-4":a.startsWith("gpt-4o")?"gpt-4o":a,pv=a=>"text-embedding-ada-002"===a?8191:2046,pw=a=>{switch(pu(a)){case"gpt-5":case"gpt-5-turbo":case"gpt-5-turbo-preview":return 4e5;case"gpt-4o":case"gpt-4o-mini":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4-turbo":case"gpt-4-turbo-preview":case"gpt-4-turbo-2024-04-09":case"gpt-4-0125-preview":case"gpt-4-1106-preview":return 128e3;case"gpt-4-32k":case"gpt-4-32k-0314":case"gpt-4-32k-0613":case"gemini-pro":case"gemini-pro-vision":return 32768;case"gpt-4":case"gpt-4-0314":case"gpt-4-0613":return 8192;case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-16k-0613":return 16384;case"gpt-3.5-turbo":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-1106":case"gpt-3.5-turbo-0125":return 4096;case"text-davinci-003":case"text-davinci-002":default:return 4097;case"text-davinci-001":return 2049;case"text-curie-001":case"text-babbage-001":case"text-ada-001":case"code-cushman-001":return 2048;case"code-davinci-002":case"code-davinci-001":return 8e3;case"claude-3-5-sonnet-20241022":case"claude-3-5-sonnet-20240620":case"claude-3-opus-20240229":case"claude-3-sonnet-20240229":case"claude-3-haiku-20240307":case"claude-2.1":return 2e5;case"claude-2.0":case"claude-instant-1.2":return 1e5;case"gemini-1.5-pro":case"gemini-1.5-pro-latest":case"gemini-1.5-flash":case"gemini-1.5-flash-latest":return 1e6}};function px(a){return"object"==typeof a&&!!a&&("type"in a&&"function"===a.type&&"function"in a&&"object"==typeof a.function&&!!a.function&&"name"in a.function&&"parameters"in a.function||!1)}let py=async({prompt:a,modelName:b})=>{let c;try{c=(await pt(pu(b))).encode(a).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),c=Math.ceil(a.length/4)}return pw(b)-c};var pz=class extends oH{verbose;callbacks;tags;metadata;get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(a){super(a),this.verbose=a.verbose??!1,this.callbacks=a.callbacks,this.tags=a.tags??[],this.metadata=a.metadata??{}}},pA=class extends pz{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}caller;cache;constructor({callbacks:a,callbackManager:b,...c}){const{cache:d,...e}=c;super({callbacks:a??b,...e}),"object"==typeof d?this.cache=d:d?this.cache=pm.global():this.cache=void 0,this.caller=new or(c??{})}_encoding;async getNumTokens(a){let b,c=Math.ceil((b="string"==typeof a?a:a.map(a=>"string"==typeof a?a:"text"===a.type&&"text"in a?a.text:"").join("")).length/4);if(!this._encoding)try{this._encoding=await pt("modelName"in this?pu(this.modelName):"gpt2")}catch(a){console.warn("Failed to calculate number of tokens, falling back to approximate count",a)}if(this._encoding)try{c=this._encoding.encode(b).length}catch(a){console.warn("Failed to calculate number of tokens, falling back to approximate count",a)}return c}static _convertInputToPromptValue(a){return"string"==typeof a?new o7(a):Array.isArray(a)?new o8(a.map(e1)):a}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:a,...b}){return Object.entries({...this._identifyingParams(),...b,_type:this._llmType(),_model:this._modelType()}).filter(([a,b])=>void 0!==b).map(([a,b])=>`${a}:${JSON.stringify(b)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(a){throw Error("Use .toJSON() instead")}get profile(){return{}}},pB=class extends oH{static lc_name(){return"RunnablePassthrough"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;func;constructor(a){super(a),a&&(this.func=a.func)}async invoke(a,b){let c=g5(b);return this.func&&await this.func(a,c),this._callWithConfig(a=>Promise.resolve(a),a,c)}async *transform(a,b){let c,d=g5(b),e=!0;for await(let b of this._transformStreamWithConfig(a,a=>a,d))if(yield b,e)if(void 0===c)c=b;else try{c=hc(c,b)}catch{c=void 0,e=!1}this.func&&void 0!==c&&await this.func(c,d)}static assign(a){return new oS(new oM({steps:a}))}};function pC(a){return new a.constructor({...a,content:a.contentBlocks,response_metadata:{...a.response_metadata,output_version:"v1"}})}function pD(a){let b=[];for(let c of a){let a=c;if(Array.isArray(c.content))for(let b=0;b<c.content.length;b++){let d=c.content[b];(dI(d)||dJ(d))&&a===c&&(a=new c.constructor({...a,content:[...c.content.slice(0,b),dM(d),...c.content.slice(b+1)]}))}b.push(a)}return b}dy({},{BaseChatModel:()=>pE,SimpleChatModel:()=>pF});var pE=class a extends pA{lc_namespace=["langchain","chat_models",this._llmType()];disableStreaming=!1;outputVersion;get callKeys(){return[...super.callKeys,"outputVersion"]}constructor(a){super(a),this.outputVersion=(()=>{let b=a.outputVersion??dG("LC_OUTPUT_VERSION");return b&&["v0","v1"].includes(b)?b:"v0"})()}_separateRunnableConfigFromCallOptionsCompat(a){let[b,c]=super._separateRunnableConfigFromCallOptions(a);return c.signal=b.signal,[b,c]}async invoke(b,c){let d=a._convertInputToPromptValue(b);return(await this.generatePrompt([d],c,c?.callbacks)).generations[0][0].message}async *_streamResponseChunks(a,b,c){throw Error("Not implemented.")}async *_streamIterator(b,c){if(this._streamResponseChunks===a.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(b,c);else{let d,e,f=a._convertInputToPromptValue(b).toChatMessages(),[g,h]=this._separateRunnableConfigFromCallOptionsCompat(c),i={...g.metadata,...this.getLsParams(h)},j=await gY.configure(g.callbacks,this.callbacks,g.tags,this.tags,i,this.metadata,{verbose:this.verbose}),k={options:h,invocation_params:this?.invocationParams(h),batch_size:1},l=h.outputVersion??this.outputVersion,m=await j?.handleChatModelStart(this.toJSON(),[pD(f)],g.runId,void 0,k,void 0,void 0,g.runName);try{for await(let a of this._streamResponseChunks(f,h,m?.[0])){if(null==a.message.id){let b=m?.at(0)?.runId;null!=b&&a.message._updateId(`run-${b}`)}a.message.response_metadata={...a.generationInfo,...a.message.response_metadata},"v1"===l?yield pC(a.message):yield a.message,d=d?d.concat(a):a,eY(a.message)&&void 0!==a.message.usage_metadata&&(e={tokenUsage:{promptTokens:a.message.usage_metadata.input_tokens,completionTokens:a.message.usage_metadata.output_tokens,totalTokens:a.message.usage_metadata.total_tokens}})}}catch(a){throw await Promise.all((m??[]).map(b=>b?.handleLLMError(a))),a}await Promise.all((m??[]).map(a=>a?.handleLLMEnd({generations:[[d]],llmOutput:e})))}}getLsParams(a){let b=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:a.stop,ls_provider:b}}async _generateUncached(b,c,d,e){let f,g=b.map(a=>a.map(e1));if(void 0!==e&&e.length===g.length)f=e;else{let a={...d.metadata,...this.getLsParams(c)},b=await gY.configure(d.callbacks,this.callbacks,d.tags,this.tags,a,this.metadata,{verbose:this.verbose}),e={options:c,invocation_params:this?.invocationParams(c),batch_size:1};f=await b?.handleChatModelStart(this.toJSON(),g.map(pD),d.runId,void 0,e,void 0,void 0,d.runName)}let h=c.outputVersion??this.outputVersion,i=[],j=[];if(f?.[0].handlers.find(fi)&&!this.disableStreaming&&1===g.length&&this._streamResponseChunks!==a.prototype._streamResponseChunks)try{let a,b;for await(let d of(await this._streamResponseChunks(g[0],c,f?.[0]))){if(null==d.message.id){let a=f?.at(0)?.runId;null!=a&&d.message._updateId(`run-${a}`)}a=void 0===a?d:hc(a,d),eY(d.message)&&void 0!==d.message.usage_metadata&&(b={tokenUsage:{promptTokens:d.message.usage_metadata.input_tokens,completionTokens:d.message.usage_metadata.output_tokens,totalTokens:d.message.usage_metadata.total_tokens}})}if(void 0===a)throw Error("Received empty response from chat model call.");i.push([a]),await f?.[0].handleLLMEnd({generations:i,llmOutput:b})}catch(a){throw await f?.[0].handleLLMError(a),a}else{let a=await Promise.allSettled(g.map(async(a,b)=>{let d=await this._generate(a,{...c,promptIndex:b},f?.[b]);if("v1"===h)for(let a of d.generations)a.message=pC(a.message);return d}));await Promise.all(a.map(async(a,b)=>{if("fulfilled"!==a.status)return await f?.[b]?.handleLLMError(a.reason),Promise.reject(a.reason);{let c=a.value;for(let a of c.generations){if(null==a.message.id){let b=f?.at(0)?.runId;null!=b&&a.message._updateId(`run-${b}`)}a.message.response_metadata={...a.generationInfo,...a.message.response_metadata}}return 1===c.generations.length&&(c.generations[0].message.response_metadata={...c.llmOutput,...c.generations[0].message.response_metadata}),i[b]=c.generations,j[b]=c.llmOutput,f?.[b]?.handleLLMEnd({generations:[c.generations],llmOutput:c.llmOutput})}}))}let k={generations:i,llmOutput:j.length?this._combineLLMOutput?.(...j):void 0};return Object.defineProperty(k,hf,{value:f?{runIds:f?.map(a=>a.runId)}:void 0,configurable:!0}),k}async _generateCached({messages:b,cache:c,llmStringKey:d,parsedOptions:e,handledOptions:f}){let g=b.map(a=>a.map(e1)),h={...f.metadata,...this.getLsParams(e)},i=await gY.configure(f.callbacks,this.callbacks,f.tags,this.tags,h,this.metadata,{verbose:this.verbose}),j={options:e,invocation_params:this?.invocationParams(e),batch_size:1},k=await i?.handleChatModelStart(this.toJSON(),g.map(pD),f.runId,void 0,j,void 0,void 0,f.runName),l=[],m=(await Promise.allSettled(g.map(async(b,e)=>{let f=a._convertInputToPromptValue(b).toString(),g=await c.lookup(f,d);return null==g&&l.push(e),g}))).map((a,b)=>({result:a,runManager:k?.[b]})).filter(({result:a})=>"fulfilled"===a.status&&null!=a.value||"rejected"===a.status),n=e.outputVersion??this.outputVersion,o=[];await Promise.all(m.map(async({result:a,runManager:b},c)=>{if("fulfilled"!==a.status)return await b?.handleLLMError(a.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(a.reason);{let d=a.value;return o[c]=d.map(a=>("message"in a&&ek(a.message)&&eX(a.message)&&(a.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0},"v1"===n&&(a.message=pC(a.message))),a.generationInfo={...a.generationInfo,tokenUsage:{}},a)),d.length&&await b?.handleLLMNewToken(d[0].text),b?.handleLLMEnd({generations:[d]},void 0,void 0,void 0,{cached:!0})}}));let p={generations:o,missingPromptIndices:l,startedRunManagers:k};return Object.defineProperty(p,hf,{value:k?{runIds:k?.map(a=>a.runId)}:void 0,configurable:!0}),p}async generate(b,c,d){let e;e=Array.isArray(c)?{stop:c}:c;let f=b.map(a=>a.map(e1)),[g,h]=this._separateRunnableConfigFromCallOptionsCompat(e);if(g.callbacks=g.callbacks??d,!this.cache)return this._generateUncached(f,h,g);let{cache:i}=this,j=this._getSerializedCacheKeyParametersForCall(h),{generations:k,missingPromptIndices:l,startedRunManagers:m}=await this._generateCached({messages:f,cache:i,llmStringKey:j,parsedOptions:h,handledOptions:g}),n={};if(l.length>0){let b=await this._generateUncached(l.map(a=>f[a]),h,g,void 0!==m?l.map(a=>m?.[a]):void 0);await Promise.all(b.generations.map(async(b,c)=>{let d=l[c];k[d]=b;let e=a._convertInputToPromptValue(f[d]).toString();return i.update(e,j,b)})),n=b.llmOutput??{}}return{generations:k,llmOutput:n}}invocationParams(a){return{}}_modelType(){return"base_chat_model"}async generatePrompt(a,b,c){let d=a.map(a=>a.toChatMessages());return this.generate(d,b,c)}withStructuredOutput(a,b){let c;if("function"!=typeof this.bindTools)throw Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(b?.strict)throw Error('"strict" mode is not supported for this model by default.');let d=b?.name,e=mJ(a)??"A function available to call.",f=b?.method,g=b?.includeRaw;if("jsonMode"===f)throw Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let h=d??"extract";mB(a)?c=[{type:"function",function:{name:h,description:e,parameters:nN(a)}}]:("name"in a&&(h=a.name),c=[{type:"function",function:{name:h,description:e,parameters:a}}]);let i=this.bindTools(c),j=oO.from(a=>{if(!eZ.isInstance(a))throw Error("Input is not an AIMessageChunk.");if(!a.tool_calls||0===a.tool_calls.length)throw Error("No tool calls found in the response.");let b=a.tool_calls.find(a=>a.name===h);if(!b)throw Error(`No tool call found with name ${h}.`);return b.args});if(!g)return i.pipe(j).withConfig({runName:"StructuredOutput"});let k=pB.assign({parsed:(a,b)=>j.invoke(a.raw,b)}),l=pB.assign({parsed:()=>null}),m=k.withFallbacks({fallbacks:[l]});return oL.from([{raw:i},m]).withConfig({runName:"StructuredOutputRunnable"})}},pF=class extends pE{async _generate(a,b,c){let d=new eW(await this._call(a,b,c));if("string"!=typeof d.content)throw Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:d.content,message:d}]}}},pG=class extends oH{static lc_name(){return"RouterRunnable"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;runnables;constructor(a){super(a),this.runnables=a.runnables}async invoke(a,b){let{key:c,input:d}=a,e=this.runnables[c];if(void 0===e)throw Error(`No runnable associated with key "${c}".`);return e.invoke(d,g5(b))}async batch(a,b,c){let d=a.map(a=>a.key),e=a.map(a=>a.input);if(void 0!==d.find(a=>void 0===this.runnables[a]))throw Error("One or more keys do not have a corresponding runnable.");let f=d.map(a=>this.runnables[a]),g=this._getOptionsList(b??{},a.length),h=g[0]?.maxConcurrency??c?.maxConcurrency,i=h&&h>0?h:a.length,j=[];for(let a=0;a<e.length;a+=i){let b=e.slice(a,a+i).map((a,b)=>f[b].invoke(a,g[b])),c=await Promise.all(b);j.push(c)}return j.flat()}async stream(a,b){let{key:c,input:d}=a,e=this.runnables[c];if(void 0===e)throw Error(`No runnable associated with key "${c}".`);return e.stream(d,b)}},pH=class extends oH{static lc_name(){return"RunnableBranch"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;default;branches;constructor(a){super(a),this.branches=a.branches,this.default=a.default}static from(a){if(a.length<1)throw Error("RunnableBranch requires at least one branch");return new this({branches:a.slice(0,-1).map(([a,b])=>[oR(a),oR(b)]),default:oR(a[a.length-1])})}async _invoke(a,b,c){let d;for(let e=0;e<this.branches.length;e+=1){let[f,g]=this.branches[e];if(await f.invoke(a,g6(b,{callbacks:c?.getChild(`condition:${e+1}`)}))){d=await g.invoke(a,g6(b,{callbacks:c?.getChild(`branch:${e+1}`)}));break}}return d||(d=await this.default.invoke(a,g6(b,{callbacks:c?.getChild("branch:default")}))),d}async invoke(a,b={}){return this._callWithConfig(this._invoke,a,b)}async *_streamIterator(a,b){let c,d,e=await g2(b),f=await e?.handleChainStart(this.toJSON(),oG(a,"input"),b?.runId,void 0,void 0,void 0,b?.runName),g=!0;try{for(let e=0;e<this.branches.length;e+=1){let[h,i]=this.branches[e];if(await h.invoke(a,g6(b,{callbacks:f?.getChild(`condition:${e+1}`)}))){for await(let h of d=await i.stream(a,g6(b,{callbacks:f?.getChild(`branch:${e+1}`)})))if(yield h,g)if(void 0===c)c=h;else try{c=hc(c,h)}catch{c=void 0,g=!1}break}}if(void 0===d){for await(let e of d=await this.default.stream(a,g6(b,{callbacks:f?.getChild("branch:default")})))if(yield e,g)if(void 0===c)c=e;else try{c=hc(c,e)}catch{c=void 0,g=!1}}}catch(a){throw await f?.handleChainError(a),a}await f?.handleChainEnd(c??{})}},pI=class extends oI{runnable;inputMessagesKey;outputMessagesKey;historyMessagesKey;getMessageHistory;constructor(a){let b=oO.from((a,b)=>this._enterHistory(a,b??{})).withConfig({runName:"loadHistory"});const c=a.historyMessagesKey??a.inputMessagesKey;c&&(b=pB.assign({[c]:b}).withConfig({runName:"insertHistory"})),super({...a,config:a.config??{},bound:b.pipe(a.runnable.withListeners({onEnd:(a,b)=>this._exitHistory(a,b??{})})).withConfig({runName:"RunnableWithMessageHistory"})}),this.runnable=a.runnable,this.getMessageHistory=a.getMessageHistory,this.inputMessagesKey=a.inputMessagesKey,this.outputMessagesKey=a.outputMessagesKey,this.historyMessagesKey=a.historyMessagesKey}_getInputMessages(a){let b;if("object"!=typeof a||Array.isArray(a)||ek(a))b=a;else{let c;c=this.inputMessagesKey?this.inputMessagesKey:1===Object.keys(a).length?Object.keys(a)[0]:"input",b=Array.isArray(a[c])&&Array.isArray(a[c][0])?a[c][0]:a[c]}if("string"==typeof b)return[new eF(b)];if(Array.isArray(b))return b;if(ek(b))return[b];throw Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(b,null,2)}`)}_getOutputMessages(a){let b;if(Array.isArray(a)||ek(a)||"string"==typeof a)b=a;else{let c;c=void 0!==this.outputMessagesKey?this.outputMessagesKey:1===Object.keys(a).length?Object.keys(a)[0]:"output",b=void 0!==a.generations?a.generations[0][0].message:a[c]}if("string"==typeof b)return[new eW(b)];if(Array.isArray(b))return b;if(ek(b))return[b];throw Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(b,null,2)}`)}async _enterHistory(a,b){let c=b?.configurable?.messageHistory,d=await c.getMessages();return void 0===this.historyMessagesKey?d.concat(this._getInputMessages(a)):d}async _exitHistory(a,b){let c,d=b.configurable?.messageHistory;c=Array.isArray(a.inputs)&&Array.isArray(a.inputs[0])?a.inputs[0]:a.inputs;let e=this._getInputMessages(c);if(void 0===this.historyMessagesKey){let a=await d.getMessages();e=e.slice(a.length)}let f=a.outputs;if(!f)throw Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(a,null,2)}`);let g=this._getOutputMessages(f);await d.addMessages([...e,...g])}async _mergeConfig(...a){let b=await super._mergeConfig(...a);if(!b.configurable||!b.configurable.sessionId){let a={[this.inputMessagesKey??"input"]:"foo"};throw Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(a)}, ${JSON.stringify({configurable:{sessionId:"123"}})})`)}let{sessionId:c}=b.configurable;return b.configurable.messageHistory=await this.getMessageHistory(c),b}};dy({},{RouterRunnable:()=>pG,Runnable:()=>oH,RunnableAssign:()=>oS,RunnableBinding:()=>oI,RunnableBranch:()=>pH,RunnableEach:()=>oJ,RunnableLambda:()=>oO,RunnableMap:()=>oM,RunnableParallel:()=>oP,RunnablePassthrough:()=>pB,RunnablePick:()=>oT,RunnableRetry:()=>oK,RunnableSequence:()=>oL,RunnableToolLike:()=>oU,RunnableWithFallbacks:()=>oQ,RunnableWithMessageHistory:()=>pI,_coerceToRunnable:()=>oR,ensureConfig:()=>g5,getCallbackManagerForConfig:()=>g2,mergeConfigs:()=>g3,patchConfig:()=>g6,pickRunnableConfigKeys:()=>g7,raceWithSignal:()=>g8}),dy({},{extendInteropZodObject:()=>mT,getInteropZodDefaultGetter:()=>mW,getInteropZodObjectShape:()=>mS,getSchemaDescription:()=>mJ,interopParse:()=>mI,interopParseAsync:()=>mG,interopSafeParse:()=>mH,interopSafeParseAsync:()=>mF,interopZodObjectMakeFieldsOptional:()=>mY,interopZodObjectPartial:()=>mU,interopZodObjectPassthrough:()=>function a(b,c=!1){if(mM(b))return b.passthrough();if(mN(b)){let d=b._zod.def.shape;if(c)for(let[e,f]of Object.entries(b._zod.def.shape)){if(mN(f)){let b=a(f,c);d[e]=b}else if(mO(f)){let b=f._zod.def.element;mN(b)&&(b=a(b,c)),d[e]=hN(f,{...f._zod.def,element:b})}else d[e]=f;let b=kN.get(f);b&&kN.add(d[e],b)}let e=hN(b,{...b._zod.def,shape:d,catchall:lw(j$)}),f=kN.get(b);return f&&kN.add(e,f),e}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")},interopZodObjectStrict:()=>mV,interopZodTransformInputSchema:()=>mX,isInteropZodError:()=>mZ,isInteropZodLiteral:()=>mE,isInteropZodObject:()=>mR,isInteropZodSchema:()=>mB,isShapelessZodSchema:()=>mK,isSimpleStringZodSchema:()=>mL,isZodArrayV4:()=>mO,isZodLiteralV3:()=>mC,isZodLiteralV4:()=>mD,isZodNullableV4:()=>mQ,isZodObjectV3:()=>mM,isZodObjectV4:()=>mN,isZodOptionalV4:()=>mP,isZodSchema:()=>mA,isZodSchemaV3:()=>mz,isZodSchemaV4:()=>my});var pJ=class extends oH{parseResultWithPrompt(a,b,c){return this.parseResult(a,c)}_baseMessageToString(a){return"string"==typeof a.content?a.content:this._baseMessageContentToString(a.content)}_baseMessageContentToString(a){return JSON.stringify(a)}async invoke(a,b){return"string"==typeof a?this._callWithConfig(async(a,b)=>this.parseResult([{text:a}],b?.callbacks),a,{...b,runType:"parser"}):this._callWithConfig(async(a,b)=>this.parseResult([{message:a,text:this._baseMessageToString(a)}],b?.callbacks),a,{...b,runType:"parser"})}},pK=class extends pJ{parseResult(a,b){return this.parse(a[0].text,b)}async parseWithPrompt(a,b,c){return this.parse(a,c)}_type(){throw Error("_type not implemented")}},pL=class extends Error{llmOutput;observation;sendToLLM;constructor(a,b,c,d=!1){if(super(a),this.llmOutput=b,this.observation=c,this.sendToLLM=d,d&&(void 0===c||void 0===b))throw Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");es(this,"OUTPUT_PARSING_FAILURE")}},pM=class extends pK{async *_transform(a){for await(let b of a)"string"==typeof b?yield this.parseResult([{text:b}]):yield this.parseResult([{message:b,text:this._baseMessageToString(b)}])}async *transform(a,b){yield*this._transformStreamWithConfig(a,this._transform.bind(this),{...b,runType:"parser"})}},pN=class extends pM{diff=!1;constructor(a){super(a),this.diff=a?.diff??this.diff}async *_transform(a){let b,c;for await(let d of a){let a;if("string"!=typeof d&&"string"!=typeof d.content)throw Error("Cannot handle non-string output.");if(el(d)){if("string"!=typeof d.content)throw Error("Cannot handle non-string message output.");a=new hh({message:d,text:d.content})}else if(ek(d)){if("string"!=typeof d.content)throw Error("Cannot handle non-string message output.");a=new hh({message:e6(d),text:d.content})}else a=new hg({text:d});c=void 0===c?a:c.concat(a);let e=await this.parsePartialResult([c]);null==e||nt(e,b)||(this.diff?yield this._diff(b,e):yield e,b=e)}}getFormatInstructions(){return""}};dy({},{applyPatch:()=>oa,compare:()=>of});var pO=class extends pN{static lc_name(){return"JsonOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_concatOutputChunks(a,b){return this.diff?super._concatOutputChunks(a,b):b}_diff(a,b){if(b)return a?of(a,b):[{op:"replace",path:"",value:b}]}async parsePartialResult(a){return ev(a[0].text)}async parse(a){return ev(a,JSON.parse)}getFormatInstructions(){return""}},pP=class extends pM{static lc_name(){return"BytesOutputParser"}lc_namespace=["langchain_core","output_parsers","bytes"];lc_serializable=!0;textEncoder=new TextEncoder;parse(a){return Promise.resolve(this.textEncoder.encode(a))}getFormatInstructions(){return""}},pQ=class extends pM{re;async *_transform(a){let b="";for await(let c of a)if("string"==typeof c?b+=c:b+=c.content,this.re){let a=[...b.matchAll(this.re)];if(a.length>1){let c=0;for(let b of a.slice(0,-1))yield[b[1]],c+=(b.index??0)+b[0].length;b=b.slice(c)}}else{let a=await this.parse(b);if(a.length>1){for(let b of a.slice(0,-1))yield[b];b=a[a.length-1]}}for(let a of(await this.parse(b)))yield[a]}},pR=class extends pQ{static lc_name(){return"CommaSeparatedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;async parse(a){try{return a.trim().split(",").map(a=>a.trim())}catch{throw new pL(`Could not parse output: ${a}`,a)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},pS=class extends pQ{lc_namespace=["langchain_core","output_parsers","list"];length;separator;constructor({length:a,separator:b}){super(...arguments),this.length=a,this.separator=b||","}async parse(a){try{let b=a.trim().split(this.separator).map(a=>a.trim());if(void 0!==this.length&&b.length!==this.length)throw new pL(`Incorrect number of items. Expected ${this.length}, got ${b.length}.`);return b}catch(b){if(Object.getPrototypeOf(b)===pL.prototype)throw b;throw new pL(`Could not parse output: ${a}`)}}getFormatInstructions(){return`Your response should be a list of ${void 0===this.length?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},pT=class extends pQ{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/\d+\.\s([^\n]+)/g;async parse(a){return[...a.matchAll(this.re)??[]].map(a=>a[1])}},pU=class extends pQ{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/^\s*[-*]\s([^\n]+)$/gm;async parse(a){return[...a.matchAll(this.re)??[]].map(a=>a[1])}},pV=class extends pM{static lc_name(){return"StrOutputParser"}lc_namespace=["langchain_core","output_parsers","string"];lc_serializable=!0;parse(a){return Promise.resolve(a)}getFormatInstructions(){return""}_textContentToString(a){return a.text}_imageUrlContentToString(a){throw Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentToString(a){switch(a.type){case"text":case"text_delta":if("text"in a)return this._textContentToString(a);break;case"image_url":if("image_url"in a)return this._imageUrlContentToString(a);break;default:throw Error(`Cannot coerce "${a.type}" message part into a string.`)}throw Error(`Invalid content type: ${a.type}`)}_baseMessageContentToString(a){return a.reduce((a,b)=>a+this._messageContentToString(b),"")}},pW=class extends pK{static lc_name(){return"StructuredOutputParser"}lc_namespace=["langchain","output_parsers","structured"];toJSON(){return this.toJSONNotImplemented()}constructor(a){super(a),this.schema=a}static fromZodSchema(a){return new this(a)}static fromNamesAndDescriptions(a){return new this(oF.z.object(Object.fromEntries(Object.entries(a).map(([a,b])=>[a,oF.z.string().describe(b)]))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(nN(this.schema))}
\`\`\`
`}async parse(a){try{let b=a.trim(),c=(b.match(/^```(?:json)?\s*([\s\S]*?)```/)?.[1]||b.match(/```json\s*([\s\S]*?)```/)?.[1]||b).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(a,b)=>{let c=b.replace(/\n/g,"\\n");return`"${c}"`}).replace(/\n/g,"");return await mG(this.schema,JSON.parse(c))}catch(b){throw new pL(`Failed to parse. Text: "${a}". Error: ${b}`,a)}}},pX=class extends pW{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(a){let b=a?.interpolationDepth??1;if(b<1)throw Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(nN(this.schema)).replaceAll("{","{".repeat(b)).replaceAll("}","}".repeat(b))}
\`\`\``}_schemaToInstruction(a,b=2){if("type"in a){let c,d=!1;if(Array.isArray(a.type)){let b=a.type.findIndex(a=>"null"===a);-1!==b&&(d=!0,a.type.splice(b,1)),c=a.type.join(" | ")}else c=a.type;if("object"===a.type&&a.properties){let c=a.description?` // ${a.description}`:"",d=Object.entries(a.properties).map(([c,d])=>{let e=a.required?.includes(c)?"":" (optional)";return`${" ".repeat(b)}"${c}": ${this._schemaToInstruction(d,b+2)}${e}`}).join("\n");return`{
${d}
${" ".repeat(b-2)}}${c}`}if("array"===a.type&&a.items){let c=a.description?` // ${a.description}`:"";return`array[
${" ".repeat(b)}${this._schemaToInstruction(a.items,b+2)}
${" ".repeat(b-2)}] ${c}`}let e=d?" (nullable)":"",f=a.description?` // ${a.description}`:"";return`${c}${f}${e}`}if("anyOf"in a)return a.anyOf.map(a=>this._schemaToInstruction(a,b)).join(`
${" ".repeat(b-2)}`);throw Error("unsupported schema type")}static fromZodSchema(a){return new this(a)}static fromNamesAndDescriptions(a){return new this(oF.z.object(Object.fromEntries(Object.entries(a).map(([a,b])=>[a,oF.z.string().describe(b)]))))}},pY=class extends pK{structuredInputParser;constructor({inputSchema:a}){super(...arguments),this.structuredInputParser=new pX(a)}async parse(a){let b;try{b=await this.structuredInputParser.parse(a)}catch(b){throw new pL(`Failed to parse. Text: "${a}". Error: ${b}`,a)}return this.outputProcessor(b)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}};let pZ=function(){let a={};a.parser=function(a,b){return new c(a,b)},a.SAXParser=c,a.SAXStream=i,a.createStream=function(a,b){return new i(a,b)},a.MAX_BUFFER_LENGTH=65536;let b=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function c(d,e){if(!(this instanceof c))return new c(d,e);(function(a){for(var c=0,d=b.length;c<d;c++)a[b[c]]=""})(this),this.q=this.c="",this.bufferCheckPosition=a.MAX_BUFFER_LENGTH,this.opt=e||{},this.opt.lowercase=this.opt.lowercase||this.opt.lowercasetags,this.looseCase=this.opt.lowercase?"toLowerCase":"toUpperCase",this.tags=[],this.closed=this.closedRoot=this.sawRoot=!1,this.tag=this.error=null,this.strict=!!d,this.noscript=!!(d||this.opt.noscript),this.state=t.BEGIN,this.strictEntities=this.opt.strictEntities,this.ENTITIES=this.strictEntities?Object.create(a.XML_ENTITIES):Object.create(a.ENTITIES),this.attribList=[],this.opt.xmlns&&(this.ns=Object.create(l)),this.trackPosition=!1!==this.opt.position,this.trackPosition&&(this.position=this.line=this.column=0),v(this,"onready")}a.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(a){function b(){}return b.prototype=a,new b}),Object.keys||(Object.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}),c.prototype={end:function(){A(this)},write:function(c){if(this.error)throw this.error;if(this.closed)return z(this,"Cannot write after close. Assign an onready handler.");if(null===c)return A(this);"object"==typeof c&&(c=c.toString());for(var d=0,e="";e=I(c,d++),this.c=e,e;)switch(this.trackPosition&&(this.position++,"\n"===e?(this.line++,this.column=0):this.column++),this.state){case t.BEGIN:if(this.state=t.BEGIN_WHITESPACE,"\uFEFF"===e)continue;H(this,e);continue;case t.BEGIN_WHITESPACE:H(this,e);continue;case t.TEXT:if(this.sawRoot&&!this.closedRoot){for(var f=d-1;e&&"<"!==e&&"&"!==e;)(e=I(c,d++))&&this.trackPosition&&(this.position++,"\n"===e?(this.line++,this.column=0):this.column++);this.textNode+=c.substring(f,d-1)}"<"!==e||this.sawRoot&&this.closedRoot&&!this.strict?(q(e)||this.sawRoot&&!this.closedRoot||B(this,"Text data outside of root node."),"&"===e?this.state=t.TEXT_ENTITY:this.textNode+=e):(this.state=t.OPEN_WAKA,this.startTagPosition=this.position);continue;case t.SCRIPT:"<"===e?this.state=t.SCRIPT_ENDING:this.script+=e;continue;case t.SCRIPT_ENDING:"/"===e?this.state=t.CLOSE_TAG:(this.script+="<"+e,this.state=t.SCRIPT);continue;case t.OPEN_WAKA:"!"===e?(this.state=t.SGML_DECL,this.sgmlDecl=""):q(e)||(s(m,e)?(this.state=t.OPEN_TAG,this.tagName=e):"/"===e?(this.state=t.CLOSE_TAG,this.tagName=""):"?"===e?(this.state=t.PROC_INST,this.procInstName=this.procInstBody=""):(B(this,"Unencoded <"),this.startTagPosition+1<this.position&&(e=Array(this.position-this.startTagPosition).join(" ")+e),this.textNode+="<"+e,this.state=t.TEXT));continue;case t.SGML_DECL:"[CDATA["===(this.sgmlDecl+e).toUpperCase()?(w(this,"onopencdata"),this.state=t.CDATA,this.sgmlDecl="",this.cdata=""):this.sgmlDecl+e==="--"?(this.state=t.COMMENT,this.comment="",this.sgmlDecl=""):"DOCTYPE"===(this.sgmlDecl+e).toUpperCase()?(this.state=t.DOCTYPE,(this.doctype||this.sawRoot)&&B(this,"Inappropriately located doctype declaration"),this.doctype="",this.sgmlDecl=""):">"===e?(w(this,"onsgmldeclaration",this.sgmlDecl),this.sgmlDecl="",this.state=t.TEXT):(r(e)&&(this.state=t.SGML_DECL_QUOTED),this.sgmlDecl+=e);continue;case t.SGML_DECL_QUOTED:e===this.q&&(this.state=t.SGML_DECL,this.q=""),this.sgmlDecl+=e;continue;case t.DOCTYPE:">"===e?(this.state=t.TEXT,w(this,"ondoctype",this.doctype),this.doctype=!0):(this.doctype+=e,"["===e?this.state=t.DOCTYPE_DTD:r(e)&&(this.state=t.DOCTYPE_QUOTED,this.q=e));continue;case t.DOCTYPE_QUOTED:this.doctype+=e,e===this.q&&(this.q="",this.state=t.DOCTYPE);continue;case t.DOCTYPE_DTD:this.doctype+=e,"]"===e?this.state=t.DOCTYPE:r(e)&&(this.state=t.DOCTYPE_DTD_QUOTED,this.q=e);continue;case t.DOCTYPE_DTD_QUOTED:this.doctype+=e,e===this.q&&(this.state=t.DOCTYPE_DTD,this.q="");continue;case t.COMMENT:"-"===e?this.state=t.COMMENT_ENDING:this.comment+=e;continue;case t.COMMENT_ENDING:"-"===e?(this.state=t.COMMENT_ENDED,this.comment=y(this.opt,this.comment),this.comment&&w(this,"oncomment",this.comment),this.comment=""):(this.comment+="-"+e,this.state=t.COMMENT);continue;case t.COMMENT_ENDED:">"!==e?(B(this,"Malformed comment"),this.comment+="--"+e,this.state=t.COMMENT):this.state=t.TEXT;continue;case t.CDATA:"]"===e?this.state=t.CDATA_ENDING:this.cdata+=e;continue;case t.CDATA_ENDING:"]"===e?this.state=t.CDATA_ENDING_2:(this.cdata+="]"+e,this.state=t.CDATA);continue;case t.CDATA_ENDING_2:">"===e?(this.cdata&&w(this,"oncdata",this.cdata),w(this,"onclosecdata"),this.cdata="",this.state=t.TEXT):"]"===e?this.cdata+="]":(this.cdata+="]]"+e,this.state=t.CDATA);continue;case t.PROC_INST:"?"===e?this.state=t.PROC_INST_ENDING:q(e)?this.state=t.PROC_INST_BODY:this.procInstName+=e;continue;case t.PROC_INST_BODY:!this.procInstBody&&q(e)||("?"===e?this.state=t.PROC_INST_ENDING:this.procInstBody+=e);continue;case t.PROC_INST_ENDING:">"===e?(w(this,"onprocessinginstruction",{name:this.procInstName,body:this.procInstBody}),this.procInstName=this.procInstBody="",this.state=t.TEXT):(this.procInstBody+="?"+e,this.state=t.PROC_INST_BODY);continue;case t.OPEN_TAG:s(n,e)?this.tagName+=e:(!function(a){a.strict||(a.tagName=a.tagName[a.looseCase]());var b=a.tags[a.tags.length-1]||a,c=a.tag={name:a.tagName,attributes:{}};a.opt.xmlns&&(c.ns=b.ns),a.attribList.length=0,w(a,"onopentagstart",c)}(this),">"===e?E(this):"/"===e?this.state=t.OPEN_TAG_SLASH:(q(e)||B(this,"Invalid character in tag name"),this.state=t.ATTRIB));continue;case t.OPEN_TAG_SLASH:">"===e?(E(this,!0),F(this)):(B(this,"Forward-slash in opening tag not followed by >"),this.state=t.ATTRIB);continue;case t.ATTRIB:q(e)||(">"===e?E(this):"/"===e?this.state=t.OPEN_TAG_SLASH:s(m,e)?(this.attribName=e,this.attribValue="",this.state=t.ATTRIB_NAME):B(this,"Invalid attribute name"));continue;case t.ATTRIB_NAME:"="===e?this.state=t.ATTRIB_VALUE:">"===e?(B(this,"Attribute without value"),this.attribValue=this.attribName,D(this),E(this)):q(e)?this.state=t.ATTRIB_NAME_SAW_WHITE:s(n,e)?this.attribName+=e:B(this,"Invalid attribute name");continue;case t.ATTRIB_NAME_SAW_WHITE:if("="===e)this.state=t.ATTRIB_VALUE;else{if(q(e))continue;B(this,"Attribute without value"),this.tag.attributes[this.attribName]="",this.attribValue="",w(this,"onattribute",{name:this.attribName,value:""}),this.attribName="",">"===e?E(this):s(m,e)?(this.attribName=e,this.state=t.ATTRIB_NAME):(B(this,"Invalid attribute name"),this.state=t.ATTRIB)}continue;case t.ATTRIB_VALUE:q(e)||(r(e)?(this.q=e,this.state=t.ATTRIB_VALUE_QUOTED):(B(this,"Unquoted attribute value"),this.state=t.ATTRIB_VALUE_UNQUOTED,this.attribValue=e));continue;case t.ATTRIB_VALUE_QUOTED:if(e!==this.q){"&"===e?this.state=t.ATTRIB_VALUE_ENTITY_Q:this.attribValue+=e;continue}D(this),this.q="",this.state=t.ATTRIB_VALUE_CLOSED;continue;case t.ATTRIB_VALUE_CLOSED:q(e)?this.state=t.ATTRIB:">"===e?E(this):"/"===e?this.state=t.OPEN_TAG_SLASH:s(m,e)?(B(this,"No whitespace between attributes"),this.attribName=e,this.attribValue="",this.state=t.ATTRIB_NAME):B(this,"Invalid attribute name");continue;case t.ATTRIB_VALUE_UNQUOTED:if(!(">"===(g=e)||q(g))){"&"===e?this.state=t.ATTRIB_VALUE_ENTITY_U:this.attribValue+=e;continue}D(this),">"===e?E(this):this.state=t.ATTRIB;continue;case t.CLOSE_TAG:this.tagName?">"===e?F(this):s(n,e)?this.tagName+=e:this.script?(this.script+="</"+this.tagName,this.tagName="",this.state=t.SCRIPT):(q(e)||B(this,"Invalid tagname in closing tag"),this.state=t.CLOSE_TAG_SAW_WHITE):q(e)||(s(m,e)?this.tagName=e:this.script?(this.script+="</"+e,this.state=t.SCRIPT):B(this,"Invalid tagname in closing tag."));continue;case t.CLOSE_TAG_SAW_WHITE:if(q(e))continue;">"===e?F(this):B(this,"Invalid characters in closing tag");continue;case t.TEXT_ENTITY:case t.ATTRIB_VALUE_ENTITY_Q:case t.ATTRIB_VALUE_ENTITY_U:switch(this.state){case t.TEXT_ENTITY:h=t.TEXT,i="textNode";break;case t.ATTRIB_VALUE_ENTITY_Q:h=t.ATTRIB_VALUE_QUOTED,i="attribValue";break;case t.ATTRIB_VALUE_ENTITY_U:h=t.ATTRIB_VALUE_UNQUOTED,i="attribValue"}if(";"===e)if(this.opt.unparsedEntities){var g,h,i,j=G(this);this.entity="",this.state=h,this.write(j)}else this[i]+=G(this),this.entity="",this.state=h;else s(this.entity.length?p:o,e)?this.entity+=e:(B(this,"Invalid character in entity name"),this[i]+="&"+this.entity+e,this.entity="",this.state=h);continue;default:throw Error(this,"Unknown state: "+this.state)}return this.position>=this.bufferCheckPosition&&function(c){for(var d=Math.max(a.MAX_BUFFER_LENGTH,10),e=0,f=0,g=b.length;f<g;f++){var h=c[b[f]].length;if(h>d)switch(b[f]){case"textNode":x(c);break;case"cdata":w(c,"oncdata",c.cdata),c.cdata="";break;case"script":w(c,"onscript",c.script),c.script="";break;default:z(c,"Max buffer length exceeded: "+b[f])}e=Math.max(e,h)}c.bufferCheckPosition=a.MAX_BUFFER_LENGTH-e+c.position}(this),this},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){x(this),""!==this.cdata&&(w(this,"oncdata",this.cdata),this.cdata=""),""!==this.script&&(w(this,"onscript",this.script),this.script="")}};var d,e,f,g=ReadableStream;g||(g=function(){});var h=a.EVENTS.filter(function(a){return"error"!==a&&"end"!==a});function i(a,b){if(!(this instanceof i))return new i(a,b);g.apply(this),this._parser=new c(a,b),this.writable=!0,this.readable=!0;var d=this;this._parser.onend=function(){d.emit("end")},this._parser.onerror=function(a){d.emit("error",a),d._parser.error=null},this._decoder=null,h.forEach(function(a){Object.defineProperty(d,"on"+a,{get:function(){return d._parser["on"+a]},set:function(b){if(!b)return d.removeAllListeners(a),d._parser["on"+a]=b,b;d.on(a,b)},enumerable:!0,configurable:!1})})}i.prototype=Object.create(g.prototype,{constructor:{value:i}}),i.prototype.write=function(a){return this._parser.write(a.toString()),this.emit("data",a),!0},i.prototype.end=function(a){return a&&a.length&&this.write(a),this._parser.end(),!0},i.prototype.on=function(a,b){var c=this;return c._parser["on"+a]||-1===h.indexOf(a)||(c._parser["on"+a]=function(){var b=1==arguments.length?[arguments[0]]:Array.apply(null,arguments);b.splice(0,0,a),c.emit.apply(c,b)}),g.prototype.on.call(c,a,b)};var j="http://www.w3.org/XML/1998/namespace",k="http://www.w3.org/2000/xmlns/",l={xml:j,xmlns:k},m=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,n=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,o=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function q(a){return" "===a||"\n"===a||"\r"===a||"	"===a}function r(a){return'"'===a||"'"===a}function s(a,b){return a.test(b)}var t=0;for(var u in a.STATE={BEGIN:t++,BEGIN_WHITESPACE:t++,TEXT:t++,TEXT_ENTITY:t++,OPEN_WAKA:t++,SGML_DECL:t++,SGML_DECL_QUOTED:t++,DOCTYPE:t++,DOCTYPE_QUOTED:t++,DOCTYPE_DTD:t++,DOCTYPE_DTD_QUOTED:t++,COMMENT_STARTING:t++,COMMENT:t++,COMMENT_ENDING:t++,COMMENT_ENDED:t++,CDATA:t++,CDATA_ENDING:t++,CDATA_ENDING_2:t++,PROC_INST:t++,PROC_INST_BODY:t++,PROC_INST_ENDING:t++,OPEN_TAG:t++,OPEN_TAG_SLASH:t++,ATTRIB:t++,ATTRIB_NAME:t++,ATTRIB_NAME_SAW_WHITE:t++,ATTRIB_VALUE:t++,ATTRIB_VALUE_QUOTED:t++,ATTRIB_VALUE_CLOSED:t++,ATTRIB_VALUE_UNQUOTED:t++,ATTRIB_VALUE_ENTITY_Q:t++,ATTRIB_VALUE_ENTITY_U:t++,CLOSE_TAG:t++,CLOSE_TAG_SAW_WHITE:t++,SCRIPT:t++,SCRIPT_ENDING:t++},a.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},a.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(a.ENTITIES).forEach(function(b){var c=a.ENTITIES[b],d="number"==typeof c?String.fromCharCode(c):c;a.ENTITIES[b]=d}),a.STATE)a.STATE[a.STATE[u]]=u;function v(a,b,c){a[b]&&a[b](c)}function w(a,b,c){a.textNode&&x(a),v(a,b,c)}function x(a){a.textNode=y(a.opt,a.textNode),a.textNode&&v(a,"ontext",a.textNode),a.textNode=""}function y(a,b){return a.trim&&(b=b.trim()),a.normalize&&(b=b.replace(/\s+/g," ")),b}function z(a,b){return x(a),a.trackPosition&&(b+="\nLine: "+a.line+"\nColumn: "+a.column+"\nChar: "+a.c),a.error=b=Error(b),v(a,"onerror",b),a}function A(a){return a.sawRoot&&!a.closedRoot&&B(a,"Unclosed root tag"),a.state!==t.BEGIN&&a.state!==t.BEGIN_WHITESPACE&&a.state!==t.TEXT&&z(a,"Unexpected end"),x(a),a.c="",a.closed=!0,v(a,"onend"),c.call(a,a.strict,a.opt),a}function B(a,b){if("object"!=typeof a||!(a instanceof c))throw Error("bad call to strictFail");a.strict&&z(a,b)}function C(a,b){var c=0>a.indexOf(":")?["",a]:a.split(":"),d=c[0],e=c[1];return b&&"xmlns"===a&&(d="xmlns",e=""),{prefix:d,local:e}}function D(a){if(a.strict||(a.attribName=a.attribName[a.looseCase]()),-1!==a.attribList.indexOf(a.attribName)||a.tag.attributes.hasOwnProperty(a.attribName)){a.attribName=a.attribValue="";return}if(a.opt.xmlns){var b=C(a.attribName,!0),c=b.prefix,d=b.local;if("xmlns"===c)if("xml"===d&&a.attribValue!==j)B(a,"xml: prefix must be bound to "+j+"\nActual: "+a.attribValue);else if("xmlns"===d&&a.attribValue!==k)B(a,"xmlns: prefix must be bound to "+k+"\nActual: "+a.attribValue);else{var e=a.tag,f=a.tags[a.tags.length-1]||a;e.ns===f.ns&&(e.ns=Object.create(f.ns)),e.ns[d]=a.attribValue}a.attribList.push([a.attribName,a.attribValue])}else a.tag.attributes[a.attribName]=a.attribValue,w(a,"onattribute",{name:a.attribName,value:a.attribValue});a.attribName=a.attribValue=""}function E(a,b){if(a.opt.xmlns){var c=a.tag,d=C(a.tagName);c.prefix=d.prefix,c.local=d.local,c.uri=c.ns[d.prefix]||"",c.prefix&&!c.uri&&(B(a,"Unbound namespace prefix: "+JSON.stringify(a.tagName)),c.uri=d.prefix);var e=a.tags[a.tags.length-1]||a;c.ns&&e.ns!==c.ns&&Object.keys(c.ns).forEach(function(b){w(a,"onopennamespace",{prefix:b,uri:c.ns[b]})});for(var f=0,g=a.attribList.length;f<g;f++){var h=a.attribList[f],i=h[0],j=h[1],k=C(i,!0),l=k.prefix,m=k.local,n=""===l?"":c.ns[l]||"",o={name:i,value:j,prefix:l,local:m,uri:n};l&&"xmlns"!==l&&!n&&(B(a,"Unbound namespace prefix: "+JSON.stringify(l)),o.uri=l),a.tag.attributes[i]=o,w(a,"onattribute",o)}a.attribList.length=0}a.tag.isSelfClosing=!!b,a.sawRoot=!0,a.tags.push(a.tag),w(a,"onopentag",a.tag),b||(a.noscript||"script"!==a.tagName.toLowerCase()?a.state=t.TEXT:a.state=t.SCRIPT,a.tag=null,a.tagName=""),a.attribName=a.attribValue="",a.attribList.length=0}function F(a){if(!a.tagName){B(a,"Weird empty close tag."),a.textNode+="</>",a.state=t.TEXT;return}if(a.script){if("script"!==a.tagName){a.script+="</"+a.tagName+">",a.tagName="",a.state=t.SCRIPT;return}w(a,"onscript",a.script),a.script=""}var b=a.tags.length,c=a.tagName;a.strict||(c=c[a.looseCase]());for(var d=c;b--;)if(a.tags[b].name!==d)B(a,"Unexpected close tag");else break;if(b<0){B(a,"Unmatched closing tag: "+a.tagName),a.textNode+="</"+a.tagName+">",a.state=t.TEXT;return}a.tagName=c;for(var e=a.tags.length;e-- >b;){var f=a.tag=a.tags.pop();a.tagName=a.tag.name,w(a,"onclosetag",a.tagName);var g={};for(var h in f.ns)g[h]=f.ns[h];var i=a.tags[a.tags.length-1]||a;a.opt.xmlns&&f.ns!==i.ns&&Object.keys(f.ns).forEach(function(b){var c=f.ns[b];w(a,"onclosenamespace",{prefix:b,uri:c})})}0===b&&(a.closedRoot=!0),a.tagName=a.attribValue=a.attribName="",a.attribList.length=0,a.state=t.TEXT}function G(a){var b,c=a.entity,d=c.toLowerCase(),e="";return a.ENTITIES[c]?a.ENTITIES[c]:a.ENTITIES[d]?a.ENTITIES[d]:("#"===(c=d).charAt(0)&&(e="x"===c.charAt(1)?(b=parseInt(c=c.slice(2),16)).toString(16):(b=parseInt(c=c.slice(1),10)).toString(10)),c=c.replace(/^0+/,""),isNaN(b)||e.toLowerCase()!==c)?(B(a,"Invalid character entity"),"&"+a.entity+";"):String.fromCodePoint(b)}function H(a,b){"<"===b?(a.state=t.OPEN_WAKA,a.startTagPosition=a.position):q(b)||(B(a,"Non-whitespace before first tag."),a.textNode=b,a.state=t.TEXT)}function I(a,b){var c="";return b<a.length&&(c=a.charAt(b)),c}return t=a.STATE,String.fromCodePoint||(d=String.fromCharCode,e=Math.floor,f=function(){var a,b,c=[],f=-1,g=arguments.length;if(!g)return"";for(var h="";++f<g;){var i=Number(arguments[f]);if(!isFinite(i)||i<0||i>1114111||e(i)!==i)throw RangeError("Invalid code point: "+i);i<=65535?c.push(i):(i-=65536,a=(i>>10)+55296,b=i%1024+56320,c.push(a,b)),(f+1===g||c.length>16384)&&(h+=d.apply(null,c),c.length=0)}return h},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:f,configurable:!0,writable:!0}):String.fromCodePoint=f),a}(),p$=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;var p_=class extends pN{tags;constructor(a){super(a),this.tags=a?.tags}static lc_name(){return"XMLOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_diff(a,b){if(b)return a?of(a,b):[{op:"replace",path:"",value:b}]}async parsePartialResult(a){return p1(a[0].text)}async parse(a){return p1(a)}getFormatInstructions(){return this.tags&&this.tags.length>0?p$.replace("{tags}",this.tags?.join(", ")??""):p$}};let p0=a=>{if(0===Object.keys(a).length)return{};let b={};return a.children.length>0?b[a.name]=a.children.map(p0):b[a.name]=a.text??void 0,b};function p1(a){let b=a.split("\n").map(a=>a.replace(/^\s+/,"")).join("\n").trim(),c=pZ.parser(!0),d={},e=[];c.onopentag=a=>{let b={name:a.name,attributes:a.attributes,children:[],text:"",isSelfClosing:a.isSelfClosing};e.length>0?e[e.length-1].children.push(b):d=b,a.isSelfClosing||e.push(b)},c.onclosetag=()=>{if(e.length>0){let a=e.pop();0===e.length&&a&&(d=a)}},c.ontext=a=>{if(e.length>0){let b=e[e.length-1];b.text+=a}},c.onattribute=a=>{e.length>0&&(e[e.length-1].attributes[a.name]=a.value)};let f=/```(xml)?(.*)```/s.exec(b),g=f?f[2]:b;return c.write(g).close(),d&&"?xml"===d.name&&(d=d.children[0]),p0(d)}dy({},{AsymmetricStructuredOutputParser:()=>pY,BaseCumulativeTransformOutputParser:()=>pN,BaseLLMOutputParser:()=>pJ,BaseOutputParser:()=>pK,BaseTransformOutputParser:()=>pM,BytesOutputParser:()=>pP,CommaSeparatedListOutputParser:()=>pR,CustomListOutputParser:()=>pS,JsonMarkdownStructuredOutputParser:()=>pX,JsonOutputParser:()=>pO,ListOutputParser:()=>pQ,MarkdownListOutputParser:()=>pU,NumberedListOutputParser:()=>pT,OutputParserException:()=>pL,StringOutputParser:()=>pV,StructuredOutputParser:()=>pW,XMLOutputParser:()=>p_,XML_FORMAT_INSTRUCTIONS:()=>p$,parseJsonMarkdown:()=>ev,parsePartialJson:()=>ew,parseXMLMarkdown:()=>p1});let p2=Symbol("Let zodToJsonSchema decide on which parser to use"),p3={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function p4(a,b,c,d){d?.errorMessages&&c&&(a.errorMessage={...a.errorMessage,[b]:c})}function p5(a,b,c,d,e){a[b]=c,p4(a,b,d,e)}function p6(a,b){return qr(a.type._def,b)}let p7=/^[cC][^\s-]{8,}$/,p8=/^[0-9a-z]+$/,p9=/^[0-9A-HJKMNP-TV-Z]{26}$/,qa=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,qb=()=>(void 0===o&&(o=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),o),qc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,qd=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,qe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,qf=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,qg=/^[a-zA-Z0-9_-]{21}$/,qh=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function qi(a,b){let c={type:"string"};if(a.checks)for(let d of a.checks)switch(d.kind){case"min":p5(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b);break;case"max":p5(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"email":switch(b.emailStrategy){case"format:email":ql(c,"email",d.message,b);break;case"format:idn-email":ql(c,"idn-email",d.message,b);break;case"pattern:zod":qm(c,qa,d.message,b)}break;case"url":ql(c,"uri",d.message,b);break;case"uuid":ql(c,"uuid",d.message,b);break;case"regex":qm(c,d.regex,d.message,b);break;case"cuid":qm(c,p7,d.message,b);break;case"cuid2":qm(c,p8,d.message,b);break;case"startsWith":qm(c,RegExp(`^${qj(d.value,b)}`),d.message,b);break;case"endsWith":qm(c,RegExp(`${qj(d.value,b)}$`),d.message,b);break;case"datetime":ql(c,"date-time",d.message,b);break;case"date":ql(c,"date",d.message,b);break;case"time":ql(c,"time",d.message,b);break;case"duration":ql(c,"duration",d.message,b);break;case"length":p5(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b),p5(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"includes":qm(c,RegExp(qj(d.value,b)),d.message,b);break;case"ip":"v6"!==d.version&&ql(c,"ipv4",d.message,b),"v4"!==d.version&&ql(c,"ipv6",d.message,b);break;case"base64url":qm(c,qf,d.message,b);break;case"jwt":qm(c,qh,d.message,b);break;case"cidr":"v6"!==d.version&&qm(c,qc,d.message,b),"v4"!==d.version&&qm(c,qd,d.message,b);break;case"emoji":qm(c,qb(),d.message,b);break;case"ulid":qm(c,p9,d.message,b);break;case"base64":switch(b.base64Strategy){case"format:binary":ql(c,"binary",d.message,b);break;case"contentEncoding:base64":p5(c,"contentEncoding","base64",d.message,b);break;case"pattern:zod":qm(c,qe,d.message,b)}break;case"nanoid":qm(c,qg,d.message,b)}return c}function qj(a,b){return"escape"===b.patternStrategy?function(a){let b="";for(let c=0;c<a.length;c++)qk.has(a[c])||(b+="\\"),b+=a[c];return b}(a):a}let qk=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function ql(a,b,c,d){a.format||a.anyOf?.some(a=>a.format)?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push({format:a.format,...a.errorMessage&&d.errorMessages&&{errorMessage:{format:a.errorMessage.format}}}),delete a.format,a.errorMessage&&(delete a.errorMessage.format,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.anyOf.push({format:b,...c&&d.errorMessages&&{errorMessage:{format:c}}})):p5(a,"format",b,c,d)}function qm(a,b,c,d){a.pattern||a.allOf?.some(a=>a.pattern)?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push({pattern:a.pattern,...a.errorMessage&&d.errorMessages&&{errorMessage:{pattern:a.errorMessage.pattern}}}),delete a.pattern,a.errorMessage&&(delete a.errorMessage.pattern,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.allOf.push({pattern:qn(b,d),...c&&d.errorMessages&&{errorMessage:{pattern:c}}})):p5(a,"pattern",qn(b,d),c,d)}function qn(a,b){if(!b.applyRegexFlags||!a.flags)return a.source;let c={i:a.flags.includes("i"),m:a.flags.includes("m"),s:a.flags.includes("s")},d=c.i?a.source.toLowerCase():a.source,e="",f=!1,g=!1,h=!1;for(let a=0;a<d.length;a++){if(f){e+=d[a],f=!1;continue}if(c.i){if(g){if(d[a].match(/[a-z]/)){h?(e+=d[a],e+=`${d[a-2]}-${d[a]}`.toUpperCase(),h=!1):"-"===d[a+1]&&d[a+2]?.match(/[a-z]/)?(e+=d[a],h=!0):e+=`${d[a]}${d[a].toUpperCase()}`;continue}}else if(d[a].match(/[a-z]/)){e+=`[${d[a]}${d[a].toUpperCase()}]`;continue}}if(c.m){if("^"===d[a]){e+=`(^|(?<=[\r
]))`;continue}else if("$"===d[a]){e+=`($|(?=[\r
]))`;continue}}if(c.s&&"."===d[a]){e+=g?`${d[a]}\r
`:`[${d[a]}\r
]`;continue}e+=d[a],"\\"===d[a]?f=!0:g&&"]"===d[a]?g=!1:g||"["!==d[a]||(g=!0)}try{new RegExp(e)}catch{return console.warn(`Could not convert regex pattern at ${b.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),a.source}return e}function qo(a,b){if("openAi"===b.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===b.target&&a.keyType?._def.typeName===m4.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:a.keyType._def.values,properties:a.keyType._def.values.reduce((c,d)=>({...c,[d]:qr(a.valueType._def,{...b,currentPath:[...b.currentPath,"properties",d]})??{}}),{}),additionalProperties:b.rejectedAdditionalProperties};let c={type:"object",additionalProperties:qr(a.valueType._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]})??b.allowedAdditionalProperties};if("openApi3"===b.target)return c;if(a.keyType?._def.typeName===m4.ZodFirstPartyTypeKind.ZodString&&a.keyType._def.checks?.length){let{type:d,...e}=qi(a.keyType._def,b);return{...c,propertyNames:e}}if(a.keyType?._def.typeName===m4.ZodFirstPartyTypeKind.ZodEnum)return{...c,propertyNames:{enum:a.keyType._def.values}};if(a.keyType?._def.typeName===m4.ZodFirstPartyTypeKind.ZodBranded&&a.keyType._def.type._def.typeName===m4.ZodFirstPartyTypeKind.ZodString&&a.keyType._def.type._def.checks?.length){let{type:d,...e}=p6(a.keyType._def,b);return{...c,propertyNames:e}}return c}let qp={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},qq=(a,b)=>{let c=(a.options instanceof Map?Array.from(a.options.values()):a.options).map((a,c)=>qr(a._def,{...b,currentPath:[...b.currentPath,"anyOf",`${c}`]})).filter(a=>!!a&&(!b.strictUnions||"object"==typeof a&&Object.keys(a).length>0));return c.length?{anyOf:c}:void 0};function qr(a,b,c=!1){let d=b.seen.get(a);if(b.override){let e=b.override?.(a,b,d,c);if(e!==p2)return e}if(d&&!c){let a=qs(d,b);if(void 0!==a)return a}let e={def:a,path:b.currentPath,jsonSchema:void 0};b.seen.set(a,e);let f=((a,b,c)=>{switch(b){case m4.ZodFirstPartyTypeKind.ZodString:return qi(a,c);case m4.ZodFirstPartyTypeKind.ZodNumber:let d={type:"number"};if(!a.checks)return d;for(let b of a.checks)switch(b.kind){case"int":d.type="integer",p4(d,"type",b.message,c);break;case"min":"jsonSchema7"===c.target?b.inclusive?p5(d,"minimum",b.value,b.message,c):p5(d,"exclusiveMinimum",b.value,b.message,c):(b.inclusive||(d.exclusiveMinimum=!0),p5(d,"minimum",b.value,b.message,c));break;case"max":"jsonSchema7"===c.target?b.inclusive?p5(d,"maximum",b.value,b.message,c):p5(d,"exclusiveMaximum",b.value,b.message,c):(b.inclusive||(d.exclusiveMaximum=!0),p5(d,"maximum",b.value,b.message,c));break;case"multipleOf":p5(d,"multipleOf",b.value,b.message,c)}return d;case m4.ZodFirstPartyTypeKind.ZodObject:return function(a,b){let c="openAi"===b.target,d={type:"object",properties:{}},e=[],f=a.shape();for(let a in f){let g=f[a];if(void 0===g||void 0===g._def)continue;let h=function(a){try{return a.isOptional()}catch{return!0}}(g);h&&c&&(g instanceof m4.ZodOptional&&(g=g._def.innerType),g.isNullable()||(g=g.nullable()),h=!1);let i=qr(g._def,{...b,currentPath:[...b.currentPath,"properties",a],propertyPath:[...b.currentPath,"properties",a]});void 0!==i&&(d.properties[a]=i,h||e.push(a))}e.length&&(d.required=e);let g=function(a,b){if("ZodNever"!==a.catchall._def.typeName)return qr(a.catchall._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]});switch(a.unknownKeys){case"passthrough":return b.allowedAdditionalProperties;case"strict":return b.rejectedAdditionalProperties;case"strip":return"strict"===b.removeAdditionalStrategy?b.allowedAdditionalProperties:b.rejectedAdditionalProperties}}(a,b);return void 0!==g&&(d.additionalProperties=g),d}(a,c);case m4.ZodFirstPartyTypeKind.ZodBigInt:let e={type:"integer",format:"int64"};if(!a.checks)return e;for(let b of a.checks)switch(b.kind){case"min":"jsonSchema7"===c.target?b.inclusive?p5(e,"minimum",b.value,b.message,c):p5(e,"exclusiveMinimum",b.value,b.message,c):(b.inclusive||(e.exclusiveMinimum=!0),p5(e,"minimum",b.value,b.message,c));break;case"max":"jsonSchema7"===c.target?b.inclusive?p5(e,"maximum",b.value,b.message,c):p5(e,"exclusiveMaximum",b.value,b.message,c):(b.inclusive||(e.exclusiveMaximum=!0),p5(e,"maximum",b.value,b.message,c));break;case"multipleOf":p5(e,"multipleOf",b.value,b.message,c)}return e;case m4.ZodFirstPartyTypeKind.ZodBoolean:return{type:"boolean"};case m4.ZodFirstPartyTypeKind.ZodDate:return function a(b,c,d){let e=d??c.dateStrategy;if(Array.isArray(e))return{anyOf:e.map((d,e)=>a(b,c,d))};switch(e){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var f=b,g=c;let h={type:"integer",format:"unix-time"};if("openApi3"===g.target)return h;for(let a of f.checks)switch(a.kind){case"min":p5(h,"minimum",a.value,a.message,g);break;case"max":p5(h,"maximum",a.value,a.message,g)}return h}}(a,c);case m4.ZodFirstPartyTypeKind.ZodUndefined:return{not:{}};case m4.ZodFirstPartyTypeKind.ZodNull:return"openApi3"===c.target?{enum:["null"],nullable:!0}:{type:"null"};case m4.ZodFirstPartyTypeKind.ZodArray:let f;return f={type:"array"},a.type?._def&&a.type?._def?.typeName!==m4.ZodFirstPartyTypeKind.ZodAny&&(f.items=qr(a.type._def,{...c,currentPath:[...c.currentPath,"items"]})),a.minLength&&p5(f,"minItems",a.minLength.value,a.minLength.message,c),a.maxLength&&p5(f,"maxItems",a.maxLength.value,a.maxLength.message,c),a.exactLength&&(p5(f,"minItems",a.exactLength.value,a.exactLength.message,c),p5(f,"maxItems",a.exactLength.value,a.exactLength.message,c)),f;case m4.ZodFirstPartyTypeKind.ZodUnion:case m4.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:if("openApi3"===c.target)return qq(a,c);let g=a.options instanceof Map?Array.from(a.options.values()):a.options;if(g.every(a=>a._def.typeName in qp&&(!a._def.checks||!a._def.checks.length))){let a=g.reduce((a,b)=>{let c=qp[b._def.typeName];return c&&!a.includes(c)?[...a,c]:a},[]);return{type:a.length>1?a:a[0]}}if(g.every(a=>"ZodLiteral"===a._def.typeName&&!a.description)){let a=g.reduce((a,b)=>{let c=typeof b._def.value;switch(c){case"string":case"number":case"boolean":return[...a,c];case"bigint":return[...a,"integer"];case"object":if(null===b._def.value)return[...a,"null"];default:return a}},[]);if(a.length===g.length){let b=a.filter((a,b,c)=>c.indexOf(a)===b);return{type:b.length>1?b:b[0],enum:g.reduce((a,b)=>a.includes(b._def.value)?a:[...a,b._def.value],[])}}}else if(g.every(a=>"ZodEnum"===a._def.typeName))return{type:"string",enum:g.reduce((a,b)=>[...a,...b._def.values.filter(b=>!a.includes(b))],[])};return qq(a,c);case m4.ZodFirstPartyTypeKind.ZodIntersection:let h,i,j;return h=[qr(a.left._def,{...c,currentPath:[...c.currentPath,"allOf","0"]}),qr(a.right._def,{...c,currentPath:[...c.currentPath,"allOf","1"]})].filter(a=>!!a),i="jsonSchema2019-09"===c.target?{unevaluatedProperties:!1}:void 0,j=[],h.forEach(a=>{if((!("type"in a)||"string"!==a.type)&&"allOf"in a)j.push(...a.allOf),void 0===a.unevaluatedProperties&&(i=void 0);else{let b=a;if("additionalProperties"in a&&!1===a.additionalProperties){let{additionalProperties:c,...d}=a;b=d}else i=void 0;j.push(b)}}),j.length?{allOf:j,...i}:void 0;case m4.ZodFirstPartyTypeKind.ZodTuple:return a.rest?{type:"array",minItems:a.items.length,items:a.items.map((a,b)=>qr(a._def,{...c,currentPath:[...c.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[]),additionalItems:qr(a.rest._def,{...c,currentPath:[...c.currentPath,"additionalItems"]})}:{type:"array",minItems:a.items.length,maxItems:a.items.length,items:a.items.map((a,b)=>qr(a._def,{...c,currentPath:[...c.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[])};case m4.ZodFirstPartyTypeKind.ZodRecord:return qo(a,c);case m4.ZodFirstPartyTypeKind.ZodLiteral:let k;return"bigint"!=(k=typeof a.value)&&"number"!==k&&"boolean"!==k&&"string"!==k?{type:Array.isArray(a.value)?"array":"object"}:"openApi3"===c.target?{type:"bigint"===k?"integer":k,enum:[a.value]}:{type:"bigint"===k?"integer":k,const:a.value};case m4.ZodFirstPartyTypeKind.ZodEnum:return{type:"string",enum:Array.from(a.values)};case m4.ZodFirstPartyTypeKind.ZodNativeEnum:let l,m,n;return l=a.values,{type:1===(n=Array.from(new Set((m=Object.keys(a.values).filter(a=>"number"!=typeof l[l[a]]).map(a=>l[a])).map(a=>typeof a)))).length?"string"===n[0]?"string":"number":["string","number"],enum:m};case m4.ZodFirstPartyTypeKind.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(a.innerType._def.typeName)&&(!a.innerType._def.checks||!a.innerType._def.checks.length))return"openApi3"===c.target?{type:qp[a.innerType._def.typeName],nullable:!0}:{type:[qp[a.innerType._def.typeName],"null"]};if("openApi3"===c.target){let b=qr(a.innerType._def,{...c,currentPath:[...c.currentPath]});return b&&"$ref"in b?{allOf:[b],nullable:!0}:b&&{...b,nullable:!0}}let o=qr(a.innerType._def,{...c,currentPath:[...c.currentPath,"anyOf","0"]});return o&&{anyOf:[o,{type:"null"}]};case m4.ZodFirstPartyTypeKind.ZodOptional:if(c.currentPath.toString()===c.propertyPath?.toString())return qr(a.innerType._def,c);let p=qr(a.innerType._def,{...c,currentPath:[...c.currentPath,"anyOf","1"]});return p?{anyOf:[{not:{}},p]}:{};case m4.ZodFirstPartyTypeKind.ZodMap:if("record"===c.mapStrategy)return qo(a,c);return{type:"array",maxItems:125,items:{type:"array",items:[qr(a.keyType._def,{...c,currentPath:[...c.currentPath,"items","items","0"]})||{},qr(a.valueType._def,{...c,currentPath:[...c.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case m4.ZodFirstPartyTypeKind.ZodSet:let q;return q={type:"array",uniqueItems:!0,items:qr(a.valueType._def,{...c,currentPath:[...c.currentPath,"items"]})},a.minSize&&p5(q,"minItems",a.minSize.value,a.minSize.message,c),a.maxSize&&p5(q,"maxItems",a.maxSize.value,a.maxSize.message,c),q;case m4.ZodFirstPartyTypeKind.ZodLazy:return()=>a.getter()._def;case m4.ZodFirstPartyTypeKind.ZodPromise:return qr(a.type._def,c);case m4.ZodFirstPartyTypeKind.ZodNaN:case m4.ZodFirstPartyTypeKind.ZodNever:return{not:{}};case m4.ZodFirstPartyTypeKind.ZodEffects:return"input"===c.effectStrategy?qr(a.schema._def,c):{};case m4.ZodFirstPartyTypeKind.ZodAny:case m4.ZodFirstPartyTypeKind.ZodUnknown:return{};case m4.ZodFirstPartyTypeKind.ZodDefault:return{...qr(a.innerType._def,c),default:a.defaultValue()};case m4.ZodFirstPartyTypeKind.ZodBranded:return p6(a,c);case m4.ZodFirstPartyTypeKind.ZodReadonly:case m4.ZodFirstPartyTypeKind.ZodCatch:return qr(a.innerType._def,c);case m4.ZodFirstPartyTypeKind.ZodPipeline:if("input"===c.pipeStrategy)return qr(a.in._def,c);if("output"===c.pipeStrategy)return qr(a.out._def,c);let r=qr(a.in._def,{...c,currentPath:[...c.currentPath,"allOf","0"]}),s=qr(a.out._def,{...c,currentPath:[...c.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,s].filter(a=>void 0!==a)};case m4.ZodFirstPartyTypeKind.ZodFunction:case m4.ZodFirstPartyTypeKind.ZodVoid:case m4.ZodFirstPartyTypeKind.ZodSymbol:default:return}})(a,a.typeName,b),g="function"==typeof f?qr(f(),b):f;if(g&&qu(a,b,g),b.postProcess){let c=b.postProcess(g,a,b);return e.jsonSchema=g,c}return e.jsonSchema=g,g}let qs=(a,b)=>{switch(b.$refStrategy){case"root":return{$ref:a.path.join("/")};case"relative":return{$ref:qt(b.currentPath,a.path)};case"none":case"seen":if(a.path.length<b.currentPath.length&&a.path.every((a,c)=>b.currentPath[c]===a))return console.warn(`Recursive reference detected at ${b.currentPath.join("/")}! Defaulting to any`),{};return"seen"===b.$refStrategy?{}:void 0}},qt=(a,b)=>{let c=0;for(;c<a.length&&c<b.length&&a[c]===b[c];c++);return[(a.length-c).toString(),...b.slice(c)].join("/")},qu=(a,b,c)=>(a.description&&(c.description=a.description,b.markdownDescription&&(c.markdownDescription=a.description)),c);function qv(a){if("object"==typeof a&&null!==a){let b={...a};for(let a in"additionalProperties"in b&&delete b.additionalProperties,"$schema"in b&&delete b.$schema,"strict"in b&&delete b.strict,b)a in b&&(Array.isArray(b[a])?b[a]=b[a].map(qv):"object"==typeof b[a]&&null!==b[a]&&(b[a]=qv(b[a])));return b}return a}function qw(a){let{$schema:b,...c}=qv(mA(a)?((a,b)=>{let c,d,e=(d=void 0!==(c="string"==typeof b?{...p3,name:b}:{...p3,...b}).name?[...c.basePath,c.definitionPath,c.name]:c.basePath,{...c,currentPath:d,propertyPath:void 0,seen:new Map(Object.entries(c.definitions).map(([a,b])=>[b._def,{def:b._def,path:[...c.basePath,c.definitionPath,a],jsonSchema:void 0}]))}),f="object"==typeof b&&b.definitions?Object.entries(b.definitions).reduce((a,[b,c])=>({...a,[b]:qr(c._def,{...e,currentPath:[...e.basePath,e.definitionPath,b]},!0)??{}}),{}):void 0,g="string"==typeof b?b:b?.nameStrategy==="title"?void 0:b?.name,h=qr(a._def,void 0===g?e:{...e,currentPath:[...e.basePath,e.definitionPath,g]},!1)??{},i="object"==typeof b&&void 0!==b.name&&"title"===b.nameStrategy?b.name:void 0;void 0!==i&&(h.title=i);let j=void 0===g?f?{...h,[e.definitionPath]:f}:h:{$ref:[..."relative"===e.$refStrategy?[]:e.basePath,e.definitionPath,g].join("/"),[e.definitionPath]:{...f,[g]:h}};return"jsonSchema7"===e.target?j.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===e.target||"openAi"===e.target)&&(j.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===e.target&&("anyOf"in j||"oneOf"in j||"allOf"in j||"type"in j&&Array.isArray(j.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),j})(a):a);return c}function qx(a){return void 0!==a&&Array.isArray(a.lc_namespace)}function qy(a){return void 0!==a&&oH.isRunnable(a)&&"lc_name"in a.constructor&&"function"==typeof a.constructor.lc_name&&"RunnableToolLike"===a.constructor.lc_name()}function qz(a){return!!a&&"object"==typeof a&&"name"in a&&"schema"in a&&(mB(a.schema)||null!=a.schema&&"object"==typeof a.schema&&"type"in a.schema&&"string"==typeof a.schema.type&&["null","boolean","object","array","number","string"].includes(a.schema.type))}function qA(a){return qz(a)||qy(a)||qx(a)}function qB(a,b){let c="number"==typeof b?void 0:b;return{name:a.name,description:a.description,parameters:nN(a.schema),...c?.strict!==void 0?{strict:c.strict}:{}}}function qC(a,b){let c,d="number"==typeof b?void 0:b;return c=qA(a)?{type:"function",function:qB(a)}:a,d?.strict!==void 0&&(c.function.strict=d.strict),c}dy({},{convertToOpenAIFunction:()=>qB,convertToOpenAITool:()=>qC,isLangChainTool:()=>qA,isRunnableToolLike:()=>qy,isStructuredTool:()=>qx,isStructuredToolParams:()=>qz});var qD=a.i(254799);let qE={randomUUID:qD.randomUUID},qF=new Uint8Array(256),qG=qF.length,qH=[];for(let a=0;a<256;++a)qH.push((a+256).toString(16).slice(1));let qI=function(a,b,c){if(qE.randomUUID&&!b&&!a)return qE.randomUUID();let d=(a=a||{}).random??a.rng?.()??(qG>qF.length-16&&((0,qD.randomFillSync)(qF),qG=0),qF.slice(qG,qG+=16));if(d.length<16)throw Error("Random bytes length must be >= 16");if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,b){if((c=c||0)<0||c+16>b.length)throw RangeError(`UUID byte range ${c}:${c+15} is out of buffer bounds`);for(let a=0;a<16;++a)b[c+a]=d[a];return b}return function(a,b=0){return(qH[a[b+0]]+qH[a[b+1]]+qH[a[b+2]]+qH[a[b+3]]+"-"+qH[a[b+4]]+qH[a[b+5]]+"-"+qH[a[b+6]]+qH[a[b+7]]+"-"+qH[a[b+8]]+qH[a[b+9]]+"-"+qH[a[b+10]]+qH[a[b+11]]+qH[a[b+12]]+qH[a[b+13]]+qH[a[b+14]]+qH[a[b+15]]).toLowerCase()}(d)};function qJ(a,b,c=!1){return a.reduce((d,e,f)=>{let g;if(!ek(e))throw Error("Unsupported message input");let h=(g=e._getType(),ex.isInstance(e)?e.role:"tool"===g?g:e.name??g);if("system"===h&&0!==f)throw Error("System message should be the first one");let i=function(a){switch(a){case"supervisor":case"ai":case"model":return"model";case"system":return"system";case"human":return"user";case"tool":case"function":return"function";default:throw Error(`Unknown / unsupported author: ${a}`)}}(h),j=d.content[d.content.length];if(!d.mergeWithPreviousContent&&j&&j.role===i)throw Error("Google Generative AI requires alternate messages between authors");let k=function(a,b,c){if("string"==typeof a.content&&""!==a.content&&!eq(a))return[{text:a.content}];let d=[],e=[],f=[];if("tool_calls"in a&&Array.isArray(a.tool_calls)&&a.tool_calls.length>0)d=a.tool_calls.map(a=>({functionCall:{name:a.name,args:a.args}}));else if(eq(a)&&a.content){let b=a.name??c.map(a=>eX(a)?a.tool_calls??[]:[]).flat().find(b=>b.id===a.tool_call_id)?.name;if(void 0===b)throw Error(`Google requires a tool name for each tool call response, and we could not infer a called tool name for ToolMessage "${a.id}" from your passed messages. Please populate a "name" field on that ToolMessage explicitly.`);e=[{functionResponse:{name:b,response:"string"==typeof a.content?{result:a.content}:a.content}}]}else Array.isArray(a.content)&&(f=a.content.map(a=>{if("text"===a.type)return{text:a.text};if("executableCode"===a.type)return{executableCode:a.executableCode};if("codeExecutionResult"===a.type)return{codeExecutionResult:a.codeExecutionResult};if("image_url"===a.type){let c;if(!b)throw Error("This model does not support images");if("string"==typeof a.image_url)c=a.image_url;else if("object"==typeof a.image_url&&"url"in a.image_url)c=a.image_url.url;else throw Error("Please provide image as base64 encoded data URL");let[d,e]=c.split(",");if(!d.startsWith("data:"))throw Error("Please provide image as base64 encoded data URL");let[f,g]=d.replace(/^data:/,"").split(";");if("base64"!==g)throw Error("Please provide image as base64 encoded data URL");return{inlineData:{data:e,mimeType:f}}}if("media"===a.type){if("mimeType"in a&&"data"in a)return{inlineData:{mimeType:a.mimeType,data:a.data}};if("mimeType"in a&&"fileUri"in a)return{fileData:{mimeType:a.mimeType,fileUri:a.fileUri}};throw Error("Invalid media content")}if("tool_use"===a.type)return{functionCall:{name:a.name,args:a.input}};if(a.type?.includes("/")&&2===a.type.split("/").length&&"data"in a&&"string"==typeof a.data)return{inlineData:{mimeType:a.type,data:a.data}};throw Error(`Unknown content type ${a.type}`)}));return[...f,...d,...e]}(e,b,a.slice(0,f));if(d.mergeWithPreviousContent){let a=d.content[d.content.length-1];if(!a)throw Error("There was a problem parsing your system message. Please try a prompt without one.");return a.parts.push(...k),{mergeWithPreviousContent:!1,content:d.content}}let l=i;"function"!==l&&("system"!==l||c)||(l="user");let m={role:l,parts:k};return{mergeWithPreviousContent:"system"===h&&!c,content:[...d.content,m]}},{content:[],mergeWithPreviousContent:!1}).content}a.s(["v4",0,qI],527833);class qK extends pJ{static lc_name(){return"GoogleGenerativeAIToolsOutputParser"}constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","google_genai","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=a.keyName,this.returnSingle=a.returnSingle??this.returnSingle,this.zodSchema=a.zodSchema}async _validateResult(a){if(void 0===this.zodSchema)return a;let b=await this.zodSchema.safeParseAsync(a);if(b.success)return b.data;throw new pL(`Failed to parse. Text: "${JSON.stringify(a,null,2)}". Error: ${JSON.stringify(b.error.errors)}`,JSON.stringify(a,null,2))}async parseResult(a){let b=a.flatMap(a=>{let{message:b}=a;return"tool_calls"in b&&Array.isArray(b.tool_calls)?b.tool_calls:[]});if(void 0===b[0])throw Error("No parseable tool calls provided to GoogleGenerativeAIToolsOutputParser.");let[c]=b;return await this._validateResult(c.args)}}function qL(a,b){let c,d,e=(c=[],d=[],(a.forEach(a=>{var b,e;if(qA(a)){let[d]=(b=[a]).every(a=>"functionDeclarations"in a&&Array.isArray(a.functionDeclarations))?b:[{functionDeclarations:b.map(a=>{if(qA(a)){let b=qw(a.schema);return"object"===b.type&&"properties"in b&&0===Object.keys(b.properties).length?{name:a.name,description:a.description}:{name:a.name,description:a.description,parameters:b}}return px(a)?{name:a.function.name,description:a.function.description??"A function available to call.",parameters:function(a){let{$schema:b,...c}=qv(a);return c}(a.function.parameters)}:a})}];d.functionDeclarations&&c.push(...d.functionDeclarations)}else if(px(a)){let{functionDeclarations:b}={functionDeclarations:[{name:(e=a).function.name,description:e.function.description,parameters:qv(e.function.parameters)}]};if(b)c.push(...b);else throw Error("Failed to convert OpenAI structured tool to GenerativeAI tool")}else d.push(a)}),d.find(a=>"functionDeclarations"in a))?d.map(a=>{if(c?.length>0&&"functionDeclarations"in a){let b={functionDeclarations:[...a.functionDeclarations||[],...c]};return c=[],b}return a}):[...d,...c.length>0?[{functionDeclarations:c}]:[]]),f=function(a,b){if(!a.length||!b)return;let{toolChoice:c,allowedFunctionNames:d}=b,e={any:bo.ANY,auto:bo.AUTO,none:bo.NONE};return c&&["any","auto","none"].includes(c)?{functionCallingConfig:{mode:e[c]??"MODE_UNSPECIFIED",allowedFunctionNames:d}}:"string"==typeof c||d?{functionCallingConfig:{mode:bo.ANY,allowedFunctionNames:[...d??[],...c&&"string"==typeof c?[c]:[]]}}:void 0}(e,b);return{tools:e,toolConfig:f}}class qM extends pE{static lc_name(){return"ChatGoogleGenerativeAI"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get lc_aliases(){return{apiKey:"google_api_key"}}get _isMultimodalModel(){return this.model.includes("vision")||this.model.startsWith("gemini-1.5")||this.model.startsWith("gemini-2")}constructor(a){if(super(a),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","google_genai"]}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"convertSystemMessageToHumanContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=a.model.replace(/^models\//,""),this.maxOutputTokens=a.maxOutputTokens??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw Error("`maxOutputTokens` must be a positive integer");if(this.temperature=a.temperature??this.temperature,this.temperature&&(this.temperature<0||this.temperature>2))throw Error("`temperature` must be in the range of [0.0,2.0]");if(this.topP=a.topP??this.topP,this.topP&&this.topP<0)throw Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw Error("`topP` must be below 1.");if(this.topK=a.topK??this.topK,this.topK&&this.topK<0)throw Error("`topK` must be a positive integer");if(this.stopSequences=a.stopSequences??this.stopSequences,this.apiKey=a.apiKey??dG("GOOGLE_API_KEY"),!this.apiKey)throw Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=a.safetySettings??this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(a=>a.category)).size!==this.safetySettings.length)throw Error("The categories in `safetySettings` array must be unique");this.streaming=a.streaming??this.streaming,this.json=a.json,this.client=new X(this.apiKey).getGenerativeModel({model:this.model,safetySettings:this.safetySettings,generationConfig:{stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK,...this.json?{responseMimeType:"application/json"}:{}}},{apiVersion:a.apiVersion,baseUrl:a.baseUrl}),this.streamUsage=a.streamUsage??this.streamUsage}useCachedContent(a,b,c){this.apiKey&&(this.client=new X(this.apiKey).getGenerativeModelFromCachedContent(a,b,c))}get useSystemInstruction(){return"boolean"==typeof this.convertSystemMessageToHumanContent?!this.convertSystemMessageToHumanContent:this.computeUseSystemInstruction}get computeUseSystemInstruction(){return!("gemini-1.0-pro-001"===this.model||this.model.startsWith("gemini-pro-vision"))&&!this.model.startsWith("gemini-1.0-pro-vision")&&"gemini-pro"!==this.model&&!0}getLsParams(a){return{ls_provider:"google_genai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.client.generationConfig.temperature,ls_max_tokens:this.client.generationConfig.maxOutputTokens,ls_stop:a.stop}}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}bindTools(a,b){return this.bind({tools:qL(a)?.tools,...b})}invocationParams(a){let b=a?.tools?.length?qL(a.tools,{toolChoice:a.tool_choice,allowedFunctionNames:a.allowedFunctionNames}):void 0;return a?.responseSchema?(this.client.generationConfig.responseSchema=a.responseSchema,this.client.generationConfig.responseMimeType="application/json"):(this.client.generationConfig.responseSchema=void 0,this.client.generationConfig.responseMimeType=this.json?"application/json":void 0),{...b?.tools?{tools:b.tools}:{},...b?.toolConfig?{toolConfig:b.toolConfig}:{}}}async _generate(a,b,c){let d,e=qJ(a,this._isMultimodalModel,this.useSystemInstruction),f=e;if("system"===e[0].role){let[a]=e;this.client.systemInstruction=a,f=e.slice(1)}let g=this.invocationParams(b);if(this.streaming){let d=this._streamResponseChunks(a,b,c),e={};for await(let a of d){let b=a.generationInfo?.completion??0;void 0===e[b]?e[b]=a:e[b]=e[b].concat(a)}return{generations:Object.entries(e).sort(([a],[b])=>parseInt(a,10)-parseInt(b,10)).map(([a,b])=>b),llmOutput:{estimatedTokenUsage:{}}}}let h=await this.completionWithRetry({...g,contents:f});if("usageMetadata"in h.response){let a=h.response.usageMetadata;d={input_tokens:a.promptTokenCount??0,output_tokens:a.candidatesTokenCount??0,total_tokens:a.totalTokenCount??0}}let i=function(a,b){let c;if(!a.candidates||0===a.candidates.length||!a.candidates[0])return{generations:[],llmOutput:{filters:a.promptFeedback}};let d=a.functionCalls(),[e]=a.candidates,{content:f,...g}=e;c=f?.parts.length===1&&f.parts[0].text?f.parts[0].text:f.parts.map(a=>"text"in a?{type:"text",text:a.text}:"executableCode"in a?{type:"executableCode",executableCode:a.executableCode}:"codeExecutionResult"in a?{type:"codeExecutionResult",codeExecutionResult:a.codeExecutionResult}:a);let h="";return"string"==typeof c?h=c:"text"in c[0]&&(h=c[0].text),{generations:[{text:h,message:new eW({content:c,tool_calls:d?.map(a=>({...a,type:"tool_call",id:"id"in a&&"string"==typeof a.id?a.id:qI()})),additional_kwargs:{...g},usage_metadata:b?.usageMetadata}),generationInfo:g}],llmOutput:{tokenUsage:{promptTokens:b?.usageMetadata?.input_tokens,completionTokens:b?.usageMetadata?.output_tokens,totalTokens:b?.usageMetadata?.total_tokens}}}}(h.response,{usageMetadata:d});return await c?.handleLLMNewToken(i.generations[0].text??""),i}async *_streamResponseChunks(a,b,c){let d,e=qJ(a,this._isMultimodalModel,this.useSystemInstruction),f=e;if("system"===e[0].role){let[a]=e;this.client.systemInstruction=a,f=e.slice(1)}let g={...this.invocationParams(b),contents:f},h=await this.caller.callWithOptions({signal:b?.signal},async()=>{let{stream:a}=await this.client.generateContentStream(g);return a}),i=0;for await(let a of h){if("usageMetadata"in a&&!1!==this.streamUsage&&!1!==b.streamUsage){let b=a.usageMetadata;if(d){let a=(b.candidatesTokenCount??0)-d.output_tokens;d={input_tokens:0,output_tokens:a,total_tokens:a}}else d={input_tokens:b.promptTokenCount??0,output_tokens:b.candidatesTokenCount??0,total_tokens:b.totalTokenCount??0}}let e=function(a,b){let c;if(!a.candidates||0===a.candidates.length)return null;let d=a.functionCalls(),[e]=a.candidates,{content:f,...g}=e;f?.parts&&f.parts.every(a=>"text"in a)?c=f.parts.map(a=>a.text).join(""):f.parts&&(c=f.parts.map(a=>"text"in a?{type:"text",text:a.text}:"executableCode"in a?{type:"executableCode",executableCode:a.executableCode}:"codeExecutionResult"in a?{type:"codeExecutionResult",codeExecutionResult:a.codeExecutionResult}:a));let h="";c&&"string"==typeof c?h=c:c&&"object"==typeof c&&"text"in c[0]&&(h=c[0].text);let i=[];return d&&i.push(...d.map(a=>({...a,args:JSON.stringify(a.args),index:b.index,type:"tool_call_chunk",id:"id"in a&&"string"==typeof a.id?a.id:qI()}))),new hh({text:h,message:new eZ({content:c||"",name:f?f.role:void 0,tool_call_chunks:i,additional_kwargs:{},usage_metadata:b.usageMetadata}),generationInfo:g})}(a,{usageMetadata:d,index:i});i+=1,e&&(yield e,await c?.handleLLMNewToken(e.text??""))}}async completionWithRetry(a,b){return this.caller.callWithOptions({signal:b?.signal},async()=>{try{return await this.client.generateContent(a)}catch(a){throw a.message?.includes("400 Bad Request")&&(a.status=400),a}})}withStructuredOutput(a,b){let c,d,e=b?.name,f=b?.method,g=b?.includeRaw;if("jsonMode"===f)throw Error('ChatGoogleGenerativeAI only supports "jsonSchema" or "functionCalling" as a method.');if("functionCalling"===f){let b,f=e??"extract";if(mA(a)){let c=qw(a);b=[{functionDeclarations:[{name:f,description:c.description??"A function available to call.",parameters:c}]}],d=new qK({returnSingle:!0,keyName:f,zodSchema:a})}else{let c;"string"==typeof a.name&&"object"==typeof a.parameters&&null!=a.parameters?((c=a).parameters=qv(a.parameters),f=a.name):c={name:f,description:a.description??"",parameters:qv(a)},b=[{functionDeclarations:[c]}],d=new qK({returnSingle:!0,keyName:f})}c=this.bind({tools:b,tool_choice:f})}else{let b=qw(a);c=this.bind({responseSchema:b}),d=new pO}if(!g)return c.pipe(d).withConfig({runName:"ChatGoogleGenerativeAIStructuredOutput"});let h=pB.assign({parsed:(a,b)=>d.invoke(a.raw,b)}),i=pB.assign({parsed:()=>null}),j=h.withFallbacks({fallbacks:[i]});return oL.from([{raw:c},j]).withConfig({runName:"StructuredOutputRunnable"})}}dy({},{Embeddings:()=>qN});var qN=class{caller;constructor(a){this.caller=new or(a??{})}};dy({},{chunkArray:()=>qO});let qO=(a,b)=>a.reduce((a,c,d)=>{let e=Math.floor(d/b),f=a[e]||[];return a[e]=f.concat([c]),a},[]);function qP(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c}function qQ(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)}let qR=function(){let{crypto:a}=globalThis;if(a?.randomUUID)return qR=a.randomUUID.bind(a),a.randomUUID();let b=new Uint8Array(1),c=a?()=>a.getRandomValues(b)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,a=>(a^c()&15>>a/4).toString(16))};function qS(a){return"object"==typeof a&&null!==a&&("name"in a&&"AbortError"===a.name||"message"in a&&String(a.message).includes("FetchRequestCanceledException"))}let qT=a=>{if(a instanceof Error)return a;if("object"==typeof a&&null!==a){try{if("[object Error]"===Object.prototype.toString.call(a)){let b=Error(a.message,a.cause?{cause:a.cause}:{});return a.stack&&(b.stack=a.stack),a.cause&&!b.cause&&(b.cause=a.cause),a.name&&(b.name=a.name),b}}catch{}try{return Error(JSON.stringify(a))}catch{}}return Error(a)};class qU extends Error{}class qV extends qU{constructor(a,b,c,d){super(`${qV.makeMessage(a,b,c)}`),this.status=a,this.headers=d,this.requestID=d?.get("x-request-id"),this.error=b,this.code=b?.code,this.param=b?.param,this.type=b?.type}static makeMessage(a,b,c){let d=b?.message?"string"==typeof b.message?b.message:JSON.stringify(b.message):b?JSON.stringify(b):c;return a&&d?`${a} ${d}`:a?`${a} status code (no body)`:d||"(no status code or body)"}static generate(a,b,c,d){if(!a||!d)return new qX({message:c,cause:qT(b)});let e=b?.error;return 400===a?new qZ(a,e,c,d):401===a?new q$(a,e,c,d):403===a?new q_(a,e,c,d):404===a?new q0(a,e,c,d):409===a?new q1(a,e,c,d):422===a?new q2(a,e,c,d):429===a?new q3(a,e,c,d):a>=500?new q4(a,e,c,d):new qV(a,e,c,d)}}class qW extends qV{constructor({message:a}={}){super(void 0,void 0,a||"Request was aborted.",void 0)}}class qX extends qV{constructor({message:a,cause:b}){super(void 0,void 0,a||"Connection error.",void 0),b&&(this.cause=b)}}class qY extends qX{constructor({message:a}={}){super({message:a??"Request timed out."})}}class qZ extends qV{}class q$ extends qV{}class q_ extends qV{}class q0 extends qV{}class q1 extends qV{}class q2 extends qV{}class q3 extends qV{}class q4 extends qV{}class q5 extends qU{constructor(){super("Could not parse response content as the length limit was reached")}}class q6 extends qU{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class q7 extends Error{constructor(a){super(a)}}let q8=/^[a-z][a-z0-9+.-]*:/i,q9=a=>(q9=Array.isArray)(a),ra=q9;function rb(a){return null!=a&&"object"==typeof a&&!Array.isArray(a)}let rc=a=>new Promise(b=>setTimeout(b,a)),rd="5.12.2",re=a=>"x32"===a?"x32":"x86_64"===a||"x64"===a?"x64":"arm"===a?"arm":"aarch64"===a||"arm64"===a?"arm64":a?`other:${a}`:"unknown",rf=a=>(a=a.toLowerCase()).includes("ios")?"iOS":"android"===a?"Android":"darwin"===a?"MacOS":"win32"===a?"Windows":"freebsd"===a?"FreeBSD":"openbsd"===a?"OpenBSD":"linux"===a?"Linux":a?`Other:${a}`:"Unknown";function rg(...a){let b=globalThis.ReadableStream;if(void 0===b)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new b(...a)}function rh(a){let b=Symbol.asyncIterator in a?a[Symbol.asyncIterator]():a[Symbol.iterator]();return rg({start(){},async pull(a){let{done:c,value:d}=await b.next();c?a.close():a.enqueue(d)},async cancel(){await b.return?.()}})}function ri(a){if(a[Symbol.asyncIterator])return a;let b=a.getReader();return{async next(){try{let a=await b.read();return a?.done&&b.releaseLock(),a}catch(a){throw b.releaseLock(),a}},async return(){let a=b.cancel();return b.releaseLock(),await a,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function rj(a){if(null===a||"object"!=typeof a)return;if(a[Symbol.asyncIterator])return void await a[Symbol.asyncIterator]().return?.();let b=a.getReader(),c=b.cancel();b.releaseLock(),await c}let rk=({headers:a,body:b})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(b)}),rl="RFC3986",rm=a=>String(a),rn={RFC1738:a=>String(a).replace(/%20/g,"+"),RFC3986:rm},ro=(a,b)=>(ro=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(a,b),rp=(()=>{let a=[];for(let b=0;b<256;++b)a.push("%"+((b<16?"0":"")+b.toString(16)).toUpperCase());return a})();function rq(a,b){if(q9(a)){let c=[];for(let d=0;d<a.length;d+=1)c.push(b(a[d]));return c}return b(a)}let rr={brackets:a=>String(a)+"[]",comma:"comma",indices:(a,b)=>String(a)+"["+b+"]",repeat:a=>String(a)},rs=function(a,b){Array.prototype.push.apply(a,q9(b)?b:[b])},rt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(a,b,c,d,e)=>{if(0===a.length)return a;let f=a;if("symbol"==typeof a?f=Symbol.prototype.toString.call(a):"string"!=typeof a&&(f=String(a)),"iso-8859-1"===c)return escape(f).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let g="";for(let a=0;a<f.length;a+=1024){let b=f.length>=1024?f.slice(a,a+1024):f,c=[];for(let a=0;a<b.length;++a){let d=b.charCodeAt(a);if(45===d||46===d||95===d||126===d||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||"RFC1738"===e&&(40===d||41===d)){c[c.length]=b.charAt(a);continue}if(d<128){c[c.length]=rp[d];continue}if(d<2048){c[c.length]=rp[192|d>>6]+rp[128|63&d];continue}if(d<55296||d>=57344){c[c.length]=rp[224|d>>12]+rp[128|d>>6&63]+rp[128|63&d];continue}a+=1,d=65536+((1023&d)<<10|1023&b.charCodeAt(a)),c[c.length]=rp[240|d>>18]+rp[128|d>>12&63]+rp[128|d>>6&63]+rp[128|63&d]}g+=c.join("")}return g},encodeValuesOnly:!1,format:rl,formatter:rm,indices:!1,serializeDate:a=>(i??(i=Function.prototype.call.bind(Date.prototype.toISOString)))(a),skipNulls:!1,strictNullHandling:!1},ru={};function rv(a){let b;return(j??(j=(b=new globalThis.TextEncoder).encode.bind(b)))(a)}function rw(a){let b;return(k??(k=(b=new globalThis.TextDecoder).decode.bind(b)))(a)}class rx{constructor(){bs.set(this,void 0),bt.set(this,void 0),qP(this,bs,new Uint8Array,"f"),qP(this,bt,null,"f")}decode(a){let b;if(null==a)return[];let c=a instanceof ArrayBuffer?new Uint8Array(a):"string"==typeof a?rv(a):a;qP(this,bs,function(a){let b=0;for(let c of a)b+=c.length;let c=new Uint8Array(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return c}([qQ(this,bs,"f"),c]),"f");let d=[];for(;null!=(b=function(a,b){for(let c=b??0;c<a.length;c++){if(10===a[c])return{preceding:c,index:c+1,carriage:!1};if(13===a[c])return{preceding:c,index:c+1,carriage:!0}}return null}(qQ(this,bs,"f"),qQ(this,bt,"f")));){if(b.carriage&&null==qQ(this,bt,"f")){qP(this,bt,b.index,"f");continue}if(null!=qQ(this,bt,"f")&&(b.index!==qQ(this,bt,"f")+1||b.carriage)){d.push(rw(qQ(this,bs,"f").subarray(0,qQ(this,bt,"f")-1))),qP(this,bs,qQ(this,bs,"f").subarray(qQ(this,bt,"f")),"f"),qP(this,bt,null,"f");continue}let a=null!==qQ(this,bt,"f")?b.preceding-1:b.preceding,c=rw(qQ(this,bs,"f").subarray(0,a));d.push(c),qP(this,bs,qQ(this,bs,"f").subarray(b.index),"f"),qP(this,bt,null,"f")}return d}flush(){return qQ(this,bs,"f").length?this.decode("\n"):[]}}bs=new WeakMap,bt=new WeakMap,rx.NEWLINE_CHARS=new Set(["\n","\r"]),rx.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let ry={off:0,error:200,warn:300,info:400,debug:500},rz=(a,b,c)=>{if(a){if(Object.prototype.hasOwnProperty.call(ry,a))return a;rE(c).warn(`${b} was set to ${JSON.stringify(a)}, expected one of ${JSON.stringify(Object.keys(ry))}`)}};function rA(){}function rB(a,b,c){return!b||ry[a]>ry[c]?rA:b[a].bind(b)}let rC={error:rA,warn:rA,info:rA,debug:rA},rD=new WeakMap;function rE(a){let b=a.logger,c=a.logLevel??"off";if(!b)return rC;let d=rD.get(b);if(d&&d[0]===c)return d[1];let e={error:rB("error",b,c),warn:rB("warn",b,c),info:rB("info",b,c),debug:rB("debug",b,c)};return rD.set(b,[c,e]),e}let rF=a=>(a.options&&(a.options={...a.options},delete a.options.headers),a.headers&&(a.headers=Object.fromEntries((a.headers instanceof Headers?[...a.headers]:Object.entries(a.headers)).map(([a,b])=>[a,"authorization"===a.toLowerCase()||"cookie"===a.toLowerCase()||"set-cookie"===a.toLowerCase()?"***":b]))),"retryOfRequestLogID"in a&&(a.retryOfRequestLogID&&(a.retryOf=a.retryOfRequestLogID),delete a.retryOfRequestLogID),a);class rG{constructor(a,b,c){this.iterator=a,bu.set(this,void 0),this.controller=b,qP(this,bu,c,"f")}static fromSSEResponse(a,b,c){let d=!1,e=c?rE(c):console;async function*f(){if(d)throw new qU("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");d=!0;let c=!1;try{for await(let d of rH(a,b))if(!c){if(d.data.startsWith("[DONE]")){c=!0;continue}if(null!==d.event&&d.event.startsWith("thread.")){let a;try{a=JSON.parse(d.data)}catch(a){throw console.error("Could not parse message into JSON:",d.data),console.error("From chunk:",d.raw),a}if("error"==d.event)throw new qV(void 0,a.error,a.message,void 0);yield{event:d.event,data:a}}else{let b;try{b=JSON.parse(d.data)}catch(a){throw e.error("Could not parse message into JSON:",d.data),e.error("From chunk:",d.raw),a}if(b&&b.error)throw new qV(void 0,b.error,void 0,a.headers);yield b}}c=!0}catch(a){if(qS(a))return;throw a}finally{c||b.abort()}}return new rG(f,b,c)}static fromReadableStream(a,b,c){let d=!1;async function*e(){let b=new rx;for await(let c of ri(a))for(let a of b.decode(c))yield a;for(let a of b.flush())yield a}return new rG(async function*(){if(d)throw new qU("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");d=!0;let a=!1;try{for await(let b of e())!a&&b&&(yield JSON.parse(b));a=!0}catch(a){if(qS(a))return;throw a}finally{a||b.abort()}},b,c)}[(bu=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let a=[],b=[],c=this.iterator(),d=d=>({next:()=>{if(0===d.length){let d=c.next();a.push(d),b.push(d)}return d.shift()}});return[new rG(()=>d(a),this.controller,qQ(this,bu,"f")),new rG(()=>d(b),this.controller,qQ(this,bu,"f"))]}toReadableStream(){let a,b=this;return rg({async start(){a=b[Symbol.asyncIterator]()},async pull(b){try{let{value:c,done:d}=await a.next();if(d)return b.close();let e=rv(JSON.stringify(c)+"\n");b.enqueue(e)}catch(a){b.error(a)}},async cancel(){await a.return?.()}})}}async function*rH(a,b){if(!a.body){if(b.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new qU("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new qU("Attempted to iterate over a response with no body")}let c=new rJ,d=new rx;for await(let b of rI(ri(a.body)))for(let a of d.decode(b)){let b=c.decode(a);b&&(yield b)}for(let a of d.flush()){let b=c.decode(a);b&&(yield b)}}async function*rI(a){let b=new Uint8Array;for await(let c of a){let a;if(null==c)continue;let d=c instanceof ArrayBuffer?new Uint8Array(c):"string"==typeof c?rv(c):c,e=new Uint8Array(b.length+d.length);for(e.set(b),e.set(d,b.length),b=e;-1!==(a=function(a){for(let b=0;b<a.length-1;b++){if(10===a[b]&&10===a[b+1]||13===a[b]&&13===a[b+1])return b+2;if(13===a[b]&&10===a[b+1]&&b+3<a.length&&13===a[b+2]&&10===a[b+3])return b+4}return -1}(b));)yield b.slice(0,a),b=b.slice(a)}b.length>0&&(yield b)}class rJ{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(a){var b;let c;if(a.endsWith("\r")&&(a=a.substring(0,a.length-1)),!a){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(a),a.startsWith(":"))return null;let[d,e,f]=-1!==(c=(b=a).indexOf(":"))?[b.substring(0,c),":",b.substring(c+1)]:[b,"",""];return f.startsWith(" ")&&(f=f.substring(1)),"event"===d?this.event=f:"data"===d&&this.data.push(f),null}}async function rK(a,b){let{response:c,requestLogID:d,retryOfRequestLogID:e,startTime:f}=b,g=await (async()=>{if(b.options.stream)return(rE(a).debug("response",c.status,c.url,c.headers,c.body),b.options.__streamClass)?b.options.__streamClass.fromSSEResponse(c,b.controller,a):rG.fromSSEResponse(c,b.controller,a);if(204===c.status)return null;if(b.options.__binaryResponse)return c;let d=c.headers.get("content-type"),e=d?.split(";")[0]?.trim();return e?.includes("application/json")||e?.endsWith("+json")?rL(await c.json(),c):await c.text()})();return rE(a).debug(`[${d}] response parsed`,rF({retryOfRequestLogID:e,url:c.url,status:c.status,body:g,durationMs:Date.now()-f})),g}function rL(a,b){return!a||"object"!=typeof a||Array.isArray(a)?a:Object.defineProperty(a,"_request_id",{value:b.headers.get("x-request-id"),enumerable:!1})}class rM extends Promise{constructor(a,b,c=rK){super(a=>{a(null)}),this.responsePromise=b,this.parseResponse=c,bv.set(this,void 0),qP(this,bv,a,"f")}_thenUnwrap(a){return new rM(qQ(this,bv,"f"),this.responsePromise,async(b,c)=>rL(a(await this.parseResponse(b,c),c),c.response))}asResponse(){return this.responsePromise.then(a=>a.response)}async withResponse(){let[a,b]=await Promise.all([this.parse(),this.asResponse()]);return{data:a,response:b,request_id:b.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(a=>this.parseResponse(qQ(this,bv,"f"),a))),this.parsedPromise}then(a,b){return this.parse().then(a,b)}catch(a){return this.parse().catch(a)}finally(a){return this.parse().finally(a)}}bv=new WeakMap;class rN{constructor(a,b,c,d){bw.set(this,void 0),qP(this,bw,a,"f"),this.options=d,this.response=b,this.body=c}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let a=this.nextPageRequestOptions();if(!a)throw new qU("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await qQ(this,bw,"f").requestAPIList(this.constructor,a)}async *iterPages(){let a=this;for(yield a;a.hasNextPage();)a=await a.getNextPage(),yield a}async *[(bw=new WeakMap,Symbol.asyncIterator)](){for await(let a of this.iterPages())for(let b of a.getPaginatedItems())yield b}}class rO extends rM{constructor(a,b,c){super(a,b,async(a,b)=>new c(a,b.response,await rK(a,b),b.options))}async *[Symbol.asyncIterator](){for await(let a of(await this))yield a}}class rP extends rN{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.object=c.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class rQ extends rN{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.has_more=c.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){var a;let b=this.getPaginatedItems(),c=b[b.length-1]?.id;return c?{...this.options,query:{..."object"!=typeof(a=this.options.query)?{}:a??{},after:c}}:null}}let rR=()=>{if("undefined"==typeof File){let{process:a}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof a?.versions?.node&&20>parseInt(a.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function rS(a,b,c){return rR(),new File(a,b??"unknown_file",c)}function rT(a){return("object"==typeof a&&null!==a&&("name"in a&&a.name&&String(a.name)||"url"in a&&a.url&&String(a.url)||"filename"in a&&a.filename&&String(a.filename)||"path"in a&&a.path&&String(a.path))||"").split(/[\\/]/).pop()||void 0}let rU=a=>null!=a&&"object"==typeof a&&"function"==typeof a[Symbol.asyncIterator],rV=async(a,b)=>({...a,body:await rX(a.body,b)}),rW=new WeakMap,rX=async(a,b)=>{if(!await function(a){let b="function"==typeof a?a:a.fetch,c=rW.get(b);if(c)return c;let d=(async()=>{try{let a="Response"in b?b.Response:(await b("data:,")).constructor,c=new FormData;if(c.toString()===await new a(c).text())return!1;return!0}catch{return!0}})();return rW.set(b,d),d}(b))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let c=new FormData;return await Promise.all(Object.entries(a||{}).map(([a,b])=>r$(c,a,b))),c},rY=a=>a instanceof Blob&&"name"in a,rZ=a=>{if("object"==typeof a&&null!==a&&(a instanceof Response||rU(a)||rY(a)))return!0;if(Array.isArray(a))return a.some(rZ);if(a&&"object"==typeof a){for(let b in a)if(rZ(a[b]))return!0}return!1},r$=async(a,b,c)=>{if(void 0!==c){if(null==c)throw TypeError(`Received null for "${b}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof c||"number"==typeof c||"boolean"==typeof c)a.append(b,String(c));else if(c instanceof Response)a.append(b,rS([await c.blob()],rT(c)));else if(rU(c))a.append(b,rS([await new Response(rh(c)).blob()],rT(c)));else if(rY(c))a.append(b,c,rT(c));else if(Array.isArray(c))await Promise.all(c.map(c=>r$(a,b+"[]",c)));else if("object"==typeof c)await Promise.all(Object.entries(c).map(([c,d])=>r$(a,`${b}[${c}]`,d)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${c} instead`)}},r_=a=>null!=a&&"object"==typeof a&&"number"==typeof a.size&&"string"==typeof a.type&&"function"==typeof a.text&&"function"==typeof a.slice&&"function"==typeof a.arrayBuffer;async function r0(a,b,c){let d,e;if(rR(),null!=(d=a=await a)&&"object"==typeof d&&"string"==typeof d.name&&"number"==typeof d.lastModified&&r_(d))return a instanceof File?a:rS([await a.arrayBuffer()],a.name);if(null!=(e=a)&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob){let d=await a.blob();return b||(b=new URL(a.url).pathname.split(/[\\/]/).pop()),rS(await r1(d),b,c)}let f=await r1(a);if(b||(b=rT(a)),!c?.type){let a=f.find(a=>"object"==typeof a&&"type"in a&&a.type);"string"==typeof a&&(c={...c,type:a})}return rS(f,b,c)}async function r1(a){let b=[];if("string"==typeof a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer)b.push(a);else if(r_(a))b.push(a instanceof Blob?a:await a.arrayBuffer());else if(rU(a))for await(let c of a)b.push(...await r1(c));else{let b=a?.constructor?.name;throw Error(`Unexpected data type: ${typeof a}${b?`; constructor: ${b}`:""}${function(a){if("object"!=typeof a||null===a)return"";let b=Object.getOwnPropertyNames(a);return`; props: [${b.map(a=>`"${a}"`).join(", ")}]`}(a)}`)}return b}class r2{constructor(a){this._client=a}}function r3(a){return a.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let r4=Object.freeze(Object.create(null)),r5=((a=r3)=>function(b,...c){let d;if(1===b.length)return b[0];let e=!1,f=[],g=b.reduce((b,d,g)=>{/[?#]/.test(d)&&(e=!0);let h=c[g],i=(e?encodeURIComponent:a)(""+h);return g!==c.length&&(null==h||"object"==typeof h&&h.toString===Object.getPrototypeOf(Object.getPrototypeOf(h.hasOwnProperty??r4)??r4)?.toString)&&(i=h+"",f.push({start:b.length+d.length,length:i.length,error:`Value of type ${Object.prototype.toString.call(h).slice(8,-1)} is not a valid path parameter`})),b+d+(g===c.length?"":i)},""),h=g.split(/[?#]/,1)[0],i=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(d=i.exec(h));)f.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(f.sort((a,b)=>a.start-b.start),f.length>0){let a=0,b=f.reduce((b,c)=>{let d=" ".repeat(c.start-a),e="^".repeat(c.length);return a=c.start+c.length,b+d+e},"");throw new qU(`Path parameters result in path with invalid segments:
${f.map(a=>a.error).join("\n")}
${g}
${b}`)}return g})(r3);class r6 extends r2{list(a,b={},c){return this._client.getAPIList(r5`/chat/completions/${a}/messages`,rQ,{query:b,...c})}}function r7(a){return void 0!==a&&"function"in a&&void 0!==a.function}function r8(a){return a?.$brand==="auto-parseable-response-format"}function r9(a){return a?.$brand==="auto-parseable-tool"}function sa(a,b){let c=a.choices.map(a=>{var c,d;if("length"===a.finish_reason)throw new q5;if("content_filter"===a.finish_reason)throw new q6;return sc(a.message.tool_calls),{...a,message:{...a.message,...a.message.tool_calls?{tool_calls:a.message.tool_calls?.map(a=>{var c,d;let e;return c=b,d=a,e=c.tools?.find(a=>r7(a)&&a.function?.name===d.function.name),{...d,function:{...d.function,parsed_arguments:r9(e)?e.$parseRaw(d.function.arguments):e?.function.strict?JSON.parse(d.function.arguments):null}}})??void 0}:void 0,parsed:a.message.content&&!a.message.refusal?(c=b,d=a.message.content,c.response_format?.type!=="json_schema"?null:c.response_format?.type==="json_schema"?"$parseRaw"in c.response_format?c.response_format.$parseRaw(d):JSON.parse(d):null):null}}});return{...a,choices:c}}function sb(a){return!!r8(a.response_format)||(a.tools?.some(a=>r9(a)||"function"===a.type&&!0===a.function.strict)??!1)}function sc(a){for(let b of a||[])if("function"!==b.type)throw new qU(`Currently only \`function\` tool calls are supported; Received \`${b.type}\``)}let sd=a=>a?.role==="assistant",se=a=>a?.role==="tool";class sf{constructor(){bx.add(this),this.controller=new AbortController,by.set(this,void 0),bz.set(this,()=>{}),bA.set(this,()=>{}),bB.set(this,void 0),bC.set(this,()=>{}),bD.set(this,()=>{}),bE.set(this,{}),bF.set(this,!1),bG.set(this,!1),bH.set(this,!1),bI.set(this,!1),qP(this,by,new Promise((a,b)=>{qP(this,bz,a,"f"),qP(this,bA,b,"f")}),"f"),qP(this,bB,new Promise((a,b)=>{qP(this,bC,a,"f"),qP(this,bD,b,"f")}),"f"),qQ(this,by,"f").catch(()=>{}),qQ(this,bB,"f").catch(()=>{})}_run(a){setTimeout(()=>{a().then(()=>{this._emitFinal(),this._emit("end")},qQ(this,bx,"m",bJ).bind(this))},0)}_connected(){this.ended||(qQ(this,bz,"f").call(this),this._emit("connect"))}get ended(){return qQ(this,bF,"f")}get errored(){return qQ(this,bG,"f")}get aborted(){return qQ(this,bH,"f")}abort(){this.controller.abort()}on(a,b){return(qQ(this,bE,"f")[a]||(qQ(this,bE,"f")[a]=[])).push({listener:b}),this}off(a,b){let c=qQ(this,bE,"f")[a];if(!c)return this;let d=c.findIndex(a=>a.listener===b);return d>=0&&c.splice(d,1),this}once(a,b){return(qQ(this,bE,"f")[a]||(qQ(this,bE,"f")[a]=[])).push({listener:b,once:!0}),this}emitted(a){return new Promise((b,c)=>{qP(this,bI,!0,"f"),"error"!==a&&this.once("error",c),this.once(a,b)})}async done(){qP(this,bI,!0,"f"),await qQ(this,bB,"f")}_emit(a,...b){if(qQ(this,bF,"f"))return;"end"===a&&(qP(this,bF,!0,"f"),qQ(this,bC,"f").call(this));let c=qQ(this,bE,"f")[a];if(c&&(qQ(this,bE,"f")[a]=c.filter(a=>!a.once),c.forEach(({listener:a})=>a(...b))),"abort"===a){let a=b[0];qQ(this,bI,"f")||c?.length||Promise.reject(a),qQ(this,bA,"f").call(this,a),qQ(this,bD,"f").call(this,a),this._emit("end");return}if("error"===a){let a=b[0];qQ(this,bI,"f")||c?.length||Promise.reject(a),qQ(this,bA,"f").call(this,a),qQ(this,bD,"f").call(this,a),this._emit("end")}}_emitFinal(){}}by=new WeakMap,bz=new WeakMap,bA=new WeakMap,bB=new WeakMap,bC=new WeakMap,bD=new WeakMap,bE=new WeakMap,bF=new WeakMap,bG=new WeakMap,bH=new WeakMap,bI=new WeakMap,bx=new WeakSet,bJ=function(a){if(qP(this,bG,!0,"f"),a instanceof Error&&"AbortError"===a.name&&(a=new qW),a instanceof qW)return qP(this,bH,!0,"f"),this._emit("abort",a);if(a instanceof qU)return this._emit("error",a);if(a instanceof Error){let b=new qU(a.message);return b.cause=a,this._emit("error",b)}return this._emit("error",new qU(String(a)))};class sg extends sf{constructor(){super(...arguments),bK.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(a){this._chatCompletions.push(a),this._emit("chatCompletion",a);let b=a.choices[0]?.message;return b&&this._addMessage(b),a}_addMessage(a,b=!0){if("content"in a||(a.content=null),this.messages.push(a),b){if(this._emit("message",a),se(a)&&a.content)this._emit("functionToolCallResult",a.content);else if(sd(a)&&a.tool_calls)for(let b of a.tool_calls)"function"===b.type&&this._emit("functionToolCall",b.function)}}async finalChatCompletion(){await this.done();let a=this._chatCompletions[this._chatCompletions.length-1];if(!a)throw new qU("stream ended without producing a ChatCompletion");return a}async finalContent(){return await this.done(),qQ(this,bK,"m",bL).call(this)}async finalMessage(){return await this.done(),qQ(this,bK,"m",bM).call(this)}async finalFunctionToolCall(){return await this.done(),qQ(this,bK,"m",bN).call(this)}async finalFunctionToolCallResult(){return await this.done(),qQ(this,bK,"m",bO).call(this)}async totalUsage(){return await this.done(),qQ(this,bK,"m",bP).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let a=this._chatCompletions[this._chatCompletions.length-1];a&&this._emit("finalChatCompletion",a);let b=qQ(this,bK,"m",bM).call(this);b&&this._emit("finalMessage",b);let c=qQ(this,bK,"m",bL).call(this);c&&this._emit("finalContent",c);let d=qQ(this,bK,"m",bN).call(this);d&&this._emit("finalFunctionToolCall",d);let e=qQ(this,bK,"m",bO).call(this);null!=e&&this._emit("finalFunctionToolCallResult",e),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",qQ(this,bK,"m",bP).call(this))}async _createChatCompletion(a,b,c){let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),qQ(this,bK,"m",bQ).call(this,b);let e=await a.chat.completions.create({...b,stream:!1},{...c,signal:this.controller.signal});return this._connected(),this._addChatCompletion(sa(e,b))}async _runChatCompletion(a,b,c){for(let a of b.messages)this._addMessage(a,!1);return await this._createChatCompletion(a,b,c)}async _runTools(a,b,c){let d="tool",{tool_choice:e="auto",stream:f,...g}=b,h="string"!=typeof e&&"function"===e.type&&e?.function?.name,{maxChatCompletions:i=10}=c||{},j=b.tools.map(a=>{if(r9(a)){if(!a.$callback)throw new qU("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:a.$callback,name:a.function.name,description:a.function.description||"",parameters:a.function.parameters,parse:a.$parseRaw,strict:!0}}}return a}),k={};for(let a of j)"function"===a.type&&(k[a.function.name||a.function.function.name]=a.function);let l="tools"in b?j.map(a=>"function"===a.type?{type:"function",function:{name:a.function.name||a.function.function.name,parameters:a.function.parameters,description:a.function.description,strict:a.function.strict}}:a):void 0;for(let a of b.messages)this._addMessage(a,!1);for(let b=0;b<i;++b){let b=await this._createChatCompletion(a,{...g,tool_choice:e,tools:l,messages:[...this.messages]},c),f=b.choices[0]?.message;if(!f)throw new qU("missing message in ChatCompletion response");if(!f.tool_calls?.length)break;for(let a of f.tool_calls){let b;if("function"!==a.type)continue;let c=a.id,{name:e,arguments:f}=a.function,g=k[e];if(g){if(h&&h!==e){let a=`Invalid tool_call: ${JSON.stringify(e)}. ${JSON.stringify(h)} requested. Please try again`;this._addMessage({role:d,tool_call_id:c,content:a});continue}}else{let a=`Invalid tool_call: ${JSON.stringify(e)}. Available options are: ${Object.keys(k).map(a=>JSON.stringify(a)).join(", ")}. Please try again`;this._addMessage({role:d,tool_call_id:c,content:a});continue}try{b="function"==typeof g.parse?await g.parse(f):f}catch(b){let a=b instanceof Error?b.message:String(b);this._addMessage({role:d,tool_call_id:c,content:a});continue}let i=await g.function(b,this),j=qQ(this,bK,"m",bR).call(this,i);if(this._addMessage({role:d,tool_call_id:c,content:j}),h)return}}}}bK=new WeakSet,bL=function(){return qQ(this,bK,"m",bM).call(this).content??null},bM=function(){let a=this.messages.length;for(;a-- >0;){let b=this.messages[a];if(sd(b))return{...b,content:b.content??null,refusal:b.refusal??null}}throw new qU("stream ended without producing a ChatCompletionMessage with role=assistant")},bN=function(){for(let a=this.messages.length-1;a>=0;a--){let b=this.messages[a];if(sd(b)&&b?.tool_calls?.length)return b.tool_calls.filter(a=>"function"===a.type).at(-1)?.function}},bO=function(){for(let a=this.messages.length-1;a>=0;a--){let b=this.messages[a];if(se(b)&&null!=b.content&&"string"==typeof b.content&&this.messages.some(a=>"assistant"===a.role&&a.tool_calls?.some(a=>"function"===a.type&&a.id===b.tool_call_id)))return b.content}},bP=function(){let a={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:b}of this._chatCompletions)b&&(a.completion_tokens+=b.completion_tokens,a.prompt_tokens+=b.prompt_tokens,a.total_tokens+=b.total_tokens);return a},bQ=function(a){if(null!=a.n&&a.n>1)throw new qU("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},bR=function(a){return"string"==typeof a?a:void 0===a?"undefined":JSON.stringify(a)};class sh extends sg{static runTools(a,b,c){let d=new sh,e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runTools"}};return d._run(()=>d._runTools(a,b,e)),d}_addMessage(a,b=!0){super._addMessage(a,b),sd(a)&&a.content&&this._emit("content",a.content)}}let si=511;class sj extends Error{}class sk extends Error{}let sl=a=>(function(a,b=si){var c,d;let e,f,g,h,i,j,k,l,m,n;if("string"!=typeof a)throw TypeError(`expecting str, got ${typeof a}`);if(!a.trim())throw Error(`${a} is empty`);return c=a.trim(),d=b,e=c.length,f=0,g=a=>{throw new sj(`${a} at position ${f}`)},h=a=>{throw new sk(`${a} at position ${f}`)},i=()=>(n(),f>=e&&g("Unexpected end of input"),'"'===c[f])?j():"{"===c[f]?k():"["===c[f]?l():"null"===c.substring(f,f+4)||16&d&&e-f<4&&"null".startsWith(c.substring(f))?(f+=4,null):"true"===c.substring(f,f+4)||32&d&&e-f<4&&"true".startsWith(c.substring(f))?(f+=4,!0):"false"===c.substring(f,f+5)||32&d&&e-f<5&&"false".startsWith(c.substring(f))?(f+=5,!1):"Infinity"===c.substring(f,f+8)||128&d&&e-f<8&&"Infinity".startsWith(c.substring(f))?(f+=8,1/0):"-Infinity"===c.substring(f,f+9)||256&d&&1<e-f&&e-f<9&&"-Infinity".startsWith(c.substring(f))?(f+=9,-1/0):"NaN"===c.substring(f,f+3)||64&d&&e-f<3&&"NaN".startsWith(c.substring(f))?(f+=3,NaN):m(),j=()=>{let a=f,b=!1;for(f++;f<e&&('"'!==c[f]||b&&"\\"===c[f-1]);)b="\\"===c[f]&&!b,f++;if('"'==c.charAt(f))try{return JSON.parse(c.substring(a,++f-Number(b)))}catch(a){h(String(a))}else if(1&d)try{return JSON.parse(c.substring(a,f-Number(b))+'"')}catch(b){return JSON.parse(c.substring(a,c.lastIndexOf("\\"))+'"')}g("Unterminated string literal")},k=()=>{f++,n();let a={};try{for(;"}"!==c[f];){if(n(),f>=e&&8&d)return a;let b=j();n(),f++;try{let c=i();Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}catch(b){if(8&d)return a;throw b}n(),","===c[f]&&f++}}catch(b){if(8&d)return a;g("Expected '}' at end of object")}return f++,a},l=()=>{f++;let a=[];try{for(;"]"!==c[f];)a.push(i()),n(),","===c[f]&&f++}catch(b){if(4&d)return a;g("Expected ']' at end of array")}return f++,a},m=()=>{if(0===f){"-"===c&&2&d&&g("Not sure what '-' is");try{return JSON.parse(c)}catch(a){if(2&d)try{if("."===c[c.length-1])return JSON.parse(c.substring(0,c.lastIndexOf(".")));return JSON.parse(c.substring(0,c.lastIndexOf("e")))}catch(a){}h(String(a))}}let a=f;for("-"===c[f]&&f++;c[f]&&!",]}".includes(c[f]);)f++;f!=e||2&d||g("Unterminated number literal");try{return JSON.parse(c.substring(a,f))}catch(b){"-"===c.substring(a,f)&&2&d&&g("Not sure what '-' is");try{return JSON.parse(c.substring(a,c.lastIndexOf("e")))}catch(a){h(String(a))}}},n=()=>{for(;f<e&&" \n\r	".includes(c[f]);)f++},i()})(a,2^si);class sm extends sg{constructor(a){super(),bS.add(this),bT.set(this,void 0),bU.set(this,void 0),bV.set(this,void 0),qP(this,bT,a,"f"),qP(this,bU,[],"f")}get currentChatCompletionSnapshot(){return qQ(this,bV,"f")}static fromReadableStream(a){let b=new sm(null);return b._run(()=>b._fromReadableStream(a)),b}static createChatCompletion(a,b,c){let d=new sm(b);return d._run(()=>d._runChatCompletion(a,{...b,stream:!0},{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}async _createChatCompletion(a,b,c){super._createChatCompletion;let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),qQ(this,bS,"m",bW).call(this);let e=await a.chat.completions.create({...b,stream:!0},{...c,signal:this.controller.signal});for await(let a of(this._connected(),e))qQ(this,bS,"m",bY).call(this,a);if(e.controller.signal?.aborted)throw new qW;return this._addChatCompletion(qQ(this,bS,"m",b_).call(this))}async _fromReadableStream(a,b){let c,d=b?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),qQ(this,bS,"m",bW).call(this),this._connected();let e=rG.fromReadableStream(a,this.controller);for await(let a of e)c&&c!==a.id&&this._addChatCompletion(qQ(this,bS,"m",b_).call(this)),qQ(this,bS,"m",bY).call(this,a),c=a.id;if(e.controller.signal?.aborted)throw new qW;return this._addChatCompletion(qQ(this,bS,"m",b_).call(this))}[(bT=new WeakMap,bU=new WeakMap,bV=new WeakMap,bS=new WeakSet,bW=function(){this.ended||qP(this,bV,void 0,"f")},bX=function(a){let b=qQ(this,bU,"f")[a.index];return b||(b={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},qQ(this,bU,"f")[a.index]=b),b},bY=function(a){if(this.ended)return;let b=qQ(this,bS,"m",b1).call(this,a);for(let c of(this._emit("chunk",a,b),a.choices)){let a=b.choices[c.index];null!=c.delta.content&&a.message?.role==="assistant"&&a.message?.content&&(this._emit("content",c.delta.content,a.message.content),this._emit("content.delta",{delta:c.delta.content,snapshot:a.message.content,parsed:a.message.parsed})),null!=c.delta.refusal&&a.message?.role==="assistant"&&a.message?.refusal&&this._emit("refusal.delta",{delta:c.delta.refusal,snapshot:a.message.refusal}),c.logprobs?.content!=null&&a.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:c.logprobs?.content,snapshot:a.logprobs?.content??[]}),c.logprobs?.refusal!=null&&a.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:c.logprobs?.refusal,snapshot:a.logprobs?.refusal??[]});let d=qQ(this,bS,"m",bX).call(this,a);for(let b of(a.finish_reason&&(qQ(this,bS,"m",b$).call(this,a),null!=d.current_tool_call_index&&qQ(this,bS,"m",bZ).call(this,a,d.current_tool_call_index)),c.delta.tool_calls??[]))d.current_tool_call_index!==b.index&&(qQ(this,bS,"m",b$).call(this,a),null!=d.current_tool_call_index&&qQ(this,bS,"m",bZ).call(this,a,d.current_tool_call_index)),d.current_tool_call_index=b.index;for(let b of c.delta.tool_calls??[]){let c=a.message.tool_calls?.[b.index];c?.type&&(c?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:c.function?.name,index:b.index,arguments:c.function.arguments,parsed_arguments:c.function.parsed_arguments,arguments_delta:b.function?.arguments??""}):sp(c?.type))}}},bZ=function(a,b){if(qQ(this,bS,"m",bX).call(this,a).done_tool_calls.has(b))return;let c=a.message.tool_calls?.[b];if(!c)throw Error("no tool call snapshot");if(!c.type)throw Error("tool call snapshot missing `type`");if("function"===c.type){let a=qQ(this,bT,"f")?.tools?.find(a=>r7(a)&&a.function.name===c.function.name);this._emit("tool_calls.function.arguments.done",{name:c.function.name,index:b,arguments:c.function.arguments,parsed_arguments:r9(a)?a.$parseRaw(c.function.arguments):a?.function.strict?JSON.parse(c.function.arguments):null})}else sp(c.type)},b$=function(a){let b=qQ(this,bS,"m",bX).call(this,a);if(a.message.content&&!b.content_done){b.content_done=!0;let c=qQ(this,bS,"m",b0).call(this);this._emit("content.done",{content:a.message.content,parsed:c?c.$parseRaw(a.message.content):null})}a.message.refusal&&!b.refusal_done&&(b.refusal_done=!0,this._emit("refusal.done",{refusal:a.message.refusal})),a.logprobs?.content&&!b.logprobs_content_done&&(b.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:a.logprobs.content})),a.logprobs?.refusal&&!b.logprobs_refusal_done&&(b.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:a.logprobs.refusal}))},b_=function(){if(this.ended)throw new qU("stream has ended, this shouldn't happen");let a=qQ(this,bV,"f");if(!a)throw new qU("request ended without sending any chunks");return qP(this,bV,void 0,"f"),qP(this,bU,[],"f"),function(a,b){var c;let{id:d,choices:e,created:f,model:g,system_fingerprint:h,...i}=a;return c={...i,id:d,choices:e.map(({message:b,finish_reason:c,index:d,logprobs:e,...f})=>{if(!c)throw new qU(`missing finish_reason for choice ${d}`);let{content:g=null,function_call:h,tool_calls:i,...j}=b,k=b.role;if(!k)throw new qU(`missing role for choice ${d}`);if(h){let{arguments:a,name:i}=h;if(null==a)throw new qU(`missing function_call.arguments for choice ${d}`);if(!i)throw new qU(`missing function_call.name for choice ${d}`);return{...f,message:{content:g,function_call:{arguments:a,name:i},role:k,refusal:b.refusal??null},finish_reason:c,index:d,logprobs:e}}return i?{...f,index:d,finish_reason:c,logprobs:e,message:{...j,role:k,content:g,refusal:b.refusal??null,tool_calls:i.map((b,c)=>{let{function:e,type:f,id:g,...h}=b,{arguments:i,name:j,...k}=e||{};if(null==g)throw new qU(`missing choices[${d}].tool_calls[${c}].id
${sn(a)}`);if(null==f)throw new qU(`missing choices[${d}].tool_calls[${c}].type
${sn(a)}`);if(null==j)throw new qU(`missing choices[${d}].tool_calls[${c}].function.name
${sn(a)}`);if(null==i)throw new qU(`missing choices[${d}].tool_calls[${c}].function.arguments
${sn(a)}`);return{...h,id:g,type:f,function:{...k,name:j,arguments:i}}})}}:{...f,message:{...j,content:g,role:k,refusal:b.refusal??null},finish_reason:c,index:d,logprobs:e}}),created:f,model:g,object:"chat.completion",...h?{system_fingerprint:h}:{}},b&&sb(b)?sa(c,b):{...c,choices:c.choices.map(a=>(sc(a.message.tool_calls),{...a,message:{...a.message,parsed:null,...a.message.tool_calls?{tool_calls:a.message.tool_calls}:void 0}}))}}(a,qQ(this,bT,"f"))},b0=function(){let a=qQ(this,bT,"f")?.response_format;return r8(a)?a:null},b1=function(a){var b,c,d,e;let f=qQ(this,bV,"f"),{choices:g,...h}=a;for(let{delta:g,finish_reason:i,index:j,logprobs:k=null,...l}of(f?Object.assign(f,h):f=qP(this,bV,{...h,choices:[]},"f"),a.choices)){let a=f.choices[j];if(a||(a=f.choices[j]={finish_reason:i,index:j,message:{},logprobs:k,...l}),k)if(a.logprobs){let{content:d,refusal:e,...f}=k;so(f),Object.assign(a.logprobs,f),d&&((b=a.logprobs).content??(b.content=[]),a.logprobs.content.push(...d)),e&&((c=a.logprobs).refusal??(c.refusal=[]),a.logprobs.refusal.push(...e))}else a.logprobs=Object.assign({},k);if(i&&(a.finish_reason=i,qQ(this,bT,"f")&&sb(qQ(this,bT,"f")))){if("length"===i)throw new q5;if("content_filter"===i)throw new q6}if(Object.assign(a,l),!g)continue;let{content:h,refusal:m,function_call:n,role:o,tool_calls:p,...q}=g;if(so(q),Object.assign(a.message,q),m&&(a.message.refusal=(a.message.refusal||"")+m),o&&(a.message.role=o),n&&(a.message.function_call?(n.name&&(a.message.function_call.name=n.name),n.arguments&&((d=a.message.function_call).arguments??(d.arguments=""),a.message.function_call.arguments+=n.arguments)):a.message.function_call=n),h&&(a.message.content=(a.message.content||"")+h,!a.message.refusal&&qQ(this,bS,"m",b0).call(this)&&(a.message.parsed=sl(a.message.content))),p)for(let{index:b,id:c,type:d,function:f,...g}of(a.message.tool_calls||(a.message.tool_calls=[]),p)){let h=(e=a.message.tool_calls)[b]??(e[b]={});Object.assign(h,g),c&&(h.id=c),d&&(h.type=d),f&&(h.function??(h.function={name:f.name??"",arguments:""})),f?.name&&(h.function.name=f.name),f?.arguments&&(h.function.arguments+=f.arguments,function(a,b){if(!a||!("tools"in a)||!a.tools)return!1;let c=a.tools?.find(a=>r7(a)&&a.function?.name===b.function.name);return r7(c)&&(r9(c)||c?.function.strict||!1)}(qQ(this,bT,"f"),h)&&(h.function.parsed_arguments=sl(h.function.arguments)))}}return f},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("chunk",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new rG(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sn(a){return JSON.stringify(a)}function so(a){}function sp(a){}class sq extends sm{static fromReadableStream(a){let b=new sq(null);return b._run(()=>b._fromReadableStream(a)),b}static runTools(a,b,c){let d=new sq(b),e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runTools"}};return d._run(()=>d._runTools(a,b,e)),d}}class sr extends r2{constructor(){super(...arguments),this.messages=new r6(this._client)}create(a,b){return this._client.post("/chat/completions",{body:a,...b,stream:a.stream??!1})}retrieve(a,b){return this._client.get(r5`/chat/completions/${a}`,b)}update(a,b,c){return this._client.post(r5`/chat/completions/${a}`,{body:b,...c})}list(a={},b){return this._client.getAPIList("/chat/completions",rQ,{query:a,...b})}delete(a,b){return this._client.delete(r5`/chat/completions/${a}`,b)}parse(a,b){for(let b of a.tools??[]){if("function"!==b.type)throw new qU(`Currently only \`function\` tool types support auto-parsing; Received \`${b.type}\``);if(!0!==b.function.strict)throw new qU(`The \`${b.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(a,{...b,headers:{...b?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(b=>sa(b,a))}runTools(a,b){return a.stream?sq.runTools(this._client,a,b):sh.runTools(this._client,a,b)}stream(a,b){return sm.createChatCompletion(this._client,a,b)}}sr.Messages=r6;class ss extends r2{constructor(){super(...arguments),this.completions=new sr(this._client)}}ss.Completions=sr,a.s([],738246);let st=Symbol("brand.privateNullableHeaders"),su=a=>{let b=new Headers,c=new Set;for(let d of a){let a=new Set;for(let[e,f]of function*(a){let b;if(!a)return;if(st in a){let{values:b,nulls:c}=a;for(let a of(yield*b.entries(),c))yield[a,null];return}let c=!1;for(let d of(a instanceof Headers?b=a.entries():ra(a)?b=a:(c=!0,b=Object.entries(a??{})),b)){let a=d[0];if("string"!=typeof a)throw TypeError("expected header name to be a string");let b=ra(d[1])?d[1]:[d[1]],e=!1;for(let d of b)void 0!==d&&(c&&!e&&(e=!0,yield[a,null]),yield[a,d])}}(d)){let d=e.toLowerCase();a.has(d)||(b.delete(e),a.add(d)),null===f?(b.delete(e),c.add(d)):(b.append(e,f),c.delete(d))}}return{[st]:!0,values:b,nulls:c}};class sv extends r2{create(a,b){return this._client.post("/audio/speech",{body:a,...b,headers:su([{Accept:"application/octet-stream"},b?.headers]),__binaryResponse:!0})}}class sw extends r2{create(a,b){return this._client.post("/audio/transcriptions",rV({body:a,...b,stream:a.stream??!1,__metadata:{model:a.model}},this._client))}}class sx extends r2{create(a,b){return this._client.post("/audio/translations",rV({body:a,...b,__metadata:{model:a.model}},this._client))}}class sy extends r2{constructor(){super(...arguments),this.transcriptions=new sw(this._client),this.translations=new sx(this._client),this.speech=new sv(this._client)}}sy.Transcriptions=sw,sy.Translations=sx,sy.Speech=sv;class sz extends r2{create(a,b){return this._client.post("/batches",{body:a,...b})}retrieve(a,b){return this._client.get(r5`/batches/${a}`,b)}list(a={},b){return this._client.getAPIList("/batches",rQ,{query:a,...b})}cancel(a,b){return this._client.post(r5`/batches/${a}/cancel`,b)}}class sA extends r2{create(a,b){return this._client.post("/assistants",{body:a,...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}retrieve(a,b){return this._client.get(r5`/assistants/${a}`,{...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}update(a,b,c){return this._client.post(r5`/assistants/${a}`,{body:b,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a={},b){return this._client.getAPIList("/assistants",rQ,{query:a,...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}delete(a,b){return this._client.delete(r5`/assistants/${a}`,{...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}}class sB extends r2{create(a,b){return this._client.post("/realtime/sessions",{body:a,...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}}class sC extends r2{create(a,b){return this._client.post("/realtime/transcription_sessions",{body:a,...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}}class sD extends r2{constructor(){super(...arguments),this.sessions=new sB(this._client),this.transcriptionSessions=new sC(this._client)}}sD.Sessions=sB,sD.TranscriptionSessions=sC;class sE extends r2{create(a,b,c){return this._client.post(r5`/threads/${a}/messages`,{body:b,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}retrieve(a,b,c){let{thread_id:d}=b;return this._client.get(r5`/threads/${d}/messages/${a}`,{...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}update(a,b,c){let{thread_id:d,...e}=b;return this._client.post(r5`/threads/${d}/messages/${a}`,{body:e,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a,b={},c){return this._client.getAPIList(r5`/threads/${a}/messages`,rQ,{query:b,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}delete(a,b,c){let{thread_id:d}=b;return this._client.delete(r5`/threads/${d}/messages/${a}`,{...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}}class sF extends r2{retrieve(a,b,c){let{thread_id:d,run_id:e,...f}=b;return this._client.get(r5`/threads/${d}/runs/${e}/steps/${a}`,{query:f,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a,b,c){let{thread_id:d,...e}=b;return this._client.getAPIList(r5`/threads/${d}/runs/${a}/steps`,rQ,{query:e,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}}let sG=a=>void 0!==globalThis.process?globalThis.process.env?.[a]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(a)?.trim():void 0;class sH extends sf{constructor(){super(...arguments),b2.add(this),b4.set(this,[]),b5.set(this,{}),b6.set(this,{}),b7.set(this,void 0),b8.set(this,void 0),b9.set(this,void 0),ca.set(this,void 0),cb.set(this,void 0),cc.set(this,void 0),cd.set(this,void 0),ce.set(this,void 0),cf.set(this,void 0)}[(b4=new WeakMap,b5=new WeakMap,b6=new WeakMap,b7=new WeakMap,b8=new WeakMap,b9=new WeakMap,ca=new WeakMap,cb=new WeakMap,cc=new WeakMap,cd=new WeakMap,ce=new WeakMap,cf=new WeakMap,b2=new WeakSet,Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("event",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(a){let b=new b3;return b._run(()=>b._fromReadableStream(a)),b}async _fromReadableStream(a,b){let c=b?.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort())),this._connected();let d=rG.fromReadableStream(a,this.controller);for await(let a of d)qQ(this,b2,"m",cg).call(this,a);if(d.controller.signal?.aborted)throw new qW;return this._addRun(qQ(this,b2,"m",ch).call(this))}toReadableStream(){return new rG(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(a,b,c,d){let e=new b3;return e._run(()=>e._runToolAssistantStream(a,b,c,{...d,headers:{...d?.headers,"X-Stainless-Helper-Method":"stream"}})),e}async _createToolAssistantStream(a,b,c,d){let e=d?.signal;e&&(e.aborted&&this.controller.abort(),e.addEventListener("abort",()=>this.controller.abort()));let f={...c,stream:!0},g=await a.submitToolOutputs(b,f,{...d,signal:this.controller.signal});for await(let a of(this._connected(),g))qQ(this,b2,"m",cg).call(this,a);if(g.controller.signal?.aborted)throw new qW;return this._addRun(qQ(this,b2,"m",ch).call(this))}static createThreadAssistantStream(a,b,c){let d=new b3;return d._run(()=>d._threadAssistantStream(a,b,{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}static createAssistantStream(a,b,c,d){let e=new b3;return e._run(()=>e._runAssistantStream(a,b,c,{...d,headers:{...d?.headers,"X-Stainless-Helper-Method":"stream"}})),e}currentEvent(){return qQ(this,cd,"f")}currentRun(){return qQ(this,ce,"f")}currentMessageSnapshot(){return qQ(this,b7,"f")}currentRunStepSnapshot(){return qQ(this,cf,"f")}async finalRunSteps(){return await this.done(),Object.values(qQ(this,b5,"f"))}async finalMessages(){return await this.done(),Object.values(qQ(this,b6,"f"))}async finalRun(){if(await this.done(),!qQ(this,b8,"f"))throw Error("Final run was not received.");return qQ(this,b8,"f")}async _createThreadAssistantStream(a,b,c){let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort()));let e={...b,stream:!0},f=await a.createAndRun(e,{...c,signal:this.controller.signal});for await(let a of(this._connected(),f))qQ(this,b2,"m",cg).call(this,a);if(f.controller.signal?.aborted)throw new qW;return this._addRun(qQ(this,b2,"m",ch).call(this))}async _createAssistantStream(a,b,c,d){let e=d?.signal;e&&(e.aborted&&this.controller.abort(),e.addEventListener("abort",()=>this.controller.abort()));let f={...c,stream:!0},g=await a.create(b,f,{...d,signal:this.controller.signal});for await(let a of(this._connected(),g))qQ(this,b2,"m",cg).call(this,a);if(g.controller.signal?.aborted)throw new qW;return this._addRun(qQ(this,b2,"m",ch).call(this))}static accumulateDelta(a,b){for(let[c,d]of Object.entries(b)){if(!a.hasOwnProperty(c)){a[c]=d;continue}let b=a[c];if(null==b||"index"===c||"type"===c){a[c]=d;continue}if("string"==typeof b&&"string"==typeof d)b+=d;else if("number"==typeof b&&"number"==typeof d)b+=d;else if(rb(b)&&rb(d))b=this.accumulateDelta(b,d);else if(Array.isArray(b)&&Array.isArray(d)){if(b.every(a=>"string"==typeof a||"number"==typeof a)){b.push(...d);continue}for(let a of d){if(!rb(a))throw Error(`Expected array delta entry to be an object but got: ${a}`);let c=a.index;if(null==c)throw console.error(a),Error("Expected array delta entry to have an `index` property");if("number"!=typeof c)throw Error(`Expected array delta entry \`index\` property to be a number but got ${c}`);let d=b[c];null==d?b.push(a):b[c]=this.accumulateDelta(d,a)}continue}else throw Error(`Unhandled record type: ${c}, deltaValue: ${d}, accValue: ${b}`);a[c]=b}return a}_addRun(a){return a}async _threadAssistantStream(a,b,c){return await this._createThreadAssistantStream(b,a,c)}async _runAssistantStream(a,b,c,d){return await this._createAssistantStream(b,a,c,d)}async _runToolAssistantStream(a,b,c,d){return await this._createToolAssistantStream(b,a,c,d)}}b3=sH,cg=function(a){if(!this.ended)switch(qP(this,cd,a,"f"),qQ(this,b2,"m",ck).call(this,a),a.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":qQ(this,b2,"m",co).call(this,a);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":qQ(this,b2,"m",cj).call(this,a);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":qQ(this,b2,"m",ci).call(this,a);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},ch=function(){if(this.ended)throw new qU("stream has ended, this shouldn't happen");if(!qQ(this,b8,"f"))throw Error("Final run has not been received");return qQ(this,b8,"f")},ci=function(a){let[b,c]=qQ(this,b2,"m",cm).call(this,a,qQ(this,b7,"f"));for(let a of(qP(this,b7,b,"f"),qQ(this,b6,"f")[b.id]=b,c)){let c=b.content[a.index];c?.type=="text"&&this._emit("textCreated",c.text)}switch(a.event){case"thread.message.created":this._emit("messageCreated",a.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",a.data.delta,b),a.data.delta.content)for(let c of a.data.delta.content){if("text"==c.type&&c.text){let a=c.text,d=b.content[c.index];if(d&&"text"==d.type)this._emit("textDelta",a,d.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(c.index!=qQ(this,b9,"f")){if(qQ(this,ca,"f"))switch(qQ(this,ca,"f").type){case"text":this._emit("textDone",qQ(this,ca,"f").text,qQ(this,b7,"f"));break;case"image_file":this._emit("imageFileDone",qQ(this,ca,"f").image_file,qQ(this,b7,"f"))}qP(this,b9,c.index,"f")}qP(this,ca,b.content[c.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==qQ(this,b9,"f")){let b=a.data.content[qQ(this,b9,"f")];if(b)switch(b.type){case"image_file":this._emit("imageFileDone",b.image_file,qQ(this,b7,"f"));break;case"text":this._emit("textDone",b.text,qQ(this,b7,"f"))}}qQ(this,b7,"f")&&this._emit("messageDone",a.data),qP(this,b7,void 0,"f")}},cj=function(a){let b=qQ(this,b2,"m",cl).call(this,a);switch(qP(this,cf,b,"f"),a.event){case"thread.run.step.created":this._emit("runStepCreated",a.data);break;case"thread.run.step.delta":let c=a.data.delta;if(c.step_details&&"tool_calls"==c.step_details.type&&c.step_details.tool_calls&&"tool_calls"==b.step_details.type)for(let a of c.step_details.tool_calls)a.index==qQ(this,cb,"f")?this._emit("toolCallDelta",a,b.step_details.tool_calls[a.index]):(qQ(this,cc,"f")&&this._emit("toolCallDone",qQ(this,cc,"f")),qP(this,cb,a.index,"f"),qP(this,cc,b.step_details.tool_calls[a.index],"f"),qQ(this,cc,"f")&&this._emit("toolCallCreated",qQ(this,cc,"f")));this._emit("runStepDelta",a.data.delta,b);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":qP(this,cf,void 0,"f"),"tool_calls"==a.data.step_details.type&&qQ(this,cc,"f")&&(this._emit("toolCallDone",qQ(this,cc,"f")),qP(this,cc,void 0,"f")),this._emit("runStepDone",a.data,b)}},ck=function(a){qQ(this,b4,"f").push(a),this._emit("event",a)},cl=function(a){switch(a.event){case"thread.run.step.created":return qQ(this,b5,"f")[a.data.id]=a.data,a.data;case"thread.run.step.delta":let b=qQ(this,b5,"f")[a.data.id];if(!b)throw Error("Received a RunStepDelta before creation of a snapshot");let c=a.data;if(c.delta){let d=b3.accumulateDelta(b,c.delta);qQ(this,b5,"f")[a.data.id]=d}return qQ(this,b5,"f")[a.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":qQ(this,b5,"f")[a.data.id]=a.data}if(qQ(this,b5,"f")[a.data.id])return qQ(this,b5,"f")[a.data.id];throw Error("No snapshot available")},cm=function(a,b){let c=[];switch(a.event){case"thread.message.created":return[a.data,c];case"thread.message.delta":if(!b)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let d=a.data;if(d.delta.content)for(let a of d.delta.content)if(a.index in b.content){let c=b.content[a.index];b.content[a.index]=qQ(this,b2,"m",cn).call(this,a,c)}else b.content[a.index]=a,c.push(a);return[b,c];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(b)return[b,c];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},cn=function(a,b){return b3.accumulateDelta(b,a)},co=function(a){switch(qP(this,ce,a.data,"f"),a.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":qP(this,b8,a.data,"f"),qQ(this,cc,"f")&&(this._emit("toolCallDone",qQ(this,cc,"f")),qP(this,cc,void 0,"f"))}};class sI extends r2{constructor(){super(...arguments),this.steps=new sF(this._client)}create(a,b,c){let{include:d,...e}=b;return this._client.post(r5`/threads/${a}/runs`,{query:{include:d},body:e,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers]),stream:b.stream??!1})}retrieve(a,b,c){let{thread_id:d}=b;return this._client.get(r5`/threads/${d}/runs/${a}`,{...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}update(a,b,c){let{thread_id:d,...e}=b;return this._client.post(r5`/threads/${d}/runs/${a}`,{body:e,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a,b={},c){return this._client.getAPIList(r5`/threads/${a}/runs`,rQ,{query:b,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}cancel(a,b,c){let{thread_id:d}=b;return this._client.post(r5`/threads/${d}/runs/${a}/cancel`,{...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}async createAndPoll(a,b,c){let d=await this.create(a,b,c);return await this.poll(d.id,{thread_id:a},c)}createAndStream(a,b,c){return sH.createAssistantStream(a,this._client.beta.threads.runs,b,c)}async poll(a,b,c){let d=su([c?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":c?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:e,response:f}=await this.retrieve(a,b,{...c,headers:{...c?.headers,...d}}).withResponse();switch(e.status){case"queued":case"in_progress":case"cancelling":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=f.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await rc(g);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return e}}}stream(a,b,c){return sH.createAssistantStream(a,this._client.beta.threads.runs,b,c)}submitToolOutputs(a,b,c){let{thread_id:d,...e}=b;return this._client.post(r5`/threads/${d}/runs/${a}/submit_tool_outputs`,{body:e,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers]),stream:b.stream??!1})}async submitToolOutputsAndPoll(a,b,c){let d=await this.submitToolOutputs(a,b,c);return await this.poll(d.id,b,c)}submitToolOutputsStream(a,b,c){return sH.createToolAssistantStream(a,this._client.beta.threads.runs,b,c)}}sI.Steps=sF;class sJ extends r2{constructor(){super(...arguments),this.runs=new sI(this._client),this.messages=new sE(this._client)}create(a={},b){return this._client.post("/threads",{body:a,...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}retrieve(a,b){return this._client.get(r5`/threads/${a}`,{...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}update(a,b,c){return this._client.post(r5`/threads/${a}`,{body:b,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}delete(a,b){return this._client.delete(r5`/threads/${a}`,{...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}createAndRun(a,b){return this._client.post("/threads/runs",{body:a,...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers]),stream:a.stream??!1})}async createAndRunPoll(a,b){let c=await this.createAndRun(a,b);return await this.runs.poll(c.id,{thread_id:c.thread_id},b)}createAndRunStream(a,b){return sH.createThreadAssistantStream(a,this._client.beta.threads,b)}}sJ.Runs=sI,sJ.Messages=sE;class sK extends r2{constructor(){super(...arguments),this.realtime=new sD(this._client),this.assistants=new sA(this._client),this.threads=new sJ(this._client)}}sK.Realtime=sD,sK.Assistants=sA,sK.Threads=sJ;class sL extends r2{create(a,b){return this._client.post("/completions",{body:a,...b,stream:a.stream??!1})}}class sM extends r2{retrieve(a,b,c){let{container_id:d}=b;return this._client.get(r5`/containers/${d}/files/${a}/content`,{...c,headers:su([{Accept:"application/binary"},c?.headers]),__binaryResponse:!0})}}class sN extends r2{constructor(){super(...arguments),this.content=new sM(this._client)}create(a,b,c){return this._client.post(r5`/containers/${a}/files`,rV({body:b,...c},this._client))}retrieve(a,b,c){let{container_id:d}=b;return this._client.get(r5`/containers/${d}/files/${a}`,c)}list(a,b={},c){return this._client.getAPIList(r5`/containers/${a}/files`,rQ,{query:b,...c})}delete(a,b,c){let{container_id:d}=b;return this._client.delete(r5`/containers/${d}/files/${a}`,{...c,headers:su([{Accept:"*/*"},c?.headers])})}}sN.Content=sM;class sO extends r2{constructor(){super(...arguments),this.files=new sN(this._client)}create(a,b){return this._client.post("/containers",{body:a,...b})}retrieve(a,b){return this._client.get(r5`/containers/${a}`,b)}list(a={},b){return this._client.getAPIList("/containers",rQ,{query:a,...b})}delete(a,b){return this._client.delete(r5`/containers/${a}`,{...b,headers:su([{Accept:"*/*"},b?.headers])})}}sO.Files=sN;class sP extends r2{create(a,b){let c=!!a.encoding_format,d=c?a.encoding_format:"base64";c&&rE(this._client).debug("embeddings/user defined encoding_format:",a.encoding_format);let e=this._client.post("/embeddings",{body:{...a,encoding_format:d},...b});return c?e:(rE(this._client).debug("embeddings/decoding base64 embeddings from base64"),e._thenUnwrap(a=>(a&&a.data&&a.data.forEach(a=>{let b=a.embedding;a.embedding=(a=>{if("undefined"!=typeof Buffer){let b=Buffer.from(a,"base64");return Array.from(new Float32Array(b.buffer,b.byteOffset,b.length/Float32Array.BYTES_PER_ELEMENT))}{let b=atob(a),c=b.length,d=new Uint8Array(c);for(let a=0;a<c;a++)d[a]=b.charCodeAt(a);return Array.from(new Float32Array(d.buffer))}})(b)}),a)))}}class sQ extends r2{retrieve(a,b,c){let{eval_id:d,run_id:e}=b;return this._client.get(r5`/evals/${d}/runs/${e}/output_items/${a}`,c)}list(a,b,c){let{eval_id:d,...e}=b;return this._client.getAPIList(r5`/evals/${d}/runs/${a}/output_items`,rQ,{query:e,...c})}}class sR extends r2{constructor(){super(...arguments),this.outputItems=new sQ(this._client)}create(a,b,c){return this._client.post(r5`/evals/${a}/runs`,{body:b,...c})}retrieve(a,b,c){let{eval_id:d}=b;return this._client.get(r5`/evals/${d}/runs/${a}`,c)}list(a,b={},c){return this._client.getAPIList(r5`/evals/${a}/runs`,rQ,{query:b,...c})}delete(a,b,c){let{eval_id:d}=b;return this._client.delete(r5`/evals/${d}/runs/${a}`,c)}cancel(a,b,c){let{eval_id:d}=b;return this._client.post(r5`/evals/${d}/runs/${a}`,c)}}sR.OutputItems=sQ;class sS extends r2{constructor(){super(...arguments),this.runs=new sR(this._client)}create(a,b){return this._client.post("/evals",{body:a,...b})}retrieve(a,b){return this._client.get(r5`/evals/${a}`,b)}update(a,b,c){return this._client.post(r5`/evals/${a}`,{body:b,...c})}list(a={},b){return this._client.getAPIList("/evals",rQ,{query:a,...b})}delete(a,b){return this._client.delete(r5`/evals/${a}`,b)}}sS.Runs=sR;class sT extends r2{create(a,b){return this._client.post("/files",rV({body:a,...b},this._client))}retrieve(a,b){return this._client.get(r5`/files/${a}`,b)}list(a={},b){return this._client.getAPIList("/files",rQ,{query:a,...b})}delete(a,b){return this._client.delete(r5`/files/${a}`,b)}content(a,b){return this._client.get(r5`/files/${a}/content`,{...b,headers:su([{Accept:"application/binary"},b?.headers]),__binaryResponse:!0})}async waitForProcessing(a,{pollInterval:b=5e3,maxWait:c=18e5}={}){let d=new Set(["processed","error","deleted"]),e=Date.now(),f=await this.retrieve(a);for(;!f.status||!d.has(f.status);)if(await rc(b),f=await this.retrieve(a),Date.now()-e>c)throw new qY({message:`Giving up on waiting for file ${a} to finish processing after ${c} milliseconds.`});return f}}class sU extends r2{}class sV extends r2{run(a,b){return this._client.post("/fine_tuning/alpha/graders/run",{body:a,...b})}validate(a,b){return this._client.post("/fine_tuning/alpha/graders/validate",{body:a,...b})}}class sW extends r2{constructor(){super(...arguments),this.graders=new sV(this._client)}}sW.Graders=sV;class sX extends r2{create(a,b,c){return this._client.getAPIList(r5`/fine_tuning/checkpoints/${a}/permissions`,rP,{body:b,method:"post",...c})}retrieve(a,b={},c){return this._client.get(r5`/fine_tuning/checkpoints/${a}/permissions`,{query:b,...c})}delete(a,b,c){let{fine_tuned_model_checkpoint:d}=b;return this._client.delete(r5`/fine_tuning/checkpoints/${d}/permissions/${a}`,c)}}class sY extends r2{constructor(){super(...arguments),this.permissions=new sX(this._client)}}sY.Permissions=sX;class sZ extends r2{list(a,b={},c){return this._client.getAPIList(r5`/fine_tuning/jobs/${a}/checkpoints`,rQ,{query:b,...c})}}class s$ extends r2{constructor(){super(...arguments),this.checkpoints=new sZ(this._client)}create(a,b){return this._client.post("/fine_tuning/jobs",{body:a,...b})}retrieve(a,b){return this._client.get(r5`/fine_tuning/jobs/${a}`,b)}list(a={},b){return this._client.getAPIList("/fine_tuning/jobs",rQ,{query:a,...b})}cancel(a,b){return this._client.post(r5`/fine_tuning/jobs/${a}/cancel`,b)}listEvents(a,b={},c){return this._client.getAPIList(r5`/fine_tuning/jobs/${a}/events`,rQ,{query:b,...c})}pause(a,b){return this._client.post(r5`/fine_tuning/jobs/${a}/pause`,b)}resume(a,b){return this._client.post(r5`/fine_tuning/jobs/${a}/resume`,b)}}s$.Checkpoints=sZ;class s_ extends r2{constructor(){super(...arguments),this.methods=new sU(this._client),this.jobs=new s$(this._client),this.checkpoints=new sY(this._client),this.alpha=new sW(this._client)}}s_.Methods=sU,s_.Jobs=s$,s_.Checkpoints=sY,s_.Alpha=sW;class s0 extends r2{}class s1 extends r2{constructor(){super(...arguments),this.graderModels=new s0(this._client)}}s1.GraderModels=s0;class s2 extends r2{createVariation(a,b){return this._client.post("/images/variations",rV({body:a,...b},this._client))}edit(a,b){return this._client.post("/images/edits",rV({body:a,...b,stream:a.stream??!1},this._client))}generate(a,b){return this._client.post("/images/generations",{body:a,...b,stream:a.stream??!1})}}class s3 extends r2{retrieve(a,b){return this._client.get(r5`/models/${a}`,b)}list(a){return this._client.getAPIList("/models",rP,a)}delete(a,b){return this._client.delete(r5`/models/${a}`,b)}}class s4 extends r2{create(a,b){return this._client.post("/moderations",{body:a,...b})}}function s5(a,b){let c=a.output.map(a=>{if("function_call"===a.type)return{...a,parsed_arguments:function(a,b){var c,d;let e=(c=a.tools??[],d=b.name,c.find(a=>"function"===a.type&&a.name===d));return{...b,...b,parsed_arguments:e?.$brand==="auto-parseable-tool"?e.$parseRaw(b.arguments):e?.strict?JSON.parse(b.arguments):null}}(b,a)};if("message"===a.type){let c=a.content.map(a=>{var c,d;return"output_text"===a.type?{...a,parsed:(c=b,d=a.text,c.text?.format?.type!=="json_schema"?null:"$parseRaw"in c.text?.format?(c.text?.format).$parseRaw(d):JSON.parse(d))}:a});return{...a,content:c}}return a}),d=Object.assign({},a,{output:c});return Object.getOwnPropertyDescriptor(a,"output_text")||s6(d),Object.defineProperty(d,"output_parsed",{enumerable:!0,get(){for(let a of d.output)if("message"===a.type){for(let b of a.content)if("output_text"===b.type&&null!==b.parsed)return b.parsed}return null}}),d}function s6(a){let b=[];for(let c of a.output)if("message"===c.type)for(let a of c.content)"output_text"===a.type&&b.push(a.text);a.output_text=b.join("")}class s7 extends sf{constructor(a){super(),cp.add(this),cq.set(this,void 0),cr.set(this,void 0),cs.set(this,void 0),qP(this,cq,a,"f")}static createResponse(a,b,c){let d=new s7(b);return d._run(()=>d._createOrRetrieveResponse(a,b,{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}async _createOrRetrieveResponse(a,b,c){let d,e=c?.signal;e&&(e.aborted&&this.controller.abort(),e.addEventListener("abort",()=>this.controller.abort())),qQ(this,cp,"m",ct).call(this);let f=null;for await(let e of("response_id"in b?(d=await a.responses.retrieve(b.response_id,{stream:!0},{...c,signal:this.controller.signal,stream:!0}),f=b.starting_after??null):d=await a.responses.create({...b,stream:!0},{...c,signal:this.controller.signal}),this._connected(),d))qQ(this,cp,"m",cu).call(this,e,f);if(d.controller.signal?.aborted)throw new qW;return qQ(this,cp,"m",cv).call(this)}[(cq=new WeakMap,cr=new WeakMap,cs=new WeakMap,cp=new WeakSet,ct=function(){this.ended||qP(this,cr,void 0,"f")},cu=function(a,b){if(this.ended)return;let c=(a,c)=>{(null==b||c.sequence_number>b)&&this._emit(a,c)},d=qQ(this,cp,"m",cw).call(this,a);switch(c("event",a),a.type){case"response.output_text.delta":{let b=d.output[a.output_index];if(!b)throw new qU(`missing output at index ${a.output_index}`);if("message"===b.type){let d=b.content[a.content_index];if(!d)throw new qU(`missing content at index ${a.content_index}`);if("output_text"!==d.type)throw new qU(`expected content to be 'output_text', got ${d.type}`);c("response.output_text.delta",{...a,snapshot:d.text})}break}case"response.function_call_arguments.delta":{let b=d.output[a.output_index];if(!b)throw new qU(`missing output at index ${a.output_index}`);"function_call"===b.type&&c("response.function_call_arguments.delta",{...a,snapshot:b.arguments});break}default:c(a.type,a)}},cv=function(){if(this.ended)throw new qU("stream has ended, this shouldn't happen");let a=qQ(this,cr,"f");if(!a)throw new qU("request ended without sending any events");qP(this,cr,void 0,"f");let b=function(a,b){var c;return b&&(c=b,r8(c.text?.format))?s5(a,b):{...a,output_parsed:null,output:a.output.map(a=>"function_call"===a.type?{...a,parsed_arguments:null}:"message"===a.type?{...a,content:a.content.map(a=>({...a,parsed:null}))}:a)}}(a,qQ(this,cq,"f"));return qP(this,cs,b,"f"),b},cw=function(a){let b=qQ(this,cr,"f");if(!b){if("response.created"!==a.type)throw new qU(`When snapshot hasn't been set yet, expected 'response.created' event, got ${a.type}`);return qP(this,cr,a.response,"f")}switch(a.type){case"response.output_item.added":b.output.push(a.item);break;case"response.content_part.added":{let c=b.output[a.output_index];if(!c)throw new qU(`missing output at index ${a.output_index}`);"message"===c.type&&c.content.push(a.part);break}case"response.output_text.delta":{let c=b.output[a.output_index];if(!c)throw new qU(`missing output at index ${a.output_index}`);if("message"===c.type){let b=c.content[a.content_index];if(!b)throw new qU(`missing content at index ${a.content_index}`);if("output_text"!==b.type)throw new qU(`expected content to be 'output_text', got ${b.type}`);b.text+=a.delta}break}case"response.function_call_arguments.delta":{let c=b.output[a.output_index];if(!c)throw new qU(`missing output at index ${a.output_index}`);"function_call"===c.type&&(c.arguments+=a.delta);break}case"response.completed":qP(this,cr,a.response,"f")}return b},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("event",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let a=qQ(this,cs,"f");if(!a)throw new qU("stream ended without producing a ChatCompletion");return a}}class s8 extends r2{list(a,b={},c){return this._client.getAPIList(r5`/responses/${a}/input_items`,rQ,{query:b,...c})}}class s9 extends r2{constructor(){super(...arguments),this.inputItems=new s8(this._client)}create(a,b){return this._client.post("/responses",{body:a,...b,stream:a.stream??!1})._thenUnwrap(a=>("object"in a&&"response"===a.object&&s6(a),a))}retrieve(a,b={},c){return this._client.get(r5`/responses/${a}`,{query:b,...c,stream:b?.stream??!1})._thenUnwrap(a=>("object"in a&&"response"===a.object&&s6(a),a))}delete(a,b){return this._client.delete(r5`/responses/${a}`,{...b,headers:su([{Accept:"*/*"},b?.headers])})}parse(a,b){return this._client.responses.create(a,b)._thenUnwrap(b=>s5(b,a))}stream(a,b){return s7.createResponse(this._client,a,b)}cancel(a,b){return this._client.post(r5`/responses/${a}/cancel`,b)}}s9.InputItems=s8;class ta extends r2{create(a,b,c){return this._client.post(r5`/uploads/${a}/parts`,rV({body:b,...c},this._client))}}class tb extends r2{constructor(){super(...arguments),this.parts=new ta(this._client)}create(a,b){return this._client.post("/uploads",{body:a,...b})}cancel(a,b){return this._client.post(r5`/uploads/${a}/cancel`,b)}complete(a,b,c){return this._client.post(r5`/uploads/${a}/complete`,{body:b,...c})}}tb.Parts=ta;let tc=async a=>{let b=await Promise.allSettled(a),c=b.filter(a=>"rejected"===a.status);if(c.length){for(let a of c)console.error(a.reason);throw Error(`${c.length} promise(s) failed - see the above errors`)}let d=[];for(let a of b)"fulfilled"===a.status&&d.push(a.value);return d};class td extends r2{create(a,b,c){return this._client.post(r5`/vector_stores/${a}/file_batches`,{body:b,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}retrieve(a,b,c){let{vector_store_id:d}=b;return this._client.get(r5`/vector_stores/${d}/file_batches/${a}`,{...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}cancel(a,b,c){let{vector_store_id:d}=b;return this._client.post(r5`/vector_stores/${d}/file_batches/${a}/cancel`,{...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}async createAndPoll(a,b,c){let d=await this.create(a,b);return await this.poll(a,d.id,c)}listFiles(a,b,c){let{vector_store_id:d,...e}=b;return this._client.getAPIList(r5`/vector_stores/${d}/file_batches/${a}/files`,rQ,{query:e,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}async poll(a,b,c){let d=su([c?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":c?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:e,response:f}=await this.retrieve(b,{vector_store_id:a},{...c,headers:d}).withResponse();switch(e.status){case"in_progress":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=f.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await rc(g);break;case"failed":case"cancelled":case"completed":return e}}}async uploadAndPoll(a,{files:b,fileIds:c=[]},d){if(null==b||0==b.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let e=Math.min(d?.maxConcurrency??5,b.length),f=this._client,g=b.values(),h=[...c];async function i(a){for(let b of a){let a=await f.files.create({file:b,purpose:"assistants"},d);h.push(a.id)}}let j=Array(e).fill(g).map(i);return await tc(j),await this.createAndPoll(a,{file_ids:h})}}class te extends r2{create(a,b,c){return this._client.post(r5`/vector_stores/${a}/files`,{body:b,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}retrieve(a,b,c){let{vector_store_id:d}=b;return this._client.get(r5`/vector_stores/${d}/files/${a}`,{...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}update(a,b,c){let{vector_store_id:d,...e}=b;return this._client.post(r5`/vector_stores/${d}/files/${a}`,{body:e,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a,b={},c){return this._client.getAPIList(r5`/vector_stores/${a}/files`,rQ,{query:b,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}delete(a,b,c){let{vector_store_id:d}=b;return this._client.delete(r5`/vector_stores/${d}/files/${a}`,{...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}async createAndPoll(a,b,c){let d=await this.create(a,b,c);return await this.poll(a,d.id,c)}async poll(a,b,c){let d=su([c?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":c?.pollIntervalMs?.toString()??void 0}]);for(;;){let e=await this.retrieve(b,{vector_store_id:a},{...c,headers:d}).withResponse(),f=e.data;switch(f.status){case"in_progress":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=e.response.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await rc(g);break;case"failed":case"completed":return f}}}async upload(a,b,c){let d=await this._client.files.create({file:b,purpose:"assistants"},c);return this.create(a,{file_id:d.id},c)}async uploadAndPoll(a,b,c){let d=await this.upload(a,b,c);return await this.poll(a,d.id,c)}content(a,b,c){let{vector_store_id:d}=b;return this._client.getAPIList(r5`/vector_stores/${d}/files/${a}/content`,rP,{...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}}class tf extends r2{constructor(){super(...arguments),this.files=new te(this._client),this.fileBatches=new td(this._client)}create(a,b){return this._client.post("/vector_stores",{body:a,...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}retrieve(a,b){return this._client.get(r5`/vector_stores/${a}`,{...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}update(a,b,c){return this._client.post(r5`/vector_stores/${a}`,{body:b,...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}list(a={},b){return this._client.getAPIList("/vector_stores",rQ,{query:a,...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}delete(a,b){return this._client.delete(r5`/vector_stores/${a}`,{...b,headers:su([{"OpenAI-Beta":"assistants=v2"},b?.headers])})}search(a,b,c){return this._client.getAPIList(r5`/vector_stores/${a}/search`,rP,{body:b,method:"post",...c,headers:su([{"OpenAI-Beta":"assistants=v2"},c?.headers])})}}tf.Files=te,tf.FileBatches=td;class tg extends r2{constructor(){super(...arguments),cx.add(this)}async unwrap(a,b,c=this._client.webhookSecret,d=300){return await this.verifySignature(a,b,c,d),JSON.parse(a)}async verifySignature(a,b,c=this._client.webhookSecret,d=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");qQ(this,cx,"m",cy).call(this,c);let e=su([b]).values,f=qQ(this,cx,"m",cz).call(this,e,"webhook-signature"),g=qQ(this,cx,"m",cz).call(this,e,"webhook-timestamp"),h=qQ(this,cx,"m",cz).call(this,e,"webhook-id"),i=parseInt(g,10);if(isNaN(i))throw new q7("Invalid webhook timestamp format");let j=Math.floor(Date.now()/1e3);if(j-i>d)throw new q7("Webhook timestamp is too old");if(i>j+d)throw new q7("Webhook timestamp is too new");let k=f.split(" ").map(a=>a.startsWith("v1,")?a.substring(3):a),l=c.startsWith("whsec_")?Buffer.from(c.replace("whsec_",""),"base64"):Buffer.from(c,"utf-8"),m=h?`${h}.${g}.${a}`:`${g}.${a}`,n=await crypto.subtle.importKey("raw",l,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let a of k)try{let b=Buffer.from(a,"base64");if(await crypto.subtle.verify("HMAC",n,b,new TextEncoder().encode(m)))return}catch{continue}throw new q7("The given webhook signature does not match the expected signature")}}cx=new WeakSet,cy=function(a){if("string"!=typeof a||0===a.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},cz=function(a,b){if(!a)throw Error("Headers are required");let c=a.get(b);if(null==c)throw Error(`Missing required header: ${b}`);return c},a.i(738246);class th{constructor({baseURL:a=sG("OPENAI_BASE_URL"),apiKey:b=sG("OPENAI_API_KEY"),organization:c=sG("OPENAI_ORG_ID")??null,project:d=sG("OPENAI_PROJECT_ID")??null,webhookSecret:e=sG("OPENAI_WEBHOOK_SECRET")??null,...f}={}){if(cA.add(this),cC.set(this,void 0),this.completions=new sL(this),this.chat=new ss(this),this.embeddings=new sP(this),this.files=new sT(this),this.images=new s2(this),this.audio=new sy(this),this.moderations=new s4(this),this.models=new s3(this),this.fineTuning=new s_(this),this.graders=new s1(this),this.vectorStores=new tf(this),this.webhooks=new tg(this),this.beta=new sK(this),this.batches=new sz(this),this.uploads=new tb(this),this.responses=new s9(this),this.evals=new sS(this),this.containers=new sO(this),void 0===b)throw new qU("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const g={apiKey:b,organization:c,project:d,webhookSecret:e,...f,baseURL:a||"https://api.openai.com/v1"};g.dangerouslyAllowBrowser,this.baseURL=g.baseURL,this.timeout=g.timeout??cB.DEFAULT_TIMEOUT,this.logger=g.logger??console;const h="warn";this.logLevel=h,this.logLevel=rz(g.logLevel,"ClientOptions.logLevel",this)??rz(sG("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??h,this.fetchOptions=g.fetchOptions,this.maxRetries=g.maxRetries??2,this.fetch=g.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),qP(this,cC,rk,"f"),this._options=g,this.apiKey=b,this.organization=c,this.project=d,this.webhookSecret=e}withOptions(a){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...a})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:a,nulls:b}){}async authHeaders(a){return su([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(a){return function(a,b={}){let c,d=a,e=function(a=rt){let b;if(void 0!==a.allowEmptyArrays&&"boolean"!=typeof a.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==a.encodeDotInKeys&&"boolean"!=typeof a.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==a.encoder&&void 0!==a.encoder&&"function"!=typeof a.encoder)throw TypeError("Encoder has to be a function.");let c=a.charset||rt.charset;if(void 0!==a.charset&&"utf-8"!==a.charset&&"iso-8859-1"!==a.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let d=rl;if(void 0!==a.format){if(!ro(rn,a.format))throw TypeError("Unknown format option provided.");d=a.format}let e=rn[d],f=rt.filter;if(("function"==typeof a.filter||q9(a.filter))&&(f=a.filter),b=a.arrayFormat&&a.arrayFormat in rr?a.arrayFormat:"indices"in a?a.indices?"indices":"repeat":rt.arrayFormat,"commaRoundTrip"in a&&"boolean"!=typeof a.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let g=void 0===a.allowDots?!0==!!a.encodeDotInKeys||rt.allowDots:!!a.allowDots;return{addQueryPrefix:"boolean"==typeof a.addQueryPrefix?a.addQueryPrefix:rt.addQueryPrefix,allowDots:g,allowEmptyArrays:"boolean"==typeof a.allowEmptyArrays?!!a.allowEmptyArrays:rt.allowEmptyArrays,arrayFormat:b,charset:c,charsetSentinel:"boolean"==typeof a.charsetSentinel?a.charsetSentinel:rt.charsetSentinel,commaRoundTrip:!!a.commaRoundTrip,delimiter:void 0===a.delimiter?rt.delimiter:a.delimiter,encode:"boolean"==typeof a.encode?a.encode:rt.encode,encodeDotInKeys:"boolean"==typeof a.encodeDotInKeys?a.encodeDotInKeys:rt.encodeDotInKeys,encoder:"function"==typeof a.encoder?a.encoder:rt.encoder,encodeValuesOnly:"boolean"==typeof a.encodeValuesOnly?a.encodeValuesOnly:rt.encodeValuesOnly,filter:f,format:d,formatter:e,serializeDate:"function"==typeof a.serializeDate?a.serializeDate:rt.serializeDate,skipNulls:"boolean"==typeof a.skipNulls?a.skipNulls:rt.skipNulls,sort:"function"==typeof a.sort?a.sort:null,strictNullHandling:"boolean"==typeof a.strictNullHandling?a.strictNullHandling:rt.strictNullHandling}}(b);"function"==typeof e.filter?d=(0,e.filter)("",d):q9(e.filter)&&(c=e.filter);let f=[];if("object"!=typeof d||null===d)return"";let g=rr[e.arrayFormat],h="comma"===g&&e.commaRoundTrip;c||(c=Object.keys(d)),e.sort&&c.sort(e.sort);let i=new WeakMap;for(let a=0;a<c.length;++a){let b=c[a];e.skipNulls&&null===d[b]||rs(f,function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u;let v,w=b,x=s,y=0,z=!1;for(;void 0!==(x=x.get(ru))&&!z;){let a=x.get(b);if(y+=1,void 0!==a)if(a===y)throw RangeError("Cyclic object value");else z=!0;void 0===x.get(ru)&&(y=0)}if("function"==typeof k?w=k(c,w):w instanceof Date?w=n?.(w):"comma"===d&&q9(w)&&(w=rq(w,function(a){return a instanceof Date?n?.(a):a})),null===w){if(g)return j&&!q?j(c,rt.encoder,r,"key",o):c;w=""}if("string"==typeof(t=w)||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t||(u=w)&&"object"==typeof u&&u.constructor&&u.constructor.isBuffer&&u.constructor.isBuffer(u)){if(j){let a=q?c:j(c,rt.encoder,r,"key",o);return[p?.(a)+"="+p?.(j(w,rt.encoder,r,"value",o))]}return[p?.(c)+"="+p?.(String(w))]}let A=[];if(void 0===w)return A;if("comma"===d&&q9(w))q&&j&&(w=rq(w,j)),v=[{value:w.length>0?w.join(",")||null:void 0}];else if(q9(k))v=k;else{let a=Object.keys(w);v=l?a.sort(l):a}let B=i?String(c).replace(/\./g,"%2E"):String(c),C=e&&q9(w)&&1===w.length?B+"[]":B;if(f&&q9(w)&&0===w.length)return C+"[]";for(let c=0;c<v.length;++c){let t=v[c],u="object"==typeof t&&void 0!==t.value?t.value:w[t];if(h&&null===u)continue;let x=m&&i?t.replace(/\./g,"%2E"):t,z=q9(w)?"function"==typeof d?d(C,x):C:C+(m?"."+x:"["+x+"]");s.set(b,y);let B=new WeakMap;B.set(ru,s),rs(A,a(u,z,d,e,f,g,h,i,"comma"===d&&q&&q9(w)?null:j,k,l,m,n,o,p,q,r,B))}return A}(d[b],b,g,h,e.allowEmptyArrays,e.strictNullHandling,e.skipNulls,e.encodeDotInKeys,e.encode?e.encoder:null,e.filter,e.sort,e.allowDots,e.serializeDate,e.format,e.formatter,e.encodeValuesOnly,e.charset,i))}let j=f.join(e.delimiter),k=!0===e.addQueryPrefix?"?":"";return e.charsetSentinel&&("iso-8859-1"===e.charset?k+="utf8=%26%2310003%3B&":k+="utf8=%E2%9C%93&"),j.length>0?k+j:""}(a,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${rd}`}defaultIdempotencyKey(){return`stainless-node-retry-${qR()}`}makeStatusError(a,b,c,d){return qV.generate(a,b,c,d)}buildURL(a,b,c){let d=!qQ(this,cA,"m",cD).call(this)&&c||this.baseURL,e=new URL(q8.test(a)?a:d+(d.endsWith("/")&&a.startsWith("/")?a.slice(1):a)),f=this.defaultQuery();return!function(a){if(!a)return!0;for(let b in a)return!1;return!0}(f)&&(b={...f,...b}),"object"==typeof b&&b&&!Array.isArray(b)&&(e.search=this.stringifyQuery(b)),e.toString()}async prepareOptions(a){}async prepareRequest(a,{url:b,options:c}){}get(a,b){return this.methodRequest("get",a,b)}post(a,b){return this.methodRequest("post",a,b)}patch(a,b){return this.methodRequest("patch",a,b)}put(a,b){return this.methodRequest("put",a,b)}delete(a,b){return this.methodRequest("delete",a,b)}methodRequest(a,b,c){return this.request(Promise.resolve(c).then(c=>({method:a,path:b,...c})))}request(a,b=null){return new rM(this,this.makeRequest(a,b,void 0))}async makeRequest(a,b,c){let d=await a,e=d.maxRetries??this.maxRetries;null==b&&(b=e),await this.prepareOptions(d);let{req:f,url:g,timeout:h}=await this.buildRequest(d,{retryCount:e-b});await this.prepareRequest(f,{url:g,options:d});let i="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),j=void 0===c?"":`, retryOf: ${c}`,k=Date.now();if(rE(this).debug(`[${i}] sending request`,rF({retryOfRequestLogID:c,method:d.method,url:g,options:d,headers:f.headers})),d.signal?.aborted)throw new qW;let l=new AbortController,m=await this.fetchWithTimeout(g,f,h,l).catch(qT),n=Date.now();if(m instanceof Error){let a=`retrying, ${b} attempts remaining`;if(d.signal?.aborted)throw new qW;let e=qS(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(b)return rE(this).info(`[${i}] connection ${e?"timed out":"failed"} - ${a}`),rE(this).debug(`[${i}] connection ${e?"timed out":"failed"} (${a})`,rF({retryOfRequestLogID:c,url:g,durationMs:n-k,message:m.message})),this.retryRequest(d,b,c??i);if(rE(this).info(`[${i}] connection ${e?"timed out":"failed"} - error; no more retries left`),rE(this).debug(`[${i}] connection ${e?"timed out":"failed"} (error; no more retries left)`,rF({retryOfRequestLogID:c,url:g,durationMs:n-k,message:m.message})),e)throw new qY;throw new qX({cause:m})}let o=[...m.headers.entries()].filter(([a])=>"x-request-id"===a).map(([a,b])=>", "+a+": "+JSON.stringify(b)).join(""),p=`[${i}${j}${o}] ${f.method} ${g} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${n-k}ms`;if(!m.ok){let a=await this.shouldRetry(m);if(b&&a){let a=`retrying, ${b} attempts remaining`;return await rj(m.body),rE(this).info(`${p} - ${a}`),rE(this).debug(`[${i}] response error (${a})`,rF({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,durationMs:n-k})),this.retryRequest(d,b,c??i,m.headers)}let e=a?"error; no more retries left":"error; not retryable";rE(this).info(`${p} - ${e}`);let f=await m.text().catch(a=>qT(a).message),g=(a=>{try{return JSON.parse(a)}catch(a){return}})(f),h=g?void 0:f;throw rE(this).debug(`[${i}] response error (${e})`,rF({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,message:h,durationMs:Date.now()-k})),this.makeStatusError(m.status,g,h,m.headers)}return rE(this).info(p),rE(this).debug(`[${i}] response start`,rF({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,durationMs:n-k})),{response:m,options:d,controller:l,requestLogID:i,retryOfRequestLogID:c,startTime:k}}getAPIList(a,b,c){return this.requestAPIList(b,{method:"get",path:a,...c})}requestAPIList(a,b){return new rO(this,this.makeRequest(b,null,void 0),a)}async fetchWithTimeout(a,b,c,d){let{signal:e,method:f,...g}=b||{};e&&e.addEventListener("abort",()=>d.abort());let h=setTimeout(()=>d.abort(),c),i=globalThis.ReadableStream&&g.body instanceof globalThis.ReadableStream||"object"==typeof g.body&&null!==g.body&&Symbol.asyncIterator in g.body,j={signal:d.signal,...i?{duplex:"half"}:{},method:"GET",...g};f&&(j.method=f.toUpperCase());try{return await this.fetch.call(void 0,a,j)}finally{clearTimeout(h)}}async shouldRetry(a){let b=a.headers.get("x-should-retry");return"true"===b||"false"!==b&&(408===a.status||409===a.status||429===a.status||!!(a.status>=500))}async retryRequest(a,b,c,d){let e,f=d?.get("retry-after-ms");if(f){let a=parseFloat(f);Number.isNaN(a)||(e=a)}let g=d?.get("retry-after");if(g&&!e){let a=parseFloat(g);e=Number.isNaN(a)?Date.parse(g)-Date.now():1e3*a}if(!(e&&0<=e&&e<6e4)){let c=a.maxRetries??this.maxRetries;e=this.calculateDefaultRetryTimeoutMillis(b,c)}return await rc(e),this.makeRequest(a,b-1,c)}calculateDefaultRetryTimeoutMillis(a,b){return Math.min(.5*Math.pow(2,b-a),8)*(1-.25*Math.random())*1e3}async buildRequest(a,{retryCount:b=0}={}){let c={...a},{method:d,path:e,query:f,defaultBaseURL:g}=c,h=this.buildURL(e,f,g);"timeout"in c&&((a,b)=>{if("number"!=typeof b||!Number.isInteger(b))throw new qU(`${a} must be an integer`);if(b<0)throw new qU(`${a} must be a positive integer`)})("timeout",c.timeout),c.timeout=c.timeout??this.timeout;let{bodyHeaders:i,body:j}=this.buildBody({options:c}),k=await this.buildHeaders({options:a,method:d,bodyHeaders:i,retryCount:b});return{req:{method:d,headers:k,...c.signal&&{signal:c.signal},...globalThis.ReadableStream&&j instanceof globalThis.ReadableStream&&{duplex:"half"},...j&&{body:j},...this.fetchOptions??{},...c.fetchOptions??{}},url:h,timeout:c.timeout}}async buildHeaders({options:a,method:b,bodyHeaders:c,retryCount:d}){let e={};this.idempotencyHeader&&"get"!==b&&(a.idempotencyKey||(a.idempotencyKey=this.defaultIdempotencyKey()),e[this.idempotencyHeader]=a.idempotencyKey);let f=su([e,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(d),...a.timeout?{"X-Stainless-Timeout":String(Math.trunc(a.timeout/1e3))}:{},...h??(h=(()=>{let a="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===a)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rd,"X-Stainless-OS":rf(Deno.build.os),"X-Stainless-Arch":re(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===a)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rd,"X-Stainless-OS":rf(globalThis.process.platform??"unknown"),"X-Stainless-Arch":re(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let b=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:a,pattern:b}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let c=b.exec(navigator.userAgent);if(c){let b=c[1]||0,d=c[2]||0,e=c[3]||0;return{browser:a,version:`${b}.${d}.${e}`}}}return null}();return b?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${b.browser}`,"X-Stainless-Runtime-Version":b.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(a),this._options.defaultHeaders,c,a.headers]);return this.validateHeaders(f),f.values}buildBody({options:{body:a,headers:b}}){if(!a)return{bodyHeaders:void 0,body:void 0};let c=su([b]);return ArrayBuffer.isView(a)||a instanceof ArrayBuffer||a instanceof DataView||"string"==typeof a&&c.values.has("content-type")||a instanceof Blob||a instanceof FormData||a instanceof URLSearchParams||globalThis.ReadableStream&&a instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:a}:"object"==typeof a&&(Symbol.asyncIterator in a||Symbol.iterator in a&&"next"in a&&"function"==typeof a.next)?{bodyHeaders:void 0,body:rh(a)}:qQ(this,cC,"f").call(this,{body:a,headers:c})}}function ti(a,b){let c;if(void 0===a.function)return;if(b?.partial)try{c=ew(a.function.arguments??"{}")}catch{return}else try{c=JSON.parse(a.function.arguments)}catch(b){throw new pL([`Function "${a.function.name}" arguments:`,"",a.function.arguments,"\nare not valid JSON.",`Error: ${b.message}`].join("\n"))}let d={name:a.function.name,args:c,type:"tool_call"};return b?.returnId&&(d.id=a.id),d}function tj(a){if(void 0===a.id)throw Error('All OpenAI tool calls must have an "id" field.');return{id:a.id,type:"function",function:{name:a.name,arguments:JSON.stringify(a.args)}}}function tk(a,b){return{name:a.function?.name,args:a.function?.arguments,id:a.id,error:b,type:"invalid_tool_call"}}cB=th,cC=new WeakMap,cA=new WeakSet,cD=function(){return"https://api.openai.com/v1"!==this.baseURL},th.OpenAI=cB,th.DEFAULT_TIMEOUT=6e5,th.OpenAIError=qU,th.APIError=qV,th.APIConnectionError=qX,th.APIConnectionTimeoutError=qY,th.APIUserAbortError=qW,th.NotFoundError=q0,th.ConflictError=q1,th.RateLimitError=q3,th.BadRequestError=qZ,th.AuthenticationError=q$,th.InternalServerError=q4,th.PermissionDeniedError=q_,th.UnprocessableEntityError=q2,th.InvalidWebhookSignatureError=q7,th.toFile=r0,th.Completions=sL,th.Chat=ss,th.Embeddings=sP,th.Files=sT,th.Images=s2,th.Audio=sy,th.Moderations=s4,th.Models=s3,th.FineTuning=s_,th.Graders=s1,th.VectorStores=tf,th.Webhooks=tg,th.Beta=sK,th.Batches=sz,th.Uploads=tb,th.Responses=s9,th.Evals=sS,th.Containers=sO;var tl=class extends pN{static lc_name(){return"JsonOutputToolsParser"}returnId=!1;lc_namespace=["langchain","output_parsers","openai_tools"];lc_serializable=!0;constructor(a){super(a),this.returnId=a?.returnId??this.returnId}_diff(){throw Error("Not supported.")}async parse(){throw Error("Not implemented.")}async parseResult(a){return await this.parsePartialResult(a,!1)}async parsePartialResult(a,b=!0){let c,d=a[0].message;if(eX(d)&&d.tool_calls?.length?c=d.tool_calls.map(a=>{let{id:b,...c}=a;return this.returnId?{id:b,...c}:c}):void 0!==d.additional_kwargs.tool_calls&&(c=JSON.parse(JSON.stringify(d.additional_kwargs.tool_calls)).map(a=>ti(a,{returnId:this.returnId,partial:b}))),!c)return[];let e=[];for(let a of c)if(void 0!==a){let b={type:a.name,args:a.args,id:a.id};e.push(b)}return e}},tm=class extends tl{static lc_name(){return"JsonOutputKeyToolsParser"}lc_namespace=["langchain","output_parsers","openai_tools"];lc_serializable=!0;returnId=!1;keyName;returnSingle=!1;zodSchema;constructor(a){super(a),this.keyName=a.keyName,this.returnSingle=a.returnSingle??this.returnSingle,this.zodSchema=a.zodSchema}async _validateResult(a){if(void 0===this.zodSchema)return a;let b=await mF(this.zodSchema,a);if(b.success)return b.data;throw new pL(`Failed to parse. Text: "${JSON.stringify(a,null,2)}". Error: ${JSON.stringify(b.error?.issues)}`,JSON.stringify(a,null,2))}async parsePartialResult(a){let b=(await super.parsePartialResult(a)).filter(a=>a.type===this.keyName),c=b;if(b.length)return(this.returnId||(c=b.map(a=>a.args)),this.returnSingle)?c[0]:c}async parseResult(a){let b=(await super.parsePartialResult(a,!1)).filter(a=>a.type===this.keyName),c=b;return b.length?(this.returnId||(c=b.map(a=>a.args)),this.returnSingle)?this._validateResult(c[0]):await Promise.all(c.map(a=>this._validateResult(a))):void 0}};dy({},{JsonOutputKeyToolsParser:()=>tm,JsonOutputToolsParser:()=>tl,convertLangChainToolCallToOpenAI:()=>tj,makeInvalidToolCall:()=>tk,parseToolCall:()=>ti});let tn=Symbol("Let zodToJsonSchema decide on which parser to use"),to={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},tp=a=>"_def"in a?a._def:a;function tq(a,b,c,d){d?.errorMessages&&c&&(a.errorMessage={...a.errorMessage,[b]:c})}function tr(a,b,c,d,e){a[b]=c,tq(a,b,d,e)}let ts=/^[cC][^\s-]{8,}$/,tt=/^[0-9a-z]+$/,tu=/^[0-9A-HJKMNP-TV-Z]{26}$/,tv=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,tw=()=>(void 0===l&&(l=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),l),tx=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ty=/^[a-zA-Z0-9_-]{21}$/;function tz(a,b){let c={type:"string"};function d(a){return"escape"===b.patternStrategy?tA(a):a}if(a.checks)for(let e of a.checks)switch(e.kind){case"min":tr(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,e.value):e.value,e.message,b);break;case"max":tr(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,e.value):e.value,e.message,b);break;case"email":switch(b.emailStrategy){case"format:email":tB(c,"email",e.message,b);break;case"format:idn-email":tB(c,"idn-email",e.message,b);break;case"pattern:zod":tC(c,tv,e.message,b)}break;case"url":tB(c,"uri",e.message,b);break;case"uuid":tB(c,"uuid",e.message,b);break;case"regex":tC(c,e.regex,e.message,b);break;case"cuid":tC(c,ts,e.message,b);break;case"cuid2":tC(c,tt,e.message,b);break;case"startsWith":tC(c,RegExp(`^${d(e.value)}`),e.message,b);break;case"endsWith":tC(c,RegExp(`${d(e.value)}$`),e.message,b);break;case"datetime":tB(c,"date-time",e.message,b);break;case"date":tB(c,"date",e.message,b);break;case"time":tB(c,"time",e.message,b);break;case"duration":tB(c,"duration",e.message,b);break;case"length":tr(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,e.value):e.value,e.message,b),tr(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,e.value):e.value,e.message,b);break;case"includes":tC(c,RegExp(d(e.value)),e.message,b);break;case"ip":"v6"!==e.version&&tB(c,"ipv4",e.message,b),"v4"!==e.version&&tB(c,"ipv6",e.message,b);break;case"emoji":tC(c,tw,e.message,b);break;case"ulid":tC(c,tu,e.message,b);break;case"base64":switch(b.base64Strategy){case"format:binary":tB(c,"binary",e.message,b);break;case"contentEncoding:base64":tr(c,"contentEncoding","base64",e.message,b);break;case"pattern:zod":tC(c,tx,e.message,b)}break;case"nanoid":tC(c,ty,e.message,b)}return c}let tA=a=>Array.from(a).map(a=>/[a-zA-Z0-9]/.test(a)?a:`\\${a}`).join(""),tB=(a,b,c,d)=>{a.format||a.anyOf?.some(a=>a.format)?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push({format:a.format,...a.errorMessage&&d.errorMessages&&{errorMessage:{format:a.errorMessage.format}}}),delete a.format,a.errorMessage&&(delete a.errorMessage.format,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.anyOf.push({format:b,...c&&d.errorMessages&&{errorMessage:{format:c}}})):tr(a,"format",b,c,d)},tC=(a,b,c,d)=>{a.pattern||a.allOf?.some(a=>a.pattern)?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push({pattern:a.pattern,...a.errorMessage&&d.errorMessages&&{errorMessage:{pattern:a.errorMessage.pattern}}}),delete a.pattern,a.errorMessage&&(delete a.errorMessage.pattern,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.allOf.push({pattern:tD(b,d),...c&&d.errorMessages&&{errorMessage:{pattern:c}}})):tr(a,"pattern",tD(b,d),c,d)},tD=(a,b)=>{let c="function"==typeof a?a():a;if(!b.applyRegexFlags||!c.flags)return c.source;let d={i:c.flags.includes("i"),m:c.flags.includes("m"),s:c.flags.includes("s")},e=d.i?c.source.toLowerCase():c.source,f="",g=!1,h=!1,i=!1;for(let a=0;a<e.length;a++){if(g){f+=e[a],g=!1;continue}if(d.i){if(h){if(e[a].match(/[a-z]/)){i?(f+=e[a],f+=`${e[a-2]}-${e[a]}`.toUpperCase(),i=!1):"-"===e[a+1]&&e[a+2]?.match(/[a-z]/)?(f+=e[a],i=!0):f+=`${e[a]}${e[a].toUpperCase()}`;continue}}else if(e[a].match(/[a-z]/)){f+=`[${e[a]}${e[a].toUpperCase()}]`;continue}}if(d.m){if("^"===e[a]){f+=`(^|(?<=[\r
]))`;continue}else if("$"===e[a]){f+=`($|(?=[\r
]))`;continue}}if(d.s&&"."===e[a]){f+=h?`${e[a]}\r
`:`[${e[a]}\r
]`;continue}f+=e[a],"\\"===e[a]?g=!0:h&&"]"===e[a]?h=!1:h||"["!==e[a]||(h=!0)}try{new RegExp(f)}catch{return console.warn(`Could not convert regex pattern at ${b.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),c.source}return f};function tE(a,b){if("openApi3"===b.target&&a.keyType?._def.typeName===m4.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:a.keyType._def.values,properties:a.keyType._def.values.reduce((c,d)=>({...c,[d]:tH(a.valueType._def,{...b,currentPath:[...b.currentPath,"properties",d]})??{}}),{}),additionalProperties:!1};let c={type:"object",additionalProperties:tH(a.valueType._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]})??{}};if("openApi3"===b.target)return c;if(a.keyType?._def.typeName===m4.ZodFirstPartyTypeKind.ZodString&&a.keyType._def.checks?.length){let d=Object.entries(tz(a.keyType._def,b)).reduce((a,[b,c])=>"type"===b?a:{...a,[b]:c},{});return{...c,propertyNames:d}}return a.keyType?._def.typeName===m4.ZodFirstPartyTypeKind.ZodEnum?{...c,propertyNames:{enum:a.keyType._def.values}}:c}let tF={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},tG=(a,b)=>{let c=(a.options instanceof Map?Array.from(a.options.values()):a.options).map((a,c)=>tH(a._def,{...b,currentPath:[...b.currentPath,"anyOf",`${c}`]})).filter(a=>!!a&&(!b.strictUnions||"object"==typeof a&&Object.keys(a).length>0));return c.length?{anyOf:c}:void 0};function tH(a,b,c=!1){let d=b.seen.get(a);if(b.override){let e=b.override?.(a,b,d,c);if(e!==tn)return e}if(d&&!c){let a=tI(d,b);if(void 0!==a)return"$ref"in a&&b.seenRefs.add(a.$ref),a}let e={def:a,path:b.currentPath,jsonSchema:void 0};b.seen.set(a,e);let f=tK(a,a.typeName,b,c);return f&&tL(a,b,f),e.jsonSchema=f,f}let tI=(a,b)=>{switch(b.$refStrategy){case"root":return{$ref:a.path.join("/")};case"extract-to-root":let c=a.path.slice(b.basePath.length+1).join("_");return c!==b.name&&"duplicate-ref"===b.nameStrategy&&(b.definitions[c]=a.def),{$ref:[...b.basePath,b.definitionPath,c].join("/")};case"relative":return{$ref:tJ(b.currentPath,a.path)};case"none":case"seen":if(a.path.length<b.currentPath.length&&a.path.every((a,c)=>b.currentPath[c]===a))return console.warn(`Recursive reference detected at ${b.currentPath.join("/")}! Defaulting to any`),{};return"seen"===b.$refStrategy?{}:void 0}},tJ=(a,b)=>{let c=0;for(;c<a.length&&c<b.length&&a[c]===b[c];c++);return[(a.length-c).toString(),...b.slice(c)].join("/")},tK=(a,b,c,d)=>{switch(b){case m4.ZodFirstPartyTypeKind.ZodString:return tz(a,c);case m4.ZodFirstPartyTypeKind.ZodNumber:let e={type:"number"};if(!a.checks)return e;for(let b of a.checks)switch(b.kind){case"int":e.type="integer",tq(e,"type",b.message,c);break;case"min":"jsonSchema7"===c.target?b.inclusive?tr(e,"minimum",b.value,b.message,c):tr(e,"exclusiveMinimum",b.value,b.message,c):(b.inclusive||(e.exclusiveMinimum=!0),tr(e,"minimum",b.value,b.message,c));break;case"max":"jsonSchema7"===c.target?b.inclusive?tr(e,"maximum",b.value,b.message,c):tr(e,"exclusiveMaximum",b.value,b.message,c):(b.inclusive||(e.exclusiveMaximum=!0),tr(e,"maximum",b.value,b.message,c));break;case"multipleOf":tr(e,"multipleOf",b.value,b.message,c)}return e;case m4.ZodFirstPartyTypeKind.ZodObject:let f;return(f={type:"object",...Object.entries(a.shape()).reduce((a,[b,d])=>{if(void 0===d||void 0===d._def)return a;let e=[...c.currentPath,"properties",b],f=tH(d._def,{...c,currentPath:e,propertyPath:e});if(void 0===f)return a;if(c.openaiStrictMode&&d.isOptional()&&!d.isNullable()&&void 0===d._def?.defaultValue)throw Error(`Zod field at \`${e.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...a.properties,[b]:f},required:d.isOptional()&&!c.openaiStrictMode?a.required:[...a.required,b]}},{properties:{},required:[]}),additionalProperties:"strict"===c.removeAdditionalStrategy?"ZodNever"===a.catchall._def.typeName?"strict"!==a.unknownKeys:tH(a.catchall._def,{...c,currentPath:[...c.currentPath,"additionalProperties"]})??!0:"ZodNever"===a.catchall._def.typeName?"passthrough"===a.unknownKeys:tH(a.catchall._def,{...c,currentPath:[...c.currentPath,"additionalProperties"]})??!0}).required.length||delete f.required,f;case m4.ZodFirstPartyTypeKind.ZodBigInt:let g={type:"integer",format:"int64"};if(!a.checks)return g;for(let b of a.checks)switch(b.kind){case"min":"jsonSchema7"===c.target?b.inclusive?tr(g,"minimum",b.value,b.message,c):tr(g,"exclusiveMinimum",b.value,b.message,c):(b.inclusive||(g.exclusiveMinimum=!0),tr(g,"minimum",b.value,b.message,c));break;case"max":"jsonSchema7"===c.target?b.inclusive?tr(g,"maximum",b.value,b.message,c):tr(g,"exclusiveMaximum",b.value,b.message,c):(b.inclusive||(g.exclusiveMaximum=!0),tr(g,"maximum",b.value,b.message,c));break;case"multipleOf":tr(g,"multipleOf",b.value,b.message,c)}return g;case m4.ZodFirstPartyTypeKind.ZodBoolean:return{type:"boolean"};case m4.ZodFirstPartyTypeKind.ZodDate:return function a(b,c,d){let e=d??c.dateStrategy;if(Array.isArray(e))return{anyOf:e.map((d,e)=>a(b,c,d))};switch(e){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var f=b,g=c;let h={type:"integer",format:"unix-time"};if("openApi3"===g.target)return h;for(let a of f.checks)switch(a.kind){case"min":tr(h,"minimum",a.value,a.message,g);break;case"max":tr(h,"maximum",a.value,a.message,g)}return h}}(a,c);case m4.ZodFirstPartyTypeKind.ZodUndefined:return{not:{}};case m4.ZodFirstPartyTypeKind.ZodNull:return"openApi3"===c.target?{enum:["null"],nullable:!0}:{type:"null"};case m4.ZodFirstPartyTypeKind.ZodArray:let h;return h={type:"array"},a.type?._def?.typeName!==m4.ZodFirstPartyTypeKind.ZodAny&&(h.items=tH(a.type._def,{...c,currentPath:[...c.currentPath,"items"]})),a.minLength&&tr(h,"minItems",a.minLength.value,a.minLength.message,c),a.maxLength&&tr(h,"maxItems",a.maxLength.value,a.maxLength.message,c),a.exactLength&&(tr(h,"minItems",a.exactLength.value,a.exactLength.message,c),tr(h,"maxItems",a.exactLength.value,a.exactLength.message,c)),h;case m4.ZodFirstPartyTypeKind.ZodUnion:case m4.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:if("openApi3"===c.target)return tG(a,c);let i=a.options instanceof Map?Array.from(a.options.values()):a.options;if(i.every(a=>a._def.typeName in tF&&(!a._def.checks||!a._def.checks.length))){let a=i.reduce((a,b)=>{let c=tF[b._def.typeName];return c&&!a.includes(c)?[...a,c]:a},[]);return{type:a.length>1?a:a[0]}}if(i.every(a=>"ZodLiteral"===a._def.typeName&&!a.description)){let a=i.reduce((a,b)=>{let c=typeof b._def.value;switch(c){case"string":case"number":case"boolean":return[...a,c];case"bigint":return[...a,"integer"];case"object":if(null===b._def.value)return[...a,"null"];default:return a}},[]);if(a.length===i.length){let b=a.filter((a,b,c)=>c.indexOf(a)===b);return{type:b.length>1?b:b[0],enum:i.reduce((a,b)=>a.includes(b._def.value)?a:[...a,b._def.value],[])}}}else if(i.every(a=>"ZodEnum"===a._def.typeName))return{type:"string",enum:i.reduce((a,b)=>[...a,...b._def.values.filter(b=>!a.includes(b))],[])};return tG(a,c);case m4.ZodFirstPartyTypeKind.ZodIntersection:let j,k,l;return j=[tH(a.left._def,{...c,currentPath:[...c.currentPath,"allOf","0"]}),tH(a.right._def,{...c,currentPath:[...c.currentPath,"allOf","1"]})].filter(a=>!!a),k="jsonSchema2019-09"===c.target?{unevaluatedProperties:!1}:void 0,l=[],j.forEach(a=>{if((!("type"in a)||"string"!==a.type)&&"allOf"in a)l.push(...a.allOf),void 0===a.unevaluatedProperties&&(k=void 0);else{let b=a;if("additionalProperties"in a&&!1===a.additionalProperties){let{additionalProperties:c,...d}=a;b=d}else k=void 0;l.push(b)}}),l.length?{allOf:l,...k}:void 0;case m4.ZodFirstPartyTypeKind.ZodTuple:return a.rest?{type:"array",minItems:a.items.length,items:a.items.map((a,b)=>tH(a._def,{...c,currentPath:[...c.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[]),additionalItems:tH(a.rest._def,{...c,currentPath:[...c.currentPath,"additionalItems"]})}:{type:"array",minItems:a.items.length,maxItems:a.items.length,items:a.items.map((a,b)=>tH(a._def,{...c,currentPath:[...c.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[])};case m4.ZodFirstPartyTypeKind.ZodRecord:return tE(a,c);case m4.ZodFirstPartyTypeKind.ZodLiteral:let m;return"bigint"!=(m=typeof a.value)&&"number"!==m&&"boolean"!==m&&"string"!==m?{type:Array.isArray(a.value)?"array":"object"}:"openApi3"===c.target?{type:"bigint"===m?"integer":m,enum:[a.value]}:{type:"bigint"===m?"integer":m,const:a.value};case m4.ZodFirstPartyTypeKind.ZodEnum:return{type:"string",enum:[...a.values]};case m4.ZodFirstPartyTypeKind.ZodNativeEnum:let n,o,p;return n=a.values,{type:1===(p=Array.from(new Set((o=Object.keys(a.values).filter(a=>"number"!=typeof n[n[a]]).map(a=>n[a])).map(a=>typeof a)))).length?"string"===p[0]?"string":"number":["string","number"],enum:o};case m4.ZodFirstPartyTypeKind.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(a.innerType._def.typeName)&&(!a.innerType._def.checks||!a.innerType._def.checks.length))return"openApi3"===c.target||"property"===c.nullableStrategy?{type:tF[a.innerType._def.typeName],nullable:!0}:{type:[tF[a.innerType._def.typeName],"null"]};if("openApi3"===c.target){let b=tH(a.innerType._def,{...c,currentPath:[...c.currentPath]});return b&&"$ref"in b?{allOf:[b],nullable:!0}:b&&{...b,nullable:!0}}let q=tH(a.innerType._def,{...c,currentPath:[...c.currentPath,"anyOf","0"]});return q&&{anyOf:[q,{type:"null"}]};case m4.ZodFirstPartyTypeKind.ZodOptional:if(c.propertyPath&&c.currentPath.slice(0,c.propertyPath.length).toString()===c.propertyPath.toString())return tH(a.innerType._def,{...c,currentPath:c.currentPath});let r=tH(a.innerType._def,{...c,currentPath:[...c.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{};case m4.ZodFirstPartyTypeKind.ZodMap:if("record"===c.mapStrategy)return tE(a,c);return{type:"array",maxItems:125,items:{type:"array",items:[tH(a.keyType._def,{...c,currentPath:[...c.currentPath,"items","items","0"]})||{},tH(a.valueType._def,{...c,currentPath:[...c.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case m4.ZodFirstPartyTypeKind.ZodSet:let s;return s={type:"array",uniqueItems:!0,items:tH(a.valueType._def,{...c,currentPath:[...c.currentPath,"items"]})},a.minSize&&tr(s,"minItems",a.minSize.value,a.minSize.message,c),a.maxSize&&tr(s,"maxItems",a.maxSize.value,a.maxSize.message,c),s;case m4.ZodFirstPartyTypeKind.ZodLazy:return tH(a.getter()._def,c);case m4.ZodFirstPartyTypeKind.ZodPromise:return tH(a.type._def,c);case m4.ZodFirstPartyTypeKind.ZodNaN:case m4.ZodFirstPartyTypeKind.ZodNever:return{not:{}};case m4.ZodFirstPartyTypeKind.ZodEffects:return"input"===c.effectStrategy?tH(a.schema._def,c,d):{};case m4.ZodFirstPartyTypeKind.ZodAny:case m4.ZodFirstPartyTypeKind.ZodUnknown:return{};case m4.ZodFirstPartyTypeKind.ZodDefault:return{...tH(a.innerType._def,c),default:a.defaultValue()};case m4.ZodFirstPartyTypeKind.ZodBranded:return tH(a.type._def,c);case m4.ZodFirstPartyTypeKind.ZodReadonly:case m4.ZodFirstPartyTypeKind.ZodCatch:return tH(a.innerType._def,c);case m4.ZodFirstPartyTypeKind.ZodPipeline:if("input"===c.pipeStrategy)return tH(a.in._def,c);if("output"===c.pipeStrategy)return tH(a.out._def,c);let t=tH(a.in._def,{...c,currentPath:[...c.currentPath,"allOf","0"]}),u=tH(a.out._def,{...c,currentPath:[...c.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,u].filter(a=>void 0!==a)};case m4.ZodFirstPartyTypeKind.ZodFunction:case m4.ZodFirstPartyTypeKind.ZodVoid:case m4.ZodFirstPartyTypeKind.ZodSymbol:default:return}},tL=(a,b,c)=>(a.description&&(c.description=a.description,b.markdownDescription&&(c.markdownDescription=a.description)),c);function tM(a,b){return a.lc_error_code=b,a.message=`${a.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${b}/
`,a}function tN(a){let b;return a.constructor.name===qY.name?(b=Error(a.message)).name="TimeoutError":a.constructor.name===qW.name?(b=Error(a.message)).name="AbortError":b=400===a.status&&a.message.includes("tool_calls")?tM(a,"INVALID_TOOL_RESULTS"):401===a.status?tM(a,"MODEL_AUTHENTICATION"):429===a.status?tM(a,"MODEL_RATE_LIMIT"):404===a.status?tM(a,"MODEL_NOT_FOUND"):a,b}function tO(a){if(a){if("any"===a||"required"===a)return"required";if("auto"===a)return"auto";if("none"===a)return"none";else if("string"==typeof a)return{type:"function",function:{name:a}};else return a}}function tP(a,b){let c=[];for(let[d,e]of Object.entries(a.properties??{}))e.description&&b<2&&c.push(`// ${e.description}`),a.required?.includes(d)?c.push(`${d}: ${tQ(e,b)},`):c.push(`${d}?: ${tQ(e,b)},`);return c.map(a=>" ".repeat(b)+a).join("\n")}function tQ(a,b){if(void 0!==a.anyOf&&Array.isArray(a.anyOf))return a.anyOf.map(a=>tQ(a,b)).join(" | ");switch(a.type){case"string":if(a.enum)return a.enum.map(a=>`"${a}"`).join(" | ");return"string";case"number":if(a.enum)return a.enum.map(a=>`${a}`).join(" | ");return"number";case"integer":if(a.enum)return a.enum.map(a=>`${a}`).join(" | ");return"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",tP(a,b+2),"}"].join("\n");case"array":if(a.items)return`${tQ(a.items,b)}[]`;return"any[]";default:return""}}function tR(a){return"type"in a&&"function"!==a.type&&"custom"!==a.type}function tS(a){return"type"in a&&"custom"===a.type&&"custom"in a&&"object"==typeof a.custom&&null!==a.custom}let tT="__openai_function_call_ids__";function tU(a){return!!a&&!!(/^o\d/.test(a??"")||a.startsWith("gpt-5")&&!a.startsWith("gpt-5-chat"))}function tV(a){let b=a._getType();switch(b){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!ex.isInstance(a))throw Error("Invalid generic chat message");return"system"!==a.role&&"developer"!==a.role&&"assistant"!==a.role&&"user"!==a.role&&"function"!==a.role&&"tool"!==a.role&&console.warn(`Unknown message role: ${a.role}`),a.role;default:throw Error(`Unknown message type: ${b}`)}}let tW={providerName:"ChatOpenAI",fromStandardTextBlock:a=>({type:"text",text:a.text}),fromStandardImageBlock(a){if("url"===a.source_type)return{type:"image_url",image_url:{url:a.url,...a.metadata?.detail?{detail:a.metadata.detail}:{}}};if("base64"===a.source_type)return{type:"image_url",image_url:{url:`data:${a.mime_type??""};base64,${a.data}`,...a.metadata?.detail?{detail:a.metadata.detail}:{}}};throw Error(`Image content blocks with source_type ${a.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(a){if("url"===a.source_type){let b,c=dO({dataUrl:a.url});if(!c)throw Error(`URL audio blocks with source_type ${a.source_type} must be formatted as a data URL for ChatOpenAI`);let d=c.mime_type||a.mime_type||"";try{b=dN(d)}catch{throw Error(`Audio blocks with source_type ${a.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==b.type||"wav"!==b.subtype&&"mp3"!==b.subtype)throw Error(`Audio blocks with source_type ${a.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:b.subtype,data:c.data}}}if("base64"===a.source_type){let b;try{b=dN(a.mime_type??"")}catch{throw Error(`Audio blocks with source_type ${a.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==b.type||"wav"!==b.subtype&&"mp3"!==b.subtype)throw Error(`Audio blocks with source_type ${a.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:b.subtype,data:a.data}}}throw Error(`Audio content blocks with source_type ${a.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(a){if("url"===a.source_type){if(!dO({dataUrl:a.url}))throw Error(`URL file blocks with source_type ${a.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:a.url,...a.metadata?.filename||a.metadata?.name?{filename:a.metadata?.filename||a.metadata?.name}:{}}}}if("base64"===a.source_type)return{type:"file",file:{file_data:`data:${a.mime_type??""};base64,${a.data}`,...a.metadata?.filename||a.metadata?.name||a.metadata?.title?{filename:a.metadata?.filename||a.metadata?.name||a.metadata?.title}:{}}};if("id"===a.source_type)return{type:"file",file:{file_id:a.id}};throw Error(`File content blocks with source_type ${a.source_type} are not supported for ChatOpenAI`)}};function tX(a,b){return a.flatMap(a=>{let c=tV(a);"system"===c&&tU(b)&&(c="developer");let d={role:c,content:"string"==typeof a.content?a.content:a.content.map(a=>dH(a)?dP(a,tW):a)};return(null!=a.name&&(d.name=a.name),null!=a.additional_kwargs.function_call&&(d.function_call=a.additional_kwargs.function_call,d.content=""),eX(a)&&a.tool_calls?.length?(d.tool_calls=a.tool_calls.map(tj),d.content=""):(null!=a.additional_kwargs.tool_calls&&(d.tool_calls=a.additional_kwargs.tool_calls),null!=a.tool_call_id&&(d.tool_call_id=a.tool_call_id)),a.additional_kwargs.audio&&"object"==typeof a.additional_kwargs.audio&&"id"in a.additional_kwargs.audio)?[d,{role:"assistant",audio:{id:a.additional_kwargs.audio.id}}]:d})}class tY extends pE{_llmType(){return"openai"}static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning","reasoningEffort","service_tier"]}get lc_secrets(){return{apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{apiKey:"openai_api_key",modelName:"model",reasoningEffort:"reasoning_effort"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","model","modelName","modelKwargs","stop","stopSequences","timeout","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","zdrEnabled","reasoning","reasoningEffort","promptCacheKey","verbosity"]}getLsParams(a){let b=this.invocationParams(a);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:b.temperature??void 0,ls_max_tokens:b.max_tokens??void 0,ls_stop:a.stop}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}constructor(a){super(a??{}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zdrEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"service_tier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"promptCacheKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbosity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.apiKey=a?.apiKey??a?.configuration?.apiKey??dG("OPENAI_API_KEY"),this.organization=a?.configuration?.organization??dG("OPENAI_ORGANIZATION"),this.model=a?.model??a?.modelName??this.model,this.modelKwargs=a?.modelKwargs??{},this.timeout=a?.timeout,this.temperature=a?.temperature??this.temperature,this.topP=a?.topP??this.topP,this.frequencyPenalty=a?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=a?.presencePenalty??this.presencePenalty,this.logprobs=a?.logprobs,this.topLogprobs=a?.topLogprobs,this.n=a?.n??this.n,this.logitBias=a?.logitBias,this.stop=a?.stopSequences??a?.stop,this.stopSequences=this.stop,this.user=a?.user,this.__includeRawResponse=a?.__includeRawResponse,this.audio=a?.audio,this.modalities=a?.modalities,this.reasoning=a?.reasoning??a?.reasoningEffort?{effort:a.reasoningEffort}:void 0,this.maxTokens=a?.maxCompletionTokens??a?.maxTokens,this.disableStreaming=a?.disableStreaming===!0,this.streaming=a?.streaming===!0,this.promptCacheKey=a?.promptCacheKey??this.promptCacheKey,this.verbosity=a?.verbosity??this.verbosity,a?.streaming===!1&&(this.disableStreaming=!0),!0===this.disableStreaming&&(this.streaming=!1),this.streamUsage=a?.streamUsage??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...a?.configuration},a?.supportsStrictToolCalling!==void 0&&(this.supportsStrictToolCalling=a.supportsStrictToolCalling),a?.service_tier!==void 0&&(this.service_tier=a.service_tier),this.zdrEnabled=a?.zdrEnabled??!1}_getReasoningParams(a){let b;if(tU(this.model))return void 0!==this.reasoning&&(b={...b,...this.reasoning}),a?.reasoning!==void 0&&(b={...b,...a.reasoning}),b}_getResponseFormat(a){return a&&"json_schema"===a.type&&a.json_schema.schema&&mB(a.json_schema.schema)?function(a,b,c){if(mz(a)){var d,e,f,g;let h;return f={type:"json_schema",json_schema:{...c,name:b,strict:!0,schema:((a,b)=>{let c,d,e=(d=void 0!==(c="string"==typeof b?{...to,basePath:["#"],definitions:{},name:b}:{...to,basePath:["#"],definitions:{},...b}).name?[...c.basePath,c.definitionPath,c.name]:c.basePath,{...c,currentPath:d,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(c.definitions).map(([a,b])=>[tp(b),{def:tp(b),path:[...c.basePath,c.definitionPath,a],jsonSchema:void 0}]))}),f="string"==typeof b?b:b?.nameStrategy==="title"?void 0:b?.name,g=tH(a._def,void 0===f?e:{...e,currentPath:[...e.basePath,e.definitionPath,f]},!1)??{},h="object"==typeof b&&void 0!==b.name&&"title"===b.nameStrategy?b.name:void 0;void 0!==h&&(g.title=h);let i=(()=>{if(function(a){if(!a)return!0;for(let b in a)return!1;return!0}(e.definitions))return;let a={},b=new Set;for(let c=0;c<500;c++){let c=Object.entries(e.definitions).filter(([a])=>!b.has(a));if(0===c.length)break;for(let[d,f]of c)a[d]=tH(tp(f),{...e,currentPath:[...e.basePath,e.definitionPath,d]},!0)??{},b.add(d)}return a})(),j=void 0===f?i?{...g,[e.definitionPath]:i}:g:"duplicate-ref"===e.nameStrategy?{...g,...i||e.seenRefs.size?{[e.definitionPath]:{...i,...e.seenRefs.size?{[f]:g}:void 0}}:void 0}:{$ref:[..."relative"===e.$refStrategy?[]:e.basePath,e.definitionPath,f].join("/"),[e.definitionPath]:{...i,[f]:g}};return"jsonSchema7"===e.target?j.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===e.target&&(j.$schema="https://json-schema.org/draft/2019-09/schema#"),j})(a,{openaiStrictMode:!0,name:{name:b}.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}},g=b=>a.parse(JSON.parse(b)),Object.defineProperties(h={...f},{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:g,enumerable:!1}}),h}if(my(a)){let f;return d={type:"json_schema",json_schema:{...c,name:b,strict:!0,schema:mw(a,{cycles:"ref",reused:"ref",override(a){a.jsonSchema.title=b}})}},e=b=>ih(a,JSON.parse(b)),Object.defineProperties(f={...d},{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),f}throw Error("Unsupported schema response format")}(a.json_schema.schema,a.json_schema.name,{description:a.json_schema.description}):a}_combineCallOptions(a){return{...this.defaultOptions,...a??{}}}_getClientOptions(a){if(!this.client){let a=function(a){let{azureOpenAIApiDeploymentName:b,azureOpenAIApiInstanceName:c,azureOpenAIApiKey:d,azureOpenAIBasePath:e,baseURL:f,azureADTokenProvider:g,azureOpenAIEndpoint:h}=a;if((d||g)&&e&&b)return`${e}/${b}`;if((d||g)&&h&&b)return`${h}/openai/deployments/${b}`;if(d||g){if(!c)throw Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!b)throw Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${c}.openai.azure.com/openai/deployments/${b}`}return f}({baseURL:this.clientConfig.baseURL}),b={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};b.baseURL||delete b.baseURL,this.client=new th(b)}return{...this.clientConfig,...a}}_convertChatOpenAIToolToCompletionsTool(a,b){var c;let d;return"object"==typeof a&&null!==a&&"metadata"in a&&"object"==typeof a.metadata&&null!==a.metadata&&"customTool"in a.metadata&&"object"==typeof a.metadata.customTool&&null!==a.metadata.customTool?{type:"custom",custom:{name:(c=a.metadata.customTool).name,description:c.description,format:(()=>{if(c.format){if("grammar"===c.format.type)return{type:"grammar",grammar:{definition:c.format.definition,syntax:c.format.syntax}};if("text"===c.format.type)return{type:"text"}}})()}}:px(a)?b?.strict!==void 0?{...a,function:{...a.function,strict:b.strict}}:a:("function"===(d=qA(a)?qC(a):a).type&&b?.strict!==void 0&&(d.function.strict=b.strict),d)}bindTools(a,b){let c;return b?.strict!==void 0?c=b.strict:void 0!==this.supportsStrictToolCalling&&(c=this.supportsStrictToolCalling),this.withConfig({tools:a.map(a=>tR(a)?a:this._convertChatOpenAIToolToCompletionsTool(a,{strict:c})),...b})}async stream(a,b){return super.stream(a,this._combineCallOptions(b))}async invoke(a,b){return super.invoke(a,this._combineCallOptions(b))}_combineLLMOutput(...a){return a.reduce((a,b)=>(b&&b.tokenUsage&&(a.tokenUsage.completionTokens+=b.tokenUsage.completionTokens??0,a.tokenUsage.promptTokens+=b.tokenUsage.promptTokens??0,a.tokenUsage.totalTokens+=b.tokenUsage.totalTokens??0),a),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}async getNumTokensFromMessages(a){let b=0,c=0,d=0;"gpt-3.5-turbo-0301"===this.model?(c=4,d=-1):(c=3,d=1);let e=await Promise.all(a.map(async a=>{let e=await this.getNumTokens(a.content),f=await this.getNumTokens(tV(a)),g=void 0!==a.name?d+await this.getNumTokens(a.name):0,h=e+c+f+g;if("function"===a._getType()&&(h-=2),a.additional_kwargs?.function_call&&(h+=3),a?.additional_kwargs.function_call?.name&&(h+=await this.getNumTokens(a.additional_kwargs.function_call?.name)),a.additional_kwargs.function_call?.arguments)try{h+=await this.getNumTokens(JSON.stringify(JSON.parse(a.additional_kwargs.function_call?.arguments)))}catch(b){console.error("Error parsing function arguments",b,JSON.stringify(a.additional_kwargs.function_call)),h+=await this.getNumTokens(a.additional_kwargs.function_call?.arguments)}return b+=h,h}));return{totalCount:b+=3,countPerMessage:e}}async _getNumTokensFromGenerations(a){return(await Promise.all(a.map(async a=>a.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([a.message])).countPerMessage[0]:await this.getNumTokens(a.message.content)))).reduce((a,b)=>a+b,0)}async _getEstimatedTokenCountFromPrompt(a,b,c){let d=(await this.getNumTokensFromMessages(a)).totalCount;if(b&&"auto"!==c){let a=function(a){let b=["namespace functions {",""];for(let c of a)c.description&&b.push(`// ${c.description}`),Object.keys(c.parameters.properties??{}).length>0?(b.push(`type ${c.name} = (_: {`),b.push(tP(c.parameters,0)),b.push("}) => any;")):b.push(`type ${c.name} = () => any;`),b.push("");return b.push("} // namespace functions"),b.join("\n")}(b);d+=await this.getNumTokens(a),d+=9}return b&&a.find(a=>"system"===a._getType())&&(d-=4),"none"===c?d+=1:"object"==typeof c&&(d+=await this.getNumTokens(c.name)+4),d}_getStructuredOutputMethod(a){let b={...a};if(this.model.startsWith("gpt-3")||this.model.startsWith("gpt-4-")||"gpt-4"===this.model)"jsonSchema"===b.method&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`);else if(b?.method===void 0)return"jsonSchema";return b.method}withStructuredOutput(a,b){let c,d,e,f,g,h;if(void 0!==a&&"object"==typeof a.schema?(c=a.schema,d=a.name,e=a.method,f=a.includeRaw):(c=a,d=b?.name,e=b?.method,f=b?.includeRaw),b?.strict!==void 0&&"jsonMode"===e)throw Error("Argument `strict` is only supported for `method` = 'function_calling'");if("jsonMode"===(e=this._getStructuredOutputMethod({...b,method:e}))){h=mB(c)?pW.fromZodSchema(c):new pO;let a=nN(c);g=this.withConfig({response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"json_mode"},schema:{title:d??"extract",...a}}})}else if("jsonSchema"===e){let a={name:d??"extract",description:mJ(c),schema:c,strict:b?.strict},e=nN(a.schema);if(g=this.withConfig({response_format:{type:"json_schema",json_schema:a},ls_structured_output_format:{kwargs:{method:"json_schema"},schema:{title:a.name,description:a.description,...e}}}),mB(c)){let a=pW.fromZodSchema(c);h=oO.from(b=>"parsed"in b.additional_kwargs?b.additional_kwargs.parsed:a)}else h=new pO}else{let a=d??"extract";if(mB(c)){let d=nN(c);g=this.withConfig({tools:[{type:"function",function:{name:a,description:d.description,parameters:d}}],tool_choice:{type:"function",function:{name:a}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:a,...d}},...b?.strict!==void 0?{strict:b.strict}:{}}),h=new tm({returnSingle:!0,keyName:a,zodSchema:c})}else{let d;"string"==typeof c.name&&"object"==typeof c.parameters&&null!=c.parameters?(d=c,a=c.name):d={name:a=c.title??a,description:c.description??"",parameters:c};let e=nN(c);g=this.withConfig({tools:[{type:"function",function:d}],tool_choice:{type:"function",function:{name:a}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:a,...e}},...b?.strict!==void 0?{strict:b.strict}:{}}),h=new tm({returnSingle:!0,keyName:a})}}if(!f)return g.pipe(h);let i=pB.assign({parsed:(a,b)=>h.invoke(a.raw,b)}),j=pB.assign({parsed:()=>null}),k=i.withFallbacks({fallbacks:[j]});return oL.from([{raw:g},k])}}class tZ extends tY{invocationParams(a){var b;let c;a?.strict!==void 0?c=a.strict:void 0!==this.supportsStrictToolCalling&&(c=this.supportsStrictToolCalling);let d={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:a?.previous_response_id,truncation:a?.truncation,include:a?.include,tools:a?.tools?.length?this._reduceChatOpenAITools(a.tools,{stream:this.streaming,strict:c}):void 0,tool_choice:null!=(b=a?.tool_choice)&&"object"==typeof b&&"type"in b&&"function"!==b.type?a?.tool_choice:(()=>{let b=tO(a?.tool_choice);if("object"==typeof b&&"type"in b){if("function"===b.type)return{type:"function",name:b.function.name};else if("allowed_tools"===b.type)return{type:"allowed_tools",mode:b.allowed_tools.mode,tools:b.allowed_tools.tools};else if("custom"===b.type)return{type:"custom",name:b.custom.name}}})(),text:(()=>{if(a?.text)return a.text;let b=this._getResponseFormat(a?.response_format);return b?.type==="json_schema"?null!=b.json_schema.schema?{format:{type:"json_schema",schema:b.json_schema.schema,description:b.json_schema.description,name:b.json_schema.name,strict:b.json_schema.strict},verbosity:a?.verbosity}:void 0:{format:b,verbosity:a?.verbosity}})(),parallel_tool_calls:a?.parallel_tool_calls,max_output_tokens:-1===this.maxTokens?void 0:this.maxTokens,prompt_cache_key:a?.promptCacheKey??this.promptCacheKey,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},e=this._getReasoningParams(a);return void 0!==e&&(d.reasoning=e),d}async _generate(a,b){let c=this.invocationParams(b);if(c.stream){let c;for await(let d of this._streamResponseChunks(a,b))d.message.response_metadata={...d.generationInfo,...d.message.response_metadata},c=c?.concat(d)??d;return{generations:c?[c]:[],llmOutput:{estimatedTokenUsage:c?.message?.usage_metadata}}}{let d=this._convertMessagesToResponsesParams(a),e=await this.completionWithRetry({input:d,...c,stream:!1},{signal:b?.signal,...b?.options});return{generations:[{text:e.output_text,message:this._convertResponsesMessageToBaseMessage(e)}],llmOutput:{id:e.id,estimatedTokenUsage:e.usage?{promptTokens:e.usage.input_tokens,completionTokens:e.usage.output_tokens,totalTokens:e.usage.total_tokens}:void 0}}}}async *_streamResponseChunks(a,b,c){for await(let d of(await this.completionWithRetry({...this.invocationParams(b),input:this._convertMessagesToResponsesParams(a),stream:!0},b))){let a=this._convertResponsesDeltaToBaseMessageChunk(d);null!=a&&(yield a,await c?.handleLLMNewToken(a.text||"",{prompt:b.promptIndex??0,completion:0},void 0,void 0,void 0,{chunk:a}))}}async completionWithRetry(a,b){return this.caller.call(async()=>{let c=this._getClientOptions(b);try{if(a.text?.format?.type==="json_schema"&&!a.stream)return await this.client.responses.parse(a,c);return await this.client.responses.create(a,c)}catch(a){throw tN(a)}})}_convertResponsesMessageToBaseMessage(a){let b;if(a.error){let b=Error(a.error.message);throw b.name=a.error.code,b}let c=[],d=[],e=[],f={model:a.model,created_at:a.created_at,id:a.id,incomplete_details:a.incomplete_details,metadata:a.metadata,object:a.object,status:a.status,user:a.user,service_tier:a.service_tier,model_name:a.model},g={};for(let f of a.output)if("message"===f.type)b=f.id,c.push(...f.content.flatMap(a=>"output_text"===a.type?("parsed"in a&&null!=a.parsed&&(g.parsed=a.parsed),{type:"text",text:a.text,annotations:a.annotations}):"refusal"===a.type?(g.refusal=a.refusal,[]):a));else if("function_call"===f.type){let a={function:{name:f.name,arguments:f.arguments},id:f.call_id};try{d.push(ti(a,{returnId:!0}))}catch(c){let b;"object"==typeof c&&null!=c&&"message"in c&&"string"==typeof c.message&&(b=c.message),e.push(tk(a,b))}g[tT]??={},f.id&&(g[tT][f.call_id]=f.id)}else if("reasoning"===f.type)g.reasoning=f;else if("custom_tool_call"===f.type){let a=function(a){if("custom_tool_call"===a.type)return{...a,type:"tool_call",call_id:a.id,id:a.call_id,name:a.name,isCustomTool:!0,args:{input:a.input}}}(f);a?d.push(a):e.push(tk(f,"Malformed custom tool call"))}else g.tool_outputs??=[],g.tool_outputs.push(f);return new eW({id:b,content:c,tool_calls:d,invalid_tool_calls:e,usage_metadata:a.usage,additional_kwargs:g,response_metadata:f})}_convertResponsesDeltaToBaseMessageChunk(a){let b,c,d=[],e={},f=[],g={},h={};if("response.output_text.delta"===a.type)d.push({type:"text",text:a.delta,index:a.content_index});else if("response.output_text.annotation.added"===a.type)d.push({type:"text",text:"",annotations:[a.annotation],index:a.content_index});else if("response.output_item.added"===a.type&&"message"===a.item.type)c=a.item.id;else if("response.output_item.added"===a.type&&"function_call"===a.item.type)f.push({type:"tool_call_chunk",name:a.item.name,args:a.item.arguments,id:a.item.call_id,index:a.output_index}),h[tT]={[a.item.call_id]:a.item.id};else if("response.output_item.done"===a.type&&["web_search_call","file_search_call","computer_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call","custom_tool_call"].includes(a.item.type))h.tool_outputs=[a.item];else if("response.created"===a.type)g.id=a.response.id,g.model_name=a.response.model,g.model=a.response.model;else if("response.completed"===a.type){let c=this._convertResponsesMessageToBaseMessage(a.response);for(let[d,e]of(b=a.response.usage,a.response.text?.format?.type==="json_schema"&&(h.parsed??=JSON.parse(c.text)),Object.entries(a.response)))"id"!==d&&(g[d]=e)}else if("response.function_call_arguments.delta"===a.type||"response.custom_tool_call_input.delta"===a.type)f.push({type:"tool_call_chunk",args:a.delta,index:a.output_index});else if("response.web_search_call.completed"===a.type||"response.file_search_call.completed"===a.type)e={tool_outputs:{id:a.item_id,type:a.type.replace("response.","").replace(".completed",""),status:"completed"}};else if("response.refusal.done"===a.type)h.refusal=a.refusal;else if("response.output_item.added"===a.type&&"item"in a&&"reasoning"===a.item.type){let b=a.item.summary?a.item.summary.map((a,b)=>({...a,index:b})):void 0;h.reasoning={id:a.item.id,type:a.item.type,...b?{summary:b}:{}}}else if("response.reasoning_summary_part.added"===a.type)h.reasoning={type:"reasoning",summary:[{...a.part,index:a.summary_index}]};else if("response.reasoning_summary_text.delta"===a.type)h.reasoning={type:"reasoning",summary:[{text:a.delta,type:"summary_text",index:a.summary_index}]};else if("response.image_generation_call.partial_image"===a.type)return null;else return null;return new hh({text:d.map(a=>a.text).join(""),message:new eZ({id:c,content:d,tool_call_chunks:f,usage_metadata:b,additional_kwargs:h,response_metadata:g}),generationInfo:e})}_convertMessagesToResponsesParams(a){return a.flatMap(a=>{let b=a.additional_kwargs,c=tV(a);if("system"===c&&tU(this.model)&&(c="developer"),"function"===c)throw Error("Function messages are not supported in Responses API");if("tool"===c)return b?.type==="computer_call_output"?{type:"computer_call_output",output:(()=>{if("string"==typeof a.content)return{type:"computer_screenshot",image_url:a.content};if(Array.isArray(a.content)){let b=a.content.find(a=>"computer_screenshot"===a.type);if(b)return b;let c=a.content.find(a=>"image_url"===a.type);if(c)return{type:"computer_screenshot",image_url:"string"==typeof c.image_url?c.image_url:c.image_url.url}}throw Error("Invalid computer call output")})(),call_id:a.tool_call_id}:a.metadata?.customTool?{type:"custom_tool_call_output",call_id:a.tool_call_id,output:a.content}:{type:"function_call_output",call_id:a.tool_call_id,id:a.id?.startsWith("fc_")?a.id:void 0,output:"string"!=typeof a.content?JSON.stringify(a.content):a.content};if("assistant"===c){if(!this.zdrEnabled&&null!=a.response_metadata.output&&Array.isArray(a.response_metadata.output)&&a.response_metadata.output.length>0&&a.response_metadata.output.every(a=>"type"in a))return a.response_metadata.output;let c=[];if(b?.reasoning&&!this.zdrEnabled){let a=this._convertReasoningSummary(b.reasoning);c.push(a)}let{content:d}=a;b?.refusal&&("string"==typeof d&&(d=[{type:"output_text",text:d,annotations:[]}]),d=[...d,{type:"refusal",refusal:b.refusal}]),("string"==typeof d||d.length>0)&&c.push({type:"message",role:"assistant",...a.id&&!this.zdrEnabled&&a.id.startsWith("msg_")?{id:a.id}:{},content:"string"==typeof d?d:d.flatMap(a=>"text"===a.type?{type:"output_text",text:a.text,annotations:a.annotations??[]}:"output_text"===a.type||"refusal"===a.type?a:[])});let e=b?.[tT];eX(a)&&a.tool_calls?.length?c.push(...a.tool_calls.map(a=>"tool_call"===a.type&&"isCustomTool"in a&&!0===a.isCustomTool?{type:"custom_tool_call",id:a.call_id,call_id:a.id??"",input:a.args.input,name:a.name}:{type:"function_call",name:a.name,arguments:JSON.stringify(a.args),call_id:a.id,...this.zdrEnabled?{id:e?.[a.id]}:{}})):b?.tool_calls&&c.push(...b.tool_calls.map(a=>({type:"function_call",name:a.function.name,call_id:a.id,arguments:a.function.arguments,...this.zdrEnabled?{id:e?.[a.id]}:{}})));let f=a.response_metadata.output?.length?a.response_metadata.output:b.tool_outputs,g=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(null!=f){let a=f?.filter(a=>g.includes(a.type));a.length>0&&c.push(...a)}return c}if("user"===c||"system"===c||"developer"===c){if("string"==typeof a.content)return{type:"message",role:c,content:a.content};let b=[],d=a.content.flatMap(a=>("mcp_approval_response"===a.type&&b.push({type:"mcp_approval_response",approval_request_id:a.approval_request_id,approve:a.approve}),dH(a))?dP(a,tW):"text"===a.type?{type:"input_text",text:a.text}:"image_url"===a.type?{type:"input_image",image_url:"string"==typeof a.image_url?a.image_url:a.image_url.url,detail:"string"==typeof a.image_url?"auto":a.image_url.detail}:"input_text"===a.type||"input_image"===a.type||"input_file"===a.type?a:[]);return d.length>0&&b.push({type:"message",role:c,content:d}),b}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${c}`),[]})}_convertReasoningSummary(a){let b=(a.summary.length>1?a.summary.reduce((a,b)=>{let c=a.at(-1);return c.index===b.index?c.text+=b.text:a.push(b),a},[{...a.summary[0]}]):a.summary).map(a=>Object.fromEntries(Object.entries(a).filter(([a])=>"index"!==a)));return{...a,summary:b}}_reduceChatOpenAITools(a,b){let c=[];for(let d of a)tR(d)?("image_generation"===d.type&&b?.stream&&(d.partial_images=1),c.push(d)):px(d)?c.push({type:"function",name:d.function.name,parameters:d.function.parameters,description:d.function.description,strict:b?.strict??null}):tS(d)&&c.push(function(a){return{type:"custom",name:a.custom.name,description:a.custom.description,format:(()=>{if(a.custom.format){if("grammar"===a.custom.format.type)return{type:"grammar",definition:a.custom.format.grammar.definition,syntax:a.custom.format.grammar.syntax};if("text"===a.custom.format.type)return{type:"text"}}})()}}(d));return c}}class t$ extends tY{invocationParams(a,b){let c;a?.strict!==void 0?c=a.strict:void 0!==this.supportsStrictToolCalling&&(c=this.supportsStrictToolCalling);let d={};a?.stream_options!==void 0?d={stream_options:a.stream_options}:this.streamUsage&&(this.streaming||b?.streaming)&&(d={stream_options:{include_usage:!0}});let e={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:a?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:a?.functions,function_call:a?.function_call,tools:a?.tools?.length?a.tools.map(a=>this._convertChatOpenAIToolToCompletionsTool(a,{strict:c})):void 0,tool_choice:tO(a?.tool_choice),response_format:this._getResponseFormat(a?.response_format),seed:a?.seed,...d,parallel_tool_calls:a?.parallel_tool_calls,...this.audio||a?.audio?{audio:this.audio||a?.audio}:{},...this.modalities||a?.modalities?{modalities:this.modalities||a?.modalities}:{},...this.modelKwargs,prompt_cache_key:a?.promptCacheKey??this.promptCacheKey,verbosity:a?.verbosity??this.verbosity};a?.prediction!==void 0&&(e.prediction=a.prediction),void 0!==this.service_tier&&(e.service_tier=this.service_tier),a?.service_tier!==void 0&&(e.service_tier=a.service_tier);let f=this._getReasoningParams(a);return void 0!==f&&void 0!==f.effort&&(e.reasoning_effort=f.effort),tU(e.model)?e.max_completion_tokens=-1===this.maxTokens?void 0:this.maxTokens:e.max_tokens=-1===this.maxTokens?void 0:this.maxTokens,e}async _generate(a,b,c){let d={},e=this.invocationParams(b),f=tX(a,this.model);if(e.stream){let e=this._streamResponseChunks(a,b,c),f={};for await(let a of e){a.message.response_metadata={...a.generationInfo,...a.message.response_metadata};let b=a.generationInfo?.completion??0;void 0===f[b]?f[b]=a:f[b]=f[b].concat(a)}let g=Object.entries(f).sort(([a],[b])=>parseInt(a,10)-parseInt(b,10)).map(([a,b])=>b),{functions:h,function_call:i}=this.invocationParams(b),j=await this._getEstimatedTokenCountFromPrompt(a,h,i),k=await this._getNumTokensFromGenerations(g);return d.input_tokens=j,d.output_tokens=k,d.total_tokens=j+k,{generations:g,llmOutput:{estimatedTokenUsage:{promptTokens:d.input_tokens,completionTokens:d.output_tokens,totalTokens:d.total_tokens}}}}{let a=await this.completionWithRetry({...e,stream:!1,messages:f},{signal:b?.signal,...b?.options}),{completion_tokens:c,prompt_tokens:g,total_tokens:h,prompt_tokens_details:i,completion_tokens_details:j}=a?.usage??{};c&&(d.output_tokens=(d.output_tokens??0)+c),g&&(d.input_tokens=(d.input_tokens??0)+g),h&&(d.total_tokens=(d.total_tokens??0)+h),(i?.audio_tokens!==null||i?.cached_tokens!==null)&&(d.input_token_details={...i?.audio_tokens!==null&&{audio:i?.audio_tokens},...i?.cached_tokens!==null&&{cache_read:i?.cached_tokens}}),(j?.audio_tokens!==null||j?.reasoning_tokens!==null)&&(d.output_token_details={...j?.audio_tokens!==null&&{audio:j?.audio_tokens},...j?.reasoning_tokens!==null&&{reasoning:j?.reasoning_tokens}});let k=[];for(let b of a?.choices??[]){let c={text:b.message?.content??"",message:this._convertCompletionsMessageToBaseMessage(b.message??{role:"assistant"},a)};c.generationInfo={...b.finish_reason?{finish_reason:b.finish_reason}:{},...b.logprobs?{logprobs:b.logprobs}:{}},eX(c.message)&&(c.message.usage_metadata=d),c.message=new eW(Object.fromEntries(Object.entries(c.message).filter(([a])=>!a.startsWith("lc_")))),k.push(c)}return{generations:k,llmOutput:{tokenUsage:{promptTokens:d.input_tokens,completionTokens:d.output_tokens,totalTokens:d.total_tokens}}}}}async *_streamResponseChunks(a,b,c){let d,e,f=tX(a,this.model),g={...this.invocationParams(b,{streaming:!0}),messages:f,stream:!0};for await(let a of(await this.completionWithRetry(g,b))){let f=a?.choices?.[0];if(a.usage&&(e=a.usage),!f)continue;let{delta:g}=f;if(!g)continue;let h=this._convertCompletionsDeltaToBaseMessageChunk(g,a,d);d=g.role??d;let i={prompt:b.promptIndex??0,completion:f.index??0};if("string"!=typeof h.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let j={...i};null!=f.finish_reason&&(j.finish_reason=f.finish_reason,j.system_fingerprint=a.system_fingerprint,j.model_name=a.model,j.service_tier=a.service_tier),this.logprobs&&(j.logprobs=f.logprobs);let k=new hh({message:h,text:h.content,generationInfo:j});yield k,await c?.handleLLMNewToken(k.text??"",i,void 0,void 0,void 0,{chunk:k})}if(e){let a={...e.prompt_tokens_details?.audio_tokens!==null&&{audio:e.prompt_tokens_details?.audio_tokens},...e.prompt_tokens_details?.cached_tokens!==null&&{cache_read:e.prompt_tokens_details?.cached_tokens}},b={...e.completion_tokens_details?.audio_tokens!==null&&{audio:e.completion_tokens_details?.audio_tokens},...e.completion_tokens_details?.reasoning_tokens!==null&&{reasoning:e.completion_tokens_details?.reasoning_tokens}},c=new hh({message:new eZ({content:"",response_metadata:{usage:{...e}},usage_metadata:{input_tokens:e.prompt_tokens,output_tokens:e.completion_tokens,total_tokens:e.total_tokens,...Object.keys(a).length>0&&{input_token_details:a},...Object.keys(b).length>0&&{output_token_details:b}}}),text:""});yield c}if(b.signal?.aborted)throw Error("AbortError")}async completionWithRetry(a,b){let c=this._getClientOptions(b),d=a.response_format&&"json_schema"===a.response_format.type;return this.caller.call(async()=>{try{if(d&&!a.stream)return await this.client.chat.completions.parse(a,c);return await this.client.chat.completions.create(a,c)}catch(a){throw tN(a)}})}_convertCompletionsMessageToBaseMessage(a,b){let c=a.tool_calls;if("assistant"!==a.role)return new ex(a.content||"",a.role??"unknown");{var d,e;let f=[],g=[];for(let a of c??[])try{f.push(ti(a,{returnId:!0}))}catch(b){g.push(tk(a,b.message))}let h={function_call:a.function_call,tool_calls:c};void 0!==this.__includeRawResponse&&(h.__raw_response=b);let i={model_name:b.model,...b.system_fingerprint?{usage:{...b.usage},system_fingerprint:b.system_fingerprint}:{}};return a.audio&&(h.audio=a.audio),new eW({content:(d=a.content||"",(e=b.choices?.[0]?.message)&&"object"==typeof e&&"images"in e&&Array.isArray(e.images)?[{type:"text",text:d,source_type:"text"},...e.images.filter(a=>"string"==typeof a?.image_url?.url).map(a=>({type:"image",url:a.image_url.url,source_type:"url"}))]:d),tool_calls:f,invalid_tool_calls:g,additional_kwargs:h,response_metadata:i,id:b.id})}}_convertCompletionsDeltaToBaseMessageChunk(a,b,c){let d,e=a.role??c,f=a.content??"";d=a.function_call?{function_call:a.function_call}:a.tool_calls?{tool_calls:a.tool_calls}:{},this.__includeRawResponse&&(d.__raw_response=b),a.audio&&(d.audio={...a.audio,index:b.choices[0].index});let g={usage:{...b.usage}};if("user"===e)return new eG({content:f,response_metadata:g});if("assistant"===e){let c=[];if(Array.isArray(a.tool_calls))for(let b of a.tool_calls)c.push({name:b.function?.name,args:b.function?.arguments,id:b.id,index:b.index,type:"tool_call_chunk"});return new eZ({content:f,tool_call_chunks:c,additional_kwargs:d,id:b.id,response_metadata:g})}if("system"===e)return new eL({content:f,response_metadata:g});if("developer"===e)return new eL({content:f,response_metadata:g,additional_kwargs:{__openai_role__:"developer"}});if("function"===e)return new eC({content:f,additional_kwargs:d,name:a.name,response_metadata:g});else if("tool"===e)return new eo({content:f,additional_kwargs:d,tool_call_id:a.tool_call_id,response_metadata:g});else return new ey({content:f,role:e,response_metadata:g})}}class t_ extends tY{get lc_serializable_keys(){return[...super.lc_serializable_keys,"useResponsesApi"]}constructor(a){super(a),Object.defineProperty(this,"fields",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"completions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.useResponsesApi=a?.useResponsesApi??!1,this.responses=a?.responses??new tZ(a),this.completions=a?.completions??new t$(a)}_useResponsesApi(a){let b=a?.tools?.some(tR),c=a?.previous_response_id!=null||a?.text!=null||a?.truncation!=null||a?.include!=null||a?.reasoning?.summary!=null||this.reasoning?.summary!=null,d=a?.tools?.some(tS);return this.useResponsesApi||b||c||d}getLsParams(a){let b=this._combineCallOptions(a);return this._useResponsesApi(a)?this.responses.getLsParams(b):this.completions.getLsParams(b)}invocationParams(a){let b=this._combineCallOptions(a);return this._useResponsesApi(a)?this.responses.invocationParams(b):this.completions.invocationParams(b)}async _generate(a,b,c){return this._useResponsesApi(b)?this.responses._generate(a,b):this.completions._generate(a,b,c)}async *_streamResponseChunks(a,b,c){this._useResponsesApi(b)?yield*this.responses._streamResponseChunks(a,this._combineCallOptions(b),c):yield*this.completions._streamResponseChunks(a,this._combineCallOptions(b),c)}withConfig(a){let b=new t_(this.fields);return b.defaultOptions={...this.defaultOptions,...a},b}}dy({},{BaseLLM:()=>t0,LLM:()=>t1});var t0=class a extends pA{lc_namespace=["langchain","llms",this._llmType()];async invoke(b,c){let d=a._convertInputToPromptValue(b);return(await this.generatePrompt([d],c,c?.callbacks)).generations[0][0].text}async *_streamResponseChunks(a,b,c){throw Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(a){let[b,c]=super._separateRunnableConfigFromCallOptions(a);return c.signal=b.signal,[b,c]}async *_streamIterator(b,c){if(this._streamResponseChunks===a.prototype._streamResponseChunks)yield this.invoke(b,c);else{let d=a._convertInputToPromptValue(b),[e,f]=this._separateRunnableConfigFromCallOptionsCompat(c),g=await gY.configure(e.callbacks,this.callbacks,e.tags,this.tags,e.metadata,this.metadata,{verbose:this.verbose}),h={options:f,invocation_params:this?.invocationParams(f),batch_size:1},i=await g?.handleLLMStart(this.toJSON(),[d.toString()],e.runId,void 0,h,void 0,void 0,e.runName),j=new hg({text:""});try{for await(let a of this._streamResponseChunks(d.toString(),f,i?.[0]))j=j?j.concat(a):a,"string"==typeof a.text&&(yield a.text)}catch(a){throw await Promise.all((i??[]).map(b=>b?.handleLLMError(a))),a}await Promise.all((i??[]).map(a=>a?.handleLLMEnd({generations:[[j]]})))}}async generatePrompt(a,b,c){let d=a.map(a=>a.toString());return this.generate(d,b,c)}invocationParams(a){return{}}_flattenLLMResult(a){let b=[];for(let c=0;c<a.generations.length;c+=1){let d=a.generations[c];if(0===c)b.push({generations:[d],llmOutput:a.llmOutput});else{let c=a.llmOutput?{...a.llmOutput,tokenUsage:{}}:void 0;b.push({generations:[d],llmOutput:c})}}return b}async _generateUncached(b,c,d,e){let f,g;if(void 0!==e&&e.length===b.length)f=e;else{let a=await gY.configure(d.callbacks,this.callbacks,d.tags,this.tags,d.metadata,this.metadata,{verbose:this.verbose}),e={options:c,invocation_params:this?.invocationParams(c),batch_size:b.length};f=await a?.handleLLMStart(this.toJSON(),b,d.runId,void 0,e,void 0,void 0,d?.runName)}if(f?.[0].handlers.find(fi)&&1===b.length&&this._streamResponseChunks!==a.prototype._streamResponseChunks)try{let a;for await(let d of(await this._streamResponseChunks(b[0],c,f?.[0])))a=void 0===a?d:hc(a,d);if(void 0===a)throw Error("Received empty response from chat model call.");g={generations:[[a]],llmOutput:{}},await f?.[0].handleLLMEnd(g)}catch(a){throw await f?.[0].handleLLMError(a),a}else{try{g=await this._generate(b,c,f?.[0])}catch(a){throw await Promise.all((f??[]).map(b=>b?.handleLLMError(a))),a}let a=this._flattenLLMResult(g);await Promise.all((f??[]).map((b,c)=>b?.handleLLMEnd(a[c])))}let h=f?.map(a=>a.runId)||void 0;return Object.defineProperty(g,hf,{value:h?{runIds:h}:void 0,configurable:!0}),g}async _generateCached({prompts:a,cache:b,llmStringKey:c,parsedOptions:d,handledOptions:e,runId:f}){let g=await gY.configure(e.callbacks,this.callbacks,e.tags,this.tags,e.metadata,this.metadata,{verbose:this.verbose}),h={options:d,invocation_params:this?.invocationParams(d),batch_size:a.length},i=await g?.handleLLMStart(this.toJSON(),a,f,void 0,h,void 0,void 0,e?.runName),j=[],k=(await Promise.allSettled(a.map(async(a,d)=>{let e=await b.lookup(a,c);return null==e&&j.push(d),e}))).map((a,b)=>({result:a,runManager:i?.[b]})).filter(({result:a})=>"fulfilled"===a.status&&null!=a.value||"rejected"===a.status),l=[];await Promise.all(k.map(async({result:a,runManager:b},c)=>{if("fulfilled"!==a.status)return await b?.handleLLMError(a.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(a.reason);{let d=a.value;return l[c]=d.map(a=>(a.generationInfo={...a.generationInfo,tokenUsage:{}},a)),d.length&&await b?.handleLLMNewToken(d[0].text),b?.handleLLMEnd({generations:[d]},void 0,void 0,void 0,{cached:!0})}}));let m={generations:l,missingPromptIndices:j,startedRunManagers:i};return Object.defineProperty(m,hf,{value:i?{runIds:i?.map(a=>a.runId)}:void 0,configurable:!0}),m}async generate(a,b,c){let d;if(!Array.isArray(a))throw Error("Argument 'prompts' is expected to be a string[]");d=Array.isArray(b)?{stop:b}:b;let[e,f]=this._separateRunnableConfigFromCallOptionsCompat(d);if(e.callbacks=e.callbacks??c,!this.cache)return this._generateUncached(a,f,e);let{cache:g}=this,h=this._getSerializedCacheKeyParametersForCall(f),{generations:i,missingPromptIndices:j,startedRunManagers:k}=await this._generateCached({prompts:a,cache:g,llmStringKey:h,parsedOptions:f,handledOptions:e,runId:e.runId}),l={};if(j.length>0){let b=await this._generateUncached(j.map(b=>a[b]),f,e,void 0!==k?j.map(a=>k?.[a]):void 0);await Promise.all(b.generations.map(async(b,c)=>{let d=j[c];return i[d]=b,g.update(a[d],h,b)})),l=b.llmOutput??{}}return{generations:i,llmOutput:l}}_identifyingParams(){return{}}_modelType(){return"base_llm"}},t1=class extends t0{async _generate(a,b,c){return{generations:await Promise.all(a.map((a,d)=>this._call(a,{...b,promptIndex:d},c).then(a=>[{text:a}])))}}};a.s(["ZodAny",()=>vk,"ZodArray",()=>vu,"ZodBase64",()=>uT,"ZodBase64URL",()=>uV,"ZodBigInt",()=>u9,"ZodBigIntFormat",()=>vb,"ZodBoolean",()=>u7,"ZodCIDRv4",()=>uP,"ZodCIDRv6",()=>uR,"ZodCUID",()=>uB,"ZodCUID2",()=>uD,"ZodCatch",()=>wa,"ZodCustom",()=>wo,"ZodDate",()=>vs,"ZodDefault",()=>v2,"ZodDiscriminatedUnion",()=>vD,"ZodE164",()=>uX,"ZodEmail",()=>um,"ZodEmoji",()=>ux,"ZodEnum",()=>vQ,"ZodFile",()=>vV,"ZodGUID",()=>uo,"ZodIPv4",()=>uL,"ZodIPv6",()=>uN,"ZodIntersection",()=>vF,"ZodJWT",()=>uZ,"ZodKSUID",()=>uJ,"ZodLazy",()=>wk,"ZodLiteral",()=>vT,"ZodMap",()=>vM,"ZodNaN",()=>wc,"ZodNanoID",()=>uz,"ZodNever",()=>vo,"ZodNonOptional",()=>v6,"ZodNull",()=>vi,"ZodNullable",()=>v_,"ZodNumber",()=>u_,"ZodNumberFormat",()=>u1,"ZodObject",()=>vx,"ZodOptional",()=>vZ,"ZodPipe",()=>we,"ZodPrefault",()=>v4,"ZodPromise",()=>wm,"ZodReadonly",()=>wg,"ZodRecord",()=>vJ,"ZodSet",()=>vO,"ZodString",()=>uj,"ZodStringFormat",()=>ul,"ZodSuccess",()=>v8,"ZodSymbol",()=>ve,"ZodTemplateLiteral",()=>wi,"ZodTransform",()=>vX,"ZodTuple",()=>vH,"ZodType",()=>uh,"ZodULID",()=>uF,"ZodURL",()=>uv,"ZodUUID",()=>uq,"ZodUndefined",()=>vg,"ZodUnion",()=>vB,"ZodUnknown",()=>vm,"ZodVoid",()=>vq,"ZodXID",()=>uH,"_ZodString",()=>ui,"_default",()=>v3,"any",()=>vl,"array",()=>vv,"base64",()=>uU,"base64url",()=>uW,"bigint",()=>va,"boolean",()=>u8,"catch",()=>wb,"check",()=>wp,"cidrv4",()=>uQ,"cidrv6",()=>uS,"cuid",()=>uC,"cuid2",()=>uE,"custom",()=>wq,"date",()=>vt,"discriminatedUnion",()=>vE,"e164",()=>uY,"email",()=>un,"emoji",()=>uy,"enum",()=>vR,"file",()=>vW,"float32",()=>u3,"float64",()=>u4,"guid",()=>up,"instanceof",()=>wt,"int",()=>u2,"int32",()=>u5,"int64",()=>vc,"intersection",()=>vG,"ipv4",()=>uM,"ipv6",()=>uO,"json",()=>wv,"jwt",()=>u$,"keyof",()=>vw,"ksuid",()=>uK,"lazy",()=>wl,"literal",()=>vU,"looseObject",()=>vA,"map",()=>vN,"nan",()=>wd,"nanoid",()=>uA,"nativeEnum",()=>vS,"never",()=>vp,"nonoptional",()=>v7,"null",()=>vj,"nullable",()=>v0,"nullish",()=>v1,"number",()=>u0,"object",()=>vy,"optional",()=>v$,"partialRecord",()=>vL,"pipe",()=>wf,"prefault",()=>v5,"preprocess",()=>ww,"promise",()=>wn,"readonly",()=>wh,"record",()=>vK,"refine",()=>wr,"set",()=>vP,"strictObject",()=>vz,"string",()=>uk,"stringbool",()=>wu,"success",()=>v9,"superRefine",()=>ws,"symbol",()=>vf,"templateLiteral",()=>wj,"transform",()=>vY,"tuple",()=>vI,"uint32",()=>u6,"uint64",()=>vd,"ulid",()=>uG,"undefined",()=>vh,"union",()=>vC,"unknown",()=>vn,"url",()=>uw,"uuid",()=>ur,"uuidv4",()=>us,"uuidv6",()=>ut,"uuidv7",()=>uu,"void",()=>vr,"xid",()=>uI],175688);var mx=mx;a.s([],516374),a.s(["ZodISODate",()=>t4,"ZodISODateTime",()=>t2,"ZodISODuration",()=>t8,"ZodISOTime",()=>t6,"date",()=>t5,"datetime",()=>t3,"duration",()=>t9,"time",()=>t7],340796);let t2=hi("ZodISODateTime",(a,b)=>{jC.init(a,b),ul.init(a,b)});function t3(a){return lb(t2,a)}let t4=hi("ZodISODate",(a,b)=>{jD.init(a,b),ul.init(a,b)});function t5(a){return lc(t4,a)}let t6=hi("ZodISOTime",(a,b)=>{jE.init(a,b),ul.init(a,b)});function t7(a){return ld(t6,a)}let t8=hi("ZodISODuration",(a,b)=>{jF.init(a,b),ul.init(a,b)});function t9(a){return le(t8,a)}let ua=(a,b)=>{h8.init(a,b),a.name="ZodError",Object.defineProperties(a,{format:{value:b=>ib(a,b)},flatten:{value:b=>ia(a,b)},addIssue:{value:b=>a.issues.push(b)},addIssues:{value:b=>a.issues.push(...b)},isEmpty:{get:()=>0===a.issues.length}})},ub=hi("ZodError",ua),uc=hi("ZodError",ua,{Parent:Error});a.s(["ZodError",0,ub,"ZodRealError",0,uc],797020);let ud=ig(uc),ue=ii(uc),uf=ik(uc),ug=im(uc);a.s(["parse",0,ud,"parseAsync",0,ue,"safeParse",0,uf,"safeParseAsync",0,ug],896353);let uh=hi("ZodType",(a,b)=>(jo.init(a,b),a.def=b,Object.defineProperty(a,"_def",{value:b}),a.check=(...c)=>a.clone({...b,checks:[...b.checks??[],...c.map(a=>"function"==typeof a?{_zod:{check:a,def:{check:"custom"},onattach:[]}}:a)]}),a.clone=(b,c)=>hN(a,b,c),a.brand=()=>a,a.register=(b,c)=>(b.add(a,c),a),a.parse=(b,c)=>ud(a,b,c,{callee:a.parse}),a.safeParse=(b,c)=>uf(a,b,c),a.parseAsync=async(b,c)=>ue(a,b,c,{callee:a.parseAsync}),a.safeParseAsync=async(b,c)=>ug(a,b,c),a.spa=a.safeParseAsync,a.refine=(b,c)=>a.check(wr(b,c)),a.superRefine=b=>a.check(ws(b)),a.overwrite=b=>a.check(lZ(b)),a.optional=()=>v$(a),a.nullable=()=>v0(a),a.nullish=()=>v$(v0(a)),a.nonoptional=b=>v7(a,b),a.array=()=>vv(a),a.or=b=>vC([a,b]),a.and=b=>vG(a,b),a.transform=b=>wf(a,vY(b)),a.default=b=>v3(a,b),a.prefault=b=>v5(a,b),a.catch=b=>wb(a,b),a.pipe=b=>wf(a,b),a.readonly=()=>wh(a),a.describe=b=>{let c=a.clone();return kN.add(c,{description:b}),c},Object.defineProperty(a,"description",{get:()=>kN.get(a)?.description,configurable:!0}),a.meta=(...b)=>{if(0===b.length)return kN.get(a);let c=a.clone();return kN.add(c,b[0]),c},a.isOptional=()=>a.safeParse(void 0).success,a.isNullable=()=>a.safeParse(null).success,a)),ui=hi("_ZodString",(a,b)=>{jp.init(a,b),uh.init(a,b);let c=a._zod.bag;a.format=c.format??null,a.minLength=c.minimum??null,a.maxLength=c.maximum??null,a.regex=(...b)=>a.check(lR(...b)),a.includes=(...b)=>a.check(lU(...b)),a.startsWith=(...b)=>a.check(lV(...b)),a.endsWith=(...b)=>a.check(lW(...b)),a.min=(...b)=>a.check(lP(...b)),a.max=(...b)=>a.check(lO(...b)),a.length=(...b)=>a.check(lQ(...b)),a.nonempty=(...b)=>a.check(lP(1,...b)),a.lowercase=b=>a.check(lS(b)),a.uppercase=b=>a.check(lT(b)),a.trim=()=>a.check(l_()),a.normalize=(...b)=>a.check(l$(...b)),a.toLowerCase=()=>a.check(l0()),a.toUpperCase=()=>a.check(l1())}),uj=hi("ZodString",(a,b)=>{jp.init(a,b),ui.init(a,b),a.email=b=>a.check(kQ(um,b)),a.url=b=>a.check(kW(uv,b)),a.jwt=b=>a.check(k9(uZ,b)),a.emoji=b=>a.check(kX(ux,b)),a.guid=b=>a.check(kR(uo,b)),a.uuid=b=>a.check(kS(uq,b)),a.uuidv4=b=>a.check(kT(uq,b)),a.uuidv6=b=>a.check(kU(uq,b)),a.uuidv7=b=>a.check(kV(uq,b)),a.nanoid=b=>a.check(kY(uz,b)),a.guid=b=>a.check(kR(uo,b)),a.cuid=b=>a.check(kZ(uB,b)),a.cuid2=b=>a.check(k$(uD,b)),a.ulid=b=>a.check(k_(uF,b)),a.base64=b=>a.check(k6(uT,b)),a.base64url=b=>a.check(k7(uV,b)),a.xid=b=>a.check(k0(uH,b)),a.ksuid=b=>a.check(k1(uJ,b)),a.ipv4=b=>a.check(k2(uL,b)),a.ipv6=b=>a.check(k3(uN,b)),a.cidrv4=b=>a.check(k4(uP,b)),a.cidrv6=b=>a.check(k5(uR,b)),a.e164=b=>a.check(k8(uX,b)),a.datetime=b=>a.check(t3(b)),a.date=b=>a.check(t5(b)),a.time=b=>a.check(t7(b)),a.duration=b=>a.check(t9(b))});function uk(a){return kO(uj,a)}let ul=hi("ZodStringFormat",(a,b)=>{jq.init(a,b),ui.init(a,b)}),um=hi("ZodEmail",(a,b)=>{jt.init(a,b),ul.init(a,b)});function un(a){return kQ(um,a)}let uo=hi("ZodGUID",(a,b)=>{jr.init(a,b),ul.init(a,b)});function up(a){return kR(uo,a)}let uq=hi("ZodUUID",(a,b)=>{js.init(a,b),ul.init(a,b)});function ur(a){return kS(uq,a)}function us(a){return kT(uq,a)}function ut(a){return kU(uq,a)}function uu(a){return kV(uq,a)}let uv=hi("ZodURL",(a,b)=>{ju.init(a,b),ul.init(a,b)});function uw(a){return kW(uv,a)}let ux=hi("ZodEmoji",(a,b)=>{jv.init(a,b),ul.init(a,b)});function uy(a){return kX(ux,a)}let uz=hi("ZodNanoID",(a,b)=>{jw.init(a,b),ul.init(a,b)});function uA(a){return kY(uz,a)}let uB=hi("ZodCUID",(a,b)=>{jx.init(a,b),ul.init(a,b)});function uC(a){return kZ(uB,a)}let uD=hi("ZodCUID2",(a,b)=>{jy.init(a,b),ul.init(a,b)});function uE(a){return k$(uD,a)}let uF=hi("ZodULID",(a,b)=>{jz.init(a,b),ul.init(a,b)});function uG(a){return k_(uF,a)}let uH=hi("ZodXID",(a,b)=>{jA.init(a,b),ul.init(a,b)});function uI(a){return k0(uH,a)}let uJ=hi("ZodKSUID",(a,b)=>{jB.init(a,b),ul.init(a,b)});function uK(a){return k1(uJ,a)}let uL=hi("ZodIPv4",(a,b)=>{jG.init(a,b),ul.init(a,b)});function uM(a){return k2(uL,a)}let uN=hi("ZodIPv6",(a,b)=>{jH.init(a,b),ul.init(a,b)});function uO(a){return k3(uN,a)}let uP=hi("ZodCIDRv4",(a,b)=>{jI.init(a,b),ul.init(a,b)});function uQ(a){return k4(uP,a)}let uR=hi("ZodCIDRv6",(a,b)=>{jJ.init(a,b),ul.init(a,b)});function uS(a){return k5(uR,a)}let uT=hi("ZodBase64",(a,b)=>{jL.init(a,b),ul.init(a,b)});function uU(a){return k6(uT,a)}let uV=hi("ZodBase64URL",(a,b)=>{jN.init(a,b),ul.init(a,b)});function uW(a){return k7(uV,a)}let uX=hi("ZodE164",(a,b)=>{jO.init(a,b),ul.init(a,b)});function uY(a){return k8(uX,a)}let uZ=hi("ZodJWT",(a,b)=>{jQ.init(a,b),ul.init(a,b)});function u$(a){return k9(uZ,a)}let u_=hi("ZodNumber",(a,b)=>{jR.init(a,b),uh.init(a,b),a.gt=(b,c)=>a.check(lE(b,c)),a.gte=(b,c)=>a.check(lF(b,c)),a.min=(b,c)=>a.check(lF(b,c)),a.lt=(b,c)=>a.check(lC(b,c)),a.lte=(b,c)=>a.check(lD(b,c)),a.max=(b,c)=>a.check(lD(b,c)),a.int=b=>a.check(u2(b)),a.safe=b=>a.check(u2(b)),a.positive=b=>a.check(lE(0,b)),a.nonnegative=b=>a.check(lF(0,b)),a.negative=b=>a.check(lC(0,b)),a.nonpositive=b=>a.check(lD(0,b)),a.multipleOf=(b,c)=>a.check(lK(b,c)),a.step=(b,c)=>a.check(lK(b,c)),a.finite=()=>a;let c=a._zod.bag;a.minValue=Math.max(c.minimum??-1/0,c.exclusiveMinimum??-1/0)??null,a.maxValue=Math.min(c.maximum??1/0,c.exclusiveMaximum??1/0)??null,a.isInt=(c.format??"").includes("int")||Number.isSafeInteger(c.multipleOf??.5),a.isFinite=!0,a.format=c.format??null});function u0(a){return lf(u_,a)}let u1=hi("ZodNumberFormat",(a,b)=>{jS.init(a,b),u_.init(a,b)});function u2(a){return lh(u1,a)}function u3(a){return li(u1,a)}function u4(a){return lj(u1,a)}function u5(a){return lk(u1,a)}function u6(a){return ll(u1,a)}let u7=hi("ZodBoolean",(a,b)=>{jT.init(a,b),uh.init(a,b)});function u8(a){return lm(u7,a)}let u9=hi("ZodBigInt",(a,b)=>{jU.init(a,b),uh.init(a,b),a.gte=(b,c)=>a.check(lF(b,c)),a.min=(b,c)=>a.check(lF(b,c)),a.gt=(b,c)=>a.check(lE(b,c)),a.gte=(b,c)=>a.check(lF(b,c)),a.min=(b,c)=>a.check(lF(b,c)),a.lt=(b,c)=>a.check(lC(b,c)),a.lte=(b,c)=>a.check(lD(b,c)),a.max=(b,c)=>a.check(lD(b,c)),a.positive=b=>a.check(lE(BigInt(0),b)),a.negative=b=>a.check(lC(BigInt(0),b)),a.nonpositive=b=>a.check(lD(BigInt(0),b)),a.nonnegative=b=>a.check(lF(BigInt(0),b)),a.multipleOf=(b,c)=>a.check(lK(b,c));let c=a._zod.bag;a.minValue=c.minimum??null,a.maxValue=c.maximum??null,a.format=c.format??null});function va(a){return lo(u9,a)}let vb=hi("ZodBigIntFormat",(a,b)=>{jV.init(a,b),u9.init(a,b)});function vc(a){return lq(vb,a)}function vd(a){return lr(vb,a)}let ve=hi("ZodSymbol",(a,b)=>{jW.init(a,b),uh.init(a,b)});function vf(a){return ls(ve,a)}let vg=hi("ZodUndefined",(a,b)=>{jX.init(a,b),uh.init(a,b)});function vh(a){return lt(vg,a)}let vi=hi("ZodNull",(a,b)=>{jY.init(a,b),uh.init(a,b)});function vj(a){return lu(vi,a)}let vk=hi("ZodAny",(a,b)=>{jZ.init(a,b),uh.init(a,b)});function vl(){return lv(vk)}let vm=hi("ZodUnknown",(a,b)=>{j$.init(a,b),uh.init(a,b)});function vn(){return lw(vm)}let vo=hi("ZodNever",(a,b)=>{j_.init(a,b),uh.init(a,b)});function vp(a){return lx(vo,a)}let vq=hi("ZodVoid",(a,b)=>{j0.init(a,b),uh.init(a,b)});function vr(a){return ly(vq,a)}let vs=hi("ZodDate",(a,b)=>{j1.init(a,b),uh.init(a,b),a.min=(b,c)=>a.check(lF(b,c)),a.max=(b,c)=>a.check(lD(b,c));let c=a._zod.bag;a.minDate=c.minimum?new Date(c.minimum):null,a.maxDate=c.maximum?new Date(c.maximum):null});function vt(a){return lz(vs,a)}let vu=hi("ZodArray",(a,b)=>{j3.init(a,b),uh.init(a,b),a.element=b.element,a.min=(b,c)=>a.check(lP(b,c)),a.nonempty=b=>a.check(lP(1,b)),a.max=(b,c)=>a.check(lO(b,c)),a.length=(b,c)=>a.check(lQ(b,c)),a.unwrap=()=>a.element});function vv(a,b){return l2(vu,a,b)}function vw(a){return vU(Object.keys(a._zod.def.shape))}let vx=hi("ZodObject",(a,b)=>{j6.init(a,b),uh.init(a,b),mx.defineLazy(a,"shape",()=>b.shape),a.keyof=()=>vR(Object.keys(a._zod.def.shape)),a.catchall=b=>a.clone({...a._zod.def,catchall:b}),a.passthrough=()=>a.clone({...a._zod.def,catchall:vn()}),a.loose=()=>a.clone({...a._zod.def,catchall:vn()}),a.strict=()=>a.clone({...a._zod.def,catchall:vp()}),a.strip=()=>a.clone({...a._zod.def,catchall:void 0}),a.extend=b=>mx.extend(a,b),a.merge=b=>mx.merge(a,b),a.pick=b=>mx.pick(a,b),a.omit=b=>mx.omit(a,b),a.partial=(...b)=>mx.partial(vZ,a,b[0]),a.required=(...b)=>mx.required(v6,a,b[0])});function vy(a,b){return new vx({type:"object",get shape(){return mx.assignProp(this,"shape",{...a}),this.shape},...mx.normalizeParams(b)})}function vz(a,b){return new vx({type:"object",get shape(){return mx.assignProp(this,"shape",{...a}),this.shape},catchall:vp(),...mx.normalizeParams(b)})}function vA(a,b){return new vx({type:"object",get shape(){return mx.assignProp(this,"shape",{...a}),this.shape},catchall:vn(),...mx.normalizeParams(b)})}let vB=hi("ZodUnion",(a,b)=>{j8.init(a,b),uh.init(a,b),a.options=b.options});function vC(a,b){return new vB({type:"union",options:a,...mx.normalizeParams(b)})}let vD=hi("ZodDiscriminatedUnion",(a,b)=>{vB.init(a,b),j9.init(a,b)});function vE(a,b,c){return new vD({type:"union",options:b,discriminator:a,...mx.normalizeParams(c)})}let vF=hi("ZodIntersection",(a,b)=>{ka.init(a,b),uh.init(a,b)});function vG(a,b){return new vF({type:"intersection",left:a,right:b})}let vH=hi("ZodTuple",(a,b)=>{kc.init(a,b),uh.init(a,b),a.rest=b=>a.clone({...a._zod.def,rest:b})});function vI(a,b,c){let d=b instanceof jo,e=d?c:b;return new vH({type:"tuple",items:a,rest:d?b:null,...mx.normalizeParams(e)})}let vJ=hi("ZodRecord",(a,b)=>{ke.init(a,b),uh.init(a,b),a.keyType=b.keyType,a.valueType=b.valueType});function vK(a,b,c){return new vJ({type:"record",keyType:a,valueType:b,...mx.normalizeParams(c)})}function vL(a,b,c){return new vJ({type:"record",keyType:vC([a,vp()]),valueType:b,...mx.normalizeParams(c)})}let vM=hi("ZodMap",(a,b)=>{kf.init(a,b),uh.init(a,b),a.keyType=b.keyType,a.valueType=b.valueType});function vN(a,b,c){return new vM({type:"map",keyType:a,valueType:b,...mx.normalizeParams(c)})}let vO=hi("ZodSet",(a,b)=>{kh.init(a,b),uh.init(a,b),a.min=(...b)=>a.check(lM(...b)),a.nonempty=b=>a.check(lM(1,b)),a.max=(...b)=>a.check(lL(...b)),a.size=(...b)=>a.check(lN(...b))});function vP(a,b){return new vO({type:"set",valueType:a,...mx.normalizeParams(b)})}let vQ=hi("ZodEnum",(a,b)=>{kj.init(a,b),uh.init(a,b),a.enum=b.entries,a.options=Object.values(b.entries);let c=new Set(Object.keys(b.entries));a.extract=(a,d)=>{let e={};for(let d of a)if(c.has(d))e[d]=b.entries[d];else throw Error(`Key ${d} not found in enum`);return new vQ({...b,checks:[],...mx.normalizeParams(d),entries:e})},a.exclude=(a,d)=>{let e={...b.entries};for(let b of a)if(c.has(b))delete e[b];else throw Error(`Key ${b} not found in enum`);return new vQ({...b,checks:[],...mx.normalizeParams(d),entries:e})}});function vR(a,b){return new vQ({type:"enum",entries:Array.isArray(a)?Object.fromEntries(a.map(a=>[a,a])):a,...mx.normalizeParams(b)})}function vS(a,b){return new vQ({type:"enum",entries:a,...mx.normalizeParams(b)})}let vT=hi("ZodLiteral",(a,b)=>{kk.init(a,b),uh.init(a,b),a.values=new Set(b.values),Object.defineProperty(a,"value",{get(){if(b.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return b.values[0]}})});function vU(a,b){return new vT({type:"literal",values:Array.isArray(a)?a:[a],...mx.normalizeParams(b)})}let vV=hi("ZodFile",(a,b)=>{kl.init(a,b),uh.init(a,b),a.min=(b,c)=>a.check(lM(b,c)),a.max=(b,c)=>a.check(lL(b,c)),a.mime=(b,c)=>a.check(lY(Array.isArray(b)?b:[b],c))});function vW(a){return md(vV,a)}let vX=hi("ZodTransform",(a,b)=>{km.init(a,b),uh.init(a,b),a._zod.parse=(c,d)=>{c.addIssue=d=>{"string"==typeof d?c.issues.push(mx.issue(d,c.value,b)):(d.fatal&&(d.continue=!1),d.code??(d.code="custom"),d.input??(d.input=c.value),d.inst??(d.inst=a),d.continue??(d.continue=!0),c.issues.push(mx.issue(d)))};let e=b.transform(c.value,c);return e instanceof Promise?e.then(a=>(c.value=a,c)):(c.value=e,c)}});function vY(a){return new vX({type:"transform",transform:a})}let vZ=hi("ZodOptional",(a,b)=>{kn.init(a,b),uh.init(a,b),a.unwrap=()=>a._zod.def.innerType});function v$(a){return new vZ({type:"optional",innerType:a})}let v_=hi("ZodNullable",(a,b)=>{ko.init(a,b),uh.init(a,b),a.unwrap=()=>a._zod.def.innerType});function v0(a){return new v_({type:"nullable",innerType:a})}function v1(a){return v$(v0(a))}let v2=hi("ZodDefault",(a,b)=>{kp.init(a,b),uh.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeDefault=a.unwrap});function v3(a,b){return new v2({type:"default",innerType:a,get defaultValue(){return"function"==typeof b?b():b}})}let v4=hi("ZodPrefault",(a,b)=>{kr.init(a,b),uh.init(a,b),a.unwrap=()=>a._zod.def.innerType});function v5(a,b){return new v4({type:"prefault",innerType:a,get defaultValue(){return"function"==typeof b?b():b}})}let v6=hi("ZodNonOptional",(a,b)=>{ks.init(a,b),uh.init(a,b),a.unwrap=()=>a._zod.def.innerType});function v7(a,b){return new v6({type:"nonoptional",innerType:a,...mx.normalizeParams(b)})}let v8=hi("ZodSuccess",(a,b)=>{ku.init(a,b),uh.init(a,b),a.unwrap=()=>a._zod.def.innerType});function v9(a){return new v8({type:"success",innerType:a})}let wa=hi("ZodCatch",(a,b)=>{kv.init(a,b),uh.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeCatch=a.unwrap});function wb(a,b){return new wa({type:"catch",innerType:a,catchValue:"function"==typeof b?b:()=>b})}let wc=hi("ZodNaN",(a,b)=>{kw.init(a,b),uh.init(a,b)});function wd(a){return lB(wc,a)}let we=hi("ZodPipe",(a,b)=>{kx.init(a,b),uh.init(a,b),a.in=b.in,a.out=b.out});function wf(a,b){return new we({type:"pipe",in:a,out:b})}let wg=hi("ZodReadonly",(a,b)=>{kz.init(a,b),uh.init(a,b)});function wh(a){return new wg({type:"readonly",innerType:a})}let wi=hi("ZodTemplateLiteral",(a,b)=>{kB.init(a,b),uh.init(a,b)});function wj(a,b){return new wi({type:"template_literal",parts:a,...mx.normalizeParams(b)})}let wk=hi("ZodLazy",(a,b)=>{kD.init(a,b),uh.init(a,b),a.unwrap=()=>a._zod.def.getter()});function wl(a){return new wk({type:"lazy",getter:a})}let wm=hi("ZodPromise",(a,b)=>{kC.init(a,b),uh.init(a,b),a.unwrap=()=>a._zod.def.innerType});function wn(a){return new wm({type:"promise",innerType:a})}let wo=hi("ZodCustom",(a,b)=>{kE.init(a,b),uh.init(a,b)});function wp(a,b){let c=new i$({check:"custom",...mx.normalizeParams(b)});return c._zod.check=a,c}function wq(a,b){return mq(wo,a??(()=>!0),b)}function wr(a,b={}){return mr(wo,a,b)}function ws(a,b){let c=wp(b=>(b.addIssue=a=>{"string"==typeof a?b.issues.push(mx.issue(a,b.value,c._zod.def)):(a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=b.value),a.inst??(a.inst=c),a.continue??(a.continue=!c._zod.def.abort),b.issues.push(mx.issue(a)))},a(b.value,b)),b);return c}function wt(a,b={error:`Input not instance of ${a.name}`}){let c=new wo({type:"custom",check:"custom",fn:b=>b instanceof a,abort:!0,...mx.normalizeParams(b)});return c._zod.bag.Class=a,c}let wu=(...a)=>ms({Pipe:we,Boolean:u7,String:uj,Transform:vX},...a);function wv(a){let b=wl(()=>vC([uk(a),u0(),u8(),vj(),vv(b),vK(uk(),b)]));return b}function ww(a,b){return wf(vY(a),b)}let wx={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"},wy=Object.freeze({status:"aborted"});function wz(a){hm({customError:a})}function wA(){return hm().customError}function wB(a){return kP(uj,a)}function wC(a){return lg(u_,a)}function wD(a){return ln(u7,a)}function wE(a){return lp(u9,a)}function wF(a){return lA(vs,a)}a.s(["NEVER",0,wy,"ZodIssueCode",0,wx,"getErrorMap",()=>wA,"setErrorMap",()=>wz],988924),a.s(["bigint",()=>wE,"boolean",()=>wD,"date",()=>wF,"number",()=>wC,"string",()=>wB],609477),hm(kH()),a.s([],862241),a.i(862241),a.i(974116),a.i(231994),a.i(295449),a.i(585726),a.i(537571),a.i(909920),a.i(530112);var wG=mx,wH=a.i(780743);a.i(604663),a.s(["ar",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},b={regex:"",email:" ",url:"",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:"  ISO",time:"  ISO",duration:"  ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:"   IPv4",cidrv6:"   IPv6",base64:"  base64-encoded",base64url:"  base64url-encoded",json_string:"   JSON",e164:"   E.164",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return`  :   ${c.expected}    ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`  :   ${hQ(c.values[0])}`;return`  :     : ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`   :    ${c.origin??""} ${b} ${c.maximum.toString()} ${d.unit??""}`;return`  :    ${c.origin??""} ${b} ${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`  :   ${c.origin}   ${b} ${c.minimum.toString()} ${d.unit}`;return`  :   ${c.origin}   ${b} ${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`  :     "${c.prefix}"`;if("ends_with"===c.format)return`  :     "${c.suffix}"`;if("includes"===c.format)return`  :    "${c.includes}"`;if("regex"===c.format)return`  :     ${c.pattern}`;return`${b[c.format]??c.format}  `;case"not_multiple_of":return`  :      ${c.divisor}`;case"unrecognized_keys":return`${c.keys.length>1?"":""} ${c.keys.length>1?"":""}: ${ht(c.keys," ")}`;case"invalid_key":return`    ${c.origin}`;case"invalid_union":default:return"  ";case"invalid_element":return`    ${c.origin}`}})}},"az",0,function(){let a,b;return{localeError:(a={string:{unit:"simvol",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"element",verb:"olmaldr"},set:{unit:"element",verb:"olmaldr"}},b={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},c=>{switch(c.code){case"invalid_type":return`Yanl dyr: g\xf6zlniln ${c.expected}, daxil olan ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Yanl dyr: g\xf6zlniln ${hQ(c.values[0])}`;return`Yanl se\xe7im: aadaklardan biri olmaldr: ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`\xc7ox b\xf6y\xfck: g\xf6zlniln ${c.origin??"dyr"} ${b}${c.maximum.toString()} ${d.unit??"element"}`;return`\xc7ox b\xf6y\xfck: g\xf6zlniln ${c.origin??"dyr"} ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`\xc7ox ki\xe7ik: g\xf6zlniln ${c.origin} ${b}${c.minimum.toString()} ${d.unit}`;return`\xc7ox ki\xe7ik: g\xf6zlniln ${c.origin} ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Yanl mtn: "${c.prefix}" il balamaldr`;if("ends_with"===c.format)return`Yanl mtn: "${c.suffix}" il bitmlidir`;if("includes"===c.format)return`Yanl mtn: "${c.includes}" daxil olmaldr`;if("regex"===c.format)return`Yanl mtn: ${c.pattern} ablonuna uyun olmaldr`;return`Yanl ${b[c.format]??c.format}`;case"not_multiple_of":return`Yanl dd: ${c.divisor} il b\xf6l\xfcn biln olmaldr`;case"unrecognized_keys":return`Tannmayan a\xe7ar${c.keys.length>1?"lar":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`${c.origin} daxilind yanl a\xe7ar`;case"invalid_union":return"Yanl dyr";case"invalid_element":return`${c.origin} daxilind yanl dyr`;default:return`Yanl dyr`}})}},"be",0,function(){let a,b;return{localeError:(a={string:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""}},b={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return` :  ${c.expected},  ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"";case"object":if(Array.isArray(a))return"";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return` :  ${hQ(c.values[0])}`;return` :    ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d){let a=kG(Number(c.maximum),d.unit.one,d.unit.few,d.unit.many);return` : ,  ${c.origin??""}  ${d.verb} ${b}${c.maximum.toString()} ${a}`}return` : ,  ${c.origin??""}   ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d){let a=kG(Number(c.minimum),d.unit.one,d.unit.few,d.unit.many);return` : ,  ${c.origin}  ${d.verb} ${b}${c.minimum.toString()} ${a}`}return` : ,  ${c.origin}   ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return` :    "${c.prefix}"`;if("ends_with"===c.format)return` :    "${c.suffix}"`;if("includes"===c.format)return` :   "${c.includes}"`;if("regex"===c.format)return` :    ${c.pattern}`;return` ${b[c.format]??c.format}`;case"not_multiple_of":return` :    ${c.divisor}`;case"unrecognized_keys":return` ${c.keys.length>1?"":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`   ${c.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${c.origin}`;default:return` `}})}},"ca",0,function(){let a,b;return{localeError:(a={string:{unit:"carcters",verb:"contenir"},file:{unit:"bytes",verb:"contenir"},array:{unit:"elements",verb:"contenir"},set:{unit:"elements",verb:"contenir"}},b={regex:"entrada",email:"adrea electrnica",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i hora ISO",date:"data ISO",time:"hora ISO",duration:"durada ISO",ipv4:"adrea IPv4",ipv6:"adrea IPv6",cidrv4:"rang IPv4",cidrv6:"rang IPv6",base64:"cadena codificada en base64",base64url:"cadena codificada en base64url",json_string:"cadena JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},c=>{switch(c.code){case"invalid_type":return`Tipus inv\xe0lid: s'esperava ${c.expected}, s'ha rebut ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Valor inv\xe0lid: s'esperava ${hQ(c.values[0])}`;return`Opci\xf3 inv\xe0lida: s'esperava una de ${ht(c.values," o ")}`;case"too_big":{let b=c.inclusive?"com a mxim":"menys de",d=a[c.origin]??null;if(d)return`Massa gran: s'esperava que ${c.origin??"el valor"} contingu\xe9s ${b} ${c.maximum.toString()} ${d.unit??"elements"}`;return`Massa gran: s'esperava que ${c.origin??"el valor"} fos ${b} ${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?"com a mnim":"ms de",d=a[c.origin]??null;if(d)return`Massa petit: s'esperava que ${c.origin} contingu\xe9s ${b} ${c.minimum.toString()} ${d.unit}`;return`Massa petit: s'esperava que ${c.origin} fos ${b} ${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Format inv\xe0lid: ha de comen\xe7ar amb "${c.prefix}"`;if("ends_with"===c.format)return`Format inv\xe0lid: ha d'acabar amb "${c.suffix}"`;if("includes"===c.format)return`Format inv\xe0lid: ha d'incloure "${c.includes}"`;if("regex"===c.format)return`Format inv\xe0lid: ha de coincidir amb el patr\xf3 ${c.pattern}`;return`Format inv\xe0lid per a ${b[c.format]??c.format}`;case"not_multiple_of":return`N\xfamero inv\xe0lid: ha de ser m\xfaltiple de ${c.divisor}`;case"unrecognized_keys":return`Clau${c.keys.length>1?"s":""} no reconeguda${c.keys.length>1?"s":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`Clau inv\xe0lida a ${c.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Element inv\xe0lid a ${c.origin}`;default:return`Entrada inv\xe0lida`}})}},"cs",0,function(){let a,b;return{localeError:(a={string:{unit:"znak",verb:"mt"},file:{unit:"bajt",verb:"mt"},array:{unit:"prvk",verb:"mt"},set:{unit:"prvk",verb:"mt"}},b={regex:"regulrn vraz",email:"e-mailov adresa",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"datum a as ve formtu ISO",date:"datum ve formtu ISO",time:"as ve formtu ISO",duration:"doba trvn ISO",ipv4:"IPv4 adresa",ipv6:"IPv6 adresa",cidrv4:"rozsah IPv4",cidrv6:"rozsah IPv6",base64:"etzec zakdovan ve formtu base64",base64url:"etzec zakdovan ve formtu base64url",json_string:"etzec ve formtu JSON",e164:"slo E.164",jwt:"JWT",template_literal:"vstup"},c=>{switch(c.code){case"invalid_type":return`Neplatn\xfd vstup: oek\xe1v\xe1no ${c.expected}, obdreno ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"slo";case"string":return"etzec";case"boolean":return"boolean";case"bigint":return"bigint";case"function":return"funkce";case"symbol":return"symbol";case"undefined":return"undefined";case"object":if(Array.isArray(a))return"pole";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Neplatn\xfd vstup: oek\xe1v\xe1no ${hQ(c.values[0])}`;return`Neplatn\xe1 monost: oek\xe1v\xe1na jedna z hodnot ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Hodnota je p\xedli velk\xe1: ${c.origin??"hodnota"} mus\xed m\xedt ${b}${c.maximum.toString()} ${d.unit??"prvk"}`;return`Hodnota je p\xedli velk\xe1: ${c.origin??"hodnota"} mus\xed b\xfdt ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Hodnota je p\xedli mal\xe1: ${c.origin??"hodnota"} mus\xed m\xedt ${b}${c.minimum.toString()} ${d.unit??"prvk"}`;return`Hodnota je p\xedli mal\xe1: ${c.origin??"hodnota"} mus\xed b\xfdt ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Neplatn\xfd etzec: mus\xed za\xednat na "${c.prefix}"`;if("ends_with"===c.format)return`Neplatn\xfd etzec: mus\xed konit na "${c.suffix}"`;if("includes"===c.format)return`Neplatn\xfd etzec: mus\xed obsahovat "${c.includes}"`;if("regex"===c.format)return`Neplatn\xfd etzec: mus\xed odpov\xeddat vzoru ${c.pattern}`;return`Neplatn\xfd form\xe1t ${b[c.format]??c.format}`;case"not_multiple_of":return`Neplatn\xe9 \xedslo: mus\xed b\xfdt n\xe1sobkem ${c.divisor}`;case"unrecognized_keys":return`Nezn\xe1m\xe9 kl\xede: ${ht(c.keys,", ")}`;case"invalid_key":return`Neplatn\xfd kl\xed v ${c.origin}`;case"invalid_union":return"Neplatn vstup";case"invalid_element":return`Neplatn\xe1 hodnota v ${c.origin}`;default:return`Neplatn\xfd vstup`}})}},"de",0,function(){let a,b;return{localeError:(a={string:{unit:"Zeichen",verb:"zu haben"},file:{unit:"Bytes",verb:"zu haben"},array:{unit:"Elemente",verb:"zu haben"},set:{unit:"Elemente",verb:"zu haben"}},b={regex:"Eingabe",email:"E-Mail-Adresse",url:"URL",emoji:"Emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-Datum und -Uhrzeit",date:"ISO-Datum",time:"ISO-Uhrzeit",duration:"ISO-Dauer",ipv4:"IPv4-Adresse",ipv6:"IPv6-Adresse",cidrv4:"IPv4-Bereich",cidrv6:"IPv6-Bereich",base64:"Base64-codierter String",base64url:"Base64-URL-codierter String",json_string:"JSON-String",e164:"E.164-Nummer",jwt:"JWT",template_literal:"Eingabe"},c=>{switch(c.code){case"invalid_type":return`Ung\xfcltige Eingabe: erwartet ${c.expected}, erhalten ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"Zahl";case"object":if(Array.isArray(a))return"Array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Ung\xfcltige Eingabe: erwartet ${hQ(c.values[0])}`;return`Ung\xfcltige Option: erwartet eine von ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Zu gro\xdf: erwartet, dass ${c.origin??"Wert"} ${b}${c.maximum.toString()} ${d.unit??"Elemente"} hat`;return`Zu gro\xdf: erwartet, dass ${c.origin??"Wert"} ${b}${c.maximum.toString()} ist`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Zu klein: erwartet, dass ${c.origin} ${b}${c.minimum.toString()} ${d.unit} hat`;return`Zu klein: erwartet, dass ${c.origin} ${b}${c.minimum.toString()} ist`}case"invalid_format":if("starts_with"===c.format)return`Ung\xfcltiger String: muss mit "${c.prefix}" beginnen`;if("ends_with"===c.format)return`Ung\xfcltiger String: muss mit "${c.suffix}" enden`;if("includes"===c.format)return`Ung\xfcltiger String: muss "${c.includes}" enthalten`;if("regex"===c.format)return`Ung\xfcltiger String: muss dem Muster ${c.pattern} entsprechen`;return`Ung\xfcltig: ${b[c.format]??c.format}`;case"not_multiple_of":return`Ung\xfcltige Zahl: muss ein Vielfaches von ${c.divisor} sein`;case"unrecognized_keys":return`${c.keys.length>1?"Unbekannte Schlssel":"Unbekannter Schlssel"}: ${ht(c.keys,", ")}`;case"invalid_key":return`Ung\xfcltiger Schl\xfcssel in ${c.origin}`;case"invalid_union":return"Ungltige Eingabe";case"invalid_element":return`Ung\xfcltiger Wert in ${c.origin}`;default:return`Ung\xfcltige Eingabe`}})}},"en",0,kH,"es",0,function(){let a,b;return{localeError:(a={string:{unit:"caracteres",verb:"tener"},file:{unit:"bytes",verb:"tener"},array:{unit:"elementos",verb:"tener"},set:{unit:"elementos",verb:"tener"}},b={regex:"entrada",email:"direccin de correo electrnico",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"fecha y hora ISO",date:"fecha ISO",time:"hora ISO",duration:"duracin ISO",ipv4:"direccin IPv4",ipv6:"direccin IPv6",cidrv4:"rango IPv4",cidrv6:"rango IPv6",base64:"cadena codificada en base64",base64url:"URL codificada en base64",json_string:"cadena JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},c=>{switch(c.code){case"invalid_type":return`Entrada inv\xe1lida: se esperaba ${c.expected}, recibido ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"nmero";case"object":if(Array.isArray(a))return"arreglo";if(null===a)return"nulo";if(Object.getPrototypeOf(a)!==Object.prototype)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Entrada inv\xe1lida: se esperaba ${hQ(c.values[0])}`;return`Opci\xf3n inv\xe1lida: se esperaba una de ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Demasiado grande: se esperaba que ${c.origin??"valor"} tuviera ${b}${c.maximum.toString()} ${d.unit??"elementos"}`;return`Demasiado grande: se esperaba que ${c.origin??"valor"} fuera ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Demasiado peque\xf1o: se esperaba que ${c.origin} tuviera ${b}${c.minimum.toString()} ${d.unit}`;return`Demasiado peque\xf1o: se esperaba que ${c.origin} fuera ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Cadena inv\xe1lida: debe comenzar con "${c.prefix}"`;if("ends_with"===c.format)return`Cadena inv\xe1lida: debe terminar en "${c.suffix}"`;if("includes"===c.format)return`Cadena inv\xe1lida: debe incluir "${c.includes}"`;if("regex"===c.format)return`Cadena inv\xe1lida: debe coincidir con el patr\xf3n ${c.pattern}`;return`Inv\xe1lido ${b[c.format]??c.format}`;case"not_multiple_of":return`N\xfamero inv\xe1lido: debe ser m\xfaltiplo de ${c.divisor}`;case"unrecognized_keys":return`Llave${c.keys.length>1?"s":""} desconocida${c.keys.length>1?"s":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`Llave inv\xe1lida en ${c.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Valor inv\xe1lido en ${c.origin}`;default:return`Entrada inv\xe1lida`}})}},"fa",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},b={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ",date:" ",time:" ",duration:"  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return` :  ${c.expected}  ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"";case"object":if(Array.isArray(a))return"";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}  `;case"invalid_value":if(1===c.values.length)return` :  ${hQ(c.values[0])} `;return` :    ${ht(c.values,"|")} `;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return` : ${c.origin??""}  ${b}${c.maximum.toString()} ${d.unit??""} `;return` : ${c.origin??""}  ${b}${c.maximum.toString()} `}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return` : ${c.origin}  ${b}${c.minimum.toString()} ${d.unit} `;return` : ${c.origin}  ${b}${c.minimum.toString()} `}case"invalid_format":if("starts_with"===c.format)return` :   "${c.prefix}"  `;if("ends_with"===c.format)return` :   "${c.suffix}"  `;if("includes"===c.format)return` :   "${c.includes}" `;if("regex"===c.format)return` :    ${c.pattern}   `;return`${b[c.format]??c.format} `;case"not_multiple_of":return` :   ${c.divisor} `;case"unrecognized_keys":return`${c.keys.length>1?"":""} : ${ht(c.keys,", ")}`;case"invalid_key":return`   ${c.origin}`;case"invalid_union":default:return` `;case"invalid_element":return`   ${c.origin}`}})}},"fi",0,function(){let a,b;return{localeError:(a={string:{unit:"merkki",subject:"merkkijonon"},file:{unit:"tavua",subject:"tiedoston"},array:{unit:"alkiota",subject:"listan"},set:{unit:"alkiota",subject:"joukon"},number:{unit:"",subject:"luvun"},bigint:{unit:"",subject:"suuren kokonaisluvun"},int:{unit:"",subject:"kokonaisluvun"},date:{unit:"",subject:"pivmrn"}},b={regex:"snnllinen lauseke",email:"shkpostiosoite",url:"URL-osoite",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-aikaleima",date:"ISO-pivmr",time:"ISO-aika",duration:"ISO-kesto",ipv4:"IPv4-osoite",ipv6:"IPv6-osoite",cidrv4:"IPv4-alue",cidrv6:"IPv6-alue",base64:"base64-koodattu merkkijono",base64url:"base64url-koodattu merkkijono",json_string:"JSON-merkkijono",e164:"E.164-luku",jwt:"JWT",template_literal:"templaattimerkkijono"},c=>{switch(c.code){case"invalid_type":return`Virheellinen tyyppi: odotettiin ${c.expected}, oli ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Virheellinen sy\xf6te: t\xe4ytyy olla ${hQ(c.values[0])}`;return`Virheellinen valinta: t\xe4ytyy olla yksi seuraavista: ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Liian suuri: ${d.subject} t\xe4ytyy olla ${b}${c.maximum.toString()} ${d.unit}`.trim();return`Liian suuri: arvon t\xe4ytyy olla ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Liian pieni: ${d.subject} t\xe4ytyy olla ${b}${c.minimum.toString()} ${d.unit}`.trim();return`Liian pieni: arvon t\xe4ytyy olla ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Virheellinen sy\xf6te: t\xe4ytyy alkaa "${c.prefix}"`;if("ends_with"===c.format)return`Virheellinen sy\xf6te: t\xe4ytyy loppua "${c.suffix}"`;if("includes"===c.format)return`Virheellinen sy\xf6te: t\xe4ytyy sis\xe4lt\xe4\xe4 "${c.includes}"`;if("regex"===c.format)return`Virheellinen sy\xf6te: t\xe4ytyy vastata s\xe4\xe4nn\xf6llist\xe4 lauseketta ${c.pattern}`;return`Virheellinen ${b[c.format]??c.format}`;case"not_multiple_of":return`Virheellinen luku: t\xe4ytyy olla luvun ${c.divisor} monikerta`;case"unrecognized_keys":return`${c.keys.length>1?"Tuntemattomat avaimet":"Tuntematon avain"}: ${ht(c.keys,", ")}`;case"invalid_key":return"Virheellinen avain tietueessa";case"invalid_union":return"Virheellinen unioni";case"invalid_element":return"Virheellinen arvo joukossa";default:return`Virheellinen sy\xf6te`}})}},"fr",0,function(){let a,b;return{localeError:(a={string:{unit:"caractres",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"lments",verb:"avoir"},set:{unit:"lments",verb:"avoir"}},b={regex:"entre",email:"adresse e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date et heure ISO",date:"date ISO",time:"heure ISO",duration:"dure ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chane encode en base64",base64url:"chane encode en base64url",json_string:"chane JSON",e164:"numro E.164",jwt:"JWT",template_literal:"entre"},c=>{switch(c.code){case"invalid_type":return`Entr\xe9e invalide : ${c.expected} attendu, ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"nombre";case"object":if(Array.isArray(a))return"tableau";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)} re\xe7u`;case"invalid_value":if(1===c.values.length)return`Entr\xe9e invalide : ${hQ(c.values[0])} attendu`;return`Option invalide : une valeur parmi ${ht(c.values,"|")} attendue`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Trop grand : ${c.origin??"valeur"} doit ${d.verb} ${b}${c.maximum.toString()} ${d.unit??"lment(s)"}`;return`Trop grand : ${c.origin??"valeur"} doit \xeatre ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Trop petit : ${c.origin} doit ${d.verb} ${b}${c.minimum.toString()} ${d.unit}`;return`Trop petit : ${c.origin} doit \xeatre ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Cha\xeene invalide : doit commencer par "${c.prefix}"`;if("ends_with"===c.format)return`Cha\xeene invalide : doit se terminer par "${c.suffix}"`;if("includes"===c.format)return`Cha\xeene invalide : doit inclure "${c.includes}"`;if("regex"===c.format)return`Cha\xeene invalide : doit correspondre au mod\xe8le ${c.pattern}`;return`${b[c.format]??c.format} invalide`;case"not_multiple_of":return`Nombre invalide : doit \xeatre un multiple de ${c.divisor}`;case"unrecognized_keys":return`Cl\xe9${c.keys.length>1?"s":""} non reconnue${c.keys.length>1?"s":""} : ${ht(c.keys,", ")}`;case"invalid_key":return`Cl\xe9 invalide dans ${c.origin}`;case"invalid_union":return"Entre invalide";case"invalid_element":return`Valeur invalide dans ${c.origin}`;default:return`Entr\xe9e invalide`}})}},"frCA",0,function(){let a,b;return{localeError:(a={string:{unit:"caractres",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"lments",verb:"avoir"},set:{unit:"lments",verb:"avoir"}},b={regex:"entre",email:"adresse courriel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date-heure ISO",date:"date ISO",time:"heure ISO",duration:"dure ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chane encode en base64",base64url:"chane encode en base64url",json_string:"chane JSON",e164:"numro E.164",jwt:"JWT",template_literal:"entre"},c=>{switch(c.code){case"invalid_type":return`Entr\xe9e invalide : attendu ${c.expected}, re\xe7u ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Entr\xe9e invalide : attendu ${hQ(c.values[0])}`;return`Option invalide : attendu l'une des valeurs suivantes ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"":"<",d=a[c.origin]??null;if(d)return`Trop grand : attendu que ${c.origin??"la valeur"} ait ${b}${c.maximum.toString()} ${d.unit}`;return`Trop grand : attendu que ${c.origin??"la valeur"} soit ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?"":">",d=a[c.origin]??null;if(d)return`Trop petit : attendu que ${c.origin} ait ${b}${c.minimum.toString()} ${d.unit}`;return`Trop petit : attendu que ${c.origin} soit ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Cha\xeene invalide : doit commencer par "${c.prefix}"`;if("ends_with"===c.format)return`Cha\xeene invalide : doit se terminer par "${c.suffix}"`;if("includes"===c.format)return`Cha\xeene invalide : doit inclure "${c.includes}"`;if("regex"===c.format)return`Cha\xeene invalide : doit correspondre au motif ${c.pattern}`;return`${b[c.format]??c.format} invalide`;case"not_multiple_of":return`Nombre invalide : doit \xeatre un multiple de ${c.divisor}`;case"unrecognized_keys":return`Cl\xe9${c.keys.length>1?"s":""} non reconnue${c.keys.length>1?"s":""} : ${ht(c.keys,", ")}`;case"invalid_key":return`Cl\xe9 invalide dans ${c.origin}`;case"invalid_union":return"Entre invalide";case"invalid_element":return`Valeur invalide dans ${c.origin}`;default:return`Entr\xe9e invalide`}})}},"he",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},b={regex:"",email:" ",url:" ",emoji:"'",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ISO",date:" ISO",time:" ISO",duration:"  ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:"  64",base64url:"  64  ",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return`  :  ${c.expected},  ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`  :  ${hQ(c.values[0])}`;return`  :     ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return` : ${c.origin??"value"}   ${b}${c.maximum.toString()} ${d.unit??"elements"}`;return` : ${c.origin??"value"}   ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return` : ${c.origin}   ${b}${c.minimum.toString()} ${d.unit}`;return` : ${c.origin}   ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`  :   "${c.prefix}"`;if("ends_with"===c.format)return`  :    "${c.suffix}"`;if("includes"===c.format)return`  :   "${c.includes}"`;if("regex"===c.format)return`  :    ${c.pattern}`;return`${b[c.format]??c.format}  `;case"not_multiple_of":return`  :     ${c.divisor}`;case"unrecognized_keys":return`${c.keys.length>1?"":""}  ${c.keys.length>1?"":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`   ${c.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${c.origin}`;default:return`  `}})}},"hu",0,function(){let a,b;return{localeError:(a={string:{unit:"karakter",verb:"legyen"},file:{unit:"byte",verb:"legyen"},array:{unit:"elem",verb:"legyen"},set:{unit:"elem",verb:"legyen"}},b={regex:"bemenet",email:"email cm",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO idblyeg",date:"ISO dtum",time:"ISO id",duration:"ISO idintervallum",ipv4:"IPv4 cm",ipv6:"IPv6 cm",cidrv4:"IPv4 tartomny",cidrv6:"IPv6 tartomny",base64:"base64-kdolt string",base64url:"base64url-kdolt string",json_string:"JSON string",e164:"E.164 szm",jwt:"JWT",template_literal:"bemenet"},c=>{switch(c.code){case"invalid_type":return`\xc9rv\xe9nytelen bemenet: a v\xe1rt \xe9rt\xe9k ${c.expected}, a kapott \xe9rt\xe9k ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"szm";case"object":if(Array.isArray(a))return"tmb";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`\xc9rv\xe9nytelen bemenet: a v\xe1rt \xe9rt\xe9k ${hQ(c.values[0])}`;return`\xc9rv\xe9nytelen opci\xf3: valamelyik \xe9rt\xe9k v\xe1rt ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`T\xfal nagy: ${c.origin??"rtk"} m\xe9rete t\xfal nagy ${b}${c.maximum.toString()} ${d.unit??"elem"}`;return`T\xfal nagy: a bemeneti \xe9rt\xe9k ${c.origin??"rtk"} t\xfal nagy: ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`T\xfal kicsi: a bemeneti \xe9rt\xe9k ${c.origin} m\xe9rete t\xfal kicsi ${b}${c.minimum.toString()} ${d.unit}`;return`T\xfal kicsi: a bemeneti \xe9rt\xe9k ${c.origin} t\xfal kicsi ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`\xc9rv\xe9nytelen string: "${c.prefix}" \xe9rt\xe9kkel kell kezddnie`;if("ends_with"===c.format)return`\xc9rv\xe9nytelen string: "${c.suffix}" \xe9rt\xe9kkel kell v\xe9gzdnie`;if("includes"===c.format)return`\xc9rv\xe9nytelen string: "${c.includes}" \xe9rt\xe9ket kell tartalmaznia`;if("regex"===c.format)return`\xc9rv\xe9nytelen string: ${c.pattern} mint\xe1nak kell megfelelnie`;return`\xc9rv\xe9nytelen ${b[c.format]??c.format}`;case"not_multiple_of":return`\xc9rv\xe9nytelen sz\xe1m: ${c.divisor} t\xf6bbsz\xf6r\xf6s\xe9nek kell lennie`;case"unrecognized_keys":return`Ismeretlen kulcs${c.keys.length>1?"s":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`\xc9rv\xe9nytelen kulcs ${c.origin}`;case"invalid_union":return"rvnytelen bemenet";case"invalid_element":return`\xc9rv\xe9nytelen \xe9rt\xe9k: ${c.origin}`;default:return`\xc9rv\xe9nytelen bemenet`}})}},"id",0,function(){let a,b;return{localeError:(a={string:{unit:"karakter",verb:"memiliki"},file:{unit:"byte",verb:"memiliki"},array:{unit:"item",verb:"memiliki"},set:{unit:"item",verb:"memiliki"}},b={regex:"input",email:"alamat email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tanggal dan waktu format ISO",date:"tanggal format ISO",time:"jam format ISO",duration:"durasi format ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"rentang alamat IPv4",cidrv6:"rentang alamat IPv6",base64:"string dengan enkode base64",base64url:"string dengan enkode base64url",json_string:"string JSON",e164:"angka E.164",jwt:"JWT",template_literal:"input"},c=>{switch(c.code){case"invalid_type":return`Input tidak valid: diharapkan ${c.expected}, diterima ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Input tidak valid: diharapkan ${hQ(c.values[0])}`;return`Pilihan tidak valid: diharapkan salah satu dari ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Terlalu besar: diharapkan ${c.origin??"value"} memiliki ${b}${c.maximum.toString()} ${d.unit??"elemen"}`;return`Terlalu besar: diharapkan ${c.origin??"value"} menjadi ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Terlalu kecil: diharapkan ${c.origin} memiliki ${b}${c.minimum.toString()} ${d.unit}`;return`Terlalu kecil: diharapkan ${c.origin} menjadi ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`String tidak valid: harus dimulai dengan "${c.prefix}"`;if("ends_with"===c.format)return`String tidak valid: harus berakhir dengan "${c.suffix}"`;if("includes"===c.format)return`String tidak valid: harus menyertakan "${c.includes}"`;if("regex"===c.format)return`String tidak valid: harus sesuai pola ${c.pattern}`;return`${b[c.format]??c.format} tidak valid`;case"not_multiple_of":return`Angka tidak valid: harus kelipatan dari ${c.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali ${c.keys.length>1?"s":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`Kunci tidak valid di ${c.origin}`;case"invalid_union":default:return"Input tidak valid";case"invalid_element":return`Nilai tidak valid di ${c.origin}`}})}},"it",0,function(){let a,b;return{localeError:(a={string:{unit:"caratteri",verb:"avere"},file:{unit:"byte",verb:"avere"},array:{unit:"elementi",verb:"avere"},set:{unit:"elementi",verb:"avere"}},b={regex:"input",email:"indirizzo email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e ora ISO",date:"data ISO",time:"ora ISO",duration:"durata ISO",ipv4:"indirizzo IPv4",ipv6:"indirizzo IPv6",cidrv4:"intervallo IPv4",cidrv6:"intervallo IPv6",base64:"stringa codificata in base64",base64url:"URL codificata in base64",json_string:"stringa JSON",e164:"numero E.164",jwt:"JWT",template_literal:"input"},c=>{switch(c.code){case"invalid_type":return`Input non valido: atteso ${c.expected}, ricevuto ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"numero";case"object":if(Array.isArray(a))return"vettore";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Input non valido: atteso ${hQ(c.values[0])}`;return`Opzione non valida: atteso uno tra ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Troppo grande: ${c.origin??"valore"} deve avere ${b}${c.maximum.toString()} ${d.unit??"elementi"}`;return`Troppo grande: ${c.origin??"valore"} deve essere ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Troppo piccolo: ${c.origin} deve avere ${b}${c.minimum.toString()} ${d.unit}`;return`Troppo piccolo: ${c.origin} deve essere ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Stringa non valida: deve iniziare con "${c.prefix}"`;if("ends_with"===c.format)return`Stringa non valida: deve terminare con "${c.suffix}"`;if("includes"===c.format)return`Stringa non valida: deve includere "${c.includes}"`;if("regex"===c.format)return`Stringa non valida: deve corrispondere al pattern ${c.pattern}`;return`Invalid ${b[c.format]??c.format}`;case"not_multiple_of":return`Numero non valido: deve essere un multiplo di ${c.divisor}`;case"unrecognized_keys":return`Chiav${c.keys.length>1?"i":"e"} non riconosciut${c.keys.length>1?"e":"a"}: ${ht(c.keys,", ")}`;case"invalid_key":return`Chiave non valida in ${c.origin}`;case"invalid_union":default:return"Input non valido";case"invalid_element":return`Valore non valido in ${c.origin}`}})}},"ja",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},b={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return`: ${c.expected}${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"";case"object":if(Array.isArray(a))return"";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`: ${hQ(c.values[0])}`;return`: ${ht(c.values,"")}`;case"too_big":{let b=c.inclusive?"":"",d=a[c.origin]??null;if(d)return`: ${c.origin??""}${c.maximum.toString()}${d.unit??""}${b}`;return`: ${c.origin??""}${c.maximum.toString()}${b}`}case"too_small":{let b=c.inclusive?"":"",d=a[c.origin]??null;if(d)return`: ${c.origin}${c.minimum.toString()}${d.unit}${b}`;return`: ${c.origin}${c.minimum.toString()}${b}`}case"invalid_format":if("starts_with"===c.format)return`: "${c.prefix}"`;if("ends_with"===c.format)return`: "${c.suffix}"`;if("includes"===c.format)return`: "${c.includes}"`;if("regex"===c.format)return`: ${c.pattern}`;return`${b[c.format]??c.format}`;case"not_multiple_of":return`: ${c.divisor}`;case"unrecognized_keys":return`${c.keys.length>1?"":""}: ${ht(c.keys,"")}`;case"invalid_key":return`${c.origin}`;case"invalid_union":return"";case"invalid_element":return`${c.origin}`;default:return``}})}},"kh",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},b={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:" base64",base64url:" base64url",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return`  ${c.expected}  ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?" (NaN)":"";case"object":if(Array.isArray(a))return" (Array)";if(null===a)return" (null)";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`  ${hQ(c.values[0])}`;return`  ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`  ${c.origin??""} ${b} ${c.maximum.toString()} ${d.unit??""}`;return`  ${c.origin??""} ${b} ${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`  ${c.origin} ${b} ${c.minimum.toString()} ${d.unit}`;return`  ${c.origin} ${b} ${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`  "${c.prefix}"`;if("ends_with"===c.format)return`  "${c.suffix}"`;if("includes"===c.format)return`  "${c.includes}"`;if("regex"===c.format)return`  ${c.pattern}`;return` ${b[c.format]??c.format}`;case"not_multiple_of":return`  ${c.divisor}`;case"unrecognized_keys":return` ${ht(c.keys,", ")}`;case"invalid_key":return` ${c.origin}`;case"invalid_union":default:return``;case"invalid_element":return` ${c.origin}`}})}},"ko",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:"to have"},file:{unit:"",verb:"to have"},array:{unit:"",verb:"to have"},set:{unit:"",verb:"to have"}},b={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64  ",base64url:"base64url  ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return` :   ${c.expected},   ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return` :  ${hQ(c.values[0])}  `;return` : ${ht(c.values," ")}   `;case"too_big":{let b=c.inclusive?"":"",d=""===b?" ":" ",e=a[c.origin]??null,f=e?.unit??"";if(e)return`${c.origin??""}  : ${c.maximum.toString()}${f} ${b}${d}`;return`${c.origin??""}  : ${c.maximum.toString()} ${b}${d}`}case"too_small":{let b=c.inclusive?"":"",d=""===b?" ":" ",e=a[c.origin]??null,f=e?.unit??"";if(e)return`${c.origin??""}  : ${c.minimum.toString()}${f} ${b}${d}`;return`${c.origin??""}  : ${c.minimum.toString()} ${b}${d}`}case"invalid_format":if("starts_with"===c.format)return` : "${c.prefix}"()  `;if("ends_with"===c.format)return` : "${c.suffix}"()  `;if("includes"===c.format)return` : "${c.includes}"()  `;if("regex"===c.format)return` :  ${c.pattern}   `;return` ${b[c.format]??c.format}`;case"not_multiple_of":return` : ${c.divisor}  `;case"unrecognized_keys":return`   : ${ht(c.keys,", ")}`;case"invalid_key":return` : ${c.origin}`;case"invalid_union":default:return` `;case"invalid_element":return` : ${c.origin}`}})}},"mk",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},b={regex:"",email:"  -",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64- ",base64url:"base64url- ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return` :   ${c.expected},  ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"";case"object":if(Array.isArray(a))return"";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Invalid input: expected ${hQ(c.values[0])}`;return` :    ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return` :   ${c.origin??""}   ${b}${c.maximum.toString()} ${d.unit??""}`;return` :   ${c.origin??""}   ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return` :   ${c.origin}   ${b}${c.minimum.toString()} ${d.unit}`;return` :   ${c.origin}   ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return` :     "${c.prefix}"`;if("ends_with"===c.format)return` :     "${c.suffix}"`;if("includes"===c.format)return` :    "${c.includes}"`;if("regex"===c.format)return` :      ${c.pattern}`;return`Invalid ${b[c.format]??c.format}`;case"not_multiple_of":return` :      ${c.divisor}`;case"unrecognized_keys":return`${c.keys.length>1?" ":" "}: ${ht(c.keys,", ")}`;case"invalid_key":return`   ${c.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${c.origin}`;default:return` `}})}},"ms",0,function(){let a,b;return{localeError:(a={string:{unit:"aksara",verb:"mempunyai"},file:{unit:"bait",verb:"mempunyai"},array:{unit:"elemen",verb:"mempunyai"},set:{unit:"elemen",verb:"mempunyai"}},b={regex:"input",email:"alamat e-mel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tarikh masa ISO",date:"tarikh ISO",time:"masa ISO",duration:"tempoh ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"julat IPv4",cidrv6:"julat IPv6",base64:"string dikodkan base64",base64url:"string dikodkan base64url",json_string:"string JSON",e164:"nombor E.164",jwt:"JWT",template_literal:"input"},c=>{switch(c.code){case"invalid_type":return`Input tidak sah: dijangka ${c.expected}, diterima ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"nombor";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Input tidak sah: dijangka ${hQ(c.values[0])}`;return`Pilihan tidak sah: dijangka salah satu daripada ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Terlalu besar: dijangka ${c.origin??"nilai"} ${d.verb} ${b}${c.maximum.toString()} ${d.unit??"elemen"}`;return`Terlalu besar: dijangka ${c.origin??"nilai"} adalah ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Terlalu kecil: dijangka ${c.origin} ${d.verb} ${b}${c.minimum.toString()} ${d.unit}`;return`Terlalu kecil: dijangka ${c.origin} adalah ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`String tidak sah: mesti bermula dengan "${c.prefix}"`;if("ends_with"===c.format)return`String tidak sah: mesti berakhir dengan "${c.suffix}"`;if("includes"===c.format)return`String tidak sah: mesti mengandungi "${c.includes}"`;if("regex"===c.format)return`String tidak sah: mesti sepadan dengan corak ${c.pattern}`;return`${b[c.format]??c.format} tidak sah`;case"not_multiple_of":return`Nombor tidak sah: perlu gandaan ${c.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali: ${ht(c.keys,", ")}`;case"invalid_key":return`Kunci tidak sah dalam ${c.origin}`;case"invalid_union":default:return"Input tidak sah";case"invalid_element":return`Nilai tidak sah dalam ${c.origin}`}})}},"nl",0,function(){let a,b;return{localeError:(a={string:{unit:"tekens"},file:{unit:"bytes"},array:{unit:"elementen"},set:{unit:"elementen"}},b={regex:"invoer",email:"emailadres",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum en tijd",date:"ISO datum",time:"ISO tijd",duration:"ISO duur",ipv4:"IPv4-adres",ipv6:"IPv6-adres",cidrv4:"IPv4-bereik",cidrv6:"IPv6-bereik",base64:"base64-gecodeerde tekst",base64url:"base64 URL-gecodeerde tekst",json_string:"JSON string",e164:"E.164-nummer",jwt:"JWT",template_literal:"invoer"},c=>{switch(c.code){case"invalid_type":return`Ongeldige invoer: verwacht ${c.expected}, ontving ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"getal";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Ongeldige invoer: verwacht ${hQ(c.values[0])}`;return`Ongeldige optie: verwacht \xe9\xe9n van ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Te lang: verwacht dat ${c.origin??"waarde"} ${b}${c.maximum.toString()} ${d.unit??"elementen"} bevat`;return`Te lang: verwacht dat ${c.origin??"waarde"} ${b}${c.maximum.toString()} is`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Te kort: verwacht dat ${c.origin} ${b}${c.minimum.toString()} ${d.unit} bevat`;return`Te kort: verwacht dat ${c.origin} ${b}${c.minimum.toString()} is`}case"invalid_format":if("starts_with"===c.format)return`Ongeldige tekst: moet met "${c.prefix}" beginnen`;if("ends_with"===c.format)return`Ongeldige tekst: moet op "${c.suffix}" eindigen`;if("includes"===c.format)return`Ongeldige tekst: moet "${c.includes}" bevatten`;if("regex"===c.format)return`Ongeldige tekst: moet overeenkomen met patroon ${c.pattern}`;return`Ongeldig: ${b[c.format]??c.format}`;case"not_multiple_of":return`Ongeldig getal: moet een veelvoud van ${c.divisor} zijn`;case"unrecognized_keys":return`Onbekende key${c.keys.length>1?"s":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`Ongeldige key in ${c.origin}`;case"invalid_union":default:return"Ongeldige invoer";case"invalid_element":return`Ongeldige waarde in ${c.origin}`}})}},"no",0,function(){let a,b;return{localeError:(a={string:{unit:"tegn",verb:" ha"},file:{unit:"bytes",verb:" ha"},array:{unit:"elementer",verb:" inneholde"},set:{unit:"elementer",verb:" inneholde"}},b={regex:"input",email:"e-postadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslett",date:"ISO-dato",time:"ISO-klokkeslett",duration:"ISO-varighet",ipv4:"IPv4-omrde",ipv6:"IPv6-omrde",cidrv4:"IPv4-spekter",cidrv6:"IPv6-spekter",base64:"base64-enkodet streng",base64url:"base64url-enkodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},c=>{switch(c.code){case"invalid_type":return`Ugyldig input: forventet ${c.expected}, fikk ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"tall";case"object":if(Array.isArray(a))return"liste";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Ugyldig verdi: forventet ${hQ(c.values[0])}`;return`Ugyldig valg: forventet en av ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`For stor(t): forventet ${c.origin??"value"} til \xe5 ha ${b}${c.maximum.toString()} ${d.unit??"elementer"}`;return`For stor(t): forventet ${c.origin??"value"} til \xe5 ha ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`For lite(n): forventet ${c.origin} til \xe5 ha ${b}${c.minimum.toString()} ${d.unit}`;return`For lite(n): forventet ${c.origin} til \xe5 ha ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Ugyldig streng: m\xe5 starte med "${c.prefix}"`;if("ends_with"===c.format)return`Ugyldig streng: m\xe5 ende med "${c.suffix}"`;if("includes"===c.format)return`Ugyldig streng: m\xe5 inneholde "${c.includes}"`;if("regex"===c.format)return`Ugyldig streng: m\xe5 matche m\xf8nsteret ${c.pattern}`;return`Ugyldig ${b[c.format]??c.format}`;case"not_multiple_of":return`Ugyldig tall: m\xe5 v\xe6re et multiplum av ${c.divisor}`;case"unrecognized_keys":return`${c.keys.length>1?"Ukjente nkler":"Ukjent nkkel"}: ${ht(c.keys,", ")}`;case"invalid_key":return`Ugyldig n\xf8kkel i ${c.origin}`;case"invalid_union":default:return"Ugyldig input";case"invalid_element":return`Ugyldig verdi i ${c.origin}`}})}},"ota",0,function(){let a,b;return{localeError:(a={string:{unit:"harf",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"unsur",verb:"olmaldr"},set:{unit:"unsur",verb:"olmaldr"}},b={regex:"giren",email:"epostagh",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO hengm",date:"ISO tarihi",time:"ISO zaman",duration:"ISO mddeti",ipv4:"IPv4 nin",ipv6:"IPv6 nin",cidrv4:"IPv4 menzili",cidrv6:"IPv6 menzili",base64:"base64-ifreli metin",base64url:"base64url-ifreli metin",json_string:"JSON metin",e164:"E.164 says",jwt:"JWT",template_literal:"giren"},c=>{switch(c.code){case"invalid_type":return`F\xe2sit giren: umulan ${c.expected}, alnan ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"numara";case"object":if(Array.isArray(a))return"saf";if(null===a)return"gayb";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`F\xe2sit giren: umulan ${hQ(c.values[0])}`;return`F\xe2sit tercih: m\xfbteberler ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Fazla b\xfcy\xfck: ${c.origin??"value"}, ${b}${c.maximum.toString()} ${d.unit??"elements"} sahip olmalyd.`;return`Fazla b\xfcy\xfck: ${c.origin??"value"}, ${b}${c.maximum.toString()} olmalyd.`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Fazla k\xfc\xe7\xfck: ${c.origin}, ${b}${c.minimum.toString()} ${d.unit} sahip olmalyd.`;return`Fazla k\xfc\xe7\xfck: ${c.origin}, ${b}${c.minimum.toString()} olmalyd.`}case"invalid_format":if("starts_with"===c.format)return`F\xe2sit metin: "${c.prefix}" ile balamal.`;if("ends_with"===c.format)return`F\xe2sit metin: "${c.suffix}" ile bitmeli.`;if("includes"===c.format)return`F\xe2sit metin: "${c.includes}" ihtiv\xe2 etmeli.`;if("regex"===c.format)return`F\xe2sit metin: ${c.pattern} nakna uymal.`;return`F\xe2sit ${b[c.format]??c.format}`;case"not_multiple_of":return`F\xe2sit say: ${c.divisor} kat olmalyd.`;case"unrecognized_keys":return`Tannmayan anahtar ${c.keys.length>1?"s":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`${c.origin} i\xe7in tannmayan anahtar var.`;case"invalid_union":return"Giren tannamad.";case"invalid_element":return`${c.origin} i\xe7in tannmayan kymet var.`;default:return`Kymet tannamad.`}})}},"pl",0,function(){let a,b;return{localeError:(a={string:{unit:"znakw",verb:"mie"},file:{unit:"bajtw",verb:"mie"},array:{unit:"elementw",verb:"mie"},set:{unit:"elementw",verb:"mie"}},b={regex:"wyraenie",email:"adres email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i godzina w formacie ISO",date:"data w formacie ISO",time:"godzina w formacie ISO",duration:"czas trwania ISO",ipv4:"adres IPv4",ipv6:"adres IPv6",cidrv4:"zakres IPv4",cidrv6:"zakres IPv6",base64:"cig znakw zakodowany w formacie base64",base64url:"cig znakw zakodowany w formacie base64url",json_string:"cig znakw w formacie JSON",e164:"liczba E.164",jwt:"JWT",template_literal:"wejcie"},c=>{switch(c.code){case"invalid_type":return`Nieprawidowe dane wejciowe: oczekiwano ${c.expected}, otrzymano ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"liczba";case"object":if(Array.isArray(a))return"tablica";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Nieprawidowe dane wejciowe: oczekiwano ${hQ(c.values[0])}`;return`Nieprawidowa opcja: oczekiwano jednej z wartoci ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Za dua warto: oczekiwano, e ${c.origin??"warto"} bdzie mie ${b}${c.maximum.toString()} ${d.unit??"elementw"}`;return`Zbyt du(y/a/e): oczekiwano, e ${c.origin??"warto"} bdzie wynosi ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Za maa warto: oczekiwano, e ${c.origin??"warto"} bdzie mie ${b}${c.minimum.toString()} ${d.unit??"elementw"}`;return`Zbyt ma(y/a/e): oczekiwano, e ${c.origin??"warto"} bdzie wynosi ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Nieprawidowy cig znak\xf3w: musi zaczyna si od "${c.prefix}"`;if("ends_with"===c.format)return`Nieprawidowy cig znak\xf3w: musi koczy si na "${c.suffix}"`;if("includes"===c.format)return`Nieprawidowy cig znak\xf3w: musi zawiera "${c.includes}"`;if("regex"===c.format)return`Nieprawidowy cig znak\xf3w: musi odpowiada wzorcowi ${c.pattern}`;return`Nieprawidow(y/a/e) ${b[c.format]??c.format}`;case"not_multiple_of":return`Nieprawidowa liczba: musi by wielokrotnoci ${c.divisor}`;case"unrecognized_keys":return`Nierozpoznane klucze${c.keys.length>1?"s":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`Nieprawidowy klucz w ${c.origin}`;case"invalid_union":return"Nieprawidowe dane wejciowe";case"invalid_element":return`Nieprawidowa warto w ${c.origin}`;default:return`Nieprawidowe dane wejciowe`}})}},"ps",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},b={regex:"",email:"",url:"  ",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ",date:"",time:"",duration:"",ipv4:" IPv4 ",ipv6:" IPv6 ",cidrv4:" IPv4 ",cidrv6:" IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:" E.164 ",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return` :  ${c.expected} ,  ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"";case"object":if(Array.isArray(a))return"";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}  `;case"invalid_value":if(1===c.values.length)return` :  ${hQ(c.values[0])} `;return` :    ${ht(c.values,"|")}  `;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return` : ${c.origin??""}  ${b}${c.maximum.toString()} ${d.unit??""} `;return` : ${c.origin??""}  ${b}${c.maximum.toString()} `}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return` : ${c.origin}  ${b}${c.minimum.toString()} ${d.unit} `;return` : ${c.origin}  ${b}${c.minimum.toString()} `}case"invalid_format":if("starts_with"===c.format)return` :   "${c.prefix}"   `;if("ends_with"===c.format)return` :   "${c.suffix}"    `;if("includes"===c.format)return` :  "${c.includes}" `;if("regex"===c.format)return` :   ${c.pattern}   `;return`${b[c.format]??c.format}  `;case"not_multiple_of":return` :   ${c.divisor}  `;case"unrecognized_keys":return` ${c.keys.length>1?"":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`   ${c.origin} `;case"invalid_union":default:return` `;case"invalid_element":return`   ${c.origin} `}})}},"pt",0,function(){let a,b;return{localeError:(a={string:{unit:"caracteres",verb:"ter"},file:{unit:"bytes",verb:"ter"},array:{unit:"itens",verb:"ter"},set:{unit:"itens",verb:"ter"}},b={regex:"padro",email:"endereo de e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e hora ISO",date:"data ISO",time:"hora ISO",duration:"durao ISO",ipv4:"endereo IPv4",ipv6:"endereo IPv6",cidrv4:"faixa de IPv4",cidrv6:"faixa de IPv6",base64:"texto codificado em base64",base64url:"URL codificada em base64",json_string:"texto JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},c=>{switch(c.code){case"invalid_type":return`Tipo inv\xe1lido: esperado ${c.expected}, recebido ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"nmero";case"object":if(Array.isArray(a))return"array";if(null===a)return"nulo";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Entrada inv\xe1lida: esperado ${hQ(c.values[0])}`;return`Op\xe7\xe3o inv\xe1lida: esperada uma das ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Muito grande: esperado que ${c.origin??"valor"} tivesse ${b}${c.maximum.toString()} ${d.unit??"elementos"}`;return`Muito grande: esperado que ${c.origin??"valor"} fosse ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Muito pequeno: esperado que ${c.origin} tivesse ${b}${c.minimum.toString()} ${d.unit}`;return`Muito pequeno: esperado que ${c.origin} fosse ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Texto inv\xe1lido: deve come\xe7ar com "${c.prefix}"`;if("ends_with"===c.format)return`Texto inv\xe1lido: deve terminar com "${c.suffix}"`;if("includes"===c.format)return`Texto inv\xe1lido: deve incluir "${c.includes}"`;if("regex"===c.format)return`Texto inv\xe1lido: deve corresponder ao padr\xe3o ${c.pattern}`;return`${b[c.format]??c.format} inv\xe1lido`;case"not_multiple_of":return`N\xfamero inv\xe1lido: deve ser m\xfaltiplo de ${c.divisor}`;case"unrecognized_keys":return`Chave${c.keys.length>1?"s":""} desconhecida${c.keys.length>1?"s":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`Chave inv\xe1lida em ${c.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Valor inv\xe1lido em ${c.origin}`;default:return`Campo inv\xe1lido`}})}},"ru",0,function(){let a,b;return{localeError:(a={string:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""}},b={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return` :  ${c.expected},  ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"";case"object":if(Array.isArray(a))return"";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return` :  ${hQ(c.values[0])}`;return` :    ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d){let a=kI(Number(c.maximum),d.unit.one,d.unit.few,d.unit.many);return`  : ,  ${c.origin??""}   ${b}${c.maximum.toString()} ${a}`}return`  : ,  ${c.origin??""}  ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d){let a=kI(Number(c.minimum),d.unit.one,d.unit.few,d.unit.many);return`  : ,  ${c.origin}   ${b}${c.minimum.toString()} ${a}`}return`  : ,  ${c.origin}  ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return` :    "${c.prefix}"`;if("ends_with"===c.format)return` :    "${c.suffix}"`;if("includes"===c.format)return` :   "${c.includes}"`;if("regex"===c.format)return` :    ${c.pattern}`;return` ${b[c.format]??c.format}`;case"not_multiple_of":return` :    ${c.divisor}`;case"unrecognized_keys":return`${c.keys.length>1?"":""} ${c.keys.length>1?"":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`   ${c.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${c.origin}`;default:return`  `}})}},"sl",0,function(){let a,b;return{localeError:(a={string:{unit:"znakov",verb:"imeti"},file:{unit:"bajtov",verb:"imeti"},array:{unit:"elementov",verb:"imeti"},set:{unit:"elementov",verb:"imeti"}},b={regex:"vnos",email:"e-potni naslov",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum in as",date:"ISO datum",time:"ISO as",duration:"ISO trajanje",ipv4:"IPv4 naslov",ipv6:"IPv6 naslov",cidrv4:"obseg IPv4",cidrv6:"obseg IPv6",base64:"base64 kodiran niz",base64url:"base64url kodiran niz",json_string:"JSON niz",e164:"E.164 tevilka",jwt:"JWT",template_literal:"vnos"},c=>{switch(c.code){case"invalid_type":return`Neveljaven vnos: priakovano ${c.expected}, prejeto ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"tevilo";case"object":if(Array.isArray(a))return"tabela";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Neveljaven vnos: priakovano ${hQ(c.values[0])}`;return`Neveljavna monost: priakovano eno izmed ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Preveliko: priakovano, da bo ${c.origin??"vrednost"} imelo ${b}${c.maximum.toString()} ${d.unit??"elementov"}`;return`Preveliko: priakovano, da bo ${c.origin??"vrednost"} ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Premajhno: priakovano, da bo ${c.origin} imelo ${b}${c.minimum.toString()} ${d.unit}`;return`Premajhno: priakovano, da bo ${c.origin} ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Neveljaven niz: mora se zaeti z "${c.prefix}"`;if("ends_with"===c.format)return`Neveljaven niz: mora se konati z "${c.suffix}"`;if("includes"===c.format)return`Neveljaven niz: mora vsebovati "${c.includes}"`;if("regex"===c.format)return`Neveljaven niz: mora ustrezati vzorcu ${c.pattern}`;return`Neveljaven ${b[c.format]??c.format}`;case"not_multiple_of":return`Neveljavno tevilo: mora biti vekratnik ${c.divisor}`;case"unrecognized_keys":return`Neprepoznan${c.keys.length>1?"i kljui":" klju"}: ${ht(c.keys,", ")}`;case"invalid_key":return`Neveljaven klju v ${c.origin}`;case"invalid_union":default:return"Neveljaven vnos";case"invalid_element":return`Neveljavna vrednost v ${c.origin}`}})}},"sv",0,function(){let a,b;return{localeError:(a={string:{unit:"tecken",verb:"att ha"},file:{unit:"bytes",verb:"att ha"},array:{unit:"objekt",verb:"att innehlla"},set:{unit:"objekt",verb:"att innehlla"}},b={regex:"reguljrt uttryck",email:"e-postadress",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datum och tid",date:"ISO-datum",time:"ISO-tid",duration:"ISO-varaktighet",ipv4:"IPv4-intervall",ipv6:"IPv6-intervall",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodad strng",base64url:"base64url-kodad strng",json_string:"JSON-strng",e164:"E.164-nummer",jwt:"JWT",template_literal:"mall-literal"},c=>{switch(c.code){case"invalid_type":return`Ogiltig inmatning: f\xf6rv\xe4ntat ${c.expected}, fick ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"antal";case"object":if(Array.isArray(a))return"lista";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Ogiltig inmatning: f\xf6rv\xe4ntat ${hQ(c.values[0])}`;return`Ogiltigt val: f\xf6rv\xe4ntade en av ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`F\xf6r stor(t): f\xf6rv\xe4ntade ${c.origin??"vrdet"} att ha ${b}${c.maximum.toString()} ${d.unit??"element"}`;return`F\xf6r stor(t): f\xf6rv\xe4ntat ${c.origin??"vrdet"} att ha ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`F\xf6r lite(t): f\xf6rv\xe4ntade ${c.origin??"vrdet"} att ha ${b}${c.minimum.toString()} ${d.unit}`;return`F\xf6r lite(t): f\xf6rv\xe4ntade ${c.origin??"vrdet"} att ha ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Ogiltig str\xe4ng: m\xe5ste b\xf6rja med "${c.prefix}"`;if("ends_with"===c.format)return`Ogiltig str\xe4ng: m\xe5ste sluta med "${c.suffix}"`;if("includes"===c.format)return`Ogiltig str\xe4ng: m\xe5ste inneh\xe5lla "${c.includes}"`;if("regex"===c.format)return`Ogiltig str\xe4ng: m\xe5ste matcha m\xf6nstret "${c.pattern}"`;return`Ogiltig(t) ${b[c.format]??c.format}`;case"not_multiple_of":return`Ogiltigt tal: m\xe5ste vara en multipel av ${c.divisor}`;case"unrecognized_keys":return`${c.keys.length>1?"Oknda nycklar":"Oknd nyckel"}: ${ht(c.keys,", ")}`;case"invalid_key":return`Ogiltig nyckel i ${c.origin??"vrdet"}`;case"invalid_union":default:return"Ogiltig input";case"invalid_element":return`Ogiltigt v\xe4rde i ${c.origin??"vrdet"}`}})}},"ta",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},b={regex:"",email:" ",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO  ",date:"ISO ",time:"ISO ",duration:"ISO  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:"input"},c=>{switch(c.code){case"invalid_type":return` :  ${c.expected},  ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?" ":"";case"object":if(Array.isArray(a))return"";if(null===a)return"";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return` :  ${hQ(c.values[0])}`;return` :  ${ht(c.values,"|")}  `;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return` :  ${c.origin??""} ${b}${c.maximum.toString()} ${d.unit??""}   `;return` :  ${c.origin??""} ${b}${c.maximum.toString()}   `}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return` :  ${c.origin} ${b}${c.minimum.toString()} ${d.unit}   `;return` :  ${c.origin} ${b}${c.minimum.toString()}   `}case"invalid_format":if("starts_with"===c.format)return` : "${c.prefix}"   `;if("ends_with"===c.format)return` : "${c.suffix}"   `;if("includes"===c.format)return` : "${c.includes}"   `;if("regex"===c.format)return` : ${c.pattern}   `;return` ${b[c.format]??c.format}`;case"not_multiple_of":return` : ${c.divisor}    `;case"unrecognized_keys":return`  ${c.keys.length>1?"":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`${c.origin}   `;case"invalid_union":return" ";case"invalid_element":return`${c.origin}   `;default:return` `}})}},"th",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},b={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:" ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IP  IPv4",cidrv6:" IP  IPv6",base64:" Base64",base64url:" Base64  URL",json_string:" JSON",e164:" (E.164)",jwt:" JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return`:  ${c.expected}  ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?" (NaN)":"";case"object":if(Array.isArray(a))return" (Array)";if(null===a)return" (null)";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`:  ${hQ(c.values[0])}`;return`:  ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"":"",d=a[c.origin]??null;if(d)return`: ${c.origin??""} ${b} ${c.maximum.toString()} ${d.unit??""}`;return`: ${c.origin??""} ${b} ${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?"":"",d=a[c.origin]??null;if(d)return`: ${c.origin} ${b} ${c.minimum.toString()} ${d.unit}`;return`: ${c.origin} ${b} ${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`:  "${c.prefix}"`;if("ends_with"===c.format)return`:  "${c.suffix}"`;if("includes"===c.format)return`:  "${c.includes}" `;if("regex"===c.format)return`:  ${c.pattern}`;return`: ${b[c.format]??c.format}`;case"not_multiple_of":return`:  ${c.divisor} `;case"unrecognized_keys":return`: ${ht(c.keys,", ")}`;case"invalid_key":return` ${c.origin}`;case"invalid_union":return": ";case"invalid_element":return` ${c.origin}`;default:return``}})}},"tr",0,function(){let a,b;return{localeError:(a={string:{unit:"karakter",verb:"olmal"},file:{unit:"bayt",verb:"olmal"},array:{unit:"e",verb:"olmal"},set:{unit:"e",verb:"olmal"}},b={regex:"girdi",email:"e-posta adresi",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO tarih ve saat",date:"ISO tarih",time:"ISO saat",duration:"ISO sre",ipv4:"IPv4 adresi",ipv6:"IPv6 adresi",cidrv4:"IPv4 aral",cidrv6:"IPv6 aral",base64:"base64 ile ifrelenmi metin",base64url:"base64url ile ifrelenmi metin",json_string:"JSON dizesi",e164:"E.164 says",jwt:"JWT",template_literal:"ablon dizesi"},c=>{switch(c.code){case"invalid_type":return`Ge\xe7ersiz deer: beklenen ${c.expected}, alnan ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Ge\xe7ersiz deer: beklenen ${hQ(c.values[0])}`;return`Ge\xe7ersiz se\xe7enek: aadakilerden biri olmal: ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`\xc7ok b\xfcy\xfck: beklenen ${c.origin??"deer"} ${b}${c.maximum.toString()} ${d.unit??"e"}`;return`\xc7ok b\xfcy\xfck: beklenen ${c.origin??"deer"} ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`\xc7ok k\xfc\xe7\xfck: beklenen ${c.origin} ${b}${c.minimum.toString()} ${d.unit}`;return`\xc7ok k\xfc\xe7\xfck: beklenen ${c.origin} ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Ge\xe7ersiz metin: "${c.prefix}" ile balamal`;if("ends_with"===c.format)return`Ge\xe7ersiz metin: "${c.suffix}" ile bitmeli`;if("includes"===c.format)return`Ge\xe7ersiz metin: "${c.includes}" i\xe7ermeli`;if("regex"===c.format)return`Ge\xe7ersiz metin: ${c.pattern} desenine uymal`;return`Ge\xe7ersiz ${b[c.format]??c.format}`;case"not_multiple_of":return`Ge\xe7ersiz say: ${c.divisor} ile tam b\xf6l\xfcnebilmeli`;case"unrecognized_keys":return`Tannmayan anahtar${c.keys.length>1?"lar":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`${c.origin} i\xe7inde ge\xe7ersiz anahtar`;case"invalid_union":return"Geersiz deer";case"invalid_element":return`${c.origin} i\xe7inde ge\xe7ersiz deer`;default:return`Ge\xe7ersiz deer`}})}},"ua",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},b={regex:" ",email:"  ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:"   base64",base64url:"   base64url",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:" "},c=>{switch(c.code){case"invalid_type":return`  :  ${c.expected},  ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"";case"object":if(Array.isArray(a))return"";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`  :  ${hQ(c.values[0])}`;return` :    ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return` : ,  ${c.origin??""} ${d.verb} ${b}${c.maximum.toString()} ${d.unit??""}`;return` : ,  ${c.origin??""}  ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return` : ,  ${c.origin} ${d.verb} ${b}${c.minimum.toString()} ${d.unit}`;return` : ,  ${c.origin}  ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return` :    "${c.prefix}"`;if("ends_with"===c.format)return` :    "${c.suffix}"`;if("includes"===c.format)return` :   "${c.includes}"`;if("regex"===c.format)return` :    ${c.pattern}`;return` ${b[c.format]??c.format}`;case"not_multiple_of":return` :    ${c.divisor}`;case"unrecognized_keys":return` ${c.keys.length>1?"":""}: ${ht(c.keys,", ")}`;case"invalid_key":return`   ${c.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${c.origin}`;default:return`  `}})}},"ur",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},b={regex:" ",email:"  ",url:"  ",emoji:"",uuid:"   ",uuidv4:"     4",uuidv6:"     6",nanoid:"  ",guid:"   ",cuid:"   ",cuid2:"    2",ulid:"   ",xid:"  ",ksuid:"    ",datetime:"    ",date:"   ",time:"   ",duration:"   ",ipv4:"   4 ",ipv6:"   6 ",cidrv4:"   4 ",cidrv6:"   6 ",base64:" 64   ",base64url:" 64      ",json_string:"    ",e164:" 164 ",jwt:"  ",template_literal:" "},c=>{switch(c.code){case"invalid_type":return`  : ${c.expected}   ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"";case"object":if(Array.isArray(a))return"";if(null===a)return"";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}  `;case"invalid_value":if(1===c.values.length)return`  : ${hQ(c.values[0])}  `;return` : ${ht(c.values,"|")}     `;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return` : ${c.origin??""}  ${b}${c.maximum.toString()} ${d.unit??""}   `;return` : ${c.origin??""}  ${b}${c.maximum.toString()}   `}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return` : ${c.origin}  ${b}${c.minimum.toString()} ${d.unit}   `;return` : ${c.origin}  ${b}${c.minimum.toString()}   `}case"invalid_format":if("starts_with"===c.format)return` : "${c.prefix}"    `;if("ends_with"===c.format)return` : "${c.suffix}"    `;if("includes"===c.format)return` : "${c.includes}"   `;if("regex"===c.format)return` :  ${c.pattern}    `;return` ${b[c.format]??c.format}`;case"not_multiple_of":return` : ${c.divisor}    `;case"unrecognized_keys":return`   ${c.keys.length>1?"":""}: ${ht(c.keys," ")}`;case"invalid_key":return`${c.origin}   `;case"invalid_union":return"  ";case"invalid_element":return`${c.origin}   `;default:return`  `}})}},"vi",0,function(){let a,b;return{localeError:(a={string:{unit:"k t",verb:"c"},file:{unit:"byte",verb:"c"},array:{unit:"phn t",verb:"c"},set:{unit:"phn t",verb:"c"}},b={regex:"u vo",email:"a ch email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ngy gi ISO",date:"ngy ISO",time:"gi ISO",duration:"khong thi gian ISO",ipv4:"a ch IPv4",ipv6:"a ch IPv6",cidrv4:"di IPv4",cidrv6:"di IPv6",base64:"chui m ha base64",base64url:"chui m ha base64url",json_string:"chui JSON",e164:"s E.164",jwt:"JWT",template_literal:"u vo"},c=>{switch(c.code){case"invalid_type":return`u v\xe0o kh\xf4ng hp l: mong i ${c.expected}, nhn c ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"s";case"object":if(Array.isArray(a))return"mng";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`u v\xe0o kh\xf4ng hp l: mong i ${hQ(c.values[0])}`;return`T\xf9y chn kh\xf4ng hp l: mong i mt trong c\xe1c gi\xe1 tr ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Qu\xe1 ln: mong i ${c.origin??"gi tr"} ${d.verb} ${b}${c.maximum.toString()} ${d.unit??"phn t"}`;return`Qu\xe1 ln: mong i ${c.origin??"gi tr"} ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Qu\xe1 nh: mong i ${c.origin} ${d.verb} ${b}${c.minimum.toString()} ${d.unit}`;return`Qu\xe1 nh: mong i ${c.origin} ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Chui kh\xf4ng hp l: phi bt u bng "${c.prefix}"`;if("ends_with"===c.format)return`Chui kh\xf4ng hp l: phi kt th\xfac bng "${c.suffix}"`;if("includes"===c.format)return`Chui kh\xf4ng hp l: phi bao gm "${c.includes}"`;if("regex"===c.format)return`Chui kh\xf4ng hp l: phi khp vi mu ${c.pattern}`;return`${b[c.format]??c.format} kh\xf4ng hp l`;case"not_multiple_of":return`S kh\xf4ng hp l: phi l\xe0 bi s ca ${c.divisor}`;case"unrecognized_keys":return`Kh\xf3a kh\xf4ng c nhn dng: ${ht(c.keys,", ")}`;case"invalid_key":return`Kh\xf3a kh\xf4ng hp l trong ${c.origin}`;case"invalid_union":return"u vo khng hp l";case"invalid_element":return`Gi\xe1 tr kh\xf4ng hp l trong ${c.origin}`;default:return`u v\xe0o kh\xf4ng hp l`}})}},"zhCN",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},b={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return` ${c.expected} ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"(NaN)":"";case"object":if(Array.isArray(a))return"";if(null===a)return"(null)";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return` ${hQ(c.values[0])}`;return` ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return` ${c.origin??""} ${b}${c.maximum.toString()} ${d.unit??""}`;return` ${c.origin??""} ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return` ${c.origin} ${b}${c.minimum.toString()} ${d.unit}`;return` ${c.origin} ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return` "${c.prefix}" `;if("ends_with"===c.format)return` "${c.suffix}" `;if("includes"===c.format)return` "${c.includes}"`;if("regex"===c.format)return` ${c.pattern}`;return`${b[c.format]??c.format}`;case"not_multiple_of":return` ${c.divisor} `;case"unrecognized_keys":return`(key): ${ht(c.keys,", ")}`;case"invalid_key":return`${c.origin} (key)`;case"invalid_union":return"";case"invalid_element":return`${c.origin} (value)`;default:return``}})}},"zhTW",0,function(){let a,b;return{localeError:(a={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},b={regex:"",email:"",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64 ",base64url:"base64url ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},c=>{switch(c.code){case"invalid_type":return` ${c.expected} ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return` ${hQ(c.values[0])}`;return` ${ht(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return` ${c.origin??""}  ${b}${c.maximum.toString()} ${d.unit??""}`;return` ${c.origin??""}  ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return` ${c.origin}  ${b}${c.minimum.toString()} ${d.unit}`;return` ${c.origin}  ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return` "${c.prefix}" `;if("ends_with"===c.format)return` "${c.suffix}" `;if("includes"===c.format)return` "${c.includes}"`;if("regex"===c.format)return` ${c.pattern}`;return` ${b[c.format]??c.format}`;case"not_multiple_of":return` ${c.divisor} `;case"unrecognized_keys":return`${c.keys.length>1?"":""}${ht(c.keys,"")}`;case"invalid_key":return`${c.origin} `;case"invalid_union":return"";case"invalid_element":return`${c.origin} `;default:return``}})}}],517918);var wI=a.i(517918);a.i(656075),a.i(963164),a.i(111018),a.i(504223),a.i(246794);var wJ=a.i(70101);a.s(["$ZodAny",0,jZ,"$ZodArray",0,j3,"$ZodAsyncError",()=>hk,"$ZodBase64",0,jL,"$ZodBase64URL",0,jN,"$ZodBigInt",0,jU,"$ZodBigIntFormat",0,jV,"$ZodBoolean",0,jT,"$ZodCIDRv4",0,jI,"$ZodCIDRv6",0,jJ,"$ZodCUID",0,jx,"$ZodCUID2",0,jy,"$ZodCatch",0,kv,"$ZodCheck",0,i$,"$ZodCheckBigIntFormat",0,i4,"$ZodCheckEndsWith",0,jh,"$ZodCheckGreaterThan",0,i1,"$ZodCheckIncludes",0,jf,"$ZodCheckLengthEquals",0,ja,"$ZodCheckLessThan",0,i0,"$ZodCheckLowerCase",0,jd,"$ZodCheckMaxLength",0,i8,"$ZodCheckMaxSize",0,i5,"$ZodCheckMimeType",0,jk,"$ZodCheckMinLength",0,i9,"$ZodCheckMinSize",0,i6,"$ZodCheckMultipleOf",0,i2,"$ZodCheckNumberFormat",0,i3,"$ZodCheckOverwrite",0,jl,"$ZodCheckProperty",0,jj,"$ZodCheckRegex",0,jc,"$ZodCheckSizeEquals",0,i7,"$ZodCheckStartsWith",0,jg,"$ZodCheckStringFormat",0,jb,"$ZodCheckUpperCase",0,je,"$ZodCustom",0,kE,"$ZodDate",0,j1,"$ZodDefault",0,kp,"$ZodDiscriminatedUnion",0,j9,"$ZodE164",0,jO,"$ZodEmail",0,jt,"$ZodEmoji",0,jv,"$ZodEnum",0,kj,"$ZodError",0,h8,"$ZodFile",0,kl,"$ZodFunction",()=>mt,"$ZodGUID",0,jr,"$ZodIPv4",0,jG,"$ZodIPv6",0,jH,"$ZodISODate",0,jD,"$ZodISODateTime",0,jC,"$ZodISODuration",0,jF,"$ZodISOTime",0,jE,"$ZodIntersection",0,ka,"$ZodJWT",0,jQ,"$ZodKSUID",0,jB,"$ZodLazy",0,kD,"$ZodLiteral",0,kk,"$ZodMap",0,kf,"$ZodNaN",0,kw,"$ZodNanoID",0,jw,"$ZodNever",0,j_,"$ZodNonOptional",0,ks,"$ZodNull",0,jY,"$ZodNullable",0,ko,"$ZodNumber",0,jR,"$ZodNumberFormat",0,jS,"$ZodObject",0,j6,"$ZodOptional",0,kn,"$ZodPipe",0,kx,"$ZodPrefault",0,kr,"$ZodPromise",0,kC,"$ZodReadonly",0,kz,"$ZodRealError",0,h9,"$ZodRecord",0,ke,"$ZodRegistry",()=>kL,"$ZodSet",0,kh,"$ZodString",0,jp,"$ZodStringFormat",0,jq,"$ZodSuccess",0,ku,"$ZodSymbol",0,jW,"$ZodTemplateLiteral",0,kB,"$ZodTransform",0,km,"$ZodTuple",0,kc,"$ZodType",0,jo,"$ZodULID",0,jz,"$ZodURL",0,ju,"$ZodUUID",0,js,"$ZodUndefined",0,jX,"$ZodUnion",0,j8,"$ZodUnknown",0,j$,"$ZodVoid",0,j0,"$ZodXID",0,jA,"$brand",0,hj,"$constructor",()=>hi,"$input",0,kK,"$output",0,kJ,"Doc",()=>jm,"JSONSchema",0,wJ,"JSONSchemaGenerator",()=>mv,"TimePrecision",0,la,"_any",()=>lv,"_array",()=>l2,"_base64",()=>k6,"_base64url",()=>k7,"_bigint",()=>lo,"_boolean",()=>lm,"_catch",()=>mk,"_cidrv4",()=>k4,"_cidrv6",()=>k5,"_coercedBigint",()=>lp,"_coercedBoolean",()=>ln,"_coercedDate",()=>lA,"_coercedNumber",()=>lg,"_coercedString",()=>kP,"_cuid",()=>kZ,"_cuid2",()=>k$,"_custom",()=>mq,"_date",()=>lz,"_default",()=>mh,"_discriminatedUnion",()=>l4,"_e164",()=>k8,"_email",()=>kQ,"_emoji",()=>kX,"_endsWith",()=>lW,"_enum",()=>ma,"_file",()=>md,"_float32",()=>li,"_float64",()=>lj,"_gt",()=>lE,"_gte",()=>lF,"_guid",()=>kR,"_includes",()=>lU,"_int",()=>lh,"_int32",()=>lk,"_int64",()=>lq,"_intersection",()=>l5,"_ipv4",()=>k2,"_ipv6",()=>k3,"_isoDate",()=>lc,"_isoDateTime",()=>lb,"_isoDuration",()=>le,"_isoTime",()=>ld,"_jwt",()=>k9,"_ksuid",()=>k1,"_lazy",()=>mo,"_length",()=>lQ,"_literal",()=>mc,"_lowercase",()=>lS,"_lt",()=>lC,"_lte",()=>lD,"_map",()=>l8,"_max",()=>lD,"_maxLength",()=>lO,"_maxSize",()=>lL,"_mime",()=>lY,"_min",()=>lF,"_minLength",()=>lP,"_minSize",()=>lM,"_multipleOf",()=>lK,"_nan",()=>lB,"_nanoid",()=>kY,"_nativeEnum",()=>mb,"_negative",()=>lH,"_never",()=>lx,"_nonnegative",()=>lJ,"_nonoptional",()=>mi,"_nonpositive",()=>lI,"_normalize",()=>l$,"_null",()=>lu,"_nullable",()=>mg,"_number",()=>lf,"_optional",()=>mf,"_overwrite",()=>lZ,"_parse",0,ig,"_parseAsync",0,ii,"_pipe",()=>ml,"_positive",()=>lG,"_promise",()=>mp,"_property",()=>lX,"_readonly",()=>mm,"_record",()=>l7,"_refine",()=>mr,"_regex",()=>lR,"_safeParse",0,ik,"_safeParseAsync",0,im,"_set",()=>l9,"_size",()=>lN,"_startsWith",()=>lV,"_string",()=>kO,"_stringbool",()=>ms,"_success",()=>mj,"_symbol",()=>ls,"_templateLiteral",()=>mn,"_toLowerCase",()=>l0,"_toUpperCase",()=>l1,"_transform",()=>me,"_trim",()=>l_,"_tuple",()=>l6,"_uint32",()=>ll,"_uint64",()=>lr,"_ulid",()=>k_,"_undefined",()=>lt,"_union",()=>l3,"_unknown",()=>lw,"_uppercase",()=>lT,"_url",()=>kW,"_uuid",()=>kS,"_uuidv4",()=>kT,"_uuidv6",()=>kU,"_uuidv7",()=>kV,"_void",()=>ly,"_xid",()=>k0,"clone",()=>hN,"config",()=>hm,"flattenError",()=>ia,"formatError",()=>ib,"function",()=>mu,"globalConfig",0,hl,"globalRegistry",0,kN,"isValidBase64",()=>jK,"isValidBase64URL",()=>jM,"isValidJWT",()=>jP,"locales",0,wI,"parse",0,ih,"parseAsync",0,ij,"prettifyError",()=>ie,"regexes",0,wH,"registry",()=>kM,"safeParse",0,il,"safeParseAsync",0,io,"toDotPath",()=>id,"toJSONSchema",()=>mw,"treeifyError",()=>ic,"util",0,wG,"version",0,jn],54463);var wK=a.i(54463);a.i(175688),a.i(516374),a.s(["endsWith",()=>lW,"gt",()=>lE,"gte",()=>lF,"includes",()=>lU,"length",()=>lQ,"lowercase",()=>lS,"lt",()=>lC,"lte",()=>lD,"maxLength",()=>lO,"maxSize",()=>lL,"mime",()=>lY,"minLength",()=>lP,"minSize",()=>lM,"multipleOf",()=>lK,"negative",()=>lH,"nonnegative",()=>lJ,"nonpositive",()=>lI,"normalize",()=>l$,"overwrite",()=>lZ,"positive",()=>lG,"property",()=>lX,"regex",()=>lR,"size",()=>lN,"startsWith",()=>lV,"toLowerCase",()=>l0,"toUpperCase",()=>l1,"trim",()=>l_,"uppercase",()=>lT],170546),a.i(170546),a.i(797020),a.i(896353),a.i(988924),a.s(["$brand",0,hj,"NEVER",0,wy,"ZodIssueCode",0,wx,"config",()=>hm,"getErrorMap",()=>wA,"setErrorMap",()=>wz],322071),a.i(322071);var wL=a.i(340796),wM=a.i(609477);a.s(["$brand",0,hj,"$input",0,kK,"$output",0,kJ,"NEVER",0,wy,"TimePrecision",0,la,"ZodAny",0,vk,"ZodArray",0,vu,"ZodBase64",0,uT,"ZodBase64URL",0,uV,"ZodBigInt",0,u9,"ZodBigIntFormat",0,vb,"ZodBoolean",0,u7,"ZodCIDRv4",0,uP,"ZodCIDRv6",0,uR,"ZodCUID",0,uB,"ZodCUID2",0,uD,"ZodCatch",0,wa,"ZodCustom",0,wo,"ZodDate",0,vs,"ZodDefault",0,v2,"ZodDiscriminatedUnion",0,vD,"ZodE164",0,uX,"ZodEmail",0,um,"ZodEmoji",0,ux,"ZodEnum",0,vQ,"ZodError",0,ub,"ZodFile",0,vV,"ZodGUID",0,uo,"ZodIPv4",0,uL,"ZodIPv6",0,uN,"ZodISODate",0,t4,"ZodISODateTime",0,t2,"ZodISODuration",0,t8,"ZodISOTime",0,t6,"ZodIntersection",0,vF,"ZodIssueCode",0,wx,"ZodJWT",0,uZ,"ZodKSUID",0,uJ,"ZodLazy",0,wk,"ZodLiteral",0,vT,"ZodMap",0,vM,"ZodNaN",0,wc,"ZodNanoID",0,uz,"ZodNever",0,vo,"ZodNonOptional",0,v6,"ZodNull",0,vi,"ZodNullable",0,v_,"ZodNumber",0,u_,"ZodNumberFormat",0,u1,"ZodObject",0,vx,"ZodOptional",0,vZ,"ZodPipe",0,we,"ZodPrefault",0,v4,"ZodPromise",0,wm,"ZodReadonly",0,wg,"ZodRealError",0,uc,"ZodRecord",0,vJ,"ZodSet",0,vO,"ZodString",0,uj,"ZodStringFormat",0,ul,"ZodSuccess",0,v8,"ZodSymbol",0,ve,"ZodTemplateLiteral",0,wi,"ZodTransform",0,vX,"ZodTuple",0,vH,"ZodType",0,uh,"ZodULID",0,uF,"ZodURL",0,uv,"ZodUUID",0,uq,"ZodUndefined",0,vg,"ZodUnion",0,vB,"ZodUnknown",0,vm,"ZodVoid",0,vq,"ZodXID",0,uH,"_ZodString",0,ui,"_default",()=>v3,"any",()=>vl,"array",()=>vv,"base64",()=>uU,"base64url",()=>uW,"bigint",()=>va,"boolean",()=>u8,"catch",()=>wb,"check",()=>wp,"cidrv4",()=>uQ,"cidrv6",()=>uS,"clone",()=>hN,"coerce",0,wM,"config",()=>hm,"core",0,wK,"cuid",()=>uC,"cuid2",()=>uE,"custom",()=>wq,"date",()=>vt,"discriminatedUnion",()=>vE,"e164",()=>uY,"email",()=>un,"emoji",()=>uy,"endsWith",()=>lW,"enum",()=>vR,"file",()=>vW,"flattenError",()=>ia,"float32",()=>u3,"float64",()=>u4,"formatError",()=>ib,"function",()=>mu,"getErrorMap",()=>wA,"globalRegistry",0,kN,"gt",()=>lE,"gte",()=>lF,"guid",()=>up,"includes",()=>lU,"instanceof",()=>wt,"int",()=>u2,"int32",()=>u5,"int64",()=>vc,"intersection",()=>vG,"ipv4",()=>uM,"ipv6",()=>uO,"iso",0,wL,"json",()=>wv,"jwt",()=>u$,"keyof",()=>vw,"ksuid",()=>uK,"lazy",()=>wl,"length",()=>lQ,"literal",()=>vU,"locales",0,wI,"looseObject",()=>vA,"lowercase",()=>lS,"lt",()=>lC,"lte",()=>lD,"map",()=>vN,"maxLength",()=>lO,"maxSize",()=>lL,"mime",()=>lY,"minLength",()=>lP,"minSize",()=>lM,"multipleOf",()=>lK,"nan",()=>wd,"nanoid",()=>uA,"nativeEnum",()=>vS,"negative",()=>lH,"never",()=>vp,"nonnegative",()=>lJ,"nonoptional",()=>v7,"nonpositive",()=>lI,"normalize",()=>l$,"null",()=>vj,"nullable",()=>v0,"nullish",()=>v1,"number",()=>u0,"object",()=>vy,"optional",()=>v$,"overwrite",()=>lZ,"parse",0,ud,"parseAsync",0,ue,"partialRecord",()=>vL,"pipe",()=>wf,"positive",()=>lG,"prefault",()=>v5,"preprocess",()=>ww,"prettifyError",()=>ie,"promise",()=>wn,"property",()=>lX,"readonly",()=>wh,"record",()=>vK,"refine",()=>wr,"regex",()=>lR,"regexes",()=>wH,"registry",()=>kM,"safeParse",0,uf,"safeParseAsync",0,ug,"set",()=>vP,"setErrorMap",()=>wz,"size",()=>lN,"startsWith",()=>lV,"strictObject",()=>vz,"string",()=>uk,"stringbool",0,wu,"success",()=>v9,"superRefine",()=>ws,"symbol",()=>vf,"templateLiteral",()=>wj,"toJSONSchema",()=>mw,"toLowerCase",()=>l0,"toUpperCase",()=>l1,"transform",()=>vY,"treeifyError",()=>ic,"trim",()=>l_,"tuple",()=>vI,"uint32",()=>u6,"uint64",()=>vd,"ulid",()=>uG,"undefined",()=>vh,"union",()=>vC,"unknown",()=>vn,"uppercase",()=>lT,"url",()=>uw,"uuid",()=>ur,"uuidv4",()=>us,"uuidv6",()=>ut,"uuidv7",()=>uu,"void",()=>vr,"xid",()=>uI],960684);var wN=a.i(960684);a.s(["default",0,wN],413413),a.i(413413);dy({},{BaseToolkit:()=>wS,DynamicStructuredTool:()=>wR,DynamicTool:()=>wQ,StructuredTool:()=>wO,Tool:()=>wP,ToolInputParsingException:()=>eu,isLangChainTool:()=>qA,isRunnableToolLike:()=>qy,isStructuredTool:()=>qx,isStructuredToolParams:()=>qz,tool:()=>wT});var wO=class extends pz{extras;returnDirect=!1;verboseParsingErrors=!1;get lc_namespace(){return["langchain","tools"]}responseFormat="content";defaultConfig;constructor(a){super(a??{}),this.verboseParsingErrors=a?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=a?.responseFormat??this.responseFormat,this.defaultConfig=a?.defaultConfig??this.defaultConfig,this.metadata=a?.metadata??this.metadata,this.extras=a?.extras??this.extras}async invoke(a,b){let c,d=g5(g3(this.defaultConfig,b));return et(a)?(c=a.args,d={...d,toolCall:a}):c=a,this.call(c,d)}async call(a,b,c){let d,e,f,g,h,i=et(a)?a.args:a;if(mB(this.schema))try{d=await mG(this.schema,i)}catch(c){let b="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(b=`${b}
Details: ${c.message}`),mZ(c)&&(b=`${b}

${wN.prettifyError(c)}`),new eu(b,JSON.stringify(a))}else{let b=nL(i,this.schema);if(!b.valid){let c="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(c=`${c}
Details: ${b.errors.map(a=>`${a.keywordLocation}: ${a.error}`).join("\n")}`),new eu(c,JSON.stringify(a))}d=i}let j=gR(b),k=gY.configure(j.callbacks,this.callbacks,j.tags||c,this.tags,j.metadata,this.metadata,{verbose:this.verbose}),l=await k?.handleToolStart(this.toJSON(),"string"==typeof a?a:JSON.stringify(a),j.runId,void 0,void 0,void 0,j.runName);delete j.runId;try{e=await this._call(d,l,j)}catch(a){throw await l?.handleToolError(a),a}if("content_and_artifact"===this.responseFormat)if(Array.isArray(e)&&2===e.length)[f,g]=e;else throw Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(e)}`);else f=e;et(a)&&(h=a.id),!h&&j&&"object"==typeof j&&"toolCall"in j&&null!=j.toolCall&&"object"==typeof j.toolCall&&"id"in j.toolCall&&"string"==typeof j.toolCall.id&&(h=j.toolCall.id);let m=function(a){let{content:b,artifact:c,toolCallId:d,metadata:e}=a;return!d||em(b)?b:new en("string"==typeof b||Array.isArray(b)&&b.every(a=>"object"==typeof a)?{status:"success",content:b,artifact:c,tool_call_id:d,name:a.name,metadata:e}:{status:"success",content:function(a){try{return JSON.stringify(a,null,2)??""}catch(b){return`${a}`}}(b),artifact:c,tool_call_id:d,name:a.name,metadata:e})}({content:f,artifact:g,toolCallId:h,name:this.name,metadata:this.metadata});return await l?.handleToolEnd(m),m}},wP=class extends wO{schema=oF.z.object({input:oF.z.string().optional()}).transform(a=>a.input);constructor(a){super(a)}call(a,b){return super.call("string"==typeof a||null==a?{input:a}:a,b)}},wQ=class extends wP{static lc_name(){return"DynamicTool"}name;description;func;constructor(a){super(a),this.name=a.name,this.description=a.description,this.func=a.func,this.returnDirect=a.returnDirect??this.returnDirect}async call(a,b){let c=gR(b);return void 0===c.runName&&(c.runName=this.name),super.call(a,c)}async _call(a,b,c){return this.func(a,b,c)}},wR=class extends wO{static lc_name(){return"DynamicStructuredTool"}name;description;func;schema;constructor(a){super(a),this.name=a.name,this.description=a.description,this.func=a.func,this.returnDirect=a.returnDirect??this.returnDirect,this.schema=a.schema}async call(a,b,c){let d=gR(b);return void 0===d.runName&&(d.runName=this.name),super.call(a,d,c)}_call(a,b,c){return this.func(a,b,c)}},wS=class{getTools(){return this.tools}};function wT(a,b){let c=mL(b.schema),d=nO(b.schema);if(!b.schema||c||d)return new wQ({...b,description:b.description??b.schema?.description??`${b.name} tool`,func:async(b,c,d)=>new Promise((e,f)=>{let g=g6(d,{callbacks:c?.getChild()});g1.runWithConfig(g7(g),async()=>{try{e(a(b,g))}catch(a){f(a)}})})});let e=b.schema,f=b.description??b.schema.description??`${b.name} tool`;return new wR({...b,description:f,schema:e,func:async(b,c,d)=>new Promise((e,f)=>{let g,h=()=>{d?.signal&&g&&d.signal.removeEventListener("abort",g)};d?.signal&&(g=()=>{h(),f(g9(d.signal))},d.signal.addEventListener("abort",g));let i=g6(d,{callbacks:c?.getChild()});g1.runWithConfig(g7(i),async()=>{try{let c=await a(b,i);if(d?.signal?.aborted)return void h();h(),e(c)}catch(a){h(),f(a)}})})})}a.s(["DynamicTool",()=>wQ,"Tool",()=>wP,"tool",()=>wT],905636),Object.defineProperty(class extends wP{static lc_name(){return"DallEAPIWrapper"}constructor(a){a?.responseFormat!==void 0&&["url","b64_json"].includes(a.responseFormat)&&(a.dallEResponseFormat=a.responseFormat,a.responseFormat="content"),super(a),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"dallEResponseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const b={apiKey:a?.apiKey??a?.openAIApiKey??dG("OPENAI_API_KEY"),organization:a?.organization??dG("OPENAI_ORGANIZATION"),dangerouslyAllowBrowser:!0,baseURL:a?.baseUrl};this.client=new th(b),this.model=a?.model??a?.modelName??this.model,this.style=a?.style??this.style,this.quality=a?.quality??this.quality,this.n=a?.n??this.n,this.size=a?.size??this.size,this.dallEResponseFormat=a?.dallEResponseFormat??this.dallEResponseFormat,this.user=a?.user}processMultipleGeneratedUrls(a){return"url"===this.dallEResponseFormat?a.flatMap(a=>a.data?.flatMap(a=>a.url?{type:"image_url",image_url:a.url}:[]).filter(a=>void 0!==a&&"image_url"===a.type&&"string"==typeof a.image_url&&void 0!==a.image_url)??[]):a.flatMap(a=>a.data?.flatMap(a=>a.b64_json?{type:"image_url",image_url:{url:a.b64_json}}:[]).filter(a=>void 0!==a&&"image_url"===a.type&&"object"==typeof a.image_url&&"url"in a.image_url&&"string"==typeof a.image_url.url&&void 0!==a.image_url.url)??[])}async _call(a){let b={model:this.model,prompt:a,n:1,size:this.size,response_format:this.dallEResponseFormat,style:this.style,quality:this.quality,user:this.user};if(this.n>1){let a=await Promise.all(Array.from({length:this.n}).map(()=>this.client.images.generate(b)));return this.processMultipleGeneratedUrls(a)}let c=await this.client.images.generate(b),d="";return"url"===this.dallEResponseFormat?[d]=c.data?.map(a=>a.url).filter(a=>"undefined"!==a)??[]:[d]=c.data?.map(a=>a.b64_json).filter(a=>"undefined"!==a)??[],d}},"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),a.i(974685),a.i(522734);var wU=a.i(924868);a.i(81111),a.i(188646),a.i(544270),a.i(593909),a.i(162612);var wV=a.i(413187);a.i(784442),wV.default;var wW=a.i(814747);(_=cE||(cE={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",_.OUTCOME_OK="OUTCOME_OK",_.OUTCOME_FAILED="OUTCOME_FAILED",_.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(aa=cF||(cF={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",aa.PYTHON="PYTHON",(ab=cG||(cG={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",ab.SILENT="SILENT",ab.WHEN_IDLE="WHEN_IDLE",ab.INTERRUPT="INTERRUPT",(ac=cH||(cH={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",ac.STRING="STRING",ac.NUMBER="NUMBER",ac.INTEGER="INTEGER",ac.BOOLEAN="BOOLEAN",ac.ARRAY="ARRAY",ac.OBJECT="OBJECT",ac.NULL="NULL",(ad=cI||(cI={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",ad.MODE_DYNAMIC="MODE_DYNAMIC",(ae=cJ||(cJ={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",ae.SIMPLE_SEARCH="SIMPLE_SEARCH",ae.ELASTIC_SEARCH="ELASTIC_SEARCH",(af=cK||(cK={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",af.NO_AUTH="NO_AUTH",af.API_KEY_AUTH="API_KEY_AUTH",af.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",af.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",af.OAUTH="OAUTH",af.OIDC_AUTH="OIDC_AUTH",(ag=cL||(cL={})).HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",ag.HTTP_IN_QUERY="HTTP_IN_QUERY",ag.HTTP_IN_HEADER="HTTP_IN_HEADER",ag.HTTP_IN_PATH="HTTP_IN_PATH",ag.HTTP_IN_BODY="HTTP_IN_BODY",ag.HTTP_IN_COOKIE="HTTP_IN_COOKIE",(ah=cM||(cM={})).PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",ah.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",ah.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",ah.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",ah.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",ah.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",ah.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH",(ai=cN||(cN={})).THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",ai.LOW="LOW",ai.HIGH="HIGH",(aj=cO||(cO={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",aj.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",aj.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",aj.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",aj.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",aj.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",aj.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",aj.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",aj.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",aj.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",aj.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(ak=cP||(cP={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",ak.SEVERITY="SEVERITY",ak.PROBABILITY="PROBABILITY",(al=cQ||(cQ={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",al.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",al.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",al.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",al.BLOCK_NONE="BLOCK_NONE",al.OFF="OFF",(am=cR||(cR={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",am.STOP="STOP",am.MAX_TOKENS="MAX_TOKENS",am.SAFETY="SAFETY",am.RECITATION="RECITATION",am.LANGUAGE="LANGUAGE",am.OTHER="OTHER",am.BLOCKLIST="BLOCKLIST",am.PROHIBITED_CONTENT="PROHIBITED_CONTENT",am.SPII="SPII",am.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",am.IMAGE_SAFETY="IMAGE_SAFETY",am.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",am.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",am.NO_IMAGE="NO_IMAGE",(an=cS||(cS={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",an.NEGLIGIBLE="NEGLIGIBLE",an.LOW="LOW",an.MEDIUM="MEDIUM",an.HIGH="HIGH",(ao=cT||(cT={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",ao.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",ao.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",ao.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",ao.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(ap=cU||(cU={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",ap.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",ap.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",ap.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",ap.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(aq=cV||(cV={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",aq.SAFETY="SAFETY",aq.OTHER="OTHER",aq.BLOCKLIST="BLOCKLIST",aq.PROHIBITED_CONTENT="PROHIBITED_CONTENT",aq.IMAGE_SAFETY="IMAGE_SAFETY",aq.MODEL_ARMOR="MODEL_ARMOR",aq.JAILBREAK="JAILBREAK",(ar=cW||(cW={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",ar.ON_DEMAND="ON_DEMAND",ar.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(as=cX||(cX={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",as.TEXT="TEXT",as.IMAGE="IMAGE",as.AUDIO="AUDIO",(at=cY||(cY={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",at.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",at.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",at.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(au=cZ||(cZ={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",au.TUNING_MODE_FULL="TUNING_MODE_FULL",au.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(av=c$||(c$={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",av.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",av.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",av.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",av.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",av.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",av.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(aw=c_||(c_={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",aw.JOB_STATE_QUEUED="JOB_STATE_QUEUED",aw.JOB_STATE_PENDING="JOB_STATE_PENDING",aw.JOB_STATE_RUNNING="JOB_STATE_RUNNING",aw.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",aw.JOB_STATE_FAILED="JOB_STATE_FAILED",aw.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",aw.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",aw.JOB_STATE_PAUSED="JOB_STATE_PAUSED",aw.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",aw.JOB_STATE_UPDATING="JOB_STATE_UPDATING",aw.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(ax=c0||(c0={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",ax.TUNING_TASK_I2V="TUNING_TASK_I2V",ax.TUNING_TASK_T2V="TUNING_TASK_T2V",ax.TUNING_TASK_R2V="TUNING_TASK_R2V",(ay=c1||(c1={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",ay.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",ay.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",ay.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(az=c2||(c2={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",az.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",az.BALANCED="BALANCED",az.PRIORITIZE_COST="PRIORITIZE_COST",(aA=c3||(c3={})).UNSPECIFIED="UNSPECIFIED",aA.BLOCKING="BLOCKING",aA.NON_BLOCKING="NON_BLOCKING",(aB=c4||(c4={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",aB.MODE_DYNAMIC="MODE_DYNAMIC",(aC=c5||(c5={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",aC.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",(aD=c6||(c6={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",aD.AUTO="AUTO",aD.ANY="ANY",aD.NONE="NONE",aD.VALIDATED="VALIDATED",(aE=c7||(c7={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",aE.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",aE.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",aE.BLOCK_NONE="BLOCK_NONE",(aF=c8||(c8={})).DONT_ALLOW="DONT_ALLOW",aF.ALLOW_ADULT="ALLOW_ADULT",aF.ALLOW_ALL="ALLOW_ALL",(aG=c9||(c9={})).auto="auto",aG.en="en",aG.ja="ja",aG.ko="ko",aG.hi="hi",aG.zh="zh",aG.pt="pt",aG.es="es",(aH=da||(da={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",aH.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",aH.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",aH.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",aH.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",(aI=db||(db={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",aI.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",aI.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",aI.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(aJ=dc||(dc={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",aJ.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",aJ.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",aJ.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",(aK=dd||(dd={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",aK.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",aK.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",aK.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",aK.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",aK.EDIT_MODE_STYLE="EDIT_MODE_STYLE",aK.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",aK.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(aL=de||(de={})).FOREGROUND="FOREGROUND",aL.BACKGROUND="BACKGROUND",aL.PROMPT="PROMPT",aL.SEMANTIC="SEMANTIC",aL.INTERACTIVE="INTERACTIVE",(aM=df||(df={})).ASSET="ASSET",aM.STYLE="STYLE",(aN=dg||(dg={})).INSERT="INSERT",aN.REMOVE="REMOVE",aN.REMOVE_STATIC="REMOVE_STATIC",aN.OUTPAINT="OUTPAINT",(aO=dh||(dh={})).OPTIMIZED="OPTIMIZED",aO.LOSSLESS="LOSSLESS",(aP=di||(di={})).SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",aP.PREFERENCE_TUNING="PREFERENCE_TUNING",(aQ=dj||(dj={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",aQ.STATE_PENDING="STATE_PENDING",aQ.STATE_ACTIVE="STATE_ACTIVE",aQ.STATE_FAILED="STATE_FAILED",(aR=dk||(dk={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",aR.PROCESSING="PROCESSING",aR.ACTIVE="ACTIVE",aR.FAILED="FAILED",(aS=dl||(dl={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",aS.UPLOADED="UPLOADED",aS.GENERATED="GENERATED",(aT=dm||(dm={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",aT.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",aT.RESPONSE_REJECTED="RESPONSE_REJECTED",aT.NEED_MORE_INPUT="NEED_MORE_INPUT",(aU=dn||(dn={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",aU.TEXT="TEXT",aU.IMAGE="IMAGE",aU.VIDEO="VIDEO",aU.AUDIO="AUDIO",aU.DOCUMENT="DOCUMENT",(aV=dp||(dp={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",aV.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",aV.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(aW=dq||(dq={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",aW.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",aW.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",(aX=dr||(dr={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",aX.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",aX.NO_INTERRUPTION="NO_INTERRUPTION",(aY=ds||(ds={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",aY.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",aY.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(aZ=dt||(dt={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",aZ.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",aZ.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",aZ.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",aZ.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",aZ.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",aZ.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",aZ.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",aZ.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",aZ.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",aZ.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",aZ.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",aZ.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(a$=du||(du={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",a$.QUALITY="QUALITY",a$.DIVERSITY="DIVERSITY",a$.VOCALIZATION="VOCALIZATION",(a_=dv||(dv={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",a_.PLAY="PLAY",a_.PAUSE="PAUSE",a_.STOP="STOP",a_.RESET_CONTEXT="RESET_CONTEXT",(a0=dw||(dw={})).PAGED_ITEM_BATCH_JOBS="batchJobs",a0.PAGED_ITEM_MODELS="models",a0.PAGED_ITEM_TUNING_JOBS="tuningJobs",a0.PAGED_ITEM_FILES="files",a0.PAGED_ITEM_CACHED_CONTENTS="cachedContents",a0.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",a0.PAGED_ITEM_DOCUMENTS="documents","function"==typeof SuppressedError&&SuppressedError,a.i(800525),a.i(877750);let wX=(a,b,c)=>{let{model:d="gpt-5-nano",temperature:e=1,maxTokens:f=16e3}=b||{};if(d.startsWith("gemini")){let b=new qM({model:d,temperature:e,maxOutputTokens:f});return c?.tools?b.bindTools(c.tools):a?b.withStructuredOutput(a):{invoke:async a=>{let c=await b.invoke(a);return"string"==typeof c.content?c.content:String(c.content)}}}{let b=new t_({model:d,temperature:"gpt-5-nano"!==d?e:1,maxCompletionTokens:f,reasoningEffort:"low"});return c?.tools?b.bindTools(c.tools):a?b.withStructuredOutput(a):{invoke:async a=>{let c=await b.invoke(a);return"string"==typeof c.content?c.content:String(c.content)}}}};async function wY(a){let{batches:b,input:c,previousResults:d,parentName:e}=a,f=d.response,g={...d};for(let a=0;a<b.length;a++){let d=b[a],h=Object.keys(d);console.log(`[${e}] Executing batch ${a+1}/${b.length}: [${h.join(", ")}]`);let i=Date.now(),j=h.map(async a=>{let b,g,h,i=d[a];if(null!==i&&"object"==typeof i&&"agent"in i&&"function"==typeof i.agent?.invoke?(b=i.agent,g=i.condition,h=i.transform):b=i,g&&!g(f))return console.log(`[${e}:${a}] Skipped (condition not met)`),{key:a,result:null,skipped:!0};let j=h?h(f):c,k=Date.now();console.log(`[${e}:${a}] Starting`);let l=await b.invoke(j);return console.log(`[${e}:${a}] Completed in ${Date.now()-k}ms`),{key:a,result:l,skipped:!1}}),k=await Promise.all(j);for(let{key:b,result:c,skipped:d}of(console.log(`[${e}] Batch ${a+1} completed in ${Date.now()-i}ms`),k)){if(d)continue;let a=c&&"object"==typeof c&&"response"in c;g[b]=a?c.response:c}}let{response:h,...i}=g;return i}a.s(["initializeModel",0,wX],56859);let wZ={update_profile:1,get_workout:2,make_modification:3};async function w$(a){let{model:b,messages:c,tools:d,name:e,maxIterations:f}=a,g=[...c],h=[],i=[],j="action";for(let a=1;a<=f;a++){console.log(`[${e}] Tool loop iteration ${a}`);let c=await b.invoke(g);if(!c.tool_calls||0===c.tool_calls.length){let b="string"==typeof c.content?c.content:String(c.content);return console.log(`[${e}] Tool loop completed after ${a} iteration(s)`),{response:b,messages:i,toolCalls:h}}let f=[...c.tool_calls].sort((a,b)=>(wZ[a.name]??99)-(wZ[b.name]??99));console.log(`[${e}] ${f.length} tool call(s): ${f.map(a=>a.name).join(", ")}`);let k=[];for(let b=0;b<f.length;b++){let c=f[b],l=`call_${a}_${b}`,m=d.find(a=>a.name===c.name);if(!m){console.error(`[${e}] Tool not found: ${c.name}`);continue}let n=Date.now();try{console.log(`[${e}] Executing tool: ${c.name}`);let a=await m.invoke(c.args),b=Date.now()-n;j=a.toolType||"action",a.messages&&a.messages.length>0&&(i.push(...a.messages),k.push(...a.messages),console.log(`[${e}] Accumulated ${a.messages.length} message(s) from ${c.name}`)),h.push({name:c.name,args:c.args,result:a.response,durationMs:b}),g.push({role:"assistant",content:"",tool_calls:[{id:l,type:"function",function:{name:c.name,arguments:JSON.stringify(c.args)}}]}),g.push({role:"tool",content:a.response,tool_call_id:l}),console.log(`[${e}] ${c.name} complete in ${b}ms`)}catch(a){console.error(`[${e}] Tool error (${c.name}):`,a),g.push({role:"tool",content:`Error: ${a instanceof Error?a.message:"Unknown error"}`,tool_call_id:l}),i.push("I tried to help but encountered an issue. Please try again!")}}g.push({role:"user",content:function(a,b){let c="";return(b.length>0&&(c=`
[AUTOMATED MESSAGES]
The following messages will be sent to the user immediately after your response:
${b.map(a=>`- "${a.substring(0,100)}${a.length>100?"...":""}"`).join("\n")}
`),"query"===a)?`[SYSTEM: TOOL COMPLETE - QUERY]
${c}
[INSTRUCTION]
The user asked a question and you retrieved the answer.
- Provide a brief, natural intro to the information (e.g., "Here's your workout for today:" or "Today you've got [type]:")
- DO NOT say "Done" or "Complete" - this was a question, not a request for action
- If [AUTOMATED MESSAGES] are listed, they contain the detailed response. Just provide a smooth lead-in.
- If there was an error, explain it simply.
- Keep it conversational and SMS-style (1-2 sentences max).
`:`[SYSTEM: TOOL COMPLETE - ACTION]
${c}
[INSTRUCTION]
The user requested a change and it has been processed.
- Briefly confirm what was done in a natural way
- If [AUTOMATED MESSAGES] are listed, DO NOT repeat their content. Just provide a brief confirmation.
- If you called make_modification with a message, that acknowledgment was already sent. Focus on the result now.
- If the action failed, explain the issue simply.
- Keep it conversational and SMS-style (1-2 sentences max).
`}(j,k)}),console.log(`[${e}] All tools complete, continuing loop`)}return console.warn(`[${e}] Max iterations (${f}) reached`),{response:i.length>0?i[i.length-1]:"I'm here to help! What would you like to know?",messages:i,toolCalls:h}}var w_=a.i(555977);let w0=wW.join(process.cwd(),"_logs");async function w1(){try{await wU.mkdir(w0,{recursive:!0})}catch{}}var w2=a.i(449083);class w3 extends w2.BaseRepository{async getPromptPair(a){let b=await this.db.selectFrom("prompts").where("id","=",a).orderBy("createdAt","desc").selectAll().execute();if(0===b.length)return null;let c=b.find(a=>"system"===a.role),d=b.find(a=>"user"===a.role);return c?{systemPrompt:c.value,userPrompt:d?.value??null}:null}async getSystemPrompt(a){let b=await this.db.selectFrom("prompts").where("id","=",a).where("role","=","system").orderBy("createdAt","desc").limit(1).select("value").executeTakeFirst();return b?.value??null}async getUserPrompt(a){let b=await this.db.selectFrom("prompts").where("id","=",a).where("role","=","user").orderBy("createdAt","desc").limit(1).select("value").executeTakeFirst();return b?.value??null}async getContextPrompt(a){let b=await this.db.selectFrom("prompts").where("id","=",a).where("role","=","context").orderBy("createdAt","desc").limit(1).select("value").executeTakeFirst();return b?.value??null}async createPrompt(a){return this.db.insertInto("prompts").values(a).returningAll().executeTakeFirstOrThrow()}async createPrompts(a){0!==a.length&&await this.db.insertInto("prompts").values(a).execute()}async getPromptHistory(a,b,c=10){return this.db.selectFrom("prompts").where("id","=",a).where("role","=",b).orderBy("createdAt","desc").limit(c).selectAll().execute()}async getAllPromptIds(){return(await this.db.selectFrom("prompts").select("id").distinct().execute()).map(a=>a.id)}}let w4=new w3;a.s(["PromptRepository",()=>w3,"promptRepository",0,w4],388592);class w5{static instance;cache=new Map;contextCache=new Map;constructor(){}static getInstance(){return w5.instance||(w5.instance=new w5),w5.instance}async getPrompts(a){let b=this.cache.get(a);if(b&&b.expiresAt>Date.now())return b.data;let c=await w4.getPromptPair(a);if(!c)throw Error(`Prompt not found for agent '${a}'. All prompts must be seeded before use. Run the prompt seeding migration.`);return this.cache.set(a,{data:c,expiresAt:Date.now()+3e5}),c}async getContextPrompt(a){let b=`${a}:context`,c=this.contextCache.get(b);if(c&&c.expiresAt>Date.now())return c.data;let d=await w4.getContextPrompt(a);return null!==d&&this.contextCache.set(b,{data:d,expiresAt:Date.now()+3e5}),d}invalidateCache(a){this.cache.delete(a),this.contextCache.delete(`${a}:context`)}clearCache(){this.cache.clear(),this.contextCache.clear()}}let w6=w5.getInstance();async function w7(a,b){let{name:c,systemPrompt:d,userPrompt:e,context:f=[],previousMessages:g=[],tools:h,schema:i,subAgents:j=[]}=a,k=d,l=null;if(!k){let a=await w6.getPrompts(c);k=a.systemPrompt,l=a.userPrompt}let{maxIterations:m=5}=b||{},n=h&&h.length>0,o=n?wX(void 0,b,{tools:h}):wX(i,b);return{invoke:async a=>{let b=Date.now();console.log(`[${c}] Starting execution`);try{var d;let i,p;i=e?e(a):l?`${l}

${a}`:a;let q=function(a){let{systemPrompt:b,userPrompt:c,context:d=[],previousMessages:e=[]}=a;return[{role:"system",content:b},...d.filter(a=>a&&a.trim().length>0).map(a=>({role:"user",content:a})),...e,{role:"user",content:c}]}({systemPrompt:k,userPrompt:i,context:f,previousMessages:g}),r=[];if(n){let a=await w$({model:o,messages:q,tools:h,name:c,maxIterations:m});p=a.response,r=a.messages}else p=await o.invoke(q);if(d=p,(0,w_.getFeatureFlags)().agentLogging&&(async()=>{try{let b,e,f,g,h,i;await w1();let j=(e=(b=new Date).toISOString().split("T")[0],f=b.toTimeString().split(" ")[0].replace(/:/g,""),g=b.getMilliseconds().toString().padStart(3,"0"),`${e}_${f}-${g}`),k=new Date().toISOString(),l=`${c}_${j}`;await Promise.all([wU.writeFile(wW.join(w0,`${l}.json`),JSON.stringify({timestamp:k,agentName:c,input:a,messages:q,output:d},null,2),"utf-8"),wU.writeFile(wW.join(w0,`${l}.txt`),(i=[h="=".repeat(80),`AGENT: ${c}`,`TIMESTAMP: ${k}`,`INPUT: ${a}`,h,"","--- MESSAGES ARRAY ---",""],q.forEach(a=>{let b,c,d;i.push((b=a.role.toUpperCase(),c=a.content||"",d="user"===a.role&&c.startsWith("[CONTEXT:")?"[USER - CONTEXT]":`[${b}]`,`${d}
${c}`)),i.push("")}),i.push("--- OUTPUT ---"),i.push("string"==typeof d?d:JSON.stringify(d,null,2)),i.push(h),i.join("\n")),"utf-8")])}catch(a){console.error("[AgentLogger] Failed to write log:",a)}})(),console.log(`[${c}] Main agent completed in ${Date.now()-b}ms`),!j||0===j.length)return{response:p,...r.length>0?{messages:r}:{}};let s="string"==typeof p?p:JSON.stringify(p),t=await wY({batches:j,input:s,previousResults:{response:p},parentName:c});return console.log(`[${c}] Total execution time: ${Date.now()-b}ms`),{response:p,...r.length>0?{messages:r}:{},...t}}catch(a){throw console.error(`[${c}] Execution failed:`,a),a}},name:c}}a.s(["createAgent",()=>w7],870107);let w8={CHAT_GENERATE:"chat:generate",PROFILE_FITNESS:"profile:fitness",PROFILE_STRUCTURED:"profile:structured",PROFILE_USER:"profile:user",PLAN_GENERATE:"plan:generate",PLAN_STRUCTURED:"plan:structured",PLAN_MESSAGE:"plan:message",PLAN_MODIFY:"plan:modify",WORKOUT_GENERATE:"workout:generate",WORKOUT_STRUCTURED:"workout:structured",WORKOUT_MESSAGE:"workout:message",WORKOUT_MODIFY:"workout:modify",MICROCYCLE_GENERATE:"microcycle:generate",MICROCYCLE_STRUCTURED:"microcycle:structured",MICROCYCLE_MESSAGE:"microcycle:message",MICROCYCLE_MODIFY:"microcycle:modify",MODIFICATIONS_ROUTER:"modifications:router"};a.s(["PROMPT_IDS",0,w8],574791),a.s([],235570);let w9=oF.z.object({type:oF.z.enum(["RPE","RIR","Percentage","Zone","HeartRate","Pace","Other"]).default("Other"),value:oF.z.string().describe("e.g., '7-8', '2', '75%', 'Zone 2', '150bpm'").default(""),description:oF.z.string().describe("Context for the user").default("")}),xa=oF.z.object({id:oF.z.string().default(""),name:oF.z.string().describe("e.g. 'Back Squat' or 'Zone 2 Run'"),type:oF.z.enum(["Strength","Cardio","Plyometric","Mobility","Rest","Other"]).default("Strength"),sets:oF.z.string().describe("e.g. '4' or '3-4'").default(""),reps:oF.z.string().describe("e.g. '6-8' or '4 min'").default(""),duration:oF.z.string().describe("e.g. '45 min'").default(""),distance:oF.z.string().describe("e.g. '5km'").default(""),rest:oF.z.string().describe("e.g. '2-3 min'").default(""),intensity:w9.default({type:"Other",value:"",description:""}),tempo:oF.z.string().describe("e.g. '3-0-1'").default(""),notes:oF.z.string().describe("Execution cues").default(""),tags:oF.z.array(oF.z.string()).default([]),supersetId:oF.z.string().default("")}),xb=oF.z.object({title:oF.z.string().describe("e.g. 'Warm Up', 'Main Lift'"),overview:oF.z.string().describe("Brief goal of this section").default(""),exercises:oF.z.array(xa).default([])}),xc=oF.z.object({title:oF.z.string().describe("Concise workout name, 2-4 words max (e.g. 'Pull A', 'Upper Strength', 'Leg Day')"),focus:oF.z.string().describe("Brief focus area, 1-3 words (e.g. 'Back & Biceps', 'Quads', 'Push')").default(""),description:oF.z.string().default(""),quote:oF.z.object({text:oF.z.string().default(""),author:oF.z.string().default("")}).default({text:"",author:""}),sections:oF.z.array(xb).default([]),estimatedDurationMin:oF.z.number().describe("Estimated minutes").default(-1),intensityLevel:oF.z.enum(["Low","Moderate","High","Severe"]).default("Moderate")}),xd=oF.z.object({type:oF.z.enum(["prep","compound","secondary","accessory","core","cardio","cooldown"]).describe("Type of exercise in the workout"),exercise:oF.z.string().describe("Specific, actionable exercise name that a user can immediately perform (e.g., 'Band Pull-Aparts', 'Cat-Cow Stretch', 'Scapular Wall Slides'). Never use vague terms like 'mobility sequence' or 'dynamic warmup'."),sets:oF.z.number().describe("Number of sets (use -1 if not applicable)"),reps:oF.z.string().describe("Number of reps (can be range like '6-8' or number like '10', use empty string if not applicable)"),durationSec:oF.z.number().describe("Duration in seconds (use -1 if not applicable)"),durationMin:oF.z.number().describe("Duration in minutes (use -1 if not applicable)"),RPE:oF.z.number().describe("Rate of Perceived Exertion (1-10 scale, use -1 if not applicable)"),rir:oF.z.number().describe("Reps in Reserve (typically 0-5, use -1 if not applicable)"),percentageRM:oF.z.number().describe("Percentage of 1 Rep Max (0-100 scale, use -1 if not applicable)"),restSec:oF.z.number().describe("Rest between sets in seconds (use -1 if not applicable)"),restText:oF.z.string().describe("Readable rest instruction (e.g., '90s between supersets', use empty string if not applicable)"),equipment:oF.z.string().describe("Equipment used (barbell, DB, band, etc., use empty string if not applicable)"),pattern:oF.z.string().describe("Movement pattern label (e.g., 'horizontal_press', use empty string if not applicable)"),tempo:oF.z.string().describe("Tempo prescription (e.g., '3-1-1', use empty string if not applicable)"),cues:oF.z.array(oF.z.string()).describe("Key coaching cues (use empty array if none)"),tags:oF.z.array(oF.z.string()).describe("Semantic tags for filtering/substitution (use empty array if none)"),notes:oF.z.string().describe("Additional notes for the exercise (use empty string if no notes)")}).strict(),xe=oF.z.object({structureType:oF.z.enum(["straight","superset","circuit"]).describe("Defines how the exercises are grouped (straight = single exercise, superset = 2 exercises alternated, circuit = 3+ exercises)"),exercises:oF.z.array(xd).min(1).describe("One or more exercises (1 = straight, 2 = superset, 3+ = circuit)"),restBetweenExercisesSec:oF.z.number().describe("Rest between exercises inside the superset/circuit in seconds (use -1 if not applicable)"),restAfterSetSec:oF.z.number().describe("Rest between rounds or sets of this work item in seconds (use -1 if not applicable)"),rounds:oF.z.number().describe("Number of times the group is repeated (for circuits, use -1 if not applicable)"),notes:oF.z.string().describe("Extra details about the grouping (use empty string if no notes)")}).strict(),xf=oF.z.object({name:oF.z.string().describe("Name of the workout block (e.g., 'Warm-Up', 'Main Lift', 'Accessory')"),goal:oF.z.string().describe("Purpose of this block (use empty string if not applicable)"),durationMin:oF.z.number().describe("Estimated duration in minutes (use -1 if not applicable)"),notes:oF.z.string().describe("General notes for this block (use empty string if no notes)"),work:oF.z.array(xe).describe("The list of work items (straight, superset, or circuit) within this block")}).strict(),xg=oF.z.object({condition:oF.z.string().describe("Condition that triggers this modification (e.g., 'injury.lower_back.active')"),replace:oF.z.object({exercise:oF.z.string().describe("Exercise to replace"),with:oF.z.string().describe("Replacement exercise")}).describe("Exercise replacement details (use empty strings if not applicable)"),adjustment:oF.z.string().describe("Adjustment to make (e.g., 'reduce weight by 20%', use empty string if not applicable)"),note:oF.z.string().describe("Explanation for the modification")}).strict(),xh=oF.z.object({phaseName:oF.z.string().describe("Name of the training phase (use empty string if not applicable)"),weekNumber:oF.z.number().describe("Week number in the program (use -1 if not applicable)"),dayIndex:oF.z.number().describe("Day index in the microcycle (use -1 if not applicable)"),goal:oF.z.string().describe("Goal of the session (use empty string if not applicable)"),durationEstimateMin:oF.z.number().describe("Estimated duration in minutes (use -1 if not applicable)"),environment:oF.z.string().describe("Training environment (e.g., 'gym', 'home', use empty string if not applicable)"),clientConstraints:oF.z.object({timeAvailable:oF.z.number().describe("Time available in minutes (use -1 if not applicable)"),equipmentAvailable:oF.z.array(oF.z.string()).describe("Available equipment (use empty array if not specified)"),injuries:oF.z.array(oF.z.string()).describe("Current injuries or limitations (use empty array if none)"),preferences:oF.z.array(oF.z.string()).describe("Client preferences (use empty array if not specified)")}).describe("Client-specific constraints for the session")}).strict(),xi=oF.z.object({totalVolume:oF.z.number().describe("Total volume in kg (use -1 if not applicable)"),totalReps:oF.z.number().describe("Total reps across all exercises (use -1 if not applicable)"),totalSets:oF.z.number().describe("Total sets across all exercises (use -1 if not applicable)"),totalDistance:oF.z.number().describe("Total distance in km (use -1 if not applicable)"),totalDuration:oF.z.number().describe("Total duration in minutes (use -1 if not applicable)"),averageRPE:oF.z.number().describe("Average RPE across workout (use -1 if not applicable)"),averageIntensity:oF.z.number().describe("Average intensity across workout (use -1 if not applicable)")}).strict(),xj=oF.z.object({adaptations:oF.z.array(oF.z.string()).describe("Expected adaptations from this workout (use empty array if not specified)"),coachingNotes:oF.z.string().describe("Coaching notes for the client (use empty string if no notes)"),progressionNotes:oF.z.string().describe("Notes on progression strategy (use empty string if no notes)"),recoveryFocus:oF.z.string().describe("Recovery focus areas (use empty string if not specified)")}).strict(),xk=oF.z.object({theme:oF.z.string().describe("Overall theme of the workout (e.g., 'Upper Push', 'Lower Power')"),sessionContext:xh.describe("Metadata and context about the session"),blocks:oF.z.array(xf).describe("Structured blocks of the workout"),modifications:oF.z.array(xg).describe("Modifications for special conditions (use empty array if none)"),targetMetrics:xi.describe("Target metrics for the workout"),summary:xj.describe("Summary and meta reflections about the workout"),notes:oF.z.string().describe("Additional notes for the workout (use empty string if no notes)")}).strict(),xl=xk.extend({modificationsApplied:oF.z.array(oF.z.string()).describe("List of specific changes made to the workout (e.g., 'Replaced Barbell Bench Press with Dumbbell Bench Press due to no barbell available')")}).strict(),xm=oF.z.object({type:oF.z.enum(["prep","compound","secondary","accessory","core","cardio","cooldown"]).describe("Category of the movement or its role in the session."),exercise:oF.z.string().describe("Explicit exercise name (e.g., 'Barbell Back Squat')."),sets:oF.z.number().nullish().describe("Number of sets."),reps:oF.z.string().nullish().describe("Reps (can be a range or a single value)."),durationSec:oF.z.number().nullish().describe("Exercise duration in seconds."),durationMin:oF.z.number().nullish().describe("Exercise duration in minutes."),RPE:oF.z.number().min(1).max(10).nullish().describe("Rate of Perceived Exertion 110."),rir:oF.z.number().nullish().describe("Reps in Reserve (autoregulation measure)."),percentageRM:oF.z.number().min(0).max(100).nullish().describe("Percent of 1RM load."),restSec:oF.z.number().nullish().describe("Rest between sets in seconds."),restText:oF.z.string().nullish().describe("Readable rest instruction, e.g. '90s between supersets'."),equipment:oF.z.string().nullish().describe("Equipment used (barbell, DB, band, etc.)."),pattern:oF.z.string().nullish().describe("Movement pattern label (e.g., 'horizontal_press')."),tempo:oF.z.string().nullish().describe("Tempo prescription, e.g. '3-1-1'."),cues:oF.z.array(oF.z.string()).nullish().describe("Key coaching cues."),tags:oF.z.array(oF.z.string()).nullish().describe("Semantic tags for filtering/substitution."),notes:oF.z.string().nullish().describe("Extra details or special instructions.")}).strict(),xn=oF.z.object({structureType:oF.z.enum(["straight","superset","circuit"]).default("straight").describe("Defines how the exercises are grouped."),exercises:oF.z.array(xm).min(1).describe("One or more exercises (1 = straight, 2 = superset, 3+ = circuit)."),restBetweenExercisesSec:oF.z.number().nullish().describe("Rest between exercises inside the superset/circuit."),restAfterSetSec:oF.z.number().nullish().describe("Rest between rounds or sets of this work item."),rounds:oF.z.number().nullish().describe("Number of times the group is repeated (for circuits)."),notes:oF.z.string().nullish().describe("Extra details about the grouping.")}).strict(),xo=oF.z.object({name:oF.z.string().describe("Name of the workout block (e.g., 'Warm-Up', 'Main Lift')."),goal:oF.z.string().nullish().describe("Purpose of this block."),durationMin:oF.z.number().nullish().describe("Estimated duration in minutes."),notes:oF.z.string().nullish().describe("General notes for this block."),work:oF.z.array(xn).describe("The list of work items (straight, superset, or circuit) within this block.")}).strict(),xp=oF.z.object({condition:oF.z.string().describe("Trigger condition, e.g. 'injury.shoulder.active'."),replace:oF.z.object({exercise:oF.z.string().describe("Original exercise to replace."),with:oF.z.string().describe("Substitute exercise.")}).nullish(),adjustment:oF.z.string().nullish().describe("Other adjustments (e.g., reduce weight 20%)."),note:oF.z.string().describe("Reason or context for this modification.")}).strict(),xq=oF.z.object({phaseName:oF.z.string().nullish(),weekNumber:oF.z.number().nullish(),dayIndex:oF.z.number().nullish(),goal:oF.z.string().nullish(),durationEstimateMin:oF.z.number().nullish(),environment:oF.z.string().nullish(),clientConstraints:oF.z.object({timeAvailable:oF.z.number().nullish(),equipmentAvailable:oF.z.array(oF.z.string()).nullish(),injuries:oF.z.array(oF.z.string()).nullish(),preferences:oF.z.array(oF.z.string()).nullish()}).nullish()}).nullish(),xr=oF.z.object({totalVolume:oF.z.number().nullish(),totalReps:oF.z.number().nullish(),totalSets:oF.z.number().nullish(),totalDuration:oF.z.number().nullish(),averageRPE:oF.z.number().nullish(),averageIntensity:oF.z.number().nullish()}).nullish(),xs=oF.z.object({adaptations:oF.z.array(oF.z.string()).nullish(),coachingNotes:oF.z.string().nullish(),progressionNotes:oF.z.string().nullish(),recoveryFocus:oF.z.string().nullish()}).nullish(),xt=oF.z.object({theme:oF.z.string().describe("Theme of the workout (e.g., 'Upper Push', 'Lower Power')."),sessionContext:xq,blocks:oF.z.array(xo),modifications:oF.z.array(xp).nullish(),targetMetrics:xr,summary:xs,notes:oF.z.string().nullish()}).strict(),xu=xt.extend({modificationsApplied:oF.z.array(oF.z.string()).describe("List of specific changes made to the workout (e.g., 'Replaced Barbell Bench Press with Dumbbell Bench Press due to no barbell available')")}).strict();function xv(a){return a?.startsWith("gemini")||!1}function xw(a){return xv(a)?{enhanced:xk,updated:xl,isGemini:!0}:{enhanced:xt,updated:xu,isGemini:!1}}oF.z.object({sessionType:oF.z.enum(["run","lift","metcon","mobility","rest","other"]).describe("Primary modality"),details:oF.z.array(oF.z.object({label:oF.z.string().describe("Name of the block (e.g. Warm-up)"),activities:oF.z.array(oF.z.string()).describe("Ordered list of exercise descriptions")}).strict()).min(1).describe("Sequential blocks in the workout"),targets:oF.z.array(oF.z.object({key:oF.z.string().describe("Metric / target field name"),value:oF.z.number().describe("Numeric value for the key")}).strict()).describe("Numeric targets such as distanceKm, volumeKg").nullish()}).strict(),oF.z.object({formatted:oF.z.string().min(100).describe(`
      Formatted workout text using extended markdown format.

      REQUIRED STRUCTURE:
      # {Theme} - {Focus}

      ## Session Overview
      **Duration:** ~{X} minutes
      **RPE Target:** {X-Y}
      **Focus:** {focus areas}

      ---

      ## {Emoji} Block 1: {Block Name}
      **Goal:** {Purpose}

      {Work items with exercises, sets, reps, RPE, cues, etc.}

      ---

      ## Coaching Notes
      - {Notes for user}

      FORMAT EXAMPLES:

      Straight sets:
      1. **Barbell Bench Press** [COMPOUND]
         - 4 x 5 reps @ 80% 1RM
         - RPE: 8 | RIR: 2
         - Rest: 3-4 min
         - *Cues: Retract scapula, leg drive*
         - **Progression:** +5lbs from last week

      Supersets:
      **A. Superset (3 rounds, 90s rest between rounds):**
         1a. **Incline DB Press** [SECONDARY]
             - 10-12 reps @ RPE 7
             - *Cue: Full ROM, control eccentric*

         1b. **Cable Face Pulls** [ACCESSORY]
             - 15 reps
             - *Cue: Pull to forehead level*

      Circuits:
      **B. Circuit (2 rounds, 60s rest):**
         2a. **Dips** - 8-10 reps @ RPE 8
         2b. **Lateral Raises** - 12 reps per side
         2c. **Tricep Pushdowns** - 15 reps

      Cardio:
      1. **Easy Run**
         - Duration: 40 min
         - Pace: 9:30-10:00 /mile
         - Heart Rate: Zone 2 (130-145 bpm)
         - *Cues: Relax shoulders, land midfoot*

      IMPORTANT FORMATTING RULES:
      - Use markdown headers (# for title, ## for blocks)
      - Use --- to separate blocks
      - Use **bold** for exercise names
      - Use [TYPE] tags: [PREP], [COMPOUND], [SECONDARY], [ACCESSORY], [CORE], [CARDIO], [COOLDOWN]
      - Use emojis for visual hierarchy
      - Use *italic* for coaching cues
      - Use bullet points (-) for lists
      - Include RPE, sets, reps, rest periods as appropriate
      - Add coaching notes and modifications sections
      - Be comprehensive - include ALL exercises and details
      - Adapt format to workout type (strength, cardio, metcon, etc.)
    `)}).strict().extend({theme:oF.z.string().describe("Workout theme/title (e.g., 'Upper Push', 'Easy Run')")}).strict().extend({modificationsApplied:oF.z.array(oF.z.string()).describe("List of specific changes made (e.g., 'Replaced Barbell Bench Press with Dumbbell Bench Press due to no barbell available')")}).strict(),a.s(["getWorkoutSchemas",()=>xw,"isGeminiModel",()=>xv],75686),a.i(75686);let xx=oF.z.object({overview:oF.z.string().describe("Full workout text after modifications (or original if unchanged)"),wasModified:oF.z.boolean().describe("Whether the workout was actually modified"),modifications:oF.z.string().default("").describe("Explanation of what changed and why (empty string if wasModified is false)")});var xy=((a1={}).USER="user",a1.USER_PROFILE="userProfile",a1.FITNESS_PLAN="fitnessPlan",a1.DAY_OVERVIEW="dayOverview",a1.CURRENT_WORKOUT="currentWorkout",a1.DATE_CONTEXT="dateContext",a1.TRAINING_META="trainingMeta",a1.CURRENT_MICROCYCLE="currentMicrocycle",a1.EXPERIENCE_LEVEL="experienceLevel",a1.DAY_FORMAT="dayFormat",a1);a.s(["ContextType",()=>xy],873400);var xz=((a2={}).MICROCYCLE="microcycle",a2.WORKOUT="workout",a2);let xA={microcycle:{beginner:"microcycle:generate:experience:beginner",intermediate:"microcycle:generate:experience:intermediate",advanced:"microcycle:generate:experience:advanced"},workout:{beginner:"workout:generate:experience:beginner",intermediate:"workout:generate:experience:intermediate",advanced:"workout:generate:experience:advanced"}},xB=async(a,b)=>{if(!a)return null;let c=xA[b]?.[a];if(!c)return null;try{return await w6.getContextPrompt(c)}catch(c){return console.warn(`[experienceLevel] Could not fetch snippet for ${a}/${b}:`,c),null}};var xC=a.i(239496);let xD={TRAINING:"workout:message:format:training",ACTIVE_RECOVERY:"workout:message:format:active_recovery",REST:"workout:message:format:rest"},xE=async a=>{if(!a)return null;let b=xD[a];if(!b)return null;try{return await w6.getContextPrompt(b)}catch(b){return console.warn(`[dayFormat] Could not fetch format for ${a}:`,b),null}};a.s([],547547);class xF{static instance;deps;constructor(a){this.deps=a}static initialize(a){return xF.instance||(xF.instance=new xF(a)),xF.instance}static getInstance(){if(!xF.instance)throw Error("ContextService not initialized. Call initialize() first.");return xF.instance}async getContext(a,b,c={}){let d=b.includes(xy.FITNESS_PLAN)&&!c.planText,e=b.includes(xy.CURRENT_WORKOUT)&&void 0===c.workout,f=b.includes(xy.CURRENT_MICROCYCLE)&&void 0===c.microcycle,g=b.includes(xy.EXPERIENCE_LEVEL)&&void 0===c.experienceLevel,h=b.includes(xy.DAY_FORMAT)&&void 0!==c.activityType,i=b.includes(xy.EXPERIENCE_LEVEL),j=c.date||(0,xC.today)(a.timezone),[k,l,m,n,o]=await Promise.all([d?this.deps.fitnessPlanService.getCurrentPlan(a.id):null,e?this.deps.workoutInstanceService.getWorkoutByUserIdAndDate(a.id,j):null,f?this.deps.microcycleService.getMicrocycleByDate(a.id,j):null,g?this.deps.profileRepository.getCurrentStructuredProfile(a.id):null,h?xE(c.activityType):null]),p=c.experienceLevel??n?.experienceLevel??null,q=c.snippetType||xz.WORKOUT,r=i&&p?await xB(p,q):null,s={userName:a.name,userGender:a.gender,userAge:a.age,profile:a.profile,planText:c.planText??k?.description,dayOverview:c.dayOverview,workout:c.workout??l,microcycle:c.microcycle??m,timezone:a.timezone||"America/New_York",date:j,isDeload:c.isDeload,absoluteWeek:c.absoluteWeek,currentWeek:c.currentWeek,experienceLevel:p,snippetType:q,activityType:c.activityType,dayFormatTemplate:o,experienceSnippet:r};return b.map(a=>this.buildContextForType(a,s)).filter(a=>a&&a.trim().length>0)}buildContextForType(a,b){switch(a){case xy.USER:var c,d,e,f,g,h,i,j,k,l,m,n={name:b.userName,gender:b.userGender,age:b.userAge};if(!n)return"<User>No user information available</User>";let o=[];return(n.name&&o.push(`<Name>${n.name}</Name>`),n.gender&&o.push(`<Gender>${n.gender}</Gender>`),n.age&&o.push(`<Age>${n.age}</Age>`),0===o.length)?"<User>No user information available</User>":`<User>
${o.join("\n")}
</User>`;case xy.USER_PROFILE:return(c=b.profile)&&0!==c.trim().length?`<UserProfile>${c.trim()}</UserProfile>`:"<UserProfile>No profile available</UserProfile>";case xy.FITNESS_PLAN:return(d=b.planText)&&0!==d.trim().length?`<FitnessPlan>${d.trim()}</FitnessPlan>`:"<FitnessPlan>No fitness plan available</FitnessPlan>";case xy.DAY_OVERVIEW:return(e=b.dayOverview)&&0!==e.trim().length?`<DayOverview>${e.trim()}</DayOverview>`:"<DayOverview>No day instruction provided</DayOverview>";case xy.CURRENT_WORKOUT:var p=b.workout;if(!p)return"<CurrentWorkout>No workout scheduled</CurrentWorkout>";let q=p.description||p.sessionType||"Workout";return`<CurrentWorkout>${q}</CurrentWorkout>`;case xy.DATE_CONTEXT:let r,s,t;return f=b.timezone,g=b.date,r=f||"America/New_York",s=g||new Date,t=(0,xC.formatForAI)(s,r),`<DateContext>
Today is ${t}.
Timezone: ${r}
</DateContext>`;case xy.TRAINING_META:let u;return h={isDeload:b.isDeload,absoluteWeek:b.absoluteWeek,currentWeek:b.currentWeek},u=[],(void 0!==h.isDeload&&u.push(`Is Deload Week: ${h.isDeload}`),void 0!==h.absoluteWeek&&u.push(`Absolute Week: ${h.absoluteWeek}`),void 0!==h.currentWeek&&u.push(`Current Week: ${h.currentWeek}`),0===u.length)?"":`<TrainingMeta>${u.join(" | ")}</TrainingMeta>`;case xy.CURRENT_MICROCYCLE:var v=b.microcycle;if(!v)return"<CurrentMicrocycle>No microcycle available</CurrentMicrocycle>";let w=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],x=(v.days||[]).map((a,b)=>`${w[b]}: ${a}`).join("\n");return`<CurrentMicrocycle>
Week Overview: ${v.description||"N/A"}
Is Deload: ${v.isDeload}
Absolute Week: ${v.absoluteWeek}
Days:
${x}
</CurrentMicrocycle>`;case xy.EXPERIENCE_LEVEL:return i=b.experienceSnippet,j=b.experienceLevel,k=b.snippetType||xz.WORKOUT,i&&j?`<ExperienceLevelContext level="${j}" type="${k}">
${i.trim()}
</ExperienceLevelContext>`:"";case xy.DAY_FORMAT:return l=b.dayFormatTemplate,m=b.activityType,l&&m?`<DayFormatRules type="${m}">
${l.trim()}
</DayFormatRules>`:"";default:return""}}}a.s(["ContextService",()=>xF],32875),a.s([],257563),a.i(547547);class xG{static instance;messageAgentPromise=null;structuredAgentPromise=null;constructor(){}getContextService(){return xF.getInstance()}static getInstance(){return xG.instance||(xG.instance=new xG),xG.instance}async getMessageAgent(a,b){if(b&&a){let c=await this.getContextService().getContext(a,[xy.DAY_FORMAT],{activityType:b});return w7({name:w8.WORKOUT_MESSAGE,context:c},{model:"gpt-5-nano"})}return this.messageAgentPromise||(this.messageAgentPromise=w7({name:w8.WORKOUT_MESSAGE},{model:"gpt-5-nano"})),this.messageAgentPromise}async getStructuredAgent(){return this.structuredAgentPromise||(this.structuredAgentPromise=w7({name:w8.WORKOUT_STRUCTURED,schema:xc},{model:"gpt-5-nano",maxTokens:32e3})),this.structuredAgentPromise}async generateWorkout(a,b,c=!1,d){let e=await this.getContextService().getContext(a,[xy.USER_PROFILE,xy.EXPERIENCE_LEVEL,xy.DAY_OVERVIEW,xy.TRAINING_META],{dayOverview:b,isDeload:c,snippetType:xz.WORKOUT}),[f,g]=await Promise.all([this.getMessageAgent(a,d),this.getStructuredAgent()]);return(await w7({name:w8.WORKOUT_GENERATE,context:e,subAgents:[{message:f,structure:g}]},{model:"gpt-5.1"})).invoke("")}async modifyWorkout(a,b,c){let d=await this.getContextService().getContext(a,[xy.USER_PROFILE,xy.CURRENT_WORKOUT],{workout:b}),[e,f]=await Promise.all([this.getMessageAgent(),this.getStructuredAgent()]),g=a=>{let b="string"==typeof a?a:JSON.stringify(a);try{return JSON.parse(b).overview||b}catch{return b}};return(await w7({name:w8.WORKOUT_MODIFY,context:d,schema:xx,subAgents:[{message:{agent:e,transform:g},structure:{agent:f,transform:g}}]},{model:"gpt-5-mini"})).invoke(c)}}let xH=xG.getInstance();a.s(["WorkoutAgentService",()=>xG,"workoutAgentService",0,xH],187361);let xI=oF.z.enum(["TRAINING","ACTIVE_RECOVERY","REST"]),xJ=oF.z.object({day:oF.z.enum(["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]),focus:oF.z.string().default(""),activityType:xI.default("TRAINING"),notes:oF.z.string().default("")}),xK=oF.z.object({weekNumber:oF.z.number().default(-1),phase:oF.z.string().default(""),overview:oF.z.string().default(""),days:oF.z.array(xJ).length(7),isDeload:oF.z.boolean().default(!1)});oF.z.object({overview:oF.z.string({description:"Overview of the week's training focus, objectives, and progression context"}),isDeload:oF.z.boolean({description:"Whether this is a deload week (reduced volume/intensity)"}).default(!1),days:oF.z.array(oF.z.string(),{description:"Array of 7 day descriptions (day 1 through day 7). Each string describes the session for that day including theme, focus, volume/intensity targets, and conditioning if applicable."}).length(7,"Must have exactly 7 days")});class xL{static fromDB(a){return{id:a.id,clientId:a.clientId,absoluteWeek:a.absoluteWeek,days:a.days??[],description:a.description??null,isDeload:a.isDeload??!1,message:a.message??null,structured:a.structured,startDate:new Date(a.startDate),endDate:new Date(a.endDate),isActive:a.isActive??!0,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)}}static toDB(a){return{clientId:a.clientId,absoluteWeek:a.absoluteWeek,days:a.days,description:a.description,isDeload:a.isDeload,message:a.message,structured:a.structured,startDate:a.startDate,endDate:a.endDate,isActive:a.isActive}}}a.s(["MicrocycleModel",()=>xL],938987);let xM=oF.z.object({overview:oF.z.string({description:"Comprehensive weekly overview including week number, theme, objective, split, volume/intensity trends, conditioning plan, and rest day placement"}),isDeload:oF.z.boolean().default(!1).describe("Whether this is a deload/recovery week with reduced volume and intensity"),days:oF.z.array(oF.z.string(),{description:"Exactly 7 day overview strings in order: Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday"}).length(7)}),xN=xM.extend({wasModified:oF.z.boolean().describe("Whether the microcycle was actually modified in response to the change request. False if the current plan already satisfies the request or no changes were needed."),modifications:oF.z.string().default("").describe("Explanation of what changed and why (empty string if wasModified is false). When wasModified is true, describe specific changes made to the weekly pattern.")}),xO=a=>7===a.length&&a.every(a=>a&&a.trim().length>0);class xP{static instance;messageAgentPromise=null;structuredAgentPromise=null;constructor(){}getContextService(){return xF.getInstance()}static getInstance(){return xP.instance||(xP.instance=new xP),xP.instance}async getMessageAgent(){return this.messageAgentPromise||(this.messageAgentPromise=w7({name:w8.MICROCYCLE_MESSAGE,userPrompt:a=>{var b;let c;return c=(b=JSON.parse(a)).days.map((a,b)=>`${xC.DAY_NAMES[b]}:
${a}`).join("\n\n"),`
Generate a weekly breakdown SMS message based on the following structured microcycle pattern.

Focus on summarizing the week's training theme and providing a clear, easy-to-read breakdown of training days and rest days for the client.

WEEKLY OVERVIEW:
${b.overview}

IS DELOAD WEEK: ${b.isDeload}

DAILY BREAKDOWNS:

${c}

Output only the message text (no JSON wrapper) as specified in your system instructions.
`.trim()}},{model:"gpt-5-nano"})),this.messageAgentPromise}async getStructuredAgent(){return this.structuredAgentPromise||(this.structuredAgentPromise=w7({name:w8.MICROCYCLE_STRUCTURED,userPrompt:a=>{let b,c,d,e,f=JSON.parse(a);return b=f.overview,c=f.days,d=f.absoluteWeek??1,e=f.isDeload,`Parse the following microcycle into structured format:

Week Number: ${d}
Is Deload: ${e}

Weekly Overview:
${b}

Day Overviews:
${c.map((a,b)=>`${["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][b]}: ${a}`).join("\n\n")}`},schema:xK},{model:"gpt-5-nano",maxTokens:32e3})),this.structuredAgentPromise}async generateMicrocycle(a,b){let c=await this.getContextService().getContext(a,[xy.FITNESS_PLAN,xy.USER_PROFILE,xy.EXPERIENCE_LEVEL,xy.TRAINING_META],{absoluteWeek:b,snippetType:xz.MICROCYCLE}),[d,e]=await Promise.all([this.getMessageAgent(),this.getStructuredAgent()]),f=await w7({name:w8.MICROCYCLE_GENERATE,context:c,schema:xM,subAgents:[{message:d,structure:{agent:e,transform:a=>{let c="string"==typeof a?a:JSON.stringify(a);try{let a=JSON.parse(c);return JSON.stringify({...a,absoluteWeek:b})}catch{return c}}}}]},{model:"gpt-5.1"}),g=null;for(let a=1;a<=3;a++)try{a>1&&console.log(`[microcycle-generate] Retry attempt ${a}/3 for week ${b}`);let c=await f.invoke(`Absolute Week: ${b}`);if(!xO(c.response.days)){let a=c.response.days.map((a,b)=>a&&0!==a.trim().length?-1:b).filter(a=>-1!==a).map(a=>xC.DAY_NAMES[a]);throw Error(`Microcycle generate validation failed: Missing or empty days for ${a.join(", ")}. Expected all 7 days to be present and non-empty.`)}return console.log(`[microcycle-generate] Successfully generated day overviews and message for week ${b}${a>1?` (after ${a} attempts)`:""}`),{days:c.response.days,description:c.response.overview,isDeload:c.response.isDeload,message:c.message,structure:c.structure}}catch(c){if(console.error(`[microcycle-generate] Attempt ${a}/3 failed for week ${b}:`,(g=c instanceof Error?c:Error(String(c))).message),3===a)break}throw Error(`Failed to generate microcycle pattern for week ${b} after 3 attempts. Last error: ${g?.message||"Unknown error"}`)}async modifyMicrocycle(a,b,c){let d=b.absoluteWeek,e=await this.getContextService().getContext(a,[xy.USER,xy.USER_PROFILE,xy.CURRENT_MICROCYCLE,xy.DATE_CONTEXT],{microcycle:b}),[f,g]=await Promise.all([this.getMessageAgent(),this.getStructuredAgent()]),h=await w7({name:w8.MICROCYCLE_MODIFY,context:e,schema:xN,subAgents:[{message:f,structure:{agent:g,transform:a=>{let b="string"==typeof a?a:JSON.stringify(a);try{let a=JSON.parse(b);return JSON.stringify({...a,absoluteWeek:d})}catch{return b}}}}]},{model:"gpt-5.1"}),i=null;for(let a=1;a<=3;a++)try{a>1&&console.log(`[microcycle-modify] Retry attempt ${a}/3 for week ${d}`);let b=await h.invoke(c);if(!xO(b.response.days)){let a=b.response.days.map((a,b)=>a&&0!==a.trim().length?-1:b).filter(a=>-1!==a).map(a=>xC.DAY_NAMES[a]);throw Error(`Microcycle modify validation failed: Missing or empty days for ${a.join(", ")}. Expected all 7 days to be present and non-empty.`)}return console.log(`[microcycle-modify] Successfully modified day overviews and message for week ${d}${a>1?` (after ${a} attempts)`:""}`),{days:b.response.days,description:b.response.overview,isDeload:b.response.isDeload,message:b.message,structure:b.structure,wasModified:b.response.wasModified,modifications:b.response.modifications}}catch(b){if(console.error(`[microcycle-modify] Attempt ${a}/3 failed for week ${d}:`,(i=b instanceof Error?b:Error(String(b))).message),3===a)break}throw Error(`Failed to modify microcycle pattern for week ${d} after 3 attempts. Last error: ${i?.message||"Unknown error"}`)}}let xQ=xP.getInstance();a.s(["MicrocycleAgentService",()=>xP,"microcycleAgentService",0,xQ],242357)},534113,163516,a=>{"use strict";a.i(187361),a.i(242357),a.i(235570);var b=a.i(870107),c=a.i(574791);a.i(997239);var d=a.i(263926);a.i(458093);var e=a.i(647727);let f=e.z.object({description:e.z.string().describe("The updated structured text plan with PROGRAM ARCHITECTURE, WEEKLY SCHEDULE TEMPLATE, SESSION GUIDELINES, PROGRESSION STRATEGY, DELOAD PROTOCOL, and KEY PRINCIPLES sections"),wasModified:e.z.boolean().describe("Whether the plan was actually modified in response to the change request. False if the current plan already satisfies the request or no changes were needed."),modifications:e.z.string().default("").describe("Explanation of what changed and why (empty string if wasModified is false). When wasModified is true, describe specific changes made to the plan structure.")}),g=a=>`Parse the following fitness plan into structured format:

${a}`;var h=a.i(32875),i=a.i(873400);class j{static instance;messageAgentPromise=null;structuredAgentPromise=null;getContextService(){return h.ContextService.getInstance()}constructor(){}static getInstance(){return j.instance||(j.instance=new j),j.instance}async getMessageAgent(){return this.messageAgentPromise||(this.messageAgentPromise=(0,b.createAgent)({name:c.PROMPT_IDS.PLAN_MESSAGE,userPrompt:a=>{let b;return b=JSON.parse(a),`
Generate a short, friendly onboarding SMS for the client below based on their new fitness plan.

<User>
Name: ${b.userName}
</User>

<User Profile>
${b.userProfile||"No profile information available"}
</User Profile>

<Fitness Plan>
${b.overview}
</Fitness Plan>

Guidelines:
- This message is sent right after the trainer finishes creating the plan.
- It should sound natural and personal, as if the coach is texting the client directly.
- Focus on what the plan does and how it's structured (e.g., building from base to strength, using 4-day split, etc.).
- Translate complex language into clear, human terms.
- Limit to 1 or 2 messages total (each under 160 characters).
- Do not greet or include the client's name.
- Use first-person tone.
- Avoid em dashes and long sentences.
- Output only the message text (no JSON wrapper).
`.trim()}},{model:"gpt-5-nano"})),this.messageAgentPromise}async getStructuredAgent(){return this.structuredAgentPromise||(this.structuredAgentPromise=(0,b.createAgent)({name:c.PROMPT_IDS.PLAN_STRUCTURED,userPrompt:a=>{try{let b=JSON.parse(a),c=b.description||b.fitnessPlan||a;return g(c)}catch{return g(a)}},schema:d.PlanStructureSchema},{model:"gpt-5-nano",maxTokens:32e3})),this.structuredAgentPromise}async generateFitnessPlan(a){let d=await this.getContextService().getContext(a,[i.ContextType.USER,i.ContextType.USER_PROFILE]),[e,f]=await Promise.all([this.getMessageAgent(),this.getStructuredAgent()]),g=await (0,b.createAgent)({name:c.PROMPT_IDS.PLAN_GENERATE,context:d,subAgents:[{message:{agent:e,transform:b=>{try{return JSON.stringify({userName:a.name,userProfile:a.profile||"",overview:b})}catch{return JSON.stringify({userName:a.name,userProfile:a.profile||"",overview:b})}}},structure:f}]},{model:"gpt-5.1"}),h=await g.invoke("");return console.log(`[plan-generate] Generated fitness plan for user ${a.id}`),{description:h.response,message:h.message,structure:h.structure}}async modifyFitnessPlan(a,d,e){let g=await this.getContextService().getContext(a,[i.ContextType.USER,i.ContextType.USER_PROFILE,i.ContextType.FITNESS_PLAN],{planText:d.description||""}),h=await this.getStructuredAgent(),j=await (0,b.createAgent)({name:c.PROMPT_IDS.PLAN_MODIFY,context:g,schema:f,subAgents:[{structure:h}]},{model:"gpt-5.1"}),k=await j.invoke(e);return console.log(`[plan-modify] Modified fitness plan, wasModified: ${k.response.wasModified}`),{description:k.response.description,wasModified:k.response.wasModified,modifications:k.response.modifications,structure:k.structure}}}let k=j.getInstance();a.s(["FitnessPlanAgentService",()=>j,"fitnessPlanAgentService",0,k],163516),a.s([],534113)}];

//# sourceMappingURL=_dc34c18d._.js.map