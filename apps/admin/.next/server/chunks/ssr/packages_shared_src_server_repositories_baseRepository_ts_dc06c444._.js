module.exports=[449083,196400,316215,458093,647727,877750,225931,800525,640796,964081,a=>{"use strict";let b,c;a.i(346203),(bi=bl||(bl={})).assertEqual=a=>{},bi.assertIs=function(a){},bi.assertNever=function(a){throw Error()},bi.arrayToEnum=a=>{let b={};for(let c of a)b[c]=c;return b},bi.getValidEnumValues=a=>{let b=bi.objectKeys(a).filter(b=>"number"!=typeof a[a[b]]),c={};for(let d of b)c[d]=a[d];return bi.objectValues(c)},bi.objectValues=a=>bi.objectKeys(a).map(function(b){return a[b]}),bi.objectKeys="function"==typeof Object.keys?a=>Object.keys(a):a=>{let b=[];for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b},bi.find=(a,b)=>{for(let c of a)if(b(c))return c},bi.isInteger="function"==typeof Number.isInteger?a=>Number.isInteger(a):a=>"number"==typeof a&&Number.isFinite(a)&&Math.floor(a)===a,bi.joinValues=function(a,b=" | "){return a.map(a=>"string"==typeof a?`'${a}'`:a).join(b)},bi.jsonStringifyReplacer=(a,b)=>"bigint"==typeof b?b.toString():b,(bm||(bm={})).mergeShapes=(a,b)=>({...a,...b});let d=bl.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),e=a=>{switch(typeof a){case"undefined":return d.undefined;case"string":return d.string;case"number":return Number.isNaN(a)?d.nan:d.number;case"boolean":return d.boolean;case"function":return d.function;case"bigint":return d.bigint;case"symbol":return d.symbol;case"object":if(Array.isArray(a))return d.array;if(null===a)return d.null;if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return d.promise;if("undefined"!=typeof Map&&a instanceof Map)return d.map;if("undefined"!=typeof Set&&a instanceof Set)return d.set;if("undefined"!=typeof Date&&a instanceof Date)return d.date;return d.object;default:return d.unknown}};a.s(["ZodParsedType",0,d,"getParsedType",0,e,"objectUtil",()=>bm,"util",()=>bl],541035);let f=bl.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),g=a=>JSON.stringify(a,null,2).replace(/"([^"]+)":/g,"$1:");class h extends Error{get errors(){return this.issues}constructor(a){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const b=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,b):this.__proto__=b,this.name="ZodError",this.issues=a}format(a){let b=a||function(a){return a.message},c={_errors:[]},d=a=>{for(let e of a.issues)if("invalid_union"===e.code)e.unionErrors.map(d);else if("invalid_return_type"===e.code)d(e.returnTypeError);else if("invalid_arguments"===e.code)d(e.argumentsError);else if(0===e.path.length)c._errors.push(b(e));else{let a=c,d=0;for(;d<e.path.length;){let c=e.path[d];d===e.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(b(e))):a[c]=a[c]||{_errors:[]},a=a[c],d++}}};return d(this),c}static assert(a){if(!(a instanceof h))throw Error(`Not a ZodError: ${a}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,bl.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(a=a=>a.message){let b={},c=[];for(let d of this.issues)d.path.length>0?(b[d.path[0]]=b[d.path[0]]||[],b[d.path[0]].push(a(d))):c.push(a(d));return{formErrors:c,fieldErrors:b}}get formErrors(){return this.flatten()}}h.create=a=>new h(a),a.s(["ZodError",()=>h,"ZodIssueCode",0,f,"quotelessJson",0,g],196400);let i=(a,b)=>{let c;switch(a.code){case f.invalid_type:c=a.received===d.undefined?"Required":`Expected ${a.expected}, received ${a.received}`;break;case f.invalid_literal:c=`Invalid literal value, expected ${JSON.stringify(a.expected,bl.jsonStringifyReplacer)}`;break;case f.unrecognized_keys:c=`Unrecognized key(s) in object: ${bl.joinValues(a.keys,", ")}`;break;case f.invalid_union:c="Invalid input";break;case f.invalid_union_discriminator:c=`Invalid discriminator value. Expected ${bl.joinValues(a.options)}`;break;case f.invalid_enum_value:c=`Invalid enum value. Expected ${bl.joinValues(a.options)}, received '${a.received}'`;break;case f.invalid_arguments:c="Invalid function arguments";break;case f.invalid_return_type:c="Invalid function return type";break;case f.invalid_date:c="Invalid date";break;case f.invalid_string:"object"==typeof a.validation?"includes"in a.validation?(c=`Invalid input: must include "${a.validation.includes}"`,"number"==typeof a.validation.position&&(c=`${c} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?c=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?c=`Invalid input: must end with "${a.validation.endsWith}"`:bl.assertNever(a.validation):c="regex"!==a.validation?`Invalid ${a.validation}`:"Invalid";break;case f.too_small:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:"date"===a.type?`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:"Invalid input";break;case f.too_big:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"bigint"===a.type?`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"date"===a.type?`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:"Invalid input";break;case f.custom:c="Invalid input";break;case f.invalid_intersection_types:c="Intersection results could not be merged";break;case f.not_multiple_of:c=`Number must be a multiple of ${a.multipleOf}`;break;case f.not_finite:c="Number must be finite";break;default:c=b.defaultError,bl.assertNever(a)}return{message:c}},j=i;function k(a){j=a}function l(){return j}a.s(["getErrorMap",()=>l,"setErrorMap",()=>k],179729);let m=a=>{let{data:b,path:c,errorMaps:d,issueData:e}=a,f=[...c,...e.path||[]],g={...e,path:f};if(void 0!==e.message)return{...e,path:f,message:e.message};let h="";for(let a of d.filter(a=>!!a).slice().reverse())h=a(g,{data:b,defaultError:h}).message;return{...e,path:f,message:h}},n=[];function o(a,b){let c=j,d=m({issueData:b,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,c,c===i?void 0:i].filter(a=>!!a)});a.common.issues.push(d)}class p{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(a,b){let c=[];for(let d of b){if("aborted"===d.status)return q;"dirty"===d.status&&a.dirty(),c.push(d.value)}return{status:a.value,value:c}}static async mergeObjectAsync(a,b){let c=[];for(let a of b){let b=await a.key,d=await a.value;c.push({key:b,value:d})}return p.mergeObjectSync(a,c)}static mergeObjectSync(a,b){let c={};for(let d of b){let{key:b,value:e}=d;if("aborted"===b.status||"aborted"===e.status)return q;"dirty"===b.status&&a.dirty(),"dirty"===e.status&&a.dirty(),"__proto__"!==b.value&&(void 0!==e.value||d.alwaysSet)&&(c[b.value]=e.value)}return{status:a.value,value:c}}}let q=Object.freeze({status:"aborted"}),r=a=>({status:"dirty",value:a}),s=a=>({status:"valid",value:a}),t=a=>"aborted"===a.status,u=a=>"dirty"===a.status,v=a=>"valid"===a.status,w=a=>"undefined"!=typeof Promise&&a instanceof Promise;a.s(["DIRTY",0,r,"EMPTY_PATH",0,n,"INVALID",0,q,"OK",0,s,"ParseStatus",()=>p,"addIssueToContext",()=>o,"isAborted",0,t,"isAsync",0,w,"isDirty",0,u,"isValid",0,v,"makeIssue",0,m],480136),a.s([],531204),(bj=bn||(bn={})).errToObj=a=>"string"==typeof a?{message:a}:a||{},bj.toString=a=>"string"==typeof a?a:a?.message;class x{constructor(a,b,c,d){this._cachedPath=[],this.parent=a,this.data=b,this._path=c,this._key=d}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let y=(a,b)=>{if(v(b))return{success:!0,data:b.value};if(!a.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let b=new h(a.common.issues);return this._error=b,this._error}}};function z(a){if(!a)return{};let{errorMap:b,invalid_type_error:c,required_error:d,description:e}=a;if(b&&(c||d))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return b?{errorMap:b,description:e}:{errorMap:(b,e)=>{let{message:f}=a;return"invalid_enum_value"===b.code?{message:f??e.defaultError}:void 0===e.data?{message:f??d??e.defaultError}:"invalid_type"!==b.code?{message:e.defaultError}:{message:f??c??e.defaultError}},description:e}}class A{get description(){return this._def.description}_getType(a){return e(a.data)}_getOrReturnCtx(a,b){return b||{common:a.parent.common,data:a.data,parsedType:e(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}_processInputParams(a){return{status:new p,ctx:{common:a.parent.common,data:a.data,parsedType:e(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}}_parseSync(a){let b=this._parse(a);if(w(b))throw Error("Synchronous parse encountered promise.");return b}_parseAsync(a){return Promise.resolve(this._parse(a))}parse(a,b){let c=this.safeParse(a,b);if(c.success)return c.data;throw c.error}safeParse(a,b){let c={common:{issues:[],async:b?.async??!1,contextualErrorMap:b?.errorMap},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:e(a)},d=this._parseSync({data:a,path:c.path,parent:c});return y(c,d)}"~validate"(a){let b={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:e(a)};if(!this["~standard"].async)try{let c=this._parseSync({data:a,path:[],parent:b});return v(c)?{value:c.value}:{issues:b.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),b.common={issues:[],async:!0}}return this._parseAsync({data:a,path:[],parent:b}).then(a=>v(a)?{value:a.value}:{issues:b.common.issues})}async parseAsync(a,b){let c=await this.safeParseAsync(a,b);if(c.success)return c.data;throw c.error}async safeParseAsync(a,b){let c={common:{issues:[],contextualErrorMap:b?.errorMap,async:!0},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:e(a)},d=this._parse({data:a,path:c.path,parent:c});return y(c,await (w(d)?d:Promise.resolve(d)))}refine(a,b){return this._refinement((c,d)=>{let e=a(c),g=()=>d.addIssue({code:f.custom,..."string"==typeof b||void 0===b?{message:b}:"function"==typeof b?b(c):b});return"undefined"!=typeof Promise&&e instanceof Promise?e.then(a=>!!a||(g(),!1)):!!e||(g(),!1)})}refinement(a,b){return this._refinement((c,d)=>!!a(c)||(d.addIssue("function"==typeof b?b(c,d):b),!1))}_refinement(a){return new au({schema:this,typeName:bo.ZodEffects,effect:{type:"refinement",refinement:a}})}superRefine(a){return this._refinement(a)}constructor(a){this.spa=this.safeParseAsync,this._def=a,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return av.create(this,this._def)}nullable(){return aw.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ad.create(this)}promise(){return at.create(this,this._def)}or(a){return af.create([this,a],this._def)}and(a){return ai.create(this,a,this._def)}transform(a){return new au({...z(this._def),schema:this,typeName:bo.ZodEffects,effect:{type:"transform",transform:a}})}default(a){return new ax({...z(this._def),innerType:this,defaultValue:"function"==typeof a?a:()=>a,typeName:bo.ZodDefault})}brand(){return new aB({typeName:bo.ZodBranded,type:this,...z(this._def)})}catch(a){return new ay({...z(this._def),innerType:this,catchValue:"function"==typeof a?a:()=>a,typeName:bo.ZodCatch})}describe(a){return new this.constructor({...this._def,description:a})}pipe(a){return aC.create(this,a)}readonly(){return aD.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let B=/^c[^\s-]{8,}$/i,C=/^[0-9a-z]+$/,D=/^[0-9A-HJKMNP-TV-Z]{26}$/i,E=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,F=/^[a-z0-9_-]{21}$/i,G=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,H=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,I=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,J=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,K=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,L=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,M=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,N=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,O=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,P="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Q=RegExp(`^${P}$`);function R(a){let b="[0-5]\\d";a.precision?b=`${b}\\.\\d{${a.precision}}`:null==a.precision&&(b=`${b}(\\.\\d+)?`);let c=a.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${b})${c}`}function S(a){let b=`${P}T${R(a)}`,c=[];return c.push(a.local?"Z?":"Z"),a.offset&&c.push("([+-]\\d{2}:?\\d{2})"),b=`${b}(${c.join("|")})`,RegExp(`^${b}$`)}class T extends A{_parse(a){var c,e,g,h;let i;if(this._def.coerce&&(a.data=String(a.data)),this._getType(a)!==d.string){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.string,received:b.parsedType}),q}let j=new p;for(let d of this._def.checks)if("min"===d.kind)a.data.length<d.value&&(o(i=this._getOrReturnCtx(a,i),{code:f.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),j.dirty());else if("max"===d.kind)a.data.length>d.value&&(o(i=this._getOrReturnCtx(a,i),{code:f.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),j.dirty());else if("length"===d.kind){let b=a.data.length>d.value,c=a.data.length<d.value;(b||c)&&(i=this._getOrReturnCtx(a,i),b?o(i,{code:f.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}):c&&o(i,{code:f.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}),j.dirty())}else if("email"===d.kind)I.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{validation:"email",code:f.invalid_string,message:d.message}),j.dirty());else if("emoji"===d.kind)b||(b=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),b.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{validation:"emoji",code:f.invalid_string,message:d.message}),j.dirty());else if("uuid"===d.kind)E.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{validation:"uuid",code:f.invalid_string,message:d.message}),j.dirty());else if("nanoid"===d.kind)F.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{validation:"nanoid",code:f.invalid_string,message:d.message}),j.dirty());else if("cuid"===d.kind)B.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{validation:"cuid",code:f.invalid_string,message:d.message}),j.dirty());else if("cuid2"===d.kind)C.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{validation:"cuid2",code:f.invalid_string,message:d.message}),j.dirty());else if("ulid"===d.kind)D.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{validation:"ulid",code:f.invalid_string,message:d.message}),j.dirty());else if("url"===d.kind)try{new URL(a.data)}catch{o(i=this._getOrReturnCtx(a,i),{validation:"url",code:f.invalid_string,message:d.message}),j.dirty()}else"regex"===d.kind?(d.regex.lastIndex=0,d.regex.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{validation:"regex",code:f.invalid_string,message:d.message}),j.dirty())):"trim"===d.kind?a.data=a.data.trim():"includes"===d.kind?a.data.includes(d.value,d.position)||(o(i=this._getOrReturnCtx(a,i),{code:f.invalid_string,validation:{includes:d.value,position:d.position},message:d.message}),j.dirty()):"toLowerCase"===d.kind?a.data=a.data.toLowerCase():"toUpperCase"===d.kind?a.data=a.data.toUpperCase():"startsWith"===d.kind?a.data.startsWith(d.value)||(o(i=this._getOrReturnCtx(a,i),{code:f.invalid_string,validation:{startsWith:d.value},message:d.message}),j.dirty()):"endsWith"===d.kind?a.data.endsWith(d.value)||(o(i=this._getOrReturnCtx(a,i),{code:f.invalid_string,validation:{endsWith:d.value},message:d.message}),j.dirty()):"datetime"===d.kind?S(d).test(a.data)||(o(i=this._getOrReturnCtx(a,i),{code:f.invalid_string,validation:"datetime",message:d.message}),j.dirty()):"date"===d.kind?Q.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{code:f.invalid_string,validation:"date",message:d.message}),j.dirty()):"time"===d.kind?RegExp(`^${R(d)}$`).test(a.data)||(o(i=this._getOrReturnCtx(a,i),{code:f.invalid_string,validation:"time",message:d.message}),j.dirty()):"duration"===d.kind?H.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{validation:"duration",code:f.invalid_string,message:d.message}),j.dirty()):"ip"===d.kind?(c=a.data,!(("v4"===(e=d.version)||!e)&&J.test(c)||("v6"===e||!e)&&L.test(c))&&1&&(o(i=this._getOrReturnCtx(a,i),{validation:"ip",code:f.invalid_string,message:d.message}),j.dirty())):"jwt"===d.kind?!function(a,b){if(!G.test(a))return!1;try{let[c]=a.split("."),d=c.replace(/-/g,"+").replace(/_/g,"/").padEnd(c.length+(4-c.length%4)%4,"="),e=JSON.parse(atob(d));if("object"!=typeof e||null===e||"typ"in e&&e?.typ!=="JWT"||!e.alg||b&&e.alg!==b)return!1;return!0}catch{return!1}}(a.data,d.alg)&&(o(i=this._getOrReturnCtx(a,i),{validation:"jwt",code:f.invalid_string,message:d.message}),j.dirty()):"cidr"===d.kind?(g=a.data,!(("v4"===(h=d.version)||!h)&&K.test(g)||("v6"===h||!h)&&M.test(g))&&1&&(o(i=this._getOrReturnCtx(a,i),{validation:"cidr",code:f.invalid_string,message:d.message}),j.dirty())):"base64"===d.kind?N.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{validation:"base64",code:f.invalid_string,message:d.message}),j.dirty()):"base64url"===d.kind?O.test(a.data)||(o(i=this._getOrReturnCtx(a,i),{validation:"base64url",code:f.invalid_string,message:d.message}),j.dirty()):bl.assertNever(d);return{status:j.value,value:a.data}}_regex(a,b,c){return this.refinement(b=>a.test(b),{validation:b,code:f.invalid_string,...bn.errToObj(c)})}_addCheck(a){return new T({...this._def,checks:[...this._def.checks,a]})}email(a){return this._addCheck({kind:"email",...bn.errToObj(a)})}url(a){return this._addCheck({kind:"url",...bn.errToObj(a)})}emoji(a){return this._addCheck({kind:"emoji",...bn.errToObj(a)})}uuid(a){return this._addCheck({kind:"uuid",...bn.errToObj(a)})}nanoid(a){return this._addCheck({kind:"nanoid",...bn.errToObj(a)})}cuid(a){return this._addCheck({kind:"cuid",...bn.errToObj(a)})}cuid2(a){return this._addCheck({kind:"cuid2",...bn.errToObj(a)})}ulid(a){return this._addCheck({kind:"ulid",...bn.errToObj(a)})}base64(a){return this._addCheck({kind:"base64",...bn.errToObj(a)})}base64url(a){return this._addCheck({kind:"base64url",...bn.errToObj(a)})}jwt(a){return this._addCheck({kind:"jwt",...bn.errToObj(a)})}ip(a){return this._addCheck({kind:"ip",...bn.errToObj(a)})}cidr(a){return this._addCheck({kind:"cidr",...bn.errToObj(a)})}datetime(a){return"string"==typeof a?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:a}):this._addCheck({kind:"datetime",precision:void 0===a?.precision?null:a?.precision,offset:a?.offset??!1,local:a?.local??!1,...bn.errToObj(a?.message)})}date(a){return this._addCheck({kind:"date",message:a})}time(a){return"string"==typeof a?this._addCheck({kind:"time",precision:null,message:a}):this._addCheck({kind:"time",precision:void 0===a?.precision?null:a?.precision,...bn.errToObj(a?.message)})}duration(a){return this._addCheck({kind:"duration",...bn.errToObj(a)})}regex(a,b){return this._addCheck({kind:"regex",regex:a,...bn.errToObj(b)})}includes(a,b){return this._addCheck({kind:"includes",value:a,position:b?.position,...bn.errToObj(b?.message)})}startsWith(a,b){return this._addCheck({kind:"startsWith",value:a,...bn.errToObj(b)})}endsWith(a,b){return this._addCheck({kind:"endsWith",value:a,...bn.errToObj(b)})}min(a,b){return this._addCheck({kind:"min",value:a,...bn.errToObj(b)})}max(a,b){return this._addCheck({kind:"max",value:a,...bn.errToObj(b)})}length(a,b){return this._addCheck({kind:"length",value:a,...bn.errToObj(b)})}nonempty(a){return this.min(1,bn.errToObj(a))}trim(){return new T({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new T({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new T({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(a=>"datetime"===a.kind)}get isDate(){return!!this._def.checks.find(a=>"date"===a.kind)}get isTime(){return!!this._def.checks.find(a=>"time"===a.kind)}get isDuration(){return!!this._def.checks.find(a=>"duration"===a.kind)}get isEmail(){return!!this._def.checks.find(a=>"email"===a.kind)}get isURL(){return!!this._def.checks.find(a=>"url"===a.kind)}get isEmoji(){return!!this._def.checks.find(a=>"emoji"===a.kind)}get isUUID(){return!!this._def.checks.find(a=>"uuid"===a.kind)}get isNANOID(){return!!this._def.checks.find(a=>"nanoid"===a.kind)}get isCUID(){return!!this._def.checks.find(a=>"cuid"===a.kind)}get isCUID2(){return!!this._def.checks.find(a=>"cuid2"===a.kind)}get isULID(){return!!this._def.checks.find(a=>"ulid"===a.kind)}get isIP(){return!!this._def.checks.find(a=>"ip"===a.kind)}get isCIDR(){return!!this._def.checks.find(a=>"cidr"===a.kind)}get isBase64(){return!!this._def.checks.find(a=>"base64"===a.kind)}get isBase64url(){return!!this._def.checks.find(a=>"base64url"===a.kind)}get minLength(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxLength(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}T.create=a=>new T({checks:[],typeName:bo.ZodString,coerce:a?.coerce??!1,...z(a)});class U extends A{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(a){let b;if(this._def.coerce&&(a.data=Number(a.data)),this._getType(a)!==d.number){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.number,received:b.parsedType}),q}let c=new p;for(let d of this._def.checks)"int"===d.kind?bl.isInteger(a.data)||(o(b=this._getOrReturnCtx(a,b),{code:f.invalid_type,expected:"integer",received:"float",message:d.message}),c.dirty()):"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(o(b=this._getOrReturnCtx(a,b),{code:f.too_small,minimum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(o(b=this._getOrReturnCtx(a,b),{code:f.too_big,maximum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"multipleOf"===d.kind?0!==function(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}(a.data,d.value)&&(o(b=this._getOrReturnCtx(a,b),{code:f.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):"finite"===d.kind?Number.isFinite(a.data)||(o(b=this._getOrReturnCtx(a,b),{code:f.not_finite,message:d.message}),c.dirty()):bl.assertNever(d);return{status:c.value,value:a.data}}gte(a,b){return this.setLimit("min",a,!0,bn.toString(b))}gt(a,b){return this.setLimit("min",a,!1,bn.toString(b))}lte(a,b){return this.setLimit("max",a,!0,bn.toString(b))}lt(a,b){return this.setLimit("max",a,!1,bn.toString(b))}setLimit(a,b,c,d){return new U({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:bn.toString(d)}]})}_addCheck(a){return new U({...this._def,checks:[...this._def.checks,a]})}int(a){return this._addCheck({kind:"int",message:bn.toString(a)})}positive(a){return this._addCheck({kind:"min",value:0,inclusive:!1,message:bn.toString(a)})}negative(a){return this._addCheck({kind:"max",value:0,inclusive:!1,message:bn.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:0,inclusive:!0,message:bn.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:0,inclusive:!0,message:bn.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:bn.toString(b)})}finite(a){return this._addCheck({kind:"finite",message:bn.toString(a)})}safe(a){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:bn.toString(a)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:bn.toString(a)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}get isInt(){return!!this._def.checks.find(a=>"int"===a.kind||"multipleOf"===a.kind&&bl.isInteger(a.value))}get isFinite(){let a=null,b=null;for(let c of this._def.checks)if("finite"===c.kind||"int"===c.kind||"multipleOf"===c.kind)return!0;else"min"===c.kind?(null===b||c.value>b)&&(b=c.value):"max"===c.kind&&(null===a||c.value<a)&&(a=c.value);return Number.isFinite(b)&&Number.isFinite(a)}}U.create=a=>new U({checks:[],typeName:bo.ZodNumber,coerce:a?.coerce||!1,...z(a)});class V extends A{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(a){let b;if(this._def.coerce)try{a.data=BigInt(a.data)}catch{return this._getInvalidInput(a)}if(this._getType(a)!==d.bigint)return this._getInvalidInput(a);let c=new p;for(let d of this._def.checks)"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(o(b=this._getOrReturnCtx(a,b),{code:f.too_small,type:"bigint",minimum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(o(b=this._getOrReturnCtx(a,b),{code:f.too_big,type:"bigint",maximum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"multipleOf"===d.kind?a.data%d.value!==BigInt(0)&&(o(b=this._getOrReturnCtx(a,b),{code:f.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):bl.assertNever(d);return{status:c.value,value:a.data}}_getInvalidInput(a){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.bigint,received:b.parsedType}),q}gte(a,b){return this.setLimit("min",a,!0,bn.toString(b))}gt(a,b){return this.setLimit("min",a,!1,bn.toString(b))}lte(a,b){return this.setLimit("max",a,!0,bn.toString(b))}lt(a,b){return this.setLimit("max",a,!1,bn.toString(b))}setLimit(a,b,c,d){return new V({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:bn.toString(d)}]})}_addCheck(a){return new V({...this._def,checks:[...this._def.checks,a]})}positive(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:bn.toString(a)})}negative(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:bn.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:bn.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:bn.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:bn.toString(b)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}V.create=a=>new V({checks:[],typeName:bo.ZodBigInt,coerce:a?.coerce??!1,...z(a)});class W extends A{_parse(a){if(this._def.coerce&&(a.data=!!a.data),this._getType(a)!==d.boolean){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.boolean,received:b.parsedType}),q}return s(a.data)}}W.create=a=>new W({typeName:bo.ZodBoolean,coerce:a?.coerce||!1,...z(a)});class X extends A{_parse(a){let b;if(this._def.coerce&&(a.data=new Date(a.data)),this._getType(a)!==d.date){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.date,received:b.parsedType}),q}if(Number.isNaN(a.data.getTime()))return o(this._getOrReturnCtx(a),{code:f.invalid_date}),q;let c=new p;for(let d of this._def.checks)"min"===d.kind?a.data.getTime()<d.value&&(o(b=this._getOrReturnCtx(a,b),{code:f.too_small,message:d.message,inclusive:!0,exact:!1,minimum:d.value,type:"date"}),c.dirty()):"max"===d.kind?a.data.getTime()>d.value&&(o(b=this._getOrReturnCtx(a,b),{code:f.too_big,message:d.message,inclusive:!0,exact:!1,maximum:d.value,type:"date"}),c.dirty()):bl.assertNever(d);return{status:c.value,value:new Date(a.data.getTime())}}_addCheck(a){return new X({...this._def,checks:[...this._def.checks,a]})}min(a,b){return this._addCheck({kind:"min",value:a.getTime(),message:bn.toString(b)})}max(a,b){return this._addCheck({kind:"max",value:a.getTime(),message:bn.toString(b)})}get minDate(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return null!=a?new Date(a):null}get maxDate(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return null!=a?new Date(a):null}}X.create=a=>new X({checks:[],coerce:a?.coerce||!1,typeName:bo.ZodDate,...z(a)});class Y extends A{_parse(a){if(this._getType(a)!==d.symbol){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.symbol,received:b.parsedType}),q}return s(a.data)}}Y.create=a=>new Y({typeName:bo.ZodSymbol,...z(a)});class Z extends A{_parse(a){if(this._getType(a)!==d.undefined){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.undefined,received:b.parsedType}),q}return s(a.data)}}Z.create=a=>new Z({typeName:bo.ZodUndefined,...z(a)});class $ extends A{_parse(a){if(this._getType(a)!==d.null){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.null,received:b.parsedType}),q}return s(a.data)}}$.create=a=>new $({typeName:bo.ZodNull,...z(a)});class _ extends A{constructor(){super(...arguments),this._any=!0}_parse(a){return s(a.data)}}_.create=a=>new _({typeName:bo.ZodAny,...z(a)});class aa extends A{constructor(){super(...arguments),this._unknown=!0}_parse(a){return s(a.data)}}aa.create=a=>new aa({typeName:bo.ZodUnknown,...z(a)});class ab extends A{_parse(a){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.never,received:b.parsedType}),q}}ab.create=a=>new ab({typeName:bo.ZodNever,...z(a)});class ac extends A{_parse(a){if(this._getType(a)!==d.undefined){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.void,received:b.parsedType}),q}return s(a.data)}}ac.create=a=>new ac({typeName:bo.ZodVoid,...z(a)});class ad extends A{_parse(a){let{ctx:b,status:c}=this._processInputParams(a),e=this._def;if(b.parsedType!==d.array)return o(b,{code:f.invalid_type,expected:d.array,received:b.parsedType}),q;if(null!==e.exactLength){let a=b.data.length>e.exactLength.value,d=b.data.length<e.exactLength.value;(a||d)&&(o(b,{code:a?f.too_big:f.too_small,minimum:d?e.exactLength.value:void 0,maximum:a?e.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:e.exactLength.message}),c.dirty())}if(null!==e.minLength&&b.data.length<e.minLength.value&&(o(b,{code:f.too_small,minimum:e.minLength.value,type:"array",inclusive:!0,exact:!1,message:e.minLength.message}),c.dirty()),null!==e.maxLength&&b.data.length>e.maxLength.value&&(o(b,{code:f.too_big,maximum:e.maxLength.value,type:"array",inclusive:!0,exact:!1,message:e.maxLength.message}),c.dirty()),b.common.async)return Promise.all([...b.data].map((a,c)=>e.type._parseAsync(new x(b,a,b.path,c)))).then(a=>p.mergeArray(c,a));let g=[...b.data].map((a,c)=>e.type._parseSync(new x(b,a,b.path,c)));return p.mergeArray(c,g)}get element(){return this._def.type}min(a,b){return new ad({...this._def,minLength:{value:a,message:bn.toString(b)}})}max(a,b){return new ad({...this._def,maxLength:{value:a,message:bn.toString(b)}})}length(a,b){return new ad({...this._def,exactLength:{value:a,message:bn.toString(b)}})}nonempty(a){return this.min(1,a)}}ad.create=(a,b)=>new ad({type:a,minLength:null,maxLength:null,exactLength:null,typeName:bo.ZodArray,...z(b)});class ae extends A{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let a=this._def.shape(),b=bl.objectKeys(a);return this._cached={shape:a,keys:b},this._cached}_parse(a){if(this._getType(a)!==d.object){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.object,received:b.parsedType}),q}let{status:b,ctx:c}=this._processInputParams(a),{shape:e,keys:g}=this._getCached(),h=[];if(!(this._def.catchall instanceof ab&&"strip"===this._def.unknownKeys))for(let a in c.data)g.includes(a)||h.push(a);let i=[];for(let a of g){let b=e[a],d=c.data[a];i.push({key:{status:"valid",value:a},value:b._parse(new x(c,d,c.path,a)),alwaysSet:a in c.data})}if(this._def.catchall instanceof ab){let a=this._def.unknownKeys;if("passthrough"===a)for(let a of h)i.push({key:{status:"valid",value:a},value:{status:"valid",value:c.data[a]}});else if("strict"===a)h.length>0&&(o(c,{code:f.unrecognized_keys,keys:h}),b.dirty());else if("strip"===a);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let a=this._def.catchall;for(let b of h){let d=c.data[b];i.push({key:{status:"valid",value:b},value:a._parse(new x(c,d,c.path,b)),alwaysSet:b in c.data})}}return c.common.async?Promise.resolve().then(async()=>{let a=[];for(let b of i){let c=await b.key,d=await b.value;a.push({key:c,value:d,alwaysSet:b.alwaysSet})}return a}).then(a=>p.mergeObjectSync(b,a)):p.mergeObjectSync(b,i)}get shape(){return this._def.shape()}strict(a){return bn.errToObj,new ae({...this._def,unknownKeys:"strict",...void 0!==a?{errorMap:(b,c)=>{let d=this._def.errorMap?.(b,c).message??c.defaultError;return"unrecognized_keys"===b.code?{message:bn.errToObj(a).message??d}:{message:d}}}:{}})}strip(){return new ae({...this._def,unknownKeys:"strip"})}passthrough(){return new ae({...this._def,unknownKeys:"passthrough"})}extend(a){return new ae({...this._def,shape:()=>({...this._def.shape(),...a})})}merge(a){return new ae({unknownKeys:a._def.unknownKeys,catchall:a._def.catchall,shape:()=>({...this._def.shape(),...a._def.shape()}),typeName:bo.ZodObject})}setKey(a,b){return this.augment({[a]:b})}catchall(a){return new ae({...this._def,catchall:a})}pick(a){let b={};for(let c of bl.objectKeys(a))a[c]&&this.shape[c]&&(b[c]=this.shape[c]);return new ae({...this._def,shape:()=>b})}omit(a){let b={};for(let c of bl.objectKeys(this.shape))a[c]||(b[c]=this.shape[c]);return new ae({...this._def,shape:()=>b})}deepPartial(){return function a(b){if(b instanceof ae){let c={};for(let d in b.shape){let e=b.shape[d];c[d]=av.create(a(e))}return new ae({...b._def,shape:()=>c})}if(b instanceof ad)return new ad({...b._def,type:a(b.element)});if(b instanceof av)return av.create(a(b.unwrap()));if(b instanceof aw)return aw.create(a(b.unwrap()));if(b instanceof aj)return aj.create(b.items.map(b=>a(b)));else return b}(this)}partial(a){let b={};for(let c of bl.objectKeys(this.shape)){let d=this.shape[c];a&&!a[c]?b[c]=d:b[c]=d.optional()}return new ae({...this._def,shape:()=>b})}required(a){let b={};for(let c of bl.objectKeys(this.shape))if(a&&!a[c])b[c]=this.shape[c];else{let a=this.shape[c];for(;a instanceof av;)a=a._def.innerType;b[c]=a}return new ae({...this._def,shape:()=>b})}keyof(){return aq(bl.objectKeys(this.shape))}}ae.create=(a,b)=>new ae({shape:()=>a,unknownKeys:"strip",catchall:ab.create(),typeName:bo.ZodObject,...z(b)}),ae.strictCreate=(a,b)=>new ae({shape:()=>a,unknownKeys:"strict",catchall:ab.create(),typeName:bo.ZodObject,...z(b)}),ae.lazycreate=(a,b)=>new ae({shape:a,unknownKeys:"strip",catchall:ab.create(),typeName:bo.ZodObject,...z(b)});class af extends A{_parse(a){let{ctx:b}=this._processInputParams(a),c=this._def.options;if(b.common.async)return Promise.all(c.map(async a=>{let c={...b,common:{...b.common,issues:[]},parent:null};return{result:await a._parseAsync({data:b.data,path:b.path,parent:c}),ctx:c}})).then(function(a){for(let b of a)if("valid"===b.result.status)return b.result;for(let c of a)if("dirty"===c.result.status)return b.common.issues.push(...c.ctx.common.issues),c.result;let c=a.map(a=>new h(a.ctx.common.issues));return o(b,{code:f.invalid_union,unionErrors:c}),q});{let a,d=[];for(let e of c){let c={...b,common:{...b.common,issues:[]},parent:null},f=e._parseSync({data:b.data,path:b.path,parent:c});if("valid"===f.status)return f;"dirty"!==f.status||a||(a={result:f,ctx:c}),c.common.issues.length&&d.push(c.common.issues)}if(a)return b.common.issues.push(...a.ctx.common.issues),a.result;let e=d.map(a=>new h(a));return o(b,{code:f.invalid_union,unionErrors:e}),q}}get options(){return this._def.options}}af.create=(a,b)=>new af({options:a,typeName:bo.ZodUnion,...z(b)});let ag=a=>{if(a instanceof ao)return ag(a.schema);if(a instanceof au)return ag(a.innerType());if(a instanceof ap)return[a.value];if(a instanceof ar)return a.options;if(a instanceof as)return bl.objectValues(a.enum);else if(a instanceof ax)return ag(a._def.innerType);else if(a instanceof Z)return[void 0];else if(a instanceof $)return[null];else if(a instanceof av)return[void 0,...ag(a.unwrap())];else if(a instanceof aw)return[null,...ag(a.unwrap())];else if(a instanceof aB)return ag(a.unwrap());else if(a instanceof aD)return ag(a.unwrap());else if(a instanceof ay)return ag(a._def.innerType);else return[]};class ah extends A{_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==d.object)return o(b,{code:f.invalid_type,expected:d.object,received:b.parsedType}),q;let c=this.discriminator,e=b.data[c],g=this.optionsMap.get(e);return g?b.common.async?g._parseAsync({data:b.data,path:b.path,parent:b}):g._parseSync({data:b.data,path:b.path,parent:b}):(o(b,{code:f.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[c]}),q)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(a,b,c){let d=new Map;for(let c of b){let b=ag(c.shape[a]);if(!b.length)throw Error(`A discriminator value for key \`${a}\` could not be extracted from all schema options`);for(let e of b){if(d.has(e))throw Error(`Discriminator property ${String(a)} has duplicate value ${String(e)}`);d.set(e,c)}}return new ah({typeName:bo.ZodDiscriminatedUnion,discriminator:a,options:b,optionsMap:d,...z(c)})}}class ai extends A{_parse(a){let{status:b,ctx:c}=this._processInputParams(a),g=(a,g)=>{if(t(a)||t(g))return q;let h=function a(b,c){let f=e(b),g=e(c);if(b===c)return{valid:!0,data:b};if(f===d.object&&g===d.object){let d=bl.objectKeys(c),e=bl.objectKeys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1};f[d]=e.data}return{valid:!0,data:f}}if(f===d.array&&g===d.array){if(b.length!==c.length)return{valid:!1};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1};d.push(f.data)}return{valid:!0,data:d}}if(f===d.date&&g===d.date&&+b==+c)return{valid:!0,data:b};return{valid:!1}}(a.value,g.value);return h.valid?((u(a)||u(g))&&b.dirty(),{status:b.value,value:h.data}):(o(c,{code:f.invalid_intersection_types}),q)};return c.common.async?Promise.all([this._def.left._parseAsync({data:c.data,path:c.path,parent:c}),this._def.right._parseAsync({data:c.data,path:c.path,parent:c})]).then(([a,b])=>g(a,b)):g(this._def.left._parseSync({data:c.data,path:c.path,parent:c}),this._def.right._parseSync({data:c.data,path:c.path,parent:c}))}}ai.create=(a,b,c)=>new ai({left:a,right:b,typeName:bo.ZodIntersection,...z(c)});class aj extends A{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==d.array)return o(c,{code:f.invalid_type,expected:d.array,received:c.parsedType}),q;if(c.data.length<this._def.items.length)return o(c,{code:f.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),q;!this._def.rest&&c.data.length>this._def.items.length&&(o(c,{code:f.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b.dirty());let e=[...c.data].map((a,b)=>{let d=this._def.items[b]||this._def.rest;return d?d._parse(new x(c,a,c.path,b)):null}).filter(a=>!!a);return c.common.async?Promise.all(e).then(a=>p.mergeArray(b,a)):p.mergeArray(b,e)}get items(){return this._def.items}rest(a){return new aj({...this._def,rest:a})}}aj.create=(a,b)=>{if(!Array.isArray(a))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new aj({items:a,typeName:bo.ZodTuple,rest:null,...z(b)})};class ak extends A{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==d.object)return o(c,{code:f.invalid_type,expected:d.object,received:c.parsedType}),q;let e=[],g=this._def.keyType,h=this._def.valueType;for(let a in c.data)e.push({key:g._parse(new x(c,a,c.path,a)),value:h._parse(new x(c,c.data[a],c.path,a)),alwaysSet:a in c.data});return c.common.async?p.mergeObjectAsync(b,e):p.mergeObjectSync(b,e)}get element(){return this._def.valueType}static create(a,b,c){return new ak(b instanceof A?{keyType:a,valueType:b,typeName:bo.ZodRecord,...z(c)}:{keyType:T.create(),valueType:a,typeName:bo.ZodRecord,...z(b)})}}class al extends A{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==d.map)return o(c,{code:f.invalid_type,expected:d.map,received:c.parsedType}),q;let e=this._def.keyType,g=this._def.valueType,h=[...c.data.entries()].map(([a,b],d)=>({key:e._parse(new x(c,a,c.path,[d,"key"])),value:g._parse(new x(c,b,c.path,[d,"value"]))}));if(c.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of h){let d=await c.key,e=await c.value;if("aborted"===d.status||"aborted"===e.status)return q;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}})}{let a=new Map;for(let c of h){let d=c.key,e=c.value;if("aborted"===d.status||"aborted"===e.status)return q;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}}}}al.create=(a,b,c)=>new al({valueType:b,keyType:a,typeName:bo.ZodMap,...z(c)});class am extends A{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==d.set)return o(c,{code:f.invalid_type,expected:d.set,received:c.parsedType}),q;let e=this._def;null!==e.minSize&&c.data.size<e.minSize.value&&(o(c,{code:f.too_small,minimum:e.minSize.value,type:"set",inclusive:!0,exact:!1,message:e.minSize.message}),b.dirty()),null!==e.maxSize&&c.data.size>e.maxSize.value&&(o(c,{code:f.too_big,maximum:e.maxSize.value,type:"set",inclusive:!0,exact:!1,message:e.maxSize.message}),b.dirty());let g=this._def.valueType;function h(a){let c=new Set;for(let d of a){if("aborted"===d.status)return q;"dirty"===d.status&&b.dirty(),c.add(d.value)}return{status:b.value,value:c}}let i=[...c.data.values()].map((a,b)=>g._parse(new x(c,a,c.path,b)));return c.common.async?Promise.all(i).then(a=>h(a)):h(i)}min(a,b){return new am({...this._def,minSize:{value:a,message:bn.toString(b)}})}max(a,b){return new am({...this._def,maxSize:{value:a,message:bn.toString(b)}})}size(a,b){return this.min(a,b).max(a,b)}nonempty(a){return this.min(1,a)}}am.create=(a,b)=>new am({valueType:a,minSize:null,maxSize:null,typeName:bo.ZodSet,...z(b)});class an extends A{constructor(){super(...arguments),this.validate=this.implement}_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==d.function)return o(b,{code:f.invalid_type,expected:d.function,received:b.parsedType}),q;function c(a,c){return m({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,j,i].filter(a=>!!a),issueData:{code:f.invalid_arguments,argumentsError:c}})}function e(a,c){return m({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,j,i].filter(a=>!!a),issueData:{code:f.invalid_return_type,returnTypeError:c}})}let g={errorMap:b.common.contextualErrorMap},k=b.data;if(this._def.returns instanceof at){let a=this;return s(async function(...b){let d=new h([]),f=await a._def.args.parseAsync(b,g).catch(a=>{throw d.addIssue(c(b,a)),d}),i=await Reflect.apply(k,this,f);return await a._def.returns._def.type.parseAsync(i,g).catch(a=>{throw d.addIssue(e(i,a)),d})})}{let a=this;return s(function(...b){let d=a._def.args.safeParse(b,g);if(!d.success)throw new h([c(b,d.error)]);let f=Reflect.apply(k,this,d.data),i=a._def.returns.safeParse(f,g);if(!i.success)throw new h([e(f,i.error)]);return i.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...a){return new an({...this._def,args:aj.create(a).rest(aa.create())})}returns(a){return new an({...this._def,returns:a})}implement(a){return this.parse(a)}strictImplement(a){return this.parse(a)}static create(a,b,c){return new an({args:a||aj.create([]).rest(aa.create()),returns:b||aa.create(),typeName:bo.ZodFunction,...z(c)})}}class ao extends A{get schema(){return this._def.getter()}_parse(a){let{ctx:b}=this._processInputParams(a);return this._def.getter()._parse({data:b.data,path:b.path,parent:b})}}ao.create=(a,b)=>new ao({getter:a,typeName:bo.ZodLazy,...z(b)});class ap extends A{_parse(a){if(a.data!==this._def.value){let b=this._getOrReturnCtx(a);return o(b,{received:b.data,code:f.invalid_literal,expected:this._def.value}),q}return{status:"valid",value:a.data}}get value(){return this._def.value}}function aq(a,b){return new ar({values:a,typeName:bo.ZodEnum,...z(b)})}ap.create=(a,b)=>new ap({value:a,typeName:bo.ZodLiteral,...z(b)});class ar extends A{_parse(a){if("string"!=typeof a.data){let b=this._getOrReturnCtx(a),c=this._def.values;return o(b,{expected:bl.joinValues(c),received:b.parsedType,code:f.invalid_type}),q}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(a.data)){let b=this._getOrReturnCtx(a),c=this._def.values;return o(b,{received:b.data,code:f.invalid_enum_value,options:c}),q}return s(a.data)}get options(){return this._def.values}get enum(){let a={};for(let b of this._def.values)a[b]=b;return a}get Values(){let a={};for(let b of this._def.values)a[b]=b;return a}get Enum(){let a={};for(let b of this._def.values)a[b]=b;return a}extract(a,b=this._def){return ar.create(a,{...this._def,...b})}exclude(a,b=this._def){return ar.create(this.options.filter(b=>!a.includes(b)),{...this._def,...b})}}ar.create=aq;class as extends A{_parse(a){let b=bl.getValidEnumValues(this._def.values),c=this._getOrReturnCtx(a);if(c.parsedType!==d.string&&c.parsedType!==d.number){let a=bl.objectValues(b);return o(c,{expected:bl.joinValues(a),received:c.parsedType,code:f.invalid_type}),q}if(this._cache||(this._cache=new Set(bl.getValidEnumValues(this._def.values))),!this._cache.has(a.data)){let a=bl.objectValues(b);return o(c,{received:c.data,code:f.invalid_enum_value,options:a}),q}return s(a.data)}get enum(){return this._def.values}}as.create=(a,b)=>new as({values:a,typeName:bo.ZodNativeEnum,...z(b)});class at extends A{unwrap(){return this._def.type}_parse(a){let{ctx:b}=this._processInputParams(a);return b.parsedType!==d.promise&&!1===b.common.async?(o(b,{code:f.invalid_type,expected:d.promise,received:b.parsedType}),q):s((b.parsedType===d.promise?b.data:Promise.resolve(b.data)).then(a=>this._def.type.parseAsync(a,{path:b.path,errorMap:b.common.contextualErrorMap})))}}at.create=(a,b)=>new at({type:a,typeName:bo.ZodPromise,...z(b)});class au extends A{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===bo.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=this._def.effect||null,e={addIssue:a=>{o(c,a),a.fatal?b.abort():b.dirty()},get path(){return c.path}};if(e.addIssue=e.addIssue.bind(e),"preprocess"===d.type){let a=d.transform(c.data,e);if(c.common.async)return Promise.resolve(a).then(async a=>{if("aborted"===b.value)return q;let d=await this._def.schema._parseAsync({data:a,path:c.path,parent:c});return"aborted"===d.status?q:"dirty"===d.status||"dirty"===b.value?r(d.value):d});{if("aborted"===b.value)return q;let d=this._def.schema._parseSync({data:a,path:c.path,parent:c});return"aborted"===d.status?q:"dirty"===d.status||"dirty"===b.value?r(d.value):d}}if("refinement"===d.type){let a=a=>{let b=d.refinement(a,e);if(c.common.async)return Promise.resolve(b);if(b instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(c=>"aborted"===c.status?q:("dirty"===c.status&&b.dirty(),a(c.value).then(()=>({status:b.value,value:c.value}))));{let d=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===d.status?q:("dirty"===d.status&&b.dirty(),a(d.value),{status:b.value,value:d.value})}}if("transform"===d.type)if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(a=>v(a)?Promise.resolve(d.transform(a.value,e)).then(a=>({status:b.value,value:a})):q);else{let a=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});if(!v(a))return q;let f=d.transform(a.value,e);if(f instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:b.value,value:f}}bl.assertNever(d)}}au.create=(a,b,c)=>new au({schema:a,typeName:bo.ZodEffects,effect:b,...z(c)}),au.createWithPreprocess=(a,b,c)=>new au({schema:b,effect:{type:"preprocess",transform:a},typeName:bo.ZodEffects,...z(c)});class av extends A{_parse(a){return this._getType(a)===d.undefined?s(void 0):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}av.create=(a,b)=>new av({innerType:a,typeName:bo.ZodOptional,...z(b)});class aw extends A{_parse(a){return this._getType(a)===d.null?s(null):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}aw.create=(a,b)=>new aw({innerType:a,typeName:bo.ZodNullable,...z(b)});class ax extends A{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return b.parsedType===d.undefined&&(c=this._def.defaultValue()),this._def.innerType._parse({data:c,path:b.path,parent:b})}removeDefault(){return this._def.innerType}}ax.create=(a,b)=>new ax({innerType:a,typeName:bo.ZodDefault,defaultValue:"function"==typeof b.default?b.default:()=>b.default,...z(b)});class ay extends A{_parse(a){let{ctx:b}=this._processInputParams(a),c={...b,common:{...b.common,issues:[]}},d=this._def.innerType._parse({data:c.data,path:c.path,parent:{...c}});return w(d)?d.then(a=>({status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new h(c.common.issues)},input:c.data})})):{status:"valid",value:"valid"===d.status?d.value:this._def.catchValue({get error(){return new h(c.common.issues)},input:c.data})}}removeCatch(){return this._def.innerType}}ay.create=(a,b)=>new ay({innerType:a,typeName:bo.ZodCatch,catchValue:"function"==typeof b.catch?b.catch:()=>b.catch,...z(b)});class az extends A{_parse(a){if(this._getType(a)!==d.nan){let b=this._getOrReturnCtx(a);return o(b,{code:f.invalid_type,expected:d.nan,received:b.parsedType}),q}return{status:"valid",value:a.data}}}az.create=a=>new az({typeName:bo.ZodNaN,...z(a)});let aA=Symbol("zod_brand");class aB extends A{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return this._def.type._parse({data:c,path:b.path,parent:b})}unwrap(){return this._def.type}}class aC extends A{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?q:"dirty"===a.status?(b.dirty(),r(a.value)):this._def.out._parseAsync({data:a.value,path:c.path,parent:c})})();{let a=this._def.in._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?q:"dirty"===a.status?(b.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:c.path,parent:c})}}static create(a,b){return new aC({in:a,out:b,typeName:bo.ZodPipeline})}}class aD extends A{_parse(a){let b=this._def.innerType._parse(a),c=a=>(v(a)&&(a.value=Object.freeze(a.value)),a);return w(b)?b.then(a=>c(a)):c(b)}unwrap(){return this._def.innerType}}function aE(a,b){let c="function"==typeof a?a(b):"string"==typeof a?{message:a}:a;return"string"==typeof c?{message:c}:c}function aF(a,b={},c){return a?_.create().superRefine((d,e)=>{let f=a(d);if(f instanceof Promise)return f.then(a=>{if(!a){let a=aE(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}});if(!f){let a=aE(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}}):_.create()}aD.create=(a,b)=>new aD({innerType:a,typeName:bo.ZodReadonly,...z(b)});let aG={object:ae.lazycreate};(bk=bo||(bo={})).ZodString="ZodString",bk.ZodNumber="ZodNumber",bk.ZodNaN="ZodNaN",bk.ZodBigInt="ZodBigInt",bk.ZodBoolean="ZodBoolean",bk.ZodDate="ZodDate",bk.ZodSymbol="ZodSymbol",bk.ZodUndefined="ZodUndefined",bk.ZodNull="ZodNull",bk.ZodAny="ZodAny",bk.ZodUnknown="ZodUnknown",bk.ZodNever="ZodNever",bk.ZodVoid="ZodVoid",bk.ZodArray="ZodArray",bk.ZodObject="ZodObject",bk.ZodUnion="ZodUnion",bk.ZodDiscriminatedUnion="ZodDiscriminatedUnion",bk.ZodIntersection="ZodIntersection",bk.ZodTuple="ZodTuple",bk.ZodRecord="ZodRecord",bk.ZodMap="ZodMap",bk.ZodSet="ZodSet",bk.ZodFunction="ZodFunction",bk.ZodLazy="ZodLazy",bk.ZodLiteral="ZodLiteral",bk.ZodEnum="ZodEnum",bk.ZodEffects="ZodEffects",bk.ZodNativeEnum="ZodNativeEnum",bk.ZodOptional="ZodOptional",bk.ZodNullable="ZodNullable",bk.ZodDefault="ZodDefault",bk.ZodCatch="ZodCatch",bk.ZodPromise="ZodPromise",bk.ZodBranded="ZodBranded",bk.ZodPipeline="ZodPipeline",bk.ZodReadonly="ZodReadonly";let aH=(a,b={message:`Input not instance of ${a.name}`})=>aF(b=>b instanceof a,b),aI=T.create,aJ=U.create,aK=az.create,aL=V.create,aM=W.create,aN=X.create,aO=Y.create,aP=Z.create,aQ=$.create,aR=_.create,aS=aa.create,aT=ab.create,aU=ac.create,aV=ad.create,aW=ae.create,aX=ae.strictCreate,aY=af.create,aZ=ah.create,a$=ai.create,a_=aj.create,a0=ak.create,a1=al.create,a2=am.create,a3=an.create,a4=ao.create,a5=ap.create,a6=ar.create,a7=as.create,a8=at.create,a9=au.create,ba=av.create,bb=aw.create,bc=au.createWithPreprocess,bd=aC.create,be=()=>aI().optional(),bf=()=>aJ().optional(),bg=()=>aM().optional(),bh={string:a=>T.create({...a,coerce:!0}),number:a=>U.create({...a,coerce:!0}),boolean:a=>W.create({...a,coerce:!0}),bigint:a=>V.create({...a,coerce:!0}),date:a=>X.create({...a,coerce:!0})};a.s(["BRAND",0,aA,"NEVER",0,q,"Schema",()=>A,"ZodAny",()=>_,"ZodArray",()=>ad,"ZodBigInt",()=>V,"ZodBoolean",()=>W,"ZodBranded",()=>aB,"ZodCatch",()=>ay,"ZodDate",()=>X,"ZodDefault",()=>ax,"ZodDiscriminatedUnion",()=>ah,"ZodEffects",()=>au,"ZodEnum",()=>ar,"ZodFirstPartyTypeKind",()=>bo,"ZodFunction",()=>an,"ZodIntersection",()=>ai,"ZodLazy",()=>ao,"ZodLiteral",()=>ap,"ZodMap",()=>al,"ZodNaN",()=>az,"ZodNativeEnum",()=>as,"ZodNever",()=>ab,"ZodNull",()=>$,"ZodNullable",()=>aw,"ZodNumber",()=>U,"ZodObject",()=>ae,"ZodOptional",()=>av,"ZodPipeline",()=>aC,"ZodPromise",()=>at,"ZodReadonly",()=>aD,"ZodRecord",()=>ak,"ZodSchema",()=>A,"ZodSet",()=>am,"ZodString",()=>T,"ZodSymbol",()=>Y,"ZodTransformer",()=>au,"ZodTuple",()=>aj,"ZodType",()=>A,"ZodUndefined",()=>Z,"ZodUnion",()=>af,"ZodUnknown",()=>aa,"ZodVoid",()=>ac,"any",()=>aR,"array",()=>aV,"bigint",()=>aL,"boolean",()=>aM,"coerce",0,bh,"custom",()=>aF,"date",()=>aN,"datetimeRegex",()=>S,"discriminatedUnion",()=>aZ,"effect",()=>a9,"enum",()=>a6,"function",()=>a3,"instanceof",()=>aH,"intersection",()=>a$,"late",0,aG,"lazy",()=>a4,"literal",()=>a5,"map",()=>a1,"nan",()=>aK,"nativeEnum",()=>a7,"never",()=>aT,"null",()=>aQ,"nullable",()=>bb,"number",()=>aJ,"object",()=>aW,"oboolean",()=>bg,"onumber",()=>bf,"optional",()=>ba,"ostring",()=>be,"pipeline",()=>bd,"preprocess",()=>bc,"promise",()=>a8,"record",()=>a0,"set",()=>a2,"strictObject",()=>aX,"string",()=>aI,"symbol",()=>aO,"transformer",()=>a9,"tuple",()=>a_,"undefined",()=>aP,"union",()=>aY,"unknown",()=>aS,"void",()=>aU],316215),a.s([],626449),a.i(626449),a.i(179729),a.s(["defaultErrorMap",0,i,"getErrorMap",()=>l,"setErrorMap",()=>k],469834),a.i(469834),a.i(480136),a.i(531204),a.i(541035),a.i(316215),a.i(196400),a.s(["BRAND",0,aA,"DIRTY",0,r,"EMPTY_PATH",0,n,"INVALID",0,q,"NEVER",0,q,"OK",0,s,"ParseStatus",()=>p,"Schema",()=>A,"ZodAny",()=>_,"ZodArray",()=>ad,"ZodBigInt",()=>V,"ZodBoolean",()=>W,"ZodBranded",()=>aB,"ZodCatch",()=>ay,"ZodDate",()=>X,"ZodDefault",()=>ax,"ZodDiscriminatedUnion",()=>ah,"ZodEffects",()=>au,"ZodEnum",()=>ar,"ZodError",()=>h,"ZodFirstPartyTypeKind",()=>bo,"ZodFunction",()=>an,"ZodIntersection",()=>ai,"ZodIssueCode",0,f,"ZodLazy",()=>ao,"ZodLiteral",()=>ap,"ZodMap",()=>al,"ZodNaN",()=>az,"ZodNativeEnum",()=>as,"ZodNever",()=>ab,"ZodNull",()=>$,"ZodNullable",()=>aw,"ZodNumber",()=>U,"ZodObject",()=>ae,"ZodOptional",()=>av,"ZodParsedType",0,d,"ZodPipeline",()=>aC,"ZodPromise",()=>at,"ZodReadonly",()=>aD,"ZodRecord",()=>ak,"ZodSchema",()=>A,"ZodSet",()=>am,"ZodString",()=>T,"ZodSymbol",()=>Y,"ZodTransformer",()=>au,"ZodTuple",()=>aj,"ZodType",()=>A,"ZodUndefined",()=>Z,"ZodUnion",()=>af,"ZodUnknown",()=>aa,"ZodVoid",()=>ac,"addIssueToContext",()=>o,"any",()=>aR,"array",()=>aV,"bigint",()=>aL,"boolean",()=>aM,"coerce",0,bh,"custom",()=>aF,"date",()=>aN,"datetimeRegex",()=>S,"defaultErrorMap",0,i,"discriminatedUnion",()=>aZ,"effect",()=>a9,"enum",()=>a6,"function",()=>a3,"getErrorMap",()=>l,"getParsedType",0,e,"instanceof",()=>aH,"intersection",()=>a$,"isAborted",0,t,"isAsync",0,w,"isDirty",0,u,"isValid",0,v,"late",0,aG,"lazy",()=>a4,"literal",()=>a5,"makeIssue",0,m,"map",()=>a1,"nan",()=>aK,"nativeEnum",()=>a7,"never",()=>aT,"null",()=>aQ,"nullable",()=>bb,"number",()=>aJ,"object",()=>aW,"objectUtil",()=>bm,"oboolean",()=>bg,"onumber",()=>bf,"optional",()=>ba,"ostring",()=>be,"pipeline",()=>bd,"preprocess",()=>bc,"promise",()=>a8,"quotelessJson",0,g,"record",()=>a0,"set",()=>a2,"setErrorMap",()=>k,"strictObject",()=>aX,"string",()=>aI,"symbol",()=>aO,"transformer",()=>a9,"tuple",()=>a_,"undefined",()=>aP,"union",()=>aY,"unknown",()=>aS,"util",()=>bl,"void",()=>aU],89699);var bi,bj,bk,bl,bm,bn,bo,bp=a.i(89699);a.s(["default",0,bp],546508),a.s([],458093),a.i(546508);var bq=bp;a.s(["z",0,bq],647727);var bq=bp;let br=bq.object({DATABASE_URL:bq.string().min(1,"DATABASE_URL is required"),SESSION_ENCRYPTION_KEY:bq.string().optional(),TWILIO_ACCOUNT_SID:bq.string().min(1,"TWILIO_ACCOUNT_SID is required"),TWILIO_AUTH_TOKEN:bq.string().min(1,"TWILIO_AUTH_TOKEN is required"),TWILIO_NUMBER:bq.string().min(1,"TWILIO_NUMBER is required"),STRIPE_SECRET_KEY:bq.string().min(1,"STRIPE_SECRET_KEY is required"),STRIPE_WEBHOOK_SECRET:bq.string().optional(),OPENAI_API_KEY:bq.string().min(1,"OPENAI_API_KEY is required"),GOOGLE_API_KEY:bq.string().min(1,"GOOGLE_API_KEY is required"),XAI_API_KEY:bq.string().optional(),PINECONE_API_KEY:bq.string().min(1,"PINECONE_API_KEY is required"),PINECONE_INDEX:bq.string().min(1,"PINECONE_INDEX is required"),CRON_SECRET:bq.string().optional(),INNGEST_EVENT_KEY:bq.string().optional(),INNGEST_SIGNING_KEY:bq.string().optional(),NODE_ENV:bq.enum(["development","test","production"]).default("development"),APP_ENV:bq.enum(["development","staging","production"]).optional()}),bs=null;function bt(){return bs||(bs=function(){let a=br.safeParse(process.env);if(!a.success){let b=a.error.errors.map(a=>`  - ${a.path.join(".")}: ${a.message}`).join("\n");throw Error(`Server environment validation failed:
${b}

Ensure all required environment variables are set.`)}return a.data}()),bs}function bu(){let a=bt();return{databaseUrl:a.DATABASE_URL,sessionEncryptionKey:a.SESSION_ENCRYPTION_KEY}}function bv(){let a=bt();return{accountSid:a.TWILIO_ACCOUNT_SID,authToken:a.TWILIO_AUTH_TOKEN,phoneNumber:a.TWILIO_NUMBER}}function bw(){let a=bt();return{secretKey:a.STRIPE_SECRET_KEY,webhookSecret:a.STRIPE_WEBHOOK_SECRET}}function bx(){let a=bt();return{openaiApiKey:a.OPENAI_API_KEY,googleApiKey:a.GOOGLE_API_KEY,xaiApiKey:a.XAI_API_KEY}}function by(){let a=bt();return{nodeEnv:a.NODE_ENV,appEnv:a.APP_ENV,isDevelopment:"development"===a.NODE_ENV,isProduction:"production"===a.NODE_ENV,isTest:"test"===a.NODE_ENV}}function bz(a){return void 0===a||void 0===a}function bA(a){return"string"==typeof a}function bB(a){return"number"==typeof a}function bC(a){return"boolean"==typeof a}function bD(a){return"bigint"==typeof a}function bE(a){return"function"==typeof a}function bF(a){return"object"==typeof a&&null!==a}function bG(a){return Object.freeze(a)}function bH(a){return bI(a)?a:[a]}function bI(a){return Array.isArray(a)}function bJ(a){return a}a.s(["getAiSecrets",()=>bx,"getDatabaseSecrets",()=>bu,"getStripeSecrets",()=>bw,"getTwilioSecrets",()=>bv],877750),a.s(["getEnvironmentSettings",()=>by],225931),a.s([],800525);let bK=Object.prototype.toString,bL=bG({is:a=>"AlterTableNode"===a.kind,create:a=>bG({kind:"AlterTableNode",table:a}),cloneWithTableProps:(a,b)=>bG({...a,...b}),cloneWithColumnAlteration:(a,b)=>bG({...a,columnAlterations:a.columnAlterations?[...a.columnAlterations,b]:[b]})}),bM=bG({is:a=>"IdentifierNode"===a.kind,create:a=>bG({kind:"IdentifierNode",name:a})}),bN=bG({is:a=>"CreateIndexNode"===a.kind,create:a=>bG({kind:"CreateIndexNode",name:bM.create(a)}),cloneWith:(a,b)=>bG({...a,...b}),cloneWithColumns:(a,b)=>bG({...a,columns:[...a.columns||[],...b]})}),bO=bG({is:a=>"CreateSchemaNode"===a.kind,create:(a,b)=>bG({kind:"CreateSchemaNode",schema:bM.create(a),...b}),cloneWith:(a,b)=>bG({...a,...b})}),bP=["preserve rows","delete rows","drop"],bQ=bG({is:a=>"CreateTableNode"===a.kind,create:a=>bG({kind:"CreateTableNode",table:a,columns:bG([])}),cloneWithColumn:(a,b)=>bG({...a,columns:bG([...a.columns,b])}),cloneWithConstraint:(a,b)=>bG({...a,constraints:a.constraints?bG([...a.constraints,b]):bG([b])}),cloneWithFrontModifier:(a,b)=>bG({...a,frontModifiers:a.frontModifiers?bG([...a.frontModifiers,b]):bG([b])}),cloneWithEndModifier:(a,b)=>bG({...a,endModifiers:a.endModifiers?bG([...a.endModifiers,b]):bG([b])}),cloneWith:(a,b)=>bG({...a,...b})}),bR=bG({is:a=>"SchemableIdentifierNode"===a.kind,create:a=>bG({kind:"SchemableIdentifierNode",identifier:bM.create(a)}),createWithSchema:(a,b)=>bG({kind:"SchemableIdentifierNode",schema:bM.create(a),identifier:bM.create(b)})}),bS=bG({is:a=>"DropIndexNode"===a.kind,create:(a,b)=>bG({kind:"DropIndexNode",name:bR.create(a),...b}),cloneWith:(a,b)=>bG({...a,...b})}),bT=bG({is:a=>"DropSchemaNode"===a.kind,create:(a,b)=>bG({kind:"DropSchemaNode",schema:bM.create(a),...b}),cloneWith:(a,b)=>bG({...a,...b})}),bU=bG({is:a=>"DropTableNode"===a.kind,create:(a,b)=>bG({kind:"DropTableNode",table:a,...b}),cloneWith:(a,b)=>bG({...a,...b})}),bV=bG({is:a=>"AliasNode"===a.kind,create:(a,b)=>bG({kind:"AliasNode",node:a,alias:b})}),bW=bG({is:a=>"TableNode"===a.kind,create:a=>bG({kind:"TableNode",table:bR.create(a)}),createWithSchema:(a,b)=>bG({kind:"TableNode",table:bR.createWithSchema(a,b)})});function bX(a){return bF(a)&&bE(a.toOperationNode)}function bY(a){return bF(a)&&"expressionType"in a&&bX(a)}let bZ=bG({is:a=>"SelectModifierNode"===a.kind,create:(a,b)=>bG({kind:"SelectModifierNode",modifier:a,of:b}),createWithExpression:a=>bG({kind:"SelectModifierNode",rawModifier:a})}),b$=bG({is:a=>"AndNode"===a.kind,create:(a,b)=>bG({kind:"AndNode",left:a,right:b})}),b_=bG({is:a=>"OrNode"===a.kind,create:(a,b)=>bG({kind:"OrNode",left:a,right:b})}),b0=bG({is:a=>"OnNode"===a.kind,create:a=>bG({kind:"OnNode",on:a}),cloneWithOperation:(a,b,c)=>bG({...a,on:"And"===b?b$.create(a.on,c):b_.create(a.on,c)})}),b1=bG({is:a=>"JoinNode"===a.kind,create:(a,b)=>bG({kind:"JoinNode",joinType:a,table:b,on:void 0}),createWithOn:(a,b,c)=>bG({kind:"JoinNode",joinType:a,table:b,on:b0.create(c)}),cloneWithOn:(a,b)=>bG({...a,on:a.on?b0.cloneWithOperation(a.on,"And",b):b0.create(b)})}),b2=bG({is:a=>"BinaryOperationNode"===a.kind,create:(a,b,c)=>bG({kind:"BinaryOperationNode",leftOperand:a,operator:b,rightOperand:c})}),b3=["->","->>"],b4=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from","+","-","*","/","%","^","&","|","#","<<",">>","&&","||",...b3,"not","-","exists","not exists","between","between symmetric"],b5=bG({is:a=>"OperatorNode"===a.kind,create:a=>bG({kind:"OperatorNode",operator:a})});function b6(a){return bA(a)&&b3.includes(a)}let b7=bG({is:a=>"ColumnNode"===a.kind,create:a=>bG({kind:"ColumnNode",column:bM.create(a)})}),b8=bG({is:a=>"SelectAllNode"===a.kind,create:()=>bG({kind:"SelectAllNode"})}),b9=bG({is:a=>"ReferenceNode"===a.kind,create:(a,b)=>bG({kind:"ReferenceNode",table:b,column:a}),createSelectAll:a=>bG({kind:"ReferenceNode",table:a,column:b8.create()})});class ca{#a;get dynamicReference(){return this.#a}get refType(){}constructor(a){this.#a=a}toOperationNode(){return co(this.#a)}}function cb(a){return bF(a)&&bX(a)&&bA(a.dynamicReference)}let cc=bG({is:a=>"OrderByItemNode"===a.kind,create:(a,b)=>bG({kind:"OrderByItemNode",orderBy:a,direction:b}),cloneWith:(a,b)=>bG({...a,...b})}),cd=bG({is:a=>"RawNode"===a.kind,create:(a,b)=>bG({kind:"RawNode",sqlFragments:bG(a),parameters:bG(b)}),createWithSql:a=>cd.create([a],[]),createWithChild:a=>cd.create(["",""],[a]),createWithChildren:a=>cd.create(Array(a.length+1).fill(""),a)});class ce{#b;constructor(a){this.#b=bG(a)}desc(){return new ce({node:cc.cloneWith(this.#b.node,{direction:cd.createWithSql("desc")})})}asc(){return new ce({node:cc.cloneWith(this.#b.node,{direction:cd.createWithSql("asc")})})}nullsLast(){return new ce({node:cc.cloneWith(this.#b.node,{nulls:"last"})})}nullsFirst(){return new ce({node:cc.cloneWith(this.#b.node,{nulls:"first"})})}collate(a){let b;return new ce({node:cc.cloneWith(this.#b.node,{collation:(b=a,bG({kind:"CollateNode",collation:bM.create(b)}))})})}toOperationNode(){return this.#b.node}}let cf=new Set;function cg(a){cf.has(a)||(cf.add(a),console.log(a))}function ch(a){return"asc"===a||"desc"===a}function ci(a){if(2===a.length)return[cj(a[0],a[1])];if(1===a.length){let[b]=a;return Array.isArray(b)?(cg("orderBy(array) is deprecated, use multiple orderBy calls instead."),b.map(a=>cj(a))):[cj(b)]}throw Error(`Invalid number of arguments at order by! expected 1-2, received ${a.length}`)}function cj(a,b){let c=function(a){if(ew(a))return eu(a);if(cb(a))return a.toOperationNode();let[b,c]=a.split(" ");return c?(cg("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),ck(cr(b),c)):cr(a)}(a);if(cc.is(c)){if(b)throw Error("Cannot specify direction twice!");return c}return ck(c,b)}function ck(a,b){if("string"==typeof b){if(!ch(b))throw Error(`Invalid order by direction: ${b}`);return cc.create(a,cd.createWithSql(b))}if(bY(b))return cg("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),cc.create(a,b.toOperationNode());let c=cc.create(a);return b?b(new ce({node:c})).toOperationNode():c}let cl=bG({is:a=>"JSONReferenceNode"===a.kind,create:(a,b)=>bG({kind:"JSONReferenceNode",reference:a,traversal:b}),cloneWithTraversal:(a,b)=>bG({...a,traversal:b})}),cm=bG({is:a=>"JSONOperatorChainNode"===a.kind,create:a=>bG({kind:"JSONOperatorChainNode",operator:a,values:bG([])}),cloneWithValue:(a,b)=>bG({...a,values:bG([...a.values,b])})}),cn=bG({is:a=>"JSONPathNode"===a.kind,create:a=>bG({kind:"JSONPathNode",inOperator:a,pathLegs:bG([])}),cloneWithLeg:(a,b)=>bG({...a,pathLegs:bG([...a.pathLegs,b])})});function co(a){return bA(a)?cr(a):a.toOperationNode()}function cp(a){return bI(a)?a.map(a=>cq(a)):[cq(a)]}function cq(a){return ew(a)?eu(a):co(a)}function cr(a){if(!a.includes("."))return b9.create(b7.create(a));let b=a.split(".").map(cu);if(3===b.length)return function(a){let[b,c,d]=a;return b9.create(b7.create(d),bW.createWithSchema(b,c))}(b);if(2===b.length)return function(a){let[b,c]=a;return b9.create(b7.create(c),bW.create(b))}(b);throw Error(`invalid column reference ${a}`)}function cs(a){return b7.create(a)}function ct(a){if(!a.includes(" "))return cs(a);{let[b,c]=a.split(" ").map(cu);if(!ch(c))throw Error(`invalid order direction "${c}" next to "${b}"`);return ci([b,c])[0]}}function cu(a){return a.trim()}let cv=bG({is:a=>"PrimitiveValueListNode"===a.kind,create:a=>bG({kind:"PrimitiveValueListNode",values:bG([...a])})}),cw=bG({is:a=>"ValueListNode"===a.kind,create:a=>bG({kind:"ValueListNode",values:bG(a)})}),cx=bG({is:a=>"ValueNode"===a.kind,create:a=>bG({kind:"ValueNode",value:a}),createImmediate:a=>bG({kind:"ValueNode",value:a,immediate:!0})});function cy(a){return ew(a)?eu(a):cx.create(a)}function cz(a){return bB(a)||bC(a)||null===a}function cA(a){if(!cz(a))throw Error(`unsafe immediate value ${JSON.stringify(a)}`);return cx.createImmediate(a)}let cB=bG({is:a=>"ParensNode"===a.kind,create:a=>bG({kind:"ParensNode",node:a})});function cC(a){if(3===a.length)return cD(a[0],a[1],a[2]);if(1===a.length)return cy(a[0]);throw Error(`invalid arguments: ${JSON.stringify(a)}`)}function cD(a,b,c){var d,e;if(("is"===(d=b)||"is not"===d)&&cH(c))return b2.create(cq(a),cI(b),cx.createImmediate(c));return b2.create(cq(a),cI(b),bI(c)?(e=c).some(ew)?cw.create(e.map(a=>cy(a))):cv.create(e):cy(c))}function cE(a,b,c){return b2.create(cq(a),cI(b),cq(c))}function cF(a,b){return cG(Object.entries(a).filter(([,a])=>!bz(a)).map(([a,b])=>cD(a,cH(b)?"is":"=",b)),b)}function cG(a,b,c=!0){let d="and"===b?b$.create:b_.create;if(0===a.length)return b2.create(cx.createImmediate(1),b5.create("="),cx.createImmediate(+("and"===b)));let e=cJ(a[0]);for(let b=1;b<a.length;++b)e=d(e,cJ(a[b]));return a.length>1&&c?cB.create(e):e}function cH(a){return null===a||bC(a)}function cI(a){if(bA(a)&&b4.includes(a))return b5.create(a);if(bX(a))return a.toOperationNode();throw Error(`invalid operator ${JSON.stringify(a)}`)}function cJ(a){return bX(a)?a.toOperationNode():a}let cK=bG({is:a=>"OrderByNode"===a.kind,create:a=>bG({kind:"OrderByNode",items:bG([...a])}),cloneWithItems:(a,b)=>bG({...a,items:bG([...a.items,...b])})}),cL=bG({is:a=>"PartitionByNode"===a.kind,create:a=>bG({kind:"PartitionByNode",items:bG(a)}),cloneWithItems:(a,b)=>bG({...a,items:bG([...a.items,...b])})}),cM=bG({is:a=>"OverNode"===a.kind,create:()=>bG({kind:"OverNode"}),cloneWithOrderByItems:(a,b)=>bG({...a,orderBy:a.orderBy?cK.cloneWithItems(a.orderBy,b):cK.create(b)}),cloneWithPartitionByItems:(a,b)=>bG({...a,partitionBy:a.partitionBy?cL.cloneWithItems(a.partitionBy,b):cL.create(b)})}),cN=bG({is:a=>"FromNode"===a.kind,create:a=>bG({kind:"FromNode",froms:bG(a)}),cloneWithFroms:(a,b)=>bG({...a,froms:bG([...a.froms,...b])})}),cO=bG({is:a=>"GroupByNode"===a.kind,create:a=>bG({kind:"GroupByNode",items:bG(a)}),cloneWithItems:(a,b)=>bG({...a,items:bG([...a.items,...b])})}),cP=bG({is:a=>"HavingNode"===a.kind,create:a=>bG({kind:"HavingNode",having:a}),cloneWithOperation:(a,b,c)=>bG({...a,having:"And"===b?b$.create(a.having,c):b_.create(a.having,c)})}),cQ=bG({is:a=>"InsertQueryNode"===a.kind,create:(a,b,c)=>bG({kind:"InsertQueryNode",into:a,...b&&{with:b},replace:c}),createWithoutInto:()=>bG({kind:"InsertQueryNode"}),cloneWith:(a,b)=>bG({...a,...b})}),cR=bG({is:a=>"ListNode"===a.kind,create:a=>bG({kind:"ListNode",items:bG(a)})}),cS=bG({is:a=>"UpdateQueryNode"===a.kind,create:(a,b)=>bG({kind:"UpdateQueryNode",table:1===a.length?a[0]:cR.create(a),...b&&{with:b}}),createWithoutTable:()=>bG({kind:"UpdateQueryNode"}),cloneWithFromItems:(a,b)=>bG({...a,from:a.from?cN.cloneWithFroms(a.from,b):cN.create(b)}),cloneWithUpdates:(a,b)=>bG({...a,updates:a.updates?bG([...a.updates,...b]):b}),cloneWithLimit:(a,b)=>bG({...a,limit:b})}),cT=bG({is:a=>"UsingNode"===a.kind,create:a=>bG({kind:"UsingNode",tables:bG(a)}),cloneWithTables:(a,b)=>bG({...a,tables:bG([...a.tables,...b])})}),cU=bG({is:a=>"DeleteQueryNode"===a.kind,create:(a,b)=>bG({kind:"DeleteQueryNode",from:cN.create(a),...b&&{with:b}}),cloneWithOrderByItems:(a,b)=>c_.cloneWithOrderByItems(a,b),cloneWithoutOrderBy:a=>c_.cloneWithoutOrderBy(a),cloneWithLimit:(a,b)=>bG({...a,limit:b}),cloneWithoutLimit:a=>bG({...a,limit:void 0}),cloneWithUsing:(a,b)=>bG({...a,using:void 0!==a.using?cT.cloneWithTables(a.using,b):cT.create(b)})}),cV=bG({is:a=>"WhereNode"===a.kind,create:a=>bG({kind:"WhereNode",where:a}),cloneWithOperation:(a,b,c)=>bG({...a,where:"And"===b?b$.create(a.where,c):b_.create(a.where,c)})}),cW=bG({is:a=>"ReturningNode"===a.kind,create:a=>bG({kind:"ReturningNode",selections:bG(a)}),cloneWithSelections:(a,b)=>bG({...a,selections:a.selections?bG([...a.selections,...b]):bG(b)})}),cX=bG({is:a=>"ExplainNode"===a.kind,create:(a,b)=>bG({kind:"ExplainNode",format:a,options:b})}),cY=bG({is:a=>"WhenNode"===a.kind,create:a=>bG({kind:"WhenNode",condition:a}),cloneWithResult:(a,b)=>bG({...a,result:b})}),cZ=bG({is:a=>"MergeQueryNode"===a.kind,create:(a,b)=>bG({kind:"MergeQueryNode",into:a,...b&&{with:b}}),cloneWithUsing:(a,b)=>bG({...a,using:b}),cloneWithWhen:(a,b)=>bG({...a,whens:a.whens?bG([...a.whens,b]):bG([b])}),cloneWithThen:(a,b)=>bG({...a,whens:a.whens?bG([...a.whens.slice(0,-1),cY.cloneWithResult(a.whens[a.whens.length-1],b)]):void 0})}),c$=bG({is:a=>"OutputNode"===a.kind,create:a=>bG({kind:"OutputNode",selections:bG(a)}),cloneWithSelections:(a,b)=>bG({...a,selections:a.selections?bG([...a.selections,...b]):bG(b)})}),c_=bG({is:a=>c0.is(a)||cQ.is(a)||cS.is(a)||cU.is(a)||cZ.is(a),cloneWithEndModifier:(a,b)=>bG({...a,endModifiers:a.endModifiers?bG([...a.endModifiers,b]):bG([b])}),cloneWithWhere:(a,b)=>bG({...a,where:a.where?cV.cloneWithOperation(a.where,"And",b):cV.create(b)}),cloneWithJoin:(a,b)=>bG({...a,joins:a.joins?bG([...a.joins,b]):bG([b])}),cloneWithReturning:(a,b)=>bG({...a,returning:a.returning?cW.cloneWithSelections(a.returning,b):cW.create(b)}),cloneWithoutReturning:a=>bG({...a,returning:void 0}),cloneWithoutWhere:a=>bG({...a,where:void 0}),cloneWithExplain:(a,b,c)=>bG({...a,explain:cX.create(b,c?.toOperationNode())}),cloneWithTop:(a,b)=>bG({...a,top:b}),cloneWithOutput:(a,b)=>bG({...a,output:a.output?c$.cloneWithSelections(a.output,b):c$.create(b)}),cloneWithOrderByItems:(a,b)=>bG({...a,orderBy:a.orderBy?cK.cloneWithItems(a.orderBy,b):cK.create(b)}),cloneWithoutOrderBy:a=>bG({...a,orderBy:void 0})}),c0=bG({is:a=>"SelectQueryNode"===a.kind,create:a=>bG({kind:"SelectQueryNode",...a&&{with:a}}),createFrom:(a,b)=>bG({kind:"SelectQueryNode",from:cN.create(a),...b&&{with:b}}),cloneWithSelections:(a,b)=>bG({...a,selections:a.selections?bG([...a.selections,...b]):bG(b)}),cloneWithDistinctOn:(a,b)=>bG({...a,distinctOn:a.distinctOn?bG([...a.distinctOn,...b]):bG(b)}),cloneWithFrontModifier:(a,b)=>bG({...a,frontModifiers:a.frontModifiers?bG([...a.frontModifiers,b]):bG([b])}),cloneWithOrderByItems:(a,b)=>c_.cloneWithOrderByItems(a,b),cloneWithGroupByItems:(a,b)=>bG({...a,groupBy:a.groupBy?cO.cloneWithItems(a.groupBy,b):cO.create(b)}),cloneWithLimit:(a,b)=>bG({...a,limit:b}),cloneWithOffset:(a,b)=>bG({...a,offset:b}),cloneWithFetch:(a,b)=>bG({...a,fetch:b}),cloneWithHaving:(a,b)=>bG({...a,having:a.having?cP.cloneWithOperation(a.having,"And",b):cP.create(b)}),cloneWithSetOperations:(a,b)=>bG({...a,setOperations:a.setOperations?bG([...a.setOperations,...b]):bG([...b])}),cloneWithoutSelections:a=>bG({...a,selections:[]}),cloneWithoutLimit:a=>bG({...a,limit:void 0}),cloneWithoutOffset:a=>bG({...a,offset:void 0}),cloneWithoutOrderBy:a=>c_.cloneWithoutOrderBy(a),cloneWithoutGroupBy:a=>bG({...a,groupBy:void 0})});class c1{#b;constructor(a){this.#b=bG(a)}on(...a){return new c1({...this.#b,joinNode:b1.cloneWithOn(this.#b.joinNode,cC(a))})}onRef(a,b,c){return new c1({...this.#b,joinNode:b1.cloneWithOn(this.#b.joinNode,cE(a,b,c))})}onTrue(){return new c1({...this.#b,joinNode:b1.cloneWithOn(this.#b.joinNode,cd.createWithSql("true"))})}$call(a){return a(this)}toOperationNode(){return this.#b.joinNode}}let c2=bG({is:a=>"PartitionByItemNode"===a.kind,create:a=>bG({kind:"PartitionByItemNode",partitionBy:a})});class c3{#b;constructor(a){this.#b=bG(a)}orderBy(...a){return new c3({overNode:cM.cloneWithOrderByItems(this.#b.overNode,ci(a))})}clearOrderBy(){return new c3({overNode:c_.cloneWithoutOrderBy(this.#b.overNode)})}partitionBy(a){return new c3({overNode:cM.cloneWithPartitionByItems(this.#b.overNode,cp(a).map(c2.create))})}$call(a){return a(this)}toOperationNode(){return this.#b.overNode}}let c4=bG({is:a=>"SelectionNode"===a.kind,create:a=>bG({kind:"SelectionNode",selection:a}),createSelectAll:()=>bG({kind:"SelectionNode",selection:b8.create()}),createSelectAllFromTable:a=>bG({kind:"SelectionNode",selection:b9.createSelectAll(a)})});function c5(a){return bE(a)?c5(a(et())):bI(a)?a.map(a=>c6(a)):[c6(a)]}function c6(a){return bA(a)?c4.create(function(a){let b=" as ";if(!a.includes(b))return cr(a);{let[c,d]=a.split(b).map(cu);return bV.create(cr(c),bM.create(d))}}(a)):cb(a)?c4.create(a.toOperationNode()):c4.create(ev(a))}function c7(a){return a?Array.isArray(a)?a.map(c8):[c8(a)]:[c4.createSelectAll()]}function c8(a){if(bA(a))return c4.createSelectAllFromTable(eA(a));throw Error(`invalid value selectAll expression: ${JSON.stringify(a)}`)}let c9=bG({is:a=>"ValuesNode"===a.kind,create:a=>bG({kind:"ValuesNode",values:bG(a)})}),da=bG({is:a=>"DefaultInsertValueNode"===a.kind,create:()=>bG({kind:"DefaultInsertValueNode"})});function db(a){var b;let c,d=bE(a)?a(et()):a;return c=function(a){let b=new Map;for(let c of a)for(let a of Object.keys(c))b.has(a)||void 0===c[a]||b.set(a,b.size);return b}(b=bI(d)?d:bG([d])),[bG([...c.keys()].map(b7.create)),c9.create(b.map(a=>(function(a,b){let c=Object.keys(a),d=Array.from({length:b.size}),e=!1,f=c.length;for(let g of c){let c=b.get(g);if(bz(c)){f--;continue}let h=a[g];(bz(h)||ew(h))&&(e=!0),d[c]=h}if(f<b.size||e){let a=da.create();return cw.create(d.map(b=>bz(b)?a:cy(b)))}return cv.create(d)})(a,c)))]}let dc=bG({is:a=>"ColumnUpdateNode"===a.kind,create:(a,b)=>bG({kind:"ColumnUpdateNode",column:a,value:b})});function dd(a){return Object.entries(bE(a)?a(et()):a).filter(([a,b])=>void 0!==b).map(([a,b])=>dc.create(b7.create(a),cy(b)))}let de=bG({is:a=>"OnDuplicateKeyNode"===a.kind,create:a=>bG({kind:"OnDuplicateKeyNode",updates:a})});class df{insertId;numInsertedOrUpdatedRows;constructor(a,b){this.insertId=a,this.numInsertedOrUpdatedRows=b}}class dg extends Error{node;constructor(a){super("no result"),this.node=a}}function dh(a){return Object.prototype.hasOwnProperty.call(a,"prototype")}let di=bG({is:a=>"OnConflictNode"===a.kind,create:()=>bG({kind:"OnConflictNode"}),cloneWith:(a,b)=>bG({...a,...b}),cloneWithIndexWhere:(a,b)=>bG({...a,indexWhere:a.indexWhere?cV.cloneWithOperation(a.indexWhere,"And",b):cV.create(b)}),cloneWithIndexOrWhere:(a,b)=>bG({...a,indexWhere:a.indexWhere?cV.cloneWithOperation(a.indexWhere,"Or",b):cV.create(b)}),cloneWithUpdateWhere:(a,b)=>bG({...a,updateWhere:a.updateWhere?cV.cloneWithOperation(a.updateWhere,"And",b):cV.create(b)}),cloneWithUpdateOrWhere:(a,b)=>bG({...a,updateWhere:a.updateWhere?cV.cloneWithOperation(a.updateWhere,"Or",b):cV.create(b)}),cloneWithoutIndexWhere:a=>bG({...a,indexWhere:void 0}),cloneWithoutUpdateWhere:a=>bG({...a,updateWhere:void 0})});class dj{#b;constructor(a){this.#b=bG(a)}column(a){let b=b7.create(a);return new dj({...this.#b,onConflictNode:di.cloneWith(this.#b.onConflictNode,{columns:this.#b.onConflictNode.columns?bG([...this.#b.onConflictNode.columns,b]):bG([b])})})}columns(a){let b=a.map(b7.create);return new dj({...this.#b,onConflictNode:di.cloneWith(this.#b.onConflictNode,{columns:this.#b.onConflictNode.columns?bG([...this.#b.onConflictNode.columns,...b]):bG(b)})})}constraint(a){return new dj({...this.#b,onConflictNode:di.cloneWith(this.#b.onConflictNode,{constraint:bM.create(a)})})}expression(a){return new dj({...this.#b,onConflictNode:di.cloneWith(this.#b.onConflictNode,{indexExpression:a.toOperationNode()})})}where(...a){return new dj({...this.#b,onConflictNode:di.cloneWithIndexWhere(this.#b.onConflictNode,cC(a))})}whereRef(a,b,c){return new dj({...this.#b,onConflictNode:di.cloneWithIndexWhere(this.#b.onConflictNode,cE(a,b,c))})}clearWhere(){return new dj({...this.#b,onConflictNode:di.cloneWithoutIndexWhere(this.#b.onConflictNode)})}doNothing(){return new dk({...this.#b,onConflictNode:di.cloneWith(this.#b.onConflictNode,{doNothing:!0})})}doUpdateSet(a){return new dl({...this.#b,onConflictNode:di.cloneWith(this.#b.onConflictNode,{updates:dd(a)})})}$call(a){return a(this)}}class dk{#b;constructor(a){this.#b=bG(a)}toOperationNode(){return this.#b.onConflictNode}}class dl{#b;constructor(a){this.#b=bG(a)}where(...a){return new dl({...this.#b,onConflictNode:di.cloneWithUpdateWhere(this.#b.onConflictNode,cC(a))})}whereRef(a,b,c){return new dl({...this.#b,onConflictNode:di.cloneWithUpdateWhere(this.#b.onConflictNode,cE(a,b,c))})}clearWhere(){return new dl({...this.#b,onConflictNode:di.cloneWithoutUpdateWhere(this.#b.onConflictNode)})}$call(a){return a(this)}toOperationNode(){return this.#b.onConflictNode}}let dm=bG({is:a=>"TopNode"===a.kind,create:(a,b)=>bG({kind:"TopNode",expression:a,modifiers:b})});function dn(a,b){var c;if(!bB(a)&&!bD(a))throw Error(`Invalid top expression: ${a}`);if(!bz(b)&&"percent"!==(c=b)&&"with ties"!==c&&"percent with ties"!==c)throw Error(`Invalid top modifiers: ${b}`);return dm.create(a,b)}let dp=bG({is:a=>"OrActionNode"===a.kind,create:a=>bG({kind:"OrActionNode",action:a})});class dq{#b;constructor(a){this.#b=bG(a)}values(a){let[b,c]=db(a);return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{columns:b,values:c})})}columns(a){return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{columns:bG(a.map(b7.create))})})}expression(a){return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{values:eu(a)})})}defaultValues(){return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{defaultValues:!0})})}modifyEnd(a){return new dq({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,a.toOperationNode())})}ignore(){return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{orAction:dp.create("ignore")})})}orIgnore(){return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{orAction:dp.create("ignore")})})}orAbort(){return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{orAction:dp.create("abort")})})}orFail(){return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{orAction:dp.create("fail")})})}orReplace(){return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{orAction:dp.create("replace")})})}orRollback(){return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{orAction:dp.create("rollback")})})}top(a,b){return new dq({...this.#b,queryNode:c_.cloneWithTop(this.#b.queryNode,dn(a,b))})}onConflict(a){return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{onConflict:a(new dj({onConflictNode:di.create()})).toOperationNode()})})}onDuplicateKeyUpdate(a){return new dq({...this.#b,queryNode:cQ.cloneWith(this.#b.queryNode,{onDuplicateKey:de.create(dd(a))})})}returning(a){return new dq({...this.#b,queryNode:c_.cloneWithReturning(this.#b.queryNode,c5(a))})}returningAll(){return new dq({...this.#b,queryNode:c_.cloneWithReturning(this.#b.queryNode,c7())})}output(a){return new dq({...this.#b,queryNode:c_.cloneWithOutput(this.#b.queryNode,c5(a))})}outputAll(a){return new dq({...this.#b,queryNode:c_.cloneWithOutput(this.#b.queryNode,c7(a))})}clearReturning(){return new dq({...this.#b,queryNode:c_.cloneWithoutReturning(this.#b.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new dq({...this.#b})}$castTo(){return new dq(this.#b)}$narrowType(){return new dq(this.#b)}$assertType(){return new dq(this.#b)}withPlugin(a){return new dq({...this.#b,executor:this.#b.executor.withPlugin(a)})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.queryNode,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){let a=this.compile(),b=await this.#b.executor.executeQuery(a,this.#b.queryId),{adapter:c}=this.#b.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new df(b.insertId,b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=dg){let b=await this.executeTakeFirst();if(void 0===b)throw dh(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#b.executor.stream(b,a,this.#b.queryId))yield*c.rows}async explain(a,b){let c=new dq({...this.#b,queryNode:c_.cloneWithExplain(this.#b.queryNode,a,b)});return await c.execute()}}class dr{numDeletedRows;constructor(a){this.numDeletedRows=a}}let ds=bG({is:a=>"LimitNode"===a.kind,create:a=>bG({kind:"LimitNode",limit:a})});class dt{#b;constructor(a){this.#b=bG(a)}where(...a){return new dt({...this.#b,queryNode:c_.cloneWithWhere(this.#b.queryNode,cC(a))})}whereRef(a,b,c){return new dt({...this.#b,queryNode:c_.cloneWithWhere(this.#b.queryNode,cE(a,b,c))})}clearWhere(){return new dt({...this.#b,queryNode:c_.cloneWithoutWhere(this.#b.queryNode)})}top(a,b){return new dt({...this.#b,queryNode:c_.cloneWithTop(this.#b.queryNode,dn(a,b))})}using(a){return new dt({...this.#b,queryNode:cU.cloneWithUsing(this.#b.queryNode,ex(a))})}innerJoin(...a){return this.#c("InnerJoin",a)}leftJoin(...a){return this.#c("LeftJoin",a)}rightJoin(...a){return this.#c("RightJoin",a)}fullJoin(...a){return this.#c("FullJoin",a)}#c(a,b){return new dt({...this.#b,queryNode:c_.cloneWithJoin(this.#b.queryNode,dZ(a,b))})}returning(a){return new dt({...this.#b,queryNode:c_.cloneWithReturning(this.#b.queryNode,c5(a))})}returningAll(a){return new dt({...this.#b,queryNode:c_.cloneWithReturning(this.#b.queryNode,c7(a))})}output(a){return new dt({...this.#b,queryNode:c_.cloneWithOutput(this.#b.queryNode,c5(a))})}outputAll(a){return new dt({...this.#b,queryNode:c_.cloneWithOutput(this.#b.queryNode,c7(a))})}clearReturning(){return new dt({...this.#b,queryNode:c_.cloneWithoutReturning(this.#b.queryNode)})}clearLimit(){return new dt({...this.#b,queryNode:cU.cloneWithoutLimit(this.#b.queryNode)})}orderBy(...a){return new dt({...this.#b,queryNode:c_.cloneWithOrderByItems(this.#b.queryNode,ci(a))})}clearOrderBy(){return new dt({...this.#b,queryNode:c_.cloneWithoutOrderBy(this.#b.queryNode)})}limit(a){return new dt({...this.#b,queryNode:cU.cloneWithLimit(this.#b.queryNode,ds.create(cy(a)))})}modifyEnd(a){return new dt({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,a.toOperationNode())})}$call(a){return a(this)}$if(a,b){return a?b(this):new dt({...this.#b})}$castTo(){return new dt(this.#b)}$narrowType(){return new dt(this.#b)}$assertType(){return new dt(this.#b)}withPlugin(a){return new dt({...this.#b,executor:this.#b.executor.withPlugin(a)})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.queryNode,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){let a=this.compile(),b=await this.#b.executor.executeQuery(a,this.#b.queryId),{adapter:c}=this.#b.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new dr(b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=dg){let b=await this.executeTakeFirst();if(void 0===b)throw dh(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#b.executor.stream(b,a,this.#b.queryId))yield*c.rows}async explain(a,b){let c=new dt({...this.#b,queryNode:c_.cloneWithExplain(this.#b.queryNode,a,b)});return await c.execute()}}class du{numUpdatedRows;numChangedRows;constructor(a,b){this.numUpdatedRows=a,this.numChangedRows=b}}class dv{#b;constructor(a){this.#b=bG(a)}where(...a){return new dv({...this.#b,queryNode:c_.cloneWithWhere(this.#b.queryNode,cC(a))})}whereRef(a,b,c){return new dv({...this.#b,queryNode:c_.cloneWithWhere(this.#b.queryNode,cE(a,b,c))})}clearWhere(){return new dv({...this.#b,queryNode:c_.cloneWithoutWhere(this.#b.queryNode)})}top(a,b){return new dv({...this.#b,queryNode:c_.cloneWithTop(this.#b.queryNode,dn(a,b))})}from(a){return new dv({...this.#b,queryNode:cS.cloneWithFromItems(this.#b.queryNode,ex(a))})}innerJoin(...a){return this.#c("InnerJoin",a)}leftJoin(...a){return this.#c("LeftJoin",a)}rightJoin(...a){return this.#c("RightJoin",a)}fullJoin(...a){return this.#c("FullJoin",a)}#c(a,b){return new dv({...this.#b,queryNode:c_.cloneWithJoin(this.#b.queryNode,dZ(a,b))})}orderBy(...a){return new dv({...this.#b,queryNode:c_.cloneWithOrderByItems(this.#b.queryNode,ci(a))})}clearOrderBy(){return new dv({...this.#b,queryNode:c_.cloneWithoutOrderBy(this.#b.queryNode)})}limit(a){return new dv({...this.#b,queryNode:cS.cloneWithLimit(this.#b.queryNode,ds.create(cy(a)))})}set(...a){return new dv({...this.#b,queryNode:cS.cloneWithUpdates(this.#b.queryNode,function(...a){return 2===a.length?[dc.create(cq(a[0]),cy(a[1]))]:dd(a[0])}(...a))})}returning(a){return new dv({...this.#b,queryNode:c_.cloneWithReturning(this.#b.queryNode,c5(a))})}returningAll(a){return new dv({...this.#b,queryNode:c_.cloneWithReturning(this.#b.queryNode,c7(a))})}output(a){return new dv({...this.#b,queryNode:c_.cloneWithOutput(this.#b.queryNode,c5(a))})}outputAll(a){return new dv({...this.#b,queryNode:c_.cloneWithOutput(this.#b.queryNode,c7(a))})}modifyEnd(a){return new dv({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,a.toOperationNode())})}clearReturning(){return new dv({...this.#b,queryNode:c_.cloneWithoutReturning(this.#b.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new dv({...this.#b})}$castTo(){return new dv(this.#b)}$narrowType(){return new dv(this.#b)}$assertType(){return new dv(this.#b)}withPlugin(a){return new dv({...this.#b,executor:this.#b.executor.withPlugin(a)})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.queryNode,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){let a=this.compile(),b=await this.#b.executor.executeQuery(a,this.#b.queryId),{adapter:c}=this.#b.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new du(b.numAffectedRows??BigInt(0),b.numChangedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=dg){let b=await this.executeTakeFirst();if(void 0===b)throw dh(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#b.executor.stream(b,a,this.#b.queryId))yield*c.rows}async explain(a,b){let c=new dv({...this.#b,queryNode:c_.cloneWithExplain(this.#b.queryNode,a,b)});return await c.execute()}}let dw=bG({is:a=>"CommonTableExpressionNameNode"===a.kind,create:(a,b)=>bG({kind:"CommonTableExpressionNameNode",table:bW.create(a),columns:b?bG(b.map(b7.create)):void 0})}),dx=bG({is:a=>"CommonTableExpressionNode"===a.kind,create:(a,b)=>bG({kind:"CommonTableExpressionNode",name:a,expression:b}),cloneWith:(a,b)=>bG({...a,...b})});class dy{#b;constructor(a){this.#b=bG(a)}materialized(){return new dy({...this.#b,node:dx.cloneWith(this.#b.node,{materialized:!0})})}notMaterialized(){return new dy({...this.#b,node:dx.cloneWith(this.#b.node,{materialized:!1})})}toOperationNode(){return this.#b.node}}function dz(a,b){var c;let d=b(new dY({executor:dS})).toOperationNode();return bE(a)?a((c=d,a=>new dy({node:dx.create(dA(a),c)}))).toOperationNode():dx.create(dA(a),d)}function dA(a){if(!a.includes("("))return dw.create(a);{let b=a.split(/[\(\)]/),c=b[0],d=b[1].split(",").map(a=>a.trim());return dw.create(c,d)}}let dB=bG({is:a=>"WithNode"===a.kind,create:(a,b)=>bG({kind:"WithNode",expressions:bG([a]),...b}),cloneWithExpression:(a,b)=>bG({...a,expressions:bG([...a.expressions,b])})}),dC=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function dD(){return new dE}class dE{#d;get queryId(){return void 0===this.#d&&(this.#d=function(a){let b="";for(let a=0;a<8;++a)b+=dC[~~(Math.random()*dC.length)];return b}(0)),this.#d}}class dF{nodeStack=[];#e=bG({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(a,b){if(!a)return a;this.nodeStack.push(a);let c=this.transformNodeImpl(a,b);return this.nodeStack.pop(),bG(c)}transformNodeImpl(a,b){return this.#e[a.kind](a,b)}transformNodeList(a,b){return a?bG(a.map(a=>this.transformNode(a,b))):a}transformSelectQuery(a,b){return{kind:"SelectQueryNode",from:this.transformNode(a.from,b),selections:this.transformNodeList(a.selections,b),distinctOn:this.transformNodeList(a.distinctOn,b),joins:this.transformNodeList(a.joins,b),groupBy:this.transformNode(a.groupBy,b),orderBy:this.transformNode(a.orderBy,b),where:this.transformNode(a.where,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),limit:this.transformNode(a.limit,b),offset:this.transformNode(a.offset,b),with:this.transformNode(a.with,b),having:this.transformNode(a.having,b),explain:this.transformNode(a.explain,b),setOperations:this.transformNodeList(a.setOperations,b),fetch:this.transformNode(a.fetch,b),top:this.transformNode(a.top,b)}}transformSelection(a,b){return{kind:"SelectionNode",selection:this.transformNode(a.selection,b)}}transformColumn(a,b){return{kind:"ColumnNode",column:this.transformNode(a.column,b)}}transformAlias(a,b){return{kind:"AliasNode",node:this.transformNode(a.node,b),alias:this.transformNode(a.alias,b)}}transformTable(a,b){return{kind:"TableNode",table:this.transformNode(a.table,b)}}transformFrom(a,b){return{kind:"FromNode",froms:this.transformNodeList(a.froms,b)}}transformReference(a,b){return{kind:"ReferenceNode",column:this.transformNode(a.column,b),table:this.transformNode(a.table,b)}}transformAnd(a,b){return{kind:"AndNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformOr(a,b){return{kind:"OrNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformValueList(a,b){return{kind:"ValueListNode",values:this.transformNodeList(a.values,b)}}transformParens(a,b){return{kind:"ParensNode",node:this.transformNode(a.node,b)}}transformJoin(a,b){return{kind:"JoinNode",joinType:a.joinType,table:this.transformNode(a.table,b),on:this.transformNode(a.on,b)}}transformRaw(a,b){return{kind:"RawNode",sqlFragments:bG([...a.sqlFragments]),parameters:this.transformNodeList(a.parameters,b)}}transformWhere(a,b){return{kind:"WhereNode",where:this.transformNode(a.where,b)}}transformInsertQuery(a,b){return{kind:"InsertQueryNode",into:this.transformNode(a.into,b),columns:this.transformNodeList(a.columns,b),values:this.transformNode(a.values,b),returning:this.transformNode(a.returning,b),onConflict:this.transformNode(a.onConflict,b),onDuplicateKey:this.transformNode(a.onDuplicateKey,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),ignore:a.ignore,orAction:this.transformNode(a.orAction,b),replace:a.replace,explain:this.transformNode(a.explain,b),defaultValues:a.defaultValues,top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformValues(a,b){return{kind:"ValuesNode",values:this.transformNodeList(a.values,b)}}transformDeleteQuery(a,b){return{kind:"DeleteQueryNode",from:this.transformNode(a.from,b),using:this.transformNode(a.using,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),orderBy:this.transformNode(a.orderBy,b),limit:this.transformNode(a.limit,b),explain:this.transformNode(a.explain,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformReturning(a,b){return{kind:"ReturningNode",selections:this.transformNodeList(a.selections,b)}}transformCreateTable(a,b){return{kind:"CreateTableNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),constraints:this.transformNodeList(a.constraints,b),temporary:a.temporary,ifNotExists:a.ifNotExists,onCommit:a.onCommit,frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),selectQuery:this.transformNode(a.selectQuery,b)}}transformColumnDefinition(a,b){return{kind:"ColumnDefinitionNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),references:this.transformNode(a.references,b),primaryKey:a.primaryKey,autoIncrement:a.autoIncrement,unique:a.unique,notNull:a.notNull,unsigned:a.unsigned,defaultTo:this.transformNode(a.defaultTo,b),check:this.transformNode(a.check,b),generated:this.transformNode(a.generated,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),nullsNotDistinct:a.nullsNotDistinct,identity:a.identity,ifNotExists:a.ifNotExists}}transformAddColumn(a,b){return{kind:"AddColumnNode",column:this.transformNode(a.column,b)}}transformDropTable(a,b){return{kind:"DropTableNode",table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformOrderBy(a,b){return{kind:"OrderByNode",items:this.transformNodeList(a.items,b)}}transformOrderByItem(a,b){return{kind:"OrderByItemNode",orderBy:this.transformNode(a.orderBy,b),direction:this.transformNode(a.direction,b),collation:this.transformNode(a.collation,b),nulls:a.nulls}}transformGroupBy(a,b){return{kind:"GroupByNode",items:this.transformNodeList(a.items,b)}}transformGroupByItem(a,b){return{kind:"GroupByItemNode",groupBy:this.transformNode(a.groupBy,b)}}transformUpdateQuery(a,b){return{kind:"UpdateQueryNode",table:this.transformNode(a.table,b),from:this.transformNode(a.from,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),updates:this.transformNodeList(a.updates,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),explain:this.transformNode(a.explain,b),limit:this.transformNode(a.limit,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b),orderBy:this.transformNode(a.orderBy,b)}}transformColumnUpdate(a,b){return{kind:"ColumnUpdateNode",column:this.transformNode(a.column,b),value:this.transformNode(a.value,b)}}transformLimit(a,b){return{kind:"LimitNode",limit:this.transformNode(a.limit,b)}}transformOffset(a,b){return{kind:"OffsetNode",offset:this.transformNode(a.offset,b)}}transformOnConflict(a,b){return{kind:"OnConflictNode",columns:this.transformNodeList(a.columns,b),constraint:this.transformNode(a.constraint,b),indexExpression:this.transformNode(a.indexExpression,b),indexWhere:this.transformNode(a.indexWhere,b),updates:this.transformNodeList(a.updates,b),updateWhere:this.transformNode(a.updateWhere,b),doNothing:a.doNothing}}transformOnDuplicateKey(a,b){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(a.updates,b)}}transformCreateIndex(a,b){return{kind:"CreateIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists,where:this.transformNode(a.where,b),nullsNotDistinct:a.nullsNotDistinct}}transformList(a,b){return{kind:"ListNode",items:this.transformNodeList(a.items,b)}}transformDropIndex(a,b){return{kind:"DropIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformPrimaryKeyConstraint(a,b){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformUniqueConstraint(a,b){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),nullsNotDistinct:a.nullsNotDistinct,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformForeignKeyConstraint(a,b){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(a.columns,b),references:this.transformNode(a.references,b),name:this.transformNode(a.name,b),onDelete:a.onDelete,onUpdate:a.onUpdate,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformSetOperation(a,b){return{kind:"SetOperationNode",operator:a.operator,expression:this.transformNode(a.expression,b),all:a.all}}transformReferences(a,b){return{kind:"ReferencesNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),onDelete:a.onDelete,onUpdate:a.onUpdate}}transformCheckConstraint(a,b){return{kind:"CheckConstraintNode",expression:this.transformNode(a.expression,b),name:this.transformNode(a.name,b)}}transformWith(a,b){return{kind:"WithNode",expressions:this.transformNodeList(a.expressions,b),recursive:a.recursive}}transformCommonTableExpression(a,b){return{kind:"CommonTableExpressionNode",name:this.transformNode(a.name,b),materialized:a.materialized,expression:this.transformNode(a.expression,b)}}transformCommonTableExpressionName(a,b){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b)}}transformHaving(a,b){return{kind:"HavingNode",having:this.transformNode(a.having,b)}}transformCreateSchema(a,b){return{kind:"CreateSchemaNode",schema:this.transformNode(a.schema,b),ifNotExists:a.ifNotExists}}transformDropSchema(a,b){return{kind:"DropSchemaNode",schema:this.transformNode(a.schema,b),ifExists:a.ifExists,cascade:a.cascade}}transformAlterTable(a,b){return{kind:"AlterTableNode",table:this.transformNode(a.table,b),renameTo:this.transformNode(a.renameTo,b),setSchema:this.transformNode(a.setSchema,b),columnAlterations:this.transformNodeList(a.columnAlterations,b),addConstraint:this.transformNode(a.addConstraint,b),dropConstraint:this.transformNode(a.dropConstraint,b),renameConstraint:this.transformNode(a.renameConstraint,b),addIndex:this.transformNode(a.addIndex,b),dropIndex:this.transformNode(a.dropIndex,b)}}transformDropColumn(a,b){return{kind:"DropColumnNode",column:this.transformNode(a.column,b)}}transformRenameColumn(a,b){return{kind:"RenameColumnNode",column:this.transformNode(a.column,b),renameTo:this.transformNode(a.renameTo,b)}}transformAlterColumn(a,b){return{kind:"AlterColumnNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),dataTypeExpression:this.transformNode(a.dataTypeExpression,b),setDefault:this.transformNode(a.setDefault,b),dropDefault:a.dropDefault,setNotNull:a.setNotNull,dropNotNull:a.dropNotNull}}transformModifyColumn(a,b){return{kind:"ModifyColumnNode",column:this.transformNode(a.column,b)}}transformAddConstraint(a,b){return{kind:"AddConstraintNode",constraint:this.transformNode(a.constraint,b)}}transformDropConstraint(a,b){return{kind:"DropConstraintNode",constraintName:this.transformNode(a.constraintName,b),ifExists:a.ifExists,modifier:a.modifier}}transformRenameConstraint(a,b){return{kind:"RenameConstraintNode",oldName:this.transformNode(a.oldName,b),newName:this.transformNode(a.newName,b)}}transformCreateView(a,b){return{kind:"CreateViewNode",name:this.transformNode(a.name,b),temporary:a.temporary,orReplace:a.orReplace,ifNotExists:a.ifNotExists,materialized:a.materialized,columns:this.transformNodeList(a.columns,b),as:this.transformNode(a.as,b)}}transformRefreshMaterializedView(a,b){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(a.name,b),concurrently:a.concurrently,withNoData:a.withNoData}}transformDropView(a,b){return{kind:"DropViewNode",name:this.transformNode(a.name,b),ifExists:a.ifExists,materialized:a.materialized,cascade:a.cascade}}transformGenerated(a,b){return{kind:"GeneratedNode",byDefault:a.byDefault,always:a.always,identity:a.identity,stored:a.stored,expression:this.transformNode(a.expression,b)}}transformDefaultValue(a,b){return{kind:"DefaultValueNode",defaultValue:this.transformNode(a.defaultValue,b)}}transformOn(a,b){return{kind:"OnNode",on:this.transformNode(a.on,b)}}transformSelectModifier(a,b){return{kind:"SelectModifierNode",modifier:a.modifier,rawModifier:this.transformNode(a.rawModifier,b),of:this.transformNodeList(a.of,b)}}transformCreateType(a,b){return{kind:"CreateTypeNode",name:this.transformNode(a.name,b),enum:this.transformNode(a.enum,b)}}transformDropType(a,b){return{kind:"DropTypeNode",name:this.transformNode(a.name,b),ifExists:a.ifExists}}transformExplain(a,b){return{kind:"ExplainNode",format:a.format,options:this.transformNode(a.options,b)}}transformSchemableIdentifier(a,b){return{kind:"SchemableIdentifierNode",schema:this.transformNode(a.schema,b),identifier:this.transformNode(a.identifier,b)}}transformAggregateFunction(a,b){return{kind:"AggregateFunctionNode",func:a.func,aggregated:this.transformNodeList(a.aggregated,b),distinct:a.distinct,orderBy:this.transformNode(a.orderBy,b),withinGroup:this.transformNode(a.withinGroup,b),filter:this.transformNode(a.filter,b),over:this.transformNode(a.over,b)}}transformOver(a,b){return{kind:"OverNode",orderBy:this.transformNode(a.orderBy,b),partitionBy:this.transformNode(a.partitionBy,b)}}transformPartitionBy(a,b){return{kind:"PartitionByNode",items:this.transformNodeList(a.items,b)}}transformPartitionByItem(a,b){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(a.partitionBy,b)}}transformBinaryOperation(a,b){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(a.leftOperand,b),operator:this.transformNode(a.operator,b),rightOperand:this.transformNode(a.rightOperand,b)}}transformUnaryOperation(a,b){return{kind:"UnaryOperationNode",operator:this.transformNode(a.operator,b),operand:this.transformNode(a.operand,b)}}transformUsing(a,b){return{kind:"UsingNode",tables:this.transformNodeList(a.tables,b)}}transformFunction(a,b){return{kind:"FunctionNode",func:a.func,arguments:this.transformNodeList(a.arguments,b)}}transformCase(a,b){return{kind:"CaseNode",value:this.transformNode(a.value,b),when:this.transformNodeList(a.when,b),else:this.transformNode(a.else,b),isStatement:a.isStatement}}transformWhen(a,b){return{kind:"WhenNode",condition:this.transformNode(a.condition,b),result:this.transformNode(a.result,b)}}transformJSONReference(a,b){return{kind:"JSONReferenceNode",reference:this.transformNode(a.reference,b),traversal:this.transformNode(a.traversal,b)}}transformJSONPath(a,b){return{kind:"JSONPathNode",inOperator:this.transformNode(a.inOperator,b),pathLegs:this.transformNodeList(a.pathLegs,b)}}transformJSONPathLeg(a,b){return{kind:"JSONPathLegNode",type:a.type,value:a.value}}transformJSONOperatorChain(a,b){return{kind:"JSONOperatorChainNode",operator:this.transformNode(a.operator,b),values:this.transformNodeList(a.values,b)}}transformTuple(a,b){return{kind:"TupleNode",values:this.transformNodeList(a.values,b)}}transformMergeQuery(a,b){return{kind:"MergeQueryNode",into:this.transformNode(a.into,b),using:this.transformNode(a.using,b),whens:this.transformNodeList(a.whens,b),with:this.transformNode(a.with,b),top:this.transformNode(a.top,b),endModifiers:this.transformNodeList(a.endModifiers,b),output:this.transformNode(a.output,b),returning:this.transformNode(a.returning,b)}}transformMatched(a,b){return{kind:"MatchedNode",not:a.not,bySource:a.bySource}}transformAddIndex(a,b){return{kind:"AddIndexNode",name:this.transformNode(a.name,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists}}transformCast(a,b){return{kind:"CastNode",expression:this.transformNode(a.expression,b),dataType:this.transformNode(a.dataType,b)}}transformFetch(a,b){return{kind:"FetchNode",rowCount:this.transformNode(a.rowCount,b),modifier:a.modifier}}transformTop(a,b){return{kind:"TopNode",expression:a.expression,modifiers:a.modifiers}}transformOutput(a,b){return{kind:"OutputNode",selections:this.transformNodeList(a.selections,b)}}transformDataType(a,b){return a}transformSelectAll(a,b){return a}transformIdentifier(a,b){return a}transformValue(a,b){return a}transformPrimitiveValueList(a,b){return a}transformOperator(a,b){return a}transformDefaultInsertValue(a,b){return a}transformOrAction(a,b){return a}transformCollate(a,b){return a}}let dG=bG({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),dH={json_agg:!0,to_json:!0};class dI extends dF{#f;#g=new Set;#h=new Set;constructor(a){super(),this.#f=a}transformNodeImpl(a,b){if(!this.#i(a))return super.transformNodeImpl(a,b);let c=this.#j(a);for(let a of c)this.#h.add(a);let d=this.#k(a);for(let a of d)this.#g.add(a);let e=super.transformNodeImpl(a,b);for(let a of d)this.#g.delete(a);for(let a of c)this.#h.delete(a);return e}transformSchemableIdentifier(a,b){let c=super.transformSchemableIdentifier(a,b);return c.schema||!this.#g.has(a.identifier.name)?c:{...c,schema:bM.create(this.#f)}}transformReferences(a,b){let c=super.transformReferences(a,b);return c.table.table.schema?c:{...c,table:bW.createWithSchema(this.#f,c.table.table.identifier.name)}}transformAggregateFunction(a,b){return{...super.transformAggregateFunction({...a,aggregated:[]},b),aggregated:this.#l(a,b,"aggregated")}}transformFunction(a,b){return{...super.transformFunction({...a,arguments:[]},b),arguments:this.#l(a,b,"arguments")}}#l(a,b,c){return dH[a.func]?a[c].map(a=>!bW.is(a)||a.table.schema?this.transformNode(a,b):{...a,table:this.transformIdentifier(a.table.identifier,b)}):this.transformNodeList(a[c],b)}#i(a){return a.kind in dG}#k(a){let b=new Set;if("name"in a&&a.name&&bR.is(a.name)&&this.#m(a.name,b),"from"in a&&a.from)for(let c of a.from.froms)this.#n(c,b);if("into"in a&&a.into&&this.#n(a.into,b),"table"in a&&a.table&&this.#n(a.table,b),"joins"in a&&a.joins)for(let c of a.joins)this.#n(c.table,b);return"using"in a&&a.using&&this.#n(a.using,b),b}#j(a){let b=new Set;return"with"in a&&a.with&&this.#o(a.with,b),b}#n(a,b){if(bW.is(a))this.#m(a.table,b);else if(bV.is(a)&&bW.is(a.node))this.#m(a.node.table,b);else if(cR.is(a))for(let c of a.items)this.#n(c,b)}#m(a,b){let c=a.identifier.name;this.#g.has(c)||this.#h.has(c)||b.add(c)}#o(a,b){for(let c of a.expressions){let a=c.name.table.table.identifier.name;this.#h.has(a)||b.add(a)}}}class dJ{#p;constructor(a){this.#p=new dI(a)}transformQuery(a){return this.#p.transformNode(a.node,a.queryId)}async transformResult(a){return a.result}}let dK=bG({is:a=>"MatchedNode"===a.kind,create:(a,b=!1)=>bG({kind:"MatchedNode",not:a,bySource:b})});function dL(a,b,c){return cY.create(cG([dK.create(!a.isMatched,a.bySource),...b&&b.length>0?[3===b.length&&c?cE(b[0],b[1],b[2]):cC(b)]:[]],"and",!1))}function dM(a){return bA(a)?cd.create([a],[]):bX(a)?a.toOperationNode():a}class dN{#q;#r;#s;constructor(){this.#q=new Promise((a,b)=>{this.#s=b,this.#r=a})}get promise(){return this.#q}resolve=a=>{this.#r&&this.#r(a)};reject=a=>{this.#s&&this.#s(a)}}async function dO(a){let b=new dN,c=new dN;return a.provideConnection(async a=>(b.resolve(a),await c.promise)).catch(a=>b.reject(a)),bG({connection:await b.promise,release:c.resolve})}let dP=bG([]);class dQ{#t;constructor(a=dP){this.#t=a}get plugins(){return this.#t}transformQuery(a,b){for(let c of this.#t){let d=c.transformQuery({node:a,queryId:b});if(d.kind===a.kind)a=d;else throw Error(`KyselyPlugin.transformQuery must return a node of the same kind that was given to it. The plugin was given a ${a.kind} but it returned a ${d.kind}`)}return a}async executeQuery(a,b){return await this.provideConnection(async c=>{let d=await c.executeQuery(a);return"numUpdatedOrDeletedRows"in d&&cg("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#u(d,b)})}async *stream(a,b,c){let{connection:d,release:e}=await dO(this);try{for await(let e of d.streamQuery(a,b))yield await this.#u(e,c)}finally{e()}}async #u(a,b){for(let c of this.#t)a=await c.transformResult({result:a,queryId:b});return a}}class dR extends dQ{get adapter(){throw Error("this query cannot be compiled to SQL")}compileQuery(){throw Error("this query cannot be compiled to SQL")}provideConnection(){throw Error("this query cannot be executed")}withConnectionProvider(){throw Error("this query cannot have a connection provider")}withPlugin(a){return new dR([...this.plugins,a])}withPlugins(a){return new dR([...this.plugins,...a])}withPluginAtFront(a){return new dR([a,...this.plugins])}withoutPlugins(){return new dR([])}}let dS=new dR;class dT{numChangedRows;constructor(a){this.numChangedRows=a}}class dU{#b;constructor(a){this.#b=bG(a)}modifyEnd(a){return new dU({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,a.toOperationNode())})}top(a,b){return new dU({...this.#b,queryNode:c_.cloneWithTop(this.#b.queryNode,dn(a,b))})}using(...a){return new dV({...this.#b,queryNode:cZ.cloneWithUsing(this.#b.queryNode,dZ("Using",a))})}returning(a){return new dU({...this.#b,queryNode:c_.cloneWithReturning(this.#b.queryNode,c5(a))})}returningAll(a){return new dU({...this.#b,queryNode:c_.cloneWithReturning(this.#b.queryNode,c7(a))})}output(a){return new dU({...this.#b,queryNode:c_.cloneWithOutput(this.#b.queryNode,c5(a))})}outputAll(a){return new dU({...this.#b,queryNode:c_.cloneWithOutput(this.#b.queryNode,c7(a))})}}class dV{#b;constructor(a){this.#b=bG(a)}modifyEnd(a){return new dV({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,a.toOperationNode())})}top(a,b){return new dV({...this.#b,queryNode:c_.cloneWithTop(this.#b.queryNode,dn(a,b))})}whenMatched(){return this.#v([])}whenMatchedAnd(...a){return this.#v(a)}whenMatchedAndRef(a,b,c){return this.#v([a,b,c],!0)}#v(a,b){return new dW({...this.#b,queryNode:cZ.cloneWithWhen(this.#b.queryNode,dL({isMatched:!0},a,b))})}whenNotMatched(){return this.#w([])}whenNotMatchedAnd(...a){return this.#w(a)}whenNotMatchedAndRef(a,b,c){return this.#w([a,b,c],!0)}whenNotMatchedBySource(){return this.#w([],!1,!0)}whenNotMatchedBySourceAnd(...a){return this.#w(a,!1,!0)}whenNotMatchedBySourceAndRef(a,b,c){return this.#w([a,b,c],!0,!0)}returning(a){return new dV({...this.#b,queryNode:c_.cloneWithReturning(this.#b.queryNode,c5(a))})}returningAll(a){return new dV({...this.#b,queryNode:c_.cloneWithReturning(this.#b.queryNode,c7(a))})}output(a){return new dV({...this.#b,queryNode:c_.cloneWithOutput(this.#b.queryNode,c5(a))})}outputAll(a){return new dV({...this.#b,queryNode:c_.cloneWithOutput(this.#b.queryNode,c7(a))})}#w(a,b=!1,c=!1){let d={...this.#b,queryNode:cZ.cloneWithWhen(this.#b.queryNode,dL({isMatched:!1,bySource:c},a,b))};return new(c?dW:dX)(d)}$call(a){return a(this)}$if(a,b){return a?b(this):new dV({...this.#b})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.queryNode,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){let a=this.compile(),b=await this.#b.executor.executeQuery(a,this.#b.queryId),{adapter:c}=this.#b.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new dT(b.numAffectedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=dg){let b=await this.executeTakeFirst();if(void 0===b)throw dh(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}}class dW{#b;constructor(a){this.#b=bG(a)}thenDelete(){return new dV({...this.#b,queryNode:cZ.cloneWithThen(this.#b.queryNode,dM("delete"))})}thenDoNothing(){return new dV({...this.#b,queryNode:cZ.cloneWithThen(this.#b.queryNode,dM("do nothing"))})}thenUpdate(a){return new dV({...this.#b,queryNode:cZ.cloneWithThen(this.#b.queryNode,dM(a(new dv({queryId:this.#b.queryId,executor:dS,queryNode:cS.createWithoutTable()}))))})}thenUpdateSet(...a){return this.thenUpdate(b=>b.set(...a))}}class dX{#b;constructor(a){this.#b=bG(a)}thenDoNothing(){return new dV({...this.#b,queryNode:cZ.cloneWithThen(this.#b.queryNode,dM("do nothing"))})}thenInsertValues(a){let[b,c]=db(a);return new dV({...this.#b,queryNode:cZ.cloneWithThen(this.#b.queryNode,dM(cQ.cloneWith(cQ.createWithoutInto(),{columns:b,values:c})))})}}class dY{#b;constructor(a){this.#b=bG(a)}selectFrom(a){return new d6({queryId:dD(),executor:this.#b.executor,queryNode:c0.createFrom(ex(a),this.#b.withNode)})}selectNoFrom(a){return new d6({queryId:dD(),executor:this.#b.executor,queryNode:c0.cloneWithSelections(c0.create(this.#b.withNode),c5(a))})}insertInto(a){return new dq({queryId:dD(),executor:this.#b.executor,queryNode:cQ.create(eA(a),this.#b.withNode)})}replaceInto(a){return new dq({queryId:dD(),executor:this.#b.executor,queryNode:cQ.create(eA(a),this.#b.withNode,!0)})}deleteFrom(a){return new dt({queryId:dD(),executor:this.#b.executor,queryNode:cU.create(ex(a),this.#b.withNode)})}updateTable(a){return new dv({queryId:dD(),executor:this.#b.executor,queryNode:cS.create(ex(a),this.#b.withNode)})}mergeInto(a){return new dU({queryId:dD(),executor:this.#b.executor,queryNode:cZ.create(ez(a),this.#b.withNode)})}with(a,b){let c=dz(a,b);return new dY({...this.#b,withNode:this.#b.withNode?dB.cloneWithExpression(this.#b.withNode,c):dB.create(c)})}withRecursive(a,b){let c=dz(a,b);return new dY({...this.#b,withNode:this.#b.withNode?dB.cloneWithExpression(this.#b.withNode,c):dB.create(c,{recursive:!0})})}withPlugin(a){return new dY({...this.#b,executor:this.#b.executor.withPlugin(a)})}withoutPlugins(){return new dY({...this.#b,executor:this.#b.executor.withoutPlugins()})}withSchema(a){return new dY({...this.#b,executor:this.#b.executor.withPluginAtFront(new dJ(a))})}}function dZ(a,b){var c,d,e,f,g,h;if(3===b.length){return c=a,d=b[0],e=b[1],f=b[2],b1.createWithOn(c,ey(d),cE(e,"=",f))}if(2===b.length)return function(a,b,c){return c(new c1({joinNode:b1.create(a,ey(b))})).toOperationNode()}(a,b[0],b[1]);if(1===b.length){return g=a,h=b[0],b1.create(g,ey(h))}throw Error("not implemented")}let d$=bG({is:a=>"OffsetNode"===a.kind,create:a=>bG({kind:"OffsetNode",offset:a})}),d_=bG({is:a=>"GroupByItemNode"===a.kind,create:a=>bG({kind:"GroupByItemNode",groupBy:a})}),d0=bG({is:a=>"SetOperationNode"===a.kind,create:(a,b,c)=>bG({kind:"SetOperationNode",operator:a,expression:b,all:c})});function d1(a,b,c){return bE(b)&&(b=b(et())),bI(b)||(b=[b]),b.map(b=>d0.create(a,eu(b),c))}class d2{#x;constructor(a){this.#x=a}get expressionType(){}as(a){return new d3(this,a)}or(...a){return new d4(b_.create(this.#x,cC(a)))}and(...a){return new d5(b$.create(this.#x,cC(a)))}$castTo(){return new d2(this.#x)}$notNull(){return new d2(this.#x)}toOperationNode(){return this.#x}}class d3{#y;#z;constructor(a,b){this.#y=a,this.#z=b}get expression(){return this.#y}get alias(){return this.#z}toOperationNode(){return bV.create(this.#y.toOperationNode(),bX(this.#z)?this.#z.toOperationNode():bM.create(this.#z))}}class d4{#x;constructor(a){this.#x=a}get expressionType(){}as(a){return new d3(this,a)}or(...a){return new d4(b_.create(this.#x,cC(a)))}$castTo(){return new d4(this.#x)}toOperationNode(){return cB.create(this.#x)}}class d5{#x;constructor(a){this.#x=a}get expressionType(){}as(a){return new d3(this,a)}and(...a){return new d5(b$.create(this.#x,cC(a)))}$castTo(){return new d5(this.#x)}toOperationNode(){return cB.create(this.#x)}}class d6{#b;constructor(a){this.#b=bG(a)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...a){return new d6({...this.#b,queryNode:c_.cloneWithWhere(this.#b.queryNode,cC(a))})}whereRef(a,b,c){return new d6({...this.#b,queryNode:c_.cloneWithWhere(this.#b.queryNode,cE(a,b,c))})}having(...a){return new d6({...this.#b,queryNode:c0.cloneWithHaving(this.#b.queryNode,cC(a))})}havingRef(a,b,c){return new d6({...this.#b,queryNode:c0.cloneWithHaving(this.#b.queryNode,cE(a,b,c))})}select(a){return new d6({...this.#b,queryNode:c0.cloneWithSelections(this.#b.queryNode,c5(a))})}distinctOn(a){return new d6({...this.#b,queryNode:c0.cloneWithDistinctOn(this.#b.queryNode,cp(a))})}modifyFront(a){return new d6({...this.#b,queryNode:c0.cloneWithFrontModifier(this.#b.queryNode,bZ.createWithExpression(a.toOperationNode()))})}modifyEnd(a){return new d6({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,bZ.createWithExpression(a.toOperationNode()))})}distinct(){return new d6({...this.#b,queryNode:c0.cloneWithFrontModifier(this.#b.queryNode,bZ.create("Distinct"))})}forUpdate(a){return new d6({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,bZ.create("ForUpdate",a?bH(a).map(eA):void 0))})}forShare(a){return new d6({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,bZ.create("ForShare",a?bH(a).map(eA):void 0))})}forKeyShare(a){return new d6({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,bZ.create("ForKeyShare",a?bH(a).map(eA):void 0))})}forNoKeyUpdate(a){return new d6({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,bZ.create("ForNoKeyUpdate",a?bH(a).map(eA):void 0))})}skipLocked(){return new d6({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,bZ.create("SkipLocked"))})}noWait(){return new d6({...this.#b,queryNode:c_.cloneWithEndModifier(this.#b.queryNode,bZ.create("NoWait"))})}selectAll(a){return new d6({...this.#b,queryNode:c0.cloneWithSelections(this.#b.queryNode,c7(a))})}innerJoin(...a){return this.#c("InnerJoin",a)}leftJoin(...a){return this.#c("LeftJoin",a)}rightJoin(...a){return this.#c("RightJoin",a)}fullJoin(...a){return this.#c("FullJoin",a)}crossJoin(...a){return this.#c("CrossJoin",a)}innerJoinLateral(...a){return this.#c("LateralInnerJoin",a)}leftJoinLateral(...a){return this.#c("LateralLeftJoin",a)}crossJoinLateral(...a){return this.#c("LateralCrossJoin",a)}crossApply(...a){return this.#c("CrossApply",a)}outerApply(...a){return this.#c("OuterApply",a)}#c(a,b){return new d6({...this.#b,queryNode:c_.cloneWithJoin(this.#b.queryNode,dZ(a,b))})}orderBy(...a){return new d6({...this.#b,queryNode:c_.cloneWithOrderByItems(this.#b.queryNode,ci(a))})}groupBy(a){var b;return new d6({...this.#b,queryNode:c0.cloneWithGroupByItems(this.#b.queryNode,cp(b=bE(b=a)?b(et()):b).map(d_.create))})}limit(a){return new d6({...this.#b,queryNode:c0.cloneWithLimit(this.#b.queryNode,ds.create(cy(a)))})}offset(a){return new d6({...this.#b,queryNode:c0.cloneWithOffset(this.#b.queryNode,d$.create(cy(a)))})}fetch(a,b="only"){return new d6({...this.#b,queryNode:c0.cloneWithFetch(this.#b.queryNode,function(a,b){var c;let d,e;if(!bB(a)&&!bD(a))throw Error(`Invalid fetch row count: ${a}`);if("only"!==(c=b)&&"with ties"!==c)throw Error(`Invalid fetch modifier: ${b}`);return d=a,e=b,{kind:"FetchNode",rowCount:cx.create(d),modifier:e}}(a,b))})}top(a,b){return new d6({...this.#b,queryNode:c_.cloneWithTop(this.#b.queryNode,dn(a,b))})}union(a){return new d6({...this.#b,queryNode:c0.cloneWithSetOperations(this.#b.queryNode,d1("union",a,!1))})}unionAll(a){return new d6({...this.#b,queryNode:c0.cloneWithSetOperations(this.#b.queryNode,d1("union",a,!0))})}intersect(a){return new d6({...this.#b,queryNode:c0.cloneWithSetOperations(this.#b.queryNode,d1("intersect",a,!1))})}intersectAll(a){return new d6({...this.#b,queryNode:c0.cloneWithSetOperations(this.#b.queryNode,d1("intersect",a,!0))})}except(a){return new d6({...this.#b,queryNode:c0.cloneWithSetOperations(this.#b.queryNode,d1("except",a,!1))})}exceptAll(a){return new d6({...this.#b,queryNode:c0.cloneWithSetOperations(this.#b.queryNode,d1("except",a,!0))})}as(a){return new d7(this,a)}clearSelect(){return new d6({...this.#b,queryNode:c0.cloneWithoutSelections(this.#b.queryNode)})}clearWhere(){return new d6({...this.#b,queryNode:c_.cloneWithoutWhere(this.#b.queryNode)})}clearLimit(){return new d6({...this.#b,queryNode:c0.cloneWithoutLimit(this.#b.queryNode)})}clearOffset(){return new d6({...this.#b,queryNode:c0.cloneWithoutOffset(this.#b.queryNode)})}clearOrderBy(){return new d6({...this.#b,queryNode:c_.cloneWithoutOrderBy(this.#b.queryNode)})}clearGroupBy(){return new d6({...this.#b,queryNode:c0.cloneWithoutGroupBy(this.#b.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new d6({...this.#b})}$castTo(){return new d6(this.#b)}$narrowType(){return new d6(this.#b)}$assertType(){return new d6(this.#b)}$asTuple(){return new d2(this.toOperationNode())}$asScalar(){return new d2(this.toOperationNode())}withPlugin(a){return new d6({...this.#b,executor:this.#b.executor.withPlugin(a)})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.queryNode,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){let a=this.compile();return(await this.#b.executor.executeQuery(a,this.#b.queryId)).rows}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=dg){let b=await this.executeTakeFirst();if(void 0===b)throw dh(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#b.executor.stream(b,a,this.#b.queryId))yield*c.rows}async explain(a,b){let c=new d6({...this.#b,queryNode:c_.cloneWithExplain(this.#b.queryNode,a,b)});return await c.execute()}}class d7{#A;#z;constructor(a,b){this.#A=a,this.#z=b}get expression(){return this.#A}get alias(){return this.#z}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return bV.create(this.#A.toOperationNode(),bM.create(this.#z))}}let d8=bG({is:a=>"AggregateFunctionNode"===a.kind,create:(a,b=[])=>bG({kind:"AggregateFunctionNode",func:a,aggregated:b}),cloneWithDistinct:a=>bG({...a,distinct:!0}),cloneWithOrderBy(a,b,c=!1){let d=c?"withinGroup":"orderBy";return bG({...a,[d]:a[d]?cK.cloneWithItems(a[d],b):cK.create(b)})},cloneWithFilter:(a,b)=>bG({...a,filter:a.filter?cV.cloneWithOperation(a.filter,"And",b):cV.create(b)}),cloneWithOrFilter:(a,b)=>bG({...a,filter:a.filter?cV.cloneWithOperation(a.filter,"Or",b):cV.create(b)}),cloneWithOver:(a,b)=>bG({...a,over:b})}),d9=bG({is:a=>"FunctionNode"===a.kind,create:(a,b)=>bG({kind:"FunctionNode",func:a,arguments:b})});class ea{#b;constructor(a){this.#b=bG(a)}get expressionType(){}as(a){return new eb(this,a)}distinct(){return new ea({...this.#b,aggregateFunctionNode:d8.cloneWithDistinct(this.#b.aggregateFunctionNode)})}orderBy(...a){return new ea({...this.#b,aggregateFunctionNode:c_.cloneWithOrderByItems(this.#b.aggregateFunctionNode,ci(a))})}clearOrderBy(){return new ea({...this.#b,aggregateFunctionNode:c_.cloneWithoutOrderBy(this.#b.aggregateFunctionNode)})}withinGroupOrderBy(...a){return new ea({...this.#b,aggregateFunctionNode:d8.cloneWithOrderBy(this.#b.aggregateFunctionNode,ci(a),!0)})}filterWhere(...a){return new ea({...this.#b,aggregateFunctionNode:d8.cloneWithFilter(this.#b.aggregateFunctionNode,cC(a))})}filterWhereRef(a,b,c){return new ea({...this.#b,aggregateFunctionNode:d8.cloneWithFilter(this.#b.aggregateFunctionNode,cE(a,b,c))})}over(a){let b=new c3({overNode:cM.create()});return new ea({...this.#b,aggregateFunctionNode:d8.cloneWithOver(this.#b.aggregateFunctionNode,(a?a(b):b).toOperationNode())})}$call(a){return a(this)}$castTo(){return new ea(this.#b)}$notNull(){return new ea(this.#b)}toOperationNode(){return this.#b.aggregateFunctionNode}}class eb{#B;#z;constructor(a,b){this.#B=a,this.#z=b}get expression(){return this.#B}get alias(){return this.#z}toOperationNode(){return bV.create(this.#B.toOperationNode(),bM.create(this.#z))}}function ec(){let a=(a,b)=>new d2(d9.create(a,cp(b??[]))),b=(a,b)=>new ea({aggregateFunctionNode:d8.create(a,b?cp(b):void 0)});return Object.assign(a,{agg:b,avg:a=>b("avg",[a]),coalesce:(...b)=>a("coalesce",b),count:a=>b("count",[a]),countAll:a=>new ea({aggregateFunctionNode:d8.create("count",c7(a))}),max:a=>b("max",[a]),min:a=>b("min",[a]),sum:a=>b("sum",[a]),any:b=>a("any",[b]),jsonAgg:a=>new ea({aggregateFunctionNode:d8.create("json_agg",[bA(a)?eA(a):a.toOperationNode()])}),toJson:a=>new d2(d9.create("to_json",[bA(a)?eA(a):a.toOperationNode()]))})}let ed=bG({is:a=>"UnaryOperationNode"===a.kind,create:(a,b)=>bG({kind:"UnaryOperationNode",operator:a,operand:b})}),ee=bG({is:a=>"CaseNode"===a.kind,create:a=>bG({kind:"CaseNode",value:a}),cloneWithWhen:(a,b)=>bG({...a,when:bG(a.when?[...a.when,b]:[b])}),cloneWithThen:(a,b)=>bG({...a,when:a.when?bG([...a.when.slice(0,-1),cY.cloneWithResult(a.when[a.when.length-1],b)]):void 0}),cloneWith:(a,b)=>bG({...a,...b})});class ef{#b;constructor(a){this.#b=bG(a)}when(...a){return new eg({...this.#b,node:ee.cloneWithWhen(this.#b.node,cY.create(cC(a)))})}}class eg{#b;constructor(a){this.#b=bG(a)}then(a){return new eh({...this.#b,node:ee.cloneWithThen(this.#b.node,cz(a)?cA(a):cy(a))})}}class eh{#b;constructor(a){this.#b=bG(a)}when(...a){return new eg({...this.#b,node:ee.cloneWithWhen(this.#b.node,cY.create(cC(a)))})}else(a){return new ei({...this.#b,node:ee.cloneWith(this.#b.node,{else:cz(a)?cA(a):cy(a)})})}end(){return new d2(ee.cloneWith(this.#b.node,{isStatement:!1}))}endCase(){return new d2(ee.cloneWith(this.#b.node,{isStatement:!0}))}}class ei{#b;constructor(a){this.#b=bG(a)}end(){return new d2(ee.cloneWith(this.#b.node,{isStatement:!1}))}endCase(){return new d2(ee.cloneWith(this.#b.node,{isStatement:!0}))}}let ej=bG({is:a=>"JSONPathLegNode"===a.kind,create:(a,b)=>bG({kind:"JSONPathLegNode",type:a,value:b})});class ek{#x;constructor(a){this.#x=a}at(a){return this.#C("ArrayLocation",a)}key(a){return this.#C("Member",a)}#C(a,b){return new el(cl.is(this.#x)?cl.cloneWithTraversal(this.#x,cn.is(this.#x.traversal)?cn.cloneWithLeg(this.#x.traversal,ej.create(a,b)):cm.cloneWithValue(this.#x.traversal,cx.createImmediate(b))):cn.cloneWithLeg(this.#x,ej.create(a,b)))}}class el extends ek{#x;constructor(a){super(a),this.#x=a}get expressionType(){}as(a){return new em(this,a)}$castTo(){return new el(this.#x)}$notNull(){return new el(this.#x)}toOperationNode(){return this.#x}}class em{#D;#z;constructor(a,b){this.#D=a,this.#z=b}get expression(){return this.#D}get alias(){return this.#z}toOperationNode(){return bV.create(this.#D.toOperationNode(),bX(this.#z)?this.#z.toOperationNode():bM.create(this.#z))}}let en=bG({is:a=>"TupleNode"===a.kind,create:a=>bG({kind:"TupleNode",values:bG(a)})}),eo=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],ep=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],eq=bG({is:a=>"DataTypeNode"===a.kind,create:a=>bG({kind:"DataTypeNode",dataType:a})});function er(a){if(bX(a))return a.toOperationNode();if(eo.includes(a)||ep.some(b=>b.test(a)))return eq.create(a);throw Error(`invalid column data type ${JSON.stringify(a)}`)}let es=bG({is:a=>"CastNode"===a.kind,create:(a,b)=>bG({kind:"CastNode",expression:a,dataType:b})});function et(a=dS){function b(a,b){return new d2(ed.create(b5.create(a),cq(b)))}let c=Object.assign(function(a,b,c){return new d2(cD(a,b,c))},{fn:void 0,eb:void 0,selectFrom:b=>new d6({queryId:dD(),executor:a,queryNode:c0.createFrom(ex(b))}),case:a=>new ef({node:ee.create(bz(a)?void 0:cq(a))}),ref:(a,b)=>bz(b)?new d2(cr(a)):new ek(function(a,b){let c=cr(a);if(b6(b))return cl.create(c,cm.create(b5.create(b)));let d=b.slice(0,-1);if(b6(d))return cl.create(c,cn.create(b5.create(d)));throw Error(`Invalid JSON operator: ${b}`)}(a,b)),jsonPath:()=>new ek(cn.create()),table:a=>new d2(eA(a)),val:a=>new d2(cy(a)),refTuple:(...a)=>new d2(en.create(a.map(cq))),tuple:(...a)=>new d2(en.create(a.map(cy))),lit:a=>new d2(cA(a)),unary:b,not:a=>b("not",a),exists:a=>b("exists",a),neg:a=>b("-",a),between:(a,b,c)=>new d2(b2.create(cq(a),b5.create("between"),b$.create(cy(b),cy(c)))),betweenSymmetric:(a,b,c)=>new d2(b2.create(cq(a),b5.create("between symmetric"),b$.create(cy(b),cy(c)))),and:a=>new d2(bI(a)?cG(a,"and"):cF(a,"and")),or:a=>new d2(bI(a)?cG(a,"or"):cF(a,"or")),parens(...a){let b=cC(a);return new d2(cB.is(b)?b:cB.create(b))},cast:(a,b)=>new d2(es.create(cq(a),er(b))),withSchema:b=>et(a.withPluginAtFront(new dJ(b)))});return c.fn=ec(),c.eb=c,c}function eu(a){if(bX(a))return a.toOperationNode();if(bE(a))return a(et()).toOperationNode();throw Error(`invalid expression: ${JSON.stringify(a)}`)}function ev(a){if(bX(a))return a.toOperationNode();if(bE(a))return a(et()).toOperationNode();throw Error(`invalid aliased expression: ${JSON.stringify(a)}`)}function ew(a){return bY(a)||bF(a)&&"expression"in a&&bA(a.alias)&&bX(a)||bE(a)}function ex(a){return bI(a)?a.map(a=>ey(a)):[ey(a)]}function ey(a){return bA(a)?ez(a):ev(a)}function ez(a){let b=" as ";if(!a.includes(b))return eA(a);{let[c,d]=a.split(b).map(eB);return bV.create(eA(c),bM.create(d))}}function eA(a){if(!a.includes("."))return bW.create(a);{let[b,c]=a.split(".").map(eB);return bW.createWithSchema(b,c)}}function eB(a){return a.trim()}let eC=bG({is:a=>"AddColumnNode"===a.kind,create:a=>bG({kind:"AddColumnNode",column:a})}),eD=bG({is:a=>"ColumnDefinitionNode"===a.kind,create:(a,b)=>bG({kind:"ColumnDefinitionNode",column:b7.create(a),dataType:b}),cloneWithFrontModifier:(a,b)=>bG({...a,frontModifiers:a.frontModifiers?bG([...a.frontModifiers,b]):[b]}),cloneWithEndModifier:(a,b)=>bG({...a,endModifiers:a.endModifiers?bG([...a.endModifiers,b]):[b]}),cloneWith:(a,b)=>bG({...a,...b})}),eE=bG({is:a=>"DropColumnNode"===a.kind,create:a=>bG({kind:"DropColumnNode",column:b7.create(a)})}),eF=bG({is:a=>"RenameColumnNode"===a.kind,create:(a,b)=>bG({kind:"RenameColumnNode",column:b7.create(a),renameTo:b7.create(b)})}),eG=bG({is:a=>"CheckConstraintNode"===a.kind,create:(a,b)=>bG({kind:"CheckConstraintNode",expression:a,name:b?bM.create(b):void 0})}),eH=["no action","restrict","cascade","set null","set default"],eI=bG({is:a=>"ReferencesNode"===a.kind,create:(a,b)=>bG({kind:"ReferencesNode",table:a,columns:bG([...b])}),cloneWithOnDelete:(a,b)=>bG({...a,onDelete:b}),cloneWithOnUpdate:(a,b)=>bG({...a,onUpdate:b})});function eJ(a){return bX(a)?a.toOperationNode():cx.createImmediate(a)}let eK=bG({is:a=>"GeneratedNode"===a.kind,create:a=>bG({kind:"GeneratedNode",...a}),createWithExpression:a=>bG({kind:"GeneratedNode",always:!0,expression:a}),cloneWith:(a,b)=>bG({...a,...b})}),eL=bG({is:a=>"DefaultValueNode"===a.kind,create:a=>bG({kind:"DefaultValueNode",defaultValue:a})});function eM(a){if(eH.includes(a))return a;throw Error(`invalid OnModifyForeignAction ${a}`)}class eN{#x;constructor(a){this.#x=a}autoIncrement(){return new eN(eD.cloneWith(this.#x,{autoIncrement:!0}))}identity(){return new eN(eD.cloneWith(this.#x,{identity:!0}))}primaryKey(){return new eN(eD.cloneWith(this.#x,{primaryKey:!0}))}references(a){let b=cr(a);if(!b.table||b8.is(b.column))throw Error(`invalid call references('${a}'). The reference must have format table.column or schema.table.column`);return new eN(eD.cloneWith(this.#x,{references:eI.create(b.table,[b.column])}))}onDelete(a){if(!this.#x.references)throw Error("on delete constraint can only be added for foreign keys");return new eN(eD.cloneWith(this.#x,{references:eI.cloneWithOnDelete(this.#x.references,eM(a))}))}onUpdate(a){if(!this.#x.references)throw Error("on update constraint can only be added for foreign keys");return new eN(eD.cloneWith(this.#x,{references:eI.cloneWithOnUpdate(this.#x.references,eM(a))}))}unique(){return new eN(eD.cloneWith(this.#x,{unique:!0}))}notNull(){return new eN(eD.cloneWith(this.#x,{notNull:!0}))}unsigned(){return new eN(eD.cloneWith(this.#x,{unsigned:!0}))}defaultTo(a){return new eN(eD.cloneWith(this.#x,{defaultTo:eL.create(eJ(a))}))}check(a){return new eN(eD.cloneWith(this.#x,{check:eG.create(a.toOperationNode())}))}generatedAlwaysAs(a){return new eN(eD.cloneWith(this.#x,{generated:eK.createWithExpression(a.toOperationNode())}))}generatedAlwaysAsIdentity(){return new eN(eD.cloneWith(this.#x,{generated:eK.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new eN(eD.cloneWith(this.#x,{generated:eK.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#x.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new eN(eD.cloneWith(this.#x,{generated:eK.cloneWith(this.#x.generated,{stored:!0})}))}modifyFront(a){return new eN(eD.cloneWithFrontModifier(this.#x,a.toOperationNode()))}nullsNotDistinct(){return new eN(eD.cloneWith(this.#x,{nullsNotDistinct:!0}))}ifNotExists(){return new eN(eD.cloneWith(this.#x,{ifNotExists:!0}))}modifyEnd(a){return new eN(eD.cloneWithEndModifier(this.#x,a.toOperationNode()))}$call(a){return a(this)}toOperationNode(){return this.#x}}let eO=bG({is:a=>"ModifyColumnNode"===a.kind,create:a=>bG({kind:"ModifyColumnNode",column:a})}),eP=bG({is:a=>"ForeignKeyConstraintNode"===a.kind,create:(a,b,c,d)=>bG({kind:"ForeignKeyConstraintNode",columns:a,references:eI.create(b,c),name:d?bM.create(d):void 0}),cloneWith:(a,b)=>bG({...a,...b})});class eQ{#x;constructor(a){this.#x=a}onDelete(a){return new eQ(eP.cloneWith(this.#x,{onDelete:eM(a)}))}onUpdate(a){return new eQ(eP.cloneWith(this.#x,{onUpdate:eM(a)}))}deferrable(){return new eQ(eP.cloneWith(this.#x,{deferrable:!0}))}notDeferrable(){return new eQ(eP.cloneWith(this.#x,{deferrable:!1}))}initiallyDeferred(){return new eQ(eP.cloneWith(this.#x,{initiallyDeferred:!0}))}initiallyImmediate(){return new eQ(eP.cloneWith(this.#x,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#x}}let eR=bG({is:a=>"AddConstraintNode"===a.kind,create:a=>bG({kind:"AddConstraintNode",constraint:a})}),eS=bG({is:a=>"UniqueConstraintNode"===a.kind,create:(a,b,c)=>bG({kind:"UniqueConstraintNode",columns:bG(a.map(b7.create)),name:b?bM.create(b):void 0,nullsNotDistinct:c}),cloneWith:(a,b)=>bG({...a,...b})}),eT=bG({is:a=>"DropConstraintNode"===a.kind,create:a=>bG({kind:"DropConstraintNode",constraintName:bM.create(a)}),cloneWith:(a,b)=>bG({...a,...b})}),eU=bG({is:a=>"AlterColumnNode"===a.kind,create:(a,b,c)=>bG({kind:"AlterColumnNode",column:b7.create(a),[b]:c})});class eV{#E;constructor(a){this.#E=a}setDataType(a){return new eW(eU.create(this.#E,"dataType",er(a)))}setDefault(a){return new eW(eU.create(this.#E,"setDefault",eJ(a)))}dropDefault(){return new eW(eU.create(this.#E,"dropDefault",!0))}setNotNull(){return new eW(eU.create(this.#E,"setNotNull",!0))}dropNotNull(){return new eW(eU.create(this.#E,"dropNotNull",!0))}$call(a){return a(this)}}class eW{#F;constructor(a){this.#F=a}toOperationNode(){return this.#F}}class eX{#b;constructor(a){this.#b=bG(a)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class eY{#b;constructor(a){this.#b=bG(a)}onDelete(a){return new eY({...this.#b,constraintBuilder:this.#b.constraintBuilder.onDelete(a)})}onUpdate(a){return new eY({...this.#b,constraintBuilder:this.#b.constraintBuilder.onUpdate(a)})}deferrable(){return new eY({...this.#b,constraintBuilder:this.#b.constraintBuilder.deferrable()})}notDeferrable(){return new eY({...this.#b,constraintBuilder:this.#b.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new eY({...this.#b,constraintBuilder:this.#b.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new eY({...this.#b,constraintBuilder:this.#b.constraintBuilder.initiallyImmediate()})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(bL.cloneWithTableProps(this.#b.node,{addConstraint:eR.create(this.#b.constraintBuilder.toOperationNode())}),this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class eZ{#b;constructor(a){this.#b=bG(a)}ifExists(){return new eZ({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{dropConstraint:eT.cloneWith(this.#b.node.dropConstraint,{ifExists:!0})})})}cascade(){return new eZ({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{dropConstraint:eT.cloneWith(this.#b.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new eZ({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{dropConstraint:eT.cloneWith(this.#b.node.dropConstraint,{modifier:"restrict"})})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}let e$=bG({is:a=>"PrimaryKeyConstraintNode"===a.kind,create:(a,b)=>bG({kind:"PrimaryKeyConstraintNode",columns:bG(a.map(b7.create)),name:b?bM.create(b):void 0}),cloneWith:(a,b)=>bG({...a,...b})}),e_=bG({is:a=>"AddIndexNode"===a.kind,create:a=>bG({kind:"AddIndexNode",name:bM.create(a)}),cloneWith:(a,b)=>bG({...a,...b}),cloneWithColumns:(a,b)=>bG({...a,columns:[...a.columns||[],...b]})});class e0{#b;constructor(a){this.#b=bG(a)}unique(){return new e0({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{addIndex:e_.cloneWith(this.#b.node.addIndex,{unique:!0})})})}column(a){return new e0({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{addIndex:e_.cloneWithColumns(this.#b.node.addIndex,[ct(a)])})})}columns(a){return new e0({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{addIndex:e_.cloneWithColumns(this.#b.node.addIndex,a.map(ct))})})}expression(a){return new e0({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{addIndex:e_.cloneWithColumns(this.#b.node.addIndex,[a.toOperationNode()])})})}using(a){return new e0({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{addIndex:e_.cloneWith(this.#b.node.addIndex,{using:cd.createWithSql(a)})})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class e1{#x;constructor(a){this.#x=a}nullsNotDistinct(){return new e1(eS.cloneWith(this.#x,{nullsNotDistinct:!0}))}deferrable(){return new e1(eS.cloneWith(this.#x,{deferrable:!0}))}notDeferrable(){return new e1(eS.cloneWith(this.#x,{deferrable:!1}))}initiallyDeferred(){return new e1(eS.cloneWith(this.#x,{initiallyDeferred:!0}))}initiallyImmediate(){return new e1(eS.cloneWith(this.#x,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#x}}class e2{#x;constructor(a){this.#x=a}deferrable(){return new e2(e$.cloneWith(this.#x,{deferrable:!0}))}notDeferrable(){return new e2(e$.cloneWith(this.#x,{deferrable:!1}))}initiallyDeferred(){return new e2(e$.cloneWith(this.#x,{initiallyDeferred:!0}))}initiallyImmediate(){return new e2(e$.cloneWith(this.#x,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#x}}class e3{#x;constructor(a){this.#x=a}$call(a){return a(this)}toOperationNode(){return this.#x}}let e4=bG({is:a=>"RenameConstraintNode"===a.kind,create:(a,b)=>bG({kind:"RenameConstraintNode",oldName:bM.create(a),newName:bM.create(b)})});class e5{#b;constructor(a){this.#b=bG(a)}renameTo(a){return new eX({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{renameTo:eA(a)})})}setSchema(a){return new eX({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{setSchema:bM.create(a)})})}alterColumn(a,b){let c=b(new eV(a));return new e6({...this.#b,node:bL.cloneWithColumnAlteration(this.#b.node,c.toOperationNode())})}dropColumn(a){return new e6({...this.#b,node:bL.cloneWithColumnAlteration(this.#b.node,eE.create(a))})}renameColumn(a,b){return new e6({...this.#b,node:bL.cloneWithColumnAlteration(this.#b.node,eF.create(a,b))})}addColumn(a,b,c=bJ){let d=c(new eN(eD.create(a,er(b))));return new e6({...this.#b,node:bL.cloneWithColumnAlteration(this.#b.node,eC.create(d.toOperationNode()))})}modifyColumn(a,b,c=bJ){let d=c(new eN(eD.create(a,er(b))));return new e6({...this.#b,node:bL.cloneWithColumnAlteration(this.#b.node,eO.create(d.toOperationNode()))})}addUniqueConstraint(a,b,c=bJ){let d=c(new e1(eS.create(b,a)));return new eX({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{addConstraint:eR.create(d.toOperationNode())})})}addCheckConstraint(a,b,c=bJ){let d=c(new e3(eG.create(b.toOperationNode(),a)));return new eX({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{addConstraint:eR.create(d.toOperationNode())})})}addForeignKeyConstraint(a,b,c,d,e=bJ){let f=e(new eQ(eP.create(b.map(b7.create),eA(c),d.map(b7.create),a)));return new eY({...this.#b,constraintBuilder:f})}addPrimaryKeyConstraint(a,b,c=bJ){let d=c(new e2(e$.create(b,a)));return new eX({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{addConstraint:eR.create(d.toOperationNode())})})}dropConstraint(a){return new eZ({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{dropConstraint:eT.create(a)})})}renameConstraint(a,b){return new eZ({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{renameConstraint:e4.create(a,b)})})}addIndex(a){return new e0({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{addIndex:e_.create(a)})})}dropIndex(a){return new eX({...this.#b,node:bL.cloneWithTableProps(this.#b.node,{dropIndex:bS.create(a)})})}$call(a){return a(this)}}class e6{#b;constructor(a){this.#b=bG(a)}alterColumn(a,b){let c=b(new eV(a));return new e6({...this.#b,node:bL.cloneWithColumnAlteration(this.#b.node,c.toOperationNode())})}dropColumn(a){return new e6({...this.#b,node:bL.cloneWithColumnAlteration(this.#b.node,eE.create(a))})}renameColumn(a,b){return new e6({...this.#b,node:bL.cloneWithColumnAlteration(this.#b.node,eF.create(a,b))})}addColumn(a,b,c=bJ){let d=c(new eN(eD.create(a,er(b))));return new e6({...this.#b,node:bL.cloneWithColumnAlteration(this.#b.node,eC.create(d.toOperationNode()))})}modifyColumn(a,b,c=bJ){let d=c(new eN(eD.create(a,er(b))));return new e6({...this.#b,node:bL.cloneWithColumnAlteration(this.#b.node,eO.create(d.toOperationNode()))})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class e7 extends dF{transformPrimitiveValueList(a){return cw.create(a.values.map(cx.createImmediate))}transformValue(a){return cx.createImmediate(a.value)}}class e8{#b;constructor(a){this.#b=bG(a)}ifNotExists(){return new e8({...this.#b,node:bN.cloneWith(this.#b.node,{ifNotExists:!0})})}unique(){return new e8({...this.#b,node:bN.cloneWith(this.#b.node,{unique:!0})})}nullsNotDistinct(){return new e8({...this.#b,node:bN.cloneWith(this.#b.node,{nullsNotDistinct:!0})})}on(a){return new e8({...this.#b,node:bN.cloneWith(this.#b.node,{table:eA(a)})})}column(a){return new e8({...this.#b,node:bN.cloneWithColumns(this.#b.node,[ct(a)])})}columns(a){return new e8({...this.#b,node:bN.cloneWithColumns(this.#b.node,a.map(ct))})}expression(a){return new e8({...this.#b,node:bN.cloneWithColumns(this.#b.node,[a.toOperationNode()])})}using(a){return new e8({...this.#b,node:bN.cloneWith(this.#b.node,{using:cd.createWithSql(a)})})}where(...a){let b=new e7;return new e8({...this.#b,node:c_.cloneWithWhere(this.#b.node,b.transformNode(cC(a),this.#b.queryId))})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class e9{#b;constructor(a){this.#b=bG(a)}ifNotExists(){return new e9({...this.#b,node:bO.cloneWith(this.#b.node,{ifNotExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class fa{#b;constructor(a){this.#b=bG(a)}temporary(){return new fa({...this.#b,node:bQ.cloneWith(this.#b.node,{temporary:!0})})}onCommit(a){return new fa({...this.#b,node:bQ.cloneWith(this.#b.node,{onCommit:function(a){if(bP.includes(a))return a;throw Error(`invalid OnCommitAction ${a}`)}(a)})})}ifNotExists(){return new fa({...this.#b,node:bQ.cloneWith(this.#b.node,{ifNotExists:!0})})}addColumn(a,b,c=bJ){let d=c(new eN(eD.create(a,er(b))));return new fa({...this.#b,node:bQ.cloneWithColumn(this.#b.node,d.toOperationNode())})}addPrimaryKeyConstraint(a,b,c=bJ){let d=c(new e2(e$.create(b,a)));return new fa({...this.#b,node:bQ.cloneWithConstraint(this.#b.node,d.toOperationNode())})}addUniqueConstraint(a,b,c=bJ){let d=c(new e1(eS.create(b,a)));return new fa({...this.#b,node:bQ.cloneWithConstraint(this.#b.node,d.toOperationNode())})}addCheckConstraint(a,b,c=bJ){let d=c(new e3(eG.create(b.toOperationNode(),a)));return new fa({...this.#b,node:bQ.cloneWithConstraint(this.#b.node,d.toOperationNode())})}addForeignKeyConstraint(a,b,c,d,e=bJ){let f=e(new eQ(eP.create(b.map(b7.create),eA(c),d.map(b7.create),a)));return new fa({...this.#b,node:bQ.cloneWithConstraint(this.#b.node,f.toOperationNode())})}modifyFront(a){return new fa({...this.#b,node:bQ.cloneWithFrontModifier(this.#b.node,a.toOperationNode())})}modifyEnd(a){return new fa({...this.#b,node:bQ.cloneWithEndModifier(this.#b.node,a.toOperationNode())})}as(a){return new fa({...this.#b,node:bQ.cloneWith(this.#b.node,{selectQuery:eu(a)})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class fb{#b;constructor(a){this.#b=bG(a)}on(a){return new fb({...this.#b,node:bS.cloneWith(this.#b.node,{table:eA(a)})})}ifExists(){return new fb({...this.#b,node:bS.cloneWith(this.#b.node,{ifExists:!0})})}cascade(){return new fb({...this.#b,node:bS.cloneWith(this.#b.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class fc{#b;constructor(a){this.#b=bG(a)}ifExists(){return new fc({...this.#b,node:bT.cloneWith(this.#b.node,{ifExists:!0})})}cascade(){return new fc({...this.#b,node:bT.cloneWith(this.#b.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class fd{#b;constructor(a){this.#b=bG(a)}ifExists(){return new fd({...this.#b,node:bU.cloneWith(this.#b.node,{ifExists:!0})})}cascade(){return new fd({...this.#b,node:bU.cloneWith(this.#b.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}let fe=bG({is:a=>"CreateViewNode"===a.kind,create:a=>bG({kind:"CreateViewNode",name:bR.create(a)}),cloneWith:(a,b)=>bG({...a,...b})});class ff{#p=new e7;transformQuery(a){return this.#p.transformNode(a.node,a.queryId)}transformResult(a){return Promise.resolve(a.result)}}class fg{#b;constructor(a){this.#b=bG(a)}temporary(){return new fg({...this.#b,node:fe.cloneWith(this.#b.node,{temporary:!0})})}materialized(){return new fg({...this.#b,node:fe.cloneWith(this.#b.node,{materialized:!0})})}ifNotExists(){return new fg({...this.#b,node:fe.cloneWith(this.#b.node,{ifNotExists:!0})})}orReplace(){return new fg({...this.#b,node:fe.cloneWith(this.#b.node,{orReplace:!0})})}columns(a){return new fg({...this.#b,node:fe.cloneWith(this.#b.node,{columns:a.map(cs)})})}as(a){let b=a.withPlugin(new ff).toOperationNode();return new fg({...this.#b,node:fe.cloneWith(this.#b.node,{as:b})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}let fh=bG({is:a=>"DropViewNode"===a.kind,create:a=>bG({kind:"DropViewNode",name:bR.create(a)}),cloneWith:(a,b)=>bG({...a,...b})});class fi{#b;constructor(a){this.#b=bG(a)}materialized(){return new fi({...this.#b,node:fh.cloneWith(this.#b.node,{materialized:!0})})}ifExists(){return new fi({...this.#b,node:fh.cloneWith(this.#b.node,{ifExists:!0})})}cascade(){return new fi({...this.#b,node:fh.cloneWith(this.#b.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}let fj=bG({is:a=>"CreateTypeNode"===a.kind,create:a=>bG({kind:"CreateTypeNode",name:a}),cloneWithEnum:(a,b)=>bG({...a,enum:cw.create(b.map(cx.createImmediate))})});class fk{#b;constructor(a){this.#b=bG(a)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}asEnum(a){return new fk({...this.#b,node:fj.cloneWithEnum(this.#b.node,a)})}$call(a){return a(this)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}let fl=bG({is:a=>"DropTypeNode"===a.kind,create:a=>bG({kind:"DropTypeNode",name:a}),cloneWith:(a,b)=>bG({...a,...b})});class fm{#b;constructor(a){this.#b=bG(a)}ifExists(){return new fm({...this.#b,node:fl.cloneWith(this.#b.node,{ifExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}function fn(a){if(!a.includes("."))return bR.create(a);{let b=a.split(".").map(fo);if(2===b.length)return bR.createWithSchema(b[0],b[1]);throw Error(`invalid schemable identifier ${a}`)}}function fo(a){return a.trim()}let fp=bG({is:a=>"RefreshMaterializedViewNode"===a.kind,create:a=>bG({kind:"RefreshMaterializedViewNode",name:bR.create(a)}),cloneWith:(a,b)=>bG({...a,...b})});class fq{#b;constructor(a){this.#b=bG(a)}concurrently(){return new fq({...this.#b,node:fp.cloneWith(this.#b.node,{concurrently:!0,withNoData:!1})})}withData(){return new fq({...this.#b,node:fp.cloneWith(this.#b.node,{withNoData:!1})})}withNoData(){return new fq({...this.#b,node:fp.cloneWith(this.#b.node,{withNoData:!0,concurrently:!1})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class fr{#G;constructor(a){this.#G=a}createTable(a){return new fa({queryId:dD(),executor:this.#G,node:bQ.create(eA(a))})}dropTable(a){return new fd({queryId:dD(),executor:this.#G,node:bU.create(eA(a))})}createIndex(a){return new e8({queryId:dD(),executor:this.#G,node:bN.create(a)})}dropIndex(a){return new fb({queryId:dD(),executor:this.#G,node:bS.create(a)})}createSchema(a){return new e9({queryId:dD(),executor:this.#G,node:bO.create(a)})}dropSchema(a){return new fc({queryId:dD(),executor:this.#G,node:bT.create(a)})}alterTable(a){return new e5({queryId:dD(),executor:this.#G,node:bL.create(eA(a))})}createView(a){return new fg({queryId:dD(),executor:this.#G,node:fe.create(a)})}refreshMaterializedView(a){return new fq({queryId:dD(),executor:this.#G,node:fp.create(a)})}dropView(a){return new fi({queryId:dD(),executor:this.#G,node:fh.create(a)})}createType(a){return new fk({queryId:dD(),executor:this.#G,node:fj.create(fn(a))})}dropType(a){return new fm({queryId:dD(),executor:this.#G,node:fl.create(fn(a))})}withPlugin(a){return new fr(this.#G.withPlugin(a))}withoutPlugins(){return new fr(this.#G.withoutPlugins())}withSchema(a){return new fr(this.#G.withPluginAtFront(new dJ(a)))}}class fs{ref(a){return new ca(a)}}class ft{#H;constructor(a){this.#H=a}async provideConnection(a){let b=await this.#H.acquireConnection();try{return await a(b)}finally{await this.#H.releaseConnection(b)}}}class fu extends dQ{#I;#J;#K;constructor(a,b,c,d=[]){super(d),this.#I=a,this.#J=b,this.#K=c}get adapter(){return this.#J}compileQuery(a,b){return this.#I.compileQuery(a,b)}provideConnection(a){return this.#K.provideConnection(a)}withPlugins(a){return new fu(this.#I,this.#J,this.#K,[...this.plugins,...a])}withPlugin(a){return new fu(this.#I,this.#J,this.#K,[...this.plugins,a])}withPluginAtFront(a){return new fu(this.#I,this.#J,this.#K,[a,...this.plugins])}withConnectionProvider(a){return new fu(this.#I,this.#J,a,[...this.plugins])}withoutPlugins(){return new fu(this.#I,this.#J,this.#K,[])}}function fv(){return"undefined"!=typeof performance&&bE(performance.now)?performance.now():Date.now()}class fw{#H;#L;#M;#N;#O;#P=new WeakSet;constructor(a,b){this.#N=!1,this.#H=a,this.#L=b}async init(){if(this.#O)throw Error("driver has already been destroyed");this.#M||(this.#M=this.#H.init().then(()=>{this.#N=!0}).catch(a=>(this.#M=void 0,Promise.reject(a)))),await this.#M}async acquireConnection(){if(this.#O)throw Error("driver has already been destroyed");this.#N||await this.init();let a=await this.#H.acquireConnection();return this.#P.has(a)||(this.#Q()&&this.#R(a),this.#P.add(a)),a}async releaseConnection(a){await this.#H.releaseConnection(a)}beginTransaction(a,b){return this.#H.beginTransaction(a,b)}commitTransaction(a){return this.#H.commitTransaction(a)}rollbackTransaction(a){return this.#H.rollbackTransaction(a)}savepoint(a,b,c){if(this.#H.savepoint)return this.#H.savepoint(a,b,c);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(a,b,c){if(this.#H.rollbackToSavepoint)return this.#H.rollbackToSavepoint(a,b,c);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(a,b,c){if(this.#H.releaseSavepoint)return this.#H.releaseSavepoint(a,b,c);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#M&&(await this.#M,this.#O||(this.#O=this.#H.destroy().catch(a=>(this.#O=void 0,Promise.reject(a)))),await this.#O)}#Q(){return this.#L.isLevelEnabled("query")||this.#L.isLevelEnabled("error")}#R(a){let b=a.executeQuery,c=a.streamQuery,d=this;a.executeQuery=async c=>{let e,f=fv();try{return await b.call(a,c)}catch(a){throw e=a,await d.#S(a,c,f),a}finally{e||await d.#T(c,f)}},a.streamQuery=async function*(b,e){let f,g=fv();try{for await(let d of c.call(a,b,e))yield d}catch(a){throw f=a,await d.#S(a,b,g),a}finally{f||await d.#T(b,g,!0)}}}async #S(a,b,c){await this.#L.error(()=>({level:"error",error:a,query:b,queryDurationMillis:this.#U(c)}))}async #T(a,b,c=!1){await this.#L.query(()=>({level:"query",isStream:c,query:a,queryDurationMillis:this.#U(b)}))}#U(a){return fv()-a}}let fx=()=>{};class fy{#V;#W;constructor(a){this.#V=a}async provideConnection(a){for(;this.#W;)await this.#W.catch(fx);return this.#W=this.#X(a).finally(()=>{this.#W=void 0}),this.#W}async #X(a){return await a(this.#V)}}let fz=["read only","read write"],fA=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function fB(a){if(a.accessMode&&!fz.includes(a.accessMode))throw Error(`invalid transaction access mode ${a.accessMode}`);if(a.isolationLevel&&!fA.includes(a.isolationLevel))throw Error(`invalid transaction isolation level ${a.isolationLevel}`)}bG(["query","error"]);class fC{#Y;#Z;constructor(a){bE(a)?(this.#Z=a,this.#Y=bG({query:!0,error:!0})):(this.#Z=fD,this.#Y=bG({query:a.includes("query"),error:a.includes("error")}))}isLevelEnabled(a){return this.#Y[a]}async query(a){this.#Y.query&&await this.#Z(a())}async error(a){this.#Y.error&&await this.#Z(a())}}function fD(a){if("query"===a.level){let b=`kysely:query:${a.isStream?"stream:":""}`;console.log(`${b} ${a.query.sql}`),console.log(`${b} duration: ${a.queryDurationMillis.toFixed(1)}ms`)}else"error"===a.level&&(a.error instanceof Error?console.error(`kysely:error: ${a.error.stack??a.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:a.error,query:a.query.sql,queryDurationMillis:a.queryDurationMillis})}`))}Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class fE extends dY{#b;constructor(a){let b,c;if(function(a){return bF(a)&&bF(a.config)&&bF(a.driver)&&bF(a.executor)&&bF(a.dialect)}(a))b={executor:a.executor},c={...a};else{const d=a.dialect,e=d.createDriver(),f=d.createQueryCompiler(),g=d.createAdapter(),h=new fw(e,new fC(a.log??[])),i=new fu(f,g,new ft(h),a.plugins??[]);b={executor:i},c={config:a,executor:i,dialect:d,driver:h}}super(b),this.#b=bG(c)}get schema(){return new fr(this.#b.executor)}get dynamic(){return new fs}get introspection(){return this.#b.dialect.createIntrospector(this.withoutPlugins())}case(a){return new ef({node:ee.create(bz(a)?void 0:eu(a))})}get fn(){return ec()}transaction(){return new fH({...this.#b})}startTransaction(){return new fI({...this.#b})}connection(){return new fG({...this.#b})}withPlugin(a){return new fE({...this.#b,executor:this.#b.executor.withPlugin(a)})}withoutPlugins(){return new fE({...this.#b,executor:this.#b.executor.withoutPlugins()})}withSchema(a){return new fE({...this.#b,executor:this.#b.executor.withPluginAtFront(new dJ(a))})}withTables(){return new fE({...this.#b})}async destroy(){await this.#b.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#b.executor}executeQuery(a,b=dD()){let c=bF(a)&&bE(a.compile)?a.compile():a;return this.getExecutor().executeQuery(c,b)}async [Symbol.asyncDispose](){await this.destroy()}}class fF extends fE{#b;constructor(a){super(a),this.#b=a}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(a){return new fF({...this.#b,executor:this.#b.executor.withPlugin(a)})}withoutPlugins(){return new fF({...this.#b,executor:this.#b.executor.withoutPlugins()})}withSchema(a){return new fF({...this.#b,executor:this.#b.executor.withPluginAtFront(new dJ(a))})}withTables(){return new fF({...this.#b})}}class fG{#b;constructor(a){this.#b=bG(a)}async execute(a){return this.#b.executor.provideConnection(async b=>{let c=this.#b.executor.withConnectionProvider(new fy(b)),d=new fE({...this.#b,executor:c});return await a(d)})}}class fH{#b;constructor(a){this.#b=bG(a)}setAccessMode(a){return new fH({...this.#b,accessMode:a})}setIsolationLevel(a){return new fH({...this.#b,isolationLevel:a})}async execute(a){let{isolationLevel:b,accessMode:c,...d}=this.#b,e={isolationLevel:b,accessMode:c};return fB(e),this.#b.executor.provideConnection(async b=>{let c=this.#b.executor.withConnectionProvider(new fy(b)),f=new fF({...d,executor:c});try{await this.#b.driver.beginTransaction(b,e);let c=await a(f);return await this.#b.driver.commitTransaction(b),c}catch(a){throw await this.#b.driver.rollbackTransaction(b),a}})}}class fI{#b;constructor(a){this.#b=bG(a)}setAccessMode(a){return new fI({...this.#b,accessMode:a})}setIsolationLevel(a){return new fI({...this.#b,isolationLevel:a})}async execute(){let{isolationLevel:a,accessMode:b,...c}=this.#b,d={isolationLevel:a,accessMode:b};fB(d);let e=await dO(this.#b.executor);return await this.#b.driver.beginTransaction(e.connection,d),new fJ({...c,connection:e,executor:this.#b.executor.withConnectionProvider(new fy(e.connection))})}}class fJ extends fF{#b;#$;#_;constructor(a){const b={isCommitted:!1,isRolledBack:!1},{connection:c,...d}=a={...a,executor:new fM(a.executor,b)};super(d),this.#b=bG(a),this.#_=b;const e=dD();this.#$=b=>a.executor.compileQuery(b,e)}get isCommitted(){return this.#_.isCommitted}get isRolledBack(){return this.#_.isRolledBack}commit(){return fL(this.#_),new fK(async()=>{await this.#b.driver.commitTransaction(this.#b.connection.connection),this.#_.isCommitted=!0,this.#b.connection.release()})}rollback(){return fL(this.#_),new fK(async()=>{await this.#b.driver.rollbackTransaction(this.#b.connection.connection),this.#_.isRolledBack=!0,this.#b.connection.release()})}savepoint(a){return fL(this.#_),new fK(async()=>(await this.#b.driver.savepoint?.(this.#b.connection.connection,a,this.#$),new fJ({...this.#b})))}rollbackToSavepoint(a){return fL(this.#_),new fK(async()=>(await this.#b.driver.rollbackToSavepoint?.(this.#b.connection.connection,a,this.#$),new fJ({...this.#b})))}releaseSavepoint(a){return fL(this.#_),new fK(async()=>(await this.#b.driver.releaseSavepoint?.(this.#b.connection.connection,a,this.#$),new fJ({...this.#b})))}withPlugin(a){return new fJ({...this.#b,executor:this.#b.executor.withPlugin(a)})}withoutPlugins(){return new fJ({...this.#b,executor:this.#b.executor.withoutPlugins()})}withSchema(a){return new fJ({...this.#b,executor:this.#b.executor.withPluginAtFront(new dJ(a))})}withTables(){return new fJ({...this.#b})}}class fK{#aa;constructor(a){this.#aa=a}async execute(){return await this.#aa()}}function fL(a){if(a.isCommitted)throw Error("Transaction is already committed");if(a.isRolledBack)throw Error("Transaction is already rolled back")}class fM{#G;#_;constructor(a,b){a instanceof fM?this.#G=a.#G:this.#G=a,this.#_=b}get adapter(){return this.#G.adapter}get plugins(){return this.#G.plugins}transformQuery(a,b){return this.#G.transformQuery(a,b)}compileQuery(a,b){return this.#G.compileQuery(a,b)}provideConnection(a){return this.#G.provideConnection(a)}executeQuery(a,b){return fL(this.#_),this.#G.executeQuery(a,b)}stream(a,b,c){return fL(this.#_),this.#G.stream(a,b,c)}withConnectionProvider(a){return new fM(this.#G.withConnectionProvider(a),this.#_)}withPlugin(a){return new fM(this.#G.withPlugin(a),this.#_)}withPlugins(a){return new fM(this.#G.withPlugins(a),this.#_)}withPluginAtFront(a){return new fM(this.#G.withPluginAtFront(a),this.#_)}withoutPlugins(){return new fM(this.#G.withoutPlugins(),this.#_)}}function fN(a,b){return cd.createWithChildren([cd.createWithSql(`${a} `),bM.create(b)])}let fO=bG({raw:(a,b=[])=>bG({sql:a,query:cd.createWithSql(a),parameters:bG(b),queryId:dD()})}),fP=Symbol();class fQ{#ab;#P=new WeakMap;#ac;constructor(a){this.#ab=bG({...a})}async init(){this.#ac=bE(this.#ab.pool)?await this.#ab.pool():this.#ab.pool}async acquireConnection(){let a=await this.#ac.connect(),b=this.#P.get(a);return!b&&(b=new fR(a,{cursor:this.#ab.cursor??null}),this.#P.set(a,b),this.#ab.onCreateConnection&&await this.#ab.onCreateConnection(b)),this.#ab.onReserveConnection&&await this.#ab.onReserveConnection(b),b}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c="start transaction";b.isolationLevel&&(c+=` isolation level ${b.isolationLevel}`),b.accessMode&&(c+=` ${b.accessMode}`),await a.executeQuery(fO.raw(c))}else await a.executeQuery(fO.raw("begin"))}async commitTransaction(a){await a.executeQuery(fO.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(fO.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(fN("savepoint",b),dD()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(fN("rollback to",b),dD()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(fN("release",b),dD()))}async releaseConnection(a){a[fP]()}async destroy(){if(this.#ac){let a=this.#ac;this.#ac=void 0,await a.end()}}}class fR{#ad;#ae;constructor(a,b){this.#ad=a,this.#ae=b}async executeQuery(a){try{let{command:b,rowCount:c,rows:d}=await this.#ad.query(a.sql,[...a.parameters]);return{numAffectedRows:"INSERT"===b||"UPDATE"===b||"DELETE"===b||"MERGE"===b?BigInt(c):void 0,rows:d??[]}}catch(a){throw function(a,b){var c;if(bF(c=a)&&bA(c.stack)&&b.stack){let c=b.stack.split("\n").slice(1).join("\n");a.stack+=`
${c}`}return a}(a,Error())}}async *streamQuery(a,b){if(!this.#ae.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=this.#ad.query(new this.#ae.cursor(a.sql,a.parameters.slice()));try{for(;;){let a=await c.read(b);if(0===a.length)break;yield{rows:a}}}finally{await c.close()}}[fP](){this.#ad.release()}}bG({__noMigrations__:!0});class fS{#b;constructor(a){this.#b=bG(a)}get expressionType(){}get isRawBuilder(){return!0}as(a){return new fU(this,a)}$castTo(){return new fS({...this.#b})}$notNull(){return new fS(this.#b)}withPlugin(a){return new fS({...this.#b,plugins:void 0!==this.#b.plugins?bG([...this.#b.plugins,a]):bG([a])})}toOperationNode(){return this.#af(this.#ag())}compile(a){return this.#ah(this.#ag(a))}async execute(a){let b=this.#ag(a);return b.executeQuery(this.#ah(b),this.#b.queryId)}#ag(a){let b=void 0!==a?a.getExecutor():dS;return void 0!==this.#b.plugins?b.withPlugins(this.#b.plugins):b}#af(a){return a.transformQuery(this.#b.rawNode,this.#b.queryId)}#ah(a){return a.compileQuery(this.#af(a),this.#b.queryId)}}function fT(a){return new fS(a)}class fU{#ai;#z;constructor(a,b){this.#ai=a,this.#z=b}get expression(){return this.#ai}get alias(){return this.#z}get rawBuilder(){return this.#ai}toOperationNode(){return bV.create(this.#ai.toOperationNode(),bX(this.#z)?this.#z.toOperationNode():bM.create(this.#z))}}let fV=Object.assign((a,...b)=>fT({queryId:dD(),rawNode:cd.create(a,b?.map(fW)??[])}),{ref:a=>fT({queryId:dD(),rawNode:cd.createWithChild(cr(a))}),val:a=>fT({queryId:dD(),rawNode:cd.createWithChild(cy(a))}),value(a){return this.val(a)},table:a=>fT({queryId:dD(),rawNode:cd.createWithChild(eA(a))}),id(...a){let b=Array(a.length+1).fill(".");return b[0]="",b[b.length-1]="",fT({queryId:dD(),rawNode:cd.create(b,a.map(bM.create))})},lit:a=>fT({queryId:dD(),rawNode:cd.createWithChild(cx.createImmediate(a))}),literal(a){return this.lit(a)},raw:a=>fT({queryId:dD(),rawNode:cd.createWithSql(a)}),join(a,b=fV`, `){let c=Array(Math.max(2*a.length-1,0)),d=b.toOperationNode();for(let b=0;b<a.length;++b)c[2*b]=fW(a[b]),b!==a.length-1&&(c[2*b+1]=d);return fT({queryId:dD(),rawNode:cd.createWithChildren(c)})}});function fW(a){return bX(a)?a.toOperationNode():cy(a)}a.s(["sql",0,fV],640796);class fX{#aj;constructor(a){this.#aj=a}async getSchemas(){return(await this.#aj.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(a=>({name:a.nspname}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#aj.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",fV`col_description(a.attrelid, a.attnum)`.as("column_description"),fV`pg_get_serial_sequence(ns.nspname || '.' || c.relname, a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();a.withInternalKyselyTables||(b=b.where("c.relname","!=","kysely_migration").where("c.relname","!=","kysely_migration_lock"));let c=await b.execute();return this.#ak(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#ak(a){return a.reduce((a,b)=>{let c=a.find(a=>a.name===b.table&&a.schema===b.schema);return c||(c=bG({name:b.table,isView:"v"===b.table_type,schema:b.schema,columns:[]}),a.push(c)),c.columns.push(bG({name:b.column,dataType:b.type,dataTypeSchema:b.type_schema,isNullable:!b.not_null,isAutoIncrementing:null!==b.auto_incrementing,hasDefaultValue:b.has_default,comment:b.column_description??void 0})),a},[])}}class fY{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#al=bG({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)});visitNode=a=>{this.nodeStack.push(a),this.#al[a.kind](a),this.nodeStack.pop()}}let fZ=/'/g;class f$ extends fY{#am="";#an=[];get numParameters(){return this.#an.length}compileQuery(a,b){return this.#am="",this.#an=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(a),bG({query:a,queryId:b,sql:this.getSql(),parameters:[...this.#an]})}getSql(){return this.#am}visitSelectQuery(a){let b=void 0!==this.parentNode&&!cB.is(this.parentNode)&&!cQ.is(this.parentNode)&&!bQ.is(this.parentNode)&&!fe.is(this.parentNode)&&!d0.is(this.parentNode);void 0===this.parentNode&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("select"),a.distinctOn&&(this.append(" "),this.compileDistinctOn(a.distinctOn)),a.frontModifiers?.length&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.top&&(this.append(" "),this.visitNode(a.top)),a.selections&&(this.append(" "),this.compileList(a.selections)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.groupBy&&(this.append(" "),this.visitNode(a.groupBy)),a.having&&(this.append(" "),this.visitNode(a.having)),a.setOperations&&(this.append(" "),this.compileList(a.setOperations," ")),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.offset&&(this.append(" "),this.visitNode(a.offset)),a.fetch&&(this.append(" "),this.visitNode(a.fetch)),a.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...a.endModifiers])," ")),b&&this.append(")")}visitFrom(a){this.append("from "),this.compileList(a.froms)}visitSelection(a){this.visitNode(a.selection)}visitColumn(a){this.visitNode(a.column)}compileDistinctOn(a){this.append("distinct on ("),this.compileList(a),this.append(")")}compileList(a,b=", "){let c=a.length-1;for(let d=0;d<=c;d++)this.visitNode(a[d]),d<c&&this.append(b)}visitWhere(a){this.append("where "),this.visitNode(a.where)}visitHaving(a){this.append("having "),this.visitNode(a.having)}visitInsertQuery(a){let b=this.nodeStack.find(c_.is),c=b!==a;!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!cZ.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append(a.replace?"replace":"insert"),a.ignore&&(cg("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),a.orAction&&(this.append(" "),this.visitNode(a.orAction)),a.top&&(this.append(" "),this.visitNode(a.top)),a.into&&(this.append(" into "),this.visitNode(a.into)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.output&&(this.append(" "),this.visitNode(a.output)),a.values&&(this.append(" "),this.visitNode(a.values)),a.defaultValues&&(this.append(" "),this.append("default values")),a.onConflict&&(this.append(" "),this.visitNode(a.onConflict)),a.onDuplicateKey&&(this.append(" "),this.visitNode(a.onDuplicateKey)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!cZ.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitValues(a){this.append("values "),this.compileList(a.values)}visitDeleteQuery(a){let b=this.nodeStack.find(c_.is)!==a;!b&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("delete "),a.top&&(this.visitNode(a.top),this.append(" ")),this.visitNode(a.from),a.output&&(this.append(" "),this.visitNode(a.output)),a.using&&(this.append(" "),this.visitNode(a.using)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),b&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitReturning(a){this.append("returning "),this.compileList(a.selections)}visitAlias(a){this.visitNode(a.node),this.append(" as "),this.visitNode(a.alias)}visitReference(a){a.table&&(this.visitNode(a.table),this.append(".")),this.visitNode(a.column)}visitSelectAll(a){this.append("*")}visitIdentifier(a){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(a),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(a){if(!bA(a.name))throw Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(a.name))}visitAnd(a){this.visitNode(a.left),this.append(" and "),this.visitNode(a.right)}visitOr(a){this.visitNode(a.left),this.append(" or "),this.visitNode(a.right)}visitValue(a){a.immediate?this.appendImmediateValue(a.value):this.appendValue(a.value)}visitValueList(a){this.append("("),this.compileList(a.values),this.append(")")}visitTuple(a){this.append("("),this.compileList(a.values),this.append(")")}visitPrimitiveValueList(a){this.append("(");let{values:b}=a;for(let a=0;a<b.length;++a)this.appendValue(b[a]),a!==b.length-1&&this.append(", ");this.append(")")}visitParens(a){this.append("("),this.visitNode(a.node),this.append(")")}visitJoin(a){this.append(f1[a.joinType]),this.append(" "),this.visitNode(a.table),a.on&&(this.append(" "),this.visitNode(a.on))}visitOn(a){this.append("on "),this.visitNode(a.on)}visitRaw(a){let{sqlFragments:b,parameters:c}=a;for(let a=0;a<b.length;++a)this.append(b[a]),c.length>a&&this.visitNode(c[a])}visitOperator(a){this.append(a.operator)}visitTable(a){this.visitNode(a.table)}visitSchemableIdentifier(a){a.schema&&(this.visitNode(a.schema),this.append(".")),this.visitNode(a.identifier)}visitCreateTable(a){this.append("create "),a.frontModifiers&&a.frontModifiers.length>0&&(this.compileList(a.frontModifiers," "),this.append(" ")),a.temporary&&this.append("temporary "),this.append("table "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.table),a.selectQuery?(this.append(" as "),this.visitNode(a.selectQuery)):(this.append(" ("),this.compileList([...a.columns,...a.constraints??[]]),this.append(")"),a.onCommit&&(this.append(" on commit "),this.append(a.onCommit)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," ")))}visitColumnDefinition(a){a.ifNotExists&&this.append("if not exists "),this.visitNode(a.column),this.append(" "),this.visitNode(a.dataType),a.unsigned&&this.append(" unsigned"),a.frontModifiers&&a.frontModifiers.length>0&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.generated&&(this.append(" "),this.visitNode(a.generated)),a.identity&&this.append(" identity"),a.defaultTo&&(this.append(" "),this.visitNode(a.defaultTo)),a.notNull&&this.append(" not null"),a.unique&&this.append(" unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.primaryKey&&this.append(" primary key"),a.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),a.references&&(this.append(" "),this.visitNode(a.references)),a.check&&(this.append(" "),this.visitNode(a.check)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(a){this.append("references "),this.visitNode(a.table),this.append(" ("),this.compileList(a.columns),this.append(")"),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate))}visitDropTable(a){this.append("drop table "),a.ifExists&&this.append("if exists "),this.visitNode(a.table),a.cascade&&this.append(" cascade")}visitDataType(a){this.append(a.dataType)}visitOrderBy(a){this.append("order by "),this.compileList(a.items)}visitOrderByItem(a){this.visitNode(a.orderBy),a.collation&&(this.append(" "),this.visitNode(a.collation)),a.direction&&(this.append(" "),this.visitNode(a.direction)),a.nulls&&(this.append(" nulls "),this.append(a.nulls))}visitGroupBy(a){this.append("group by "),this.compileList(a.items)}visitGroupByItem(a){this.visitNode(a.groupBy)}visitUpdateQuery(a){let b=this.nodeStack.find(c_.is),c=b!==a;if(!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!cZ.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("update "),a.top&&(this.visitNode(a.top),this.append(" ")),a.table&&(this.visitNode(a.table),this.append(" ")),this.append("set "),a.updates&&this.compileList(a.updates),a.output&&(this.append(" "),this.visitNode(a.output)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins){if(!a.from)throw Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(a.joins," ")}a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!cZ.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitColumnUpdate(a){this.visitNode(a.column),this.append(" = "),this.visitNode(a.value)}visitLimit(a){this.append("limit "),this.visitNode(a.limit)}visitOffset(a){this.append("offset "),this.visitNode(a.offset)}visitOnConflict(a){this.append("on conflict"),a.columns?(this.append(" ("),this.compileList(a.columns),this.append(")")):a.constraint?(this.append(" on constraint "),this.visitNode(a.constraint)):a.indexExpression&&(this.append(" ("),this.visitNode(a.indexExpression),this.append(")")),a.indexWhere&&(this.append(" "),this.visitNode(a.indexWhere)),!0===a.doNothing?this.append(" do nothing"):a.updates&&(this.append(" do update set "),this.compileList(a.updates),a.updateWhere&&(this.append(" "),this.visitNode(a.updateWhere)))}visitOnDuplicateKey(a){this.append("on duplicate key update "),this.compileList(a.updates)}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.using&&(this.append(" using "),this.visitNode(a.using)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.where&&(this.append(" "),this.visitNode(a.where))}visitDropIndex(a){this.append("drop index "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.cascade&&this.append(" cascade")}visitCreateSchema(a){this.append("create schema "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.schema)}visitDropSchema(a){this.append("drop schema "),a.ifExists&&this.append("if exists "),this.visitNode(a.schema),a.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("primary key ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}buildDeferrable(a){void 0!==a.deferrable&&(a.deferrable?this.append(" deferrable"):this.append(" not deferrable")),void 0!==a.initiallyDeferred&&(a.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}visitCheckConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("check ("),this.visitNode(a.expression),this.append(")")}visitForeignKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("foreign key ("),this.compileList(a.columns),this.append(") "),this.visitNode(a.references),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate)),this.buildDeferrable(a)}visitList(a){this.compileList(a.items)}visitWith(a){this.append("with "),a.recursive&&this.append("recursive "),this.compileList(a.expressions)}visitCommonTableExpression(a){this.visitNode(a.name),this.append(" as "),bC(a.materialized)&&(a.materialized||this.append("not "),this.append("materialized ")),this.visitNode(a.expression)}visitCommonTableExpressionName(a){this.visitNode(a.table),a.columns&&(this.append("("),this.compileList(a.columns),this.append(")"))}visitAlterTable(a){this.append("alter table "),this.visitNode(a.table),this.append(" "),a.renameTo&&(this.append("rename to "),this.visitNode(a.renameTo)),a.setSchema&&(this.append("set schema "),this.visitNode(a.setSchema)),a.addConstraint&&this.visitNode(a.addConstraint),a.dropConstraint&&this.visitNode(a.dropConstraint),a.renameConstraint&&this.visitNode(a.renameConstraint),a.columnAlterations&&this.compileColumnAlterations(a.columnAlterations),a.addIndex&&this.visitNode(a.addIndex),a.dropIndex&&this.visitNode(a.dropIndex)}visitAddColumn(a){this.append("add column "),this.visitNode(a.column)}visitRenameColumn(a){this.append("rename column "),this.visitNode(a.column),this.append(" to "),this.visitNode(a.renameTo)}visitDropColumn(a){this.append("drop column "),this.visitNode(a.column)}visitAlterColumn(a){this.append("alter column "),this.visitNode(a.column),this.append(" "),a.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(a.dataType),a.dataTypeExpression&&(this.append("using "),this.visitNode(a.dataTypeExpression))),a.setDefault&&(this.append("set default "),this.visitNode(a.setDefault)),a.dropDefault&&this.append("drop default"),a.setNotNull&&this.append("set not null"),a.dropNotNull&&this.append("drop not null")}visitModifyColumn(a){this.append("modify column "),this.visitNode(a.column)}visitAddConstraint(a){this.append("add "),this.visitNode(a.constraint)}visitDropConstraint(a){this.append("drop constraint "),a.ifExists&&this.append("if exists "),this.visitNode(a.constraintName),"cascade"===a.modifier?this.append(" cascade"):"restrict"===a.modifier&&this.append(" restrict")}visitRenameConstraint(a){this.append("rename constraint "),this.visitNode(a.oldName),this.append(" to "),this.visitNode(a.newName)}visitSetOperation(a){this.append(a.operator),this.append(" "),a.all&&this.append("all "),this.visitNode(a.expression)}visitCreateView(a){this.append("create "),a.orReplace&&this.append("or replace "),a.materialized&&this.append("materialized "),a.temporary&&this.append("temporary "),this.append("view "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),this.append(" "),a.columns&&(this.append("("),this.compileList(a.columns),this.append(") ")),a.as&&(this.append("as "),this.visitNode(a.as))}visitRefreshMaterializedView(a){this.append("refresh materialized view "),a.concurrently&&this.append("concurrently "),this.visitNode(a.name),a.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(a){this.append("drop "),a.materialized&&this.append("materialized "),this.append("view "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.cascade&&this.append(" cascade")}visitGenerated(a){this.append("generated "),a.always&&this.append("always "),a.byDefault&&this.append("by default "),this.append("as "),a.identity&&this.append("identity"),a.expression&&(this.append("("),this.visitNode(a.expression),this.append(")")),a.stored&&this.append(" stored")}visitDefaultValue(a){this.append("default "),this.visitNode(a.defaultValue)}visitSelectModifier(a){a.rawModifier?this.visitNode(a.rawModifier):this.append(f_[a.modifier]),a.of&&(this.append(" of "),this.compileList(a.of,", "))}visitCreateType(a){this.append("create type "),this.visitNode(a.name),a.enum&&(this.append(" as enum "),this.visitNode(a.enum))}visitDropType(a){this.append("drop type "),a.ifExists&&this.append("if exists "),this.visitNode(a.name)}visitExplain(a){this.append("explain"),(a.options||a.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),a.options&&(this.visitNode(a.options),a.format&&this.append(this.getExplainOptionsDelimiter())),a.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(a.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(a){this.append("default")}visitAggregateFunction(a){this.append(a.func),this.append("("),a.distinct&&this.append("distinct "),this.compileList(a.aggregated),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),this.append(")"),a.withinGroup&&(this.append(" within group ("),this.visitNode(a.withinGroup),this.append(")")),a.filter&&(this.append(" filter("),this.visitNode(a.filter),this.append(")")),a.over&&(this.append(" "),this.visitNode(a.over))}visitOver(a){this.append("over("),a.partitionBy&&(this.visitNode(a.partitionBy),a.orderBy&&this.append(" ")),a.orderBy&&this.visitNode(a.orderBy),this.append(")")}visitPartitionBy(a){this.append("partition by "),this.compileList(a.items)}visitPartitionByItem(a){this.visitNode(a.partitionBy)}visitBinaryOperation(a){this.visitNode(a.leftOperand),this.append(" "),this.visitNode(a.operator),this.append(" "),this.visitNode(a.rightOperand)}visitUnaryOperation(a){this.visitNode(a.operator),this.isMinusOperator(a.operator)||this.append(" "),this.visitNode(a.operand)}isMinusOperator(a){return b5.is(a)&&"-"===a.operator}visitUsing(a){this.append("using "),this.compileList(a.tables)}visitFunction(a){this.append(a.func),this.append("("),this.compileList(a.arguments),this.append(")")}visitCase(a){this.append("case"),a.value&&(this.append(" "),this.visitNode(a.value)),a.when&&(this.append(" "),this.compileList(a.when," ")),a.else&&(this.append(" else "),this.visitNode(a.else)),this.append(" end"),a.isStatement&&this.append(" case")}visitWhen(a){this.append("when "),this.visitNode(a.condition),a.result&&(this.append(" then "),this.visitNode(a.result))}visitJSONReference(a){this.visitNode(a.reference),this.visitNode(a.traversal)}visitJSONPath(a){for(let b of(a.inOperator&&this.visitNode(a.inOperator),this.append("'$"),a.pathLegs))this.visitNode(b);this.append("'")}visitJSONPathLeg(a){let b="ArrayLocation"===a.type;this.append(b?"[":"."),this.append(String(a.value)),b&&this.append("]")}visitJSONOperatorChain(a){for(let b=0,c=a.values.length;b<c;b++)b===c-1?this.visitNode(a.operator):this.append("->"),this.visitNode(a.values[b])}visitMergeQuery(a){a.with&&(this.visitNode(a.with),this.append(" ")),this.append("merge "),a.top&&(this.visitNode(a.top),this.append(" ")),this.append("into "),this.visitNode(a.into),a.using&&(this.append(" "),this.visitNode(a.using)),a.whens&&(this.append(" "),this.compileList(a.whens," ")),a.returning&&(this.append(" "),this.visitNode(a.returning)),a.output&&(this.append(" "),this.visitNode(a.output)),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitMatched(a){a.not&&this.append("not "),this.append("matched"),a.bySource&&this.append(" by source")}visitAddIndex(a){this.append("add "),a.unique&&this.append("unique "),this.append("index "),this.visitNode(a.name),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.using&&(this.append(" using "),this.visitNode(a.using))}visitCast(a){this.append("cast("),this.visitNode(a.expression),this.append(" as "),this.visitNode(a.dataType),this.append(")")}visitFetch(a){this.append("fetch next "),this.visitNode(a.rowCount),this.append(` rows ${a.modifier}`)}visitOutput(a){this.append("output "),this.compileList(a.selections)}visitTop(a){this.append(`top(${a.expression})`),a.modifiers&&this.append(` ${a.modifiers}`)}visitOrAction(a){this.append(a.action)}visitCollate(a){this.append("collate "),this.visitNode(a.collation)}append(a){this.#am+=a}appendValue(a){this.addParameter(a),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(a){let b=this.getLeftIdentifierWrapper(),c=this.getRightIdentifierWrapper(),d="";for(let e of a)d+=e,e===b?d+=b:e===c&&(d+=c);return d}sanitizeStringLiteral(a){return a.replace(fZ,"''")}addParameter(a){this.#an.push(a)}appendImmediateValue(a){if(bA(a))this.appendStringLiteral(a);else if(bB(a)||bC(a))this.append(a.toString());else if(null===a)this.append("null");else if(a instanceof Date)this.appendImmediateValue(a.toISOString());else if(bD(a))this.appendImmediateValue(a.toString());else throw Error(`invalid immediate value ${a}`)}appendStringLiteral(a){this.append("'"),this.append(this.sanitizeStringLiteral(a)),this.append("'")}sortSelectModifiers(a){return a.sort((a,b)=>a.modifier&&b.modifier?f0[a.modifier]-f0[b.modifier]:1),bG(a)}compileColumnAlterations(a){this.compileList(a)}announcesNewColumnDataType(){return!0}}let f_=bG({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),f0=bG({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),f1=bG({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"}),f2=/"/g;class f3 extends f${sanitizeIdentifier(a){return a.replace(f2,'""')}}class f4{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}let f5=BigInt("3853314791062309107");class f6 extends f4{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(a,b){await fV`select pg_advisory_xact_lock(${fV.lit(f5)})`.execute(a)}async releaseMigrationLock(a,b){}}class f7{#ab;constructor(a){this.#ab=a}createDriver(){return new fQ(this.#ab)}createQueryCompiler(){return new f3}createAdapter(){return new f6}createIntrospector(a){return new fX(a)}}class f8 extends dF{#ao;constructor(a){super(),this.#ao=a}transformIdentifier(a,b){return{...a=super.transformIdentifier(a,b),name:this.#ao(a.name)}}}function f9(a){return a>="0"&&a<="9"}function ga(a){let b=new Map;return c=>{let d=b.get(c);return d||(d=a(c),b.set(c,d)),d}}class gb{opt;#ap;#ao;#aq;constructor(a={}){this.opt=a,this.#ap=function({upperCase:a=!1}={}){return ga(b=>{if(0===b.length)return b;a&&function(a){for(let b=1,c=a.length;b<c;++b){let c=a[b];if("_"!==c&&c!==c.toUpperCase())return!1}return!0}(b)&&(b=b.toLowerCase());let c=b[0];for(let a=1,d=b.length;a<d;++a){let d=b[a],e=b[a-1];"_"!==d&&("_"===e?c+=d.toUpperCase():c+=d)}return c})}(a),this.#ao=function({upperCase:a=!1,underscoreBeforeDigits:b=!1,underscoreBetweenUppercaseLetters:c=!1}={}){return ga(d=>{if(0===d.length)return d;let e=d.toUpperCase(),f=d.toLowerCase(),g=f[0];for(let a=1,h=d.length;a<h;++a){let h=d[a],i=d[a-1],j=e[a],k=e[a-1],l=f[a],m=f[a-1];if(b&&f9(h)&&!f9(i)&&!g.endsWith("_")){g+="_"+h;continue}if(h===j&&j!==l){let a=i===k&&k!==m;c||!a?g+="_"+l:g+=l}else g+=h}return a?g.toUpperCase():g})}(a),this.#aq=new f8(this.snakeCase.bind(this))}transformQuery(a){return this.#aq.transformNode(a.node,a.queryId)}async transformResult(a){return a.result.rows&&Array.isArray(a.result.rows)?{...a.result,rows:a.result.rows.map(a=>this.mapRow(a))}:a.result}mapRow(a){return Object.keys(a).reduce((b,c)=>{let d=a[c];return Array.isArray(d)?d=d.map(a=>gc(a,this.opt)?this.mapRow(a):a):gc(d,this.opt)&&(d=this.mapRow(d)),b[this.camelCase(c)]=d,b},{})}snakeCase(a){return this.#ao(a)}camelCase(a){return this.#ap(a)}}function gc(a,b){return function(a){var b;if(!bF(a)||"[object Object]"!==(null==(b=a)?void 0===b?"[object Undefined]":"[object Null]":bK.call(b)))return!1;if(null===Object.getPrototypeOf(a))return!0;let c=a;for(;null!==Object.getPrototypeOf(c);)c=Object.getPrototypeOf(c);return Object.getPrototypeOf(a)===c}(a)&&!b?.maintainNestedObjectKeys}var gd=a.i(967255);let ge=new Map,gf=new Map,{databaseUrl:gg}=bu(),gh=function(a){if(gf.has(a))return gf.get(a);let b=ge.get(a);b||(b=new gd.Pool({connectionString:a,max:10}),ge.set(a,b));let c=new fE({dialect:new f7({pool:b}),plugins:[new gb]});return gf.set(a,c),c}(gg);(c=ge.get(gg))||(c=new gd.Pool({connectionString:gg,max:10}),ge.set(gg,c)),a.s(["postgresDb",0,gh],964081);class gi{db;constructor(a=gh){this.db=a}}a.s(["BaseRepository",()=>gi],449083)}];

//# sourceMappingURL=packages_shared_src_server_repositories_baseRepository_ts_dc06c444._.js.map