module.exports=[619588,e=>{"use strict";var t=e.i(777492);function r(e,r){if(e.cookies.get("gt_admin")?.value==="ok")return{isAuthorized:!0,isAdmin:!0,userId:null};let s=e.cookies.get("gt_user_session")?.value;if(!s)return{isAuthorized:!1,isAdmin:!1,userId:null,error:"No authentication credentials provided"};let a=(0,t.decryptUserId)(s);return a?a!==r?{isAuthorized:!1,isAdmin:!1,userId:a,error:"Unauthorized to access this user data"}:{isAuthorized:!0,isAdmin:!1,userId:a}:{isAuthorized:!1,isAdmin:!1,userId:null,error:"Invalid session token"}}e.s(["checkAuthorization",()=>r])},777492,e=>{"use strict";var t=e.i(254799);e.i(791146);var r=e.i(832821);let s="aes-256-gcm";function a(){let{sessionEncryptionKey:e}=(0,r.getDatabaseSecrets)();return e?64===e.length?Buffer.from(e,"hex"):t.default.scryptSync(e,"salt",32):(console.warn("SESSION_ENCRYPTION_KEY not set, using development key"),t.default.scryptSync("gymtext-dev-key","salt",32))}function n(e){try{let r=a(),n=t.default.randomBytes(16),i=t.default.createCipheriv(s,r,n),o=i.update(e,"utf8","hex");o+=i.final("hex");let u=i.getAuthTag();return Buffer.concat([n,u,Buffer.from(o,"hex")]).toString("base64")}catch(e){throw console.error("Error encrypting user ID:",e),Error("Failed to encrypt session")}}function i(e){try{let r=a(),n=Buffer.from(e,"base64"),i=n.subarray(0,16),o=n.subarray(16,32),u=n.subarray(32),l=t.default.createDecipheriv(s,r,i);l.setAuthTag(o);let d=l.update(u.toString("hex"),"hex","utf8");return d+=l.final("utf8")}catch(e){return console.error("Error decrypting user ID:",e),null}}e.s(["decryptUserId",()=>i,"encryptUserId",()=>n])},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},967255,(e,t,r)=>{t.exports=e.x("pg",()=>require("pg"))},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},840936,e=>{"use strict";var t=e.i(46308),r=e.i(76421);class s extends t.BaseRepository{async insertFitnessPlan(e){let t=await this.db.insertInto("fitnessPlans").values({clientId:e.clientId,description:e.description,message:e.message,structured:e.structured?JSON.stringify(e.structured):null,startDate:e.startDate}).returningAll().executeTakeFirstOrThrow();return r.FitnessPlanModel.fromDB(t)}async getFitnessPlan(e){let t=await this.db.selectFrom("fitnessPlans").selectAll().where("id","=",e).executeTakeFirst();return t?r.FitnessPlanModel.fromDB(t):null}async getCurrentPlan(e){let t=await this.db.selectFrom("fitnessPlans").selectAll().where("clientId","=",e).orderBy("createdAt","desc").executeTakeFirst();return t?r.FitnessPlanModel.fromDB(t):null}async getPlanHistory(e){return(await this.db.selectFrom("fitnessPlans").selectAll().where("clientId","=",e).orderBy("createdAt","desc").execute()).map(r.FitnessPlanModel.fromDB)}async updateFitnessPlan(e,t){let s={updatedAt:new Date};void 0!==t.description&&(s.description=t.description),void 0!==t.message&&(s.message=t.message),void 0!==t.structured&&(s.structured=t.structured?JSON.stringify(t.structured):null);let a=await this.db.updateTable("fitnessPlans").set(s).where("id","=",e).returningAll().executeTakeFirst();return a?r.FitnessPlanModel.fromDB(a):null}async deleteFitnessPlan(e){return Number((await this.db.deleteFrom("fitnessPlans").where("id","=",e).executeTakeFirst()).numDeletedRows)>0}}e.s(["FitnessPlanRepository",()=>s])},13423,e=>{"use strict";var t=e.i(46308),r=e.i(705590);class s extends t.BaseRepository{async create(e,t){let r={clientId:e,signupData:t?JSON.parse(JSON.stringify(t)):null,status:"pending",programMessagesSent:!1};return await this.db.insertInto("userOnboarding").values(r).returningAll().executeTakeFirstOrThrow()}async findByClientId(e){return await this.db.selectFrom("userOnboarding").selectAll().where("clientId","=",e).executeTakeFirst()??null}async updateStatus(e,t,r){return await this.db.updateTable("userOnboarding").set({status:t,errorMessage:r??null}).where("clientId","=",e).returningAll().executeTakeFirstOrThrow()}async markStarted(e){return await this.db.updateTable("userOnboarding").set({status:"in_progress",startedAt:r.sql`CURRENT_TIMESTAMP`}).where("clientId","=",e).returningAll().executeTakeFirstOrThrow()}async updateCurrentStep(e,t){return await this.db.updateTable("userOnboarding").set({currentStep:t}).where("clientId","=",e).returningAll().executeTakeFirstOrThrow()}async markCompleted(e){return await this.db.updateTable("userOnboarding").set({status:"completed",completedAt:r.sql`CURRENT_TIMESTAMP`}).where("clientId","=",e).returningAll().executeTakeFirstOrThrow()}async markMessagesSent(e){return await this.db.updateTable("userOnboarding").set({programMessagesSent:!0}).where("clientId","=",e).returningAll().executeTakeFirstOrThrow()}async hasMessagesSent(e){let t=await this.db.selectFrom("userOnboarding").select("programMessagesSent").where("clientId","=",e).executeTakeFirst();return t?.programMessagesSent??!1}async getSignupData(e){let t=await this.db.selectFrom("userOnboarding").select("signupData").where("clientId","=",e).executeTakeFirst();return t?.signupData??null}async clearSignupData(e){return await this.db.updateTable("userOnboarding").set({signupData:null}).where("clientId","=",e).returningAll().executeTakeFirstOrThrow()}async delete(e){await this.db.deleteFrom("userOnboarding").where("clientId","=",e).execute()}}e.s(["OnboardingRepository",()=>s])},76421,271964,e=>{"use strict";e.i(454188);var t=e.i(331612);let r=t.z.array(t.z.object({day:t.z.string(),focus:t.z.string().default(""),rationale:t.z.string().default("")})).describe("The ideal/default weekly rhythm"),s=t.z.object({name:t.z.string().describe("e.g. 'Strength + Lean Build Phase'"),type:t.z.string().describe("e.g. 'Powerbuilding'").default(""),coreStrategy:t.z.string().default(""),progressionStrategy:t.z.array(t.z.string()).default([]),adjustmentStrategy:t.z.string().default(""),conditioning:t.z.array(t.z.string()).default([]),scheduleTemplate:r.default([]),durationWeeks:t.z.number().default(-1),frequencyPerWeek:t.z.number().default(-1)}),a=t.z.object({description:t.z.string({description:"Structured text fitness plan containing split, frequency, deload rules, goals, and progression principles"}),message:t.z.string({description:"Brief summary of the fitness plan for SMS messages"}).nullish()});e.s(["PlanStructureSchema",0,s,"_FitnessPlanSchema",0,a],271964);class n{id;clientId;description;message;structured;startDate;createdAt;updatedAt;constructor(e,t,r,s,a,n,i,o){this.id=e,this.clientId=t,this.description=r,this.message=s,this.structured=a,this.startDate=n,this.createdAt=i,this.updatedAt=o}static fromDB(e){return{id:e.id,clientId:e.clientId,description:e.description||"",message:e.message,structured:e.structured,startDate:new Date(e.startDate),createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}}static fromFitnessPlanOverview(e,t){return{clientId:e.id,description:t.description,message:t.message||null,structured:t.structure||null,startDate:new Date}}static schema=a}e.s(["FitnessPlanModel",()=>n],76421)},23250,e=>{"use strict";var t=e.i(13423);class r{static instance;repository;constructor(){this.repository=new t.OnboardingRepository}static getInstance(){return r.instance||(r.instance=new r),r.instance}async createOnboardingRecord(e,t){return console.log(`[OnboardingDataService] Creating onboarding record for user ${e}`),await this.repository.create(e,t)}async markStarted(e){return console.log(`[OnboardingDataService] Marking onboarding started for user ${e}`),await this.repository.markStarted(e)}async updateCurrentStep(e,t){return console.log(`[OnboardingDataService] Updating step to ${t} for user ${e}`),await this.repository.updateCurrentStep(e,t)}async markCompleted(e){return console.log(`[OnboardingDataService] Marking onboarding completed for user ${e}`),await this.repository.markCompleted(e)}async updateStatus(e,t,r){return console.log(`[OnboardingDataService] Updating status to '${t}' for user ${e}`),await this.repository.updateStatus(e,t,r)}async getStatus(e){let t=await this.repository.findByClientId(e);return t?t.status:null}async findByClientId(e){return await this.repository.findByClientId(e)}async getSignupData(e){return await this.repository.getSignupData(e)}async clearSignupData(e){return console.log(`[OnboardingDataService] Clearing signup data for user ${e}`),await this.repository.clearSignupData(e)}async markMessagesSent(e){return console.log(`[OnboardingDataService] Marking messages sent for user ${e}`),await this.repository.markMessagesSent(e)}async hasMessagesSent(e){return await this.repository.hasMessagesSent(e)}async delete(e){return console.log(`[OnboardingDataService] Deleting onboarding record for user ${e}`),await this.repository.delete(e)}}let s=r.getInstance();e.s(["onboardingDataService",0,s])},961691,e=>{"use strict";var t=e.i(46308);class r extends t.BaseRepository{async create(e){let t={clientId:e.clientId,stripeSubscriptionId:e.stripeSubscriptionId,status:e.status,planType:e.planType,currentPeriodStart:e.currentPeriodStart,currentPeriodEnd:e.currentPeriodEnd};return await this.db.insertInto("subscriptions").values(t).returningAll().executeTakeFirstOrThrow()}async updateByStripeId(e,t){return await this.db.updateTable("subscriptions").set(t).where("stripeSubscriptionId","=",e).returningAll().executeTakeFirstOrThrow()}async findByClientId(e){return await this.db.selectFrom("subscriptions").selectAll().where("clientId","=",e).orderBy("createdAt","desc").execute()}async findByStripeId(e){return await this.db.selectFrom("subscriptions").selectAll().where("stripeSubscriptionId","=",e).executeTakeFirst()??null}async getActiveSubscription(e){return await this.db.selectFrom("subscriptions").selectAll().where("clientId","=",e).where("status","=","active").orderBy("createdAt","desc").executeTakeFirst()??null}async hasActiveSubscription(e){return null!==await this.getActiveSubscription(e)}async cancel(e,t){return await this.db.updateTable("subscriptions").set({status:"canceled",canceledAt:t}).where("stripeSubscriptionId","=",e).returningAll().executeTakeFirstOrThrow()}async scheduleCancellation(e){return await this.db.updateTable("subscriptions").set({status:"cancel_pending"}).where("stripeSubscriptionId","=",e).returningAll().executeTakeFirstOrThrow()}async reactivate(e){return await this.db.updateTable("subscriptions").set({status:"active"}).where("stripeSubscriptionId","=",e).returningAll().executeTakeFirstOrThrow()}async findActiveForMessaging(e){return await this.db.selectFrom("subscriptions").selectAll().where("clientId","=",e).where("status","=","active").orderBy("createdAt","desc").executeTakeFirst()??null}}e.s(["SubscriptionRepository",()=>r])},47373,e=>{"use strict";var t=e.i(553573),r=e.i(163459),s=e.i(342845),a=e.i(904973),n=e.i(818385),i=e.i(588303),o=e.i(583020),u=e.i(304941),l=e.i(370312),d=e.i(40504),c=e.i(802579),p=e.i(225915),g=e.i(150373),h=e.i(804342),y=e.i(259207),b=e.i(348684),w=e.i(193695);e.i(650048);var f=e.i(219407),m=e.i(982099),x=e.i(23250),S=e.i(961691),v=e.i(840936),A=e.i(619588);async function T(e,{params:t}){try{let{id:r}=await t,s=(0,A.checkAuthorization)(e,r);if(!s.isAuthorized)return m.NextResponse.json({success:!1,message:s.error||"Unauthorized"},{status:403});let a=new S.SubscriptionRepository,n=new v.FitnessPlanRepository,i=await x.onboardingDataService.findByClientId(r);if(!i)return m.NextResponse.json({onboardingStatus:"pending",hasProgram:!1,hasActiveSubscription:!1});let o=await n.getCurrentPlan(r),u=await a.hasActiveSubscription(r);return m.NextResponse.json({onboardingStatus:i.status,currentStep:i.currentStep,hasProgram:!!o,hasActiveSubscription:u,completedAt:i.completedAt?.toISOString(),errorMessage:i.errorMessage})}catch(e){return console.error("Error fetching onboarding status:",e),m.NextResponse.json({success:!1,message:"Internal server error"},{status:500})}}e.s(["GET",()=>T],634936);var R=e.i(634936);let I=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/users/[id]/onboarding-status/route",pathname:"/api/users/[id]/onboarding-status",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/users/[id]/onboarding-status/route.ts",nextConfigOutput:"",userland:R}),{workAsyncStorage:k,workUnitAsyncStorage:O,serverHooks:F}=I;function P(){return(0,s.patchFetch)({workAsyncStorage:k,workUnitAsyncStorage:O})}async function D(e,t,s){I.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let m="/api/users/[id]/onboarding-status/route";m=m.replace(/\/index$/,"")||"/";let x=await I.prepare(e,t,{srcPage:m,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:S,params:v,nextConfig:A,parsedUrl:T,isDraftMode:R,prerenderManifest:k,routerServerContext:O,isOnDemandRevalidate:F,revalidateOnlyGenerated:P,resolvedPathname:D,clientReferenceManifest:C,serverActionsManifest:E}=x,M=(0,u.normalizeAppPath)(m),N=!!(k.dynamicRoutes[M]||k.routes[D]),B=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,T,!1):t.end("This page could not be found"),null);if(N&&!R){let e=!!k.routes[D],t=k.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await B();throw new w.NoFallbackError}}let z=null;!N||I.isDev||R||(z="/index"===(z=D)?"/":z);let _=!0===I.isDev||!N,j=N&&!_;E&&C&&(0,i.setReferenceManifestsSingleton)({page:m,clientReferenceManifest:C,serverActionsManifest:E,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:E})});let q=e.method||"GET",U=(0,n.getTracer)(),$=U.getActiveScopeSpan(),H={params:v,prerenderManifest:k,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:_,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>I.onRequestError(e,t,s,O)},sharedContext:{buildId:S}},K=new l.NodeNextRequest(e),L=new l.NodeNextResponse(t),G=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let i=async e=>I.handle(G,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=U.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${q} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${m}`)}),o=!!(0,a.getRequestMeta)(e,"minimalMode"),u=async a=>{var n,u;let l=async({previousCacheEntry:r})=>{try{if(!o&&F&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(a);e.fetchMetrics=H.renderOpts.fetchMetrics;let u=H.renderOpts.pendingWaitUntil;u&&s.waitUntil&&(s.waitUntil(u),u=void 0);let l=H.renderOpts.collectedTags;if(!N)return await (0,g.sendResponse)(K,L,n,H.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[b.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=b.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,s=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=b.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:F})},O),t}},d=await I.handleResponse({req:e,nextConfig:A,cacheKey:z,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:F,revalidateOnlyGenerated:P,responseGenerator:l,waitUntil:s.waitUntil,isMinimalMode:o});if(!N)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(u=d.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",F?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),R&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&N||c.delete(b.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,y.getCacheControlHeader)(d.cacheControl)),await (0,g.sendResponse)(K,L,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};$?await u($):await U.withPropagatedContext(e.headers,()=>U.trace(c.BaseServerSpan.handleRequest,{spanName:`${q} ${m}`,kind:n.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},u))}catch(t){if(t instanceof w.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:F})}),N)throw t;return await (0,g.sendResponse)(K,L,new Response(null,{status:500})),null}}e.s(["handler",()=>D,"patchFetch",()=>P,"routeModule",()=>I,"serverHooks",()=>F,"workAsyncStorage",()=>k,"workUnitAsyncStorage",()=>O],47373)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__dcaf26f9._.js.map