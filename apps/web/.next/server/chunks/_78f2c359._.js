module.exports=[322093,e=>{"use strict";var t=Object.defineProperty,r=e=>{let r={};for(var n in e)t(r,n,{get:e[n],enumerable:!0});return r},n=e.z;e.s(["__export",()=>r,"__require",()=>n])},514532,(e,t,r)=>{"use strict";let n=/(?:\\(u(?:[a-f\d]{4}|\{[a-f\d]{1,6}\})|x[a-f\d]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi,s=/(?:^|\.)(\w+)(?:\(([^)]*)\))?/g,i=/^(['"])((?:\\.|(?!\1)[^\\])*)\1$/,a=/\\(u(?:[a-f\d]{4}|{[a-f\d]{1,6}})|x[a-f\d]{2}|.)|([^\\])/gi,o=new Map([["n","\n"],["r","\r"],["t","	"],["b","\b"],["f","\f"],["v","\v"],["0","\0"],["\\","\\"],["e","\x1b"],["a","\x07"]]);function l(e){let t="u"===e[0],r="{"===e[1];return t&&!r&&5===e.length||"x"===e[0]&&3===e.length?String.fromCharCode(parseInt(e.slice(1),16)):t&&r?String.fromCodePoint(parseInt(e.slice(2,-1),16)):o.get(e)||e}function c(e,t){let r={};for(let e of t)for(let t of e.styles)r[t[0]]=e.inverse?null:t.slice(1);let n=e;for(let[e,t]of Object.entries(r))if(Array.isArray(t)){if(!(e in n))throw Error(`Unknown Chalk style: ${e}`);n=t.length>0?n[e](...t):n[e]}return n}t.exports=(e,t)=>{let r=[],o=[],u=[];if(t.replace(n,(t,n,h,p,d,f)=>{if(n)u.push(l(n));else if(p){let t=u.join("");u=[],o.push(0===r.length?t:c(e,r)(t)),r.push({inverse:h,styles:function(e){let t;s.lastIndex=0;let r=[];for(;null!==(t=s.exec(e));){let e=t[1];if(t[2]){let n=function(e,t){let r,n=[];for(let s of t.trim().split(/\s*,\s*/g)){let t=Number(s);if(Number.isNaN(t))if(r=s.match(i))n.push(r[2].replace(a,(e,t,r)=>t?l(t):r));else throw Error(`Invalid Chalk template style argument: ${s} (in style '${e}')`);else n.push(t)}return n}(e,t[2]);r.push([e].concat(n))}else r.push([e])}return r}(p)})}else if(d){if(0===r.length)throw Error("Found extraneous } in Chalk template literal");o.push(c(e,r)(u.join(""))),u=[],r.pop()}else u.push(f)}),o.push(u.join("")),r.length>0)throw Error(`Chalk template literal is missing ${r.length} closing bracket${1===r.length?"":"s"} (\`}\`)`);return o.join("")}},365375,(e,t,r)=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},245339,(e,t,r)=>{let n=e.r(365375),s={};for(let e of Object.keys(n))s[n[e]]=e;let i={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(let e of(t.exports=i,Object.keys(i))){if(!("channels"in i[e]))throw Error("missing channels property: "+e);if(!("labels"in i[e]))throw Error("missing channel labels property: "+e);if(i[e].labels.length!==i[e].channels)throw Error("channel and label counts mismatch: "+e);let{channels:t,labels:r}=i[e];delete i[e].channels,delete i[e].labels,Object.defineProperty(i[e],"channels",{value:t}),Object.defineProperty(i[e],"labels",{value:r})}i.rgb.hsl=function(e){let t,r=e[0]/255,n=e[1]/255,s=e[2]/255,i=Math.min(r,n,s),a=Math.max(r,n,s),o=a-i;a===i?t=0:r===a?t=(n-s)/o:n===a?t=2+(s-r)/o:s===a&&(t=4+(r-n)/o),(t=Math.min(60*t,360))<0&&(t+=360);let l=(i+a)/2;return[t,100*(a===i?0:l<=.5?o/(a+i):o/(2-a-i)),100*l]},i.rgb.hsv=function(e){let t,r,n,s,i,a=e[0]/255,o=e[1]/255,l=e[2]/255,c=Math.max(a,o,l),u=c-Math.min(a,o,l),h=function(e){return(c-e)/6/u+.5};return 0===u?(s=0,i=0):(i=u/c,t=h(a),r=h(o),n=h(l),a===c?s=n-r:o===c?s=1/3+t-n:l===c&&(s=2/3+r-t),s<0?s+=1:s>1&&(s-=1)),[360*s,100*i,100*c]},i.rgb.hwb=function(e){let t=e[0],r=e[1],n=e[2];return[i.rgb.hsl(e)[0],1/255*Math.min(t,Math.min(r,n))*100,100*(n=1-1/255*Math.max(t,Math.max(r,n)))]},i.rgb.cmyk=function(e){let t=e[0]/255,r=e[1]/255,n=e[2]/255,s=Math.min(1-t,1-r,1-n);return[100*((1-t-s)/(1-s)||0),100*((1-r-s)/(1-s)||0),100*((1-n-s)/(1-s)||0),100*s]},i.rgb.keyword=function(e){let t,r=s[e];if(r)return r;let i=1/0;for(let r of Object.keys(n)){let s=n[r],a=(e[0]-s[0])**2+(e[1]-s[1])**2+(e[2]-s[2])**2;a<i&&(i=a,t=r)}return t},i.keyword.rgb=function(e){return n[e]},i.rgb.xyz=function(e){let t=e[0]/255,r=e[1]/255,n=e[2]/255;return[100*(.4124*(t=t>.04045?((t+.055)/1.055)**2.4:t/12.92)+.3576*(r=r>.04045?((r+.055)/1.055)**2.4:r/12.92)+.1805*(n=n>.04045?((n+.055)/1.055)**2.4:n/12.92)),100*(.2126*t+.7152*r+.0722*n),100*(.0193*t+.1192*r+.9505*n)]},i.rgb.lab=function(e){let t=i.rgb.xyz(e),r=t[0],n=t[1],s=t[2];return r/=95.047,n/=100,s/=108.883,[116*(n=n>.008856?n**(1/3):7.787*n+16/116)-16,500*((r=r>.008856?r**(1/3):7.787*r+16/116)-n),200*(n-(s=s>.008856?s**(1/3):7.787*s+16/116))]},i.hsl.rgb=function(e){let t,r,n,s=e[0]/360,i=e[1]/100,a=e[2]/100;if(0===i)return[n=255*a,n,n];t=a<.5?a*(1+i):a+i-a*i;let o=2*a-t,l=[0,0,0];for(let e=0;e<3;e++)(r=s+-(1/3*(e-1)))<0&&r++,r>1&&r--,n=6*r<1?o+(t-o)*6*r:2*r<1?t:3*r<2?o+(t-o)*(2/3-r)*6:o,l[e]=255*n;return l},i.hsl.hsv=function(e){let t=e[0],r=e[1]/100,n=e[2]/100,s=r,i=Math.max(n,.01);n*=2,r*=n<=1?n:2-n,s*=i<=1?i:2-i;let a=(n+r)/2;return[t,100*(0===n?2*s/(i+s):2*r/(n+r)),100*a]},i.hsv.rgb=function(e){let t=e[0]/60,r=e[1]/100,n=e[2]/100,s=Math.floor(t)%6,i=t-Math.floor(t),a=255*n*(1-r),o=255*n*(1-r*i),l=255*n*(1-r*(1-i));switch(n*=255,s){case 0:return[n,l,a];case 1:return[o,n,a];case 2:return[a,n,l];case 3:return[a,o,n];case 4:return[l,a,n];case 5:return[n,a,o]}},i.hsv.hsl=function(e){let t,r,n=e[0],s=e[1]/100,i=e[2]/100,a=Math.max(i,.01);r=(2-s)*i;let o=(2-s)*a;return[n,100*(t=(t=s*a/(o<=1?o:2-o))||0),100*(r/=2)]},i.hwb.rgb=function(e){let t,r,n,s,i=e[0]/360,a=e[1]/100,o=e[2]/100,l=a+o;l>1&&(a/=l,o/=l);let c=Math.floor(6*i),u=1-o;t=6*i-c,(1&c)!=0&&(t=1-t);let h=a+t*(u-a);switch(c){default:case 6:case 0:r=u,n=h,s=a;break;case 1:r=h,n=u,s=a;break;case 2:r=a,n=u,s=h;break;case 3:r=a,n=h,s=u;break;case 4:r=h,n=a,s=u;break;case 5:r=u,n=a,s=h}return[255*r,255*n,255*s]},i.cmyk.rgb=function(e){let t=e[0]/100,r=e[1]/100,n=e[2]/100,s=e[3]/100;return[255*(1-Math.min(1,t*(1-s)+s)),255*(1-Math.min(1,r*(1-s)+s)),255*(1-Math.min(1,n*(1-s)+s))]},i.xyz.rgb=function(e){let t,r,n,s=e[0]/100,i=e[1]/100,a=e[2]/100;return t=(t=3.2406*s+-1.5372*i+-.4986*a)>.0031308?1.055*t**(1/2.4)-.055:12.92*t,r=(r=-.9689*s+1.8758*i+.0415*a)>.0031308?1.055*r**(1/2.4)-.055:12.92*r,n=(n=.0557*s+-.204*i+1.057*a)>.0031308?1.055*n**(1/2.4)-.055:12.92*n,[255*(t=Math.min(Math.max(0,t),1)),255*(r=Math.min(Math.max(0,r),1)),255*(n=Math.min(Math.max(0,n),1))]},i.xyz.lab=function(e){let t=e[0],r=e[1],n=e[2];return t/=95.047,r/=100,n/=108.883,[116*(r=r>.008856?r**(1/3):7.787*r+16/116)-16,500*((t=t>.008856?t**(1/3):7.787*t+16/116)-r),200*(r-(n=n>.008856?n**(1/3):7.787*n+16/116))]},i.lab.xyz=function(e){let t,r,n,s=e[0],i=e[1],a=e[2];t=i/500+(r=(s+16)/116),n=r-a/200;let o=r**3,l=t**3,c=n**3;return r=(o>.008856?o:(r-16/116)/7.787)*100,[t=(l>.008856?l:(t-16/116)/7.787)*95.047,r,n=(c>.008856?c:(n-16/116)/7.787)*108.883]},i.lab.lch=function(e){let t,r=e[0],n=e[1],s=e[2];return(t=360*Math.atan2(s,n)/2/Math.PI)<0&&(t+=360),[r,Math.sqrt(n*n+s*s),t]},i.lch.lab=function(e){let t=e[0],r=e[1],n=e[2]/360*2*Math.PI;return[t,r*Math.cos(n),r*Math.sin(n)]},i.rgb.ansi16=function(e,t=null){let[r,n,s]=e,a=null===t?i.rgb.hsv(e)[2]:t;if(0===(a=Math.round(a/50)))return 30;let o=30+(Math.round(s/255)<<2|Math.round(n/255)<<1|Math.round(r/255));return 2===a&&(o+=60),o},i.hsv.ansi16=function(e){return i.rgb.ansi16(i.hsv.rgb(e),e[2])},i.rgb.ansi256=function(e){let t=e[0],r=e[1],n=e[2];return t===r&&r===n?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(r/255*5)+Math.round(n/255*5)},i.ansi16.rgb=function(e){let t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),[t=t/10.5*255,t,t];let r=(~~(e>50)+1)*.5;return[(1&t)*r*255,(t>>1&1)*r*255,(t>>2&1)*r*255]},i.ansi256.rgb=function(e){let t;if(e>=232){let t=(e-232)*10+8;return[t,t,t]}return[Math.floor((e-=16)/36)/5*255,Math.floor((t=e%36)/6)/5*255,t%6/5*255]},i.rgb.hex=function(e){let t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},i.hex.rgb=function(e){let t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];let r=t[0];3===t[0].length&&(r=r.split("").map(e=>e+e).join(""));let n=parseInt(r,16);return[n>>16&255,n>>8&255,255&n]},i.rgb.hcg=function(e){let t,r=e[0]/255,n=e[1]/255,s=e[2]/255,i=Math.max(Math.max(r,n),s),a=Math.min(Math.min(r,n),s),o=i-a;return t=o<1?a/(1-o):0,[360*((o<=0?0:i===r?(n-s)/o%6:i===n?2+(s-r)/o:4+(r-n)/o)/6%1),100*o,100*t]},i.hsl.hcg=function(e){let t=e[1]/100,r=e[2]/100,n=r<.5?2*t*r:2*t*(1-r),s=0;return n<1&&(s=(r-.5*n)/(1-n)),[e[0],100*n,100*s]},i.hsv.hcg=function(e){let t=e[1]/100,r=e[2]/100,n=t*r,s=0;return n<1&&(s=(r-n)/(1-n)),[e[0],100*n,100*s]},i.hcg.rgb=function(e){let t=e[0]/360,r=e[1]/100,n=e[2]/100;if(0===r)return[255*n,255*n,255*n];let s=[0,0,0],i=t%1*6,a=i%1,o=1-a,l=0;switch(Math.floor(i)){case 0:s[0]=1,s[1]=a,s[2]=0;break;case 1:s[0]=o,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=a;break;case 3:s[0]=0,s[1]=o,s[2]=1;break;case 4:s[0]=a,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=o}return l=(1-r)*n,[(r*s[0]+l)*255,(r*s[1]+l)*255,(r*s[2]+l)*255]},i.hcg.hsv=function(e){let t=e[1]/100,r=t+e[2]/100*(1-t),n=0;return r>0&&(n=t/r),[e[0],100*n,100*r]},i.hcg.hsl=function(e){let t=e[1]/100,r=e[2]/100*(1-t)+.5*t,n=0;return r>0&&r<.5?n=t/(2*r):r>=.5&&r<1&&(n=t/(2*(1-r))),[e[0],100*n,100*r]},i.hcg.hwb=function(e){let t=e[1]/100,r=t+e[2]/100*(1-t);return[e[0],(r-t)*100,(1-r)*100]},i.hwb.hcg=function(e){let t=e[1]/100,r=1-e[2]/100,n=r-t,s=0;return n<1&&(s=(r-n)/(1-n)),[e[0],100*n,100*s]},i.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},i.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},i.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},i.gray.hsl=function(e){return[0,0,e[0]]},i.gray.hsv=i.gray.hsl,i.gray.hwb=function(e){return[0,100,e[0]]},i.gray.cmyk=function(e){return[0,0,0,e[0]]},i.gray.lab=function(e){return[e[0],0,0]},i.gray.hex=function(e){let t=255&Math.round(e[0]/100*255),r=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(r.length)+r},i.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},383037,(e,t,r)=>{let n=e.r(245339);t.exports=function(e){let t=function(e){let t=function(){let e={},t=Object.keys(n);for(let r=t.length,n=0;n<r;n++)e[t[n]]={distance:-1,parent:null};return e}(),r=[e];for(t[e].distance=0;r.length;){let e=r.pop(),s=Object.keys(n[e]);for(let n=s.length,i=0;i<n;i++){let n=s[i],a=t[n];-1===a.distance&&(a.distance=t[e].distance+1,a.parent=e,r.unshift(n))}}return t}(e),r={},s=Object.keys(t);for(let e=s.length,i=0;i<e;i++){let e=s[i];null!==t[e].parent&&(r[e]=function(e,t){let r=[t[e].parent,e],s=n[t[e].parent][e],i=t[e].parent;for(;t[i].parent;)r.unshift(t[i].parent),s=function(e,t){return function(r){return t(e(r))}}(n[t[i].parent][i],s),i=t[i].parent;return s.conversion=r,s}(e,t))}return r}},469238,(e,t,r)=>{let n=e.r(245339),s=e.r(383037),i={};Object.keys(n).forEach(e=>{i[e]={},Object.defineProperty(i[e],"channels",{value:n[e].channels}),Object.defineProperty(i[e],"labels",{value:n[e].labels});let t=s(e);Object.keys(t).forEach(r=>{let n,s,a=t[r];i[e][r]=(n=function(...e){let t=e[0];if(null==t)return t;t.length>1&&(e=t);let r=a(e);if("object"==typeof r)for(let e=r.length,t=0;t<e;t++)r[t]=Math.round(r[t]);return r},"conversion"in a&&(n.conversion=a.conversion),n),i[e][r].raw=(s=function(...e){let t=e[0];return null==t?t:(t.length>1&&(e=t),a(e))},"conversion"in a&&(s.conversion=a.conversion),s)})}),t.exports=i},413033,(e,t,r)=>{"use strict";let n,s=(e,t)=>(...r)=>{let n=e(...r);return`\u001B[${n+t}m`},i=(e,t)=>(...r)=>{let n=e(...r);return`\u001B[${38+t};5;${n}m`},a=(e,t)=>(...r)=>{let n=e(...r);return`\u001B[${38+t};2;${n[0]};${n[1]};${n[2]}m`},o=e=>e,l=(e,t,r)=>[e,t,r],c=(e,t,r)=>{Object.defineProperty(e,t,{get:()=>{let n=r();return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0}),n},enumerable:!0,configurable:!0})},u=(t,r,s,i)=>{void 0===n&&(n=e.r(469238));let a=10*!!i,o={};for(let[e,i]of Object.entries(n)){let n="ansi16"===e?"ansi":e;e===r?o[n]=t(s,a):"object"==typeof i&&(o[n]=t(i[r],a))}return o};Object.defineProperty(t,"exports",{enumerable:!0,get:function(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[r,n]of(t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright,Object.entries(t))){for(let[r,s]of Object.entries(n))t[r]={open:`\u001B[${s[0]}m`,close:`\u001B[${s[1]}m`},n[r]=t[r],e.set(s[0],s[1]);Object.defineProperty(t,r,{value:n,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",c(t.color,"ansi",()=>u(s,"ansi16",o,!1)),c(t.color,"ansi256",()=>u(i,"ansi256",o,!1)),c(t.color,"ansi16m",()=>u(a,"rgb",l,!1)),c(t.bgColor,"ansi",()=>u(s,"ansi16",o,!0)),c(t.bgColor,"ansi256",()=>u(i,"ansi256",o,!0)),c(t.bgColor,"ansi16m",()=>u(a,"rgb",l,!0)),t}})},198636,(e,t,r)=>{"use strict";t.exports={stringReplaceAll:(e,t,r)=>{let n=e.indexOf(t);if(-1===n)return e;let s=t.length,i=0,a="";do a+=e.substr(i,n-i)+t+r,i=n+s,n=e.indexOf(t,i);while(-1!==n)return a+e.substr(i)},stringEncaseCRLFWithFirstIndex:(e,t,r,n)=>{let s=0,i="";do{let a="\r"===e[n-1];i+=e.substr(s,(a?n-1:n)-s)+t+(a?"\r\n":"\n")+r,s=n+1,n=e.indexOf("\n",s)}while(-1!==n)return i+e.substr(s)}}},104646,(e,t,r)=>{"use strict";let n,s=e.r(413033),{stdout:i,stderr:a}=e.r(209596),{stringReplaceAll:o,stringEncaseCRLFWithFirstIndex:l}=e.r(198636),{isArray:c}=Array,u=["ansi","ansi","ansi256","ansi16m"],h=Object.create(null);class p{constructor(e){return d(e)}}let d=e=>{let t={};return((e,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&t.level>=0&&t.level<=3))throw Error("The `level` option should be an integer from 0 to 3");let r=i?i.level:0;e.level=void 0===t.level?r:t.level})(t,e),t.template=(...e)=>v(t.template,...e),Object.setPrototypeOf(t,f.prototype),Object.setPrototypeOf(t.template,t),t.template.constructor=()=>{throw Error("`chalk.constructor()` is deprecated. Use `new chalk.Instance()` instead.")},t.template.Instance=p,t.template};function f(e){return d(e)}for(let[e,t]of Object.entries(s))h[e]={get(){let r=b(this,m(t.open,t.close,this._styler),this._isEmpty);return Object.defineProperty(this,e,{value:r}),r}};h.visible={get(){let e=b(this,this._styler,!0);return Object.defineProperty(this,"visible",{value:e}),e}};let g=["rgb","hex","keyword","hsl","hsv","hwb","ansi","ansi256"];for(let e of g)h[e]={get(){let{level:t}=this;return function(...r){return b(this,m(s.color[u[t]][e](...r),s.color.close,this._styler),this._isEmpty)}}};for(let e of g)h["bg"+e[0].toUpperCase()+e.slice(1)]={get(){let{level:t}=this;return function(...r){return b(this,m(s.bgColor[u[t]][e](...r),s.bgColor.close,this._styler),this._isEmpty)}}};let y=Object.defineProperties(()=>{},{...h,level:{enumerable:!0,get(){return this._generator.level},set(e){this._generator.level=e}}}),m=(e,t,r)=>{let n,s;return void 0===r?(n=e,s=t):(n=r.openAll+e,s=t+r.closeAll),{open:e,close:t,openAll:n,closeAll:s,parent:r}},b=(e,t,r)=>{let n=(...e)=>c(e[0])&&c(e[0].raw)?x(n,v(n,...e)):x(n,1===e.length?""+e[0]:e.join(" "));return Object.setPrototypeOf(n,y),n._generator=e,n._styler=t,n._isEmpty=r,n},x=(e,t)=>{if(e.level<=0||!t)return e._isEmpty?"":t;let r=e._styler;if(void 0===r)return t;let{openAll:n,closeAll:s}=r;if(-1!==t.indexOf("\x1b"))for(;void 0!==r;)t=o(t,r.close,r.open),r=r.parent;let i=t.indexOf("\n");return -1!==i&&(t=l(t,s,n,i)),n+t+s},v=(t,...r)=>{let[s]=r;if(!c(s)||!c(s.raw))return r.join(" ");let i=r.slice(1),a=[s.raw[0]];for(let e=1;e<s.length;e++)a.push(String(i[e-1]).replace(/[{}\\]/g,"\\$&"),String(s.raw[e]));return void 0===n&&(n=e.r(514532)),n(t,a.join(""))};Object.defineProperties(f.prototype,h);let w=d(void 0);w.supportsColor=i,w.stderr=d({level:a?a.level:0}),w.stderr.supportsColor=a,t.exports=w},429459,e=>{"use strict";var t,r,n,s,i,a,o,l=e.i(104646);let c=((t={}).DeployId="deployId",t.FnId="fnId",t.Probe="probe",t.StepId="stepId",t),u=((r={}).Trust="trust",r),h=((n={}).InngestSigningKey="INNGEST_SIGNING_KEY",n.InngestSigningKeyFallback="INNGEST_SIGNING_KEY_FALLBACK",n.InngestEventKey="INNGEST_EVENT_KEY",n.InngestDevServerUrl="INNGEST_DEVSERVER_URL",n.InngestEnvironment="INNGEST_ENV",n.InngestBaseUrl="INNGEST_BASE_URL",n.InngestEventApiBaseUrl="INNGEST_EVENT_API_BASE_URL",n.InngestApiBaseUrl="INNGEST_API_BASE_URL",n.InngestServeHost="INNGEST_SERVE_HOST",n.InngestServePath="INNGEST_SERVE_PATH",n.InngestLogLevel="INNGEST_LOG_LEVEL",n.InngestStreaming="INNGEST_STREAMING",n.InngestDevMode="INNGEST_DEV",n.InngestAllowInBandSync="INNGEST_ALLOW_IN_BAND_SYNC",n.BranchName="BRANCH_NAME",n.VercelBranch="VERCEL_GIT_COMMIT_REF",n.IsVercel="VERCEL",n.CloudflarePagesBranch="CF_PAGES_BRANCH",n.IsCloudflarePages="CF_PAGES",n.NetlifyBranch="BRANCH",n.IsNetlify="NETLIFY",n.RenderBranch="RENDER_GIT_BRANCH",n.IsRender="RENDER",n.RailwayBranch="RAILWAY_GIT_BRANCH",n.RailwayEnvironment="RAILWAY_ENVIRONMENT",n.VercelEnvKey="VERCEL_ENV",n.OpenAiApiKey="OPENAI_API_KEY",n.GeminiApiKey="GEMINI_API_KEY",n.AnthropicApiKey="ANTHROPIC_API_KEY",n),p=((s={}).ContentLength="content-length",s.Signature="x-inngest-signature",s.SdkVersion="x-inngest-sdk",s.Environment="x-inngest-env",s.Platform="x-inngest-platform",s.Framework="x-inngest-framework",s.NoRetry="x-inngest-no-retry",s.RequestVersion="x-inngest-req-version",s.RetryAfter="retry-after",s.InngestServerKind="x-inngest-server-kind",s.InngestExpectedServerKind="x-inngest-expected-server-kind",s.InngestSyncKind="x-inngest-sync-kind",s.EventIdSeed="x-inngest-event-id-seed",s.TraceParent="traceparent",s.TraceState="tracestate",s),d=((i={}).FunctionFailed="inngest/function.failed",i.FunctionInvoked="inngest/function.invoked",i.FunctionFinished="inngest/function.finished",i.FunctionCancelled="inngest/function.cancelled",i.ScheduledTimer="inngest/scheduled.timer",i),f=l.default.magenta.bold("[Inngest]"),g=((a={}).InBand="in_band",a.OutOfBand="out_of_band",a),y=((o={})[o.V0=0]="V0",o[o.V1=1]="V1",o[o.V2=2]="V2",o);e.s(["ExecutionVersion",()=>y,"debugPrefix",()=>"inngest","defaultDevServerHost",()=>"http://localhost:8288/","defaultInngestApiBaseUrl",()=>"https://api.inngest.com/","defaultInngestEventBaseUrl",()=>"https://inn.gs/","dummyEventKey",()=>"NO_EVENT_KEY_SET","envKeys",()=>h,"headerKeys",()=>p,"internalEvents",()=>d,"logPrefix",()=>f,"probe",()=>u,"queryKeys",()=>c,"syncKind",()=>g])},693757,e=>{"use strict";e.s(["version",()=>"3.44.2"])},262960,(e,t,r)=>{function n(e,t){if(!e)throw Error(t||"Assertion failed")}t.exports=n,n.equal=function(e,t,r){if(e!=t)throw Error(r||"Assertion failed: "+e+" != "+t)}},988817,(e,t,r)=>{"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},641658,(e,t,r)=>{try{var n=e.r(224361);if("function"!=typeof n.inherits)throw"";t.exports=n.inherits}catch(r){t.exports=e.r(988817)}},511706,(e,t,r)=>{"use strict";var n=e.r(262960);function s(e){return(e>>>24|e>>>8&65280|e<<8&0xff0000|(255&e)<<24)>>>0}function i(e){return 1===e.length?"0"+e:e}function a(e){if(7===e.length)return"0"+e;if(6===e.length)return"00"+e;if(5===e.length)return"000"+e;if(4===e.length)return"0000"+e;if(3===e.length)return"00000"+e;else if(2===e.length)return"000000"+e;else if(1===e.length)return"0000000"+e;else return e}r.inherits=e.r(641658),r.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"==typeof e)if(t){if("hex"===t)for((e=e.replace(/[^a-z0-9]+/ig,"")).length%2!=0&&(e="0"+e),s=0;s<e.length;s+=2)r.push(parseInt(e[s]+e[s+1],16))}else for(var n=0,s=0;s<e.length;s++){var i,a,o=e.charCodeAt(s);o<128?r[n++]=o:(o<2048?r[n++]=o>>6|192:((i=e,a=s,(64512&i.charCodeAt(a))!=55296||a<0||a+1>=i.length?1:(64512&i.charCodeAt(a+1))!=56320)?r[n++]=o>>12|224:(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++s)),r[n++]=o>>18|240,r[n++]=o>>12&63|128),r[n++]=o>>6&63|128),r[n++]=63&o|128)}else for(s=0;s<e.length;s++)r[s]=0|e[s];return r},r.toHex=function(e){for(var t="",r=0;r<e.length;r++)t+=i(e[r].toString(16));return t},r.htonl=s,r.toHex32=function(e,t){for(var r="",n=0;n<e.length;n++){var i=e[n];"little"===t&&(i=s(i)),r+=a(i.toString(16))}return r},r.zero2=i,r.zero8=a,r.join32=function(e,t,r,s){var i,a=r-t;n(a%4==0);for(var o=Array(a/4),l=0,c=t;l<o.length;l++,c+=4)i="big"===s?e[c]<<24|e[c+1]<<16|e[c+2]<<8|e[c+3]:e[c+3]<<24|e[c+2]<<16|e[c+1]<<8|e[c],o[l]=i>>>0;return o},r.split32=function(e,t){for(var r=Array(4*e.length),n=0,s=0;n<e.length;n++,s+=4){var i=e[n];"big"===t?(r[s]=i>>>24,r[s+1]=i>>>16&255,r[s+2]=i>>>8&255,r[s+3]=255&i):(r[s+3]=i>>>24,r[s+2]=i>>>16&255,r[s+1]=i>>>8&255,r[s]=255&i)}return r},r.rotr32=function(e,t){return e>>>t|e<<32-t},r.rotl32=function(e,t){return e<<t|e>>>32-t},r.sum32=function(e,t){return e+t>>>0},r.sum32_3=function(e,t,r){return e+t+r>>>0},r.sum32_4=function(e,t,r,n){return e+t+r+n>>>0},r.sum32_5=function(e,t,r,n,s){return e+t+r+n+s>>>0},r.sum64=function(e,t,r,n){var s=e[t],i=n+e[t+1]>>>0;e[t]=+(i<n)+r+s>>>0,e[t+1]=i},r.sum64_hi=function(e,t,r,n){return+(t+n>>>0<t)+e+r>>>0},r.sum64_lo=function(e,t,r,n){return t+n>>>0},r.sum64_4_hi=function(e,t,r,n,s,i,a,o){var l,c=t;return e+r+s+a+(l=0+ +((c=c+n>>>0)<t)+ +((c=c+i>>>0)<i)+ +((c=c+o>>>0)<o))>>>0},r.sum64_4_lo=function(e,t,r,n,s,i,a,o){return t+n+i+o>>>0},r.sum64_5_hi=function(e,t,r,n,s,i,a,o,l,c){var u,h=t;return e+r+s+a+l+(u=0+ +((h=h+n>>>0)<t)+ +((h=h+i>>>0)<i)+ +((h=h+o>>>0)<o)+ +((h=h+c>>>0)<c))>>>0},r.sum64_5_lo=function(e,t,r,n,s,i,a,o,l,c){return t+n+i+o+c>>>0},r.rotr64_hi=function(e,t,r){return(t<<32-r|e>>>r)>>>0},r.rotr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0},r.shr64_hi=function(e,t,r){return e>>>r},r.shr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0}},435019,(e,t,r)=>{"use strict";var n=e.r(511706),s=e.r(262960);function i(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}r.BlockHash=i,i.prototype.update=function(e,t){if(e=n.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){var r=(e=this.pending).length%this._delta8;this.pending=e.slice(e.length-r,e.length),0===this.pending.length&&(this.pending=null),e=n.join32(e,0,e.length-r,this.endian);for(var s=0;s<e.length;s+=this._delta32)this._update(e,s,s+this._delta32)}return this},i.prototype.digest=function(e){return this.update(this._pad()),s(null===this.pending),this._digest(e)},i.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,r=t-(e+this.padLength)%t,n=Array(r+this.padLength);n[0]=128;for(var s=1;s<r;s++)n[s]=0;if(e<<=3,"big"===this.endian){for(var i=8;i<this.padLength;i++)n[s++]=0;n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=e>>>24&255,n[s++]=e>>>16&255,n[s++]=e>>>8&255,n[s++]=255&e}else for(i=8,n[s++]=255&e,n[s++]=e>>>8&255,n[s++]=e>>>16&255,n[s++]=e>>>24&255,n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=0;i<this.padLength;i++)n[s++]=0;return n}},137073,(e,t,r)=>{"use strict";var n=e.r(511706).rotr32;function s(e,t,r){return e&t^e&r^t&r}r.ft_1=function(e,t,r,n){var i;return 0===e?(i=t)&r^~i&n:1===e||3===e?t^r^n:2===e?s(t,r,n):void 0},r.ch32=function(e,t,r){return e&t^~e&r},r.maj32=s,r.p32=function(e,t,r){return e^t^r},r.s0_256=function(e){return n(e,2)^n(e,13)^n(e,22)},r.s1_256=function(e){return n(e,6)^n(e,11)^n(e,25)},r.g0_256=function(e){return n(e,7)^n(e,18)^e>>>3},r.g1_256=function(e){return n(e,17)^n(e,19)^e>>>10}},797200,(e,t,r)=>{"use strict";var n=e.r(511706),s=e.r(435019),i=e.r(137073),a=n.rotl32,o=n.sum32,l=n.sum32_5,c=i.ft_1,u=s.BlockHash,h=[0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xca62c1d6];function p(){if(!(this instanceof p))return new p;u.call(this),this.h=[0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0],this.W=Array(80)}n.inherits(p,u),t.exports=p,p.blockSize=512,p.outSize=160,p.hmacStrength=80,p.padLength=64,p.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=a(r[n-3]^r[n-8]^r[n-14]^r[n-16],1);var s=this.h[0],i=this.h[1],u=this.h[2],p=this.h[3],d=this.h[4];for(n=0;n<r.length;n++){var f=~~(n/20),g=l(a(s,5),c(f,i,u,p),d,r[n],h[f]);d=p,p=u,u=a(i,30),i=s,s=g}this.h[0]=o(this.h[0],s),this.h[1]=o(this.h[1],i),this.h[2]=o(this.h[2],u),this.h[3]=o(this.h[3],p),this.h[4]=o(this.h[4],d)},p.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},725311,(e,t,r)=>{"use strict";var n=e.r(511706),s=e.r(435019),i=e.r(137073),a=e.r(262960),o=n.sum32,l=n.sum32_4,c=n.sum32_5,u=i.ch32,h=i.maj32,p=i.s0_256,d=i.s1_256,f=i.g0_256,g=i.g1_256,y=s.BlockHash,m=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2];function b(){if(!(this instanceof b))return new b;y.call(this),this.h=[0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19],this.k=m,this.W=Array(64)}n.inherits(b,y),t.exports=b,b.blockSize=512,b.outSize=256,b.hmacStrength=192,b.padLength=64,b.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=l(g(r[n-2]),r[n-7],f(r[n-15]),r[n-16]);var s=this.h[0],i=this.h[1],y=this.h[2],m=this.h[3],b=this.h[4],x=this.h[5],v=this.h[6],w=this.h[7];for(a(this.k.length===r.length),n=0;n<r.length;n++){var E=c(w,d(b),u(b,x,v),this.k[n],r[n]),S=o(p(s),h(s,i,y));w=v,v=x,x=b,b=o(m,E),m=y,y=i,i=s,s=o(E,S)}this.h[0]=o(this.h[0],s),this.h[1]=o(this.h[1],i),this.h[2]=o(this.h[2],y),this.h[3]=o(this.h[3],m),this.h[4]=o(this.h[4],b),this.h[5]=o(this.h[5],x),this.h[6]=o(this.h[6],v),this.h[7]=o(this.h[7],w)},b.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},948589,(e,t,r)=>{"use strict";var n=e.r(511706),s=e.r(725311);function i(){if(!(this instanceof i))return new i;s.call(this),this.h=[0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]}n.inherits(i,s),t.exports=i,i.blockSize=512,i.outSize=224,i.hmacStrength=192,i.padLength=64,i.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,7),"big"):n.split32(this.h.slice(0,7),"big")}},711016,(e,t,r)=>{"use strict";var n=e.r(511706),s=e.r(435019),i=e.r(262960),a=n.rotr64_hi,o=n.rotr64_lo,l=n.shr64_hi,c=n.shr64_lo,u=n.sum64,h=n.sum64_hi,p=n.sum64_lo,d=n.sum64_4_hi,f=n.sum64_4_lo,g=n.sum64_5_hi,y=n.sum64_5_lo,m=s.BlockHash,b=[0x428a2f98,0xd728ae22,0x71374491,0x23ef65cd,0xb5c0fbcf,0xec4d3b2f,0xe9b5dba5,0x8189dbbc,0x3956c25b,0xf348b538,0x59f111f1,0xb605d019,0x923f82a4,0xaf194f9b,0xab1c5ed5,0xda6d8118,0xd807aa98,0xa3030242,0x12835b01,0x45706fbe,0x243185be,0x4ee4b28c,0x550c7dc3,0xd5ffb4e2,0x72be5d74,0xf27b896f,0x80deb1fe,0x3b1696b1,0x9bdc06a7,0x25c71235,0xc19bf174,0xcf692694,0xe49b69c1,0x9ef14ad2,0xefbe4786,0x384f25e3,0xfc19dc6,0x8b8cd5b5,0x240ca1cc,0x77ac9c65,0x2de92c6f,0x592b0275,0x4a7484aa,0x6ea6e483,0x5cb0a9dc,0xbd41fbd4,0x76f988da,0x831153b5,0x983e5152,0xee66dfab,0xa831c66d,0x2db43210,0xb00327c8,0x98fb213f,0xbf597fc7,0xbeef0ee4,0xc6e00bf3,0x3da88fc2,0xd5a79147,0x930aa725,0x6ca6351,0xe003826f,0x14292967,0xa0e6e70,0x27b70a85,0x46d22ffc,0x2e1b2138,0x5c26c926,0x4d2c6dfc,0x5ac42aed,0x53380d13,0x9d95b3df,0x650a7354,0x8baf63de,0x766a0abb,0x3c77b2a8,0x81c2c92e,0x47edaee6,0x92722c85,0x1482353b,0xa2bfe8a1,0x4cf10364,0xa81a664b,0xbc423001,0xc24b8b70,0xd0f89791,0xc76c51a3,0x654be30,0xd192e819,0xd6ef5218,0xd6990624,0x5565a910,0xf40e3585,0x5771202a,0x106aa070,0x32bbd1b8,0x19a4c116,0xb8d2d0c8,0x1e376c08,0x5141ab53,0x2748774c,0xdf8eeb99,0x34b0bcb5,0xe19b48a8,0x391c0cb3,0xc5c95a63,0x4ed8aa4a,0xe3418acb,0x5b9cca4f,0x7763e373,0x682e6ff3,0xd6b2b8a3,0x748f82ee,0x5defb2fc,0x78a5636f,0x43172f60,0x84c87814,0xa1f0ab72,0x8cc70208,0x1a6439ec,0x90befffa,0x23631e28,0xa4506ceb,0xde82bde9,0xbef9a3f7,0xb2c67915,0xc67178f2,0xe372532b,0xca273ece,0xea26619c,0xd186b8c7,0x21c0c207,0xeada7dd6,0xcde0eb1e,0xf57d4f7f,0xee6ed178,0x6f067aa,0x72176fba,0xa637dc5,0xa2c898a6,0x113f9804,0xbef90dae,0x1b710b35,0x131c471b,0x28db77f5,0x23047d84,0x32caab7b,0x40c72493,0x3c9ebe0a,0x15c9bebc,0x431d67c4,0x9c100d4c,0x4cc5d4be,0xcb3e42b6,0x597f299c,0xfc657e2a,0x5fcb6fab,0x3ad6faec,0x6c44198c,0x4a475817];function x(){if(!(this instanceof x))return new x;m.call(this),this.h=[0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179],this.k=b,this.W=Array(160)}n.inherits(x,m),t.exports=x,x.blockSize=1024,x.outSize=512,x.hmacStrength=192,x.padLength=128,x.prototype._prepareBlock=function(e,t){for(var r=this.W,n=0;n<32;n++)r[n]=e[t+n];for(;n<r.length;n+=2){var s=function(e,t){var r=a(e,t,19)^a(t,e,29)^l(e,t,6);return r<0&&(r+=0x100000000),r}(r[n-4],r[n-3]),i=function(e,t){var r=o(e,t,19)^o(t,e,29)^c(e,t,6);return r<0&&(r+=0x100000000),r}(r[n-4],r[n-3]),u=r[n-14],h=r[n-13],p=function(e,t){var r=a(e,t,1)^a(e,t,8)^l(e,t,7);return r<0&&(r+=0x100000000),r}(r[n-30],r[n-29]),g=function(e,t){var r=o(e,t,1)^o(e,t,8)^c(e,t,7);return r<0&&(r+=0x100000000),r}(r[n-30],r[n-29]),y=r[n-32],m=r[n-31];r[n]=d(s,i,u,h,p,g,y,m),r[n+1]=f(s,i,u,h,p,g,y,m)}},x.prototype._update=function(e,t){this._prepareBlock(e,t);var r=this.W,n=this.h[0],s=this.h[1],l=this.h[2],c=this.h[3],d=this.h[4],f=this.h[5],m=this.h[6],b=this.h[7],x=this.h[8],v=this.h[9],w=this.h[10],E=this.h[11],S=this.h[12],k=this.h[13],_=this.h[14],O=this.h[15];i(this.k.length===r.length);for(var I=0;I<r.length;I+=2){var A=_,z=O,T=function(e,t){var r=a(e,t,14)^a(e,t,18)^a(t,e,9);return r<0&&(r+=0x100000000),r}(x,v),j=function(e,t){var r=o(e,t,14)^o(e,t,18)^o(t,e,9);return r<0&&(r+=0x100000000),r}(x,v),N=function(e,t,r,n,s){var i=e&r^~e&s;return i<0&&(i+=0x100000000),i}(x,0,w,0,S,k),C=function(e,t,r,n,s,i){var a=t&n^~t&i;return a<0&&(a+=0x100000000),a}(0,v,0,E,0,k),R=this.k[I],P=this.k[I+1],F=r[I],M=r[I+1],K=g(A,z,T,j,N,C,R,P,F,M),U=y(A,z,T,j,N,C,R,P,F,M);A=function(e,t){var r=a(e,t,28)^a(t,e,2)^a(t,e,7);return r<0&&(r+=0x100000000),r}(n,s),z=function(e,t){var r=o(e,t,28)^o(t,e,2)^o(t,e,7);return r<0&&(r+=0x100000000),r}(n,s);var B=h(A,z,T=function(e,t,r,n,s){var i=e&r^e&s^r&s;return i<0&&(i+=0x100000000),i}(n,0,l,0,d,f),j=function(e,t,r,n,s,i){var a=t&n^t&i^n&i;return a<0&&(a+=0x100000000),a}(0,s,0,c,0,f)),D=p(A,z,T,j);_=S,O=k,S=w,k=E,w=x,E=v,x=h(m,b,K,U),v=p(b,b,K,U),m=d,b=f,d=l,f=c,l=n,c=s,n=h(K,U,B,D),s=p(K,U,B,D)}u(this.h,0,n,s),u(this.h,2,l,c),u(this.h,4,d,f),u(this.h,6,m,b),u(this.h,8,x,v),u(this.h,10,w,E),u(this.h,12,S,k),u(this.h,14,_,O)},x.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},616342,(e,t,r)=>{"use strict";var n=e.r(511706),s=e.r(711016);function i(){if(!(this instanceof i))return new i;s.call(this),this.h=[0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]}n.inherits(i,s),t.exports=i,i.blockSize=1024,i.outSize=384,i.hmacStrength=192,i.padLength=128,i.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,12),"big"):n.split32(this.h.slice(0,12),"big")}},955966,(e,t,r)=>{"use strict";r.sha1=e.r(797200),r.sha224=e.r(948589),r.sha256=e.r(725311),r.sha384=e.r(616342),r.sha512=e.r(711016)},213122,(e,t,r)=>{"use strict";var n=e.r(511706),s=e.r(435019),i=n.rotl32,a=n.sum32,o=n.sum32_3,l=n.sum32_4,c=s.BlockHash;function u(){if(!(this instanceof u))return new u;c.call(this),this.h=[0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0],this.endian="little"}function h(e,t,r,n){return e<=15?t^r^n:e<=31?t&r|~t&n:e<=47?(t|~r)^n:e<=63?t&n|r&~n:t^(r|~n)}n.inherits(u,c),r.ripemd160=u,u.blockSize=512,u.outSize=160,u.hmacStrength=192,u.padLength=64,u.prototype._update=function(e,t){for(var r=this.h[0],n=this.h[1],s=this.h[2],c=this.h[3],u=this.h[4],y=r,m=n,b=s,x=c,v=u,w=0;w<80;w++){var E,S,k=a(i(l(r,h(w,n,s,c),e[p[w]+t],(E=w)<=15?0:E<=31?0x5a827999:E<=47?0x6ed9eba1:E<=63?0x8f1bbcdc:0xa953fd4e),f[w]),u);r=u,u=c,c=i(s,10),s=n,n=k,k=a(i(l(y,h(79-w,m,b,x),e[d[w]+t],(S=w)<=15?0x50a28be6:S<=31?0x5c4dd124:S<=47?0x6d703ef3:0x7a6d76e9*!!(S<=63)),g[w]),v),y=v,v=x,x=i(b,10),b=m,m=k}k=o(this.h[1],s,x),this.h[1]=o(this.h[2],c,v),this.h[2]=o(this.h[3],u,y),this.h[3]=o(this.h[4],r,m),this.h[4]=o(this.h[0],n,b),this.h[0]=k},u.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"little"):n.split32(this.h,"little")};var p=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],d=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],f=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],g=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},226726,(e,t,r)=>{"use strict";var n=e.r(511706),s=e.r(262960);function i(e,t,r){if(!(this instanceof i))return new i(e,t,r);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(n.toArray(t,r))}t.exports=i,i.prototype._init=function(e){e.length>this.blockSize&&(e=new this.Hash().update(e).digest()),s(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(t=0,this.inner=new this.Hash().update(e);t<e.length;t++)e[t]^=106;this.outer=new this.Hash().update(e)},i.prototype.update=function(e,t){return this.inner.update(e,t),this},i.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)}},172116,(e,t,r)=>{r.utils=e.r(511706),r.common=e.r(435019),r.sha=e.r(955966),r.ripemd=e.r(213122),r.hmac=e.r(226726),r.sha1=r.sha.sha1,r.sha256=r.sha.sha256,r.sha224=r.sha.sha224,r.sha384=r.sha.sha384,r.sha512=r.sha.sha512,r.ripemd160=r.ripemd.ripemd160},630952,(e,t,r)=>{(t.exports=function(e,t,r,s){return JSON.stringify(e,n(t,s),r)}).getSerialize=n;function n(e,t){var r=[],n=[];return null==t&&(t=function(e,t){return r[0]===t?"[Circular ~]":"[Circular ~."+n.slice(0,r.indexOf(t)).join(".")+"]"}),function(s,i){if(r.length>0){var a=r.indexOf(this);~a?r.splice(a+1):r.push(this),~a?n.splice(a,1/0,s):n.push(s),~r.indexOf(i)&&(i=t.call(this,s,i))}else r.push(i);return null==e?i:e.call(this,s,i)}}},519930,e=>{"use strict";var t=e.i(172116),r=e.i(630952),n=e.i(527577);let{sha256:s}=t.default,i=e=>(0,r.default)(e,(e,t)=>{if("bigint"!=typeof t)return t}),a=[["w",6048e5],["d",864e5],["h",36e5],["m",6e4],["s",1e3]],o=e=>{if(e instanceof Date)return e.toISOString();let t="string"==typeof e?(0,n.default)(e):e,[,r]=a.reduce(([e,t],[r,n])=>{let s=Math.floor(e/n);return s>0?[e%n,`${t}${s}${r}`]:[e,t]},[t,""]);return r},l=e=>{if("boolean"==typeof e||"number"==typeof e||"string"==typeof e)return e.toString()},c=e=>s().update(e).digest("hex"),u=e=>{if(!e)return"";let t=e.match(/^signkey-[\w]+-/)?.shift()||"",r=e.replace(/^signkey-[\w]+-/,"");return`${t}${s().update(r,"hex").digest("hex")}`};e.s(["hashEventKey",()=>c,"hashSigningKey",()=>u,"stringify",()=>i,"stringifyUnknown",()=>l,"timeStr",()=>o])},647664,(e,t,r)=>{var n=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,o={},l={errorConstructors:()=>u};for(var c in l)n(o,c,{get:l[c],enumerable:!0});t.exports=((e,t,r,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of i(t))a.call(e,r)||void 0===r||n(e,r,{get:()=>t[r],enumerable:!(o=s(t,r))||o.enumerable});return e})(n({},"__esModule",{value:!0}),o);let u=new Map([Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]))},139796,(e,t,r)=>{var n=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,o={},l={deserializeError:()=>d,errorConstructors:()=>u.errorConstructors,serializeError:()=>p};for(var c in l)n(o,c,{get:l[c],enumerable:!0});t.exports=((e,t,r,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of i(t))a.call(e,r)||void 0===r||n(e,r,{get:()=>t[r],enumerable:!(o=s(t,r))||o.enumerable});return e})(n({},"__esModule",{value:!0}),o);var u=e.r(647664);let h=[{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}];function p(e){let t={name:"Error",message:"",stack:""};for(let{property:r}of h)r in e&&(t[r]=e[r]);return globalThis.DOMException&&e instanceof globalThis.DOMException?t.name="DOMException":t.name=Object.getPrototypeOf(e).name,t}function d(e){var t,r;let n=new(t=e.name,null!=(r=u.errorConstructors.get(t))?r:Error);for(let{property:t,enumerable:r}of h)t in e&&Object.defineProperty(n,t,{value:e[t],enumerable:r,configurable:!0,writable:!0});return n}},159853,(e,t,r)=>{"use strict";t.exports=e=>RegExp("[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)|(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))",(e=Object.assign({onlyFirst:!1},e)).onlyFirst?void 0:"g")},20224,(e,t,r)=>{"use strict";let n=e.r(159853),s=e=>"string"==typeof e?e.replace(n(),""):e;t.exports=s,t.exports.default=s},58880,84853,172259,628424,506057,e=>{"use strict";var t,r,n=e.i(322093),s=e.i(429459),i=e.i(693757),a=e.i(519930);let o=(e=d())=>{let t=["REACT_APP_","NEXT_PUBLIC_"];return[s.envKeys.InngestBaseUrl,s.envKeys.InngestDevMode].flatMap(r=>t.map(t=>e[t+r])).find(e=>{if(e)try{return new URL(e),!0}catch{}})},l={equals:(e,t)=>e===t,"starts with":(e,t)=>!!t&&(e?.startsWith(t)??!1),"is truthy":e=>!!e,"is truthy but not":(e,t)=>!!e&&e!==t},c=[["CF_PAGES","equals","1"],["CONTEXT","starts with","prod"],["ENVIRONMENT","starts with","prod"],["NODE_ENV","starts with","prod"],["VERCEL_ENV","starts with","prod"],["DENO_DEPLOYMENT_ID","is truthy"],[s.envKeys.VercelEnvKey,"is truthy but not","development"],[s.envKeys.IsNetlify,"is truthy"],[s.envKeys.IsRender,"is truthy"],[s.envKeys.RailwayBranch,"is truthy"],[s.envKeys.IsCloudflarePages,"is truthy"]];var u=class{type;isExplicit;explicitDevUrl;env;constructor({type:e,isExplicit:t,explicitDevUrl:r,env:n=d()}){this.env=n,this.type=e,this.isExplicit=t||!!r,this.explicitDevUrl=r}get isDev(){return"dev"===this.type}get isCloud(){return"cloud"===this.type}get isInferred(){return!this.isExplicit}getExplicitUrl(e){if(this.isExplicit){if(this.explicitDevUrl)return this.explicitDevUrl.href;if(this.isCloud)return e;if(this.isDev)return s.defaultDevServerHost}}};let h=({env:e=d(),client:t,explicitMode:r}={})=>{if(r)return new u({type:r,isExplicit:!0,env:e});if(t?.mode.isExplicit)return t.mode;if(s.envKeys.InngestDevMode in e){if("string"==typeof e[s.envKeys.InngestDevMode])try{let t=new URL(e[s.envKeys.InngestDevMode]);return new u({type:"dev",isExplicit:!0,explicitDevUrl:t,env:e})}catch{}let t=E(e[s.envKeys.InngestDevMode]);if("boolean"==typeof t)return new u({type:t?"dev":"cloud",isExplicit:!0,env:e})}return new u({type:c.some(([t,r,n])=>l[r]((0,a.stringifyUnknown)(e[t]),n))?"cloud":"dev",isExplicit:!1,env:e})},p=e=>d()[e],d=()=>{try{return process.env}catch(e){}try{let e=Deno.env.toObject();if(e)return e}catch(e){}try{let e=Netlify.env.toObject();if(e)return e}catch(e){}return{}},f=e=>{let t=`inngest-js:v${i.version}`,r={"Content-Type":"application/json","User-Agent":t,[s.headerKeys.SdkVersion]:t};e?.framework&&(r[s.headerKeys.Framework]=e.framework),e?.expectedServerKind&&(r[s.headerKeys.InngestExpectedServerKind]=e.expectedServerKind);let n={...d(),...e?.env},a=e?.inngestEnv||((e=d())=>e[s.envKeys.InngestEnvironment]||e[s.envKeys.BranchName]||e[s.envKeys.VercelBranch]||e[s.envKeys.NetlifyBranch]||e[s.envKeys.CloudflarePagesBranch]||e[s.envKeys.RenderBranch]||e[s.envKeys.RailwayBranch])(n);a&&(r[s.headerKeys.Environment]=a);let o=m(n);return o&&(r[s.headerKeys.Platform]=o),{...r,...e?.client?.headers,...e?.extras}},g={vercel:e=>"1"===e[s.envKeys.IsVercel]||"string"==typeof EdgeRuntime,netlify:e=>"true"===e[s.envKeys.IsNetlify],"cloudflare-pages":e=>"1"===e[s.envKeys.IsCloudflarePages],render:e=>"true"===e[s.envKeys.IsRender],railway:e=>!!e[s.envKeys.RailwayEnvironment]},y={vercel:(e,t)=>"string"==typeof EdgeRuntime,"cloudflare-pages":()=>!0},m=e=>Object.keys(g).find(t=>g[t](e)),b=(e,t=d())=>y[m(t)]?.(e,t)??!1,x=Symbol("Custom fetch implementation"),v=e=>{if(e){if(x in e)return e;let t=async(...t)=>{try{return await e(...t)}catch(e){throw e instanceof Error&&e.message?.startsWith("fetch failed")||(console.warn("A request failed when using a custom fetch implementation; this may be a misconfiguration. Make sure that your fetch client is correctly bound to the global scope."),console.error(e)),e}};return Object.defineProperties(t,{[x]:{},name:{value:e.name},length:{value:e.length}}),t}try{if("undefined"!=typeof globalThis&&"fetch"in globalThis)return fetch.bind(globalThis)}catch(e){}return"undefined"!=typeof fetch?fetch:(0,n.__require)("cross-fetch")},w=()=>"undefined"!=typeof Response?Response:(0,n.__require)("cross-fetch").Response,E=e=>{if("boolean"==typeof e)return e;if("number"==typeof e)return!!e;if("string"==typeof e){let t=e.trim().toLowerCase();return"undefined"===t?void 0:!!["true","1"].includes(t)}};e.s(["Mode",()=>u,"allProcessEnv",()=>d,"devServerHost",()=>o,"getFetch",()=>v,"getMode",()=>h,"getPlatformName",()=>m,"getResponse",()=>w,"inngestHeaders",()=>f,"parseAsBoolean",()=>E,"platformSupportsStreaming",()=>b,"processEnv",()=>p],58880);var S=s;let k=async(e=S.defaultDevServerHost,t)=>{try{let r=_(e,"/dev");return await (await t(r.toString())).json(),!0}catch(e){return!1}},_=(e=O(),t="")=>new URL(t,e.includes("://")?e:`http://${e}`),O=()=>o()||S.defaultDevServerHost;e.s(["devServerAvailable",()=>k,"devServerUrl",()=>_],84853);var I=class extends Error{cause;constructor(e,t){super(e),this.cause=t?.cause,this.name="NonRetriableError"}};e.s(["NonRetriableError",()=>I],172259),e.i(454188);var A=e.i(331612),z=e.i(104646),T=e.i(630952),j=e.i(139796),N=e.i(20224);let C="__serialized";j.errorConstructors.set("NonRetriableError",I);let R=(e,t=!1)=>{try{let r=P(e);if(r)return r;if("object"==typeof e&&null!==e){let r=(0,j.serializeError)(e);if(!r.name&&t)return e;let n={...r,name:r.name||"Error",message:r.message||(0,T.default)(e)||"Unknown error; error serialization could not find a message.",stack:r.stack||"",[C]:!0},s=n;for(let e=0;e<5;e++){if("object"==typeof s&&null!==s&&"cause"in s&&s.cause){s=s.cause=R(s.cause,!0);continue}break}return n}throw Error("Error is not an object; strange throw value.")}catch{if(t)return e;try{return{...R(Error("string"==typeof e?e:(0,T.default)(e)),!1),stack:"",[C]:!0}}catch{return{name:"Could not serialize source error",message:"Serializing the source error failed.",stack:"",[C]:!0}}}},P=e=>{try{if("string"==typeof e){let t=A.z.object({[C]:A.z.literal(!0),name:A.z.enum([...Array.from(j.errorConstructors.keys())]),message:A.z.string(),stack:A.z.string()}).passthrough().safeParse(JSON.parse(e));if(t.success)return t.data}if("object"==typeof e&&null!==e&&Object.hasOwn(e,C)&&!0===e[C])return e}catch{}},F=(e,t=!1)=>{try{if(!["name","message"].every(t=>Object.hasOwn(e,t)))throw Error();let t=(0,j.deserializeError)(e);return"cause"in t&&(t.cause=F(t.cause,!0)),t}catch{if(t)return e;let r=Error("Unknown error; could not reserialize");return r.stack=void 0,r}},M=((t={}).NESTING_STEPS="NESTING_STEPS",t.NON_DETERMINISTIC_FUNCTION="NON_DETERMINISTIC_FUNCTION",t.ASYNC_DETECTED_AFTER_MEMOIZATION="ASYNC_DETECTED_AFTER_MEMOIZATION",t.STEP_USED_AFTER_ASYNC="STEP_USED_AFTER_ASYNC",t.AUTOMATIC_PARALLEL_INDEXING="AUTOMATIC_PARALLEL_INDEXING",t),K="=================================================",U=e=>{try{if(!B(e)||!e.message.includes(K))return e;let t=(0,N.default)(e.message),r=t.split("  ")[1]?.split("\n")[0]?.trim()||e.message;if(e.message=[t.split("\n\nCode: ")[1]?.split("\n\n")[0]?.trim()||void 0,r].filter(Boolean).join(" - "),e.stack){let t=(0,N.default)(e.stack).split(`${K}
`).slice(2).join("\n");e.stack=`${e.name}: ${e.message}
${t}`}return e}catch(t){return e}},B=e=>{try{if(e instanceof Error)return!0;if("object"!=typeof e||null===e)return!1;return Object.hasOwn(e,"name")&&Object.hasOwn(e,"message")}catch(e){return!1}},D=(e,t)=>{let{message:r}=A.z.object({message:A.z.string().min(1)}).catch({message:t}).parse(e);return r},H=({type:e="error",whatHappened:t,otherwise:r,reassurance:n,toFixNow:s,why:i,consequences:a,stack:o,code:l})=>{let{icon:c,colorFn:u}={error:{icon:"‚ùå",colorFn:z.default.red},warn:{icon:"‚ö†Ô∏è",colorFn:z.default.yellow}}[e],h=`${c}  ${z.default.bold.underline(t.trim())}`;o&&(h+="\n"+[...Error().stack?.split("\n").slice(1).filter(Boolean)||[]].join("\n"));let p=(Array.isArray(s)?s.map(e=>e.trim()).filter(Boolean).map((e,t)=>`	${t+1}. ${e}`).join("\n"):s?.trim())??"";Array.isArray(s)&&p&&(p=`To fix this, you can take one of the following courses of action:

${p}`);let d=[n?.trim(),i?.trim(),a?.trim()].filter(Boolean).join(" ");d+=d?`

${p}`:p;let f=[r?.trim()].filter(Boolean).join(" "),g=[K,h,d,f,l?`Code: ${l}`:"",K].filter(Boolean).join("\n\n");return u(g)},V=["Set the `INNGEST_EVENT_KEY` environment variable","Pass a key to the `new Inngest()` constructor using the `eventKey` option","Use `inngest.setEventKey()` at runtime"],$=e=>t=>{try{t.message&&=`${e}; ${t.message}`}catch(e){}finally{throw t}},L=e=>H({whatHappened:"Your function was stopped from running",why:"We detected a mix of asynchronous logic, some using step tooling and some not.",consequences:"This can cause unexpected behaviour when a function is paused and resumed and is therefore strongly discouraged; we stopped your function to ensure nothing unexpected happened!",stack:!0,toFixNow:"Ensure that your function is either entirely step-based or entirely non-step-based, by either wrapping all asynchronous logic in `step.run()` calls or by removing all `step.*()` calls.",otherwise:"For more information on why step functions work in this manner, see https://www.inngest.com/docs/functions/multi-step#gotchas",code:e});e.s(["ErrCode",()=>M,"deserializeError",()=>F,"fixEventKeyMissingSteps",()=>V,"functionStoppedRunningErr",()=>L,"getErrorMessage",()=>D,"minifyPrettyError",()=>U,"prettyError",()=>H,"rethrowError",()=>$,"serializeError",()=>R],628424);let q=A.z.object({name:A.z.string().trim().optional(),error:A.z.string().trim().optional(),message:A.z.string().trim().optional(),stack:A.z.string().trim().optional()}),G=A.z.lazy(()=>A.z.object({name:A.z.string().trim(),message:A.z.string().trim(),stack:A.z.string().trim().optional(),cause:A.z.union([G,A.z.unknown()]).optional()})),W=q.extend({cause:A.z.union([G,A.z.unknown()]).optional()}).passthrough().catch({}).transform(e=>({...e,name:e.name||"Error",message:e.message||e.error||"Unknown error",stack:e.stack})),Y=((r={}).WaitForSignal="WaitForSignal",r.WaitForEvent="WaitForEvent",r.Step="Step",r.StepRun="StepRun",r.StepError="StepError",r.StepFailed="StepFailed",r.StepPlanned="StepPlanned",r.Sleep="Sleep",r.StepNotFound="StepNotFound",r.InvokeFunction="InvokeFunction",r.AiGateway="AIGateway",r.Gateway="Gateway",r);A.z.object({id:A.z.string().min(1),data:A.z.any().optional(),error:A.z.any().optional(),input:A.z.any().optional()});let X=A.z.object({ids:A.z.array(A.z.string()).default([]),status:A.z.number().default(0),error:A.z.string().optional()}),Z=["fatal","error","warn","info","debug","silent"],J=A.z.strictObject({limit:A.z.number(),key:A.z.string().optional(),scope:A.z.enum(["fn","env","account"]).optional()}),Q=A.z.strictObject({name:A.z.string().optional(),id:A.z.string(),triggers:A.z.array(A.z.union([A.z.strictObject({event:A.z.string(),expression:A.z.string().optional()}),A.z.strictObject({cron:A.z.string()})])),steps:A.z.record(A.z.strictObject({id:A.z.string(),name:A.z.string(),runtime:A.z.strictObject({type:A.z.union([A.z.literal("http"),A.z.literal("ws")]),url:A.z.string()}),retries:A.z.strictObject({attempts:A.z.number().optional()}).optional()})),idempotency:A.z.string().optional(),batchEvents:A.z.strictObject({maxSize:A.z.number(),timeout:A.z.string(),key:A.z.string().optional(),if:A.z.string().optional()}).optional(),rateLimit:A.z.strictObject({key:A.z.string().optional(),limit:A.z.number(),period:A.z.string().transform(e=>e)}).optional(),throttle:A.z.strictObject({key:A.z.string().optional(),limit:A.z.number(),period:A.z.string().transform(e=>e),burst:A.z.number().optional()}).optional(),singleton:A.z.strictObject({key:A.z.string().optional(),mode:A.z.enum(["skip","cancel"])}).optional(),cancel:A.z.array(A.z.strictObject({event:A.z.string(),if:A.z.string().optional(),timeout:A.z.string().optional()})).optional(),debounce:A.z.strictObject({key:A.z.string().optional(),period:A.z.string().transform(e=>e),timeout:A.z.string().transform(e=>e).optional()}).optional(),timeouts:A.z.strictObject({start:A.z.string().transform(e=>e).optional(),finish:A.z.string().transform(e=>e).optional()}).optional(),priority:A.z.strictObject({run:A.z.string().optional()}).optional(),concurrency:A.z.union([A.z.number(),J.transform(e=>e),A.z.array(J.transform(e=>e)).min(1).max(2)]).optional()}),ee=e=>({ok:!0,value:e}),et=e=>({ok:!1,error:e}),er=A.z.strictObject({url:A.z.string()});e.s(["StepOpCode",()=>Y,"err",()=>et,"functionConfigSchema",()=>Q,"inBandSyncRequestBodySchema",()=>er,"jsonErrorSchema",()=>W,"logLevels",()=>Z,"ok",()=>ee,"sendEventResponseSchema",()=>X],506057)},401608,e=>{"use strict";e.i(322093);var t=e.i(429459),r=e.i(250585);let n=t.ExecutionVersion.V1;var s=class{debug;constructor(e){this.options=e,this.debug=(0,r.default)(`${t.debugPrefix}:${this.options.runId}`)}};e.s(["InngestExecution",()=>s,"PREFERRED_EXECUTION_VERSION",()=>n])},949783,e=>{"use strict";var t=e.i(429459),r=e.i(506057);e.i(454188);var n=e.i(331612);let s=n.z.object({error:n.z.string(),status:n.z.number()}),i=n.z.record(n.z.any().refine(e=>void 0!==e,{message:"Values in steps must be defined"})).optional().nullable(),a=n.z.record(n.z.object({type:n.z.literal("data").optional().default("data"),data:n.z.any().refine(e=>void 0!==e,{message:"Data in steps must be defined"})}).strict().or(n.z.object({type:n.z.literal("error").optional().default("error"),error:r.jsonErrorSchema}).strict()).or(n.z.object({type:n.z.literal("input").optional().default("input"),input:n.z.any().refine(e=>void 0!==e,{message:"If input is present it must not be `undefined`"})}).strict()).or(n.z.any().transform(e=>({type:"data",data:e})))).default({}),o={[t.ExecutionVersion.V0]:i,[t.ExecutionVersion.V1]:a,[t.ExecutionVersion.V2]:a},l=n.z.array(n.z.record(n.z.any()).transform(e=>e));e.s(["batchSchema",()=>l,"errorSchema",()=>s,"stepsSchemas",()=>o])},879449,e=>{"use strict";var t=e.i(429459),r=e.i(628424),n=e.i(506057),s=e.i(949783),i=e.i(401608);e.i(454188);var a=e.i(405926),o=e.i(331612);let l=e=>{let t="value",r=new Map;return(...n)=>(r.has(t)||r.set(t,e(...n)),r.get(t))},c=(e,t)=>(...r)=>e.reduce(async(e,r)=>{let n=await e,s=await r(n);return t?await t(n,s):void 0===s?n:s},Promise.resolve(r[0])),u=e=>void 0===e?null:e,h=o.z.object({version:o.z.literal(-1).or(o.z.literal(0)).or(o.z.literal(1)).or(o.z.literal(2)).optional().transform(e=>void 0===e?(console.debug(`No request version specified by executor; defaulting to v${i.PREFERRED_EXECUTION_VERSION}`),i.PREFERRED_EXECUTION_VERSION):-1===e?i.PREFERRED_EXECUTION_VERSION:e)}),p=e=>{let r;try{return{version:r}=h.parse(e),({[t.ExecutionVersion.V0]:()=>({version:t.ExecutionVersion.V0,...o.z.object({event:o.z.record(o.z.any()),events:o.z.array(o.z.record(o.z.any())).default([]),steps:s.stepsSchemas[t.ExecutionVersion.V0],ctx:o.z.object({run_id:o.z.string(),attempt:o.z.number().default(0),stack:o.z.object({stack:o.z.array(o.z.string()).nullable().transform(e=>Array.isArray(e)?e:[]),current:o.z.number()}).passthrough().optional().nullable()}).optional().nullable(),use_api:o.z.boolean().default(!1)}).parse(e)}),[t.ExecutionVersion.V1]:()=>({version:t.ExecutionVersion.V1,...o.z.object({event:o.z.record(o.z.any()),events:o.z.array(o.z.record(o.z.any())).default([]),steps:s.stepsSchemas[t.ExecutionVersion.V1],ctx:o.z.object({run_id:o.z.string(),attempt:o.z.number().default(0),max_attempts:o.z.number().optional(),disable_immediate_execution:o.z.boolean().default(!1),use_api:o.z.boolean().default(!1),stack:o.z.object({stack:o.z.array(o.z.string()).nullable().transform(e=>Array.isArray(e)?e:[]),current:o.z.number()}).passthrough().optional().nullable()}).optional().nullable()}).parse(e)}),[t.ExecutionVersion.V2]:()=>({version:t.ExecutionVersion.V2,...o.z.object({event:o.z.record(o.z.any()),events:o.z.array(o.z.record(o.z.any())).default([]),steps:s.stepsSchemas[t.ExecutionVersion.V2],ctx:o.z.object({run_id:o.z.string(),attempt:o.z.number().default(0),max_attempts:o.z.number().optional(),disable_immediate_execution:o.z.boolean().default(!1),use_api:o.z.boolean().default(!1),stack:o.z.object({stack:o.z.array(o.z.string()).nullable().transform(e=>Array.isArray(e)?e:[]),current:o.z.number()}).passthrough().optional().nullable()}).optional().nullable()}).parse(e)})})[r]()}catch(e){throw Error(f(e))}},d=async({data:e,api:s,version:i})=>{let a={...e};try{if(a.version===t.ExecutionVersion.V0&&a.use_api||a.version===t.ExecutionVersion.V1&&a.ctx?.use_api){if(!a.ctx?.run_id)return(0,n.err)((0,r.prettyError)({whatHappened:"failed to attempt retrieving data from API",consequences:"function execution can't continue",why:"run_id is missing from context",stack:!0}));let[e,t]=await Promise.all([s.getRunBatch(a.ctx.run_id),s.getRunSteps(a.ctx.run_id,i)]);if(!e.ok)return(0,n.err)((0,r.prettyError)({whatHappened:"failed to retrieve list of events",consequences:"function execution can't continue",why:e.error?.error,stack:!0}));if(a.events=e.value,!t.ok)return(0,n.err)((0,r.prettyError)({whatHappened:"failed to retrieve steps for function run",consequences:"function execution can't continue",why:t.error?.error,stack:!0}));a.steps=t.value}return(0,n.ok)(a)}catch(e){return console.error(e),(0,n.err)(f(e))}},f=e=>{let t;return e instanceof a.ZodError&&(t=e.toString()),(0,r.prettyError)({whatHappened:"Failed to parse data from executor.",consequences:"Function execution can't continue.",toFixNow:"Make sure that your API is set up to parse incoming request bodies as JSON, like body-parser for Express (https://expressjs.com/en/resources/middleware/body-parser.html).",stack:!0,why:t})};e.s(["cacheFn",()=>l,"fetchAllFnData",()=>d,"parseFnData",()=>p,"undefinedToNull",()=>u,"waterfall",()=>c])},715875,(e,t,r)=>{"use strict";t.exports=function e(t){return null===t||"object"!=typeof t||null!=t.toJSON?JSON.stringify(t):Array.isArray(t)?"["+t.reduce((t,r,n)=>t+(0===n?"":",")+e(void 0===r||"symbol"==typeof r?null:r),"")+"]":"{"+Object.keys(t).sort().reduce((r,n,s)=>{if(void 0===t[n]||"symbol"==typeof t[n])return r;let i=0===r.length?"":",";return r+i+e(n)+":"+e(t[n])},"")+"}"}},625941,e=>{"use strict";var t=e.i(172116),r=e.i(715875);let{hmac:n,sha256:s}=t.default;async function i({authToken:e,authTokenFallback:t,fetch:r,options:n,url:s}){let i=await r(s,{...n,headers:{...n?.headers,Authorization:`Bearer ${e}`}});return[401,403].includes(i.status)&&t&&(i=await r(s,{...n,headers:{...n?.headers,Authorization:`Bearer ${t}`}})),i}function a(e,t,i){let a="string"==typeof e?e:(0,r.default)(e);return n(s,t.replace(/signkey-\w+-/,"")).update(a).update(i).digest("hex")}e.s(["fetchWithAuthFallback",()=>i,"signDataWithKey",()=>a])},335820,e=>{"use strict";let t=(e=100)=>new Promise(t=>{let r=0,n=()=>{Promise.resolve().then(()=>{if(r++>e)return t();n()})};n()}),r=()=>{let e,t;return{promise:new Promise((n,s)=>{e=e=>(n(e),r()),t=e=>(s(e),r())}),resolve:e,reject:t}},n=()=>{let e=[],t=()=>{},n=async function*(){for(;;){let r=e.shift();r?yield r:await new Promise(e=>{t=e})}}(),s=r=>{let n=r.resolve,i=r.reject;return r.resolve=i=>(e.push(r.promise),t(),s(n(i))),r.reject=n=>(e.push(r.promise),t(),s(i(n))),r};return{deferred:s(r()),results:n}},s=e=>{let t,n,{promise:s,resolve:i}=r(),a=()=>(t||(t=setTimeout(()=>{i()},e)),n),o=()=>{clearTimeout(t),t=void 0};return n=Object.assign(s,{start:a,clear:o,reset:()=>(o(),a())})},i=e=>Promise.resolve().then(e),a=()=>new Promise(e=>setTimeout(e)),o=async(e,t)=>{let r=t?.maxAttempts||5,n=t?.baseDelay??100;for(let t=1;t<=r;t++)try{return await e()}catch(i){if(t>=r)throw i;let e=Math.random()*n,s=n*Math.pow(2,t-1)+e;await new Promise(e=>setTimeout(e,s))}throw Error("Max retries reached; this should be unreachable.")};e.s(["createDeferredPromise",()=>r,"createDeferredPromiseWithStack",()=>n,"createTimeoutPromise",()=>s,"resolveAfterPending",()=>t,"resolveNextTick",()=>a,"retryWithBackoff",()=>o,"runAsPromise",()=>i])},194114,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},449230,(e,t,r)=>{"use strict";var n,s,i,a;Object.defineProperty(r,"__esModule",{value:!0}),r.GeminiAiAdapter=void 0,(i=(s=n||(r.GeminiAiAdapter=n={})).HarmCategory||(s.HarmCategory={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(a=s.HarmBlockThreshold||(s.HarmBlockThreshold={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",a.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",a.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",a.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",a.BLOCK_NONE="BLOCK_NONE",a.OFF="OFF"},334902,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},504805,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},120938,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},18256,(e,t,r)=>{"use strict";var n=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),s(e.r(194114),r),s(e.r(449230),r),s(e.r(334902),r),s(e.r(504805),r),s(e.r(120938),r)},429563,(e,t,r)=>{"use strict";var n,s;Object.defineProperty(r,"__esModule",{value:!0}),r.envKeys=r.processEnv=r.allProcessEnv=void 0,r.allProcessEnv=()=>{try{return process.env}catch(e){}try{let e=Deno.env.toObject();if(e)return e}catch(e){}try{let e=Netlify.env.toObject();if(e)return e}catch(e){}return{}},r.processEnv=e=>(0,r.allProcessEnv)()[e],(s=n||(r.envKeys=n={})).OpenAiApiKey="OPENAI_API_KEY",s.GeminiApiKey="GEMINI_API_KEY",s.AnthropicApiKey="ANTHROPIC_API_KEY",s.DeepSeekApiKey="DEEPSEEK_API_KEY",s.GrokApiKey="XAI_API_KEY",s.AzureOpenAiApiKey="AZURE_OPENAI_API_KEY"},549688,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.anthropic=void 0;let n=e.r(429563);r.anthropic=e=>{var t,r;let s=e.apiKey||(0,n.processEnv)(n.envKeys.AnthropicApiKey)||"",i=e.baseUrl||"https://api.anthropic.com/v1/";i.endsWith("/")||(i+="/");let a=new URL("messages",i),o={"anthropic-version":"2023-06-01"};return((null==(t=e.betaHeaders)?void 0:t.length)||0)>0&&(o["anthropic-beta"]=(null==(r=e.betaHeaders)?void 0:r.join(","))||""),{url:a.href,authKey:s,format:"anthropic",onCall(t,r){Object.assign(r,e.defaultParameters),r.model||(r.model=e.model)},headers:o,options:e}}},103268,(e,t,r)=>{"use strict";var n=e.e&&e.e.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)0>t.indexOf(n[s])&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};Object.defineProperty(r,"__esModule",{value:!0}),r.gemini=void 0;let s=e.r(429563);r.gemini=e=>{let t=e.apiKey||(0,s.processEnv)(s.envKeys.GeminiApiKey)||"",r=e.baseUrl||"https://generativelanguage.googleapis.com/v1beta/";return r.endsWith("/")||(r+="/"),{url:new URL(`models/${e.model}:generateContent?key=${t}`,r).href,authKey:t,format:"gemini",onCall(t,r){var s;if(!e.defaultParameters)return;let i=e.defaultParameters,{generationConfig:a}=i;Object.assign(r,Object.assign(Object.assign({},n(i,["generationConfig"])),r)),a&&(r.generationConfig=Object.assign(Object.assign(Object.assign({},a),r.generationConfig||{}),{thinkingConfig:Object.assign(Object.assign({},a.thinkingConfig),(null==(s=r.generationConfig)?void 0:s.thinkingConfig)||{})}))},headers:{},options:e}}},497285,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.openai=void 0;let n=e.r(429563);r.openai=e=>{let t=e.apiKey||(0,n.processEnv)(n.envKeys.OpenAiApiKey)||"",r=e.baseUrl||"https://api.openai.com/v1/";return r.endsWith("/")||(r+="/"),{url:new URL("chat/completions",r).href,authKey:t,format:"openai-chat",onCall(t,r){Object.assign(r,e.defaultParameters),r.model||(r.model=e.model)},options:e}}},484340,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.azureOpenai=void 0;let n=e.r(429563),s=e.r(497285);r.azureOpenai=e=>{if(!e.endpoint)throw Error("Azure OpenAI endpoint is required");let t=e.apiKey||(0,n.processEnv)(n.envKeys.AzureOpenAiApiKey)||"",r=(0,s.openai)({model:e.model,apiKey:t,baseUrl:e.endpoint,defaultParameters:e.defaultParameters}),i=new URL(`openai/deployments/${e.deployment}/chat/completions`,e.endpoint);return i.searchParams.set("api-version",e.apiVersion),Object.assign(Object.assign({},r),{url:i.href,format:"azure-openai",onCall(t,r){Object.assign(r,e.defaultParameters),r.model||(r.model=e.model)},headers:{"api-key":r.authKey,"Content-Type":"application/json"},options:e})}},792419,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deepseek=void 0;let n=e.r(429563);r.deepseek=e=>{let t=e.apiKey||(0,n.processEnv)(n.envKeys.DeepSeekApiKey)||"",r=e.baseUrl||"https://api.deepseek.com/v1/";return r.endsWith("/")||(r+="/"),{url:new URL("chat/completions",r).href,authKey:t,format:"openai-chat",onCall(t,r){Object.assign(r,e.defaultParameters),r.model||(r.model=e.model)},options:e}}},80689,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.grok=void 0;let n=e.r(429563),s=e.r(497285);r.grok=e=>{let t=e.apiKey||(0,n.processEnv)(n.envKeys.GrokApiKey),r=e.baseUrl||"https://api.x.ai/v1",i=e.model,a=(0,s.openai)(Object.assign(Object.assign({},e),{apiKey:t,baseUrl:r,model:i}));return a.format="grok",a}},522841,(e,t,r)=>{"use strict";var n=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),s(e.r(549688),r),s(e.r(103268),r),s(e.r(497285),r),s(e.r(484340),r),s(e.r(792419),r),s(e.r(80689),r)},291448,(e,t,r)=>{"use strict";var n,s=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=e.e&&e.e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)},o=e.e&&e.e.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),a=0;a<r.length;a++)"default"!==r[a]&&s(t,e,r[a]);return i(t,e),t});Object.defineProperty(r,"__esModule",{value:!0}),r.models=void 0,a(e.r(18256),r),a(e.r(522841),r),r.models=o(e.r(522841))},950453,139694,e=>{"use strict";let t,r;var n=e.i(879449),s=class e{get[Symbol.toStringTag](){return e.Tag}name;init;constructor({name:e,init:t}){this.name=e,this.init=t}};(s||(s={})).Tag="Inngest.Middleware";let i=async(e,t,r,s)=>{let i=a[t];if(!i)throw Error(`No hook directions found for key "${String(t)}". This is likely a bug in the Inngest SDK.`);let o=await (await e).reduce((e,r)=>{let n=r[t];return n?[...e,n]:e},[]).reduce(async(e,t)=>[...await e,await t(r)],Promise.resolve([])),l={};for(let e of o)for(let t of Object.keys(e)){let r=[e[t]],a=l[t];a&&(r="forward"===i[t]?[a,e[t]]:[e[t],a]);let o=s[t];l[t]=(0,n.waterfall)(r,o)}for(let e of Object.keys(l))l[e]=(0,n.cacheFn)(l[e]);return l},a={onFunctionRun:{transformInput:"forward",beforeMemoization:"forward",afterMemoization:"backward",beforeExecution:"forward",afterExecution:"backward",transformOutput:"backward",beforeResponse:"forward",finished:"forward"},onSendEvent:{transformInput:"forward",transformOutput:"backward"}};e.s(["InngestMiddleware",()=>s,"getHookStack",()=>i],950453),e.s(["InngestFunction",()=>X],139694);var o=e.i(429459),l=e.i(519930),c=(e.i(322093),e.i(172259)),u=e.i(628424),h=e.i(506057),p=e.i(401608),d=e.i(335820),f=e.i(527577),g=class extends Error{cause;retryAfter;constructor(e,t,r){if(super(e),t instanceof Date)this.retryAfter=t.toISOString();else{const e=`${Math.ceil(("string"==typeof t?(0,f.default)(t):t)/1e3)}`;if(!isFinite(Number(e)))throw Error("retryAfter must be a number of milliseconds, a ms-compatible string, or a Date");this.retryAfter=e}this.cause=r?.cause}},y=class e{get[Symbol.toStringTag](){return e.Tag}constructor(e){this.opts=e}};(y||(y={})).Tag="Inngest.FunctionReference";let m=Symbol.for("inngest:als"),b=async()=>x().then(e=>e.getStore()),x=async()=>(globalThis[m]??=new Promise(async t=>{try{let{AsyncLocalStorage:r}=await e.A(5389);t(new r)}catch(e){console.warn("node:async_hooks is not supported in this runtime. Experimental async context is disabled."),t({getStore:()=>void 0,run:(e,t)=>t()})}}),globalThis[m]);var v=e.i(250585);let w=globalThis.fetch,E=(0,v.default)("inngest:fetch"),S=t=Object.assign(async(e,r)=>{let n=await b();if(!n){if(!t.fallback)throw Error("step.fetch() called outside of a function and had no fallback set");return E("step.fetch() called outside of a function; falling back to global fetch"),t.fallback(e,r)}if(n.executingStep){if(!t.fallback)throw Error(`step.fetch() called inside step "${n.executingStep.id}" and had no fallback set`);return E(`step.fetch() called inside step "${n.executingStep.id}"; falling back to global fetch`),t.fallback(e,r)}let s=new URL(e instanceof Request?e.url:e.toString());E("step.fetch() shimming request to",s.hostname);let i=await n.ctx.step[A](`step.fetch: ${s.hostname}`,e,r);return new Response(i.body,{headers:i.headers,status:i.status})},{config:e=>(Object.assign(r,e),Object.assign(t,r),t),...r={fallback:w}});e.i(454188);var k=e.i(331612),_=e.i(291448);let O=e=>"string"==typeof e?{id:e}:e,I=(e,t,r)=>{let n=(e,t)=>async(...n)=>r({args:n,matchOp:e,opts:t}),s=e=>n(({id:t,name:r},n,...s)=>{let i={...s.length?{input:s}:{},...e?{type:e}:{}};return{id:t,op:h.StepOpCode.StepPlanned,name:t,displayName:r??t,...Object.keys(i).length?{opts:i}:{}}},{fn:(e,t,...r)=>t(...r)}),i={sendEvent:n(({id:e,name:t})=>({id:e,op:h.StepOpCode.StepPlanned,name:"sendEvent",displayName:t??e,opts:{type:"step.sendEvent"}}),{fn:(r,n)=>e._send({payload:n,headers:t.options.headers})}),waitForSignal:n(({id:e,name:t},r)=>({id:e,op:h.StepOpCode.WaitForSignal,name:r.signal,displayName:t??e,opts:{signal:r.signal,timeout:(0,l.timeStr)(r.timeout),conflict:r.onConflict}})),sendSignal:n(({id:e,name:t},r)=>({id:e,op:h.StepOpCode.StepPlanned,name:"sendSignal",displayName:t??e,opts:{type:"step.sendSignal",signal:r.signal}}),{fn:(r,n)=>e._sendSignal({signal:n.signal,data:n.data,headers:t.options.headers})}),waitForEvent:n(({id:e,name:t},r)=>{let n={timeout:(0,l.timeStr)("string"==typeof r?r:r.timeout)};return"string"!=typeof r&&(r?.match?n.if=`event.${r.match} == async.${r.match}`:r?.if&&(n.if=r.if)),{id:e,op:h.StepOpCode.WaitForEvent,name:r.event,opts:n,displayName:t??e}}),run:s(),ai:{infer:n(({id:e,name:t},r)=>{let{model:n,body:s,...i}=r,a={...n};return r.model.onCall?.(a,r.body),{id:e,op:h.StepOpCode.AiGateway,displayName:t??e,opts:{type:"step.ai.infer",url:a.url,headers:a.headers,auth_key:a.authKey,format:a.format,body:s,...i}}}),wrap:s("step.ai.wrap"),models:{..._.models}},sleep:n(({id:e,name:t},r)=>{let n=(0,l.timeStr)((e=>{try{return"Temporal.Duration"===e[Symbol.toStringTag]}catch{return!1}})(r)?r.total({unit:"milliseconds"}):r);return{id:e,op:h.StepOpCode.Sleep,name:n,displayName:t??e}}),sleepUntil:n(({id:e,name:t},r)=>{try{let n=(e=>{if("string"==typeof e)return new Date(e).toISOString();if(e instanceof Date)return e.toISOString();if((e=>{try{return"Temporal.ZonedDateTime"===e[Symbol.toStringTag]}catch{return!1}})(e))return e.toInstant().toString();if((e=>{try{return"Temporal.Instant"===e[Symbol.toStringTag]}catch{return!1}})(e))return e.toString();throw TypeError("Invalid date input")})(r);return{id:e,op:h.StepOpCode.Sleep,name:n,displayName:t??e}}catch(e){throw console.warn("Invalid `Date`, date string, `Temporal.Instant`, or `Temporal.ZonedDateTime` passed to sleepUntil;",e),Error(`Invalid \`Date\`, date string, \`Temporal.Instant\`, or \`Temporal.ZonedDateTime\` passed to sleepUntil: ${r}`)}}),invoke:n(({id:t,name:r},n)=>{let s=z.extend({timeout:k.z.union([k.z.number(),k.z.string(),k.z.date()]).optional()}),i=s.extend({_type:k.z.literal("fullId").optional().default("fullId"),function:k.z.string().min(1)}).or(s.extend({_type:k.z.literal("fnInstance").optional().default("fnInstance"),function:k.z.instanceof(X)})).or(s.extend({_type:k.z.literal("refInstance").optional().default("refInstance"),function:k.z.instanceof(y)})).safeParse(n);if(!i.success)throw Error("Invalid invocation options passed to invoke; must include either a function or functionId.");let{_type:a,function:c,data:u,user:p,v:d,timeout:f}=i.data,g={payload:{data:u,user:p,v:d},function_id:"",timeout:void 0===f?void 0:(0,l.timeStr)(f)};switch(a){case"fnInstance":g.function_id=c.id(c.client.id);break;case"fullId":console.warn(`${o.logPrefix} Invoking function with \`function: string\` is deprecated and will be removed in v4.0.0; use an imported function or \`referenceFunction()\` instead. See https://innge.st/ts-referencing-functions`),g.function_id=c;break;case"refInstance":g.function_id=[c.opts.appId||e.id,c.opts.functionId].filter(Boolean).join("-")}return{id:t,op:h.StepOpCode.InvokeFunction,displayName:r??t,opts:g}}),fetch:S};return i[A]=n(({id:e,name:t},r,n)=>{let s=r instanceof Request?r.url:r.toString(),i={};return r instanceof Request?r.headers.forEach((e,t)=>{i[t]=e}):n?.headers&&new Headers(n.headers).forEach((e,t)=>{i[t]=e}),{id:e,op:h.StepOpCode.Gateway,displayName:t??e,opts:{url:s,method:n?.method??"GET",headers:i,body:n?.body}}}),i},A=Symbol.for("inngest.step.gateway"),z=k.z.object({data:k.z.record(k.z.any()).optional(),user:k.z.record(k.z.any()).optional(),v:k.z.string().optional()});var T=e.i(172116),j=e.i(715875);let{sha1:N}=T.default;var C=class extends p.InngestExecution{state;execution;userFnToRun;fnArg;constructor(e){super(e),this.userFnToRun=this.getUserFnToRun(),this.state=this.createExecutionState(),this.fnArg=this.createFnArg()}start(){return this.debug("starting V0 execution"),this.execution??=this._start().then(e=>(this.debug("result:",e),e))}async _start(){this.state.hooks=await this.initializeMiddleware();try{await this.transformInput(),await this.state.hooks.beforeMemoization?.(),0!==this.state.opStack.length||this.options.requestedRunStep||(await this.state.hooks.afterMemoization?.(),await this.state.hooks.beforeExecution?.());let e=(0,d.runAsPromise)(()=>this.userFnToRun(this.fnArg)),t=-1;do{if(t>=0){this.options.requestedRunStep||t!==this.state.opStack.length-1||(await this.state.hooks.afterMemoization?.(),await this.state.hooks.beforeExecution?.()),this.state.tickOps={};let e=this.state.opStack[t];if(this.state.currentOp=this.state.allFoundOps[e.id],!this.state.currentOp)throw new c.NonRetriableError((0,u.prettyError)({whatHappened:" Your function was stopped from running",why:"We couldn't resume your function's state because it may have changed since the run started or there are async actions in-between steps that we haven't noticed in previous executions.",consequences:"Continuing to run the function may result in unexpected behaviour, so we've stopped your function to ensure nothing unexpected happened!",toFixNow:"Ensure that your function is either entirely step-based or entirely non-step-based, by either wrapping all asynchronous logic in `step.run()` calls or by removing all `step.*()` calls.",otherwise:"For more information on why step functions work in this manner, see https://www.inngest.com/docs/functions/multi-step#gotchas",stack:!0,code:u.ErrCode.NON_DETERMINISTIC_FUNCTION}));this.state.currentOp.fulfilled=!0,void 0!==e.data?this.state.currentOp.resolve(e.data):this.state.currentOp.reject(e.error)}await (0,d.resolveAfterPending)(),this.state.reset(),t++}while(t<this.state.opStack.length)await this.state.hooks.afterMemoization?.();let r=Object.values(this.state.tickOps).map(R),n=this.options.requestedRunStep||this.getEarlyExecRunStep(r);if(n){let e=this.state.allFoundOps[n],t=e?.fn;if(!t)throw Error(`Bad stack; executor requesting to run unknown step "${n}"`);let r={...R(e),op:h.StepOpCode.Step};await this.state.hooks.beforeExecution?.(),this.state.executingStep=!0;let{type:s,...i}=await (0,d.runAsPromise)(t).finally(()=>{this.state.executingStep=!1}).catch(async e=>await this.transformOutput({error:e},r)).then(async e=>(await this.state.hooks?.afterExecution?.(),await this.transformOutput({data:e},r)));return{type:"step-ran",ctx:this.fnArg,ops:this.ops,step:{...r,...i}}}if(!r.length){let t=await Promise.race([e.then(e=>({type:"complete",data:e})),(0,d.resolveNextTick)().then(()=>({type:"incomplete"}))]);if("complete"===t.type){if(await this.state.hooks.afterExecution?.(),Object.values(this.state.allFoundOps).every(e=>e.fulfilled))return await this.transformOutput({data:t.data})}else if(this.state.hasUsedTools){if(!Object.values(this.state.allFoundOps).some(e=>!1===e.fulfilled))throw new c.NonRetriableError((0,u.functionStoppedRunningErr)(u.ErrCode.ASYNC_DETECTED_AFTER_MEMOIZATION))}else{this.state.nonStepFnDetected=!0;let t=await e;return await this.state.hooks.afterExecution?.(),await this.transformOutput({data:t})}}return await this.state.hooks.afterExecution?.(),{type:"steps-found",ctx:this.fnArg,ops:this.ops,steps:r}}catch(e){return await this.transformOutput({error:e})}finally{await this.state.hooks.beforeResponse?.()}}async initializeMiddleware(){let e=this.options.data;return await i(this.options.fn.middleware,"onFunctionRun",{ctx:e,fn:this.options.fn,steps:Object.values(this.options.stepState),reqArgs:this.options.reqArgs},{transformInput:(e,t)=>({ctx:{...e.ctx,...t?.ctx},fn:this.options.fn,steps:e.steps.map((e,r)=>({...e,...t?.steps?.[r]})),reqArgs:e.reqArgs}),transformOutput:(e,t)=>({result:{...e.result,...t?.result},step:e.step})})}createExecutionState(){let e={allFoundOps:{},tickOps:{},tickOpHashes:{},currentOp:void 0,hasUsedTools:!1,reset:()=>{e.tickOpHashes={},e.allFoundOps={...e.allFoundOps,...e.tickOps}},nonStepFnDetected:!1,executingStep:!1,opStack:this.options.stepCompletionOrder.reduce((e,t)=>{let r=this.options.stepState[t];return r?[...e,r]:e},[])};return e}get ops(){return Object.fromEntries(Object.entries(this.state.allFoundOps).map(([e,t])=>[e,{id:t.id,rawArgs:t.rawArgs,data:t.data,error:t.error,fulfilled:t.fulfilled,seen:!0}]))}getUserFnToRun(){if(!this.options.isFailureHandler)return this.options.fn.fn;if(!this.options.fn.onFailureFn)throw Error("Cannot find function `onFailure` handler");return this.options.fn.onFailureFn}createFnArg(){this.state.tickOps=this.state.allFoundOps;let e=e=>{let t={parent:this.state.currentOp?.id??null,op:e.op,name:e.name,opts:e.op===h.StepOpCode.StepPlanned?null:e.opts??null},r=P.hashData(t),n=this.state.tickOpHashes[r]=(this.state.tickOpHashes[r]??-1)+1;return{...e,id:P.hashData({pos:n,...t})}},t=({args:t,matchOp:r,opts:n})=>{if(this.state.nonStepFnDetected)throw new c.NonRetriableError((0,u.functionStoppedRunningErr)(u.ErrCode.STEP_USED_AFTER_ASYNC));if(this.state.executingStep)throw new c.NonRetriableError((0,u.prettyError)({whatHappened:"Your function was stopped from running",why:"We detected that you have nested `step.*` tooling.",consequences:"Nesting `step.*` tooling is not supported.",stack:!0,toFixNow:"Make sure you're not using `step.*` tooling inside of other `step.*` tooling. If you need to compose steps together, you can create a new async function and call it from within your step function, or use promise chaining.",otherwise:"For more information on step functions with Inngest, see https://www.inngest.com/docs/functions/multi-step",code:u.ErrCode.NESTING_STEPS}));this.state.hasUsedTools=!0;let s=e(r(O(t[0]),...t.slice(1)));return new Promise((e,r)=>{this.state.tickOps[s.id]={...s,...n?.fn?{fn:()=>n.fn?.(...t)}:{},rawArgs:t,resolve:e,reject:r,fulfilled:!1}})},r=I(this.options.client,this,t),n={...this.options.data,step:r};if(this.options.isFailureHandler){let e=k.z.object({error:h.jsonErrorSchema}).parse(n.event?.data);n={...n,error:(0,u.deserializeError)(e.error)}}return this.options.transformCtx?.(n)??n}async transformInput(){let e=await this.state.hooks?.transformInput?.({ctx:{...this.fnArg},steps:Object.values(this.options.stepState),fn:this.options.fn,reqArgs:this.options.reqArgs});e?.ctx&&(this.fnArg=e.ctx),e?.steps&&(this.state.opStack=[...e.steps])}getEarlyExecRunStep(e){if(1!==e.length)return;let t=e[0];if(t&&t.op===h.StepOpCode.StepPlanned)return t.id}async transformOutput(e,t){let r={...e};void 0!==r.error&&(r.data=(0,u.serializeError)(r.error));let s=await this.state.hooks?.transformOutput?.({result:{...r},step:t}),{data:i,error:a}={...r,...s?.result};if(t||await this.state.hooks?.finished?.({result:{...void 0!==a?{error:a}:{data:i}}}),void 0!==a){let e=!(a instanceof c.NonRetriableError);e&&a instanceof g&&(e=a.retryAfter);let t=(0,u.serializeError)(a);return{type:"function-rejected",ctx:this.fnArg,ops:this.ops,error:t,retriable:e}}return{type:"function-resolved",ctx:this.fnArg,ops:this.ops,data:(0,n.undefinedToNull)(i)}}};let R=e=>({op:e.op,id:e.id,name:e.name,opts:e.opts}),P={hashData:e=>N().update((0,j.default)(e)).digest("hex")};var F=e.i(693757),M=p;let K=new WeakMap;var U=class extends Error{cause;constructor(e,t){const r=h.jsonErrorSchema.parse(t);super(r.message),this.stepId=e,this.name=r.name,this.stepId=e,this.stack=r.stack??void 0,this.cause=r.cause?(0,u.deserializeError)(r.cause,!0):void 0}},B=e.i(274812);let{sha1:D}=T.default;var H=class extends M.InngestExecution{state;fnArg;checkpointHandlers;timeoutDuration=1e4;execution;userFnToRun;timeout;constructor(e){super(e),this.userFnToRun=this.getUserFnToRun(),this.state=this.createExecutionState(),this.fnArg=this.createFnArg(),this.checkpointHandlers=this.createCheckpointHandlers(),this.initializeTimer(this.state),this.debug("created new V1 execution for run;",this.options.requestedRunStep?`wanting to run step "${this.options.requestedRunStep}"`:"discovering steps"),this.debug("existing state keys:",Object.keys(this.state.stepState))}start(){if(!this.execution){this.debug("starting V1 execution");let e=B.trace.getTracer("inngest",F.version);this.execution=x().then(t=>t.run({app:this.options.client,ctx:this.fnArg},async()=>e.startActiveSpan("inngest.execution",e=>(K.get(this.options.client)?.declareStartingSpan({span:e,runId:this.options.runId,traceparent:this.options.headers[o.headerKeys.TraceParent],tracestate:this.options.headers[o.headerKeys.TraceState]}),this._start().then(e=>(this.debug("result:",e),e)).finally(()=>{e.end()})))))}return this.execution}async _start(){try{let e=this.getCheckpointHandler("");for await(let t of(this.state.hooks=await this.initializeMiddleware(),await this.startExecution(),this.state.loop)){await e(t);let r=await this.getCheckpointHandler(t.type)(t);if(r)return r}}catch(e){return await this.transformOutput({error:e})}finally{this.state.loop.return(),await this.state.hooks?.beforeResponse?.()}throw Error("Core loop finished without returning a value")}createCheckpointHandlers(){return{"":e=>{this.debug("checkpoint:",e)},"function-resolved":async e=>await this.transformOutput({data:e.data}),"function-rejected":async e=>await this.transformOutput({error:e.error}),"steps-found":async({steps:e})=>{let t=await this.tryExecuteStep(e);if(t){let e=await this.transformOutput(t);if("function-resolved"===e.type)return{type:"step-ran",ctx:e.ctx,ops:e.ops,step:$.hashOp({...t,data:e.data})};if("function-rejected"===e.type){let r=$.hashOp({...t,error:e.error});if(t.op===h.StepOpCode.StepFailed){let t=(0,u.serializeError)(e.error);r.data={__serialized:!0,name:t.name,message:t.message,stack:""}}return{type:"step-ran",ctx:e.ctx,ops:e.ops,retriable:e.retriable,step:r}}return e}let r=await this.filterNewSteps(Array.from(this.state.steps.values()));if(r)return{type:"steps-found",ctx:this.fnArg,ops:this.ops,steps:r}},"step-not-found":({step:e})=>({type:"step-not-found",ctx:this.fnArg,ops:this.ops,step:e})}}getCheckpointHandler(e){return this.checkpointHandlers[e]}async tryExecuteStep(e){let t=this.options.requestedRunStep||this.getEarlyExecRunStep(e);if(!t)return;let r=e.find(e=>e.hashedId===t&&e.fn);if(r)return await this.executeStep(r);this.timeout?.reset()}getEarlyExecRunStep(e){if(this.options.disableImmediateExecution)return;let t=e.filter(e=>!e.fulfilled);if(1!==t.length)return;let r=t[0];if(r&&r.op===h.StepOpCode.StepPlanned)return r.hashedId}async filterNewSteps(e){if(this.options.requestedRunStep)return;let t=e.filter(e=>!e.fulfilled);if(!t.length)return;let r=0;for(let t of e)t.fulfilled&&r++;this.state.stepsToFulfill!==r&&console.warn((0,u.prettyError)({type:"warn",whatHappened:"Function may be indeterminate",why:"We found new steps before seeing all previous steps, which may indicate that the function is non-deterministic.",consequences:"This may cause unexpected behaviour as Inngest executes your function.",reassurance:"This is expected if a function is updated in the middle of a run, but may indicate a bug if not."})),await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.(),await this.state.hooks?.afterExecution?.();let n=t.map(e=>({displayName:e.displayName,op:e.op,id:e.hashedId,name:e.name,opts:e.opts}));return await this.transformNewSteps(n)}async transformNewSteps(e){return Promise.all(e.map(async e=>{if(e.op!==h.StepOpCode.InvokeFunction)return e;let t=await (await i(this.options.fn.middleware,"onSendEvent",void 0,{transformInput:(e,t)=>({...e,...t}),transformOutput:(e,t)=>({result:{...e.result,...t?.result}})})).transformInput?.({payloads:[{...e.opts?.payload??{},name:o.internalEvents.FunctionInvoked}]}),r=z.parse(t?.payloads?.[0]??{});return{...e,opts:{...e.opts,payload:{...e.opts?.payload??{},...r}}}}))}async executeStep({id:e,name:t,opts:r,fn:n,displayName:s}){this.timeout?.clear(),await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.();let i={id:e,op:h.StepOpCode.StepRun,name:t,opts:r,displayName:s};this.state.executingStep=i;let a=await b();return a&&(a.executingStep={id:e,name:s}),this.debug(`executing step "${e}"`),(0,d.runAsPromise)(n).finally(async()=>{a&&delete a.executingStep,await this.state.hooks?.afterExecution?.()}).then(e=>({...i,data:e})).catch(e=>{let t=!0;return(e instanceof c.NonRetriableError?t=!1:this.fnArg.maxAttempts&&this.fnArg?.maxAttempts-1===this.fnArg.attempt&&(t=!1),t)?{...i,op:h.StepOpCode.StepError,error:e}:{...i,op:h.StepOpCode.StepFailed,error:e}})}async startExecution(){await this.transformInput(),this.timeout?.start(),await this.state.hooks?.beforeMemoization?.(),this.state.allStateUsed()&&(await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.()),(0,d.runAsPromise)(()=>this.userFnToRun(this.fnArg)).finally(async()=>{await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.(),await this.state.hooks?.afterExecution?.()}).then(e=>{this.state.setCheckpoint({type:"function-resolved",data:e})}).catch(e=>{this.state.setCheckpoint({type:"function-rejected",error:e})})}async transformInput(){let e=await this.state.hooks?.transformInput?.({ctx:{...this.fnArg},steps:Object.values(this.state.stepState),fn:this.options.fn,reqArgs:this.options.reqArgs});e?.ctx&&(this.fnArg=e.ctx),e?.steps&&(this.state.stepState=Object.fromEntries(e.steps.map(e=>[e.id,e])))}async transformOutput(e){let t={...e},r=!!this.state.executingStep,s=await this.state.hooks?.transformOutput?.({result:{...t},step:this.state.executingStep}),{data:i,error:a}={...t,...s?.result};if(r||await this.state.hooks?.finished?.({result:{...void 0!==a?{error:a}:{data:i}}}),void 0!==a){let e=!(a instanceof c.NonRetriableError||a instanceof U&&a===this.state.recentlyRejectedStepError);e&&a instanceof g&&(e=a.retryAfter);let t=(0,u.minifyPrettyError)((0,u.serializeError)(a));return{type:"function-rejected",ctx:this.fnArg,ops:this.ops,error:t,retriable:e}}return{type:"function-resolved",ctx:this.fnArg,ops:this.ops,data:(0,n.undefinedToNull)(i)}}createExecutionState(){let e=(0,d.createDeferredPromiseWithStack)(),t=e.deferred.resolve,r=e.results,n=async function*(e){try{for(;;){let e=(await r.next()).value;e&&(yield e)}}finally{e?.()}}(()=>{this.timeout?.clear(),r.return()}),s=Object.keys(this.options.stepState).length;return{stepState:this.options.stepState,stepsToFulfill:s,steps:new Map,loop:n,hasSteps:!!s,stepCompletionOrder:[...this.options.stepCompletionOrder],remainingStepsToBeSeen:new Set(this.options.stepCompletionOrder),setCheckpoint:e=>{({resolve:t}=t(e))},allStateUsed:()=>0===this.state.remainingStepsToBeSeen.size}}get ops(){return Object.fromEntries(this.state.steps)}createFnArg(){let e=this.createStepTools(),t={...this.options.data,step:e};if(this.options.isFailureHandler){let e=k.z.object({error:h.jsonErrorSchema}).parse(t.event?.data);t={...t,error:(0,u.deserializeError)(e.error)}}return this.options.transformCtx?.(t)??t}createStepTools(){let e,t,r=new Map,n=new Map,s=new Map,i=this.state.stepCompletionOrder.slice(),a=!1,o=0,l=e=>{a||this.state.steps.has(e)&&!r.has(e)&&(a=!0,console.warn((0,u.prettyError)({type:"warn",whatHappened:"We detected that you have multiple steps with the same ID.",code:u.ErrCode.AUTOMATIC_PARALLEL_INDEXING,why:`This can happen if you're using the same ID for multiple steps across different chains of parallel work. We found the issue with step "${e}".`,reassurance:"Your function is still running, though it may exhibit unexpected behaviour.",consequences:"Using the same IDs across parallel chains of work can cause unexpected behaviour.",toFixNow:"We recommend using a unique ID for each step, especially those happening in parallel."})))},c=()=>{let s;e||(++o>=10?(o=0,s=new Promise(e=>setTimeout(e))):s=(0,d.resolveAfterPending)(),e=s.then(()=>t).then(()=>{e=void 0;for(let e=0;e<i.length;e++){let t=i[e];if(t&&n.get(t)?.handle()){i.splice(e,1),n.delete(t),c();return}}let t=[...r.values()];r.clear(),n.clear(),this.state.setCheckpoint({type:"steps-found",steps:t})}))},p=async({args:e,matchOp:i,opts:a})=>{let o;await t;let p=i(O(e[0]),...e.slice(1));if(this.state.executingStep&&console.warn((0,u.prettyError)({whatHappened:`We detected that you have nested \`step.*\` tooling in \`${p.displayName??p.id}\``,consequences:"Nesting `step.*` tooling is not supported.",type:"warn",reassurance:"It's possible to see this warning if steps are separated by regular asynchronous calls, which is fine.",stack:!0,toFixNow:"Make sure you're not using `step.*` tooling inside of other `step.*` tooling. If you need to compose steps together, you can create a new async function and call it from within your step function, or use promise chaining.",code:u.ErrCode.NESTING_STEPS})),this.state.steps.has(p.id)){let e=p.id;l(e);let t=s.get(e)??1;for(let r=t;;r++){let t=e+":"+r;if(!this.state.steps.has(t)){s.set(e,r+1),p.id=t;break}}}let{promise:f,resolve:g,reject:y}=(0,d.createDeferredPromise)(),m=$.hashId(p.id),b=this.state.stepState[m],x=!1;b&&(b.seen=!0,this.state.remainingStepsToBeSeen.delete(m),void 0===b.input&&(x=!0));let v=[...e];if(void 0!==b?.input&&Array.isArray(b.input))switch(p.op){case h.StepOpCode.StepPlanned:v=[...e.slice(0,2),...b.input],o={input:[...b.input]};break;case h.StepOpCode.AiGateway:o={body:{..."object"==typeof p.opts?.body?{...p.opts.body}:{},...b.input[0]}}}let w={...p,opts:{...p.opts,...o},rawArgs:v,hashedId:m,input:b?.input,fn:a?.fn?()=>a.fn?.(...v):void 0,promise:f,fulfilled:x,hasStepState:!!b,displayName:p.displayName??p.id,handled:!1,handle:()=>!w.handled&&(w.handled=!0,x&&b&&(b.fulfilled=!0,Promise.all([b.data,b.error,b.input]).then(()=>{void 0!==b.data?g(b.data):(this.state.recentlyRejectedStepError=new U(p.id,b.error),y(this.state.recentlyRejectedStepError))})),!0)};return this.state.steps.set(p.id,w),this.state.hasSteps=!0,r.set(w.id,w),n.set(w.hashedId,w),c(),!t&&this.state.allStateUsed()&&await (t=(async()=>{await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.()})()),f};return I(this.options.client,this,p)}getUserFnToRun(){if(!this.options.isFailureHandler)return this.options.fn.fn;if(!this.options.fn.onFailureFn)throw Error("Cannot find function `onFailure` handler");return this.options.fn.onFailureFn}initializeTimer(e){this.options.requestedRunStep&&(this.timeout=(0,d.createTimeoutPromise)(this.timeoutDuration),this.timeout.then(async()=>{await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.(),await this.state.hooks?.afterExecution?.(),e.setCheckpoint({type:"step-not-found",step:{id:this.options.requestedRunStep,op:h.StepOpCode.StepNotFound}})}))}async initializeMiddleware(){let e=this.options.data;return await i(this.options.fn.middleware,"onFunctionRun",{ctx:e,fn:this.options.fn,steps:Object.values(this.options.stepState),reqArgs:this.options.reqArgs},{transformInput:(e,t)=>({ctx:{...e.ctx,...t?.ctx},fn:this.options.fn,steps:e.steps.map((e,r)=>({...e,...t?.steps?.[r]})),reqArgs:e.reqArgs}),transformOutput:(e,t)=>({result:{...e.result,...t?.result},step:e.step})})}};let V=e=>D().update(e).digest("hex"),$={hashOp:e=>({...e,id:V(e.id)}),hashId:V};var L=p;let{sha1:q}=T.default;var G=class extends L.InngestExecution{state;fnArg;checkpointHandlers;timeoutDuration=1e4;execution;userFnToRun;timeout;constructor(e){super(e),this.userFnToRun=this.getUserFnToRun(),this.state=this.createExecutionState(),this.fnArg=this.createFnArg(),this.checkpointHandlers=this.createCheckpointHandlers(),this.initializeTimer(this.state),this.debug("created new V2 execution for run;",this.options.requestedRunStep?`wanting to run step "${this.options.requestedRunStep}"`:"discovering steps"),this.debug("existing state keys:",Object.keys(this.state.stepState))}start(){if(!this.execution){this.debug("starting V2 execution");let e=B.trace.getTracer("inngest",F.version);this.execution=x().then(t=>t.run({app:this.options.client,ctx:this.fnArg},async()=>e.startActiveSpan("inngest.execution",e=>(K.get(this.options.client)?.declareStartingSpan({span:e,runId:this.options.runId,traceparent:this.options.headers[o.headerKeys.TraceParent],tracestate:this.options.headers[o.headerKeys.TraceState]}),this._start().then(e=>(this.debug("result:",e),e)).finally(()=>{e.end()})))))}return this.execution}async _start(){try{let e=this.getCheckpointHandler("");for await(let t of(this.state.hooks=await this.initializeMiddleware(),await this.startExecution(),this.state.loop)){await e(t);let r=await this.getCheckpointHandler(t.type)(t);if(r)return r}}catch(e){return await this.transformOutput({error:e})}finally{this.state.loop.return(),await this.state.hooks?.beforeResponse?.()}throw Error("Core loop finished without returning a value")}createCheckpointHandlers(){return{"":e=>{this.debug("checkpoint:",e)},"function-resolved":async e=>await this.transformOutput({data:e.data}),"function-rejected":async e=>await this.transformOutput({error:e.error}),"steps-found":async({steps:e})=>{let t=await this.tryExecuteStep(e);if(t){let e=await this.transformOutput(t);if("function-resolved"===e.type)return{type:"step-ran",ctx:e.ctx,ops:e.ops,step:Y.hashOp({...t,data:e.data})};if("function-rejected"===e.type){let r=Y.hashOp({...t,error:e.error});if(t.op===h.StepOpCode.StepFailed){let t=(0,u.serializeError)(e.error);r.data={__serialized:!0,name:t.name,message:t.message,stack:""}}return{type:"step-ran",ctx:e.ctx,ops:e.ops,retriable:e.retriable,step:r}}return e}let r=await this.filterNewSteps(Array.from(this.state.steps.values()));if(r)return{type:"steps-found",ctx:this.fnArg,ops:this.ops,steps:r}},"step-not-found":({step:e})=>({type:"step-not-found",ctx:this.fnArg,ops:this.ops,step:e})}}getCheckpointHandler(e){return this.checkpointHandlers[e]}async tryExecuteStep(e){let t=this.options.requestedRunStep||this.getEarlyExecRunStep(e);if(!t)return;let r=e.find(e=>e.hashedId===t&&e.fn);if(r)return await this.executeStep(r);this.timeout?.reset()}getEarlyExecRunStep(e){if(this.options.disableImmediateExecution)return;let t=e.filter(e=>!e.fulfilled);if(1!==t.length)return;let r=t[0];if(r&&r.op===h.StepOpCode.StepPlanned)return r.hashedId}async filterNewSteps(e){if(this.options.requestedRunStep)return;let t=e.filter(e=>!e.fulfilled);if(!t.length)return;let r=0;for(let t of e)t.fulfilled&&r++;this.state.stepsToFulfill!==r&&console.warn((0,u.prettyError)({type:"warn",whatHappened:"Function may be indeterminate",why:"We found new steps before seeing all previous steps, which may indicate that the function is non-deterministic.",consequences:"This may cause unexpected behaviour as Inngest executes your function.",reassurance:"This is expected if a function is updated in the middle of a run, but may indicate a bug if not."})),await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.(),await this.state.hooks?.afterExecution?.();let n=t.map(e=>({displayName:e.displayName,op:e.op,id:e.hashedId,name:e.name,opts:e.opts}));return await this.transformNewSteps(n)}async transformNewSteps(e){return Promise.all(e.map(async e=>{if(e.op!==h.StepOpCode.InvokeFunction)return e;let t=await (await i(this.options.fn.middleware,"onSendEvent",void 0,{transformInput:(e,t)=>({...e,...t}),transformOutput:(e,t)=>({result:{...e.result,...t?.result}})})).transformInput?.({payloads:[{...e.opts?.payload??{},name:o.internalEvents.FunctionInvoked}]}),r=z.parse(t?.payloads?.[0]??{});return{...e,opts:{...e.opts,payload:{...e.opts?.payload??{},...r}}}}))}async executeStep({id:e,name:t,opts:r,fn:n,displayName:s}){this.timeout?.clear(),await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.();let i={id:e,op:h.StepOpCode.StepRun,name:t,opts:r,displayName:s};this.state.executingStep=i;let a=await b();return a&&(a.executingStep={id:e,name:s}),this.debug(`executing step "${e}"`),(0,d.runAsPromise)(n).finally(async()=>{a&&delete a.executingStep,await this.state.hooks?.afterExecution?.()}).then(e=>({...i,data:e})).catch(e=>{let t=!0;return(e instanceof c.NonRetriableError?t=!1:this.fnArg.maxAttempts&&this.fnArg?.maxAttempts-1===this.fnArg.attempt&&(t=!1),t)?{...i,op:h.StepOpCode.StepError,error:e}:{...i,op:h.StepOpCode.StepFailed,error:e}})}async startExecution(){await this.transformInput(),this.timeout?.start(),await this.state.hooks?.beforeMemoization?.(),this.state.allStateUsed()&&(await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.()),(0,d.runAsPromise)(()=>this.userFnToRun(this.fnArg)).finally(async()=>{await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.(),await this.state.hooks?.afterExecution?.()}).then(e=>{this.state.setCheckpoint({type:"function-resolved",data:e})}).catch(e=>{this.state.setCheckpoint({type:"function-rejected",error:e})})}async transformInput(){let e=await this.state.hooks?.transformInput?.({ctx:{...this.fnArg},steps:Object.values(this.state.stepState),fn:this.options.fn,reqArgs:this.options.reqArgs});e?.ctx&&(this.fnArg=e.ctx),e?.steps&&(this.state.stepState=Object.fromEntries(e.steps.map(e=>[e.id,e])))}async transformOutput(e){let t={...e},r=!!this.state.executingStep,s=await this.state.hooks?.transformOutput?.({result:{...t},step:this.state.executingStep}),{data:i,error:a}={...t,...s?.result};if(r||await this.state.hooks?.finished?.({result:{...void 0!==a?{error:a}:{data:i}}}),void 0!==a){let e=!(a instanceof c.NonRetriableError||a instanceof U&&a===this.state.recentlyRejectedStepError);e&&a instanceof g&&(e=a.retryAfter);let t=(0,u.minifyPrettyError)((0,u.serializeError)(a));return{type:"function-rejected",ctx:this.fnArg,ops:this.ops,error:t,retriable:e}}return{type:"function-resolved",ctx:this.fnArg,ops:this.ops,data:(0,n.undefinedToNull)(i)}}createExecutionState(){let e=(0,d.createDeferredPromiseWithStack)(),t=e.deferred.resolve,r=e.results,n=async function*(e){try{for(;;){let e=(await r.next()).value;e&&(yield e)}}finally{e?.()}}(()=>{this.timeout?.clear(),r.return()}),s=Object.keys(this.options.stepState).length;return{stepState:this.options.stepState,stepsToFulfill:s,steps:new Map,loop:n,hasSteps:!!s,stepCompletionOrder:[...this.options.stepCompletionOrder],remainingStepsToBeSeen:new Set(this.options.stepCompletionOrder),setCheckpoint:e=>{({resolve:t}=t(e))},allStateUsed:()=>0===this.state.remainingStepsToBeSeen.size}}get ops(){return Object.fromEntries(this.state.steps)}createFnArg(){let e=this.createStepTools(),t={...this.options.data,step:e};if(this.options.isFailureHandler){let e=k.z.object({error:h.jsonErrorSchema}).parse(t.event?.data);t={...t,error:(0,u.deserializeError)(e.error)}}return this.options.transformCtx?.(t)??t}createStepTools(){let e,t,r=new Map,n=new Map,s=new Map,i=()=>{e||(e=new Promise(e=>setImmediate(e)).then(()=>t).then(()=>{for(let[t,s]of(e=void 0,n))s.handle()&&(n.delete(t),s.fulfilled&&r.delete(s.id));if(r.size){let e=[...r.values()];r.clear(),this.state.setCheckpoint({type:"steps-found",steps:e});return}}))},a=async({args:e,matchOp:a,opts:o})=>{let l;await t;let c=a(O(e[0]),...e.slice(1));if(this.state.executingStep&&console.warn((0,u.prettyError)({whatHappened:`We detected that you have nested \`step.*\` tooling in \`${c.displayName??c.id}\``,consequences:"Nesting `step.*` tooling is not supported.",type:"warn",reassurance:"It's possible to see this warning if steps are separated by regular asynchronous calls, which is fine.",stack:!0,toFixNow:"Make sure you're not using `step.*` tooling inside of other `step.*` tooling. If you need to compose steps together, you can create a new async function and call it from within your step function, or use promise chaining.",code:u.ErrCode.NESTING_STEPS})),this.state.steps.has(c.id)){let e=c.id,t=s.get(e)??1;for(let r=t;;r++){let t=e+":"+r;if(!this.state.steps.has(t)){s.set(e,r+1),c.id=t;break}}}let{promise:p,resolve:f,reject:g}=(0,d.createDeferredPromise)(),y=Y.hashId(c.id),m=this.state.stepState[y],b=!1;m&&(m.seen=!0,this.state.remainingStepsToBeSeen.delete(y),void 0===m.input&&(b=!0));let x=[...e];if(void 0!==m?.input&&Array.isArray(m.input))switch(c.op){case h.StepOpCode.StepPlanned:x=[...e.slice(0,2),...m.input],l={input:[...m.input]};break;case h.StepOpCode.AiGateway:l={body:{..."object"==typeof c.opts?.body?{...c.opts.body}:{},...m.input[0]}}}let v={...c,opts:{...c.opts,...l},rawArgs:x,hashedId:y,input:m?.input,fn:o?.fn?()=>o.fn?.(...x):void 0,promise:p,fulfilled:b,hasStepState:!!m,displayName:c.displayName??c.id,handled:!1,handle:()=>!v.handled&&(v.handled=!0,b&&m&&(m.fulfilled=!0,Promise.all([m.data,m.error,m.input]).then(()=>{void 0!==m.data?f(m.data):(this.state.recentlyRejectedStepError=new U(c.id,m.error),g(this.state.recentlyRejectedStepError))})),!0)};return this.state.steps.set(c.id,v),this.state.hasSteps=!0,r.set(v.id,v),n.set(v.hashedId,v),i(),!t&&this.state.allStateUsed()&&await (t=(async()=>{await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.()})()),p};return I(this.options.client,this,a)}getUserFnToRun(){if(!this.options.isFailureHandler)return this.options.fn.fn;if(!this.options.fn.onFailureFn)throw Error("Cannot find function `onFailure` handler");return this.options.fn.onFailureFn}initializeTimer(e){this.options.requestedRunStep&&(this.timeout=(0,d.createTimeoutPromise)(this.timeoutDuration),this.timeout.then(async()=>{await this.state.hooks?.afterMemoization?.(),await this.state.hooks?.beforeExecution?.(),await this.state.hooks?.afterExecution?.(),e.setCheckpoint({type:"step-not-found",step:{id:this.options.requestedRunStep,op:h.StepOpCode.StepNotFound}})}))}async initializeMiddleware(){let e=this.options.data;return await i(this.options.fn.middleware,"onFunctionRun",{ctx:e,fn:this.options.fn,steps:Object.values(this.options.stepState),reqArgs:this.options.reqArgs},{transformInput:(e,t)=>({ctx:{...e.ctx,...t?.ctx},fn:this.options.fn,steps:e.steps.map((e,r)=>({...e,...t?.steps?.[r]})),reqArgs:e.reqArgs}),transformOutput:(e,t)=>({result:{...e.result,...t?.result},step:e.step})})}};let W=e=>q().update(e).digest("hex"),Y={hashOp:e=>({...e,id:W(e.id)}),hashId:W};var X=class e{static stepId="step";static failureSuffix="-failure";get[Symbol.toStringTag](){return e.Tag}opts;fn;onFailureFn;client;middleware;constructor(e,t,r){this.client=e,this.opts=t,this.fn=r,this.onFailureFn=this.opts.onFailure,this.middleware=this.client.initializeMiddleware(this.opts.middleware,{registerInput:{fn:this},prefixStack:this.client.middleware})}id(e){return[e,this.opts.id].filter(Boolean).join("-")}get absoluteId(){return this.id(this.client.id)}get name(){return this.opts.name||this.id()}get description(){return this.opts.description}getConfig({baseUrl:t,appPrefix:r,isConnect:n}){let s=this.id(r),i=new URL(t.href);i.searchParams.set(o.queryKeys.FnId,s),i.searchParams.set(o.queryKeys.StepId,e.stepId);let{retries:a,cancelOn:c,idempotency:u,batchEvents:h,rateLimit:p,throttle:d,concurrency:f,debounce:g,timeouts:y,priority:m,singleton:b}=this.opts,x={id:s,name:this.name,triggers:(this.opts.triggers??[]).map(e=>"event"in e?{event:e.event,expression:e.if}:{cron:e.cron}),steps:{[e.stepId]:{id:e.stepId,name:e.stepId,runtime:{type:n?"ws":"http",url:i.href},retries:void 0===a?void 0:{attempts:a}}},idempotency:u,batchEvents:h,rateLimit:p,throttle:d,concurrency:f,debounce:g,priority:m,timeouts:y,singleton:b};c&&(x.cancel=c.map(({event:e,timeout:t,if:r,match:n})=>{let s={event:e};return t&&(s.timeout=(0,l.timeStr)(t)),n?s.if=`event.${n} == async.${n}`:r&&(s.if=r),s},[]));let v=[x];if(this.onFailureFn){let t=`${x.id}${e.failureSuffix}`,r=`${x.name??x.id} (failure)`,n=new URL(i.href);n.searchParams.set(o.queryKeys.FnId,t),v.push({id:t,name:r,triggers:[{event:o.internalEvents.FunctionFailed,expression:`event.data.function_id == '${s}'`}],steps:{[e.stepId]:{id:e.stepId,name:e.stepId,runtime:{type:"http",url:n.href},retries:{attempts:1}}}})}return v}createExecution(e){let t={fn:this,...e.partialOptions};return({[o.ExecutionVersion.V2]:()=>new G(t),[o.ExecutionVersion.V1]:()=>new H(t),[o.ExecutionVersion.V0]:()=>new C(t)})[e.version]()}shouldOptimizeParallelism(){return this.opts.optimizeParallelism??this.client.options.optimizeParallelism??!1}};(X||(X={})).Tag="Inngest.Function"},187070,e=>{"use strict";var t=e.i(429459),r=e.i(519930),n=e.i(58880),s=e.i(84853),i=e.i(628424),a=e.i(506057),o=e.i(335820),l=e.i(950453),c=e.i(139694),u=e.i(949783),h=e.i(625941);e.i(454188);var p=e.i(331612);let d=p.z.object({jwt:p.z.string()}),f=p.z.object({data:p.z.object({run_id:p.z.string().min(1)})});var g=class{apiBaseUrl;signingKey;signingKeyFallback;fetch;mode;constructor({baseUrl:e,signingKey:t,signingKeyFallback:r,fetch:n,mode:s}){this.apiBaseUrl=e,this.signingKey=t,this.signingKeyFallback=r,this.fetch=n,this.mode=s}get hashedKey(){return(0,r.hashSigningKey)(this.signingKey)}get hashedFallbackKey(){if(this.signingKeyFallback)return(0,r.hashSigningKey)(this.signingKeyFallback)}setSigningKey(e){"string"==typeof e&&""===this.signingKey&&(this.signingKey=e)}setSigningKeyFallback(e){"string"!=typeof e||this.signingKeyFallback||(this.signingKeyFallback=e)}async getTargetUrl(e){if(this.apiBaseUrl)return new URL(e,this.apiBaseUrl);let r=new URL(e,t.defaultInngestApiBaseUrl);return this.mode.isDev&&this.mode.isInferred&&!this.apiBaseUrl&&await (0,s.devServerAvailable)(t.defaultDevServerHost,this.fetch)&&(r=new URL(e,t.defaultDevServerHost)),r}async getRunSteps(e,t){return(0,h.fetchWithAuthFallback)({authToken:this.hashedKey,authTokenFallback:this.hashedFallbackKey,fetch:this.fetch,url:await this.getTargetUrl(`/v0/runs/${e}/actions`)}).then(async e=>{let r=await e.json();return e.ok?(0,a.ok)(u.stepsSchemas[t].parse(r)):(0,a.err)(u.errorSchema.parse(r))}).catch(e=>(0,a.err)({error:(0,i.getErrorMessage)(e,"Unknown error retrieving step data"),status:500}))}async getRunBatch(e){return(0,h.fetchWithAuthFallback)({authToken:this.hashedKey,authTokenFallback:this.hashedFallbackKey,fetch:this.fetch,url:await this.getTargetUrl(`/v0/runs/${e}/batch`)}).then(async e=>{let t=await e.json();return e.ok?(0,a.ok)(u.batchSchema.parse(t)):(0,a.err)(u.errorSchema.parse(t))}).catch(e=>(0,a.err)({error:(0,i.getErrorMessage)(e,"Unknown error retrieving event batch"),status:500}))}async publish(e,t){let r=t instanceof ReadableStream,n=await this.getTargetUrl("/v1/realtime/publish");return n.searchParams.set("channel",e.channel||""),e.runId&&n.searchParams.set("run_id",e.runId),e.topics.forEach(e=>{n.searchParams.append("topic",e)}),(0,h.fetchWithAuthFallback)({authToken:this.hashedKey,authTokenFallback:this.hashedFallbackKey,fetch:this.fetch,url:n,options:{method:"POST",body:r||"string"==typeof t?t:JSON.stringify(t),headers:{"Content-Type":r?"text/stream":"application/json"},...r?{duplex:"half"}:{}}}).then(e=>{if(!e.ok)throw Error(`Failed to publish event: ${e.status} ${e.statusText}`);return(0,a.ok)(void 0)}).catch(e=>(0,a.err)({error:(0,i.getErrorMessage)(e,"Unknown error publishing event"),status:500}))}async sendSignal(e,t){let r=await this.getTargetUrl("/v1/signals"),n={signal:e.signal,data:e.data};return(0,h.fetchWithAuthFallback)({authToken:this.hashedKey,authTokenFallback:this.hashedFallbackKey,fetch:this.fetch,url:r,options:{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json",...t?.headers}}}).then(async e=>{let t;if(404===e.status)return(0,a.ok)({runId:void 0});let r=e.clone();try{t=await e.json()}catch{return(0,a.err)({error:`Failed to send signal: ${e.status} ${e.statusText} - ${await r.text()}`,status:e.status})}if(!e.ok)try{return(0,a.err)(u.errorSchema.parse(t))}catch{return(0,a.err)({error:`Failed to send signal: ${e.status} ${e.statusText} - ${await e.text()}`,status:e.status})}let n=f.safeParse(t);return n.success?(0,a.ok)({runId:n.data.data.run_id}):(0,a.err)({error:`Successfully sent signal, but response parsing failed: ${e.status} ${e.statusText} - ${await r.text()}`,status:e.status})}).catch(e=>(0,a.err)({error:(0,i.getErrorMessage)(e,"Unknown error sending signal"),status:500}))}async getSubscriptionToken(e,t){let r=await this.getTargetUrl("/v1/realtime/token"),n=t.map(t=>({channel:e,name:t,kind:"run"}));return(0,h.fetchWithAuthFallback)({authToken:this.hashedKey,authTokenFallback:this.hashedFallbackKey,fetch:this.fetch,url:r,options:{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}}).then(async e=>{if(!e.ok)throw Error(`Failed to get subscription token: ${e.status} ${e.statusText} - ${await e.text()}`);return d.parse(await e.json()).jwt}).catch(e=>{throw Error((0,i.getErrorMessage)(e,"Unknown error getting subscription token"))})}},y=class{info(...e){console.info(...e)}warn(...e){console.warn(...e)}error(...e){console.error(...e)}debug(...e){console.debug(...e)}},m=class{logger;enabled=!1;constructor(e){return this.logger=e,new Proxy(this,{get:(e,t,r)=>t in e?Reflect.get(e,t,r):Reflect.get(e.logger,t,r)})}info(...e){this.enabled&&this.logger.info(...e)}warn(...e){this.enabled&&this.logger.warn(...e)}error(...e){this.enabled&&this.logger.error(...e)}debug(...e){this.enabled&&"function"==typeof this.logger.debug&&this.logger.debug(...e)}enable(){this.enabled=!0}disable(){this.enabled=!1}async flush(){this.logger.constructor.name!==y.name&&await new Promise(e=>{setTimeout(()=>e(null),1e3)})}},b=class e{get[Symbol.toStringTag](){return e.Tag}id;options;eventKey="";_apiBaseUrl;_eventBaseUrl;inngestApi;sendEventUrl=new URL(`e/${this.eventKey}`,t.defaultInngestEventBaseUrl);headers;fetch;logger;localFns=[];middleware;_mode;schemas;_appVersion;get apiBaseUrl(){return this._apiBaseUrl}get eventBaseUrl(){return this._eventBaseUrl}get env(){return this.headers[t.headerKeys.Environment]??null}get appVersion(){return this._appVersion}constructor(e){this.options=e;const{id:r,fetch:s,logger:i=new y,middleware:a,isDev:o,schemas:l,appVersion:c}=this.options;if(!r)throw Error("An `id` must be passed to create an Inngest instance.");this.id=r,this._mode=(0,n.getMode)({explicitMode:"boolean"==typeof o?o?"dev":"cloud":void 0}),this.fetch=(0,n.getFetch)(s),this.inngestApi=new g({baseUrl:this.apiBaseUrl,signingKey:(0,n.processEnv)(t.envKeys.InngestSigningKey)||"",signingKeyFallback:(0,n.processEnv)(t.envKeys.InngestSigningKeyFallback),fetch:this.fetch,mode:this.mode}),this.schemas=l,this.loadModeEnvVars(),this.logger=i,this.middleware=this.initializeMiddleware([...x,...a||[]]),this._appVersion=c}get ready(){return this.middleware.then(()=>{})}setEnvVars(e=(0,n.allProcessEnv)()){return this.mode=(0,n.getMode)({env:e,client:this}),this}loadModeEnvVars(){this._apiBaseUrl=this.options.baseUrl||this.mode.env[t.envKeys.InngestApiBaseUrl]||this.mode.env[t.envKeys.InngestBaseUrl]||this.mode.getExplicitUrl(t.defaultInngestApiBaseUrl),this._eventBaseUrl=this.options.baseUrl||this.mode.env[t.envKeys.InngestEventApiBaseUrl]||this.mode.env[t.envKeys.InngestBaseUrl]||this.mode.getExplicitUrl(t.defaultInngestEventBaseUrl),this.setEventKey(this.options.eventKey||this.mode.env[t.envKeys.InngestEventKey]||""),this.headers=(0,n.inngestHeaders)({inngestEnv:this.options.env,env:this.mode.env}),this.inngestApi.mode=this.mode,this.inngestApi.apiBaseUrl=this._apiBaseUrl}async initializeMiddleware(e=[],t){let r=await (t?.prefixStack??[]),n=e.reduce(async(e,r)=>[...await e,await r.init({client:this,...t?.registerInput})],Promise.resolve([]));return[...r,...await n]}get mode(){return this._mode}set mode(e){this._mode=e,this.loadModeEnvVars()}async getResponseError(e,t,r="Unknown error"){let n=r;if("Unknown error"===n)switch(e.status){case 401:n="Event key Not Found";break;case 400:n="Cannot process event payload";break;case 403:n="Forbidden";break;case 404:n="Event key not found";break;case 406:n=`${JSON.stringify(await t)}`;break;case 409:case 412:n="Event transformation failed";break;case 413:n="Event payload too large";break;case 500:n="Internal server error";break;default:try{n=await e.text()}catch(e){n=`${JSON.stringify(await t)}`}}return Error(`Inngest API Error: ${e.status} ${n}`)}setEventKey(e){this.eventKey=e||t.dummyEventKey,this.sendEventUrl=new URL(`e/${this.eventKey}`,this.eventBaseUrl||t.defaultInngestEventBaseUrl)}eventKeySet(){return!!this.eventKey&&this.eventKey!==t.dummyEventKey}async sendSignal({signal:e,data:r,env:n}){let s={...n?{[t.headerKeys.Environment]:n}:{}};return this._sendSignal({signal:e,data:r,headers:s})}async _sendSignal({signal:e,data:t,headers:r}){let n=await this.inngestApi.sendSignal({signal:e,data:t},{...this.headers,...r});if(n.ok)return n.value;throw Error(`Failed to send signal: ${n.error?.error||"Unknown error"}`)}async send(e,r){let n={...r?.env?{[t.headerKeys.Environment]:r.env}:{}};return this._send({payload:e,headers:n})}async _send({payload:e,headers:n}){let c=new Date().getTime(),u=5;try{let e=function(e){let t=new Uint8Array(10),{crypto:r}=globalThis;if(!r)throw Error("missing crypto module");if(!r.getRandomValues)throw Error("missing crypto.getRandomValues");return r.getRandomValues(t),t}(0),r=Buffer.from(e).toString("base64");n={...n,[t.headerKeys.EventIdSeed]:`${c},${r}`}}catch(t){let e="Event-sending retries disabled";t instanceof Error&&(e+=`: ${t.message}`),console.debug(e),u=1}let h=await (0,l.getHookStack)(this.middleware,"onSendEvent",void 0,{transformInput:(e,t)=>({...e,...t}),transformOutput:(e,t)=>({result:{...e.result,...t?.result}})}),p=Array.isArray(e)?e:e?[e]:[],d=await h.transformInput?.({payloads:[...p]});d?.payloads&&(p=[...d.payloads]);let f=async e=>{let t=await h.transformOutput?.(e);return{...e.result,...t?.result}};if(!(p=p.map(e=>({...e,id:e.id,ts:e.ts||c,data:e.data||{}}))).length)return console.warn((0,i.prettyError)({type:"warn",whatHappened:"`inngest.send()` called with no events",reassurance:"This is not an error, but you may not have intended to do this.",consequences:"The returned promise will resolve, but no events have been sent to Inngest.",stack:!0})),await f({result:{ids:[]}});let g=this.sendEventUrl.href;if(this.mode.isCloud&&!this.eventKeySet())throw Error((0,i.prettyError)({whatHappened:"Failed to send event",consequences:"Your event or events were not sent to Inngest.",why:"We couldn't find an event key to use to send events to Inngest.",toFixNow:i.fixEventKeyMissingSteps}));this.mode.isDev&&this.mode.isInferred&&!this.eventBaseUrl&&await (0,s.devServerAvailable)(t.defaultDevServerHost,this.fetch)&&(g=(0,s.devServerUrl)(t.defaultDevServerHost,`e/${this.eventKey}`).href);let y=await (0,o.retryWithBackoff)(async()=>{let e,t,s=await this.fetch(g,{method:"POST",body:(0,r.stringify)(p),headers:{...this.headers,...n}});try{e=await s.json(),t=await a.sendEventResponseSchema.parseAsync(e)}catch(t){throw await this.getResponseError(s,e)}if(200!==t.status||t.error)throw await this.getResponseError(s,e,t.error);return t},{maxAttempts:u,baseDelay:100});return await f({result:{ids:y.ids}})}createFunction=(e,t,r)=>{let n=this._createFunction(e,t,r);return this.localFns.push(n),n};get funcs(){return this.localFns}_createFunction=(e,t,r)=>{let n=this.sanitizeOptions(e),s=this.sanitizeTriggers(t);return new c.InngestFunction(this,{...n,triggers:s},r)};sanitizeOptions(e){return(Object.hasOwn(e,"fns")&&console.warn(`${t.logPrefix} InngestFunction: \`fns\` option has been deprecated in v3; use \`middleware\` instead. See https://www.inngest.com/docs/sdk/migration`),"string"==typeof e)?(console.warn(`${t.logPrefix} InngestFunction: Creating a function with a string as the first argument has been deprecated in v3; pass an object instead. See https://www.inngest.com/docs/sdk/migration`),{id:e}):e}sanitizeTriggers(e){return"string"==typeof e?(console.warn(`${t.logPrefix} InngestFunction: Creating a function with a string as the second argument has been deprecated in v3; pass an object instead. See https://www.inngest.com/docs/sdk/migration`),[{event:e}]):Array.isArray(e)?e:[e]}};let x=[new l.InngestMiddleware({name:"Inngest: Logger",init:({client:e})=>({onFunctionRun(t){let{ctx:r}=t,n={runID:r.runId,eventName:r.event.name,functionName:t.fn.name},s=e.logger;try{"child"in s&&(s=s.child(n))}catch(e){console.error('failed to create "childLogger" with error: ',e)}let i=new m(s);return{transformInput:()=>({ctx:{logger:i}}),beforeExecution(){i.enable()},transformOutput({result:{error:e}}){e&&i.error(e)},async beforeResponse(){await i.flush()}}}})})];(b||(b={})).Tag="Inngest.App";let v=new b({id:"gymtext",name:"GymText - AI Fitness Coaching"});e.s(["inngest",0,v],187070)}];

//# sourceMappingURL=_78f2c359._.js.map