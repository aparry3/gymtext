module.exports=[63723,(e,t,r)=>{function i(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=i,i.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},i.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},i.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r)if(!this._cachedTimeouts)return!1;else this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},r),this._options.unref&&this._timer.unref(),!0},i.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},i.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},i.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},i.prototype.start=i.prototype.try,i.prototype.errors=function(){return this._errors},i.prototype.attempts=function(){return this._attempts},i.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,i=0;i<this._errors.length;i++){var n=this._errors[i],a=n.message,s=(e[a]||0)+1;e[a]=s,s>=r&&(t=n,r=s)}return t}},210978,(e,t,r)=>{var i=e.r(63723);r.operation=function(e){return new i(r.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},r.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var i=[],n=0;n<t.retries;n++)i.push(this.createTimeout(n,t));return e&&e.forever&&!i.length&&i.push(this.createTimeout(n,t)),i.sort(function(e,t){return e-t}),i},r.createTimeout=function(e,t){var r=Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},r.wrap=function(e,t,i){if(t instanceof Array&&(i=t,t=null),!i)for(var n in i=[],e)"function"==typeof e[n]&&i.push(n);for(var a=0;a<i.length;a++){var s=i[a],o=e[s];e[s]=(function(i){var n=r.operation(t),a=Array.prototype.slice.call(arguments,1),s=a.pop();a.push(function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),s.apply(this,arguments))}),n.attempt(function(){i.apply(e,a)})}).bind(e,o),e[s].options=t}}},61347,(e,t,r)=>{t.exports=e.r(210978)},990242,(e,t,r)=>{"use strict";let i=e.r(61347),n=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class a extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let s=(e,t)=>new Promise((r,s)=>{t={onFailedAttempt:()=>{},retries:10,...t};let o=i.operation(t);o.attempt(async i=>{try{r(await e(i))}catch(e){if(!(e instanceof Error))return void s(TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof a)o.stop(),s(e.originalError);else{let r;if(e instanceof TypeError&&(r=e.message,!n.includes(r)))o.stop(),s(e);else{let r;r=t.retries-(i-1),e.attemptNumber=i,e.retriesLeft=r;try{await t.onFailedAttempt(e)}catch(e){s(e);return}o.retry(e)||s(o.mainError())}}}})});t.exports=s,t.exports.default=s,t.exports.AbortError=a},625946,(e,t,r)=>{"use strict";var i=Object.prototype.hasOwnProperty,n="~";function a(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,a){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new s(r,i||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(n=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,s=Array(a);i<a;i++)s[i]=r[i].fn;return s},u.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,i,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,a),!0;case 6:return c.fn.call(c.context,t,r,i,a,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||l(this,a);else{for(var o=0,u=[],c=s.length;o<c;o++)(s[o].fn!==t||i&&!s[o].once||r&&s[o].context!==r)&&u.push(s[o]);u.length?this._events[a]=1===u.length?u[0]:u:l(this,a)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},404034,(e,t,r)=>{"use strict";t.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},613828,(e,t,r)=>{"use strict";let i=e.r(404034);class n extends Error{constructor(e){super(e),this.name="TimeoutError"}}let a=(e,t,r)=>new Promise((a,s)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void a(e);let o=setTimeout(()=>{if("function"==typeof r){try{a(r())}catch(e){s(e)}return}let i="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,o=r instanceof Error?r:new n(i);"function"==typeof e.cancel&&e.cancel(),s(o)},t);i(e.then(a,s),()=>{clearTimeout(o)})});t.exports=a,t.exports.default=a,t.exports.TimeoutError=n},800654,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){let i=0,n=e.length;for(;n>0;){let a=n/2|0,s=i+a;0>=r(e[s],t)?(i=++s,n-=a+1):n=a}return i}},830289,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let i=e.r(800654);r.default=class{constructor(){this._queue=[]}enqueue(e,t){let r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);let n=i.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(n,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},559176,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let i=e.r(625946),n=e.r(613828),a=e.r(830289),s=()=>{},o=new n.TimeoutError;r.default=class extends i{constructor(e){var t,r,i,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:a.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!=(r=null==(t=e.intervalCap)?void 0:t.toString())?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!=(n=null==(i=e.interval)?void 0:i.toString())?n:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,i)=>{let a=async()=>{this._pendingCount++,this._intervalCount++;try{let a=void 0===this._timeout&&void 0===t.timeout?e():n.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&i(o)});r(await a)}catch(e){i(e)}this._next()};this._queue.enqueue(a,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},870069,(e,t,r)=>{"use strict";t.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||0x1fffffffffffff,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},850317,(e,t,r)=>{"use strict";t.exports="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}},34212,(e,t,r)=>{"use strict";let{MAX_SAFE_COMPONENT_LENGTH:i,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=e.r(870069),s=e.r(850317),o=(r=t.exports={}).re=[],l=r.safeRe=[],u=r.src=[],c=r.safeSrc=[],d=r.t={},h=0,p="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",a],[p,n]],m=(e,t,r)=>{let i=(e=>{for(let[t,r]of f)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),n=h++;s(e,n,t),d[e]=n,u[n]=t,c[n]=i,o[n]=new RegExp(t,r?"g":void 0),l[n]=new RegExp(i,r?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),m("MAINVERSION",`(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${u[d.PRERELEASEIDENTIFIER]}(?:\\.${u[d.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${u[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[d.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${p}+`),m("BUILD",`(?:\\+(${u[d.BUILDIDENTIFIER]}(?:\\.${u[d.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${u[d.MAINVERSION]}${u[d.PRERELEASE]}?${u[d.BUILD]}?`),m("FULL",`^${u[d.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${u[d.MAINVERSIONLOOSE]}${u[d.PRERELEASELOOSE]}?${u[d.BUILD]}?`),m("LOOSE",`^${u[d.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${u[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${u[d.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:${u[d.PRERELEASE]})?${u[d.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:${u[d.PRERELEASELOOSE]})?${u[d.BUILD]}?)?)?`),m("XRANGE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?`),m("COERCE",`${u[d.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",u[d.COERCEPLAIN]+`(?:${u[d.PRERELEASE]})?`+`(?:${u[d.BUILD]})?`+"(?:$|[^\\d])"),m("COERCERTL",u[d.COERCE],!0),m("COERCERTLFULL",u[d.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${u[d.LONETILDE]}\\s+`,!0),r.tildeTrimReplace="$1~",m("TILDE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${u[d.LONECARET]}\\s+`,!0),r.caretTrimReplace="$1^",m("CARET",`^${u[d.LONECARET]}${u[d.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${u[d.LONECARET]}${u[d.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${u[d.GTLT]}\\s*(${u[d.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]}|${u[d.XRANGEPLAIN]})`,!0),r.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${u[d.XRANGEPLAIN]})\\s+-\\s+(${u[d.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${u[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[d.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},975164,(e,t,r)=>{"use strict";let i=Object.freeze({loose:!0}),n=Object.freeze({});t.exports=e=>e?"object"!=typeof e?i:e:n},850471,(e,t,r)=>{"use strict";let i=/^[0-9]+$/,n=(e,t)=>{if("number"==typeof e&&"number"==typeof t)return e===t?0:e<t?-1:1;let r=i.test(e),n=i.test(t);return r&&n&&(e*=1,t*=1),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1};t.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},328184,(e,t,r)=>{"use strict";let i=e.r(850317),{MAX_LENGTH:n,MAX_SAFE_INTEGER:a}=e.r(870069),{safeRe:s,t:o}=e.r(34212),l=e.r(975164),{compareIdentifiers:u}=e.r(850471);class c{constructor(e,t){if(t=l(t),e instanceof c)if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;else e=e.version;else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>n)throw TypeError(`version is longer than ${n} characters`);i("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?s[o.LOOSE]:s[o.FULL]);if(!r)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>a||this.major<0)throw TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<a)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(i("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return(e instanceof c||(e=new c(e,this.options)),this.major<e.major)?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:+(this.patch>e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],n=e.prerelease[t];if(i("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return -1;else if(r===n)continue;else return u(r,n)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{let r=this.build[t],n=e.build[t];if(i("build compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return -1;else if(r===n)continue;else return u(r,n)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw Error("invalid increment argument: identifier is empty");if(t){let e=`-${t}`.match(this.options.loose?s[o.PRERELEASELOOSE]:s[o.PRERELEASE]);if(!e||e[1]!==t)throw Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=+!!Number(r);if(0===this.prerelease.length)this.prerelease=[e];else{let i=this.prerelease.length;for(;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);if(-1===i){if(t===this.prerelease.join(".")&&!1===r)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let i=[t,e];!1===r&&(i=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}t.exports=c},9343,(e,t,r)=>{"use strict";let i=e.r(328184);t.exports=(e,t,r=!1)=>{if(e instanceof i)return e;try{return new i(e,t)}catch(e){if(!r)return null;throw e}}},425999,(e,t,r)=>{"use strict";let i=e.r(9343);t.exports=(e,t)=>{let r=i(e,t);return r?r.version:null}},805121,(e,t,r)=>{"use strict";let i=e.r(9343);t.exports=(e,t)=>{let r=i(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},49192,(e,t,r)=>{"use strict";let i=e.r(328184);t.exports=(e,t,r,n,a)=>{"string"==typeof r&&(a=n,n=r,r=void 0);try{return new i(e instanceof i?e.version:e,r).inc(t,n,a).version}catch(e){return null}}},96203,(e,t,r)=>{"use strict";let i=e.r(9343);t.exports=(e,t)=>{let r=i(e,null,!0),n=i(t,null,!0),a=r.compare(n);if(0===a)return null;let s=a>0,o=s?r:n,l=s?n:r,u=!!o.prerelease.length;if(l.prerelease.length&&!u){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}let c=u?"pre":"";return r.major!==n.major?c+"major":r.minor!==n.minor?c+"minor":r.patch!==n.patch?c+"patch":"prerelease"}},965543,(e,t,r)=>{"use strict";let i=e.r(328184);t.exports=(e,t)=>new i(e,t).major},532148,(e,t,r)=>{"use strict";let i=e.r(328184);t.exports=(e,t)=>new i(e,t).minor},884240,(e,t,r)=>{"use strict";let i=e.r(328184);t.exports=(e,t)=>new i(e,t).patch},877585,(e,t,r)=>{"use strict";let i=e.r(9343);t.exports=(e,t)=>{let r=i(e,t);return r&&r.prerelease.length?r.prerelease:null}},237893,(e,t,r)=>{"use strict";let i=e.r(328184);t.exports=(e,t,r)=>new i(e,r).compare(new i(t,r))},865009,(e,t,r)=>{"use strict";let i=e.r(237893);t.exports=(e,t,r)=>i(t,e,r)},324281,(e,t,r)=>{"use strict";let i=e.r(237893);t.exports=(e,t)=>i(e,t,!0)},511014,(e,t,r)=>{"use strict";let i=e.r(328184);t.exports=(e,t,r)=>{let n=new i(e,r),a=new i(t,r);return n.compare(a)||n.compareBuild(a)}},910978,(e,t,r)=>{"use strict";let i=e.r(511014);t.exports=(e,t)=>e.sort((e,r)=>i(e,r,t))},399648,(e,t,r)=>{"use strict";let i=e.r(511014);t.exports=(e,t)=>e.sort((e,r)=>i(r,e,t))},162430,(e,t,r)=>{"use strict";let i=e.r(237893);t.exports=(e,t,r)=>i(e,t,r)>0},547386,(e,t,r)=>{"use strict";let i=e.r(237893);t.exports=(e,t,r)=>0>i(e,t,r)},837352,(e,t,r)=>{"use strict";let i=e.r(237893);t.exports=(e,t,r)=>0===i(e,t,r)},98476,(e,t,r)=>{"use strict";let i=e.r(237893);t.exports=(e,t,r)=>0!==i(e,t,r)},458048,(e,t,r)=>{"use strict";let i=e.r(237893);t.exports=(e,t,r)=>i(e,t,r)>=0},247011,(e,t,r)=>{"use strict";let i=e.r(237893);t.exports=(e,t,r)=>0>=i(e,t,r)},316522,(e,t,r)=>{"use strict";let i=e.r(837352),n=e.r(98476),a=e.r(162430),s=e.r(458048),o=e.r(547386),l=e.r(247011);t.exports=(e,t,r,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return i(e,r,u);case"!=":return n(e,r,u);case">":return a(e,r,u);case">=":return s(e,r,u);case"<":return o(e,r,u);case"<=":return l(e,r,u);default:throw TypeError(`Invalid operator: ${t}`)}}},316318,(e,t,r)=>{"use strict";let i=e.r(328184),n=e.r(9343),{safeRe:a,t:s}=e.r(34212);t.exports=(e,t)=>{if(e instanceof i)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let i,n=t.includePrerelease?a[s.COERCERTLFULL]:a[s.COERCERTL];for(;(i=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&i.index+i[0].length===r.index+r[0].length||(r=i),n.lastIndex=i.index+i[1].length+i[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?a[s.COERCEFULL]:a[s.COERCE]);if(null===r)return null;let o=r[2],l=r[3]||"0",u=r[4]||"0",c=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return n(`${o}.${l}.${u}${c}${d}`,t)}},942548,(e,t,r)=>{"use strict";t.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},420824,(e,t,r)=>{"use strict";let i=/\s+/g;class n{constructor(e,t){if(t=s(t),e instanceof n)if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;else return new n(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(i," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!y(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(const e of this.set)if(1===e.length&&_(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&m)|(this.options.loose&&g))+":"+e,r=a.get(t);if(r)return r;let i=this.options.loose,n=i?c[d.HYPHENRANGELOOSE]:c[d.HYPHENRANGE];l("hyphen replace",e=e.replace(n,$(this.options.includePrerelease))),l("comparator trim",e=e.replace(c[d.COMPARATORTRIM],h)),l("tilde trim",e=e.replace(c[d.TILDETRIM],p)),l("caret trim",e=e.replace(c[d.CARETTRIM],f));let s=e.split(" ").map(e=>b(e,this.options)).join(" ").split(/\s+/).map(e=>x(e,this.options));i&&(s=s.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(c[d.COMPARATORLOOSE])))),l("range list",s);let u=new Map;for(let e of s.map(e=>new o(e,this.options))){if(y(e))return[e];u.set(e.value,e)}u.size>1&&u.has("")&&u.delete("");let _=[...u.values()];return a.set(t,_),_}intersects(e,t){if(!(e instanceof n))throw TypeError("a Range is required");return this.set.some(r=>v(r,t)&&e.set.some(e=>v(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(C(this.set[t],e,this.options))return!0;return!1}}t.exports=n;let a=new(e.r(942548)),s=e.r(975164),o=e.r(864987),l=e.r(850317),u=e.r(328184),{safeRe:c,t:d,comparatorTrimReplace:h,tildeTrimReplace:p,caretTrimReplace:f}=e.r(34212),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:g}=e.r(870069),y=e=>"<0.0.0-0"===e.value,_=e=>""===e.value,v=(e,t)=>{let r=!0,i=e.slice(),n=i.pop();for(;r&&i.length;)r=i.every(e=>n.intersects(e,t)),n=i.pop();return r},b=(e,t)=>(l("comp",e=e.replace(c[d.BUILD],""),t),l("caret",e=S(e,t)),l("tildes",e=E(e,t)),l("xrange",e=O(e,t)),l("stars",e=k(e,t)),e),w=e=>!e||"x"===e.toLowerCase()||"*"===e,E=(e,t)=>e.trim().split(/\s+/).map(e=>T(e,t)).join(" "),T=(e,t)=>{let r=t.loose?c[d.TILDELOOSE]:c[d.TILDE];return e.replace(r,(t,r,i,n,a)=>{let s;return l("tilde",e,t,r,i,n,a),w(r)?s="":w(i)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:w(n)?s=`>=${r}.${i}.0 <${r}.${+i+1}.0-0`:a?(l("replaceTilde pr",a),s=`>=${r}.${i}.${n}-${a} <${r}.${+i+1}.0-0`):s=`>=${r}.${i}.${n} <${r}.${+i+1}.0-0`,l("tilde return",s),s})},S=(e,t)=>e.trim().split(/\s+/).map(e=>I(e,t)).join(" "),I=(e,t)=>{l("caret",e,t);let r=t.loose?c[d.CARETLOOSE]:c[d.CARET],i=t.includePrerelease?"-0":"";return e.replace(r,(t,r,n,a,s)=>{let o;return l("caret",e,t,r,n,a,s),w(r)?o="":w(n)?o=`>=${r}.0.0${i} <${+r+1}.0.0-0`:w(a)?o="0"===r?`>=${r}.${n}.0${i} <${r}.${+n+1}.0-0`:`>=${r}.${n}.0${i} <${+r+1}.0.0-0`:s?(l("replaceCaret pr",s),o="0"===r?"0"===n?`>=${r}.${n}.${a}-${s} <${r}.${n}.${+a+1}-0`:`>=${r}.${n}.${a}-${s} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${a}-${s} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===n?`>=${r}.${n}.${a}${i} <${r}.${n}.${+a+1}-0`:`>=${r}.${n}.${a}${i} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${a} <${+r+1}.0.0-0`),l("caret return",o),o})},O=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>A(e,t)).join(" ")),A=(e,t)=>{e=e.trim();let r=t.loose?c[d.XRANGELOOSE]:c[d.XRANGE];return e.replace(r,(r,i,n,a,s,o)=>{l("xRange",e,r,i,n,a,s,o);let u=w(n),c=u||w(a),d=c||w(s);return"="===i&&d&&(i=""),o=t.includePrerelease?"-0":"",u?r=">"===i||"<"===i?"<0.0.0-0":"*":i&&d?(c&&(a=0),s=0,">"===i?(i=">=",c?(n=+n+1,a=0):a=+a+1,s=0):"<="===i&&(i="<",c?n=+n+1:a=+a+1),"<"===i&&(o="-0"),r=`${i+n}.${a}.${s}${o}`):c?r=`>=${n}.0.0${o} <${+n+1}.0.0-0`:d&&(r=`>=${n}.${a}.0${o} <${n}.${+a+1}.0-0`),l("xRange return",r),r})},k=(e,t)=>(l("replaceStars",e,t),e.trim().replace(c[d.STAR],"")),x=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),$=e=>(t,r,i,n,a,s,o,l,u,c,d,h)=>(r=w(i)?"":w(n)?`>=${i}.0.0${e?"-0":""}`:w(a)?`>=${i}.${n}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`,l=w(u)?"":w(c)?`<${+u+1}.0.0-0`:w(d)?`<${u}.${+c+1}.0-0`:h?`<=${u}.${c}.${d}-${h}`:e?`<${u}.${c}.${+d+1}-0`:`<=${l}`,`${r} ${l}`.trim()),C=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){let i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}},864987,(e,t,r)=>{"use strict";let i=Symbol("SemVer ANY");class n{static get ANY(){return i}constructor(e,t){if(t=a(t),e instanceof n)if(!!t.loose===e.loose)return e;else e=e.value;u("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===i?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){let t=this.options.loose?s[o.COMPARATORLOOSE]:s[o.COMPARATOR],r=e.match(t);if(!r)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new c(r[2],this.options.loose):this.semver=i}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===i||e===i)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=a(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}t.exports=n;let a=e.r(975164),{safeRe:s,t:o}=e.r(34212),l=e.r(316522),u=e.r(850317),c=e.r(328184),d=e.r(420824)},825144,(e,t,r)=>{"use strict";let i=e.r(420824);t.exports=(e,t,r)=>{try{t=new i(t,r)}catch(e){return!1}return t.test(e)}},286587,(e,t,r)=>{"use strict";let i=e.r(420824);t.exports=(e,t)=>new i(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},465326,(e,t,r)=>{"use strict";let i=e.r(328184),n=e.r(420824);t.exports=(e,t,r)=>{let a=null,s=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!a||-1===s.compare(e))&&(s=new i(a=e,r))}),a}},717015,(e,t,r)=>{"use strict";let i=e.r(328184),n=e.r(420824);t.exports=(e,t,r)=>{let a=null,s=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!a||1===s.compare(e))&&(s=new i(a=e,r))}),a}},53114,(e,t,r)=>{"use strict";let i=e.r(328184),n=e.r(420824),a=e.r(162430);t.exports=(e,t)=>{e=new n(e,t);let r=new i("0.0.0");if(e.test(r)||(r=new i("0.0.0-0"),e.test(r)))return r;r=null;for(let t=0;t<e.set.length;++t){let n=e.set[t],s=null;n.forEach(e=>{let t=new i(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!s||a(t,s))&&(s=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),s&&(!r||a(r,s))&&(r=s)}return r&&e.test(r)?r:null}},982614,(e,t,r)=>{"use strict";let i=e.r(420824);t.exports=(e,t)=>{try{return new i(e,t).range||"*"}catch(e){return null}}},308879,(e,t,r)=>{"use strict";let i=e.r(328184),n=e.r(864987),{ANY:a}=n,s=e.r(420824),o=e.r(825144),l=e.r(162430),u=e.r(547386),c=e.r(247011),d=e.r(458048);t.exports=(e,t,r,h)=>{let p,f,m,g,y;switch(e=new i(e,h),t=new s(t,h),r){case">":p=l,f=c,m=u,g=">",y=">=";break;case"<":p=u,f=d,m=l,g="<",y="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,h))return!1;for(let r=0;r<t.set.length;++r){let i=t.set[r],s=null,o=null;if(i.forEach(e=>{e.semver===a&&(e=new n(">=0.0.0")),s=s||e,o=o||e,p(e.semver,s.semver,h)?s=e:m(e.semver,o.semver,h)&&(o=e)}),s.operator===g||s.operator===y||(!o.operator||o.operator===g)&&f(e,o.semver)||o.operator===y&&m(e,o.semver))return!1}return!0}},480101,(e,t,r)=>{"use strict";let i=e.r(308879);t.exports=(e,t,r)=>i(e,t,">",r)},97221,(e,t,r)=>{"use strict";let i=e.r(308879);t.exports=(e,t,r)=>i(e,t,"<",r)},737737,(e,t,r)=>{"use strict";let i=e.r(420824);t.exports=(e,t,r)=>(e=new i(e,r),t=new i(t,r),e.intersects(t,r))},424782,(e,t,r)=>{"use strict";let i=e.r(825144),n=e.r(237893);t.exports=(e,t,r)=>{let a=[],s=null,o=null,l=e.sort((e,t)=>n(e,t,r));for(let e of l)i(e,t,r)?(o=e,s||(s=e)):(o&&a.push([s,o]),o=null,s=null);s&&a.push([s,null]);let u=[];for(let[e,t]of a)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");let c=u.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},169998,(e,t,r)=>{"use strict";let i=e.r(420824),n=e.r(864987),{ANY:a}=n,s=e.r(825144),o=e.r(237893),l=[new n(">=0.0.0-0")],u=[new n(">=0.0.0")],c=(e,t,r)=>{let i,n,c,p,f,m,g;if(e===t)return!0;if(1===e.length&&e[0].semver===a)if(1===t.length&&t[0].semver===a)return!0;else e=r.includePrerelease?l:u;if(1===t.length&&t[0].semver===a)if(r.includePrerelease)return!0;else t=u;let y=new Set;for(let t of e)">"===t.operator||">="===t.operator?i=d(i,t,r):"<"===t.operator||"<="===t.operator?n=h(n,t,r):y.add(t.semver);if(y.size>1)return null;if(i&&n&&((c=o(i.semver,n.semver,r))>0||0===c&&(">="!==i.operator||"<="!==n.operator)))return null;for(let e of y){if(i&&!s(e,String(i),r)||n&&!s(e,String(n),r))return null;for(let i of t)if(!s(e,String(i),r))return!1;return!0}let _=!!n&&!r.includePrerelease&&!!n.semver.prerelease.length&&n.semver,v=!!i&&!r.includePrerelease&&!!i.semver.prerelease.length&&i.semver;for(let e of(_&&1===_.prerelease.length&&"<"===n.operator&&0===_.prerelease[0]&&(_=!1),t)){if(g=g||">"===e.operator||">="===e.operator,m=m||"<"===e.operator||"<="===e.operator,i){if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),">"===e.operator||">="===e.operator){if((p=d(i,e,r))===e&&p!==i)return!1}else if(">="===i.operator&&!s(i.semver,String(e),r))return!1}if(n){if(_&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===_.major&&e.semver.minor===_.minor&&e.semver.patch===_.patch&&(_=!1),"<"===e.operator||"<="===e.operator){if((f=h(n,e,r))===e&&f!==n)return!1}else if("<="===n.operator&&!s(n.semver,String(e),r))return!1}if(!e.operator&&(n||i)&&0!==c)return!1}return(!i||!m||!!n||0===c)&&(!n||!g||!!i||0===c)&&!v&&!_&&!0},d=(e,t,r)=>{if(!e)return t;let i=o(e.semver,t.semver,r);return i>0?e:i<0||">"===t.operator&&">="===e.operator?t:e},h=(e,t,r)=>{if(!e)return t;let i=o(e.semver,t.semver,r);return i<0?e:i>0||"<"===t.operator&&"<="===e.operator?t:e};t.exports=(e,t,r={})=>{if(e===t)return!0;e=new i(e,r),t=new i(t,r);let n=!1;e:for(let i of e.set){for(let e of t.set){let t=c(i,e,r);if(n=n||null!==t,t)continue e}if(n)return!1}return!0}},969551,(e,t,r)=>{"use strict";let i=e.r(34212),n=e.r(870069),a=e.r(328184),s=e.r(850471),o=e.r(9343),l=e.r(425999),u=e.r(805121),c=e.r(49192),d=e.r(96203),h=e.r(965543),p=e.r(532148),f=e.r(884240),m=e.r(877585),g=e.r(237893),y=e.r(865009),_=e.r(324281),v=e.r(511014),b=e.r(910978),w=e.r(399648),E=e.r(162430),T=e.r(547386),S=e.r(837352),I=e.r(98476),O=e.r(458048),A=e.r(247011),k=e.r(316522),x=e.r(316318),$=e.r(864987),C=e.r(420824),N=e.r(825144),P=e.r(286587),R=e.r(465326),j=e.r(717015),U=e.r(53114),L=e.r(982614),D=e.r(308879),M=e.r(480101),z=e.r(97221),F=e.r(737737);t.exports={parse:o,valid:l,clean:u,inc:c,diff:d,major:h,minor:p,patch:f,prerelease:m,compare:g,rcompare:y,compareLoose:_,compareBuild:v,sort:b,rsort:w,gt:E,lt:T,eq:S,neq:I,gte:O,lte:A,cmp:k,coerce:x,Comparator:$,Range:C,satisfies:N,toComparators:P,maxSatisfying:R,minSatisfying:j,minVersion:U,validRange:L,outside:D,gtr:M,ltr:z,intersects:F,simplifyRange:e.r(424782),subset:e.r(169998),SemVer:a,re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},231309,(e,t,r)=>{"use strict";var i=Object.prototype.hasOwnProperty,n="~";function a(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,a){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new s(r,i||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(n=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,s=Array(a);i<a;i++)s[i]=r[i].fn;return s},u.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,i,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,a),!0;case 6:return c.fn.call(c.context,t,r,i,a,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||l(this,a);else{for(var o=0,u=[],c=s.length;o<c;o++)(s[o].fn!==t||i&&!s[o].once||r&&s[o].context!==r)&&u.push(s[o]);u.length?this._events[a]=1===u.length?u[0]:u:l(this,a)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},193484,(e,t,r)=>{"use strict";r.byteLength=function(e){var t=u(e),r=t[0],i=t[1];return(r+i)*3/4-i},r.toByteArray=function(e){var t,r,i=u(e),s=i[0],o=i[1],l=new a((s+o)*3/4-o),c=0,d=o>0?s-4:s;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,l[c++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t),l},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,a=[],s=0,o=r-n;s<o;s+=16383)a.push(function(e,t,r){for(var n,a=[],s=t;s<r;s+=3)n=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(i[n>>18&63]+i[n>>12&63]+i[n>>6&63]+i[63&n]);return a.join("")}(e,s,s+16383>o?o:s+16383));return 1===n?a.push(i[(t=e[r-1])>>2]+i[t<<4&63]+"=="):2===n&&a.push(i[(t=(e[r-2]<<8)+e[r-1])>>10]+i[t>>4&63]+i[t<<2&63]+"="),a.join("")};for(var i=[],n=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=s.length;o<l;++o)i[o]=s[o],n[s.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var i=r===t?0:4-r%4;return[r,i]}n[45]=62,n[95]=63},788541,(e,t,r)=>{"use strict";var i=Object.prototype.hasOwnProperty,n=Object.prototype.toString,a=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===n.call(e)},l=function(e){if(!e||"[object Object]"!==n.call(e))return!1;var t,r=i.call(e,"constructor"),a=e.constructor&&e.constructor.prototype&&i.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!r&&!a)return!1;for(t in e);return void 0===t||i.call(e,t)},u=function(e,t){a&&"__proto__"===t.name?a(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},c=function(e,t){if("__proto__"===t){if(!i.call(e,t))return;else if(s)return s(e,t).value}return e[t]};t.exports=function e(){var t,r,i,n,a,s,d=arguments[0],h=1,p=arguments.length,f=!1;for("boolean"==typeof d&&(f=d,d=arguments[1]||{},h=2),(null==d||"object"!=typeof d&&"function"!=typeof d)&&(d={});h<p;++h)if(t=arguments[h],null!=t)for(r in t)i=c(d,r),d!==(n=c(t,r))&&(f&&n&&(l(n)||(a=o(n)))?(a?(a=!1,s=i&&o(i)?i:[]):s=i&&l(i)?i:{},u(d,{name:r,newValue:e(f,s,n)})):void 0!==n&&u(d,{name:r,newValue:n}));return d}},572756,(e,t,r)=>{"use strict";t.exports={pkg:e.r(564621)}},354975,(e,t,r)=>{"use strict";var i=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.GaxiosError=r.GAXIOS_ERROR_SYMBOL=void 0,r.defaultErrorRedactor=function e(t){let r="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function i(e){e&&e.forEach((t,i)=>{(/^authentication$/i.test(i)||/^authorization$/i.test(i)||/secret/i.test(i))&&e.set(i,r)})}function n(e,t){if("object"==typeof e&&null!==e&&"string"==typeof e[t]){let i=e[t];(/grant_type=/i.test(i)||/assertion=/i.test(i)||/secret/i.test(i))&&(e[t]=r)}}function a(e){!e||"object"!=typeof e||(e instanceof FormData||e instanceof URLSearchParams||"forEach"in e&&"set"in e?e.forEach((t,i)=>{(["grant_type","assertion"].includes(i)||/secret/.test(i))&&e.set(i,r)}):("grant_type"in e&&(e.grant_type=r),"assertion"in e&&(e.assertion=r),"client_secret"in e&&(e.client_secret=r)))}return t.config&&(i(t.config.headers),n(t.config,"data"),a(t.config.data),n(t.config,"body"),a(t.config.body),t.config.url.searchParams.has("token")&&t.config.url.searchParams.set("token",r),t.config.url.searchParams.has("client_secret")&&t.config.url.searchParams.set("client_secret",r)),t.response&&(e({config:t.response.config}),i(t.response.headers),t.response.bodyUsed&&(n(t.response,"data"),a(t.response.data))),t};let n=i(e.r(788541)),a=i(e.r(572756)).default.pkg;r.GAXIOS_ERROR_SYMBOL=Symbol.for(`${a.name}-gaxios-error`);class s extends Error{config;response;code;status;error;[r.GAXIOS_ERROR_SYMBOL]=a.version;static[Symbol.hasInstance](e){return!!e&&"object"==typeof e&&r.GAXIOS_ERROR_SYMBOL in e&&e[r.GAXIOS_ERROR_SYMBOL]===a.version||Function.prototype[Symbol.hasInstance].call(s,e)}constructor(e,t,r,i){if(super(e,{cause:i}),this.config=t,this.response=r,this.error=i instanceof Error?i:void 0,this.config=(0,n.default)(!0,{},t),this.response&&(this.response.config=(0,n.default)(!0,{},this.response.config)),this.response){try{this.response.data=function(e,t){switch(e){case"stream":default:return t;case"json":return JSON.parse(JSON.stringify(t));case"arraybuffer":return JSON.parse(Buffer.from(t).toString("utf8"));case"blob":return JSON.parse(t.text())}}(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}i instanceof DOMException?this.code=i.name:i&&"object"==typeof i&&"code"in i&&("string"==typeof i.code||"number"==typeof i.code)&&(this.code=i.code)}static extractAPIErrorFromResponse(e,t="The request failed"){let r=t;if("string"==typeof e.data&&(r=e.data),e.data&&"object"==typeof e.data&&"error"in e.data&&e.data.error&&!e.ok){if("string"==typeof e.data.error)return{message:e.data.error,code:e.status,status:e.statusText};if("object"==typeof e.data.error){r="message"in e.data.error&&"string"==typeof e.data.error.message?e.data.error.message:r;let t="status"in e.data.error&&"string"==typeof e.data.error.status?e.data.error.status:e.statusText,i="code"in e.data.error&&"number"==typeof e.data.error.code?e.data.error.code:e.status;if("errors"in e.data.error&&Array.isArray(e.data.error.errors)){let n=[];for(let t of e.data.error.errors)"object"==typeof t&&"message"in t&&"string"==typeof t.message&&n.push(t.message);return Object.assign({message:n.join("\n")||r,code:i,status:t},e.data.error)}return Object.assign({message:r,code:i,status:t},e.data.error)}}return{message:r,code:e.status,status:e.statusText}}}r.GaxiosError=s},374789,(e,t,r)=>{"use strict";async function i(e){var t;let r=a(e);if(!e||!e.config||!r&&!e.config.retry)return{shouldRetry:!1};(r=r||{}).currentRetryAttempt=r.currentRetryAttempt||0,r.retry=void 0===r.retry||null===r.retry?3:r.retry,r.httpMethodsToRetry=r.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],r.noResponseRetries=void 0===r.noResponseRetries||null===r.noResponseRetries?2:r.noResponseRetries,r.retryDelayMultiplier=r.retryDelayMultiplier?r.retryDelayMultiplier:2,r.timeOfFirstRequest=r.timeOfFirstRequest?r.timeOfFirstRequest:Date.now(),r.totalTimeout=r.totalTimeout?r.totalTimeout:Number.MAX_SAFE_INTEGER,r.maxRetryDelay=r.maxRetryDelay?r.maxRetryDelay:Number.MAX_SAFE_INTEGER,r.statusCodesToRetry=r.statusCodesToRetry||[[100,199],[408,408],[429,429],[500,599]],e.config.retryConfig=r;let i=r.shouldRetry||n;if(!await i(e))return{shouldRetry:!1,config:e.config};let s=Math.min(((t=r).currentRetryAttempt?0:t.retryDelay??100)+(Math.pow(t.retryDelayMultiplier,t.currentRetryAttempt)-1)/2*1e3,t.totalTimeout-(Date.now()-t.timeOfFirstRequest),t.maxRetryDelay);e.config.retryConfig.currentRetryAttempt+=1;let o=r.retryBackoff?r.retryBackoff(e,s):new Promise(e=>{setTimeout(e,s)});return r.onRetryAttempt&&await r.onRetryAttempt(e),await o,{shouldRetry:!0,config:e.config}}function n(e){let t=a(e);if(e.config.signal?.aborted&&"TimeoutError"!==e.code||"AbortError"===e.code||!t||0===t.retry||!e.response&&(t.currentRetryAttempt||0)>=t.noResponseRetries||!t.httpMethodsToRetry||!t.httpMethodsToRetry.includes(e.config.method?.toUpperCase()||"GET"))return!1;if(e.response&&e.response.status){let r=!1;for(let[i,n]of t.statusCodesToRetry){let t=e.response.status;if(t>=i&&t<=n){r=!0;break}}if(!r)return!1}return t.currentRetryAttempt=t.currentRetryAttempt||0,!(t.currentRetryAttempt>=t.retry)}function a(e){if(e&&e.config&&e.config.retryConfig)return e.config.retryConfig}Object.defineProperty(r,"__esModule",{value:!0}),r.getRetryConfig=i},76932,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GaxiosInterceptorManager=void 0;class i extends Set{}r.GaxiosInterceptorManager=i},780903,(e,t,r)=>{"use strict";var i,n=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.Gaxios=void 0;let a=n(e.r(788541)),s=e.r(524836),o=e.r(354975),l=e.r(374789),u=e.r(688947),c=e.r(76932),d=async()=>globalThis.crypto?.randomUUID()||(await e.A(485685)).randomUUID();class h{agentCache=new Map;defaults;interceptors;constructor(e){this.defaults=e||{},this.interceptors={request:new c.GaxiosInterceptorManager,response:new c.GaxiosInterceptorManager}}fetch(...e){let t,r=e[0],n=e[1],a=new Headers;return("string"==typeof r?t=new URL(r):r instanceof URL?t=r:r&&r.url&&(t=new URL(r.url)),r&&"object"==typeof r&&"headers"in r&&i.mergeHeaders(a,r.headers),n&&i.mergeHeaders(a,new Headers(n.headers)),"object"!=typeof r||r instanceof URL)?this.request({...n,headers:a,url:t}):this.request({...n,...r,headers:a,url:t})}async request(e={}){let t=await this.#e(e);return t=await this.#t(t),this.#r(this._request(t))}async _defaultAdapter(e){let t=e.fetchImplementation||this.defaults.fetchImplementation||await i.#i(),r={...e};delete r.data;let n=await t(e.url,r),a=await this.getResponseData(e,n);return Object.getOwnPropertyDescriptor(n,"data")?.configurable||Object.defineProperties(n,{data:{configurable:!0,writable:!0,enumerable:!0,value:a}}),Object.assign(n,{config:e,data:a})}async _request(e){try{let t;if(t=e.adapter?await e.adapter(e,this._defaultAdapter.bind(this)):await this._defaultAdapter(e),!e.validateStatus(t.status)){if("stream"===e.responseType){let e=[];for await(let r of t.data)e.push(r);t.data=e.toString()}let r=o.GaxiosError.extractAPIErrorFromResponse(t,`Request failed with status code ${t.status}`);throw new o.GaxiosError(r?.message,e,t,r)}return t}catch(n){let t;t=n instanceof o.GaxiosError?n:n instanceof Error?new o.GaxiosError(n.message,e,void 0,n):new o.GaxiosError("Unexpected Gaxios Error",e,void 0,n);let{shouldRetry:r,config:i}=await (0,l.getRetryConfig)(t);if(r&&i)return t.config.retryConfig.currentRetryAttempt=i.retryConfig.currentRetryAttempt,e.retryConfig=t.config?.retryConfig,this.#n(e),this._request(e);throw e.errorRedactor&&e.errorRedactor(t),t}}async getResponseData(e,t){if(204===t.status)return"";if(e.maxContentLength&&t.headers.has("content-length")&&e.maxContentLength<Number.parseInt(t.headers?.get("content-length")||""))throw new o.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(t,{config:e}));switch(e.responseType){case"stream":return t.body;case"json":{let e=await t.text();try{return JSON.parse(e)}catch{return e}}case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"text":return t.text();default:return this.getResponseDataFromContentType(t)}}#a(e,t=[]){let r=new URL(e),i=[...t];for(let e of(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[])i.push(e.trim());for(let e of i)if(e instanceof RegExp){if(e.test(r.toString()))return!1}else if(e instanceof URL){if(e.origin===r.origin)return!1}else if(e.startsWith("*.")||e.startsWith(".")){let t=e.replace(/^\*\./,".");if(r.hostname.endsWith(t))return!1}else if(e===r.origin||e===r.hostname||e===r.href)return!1;return!0}async #t(e){let t=Promise.resolve(e);for(let e of this.interceptors.request.values())e&&(t=t.then(e.resolved,e.rejected));return t}async #r(e){let t=Promise.resolve(e);for(let e of this.interceptors.response.values())e&&(t=t.then(e.resolved,e.rejected));return t}async #e(e){let t=new Headers(this.defaults.headers);i.mergeHeaders(t,e.headers);let r=(0,a.default)(!0,{},this.defaults,e);if(!r.url)throw Error("URL is required.");if(r.baseURL&&(r.url=new URL(r.url,r.baseURL)),r.url=new URL(r.url),r.params)if(r.paramsSerializer){let e=r.paramsSerializer(r.params);e.startsWith("?")&&(e=e.slice(1));let t=r.url.toString().includes("?")?"&":"?";r.url=r.url+t+e}else{let e=r.url instanceof URL?r.url:new URL(r.url);for(let[t,i]of new URLSearchParams(r.params))e.searchParams.append(t,i);r.url=e}"number"==typeof e.maxContentLength&&(r.size=e.maxContentLength),"number"==typeof e.maxRedirects&&(r.follow=e.maxRedirects);let n="string"==typeof r.data||r.data instanceof ArrayBuffer||r.data instanceof Blob||globalThis.File&&r.data instanceof File||r.data instanceof FormData||r.data instanceof u.Readable||r.data instanceof ReadableStream||r.data instanceof String||r.data instanceof URLSearchParams||ArrayBuffer.isView(r.data)||["Blob","File","FormData"].includes(r.data?.constructor?.name||"");if(r.multipart?.length){let e=await d();t.set("content-type",`multipart/related; boundary=${e}`),r.body=u.Readable.from(this.getMultipartRequest(r.multipart,e))}else n?r.body=r.data:"object"==typeof r.data?"application/x-www-form-urlencoded"===t.get("Content-Type")?r.body=r.paramsSerializer?r.paramsSerializer(r.data):new URLSearchParams(r.data):(t.has("content-type")||t.set("content-type","application/json"),r.body=JSON.stringify(r.data)):r.data&&(r.body=r.data);r.validateStatus=r.validateStatus||this.validateStatus,r.responseType=r.responseType||"unknown",t.has("accept")||"json"!==r.responseType||t.set("accept","application/json");let l=r.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(r.agent);else if(l&&this.#a(r.url,r.noProxy)){let e=await i.#s();this.agentCache.has(l)?r.agent=this.agentCache.get(l):(r.agent=new e(l,{cert:r.cert,key:r.key}),this.agentCache.set(l,r.agent))}else r.cert&&r.key&&(this.agentCache.has(r.key)?r.agent=this.agentCache.get(r.key):(r.agent=new s.Agent({cert:r.cert,key:r.key}),this.agentCache.set(r.key,r.agent)));return"function"!=typeof r.errorRedactor&&!1!==r.errorRedactor&&(r.errorRedactor=o.defaultErrorRedactor),!r.body||"duplex"in r||(r.duplex="half"),this.#n(r),Object.assign(r,{headers:t,url:r.url instanceof URL?r.url:new URL(r.url)})}#n(e){if(e.timeout){let t=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,t]):e.signal=t}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let t=e.headers.get("Content-Type");if(null===t)return e.text();if((t=t.toLowerCase()).includes("application/json")){let t=await e.text();try{t=JSON.parse(t)}catch{}return t}return t.match(/^text\//)?e.text():e.blob()}async *getMultipartRequest(e,t){let r=`--${t}--`;for(let r of e){let e=r.headers.get("Content-Type")||"application/octet-stream",i=`--${t}\r
Content-Type: ${e}\r
\r
`;yield i,"string"==typeof r.content?yield r.content:yield*r.content,yield"\r\n"}yield r}static #o;static #l;static async #s(){return this.#o||=(await e.A(316067)).HttpsProxyAgent,this.#o}static async #i(){return this.#l||=(await e.A(399164)).default,this.#l}static mergeHeaders(e,...t){for(let r of(e=e instanceof Headers?e:new Headers(e),t))(r instanceof Headers?r:new Headers(r)).forEach((t,r)=>{"set-cookie"===r?e.append(r,t):e.set(r,t)});return e}}r.Gaxios=h,i=h},401606,(e,t,r)=>{"use strict";var i=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.instance=r.Gaxios=r.GaxiosError=void 0,r.request=o;let a=e.r(780903);Object.defineProperty(r,"Gaxios",{enumerable:!0,get:function(){return a.Gaxios}});var s=e.r(354975);async function o(e){return r.instance.request(e)}Object.defineProperty(r,"GaxiosError",{enumerable:!0,get:function(){return s.GaxiosError}}),n(e.r(76932),r),r.instance=new a.Gaxios},199578,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GCE_LINUX_BIOS_PATHS=void 0,r.isGoogleCloudServerless=a,r.isGoogleComputeEngineLinux=s,r.isGoogleComputeEngineMACAddress=o,r.isGoogleComputeEngine=l,r.detectGCPResidency=function(){return a()||l()},e.r(522734);let i=e.r(446786);r.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};let n=/^42:01/;function a(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function s(){if("linux"!==(0,i.platform)())return!1}function o(){for(let e of Object.values((0,i.networkInterfaces)()))if(e){for(let{mac:t}of e)if(n.test(t))return!0}return!1}function l(){return s()||o()}},332768,(e,t,r)=>{!function(r){"use strict";var i,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,s=Math.floor,o="[BigNumber Error] ",l=o+"Number primitive has more than 15 significant digits: ",u=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13];function c(e){var t=0|e;return e>0||e===t?t:t-1}function d(e){for(var t,r,i=1,n=e.length,a=e[0]+"";i<n;){for(r=14-(t=e[i++]+"").length;r--;t="0"+t);a+=t}for(n=a.length;48===a.charCodeAt(--n););return a.slice(0,n+1||1)}function h(e,t){var r,i,n=e.c,a=t.c,s=e.s,o=t.s,l=e.e,u=t.e;if(!s||!o)return null;if(r=n&&!n[0],i=a&&!a[0],r||i)return r?i?0:-o:s;if(s!=o)return s;if(r=s<0,i=l==u,!n||!a)return i?0:!n^r?1:-1;if(!i)return l>u^r?1:-1;for(s=0,o=(l=n.length)<(u=a.length)?l:u;s<o;s++)if(n[s]!=a[s])return n[s]>a[s]^r?1:-1;return l==u?0:l>u^r?1:-1}function p(e,t,r,i){if(e<t||e>r||e!==s(e))throw Error(o+(i||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function f(e){var t=e.c.length-1;return c(e.e/14)==t&&e.c[t]%2!=0}function m(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function g(e,t,r){var i,n;if(t<0){for(n=r+".";++t;n+=r);e=n+e}else if(i=e.length,++t>i){for(n=r,t-=i;--t;n+=r);e+=n}else t<i&&(e=e.slice(0,t)+"."+e.slice(t));return e}if((i=function e(t){var r,i,y,_,v,b,w,E,T,S=D.prototype={constructor:D,toString:null,valueOf:null},I=new D(1),O=20,A=4,k=-7,x=21,$=-1e7,C=1e7,N=!1,P=1,R=0,j={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},U="0123456789abcdefghijklmnopqrstuvwxyz",L=!0;function D(e,t){var r,i,a,o,u,c,d,h,f=this;if(!(f instanceof D))return new D(e,t);if(null==t){if(e&&!0===e._isBigNumber){f.s=e.s,!e.c||e.e>C?f.c=f.e=null:e.e<$?f.c=[f.e=0]:(f.e=e.e,f.c=e.c.slice());return}if((c="number"==typeof e)&&0*e==0){if(f.s=1/e<0?(e=-e,-1):1,e===~~e){for(o=0,u=e;u>=10;u/=10,o++);o>C?f.c=f.e=null:(f.e=o,f.c=[e]);return}h=String(e)}else{if(!n.test(h=String(e)))return T(f,h,c);f.s=45==h.charCodeAt(0)?(h=h.slice(1),-1):1}(o=h.indexOf("."))>-1&&(h=h.replace(".","")),(u=h.search(/e/i))>0?(o<0&&(o=u),o+=+h.slice(u+1),h=h.substring(0,u)):o<0&&(o=h.length)}else{if(p(t,2,U.length,"Base"),10==t&&L)return B(f=new D(e),O+f.e+1,A);if(h=String(e),c="number"==typeof e){if(0*e!=0)return T(f,h,c,t);if(f.s=1/e<0?(h=h.slice(1),-1):1,D.DEBUG&&h.replace(/^0\.0*|\./,"").length>15)throw Error(l+e)}else f.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1;for(r=U.slice(0,t),o=u=0,d=h.length;u<d;u++)if(0>r.indexOf(i=h.charAt(u))){if("."==i){if(u>o){o=d;continue}}else if(!a&&(h==h.toUpperCase()&&(h=h.toLowerCase())||h==h.toLowerCase()&&(h=h.toUpperCase()))){a=!0,u=-1,o=0;continue}return T(f,String(e),c,t)}c=!1,(o=(h=E(h,t,10,f.s)).indexOf("."))>-1?h=h.replace(".",""):o=h.length}for(u=0;48===h.charCodeAt(u);u++);for(d=h.length;48===h.charCodeAt(--d););if(h=h.slice(u,++d)){if(d-=u,c&&D.DEBUG&&d>15&&(e>0x1fffffffffffff||e!==s(e)))throw Error(l+f.s*e);if((o=o-u-1)>C)f.c=f.e=null;else if(o<$)f.c=[f.e=0];else{if(f.e=o,f.c=[],u=(o+1)%14,o<0&&(u+=14),u<d){for(u&&f.c.push(+h.slice(0,u)),d-=14;u<d;)f.c.push(+h.slice(u,u+=14));u=14-(h=h.slice(u)).length}else u-=d;for(;u--;h+="0");f.c.push(+h)}}else f.c=[f.e=0]}function M(e,t,r,i){var n,a,s,o,l;if(null==r?r=A:p(r,0,8),!e.c)return e.toString();if(n=e.c[0],s=e.e,null==t)l=d(e.c),l=1==i||2==i&&(s<=k||s>=x)?m(l,s):g(l,s,"0");else if(a=(e=B(new D(e),t,r)).e,o=(l=d(e.c)).length,1==i||2==i&&(t<=a||a<=k)){for(;o<t;l+="0",o++);l=m(l,a)}else if(t-=s+(2===i&&a>s),l=g(l,a,"0"),a+1>o){if(--t>0)for(l+=".";t--;l+="0");}else if((t+=a-o)>0)for(a+1==o&&(l+=".");t--;l+="0");return e.s<0&&n?"-"+l:l}function z(e,t){for(var r,i,n=1,a=new D(e[0]);n<e.length;n++)(i=new D(e[n])).s&&(r=h(a,i))!==t&&(0!==r||a.s!==t)||(a=i);return a}function F(e,t,r){for(var i=1,n=t.length;!t[--n];t.pop());for(n=t[0];n>=10;n/=10,i++);return(r=i+14*r-1)>C?e.c=e.e=null:r<$?e.c=[e.e=0]:(e.e=r,e.c=t),e}function B(e,t,r,i){var n,o,l,c,d,h,p,f=e.c;if(f){t:{for(n=1,c=f[0];c>=10;c/=10,n++);if((o=t-n)<0)o+=14,l=t,p=s((d=f[h=0])/u[n-l-1]%10);else if((h=a((o+1)/14))>=f.length)if(i){for(;f.length<=h;f.push(0));d=p=0,n=1,o%=14,l=o-14+1}else break t;else{for(n=1,d=c=f[h];c>=10;c/=10,n++);o%=14,p=(l=o-14+n)<0?0:s(d/u[n-l-1]%10)}if(i=i||t<0||null!=f[h+1]||(l<0?d:d%u[n-l-1]),i=r<4?(p||i)&&(0==r||r==(e.s<0?3:2)):p>5||5==p&&(4==r||i||6==r&&(o>0?l>0?d/u[n-l]:0:f[h-1])%10&1||r==(e.s<0?8:7)),t<1||!f[0])return f.length=0,i?(t-=e.e+1,f[0]=u[(14-t%14)%14],e.e=-t||0):f[0]=e.e=0,e;if(0==o?(f.length=h,c=1,h--):(f.length=h+1,c=u[14-o],f[h]=l>0?s(d/u[n-l]%u[l])*c:0),i)for(;;)if(0==h){for(o=1,l=f[0];l>=10;l/=10,o++);for(l=f[0]+=c,c=1;l>=10;l/=10,c++);o!=c&&(e.e++,1e14==f[0]&&(f[0]=1));break}else{if(f[h]+=c,1e14!=f[h])break;f[h--]=0,c=1}for(o=f.length;0===f[--o];f.pop());}e.e>C?e.c=e.e=null:e.e<$&&(e.c=[e.e=0])}return e}function Z(e){var t,r=e.e;return null===r?e.toString():(t=d(e.c),t=r<=k||r>=x?m(t,r):g(t,r,"0"),e.s<0?"-"+t:t)}return D.clone=e,D.ROUND_UP=0,D.ROUND_DOWN=1,D.ROUND_CEIL=2,D.ROUND_FLOOR=3,D.ROUND_HALF_UP=4,D.ROUND_HALF_DOWN=5,D.ROUND_HALF_EVEN=6,D.ROUND_HALF_CEIL=7,D.ROUND_HALF_FLOOR=8,D.EUCLID=9,D.config=D.set=function(e){var t,r;if(null!=e)if("object"==typeof e){if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(p(r=e[t],0,1e9,t),O=r),e.hasOwnProperty(t="ROUNDING_MODE")&&(p(r=e[t],0,8,t),A=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?(p(r[0],-1e9,0,t),p(r[1],0,1e9,t),k=r[0],x=r[1]):(p(r,-1e9,1e9,t),k=-(x=r<0?-r:r))),e.hasOwnProperty(t="RANGE"))if((r=e[t])&&r.pop)p(r[0],-1e9,-1,t),p(r[1],1,1e9,t),$=r[0],C=r[1];else if(p(r,-1e9,1e9,t),r)$=-(C=r<0?-r:r);else throw Error(o+t+" cannot be zero: "+r);if(e.hasOwnProperty(t="CRYPTO"))if(!!(r=e[t])===r)if(r)if("undefined"!=typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))N=r;else throw N=!r,Error(o+"crypto unavailable");else N=r;else throw Error(o+t+" not true or false: "+r);if(e.hasOwnProperty(t="MODULO_MODE")&&(p(r=e[t],0,9,t),P=r),e.hasOwnProperty(t="POW_PRECISION")&&(p(r=e[t],0,1e9,t),R=r),e.hasOwnProperty(t="FORMAT"))if("object"==typeof(r=e[t]))j=r;else throw Error(o+t+" not an object: "+r);if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(o+t+" invalid: "+r);L="0123456789"==r.slice(0,10),U=r}}else throw Error(o+"Object expected: "+e);return{DECIMAL_PLACES:O,ROUNDING_MODE:A,EXPONENTIAL_AT:[k,x],RANGE:[$,C],CRYPTO:N,MODULO_MODE:P,POW_PRECISION:R,FORMAT:j,ALPHABET:U}},D.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!D.DEBUG)return!0;var t,r,i=e.c,n=e.e,a=e.s;t:if("[object Array]"==({}).toString.call(i)){if((1===a||-1===a)&&n>=-1e9&&n<=1e9&&n===s(n)){if(0===i[0]){if(0===n&&1===i.length)return!0;break t}if((t=(n+1)%14)<1&&(t+=14),String(i[0]).length==t){for(t=0;t<i.length;t++)if((r=i[t])<0||r>=1e14||r!==s(r))break t;if(0!==r)return!0}}}else if(null===i&&null===n&&(null===a||1===a||-1===a))return!0;throw Error(o+"Invalid BigNumber: "+e)},D.maximum=D.max=function(){return z(arguments,-1)},D.minimum=D.min=function(){return z(arguments,1)},r=0x20000000000000*Math.random()&2097151?function(){return s(0x20000000000000*Math.random())}:function(){return(0x40000000*Math.random()|0)*8388608+(8388608*Math.random()|0)},D.random=function(e){var t,i,n,l,c,d=0,h=[],f=new D(I);if(null==e?e=O:p(e,0,1e9),l=a(e/14),N)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(l*=2));d<l;)(c=131072*t[d]+(t[d+1]>>>11))>=9e15?(i=crypto.getRandomValues(new Uint32Array(2)),t[d]=i[0],t[d+1]=i[1]):(h.push(c%1e14),d+=2);d=l/2}else if(crypto.randomBytes){for(t=crypto.randomBytes(l*=7);d<l;)(c=(31&t[d])*0x1000000000000+0x10000000000*t[d+1]+0x100000000*t[d+2]+0x1000000*t[d+3]+(t[d+4]<<16)+(t[d+5]<<8)+t[d+6])>=9e15?crypto.randomBytes(7).copy(t,d):(h.push(c%1e14),d+=7);d=l/7}else throw N=!1,Error(o+"crypto unavailable");if(!N)for(;d<l;)(c=r())<9e15&&(h[d++]=c%1e14);for(l=h[--d],e%=14,l&&e&&(c=u[14-e],h[d]=s(l/c)*c);0===h[d];h.pop(),d--);if(d<0)h=[n=0];else{for(n=-1;0===h[0];h.splice(0,1),n-=14);for(d=1,c=h[0];c>=10;c/=10,d++);d<14&&(n-=14-d)}return f.e=n,f.c=h,f},D.sum=function(){for(var e=1,t=arguments,r=new D(t[0]);e<t.length;)r=r.plus(t[e++]);return r},E=function(){var e="0123456789";function t(e,t,r,i){for(var n,a,s=[0],o=0,l=e.length;o<l;){for(a=s.length;a--;s[a]*=t);for(s[0]+=i.indexOf(e.charAt(o++)),n=0;n<s.length;n++)s[n]>r-1&&(null==s[n+1]&&(s[n+1]=0),s[n+1]+=s[n]/r|0,s[n]%=r)}return s.reverse()}return function(r,i,n,a,s){var o,l,u,c,h,p,f,m,y=r.indexOf("."),_=O,v=A;for(y>=0&&(c=R,R=0,r=r.replace(".",""),p=(m=new D(i)).pow(r.length-y),R=c,m.c=t(g(d(p.c),p.e,"0"),10,n,e),m.e=m.c.length),u=c=(f=t(r,i,n,s?(o=U,e):(o=e,U))).length;0==f[--c];f.pop());if(!f[0])return o.charAt(0);if(y<0?--u:(p.c=f,p.e=u,p.s=a,f=(p=w(p,m,_,v,n)).c,h=p.r,u=p.e),y=f[l=u+_+1],c=n/2,h=h||l<0||null!=f[l+1],h=v<4?(null!=y||h)&&(0==v||v==(p.s<0?3:2)):y>c||y==c&&(4==v||h||6==v&&1&f[l-1]||v==(p.s<0?8:7)),l<1||!f[0])r=h?g(o.charAt(1),-_,o.charAt(0)):o.charAt(0);else{if(f.length=l,h)for(--n;++f[--l]>n;)f[l]=0,l||(++u,f=[1].concat(f));for(c=f.length;!f[--c];);for(y=0,r="";y<=c;r+=o.charAt(f[y++]));r=g(r,u,o.charAt(0))}return r}}(),w=function(){function e(e,t,r){var i,n,a,s,o=0,l=e.length,u=t%1e7,c=t/1e7|0;for(e=e.slice();l--;)i=c*(a=e[l]%1e7)+(s=e[l]/1e7|0)*u,o=((n=u*a+i%1e7*1e7+o)/r|0)+(i/1e7|0)+c*s,e[l]=n%r;return o&&(e=[o].concat(e)),e}function t(e,t,r,i){var n,a;if(r!=i)a=r>i?1:-1;else for(n=a=0;n<r;n++)if(e[n]!=t[n]){a=e[n]>t[n]?1:-1;break}return a}function r(e,t,r,i){for(var n=0;r--;)e[r]-=n,n=+(e[r]<t[r]),e[r]=n*i+e[r]-t[r];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(i,n,a,o,l){var u,d,h,p,f,m,g,y,_,v,b,w,E,T,S,I,O,A=i.s==n.s?1:-1,k=i.c,x=n.c;if(!k||!k[0]||!x||!x[0])return new D(!i.s||!n.s||(k?x&&k[0]==x[0]:!x)?NaN:k&&0==k[0]||!x?0*A:A/0);for(_=(y=new D(A)).c=[],A=a+(d=i.e-n.e)+1,l||(l=1e14,d=c(i.e/14)-c(n.e/14),A=A/14|0),h=0;x[h]==(k[h]||0);h++);if(x[h]>(k[h]||0)&&d--,A<0)_.push(1),p=!0;else{for(T=k.length,I=x.length,h=0,A+=2,(f=s(l/(x[0]+1)))>1&&(x=e(x,f,l),k=e(k,f,l),I=x.length,T=k.length),E=I,b=(v=k.slice(0,I)).length;b<I;v[b++]=0);O=[0].concat(O=x.slice()),S=x[0],x[1]>=l/2&&S++;do{if(f=0,(u=t(x,v,I,b))<0){if(w=v[0],I!=b&&(w=w*l+(v[1]||0)),(f=s(w/S))>1)for(f>=l&&(f=l-1),g=(m=e(x,f,l)).length,b=v.length;1==t(m,v,g,b);)f--,r(m,I<g?O:x,g,l),g=m.length,u=1;else 0==f&&(u=f=1),g=(m=x.slice()).length;if(g<b&&(m=[0].concat(m)),r(v,m,b,l),b=v.length,-1==u)for(;1>t(x,v,I,b);)f++,r(v,I<b?O:x,b,l),b=v.length}else 0===u&&(f++,v=[0]);_[h++]=f,v[0]?v[b++]=k[E]||0:(v=[k[E]],b=1)}while((E++<T||null!=v[0])&&A--)p=null!=v[0],_[0]||_.splice(0,1)}if(1e14==l){for(h=1,A=_[0];A>=10;A/=10,h++);B(y,a+(y.e=h+14*d-1)+1,o,p)}else y.e=d,y.r=+p;return y}}(),i=/^(-?)0([xbo])(?=\w[\w.]*$)/i,y=/^([^.]+)\.$/,_=/^\.([^.]+)$/,v=/^-?(Infinity|NaN)$/,b=/^\s*\+(?=[\w.])|^\s+|\s+$/g,T=function(e,t,r,n){var a,s=r?t:t.replace(b,"");if(v.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!r&&(s=s.replace(i,function(e,t,r){return a="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=a?e:t}),n&&(a=n,s=s.replace(y,"$1").replace(_,"0.$1")),t!=s))return new D(s,a);if(D.DEBUG)throw Error(o+"Not a"+(n?" base "+n:"")+" number: "+t);e.s=null}e.c=e.e=null},S.absoluteValue=S.abs=function(){var e=new D(this);return e.s<0&&(e.s=1),e},S.comparedTo=function(e,t){return h(this,new D(e,t))},S.decimalPlaces=S.dp=function(e,t){var r,i,n;if(null!=e)return p(e,0,1e9),null==t?t=A:p(t,0,8),B(new D(this),e+this.e+1,t);if(!(r=this.c))return null;if(i=((n=r.length-1)-c(this.e/14))*14,n=r[n])for(;n%10==0;n/=10,i--);return i<0&&(i=0),i},S.dividedBy=S.div=function(e,t){return w(this,new D(e,t),O,A)},S.dividedToIntegerBy=S.idiv=function(e,t){return w(this,new D(e,t),0,1)},S.exponentiatedBy=S.pow=function(e,t){var r,i,n,l,u,c,d,h,p,m=this;if((e=new D(e)).c&&!e.isInteger())throw Error(o+"Exponent not an integer: "+Z(e));if(null!=t&&(t=new D(t)),c=e.e>14,!m.c||!m.c[0]||1==m.c[0]&&!m.e&&1==m.c.length||!e.c||!e.c[0])return p=new D(Math.pow(+Z(m),c?e.s*(2-f(e)):+Z(e))),t?p.mod(t):p;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new D(NaN);(i=!d&&m.isInteger()&&t.isInteger())&&(m=m.mod(t))}else{if(e.e>9&&(m.e>0||m.e<-1||(0==m.e?m.c[0]>1||c&&m.c[1]>=24e7:m.c[0]<8e13||c&&m.c[0]<=9999975e7)))return l=m.s<0&&f(e)?-0:0,m.e>-1&&(l=1/l),new D(d?1/l:l);R&&(l=a(R/14+2))}for(c?(r=new D(.5),d&&(e.s=1),h=f(e)):h=(n=Math.abs(+Z(e)))%2,p=new D(I);;){if(h){if(!(p=p.times(m)).c)break;l?p.c.length>l&&(p.c.length=l):i&&(p=p.mod(t))}if(n){if(0===(n=s(n/2)))break;h=n%2}else if(B(e=e.times(r),e.e+1,1),e.e>14)h=f(e);else{if(0==(n=+Z(e)))break;h=n%2}m=m.times(m),l?m.c&&m.c.length>l&&(m.c.length=l):i&&(m=m.mod(t))}return i?p:(d&&(p=I.div(p)),t?p.mod(t):l?B(p,R,A,u):p)},S.integerValue=function(e){var t=new D(this);return null==e?e=A:p(e,0,8),B(t,t.e+1,e)},S.isEqualTo=S.eq=function(e,t){return 0===h(this,new D(e,t))},S.isFinite=function(){return!!this.c},S.isGreaterThan=S.gt=function(e,t){return h(this,new D(e,t))>0},S.isGreaterThanOrEqualTo=S.gte=function(e,t){return 1===(t=h(this,new D(e,t)))||0===t},S.isInteger=function(){return!!this.c&&c(this.e/14)>this.c.length-2},S.isLessThan=S.lt=function(e,t){return 0>h(this,new D(e,t))},S.isLessThanOrEqualTo=S.lte=function(e,t){return -1===(t=h(this,new D(e,t)))||0===t},S.isNaN=function(){return!this.s},S.isNegative=function(){return this.s<0},S.isPositive=function(){return this.s>0},S.isZero=function(){return!!this.c&&0==this.c[0]},S.minus=function(e,t){var r,i,n,a,s=this.s;if(t=(e=new D(e,t)).s,!s||!t)return new D(NaN);if(s!=t)return e.s=-t,this.plus(e);var o=this.e/14,l=e.e/14,u=this.c,d=e.c;if(!o||!l){if(!u||!d)return u?(e.s=-t,e):new D(d?this:NaN);if(!u[0]||!d[0])return d[0]?(e.s=-t,e):new D(u[0]?this:3==A?-0:0)}if(o=c(o),l=c(l),u=u.slice(),s=o-l){for((a=s<0)?(s=-s,n=u):(l=o,n=d),n.reverse(),t=s;t--;n.push(0));n.reverse()}else for(i=(a=(s=u.length)<(t=d.length))?s:t,s=t=0;t<i;t++)if(u[t]!=d[t]){a=u[t]<d[t];break}if(a&&(n=u,u=d,d=n,e.s=-e.s),(t=(i=d.length)-(r=u.length))>0)for(;t--;u[r++]=0);for(t=1e14-1;i>s;){if(u[--i]<d[i]){for(r=i;r&&!u[--r];u[r]=t);--u[r],u[i]+=1e14}u[i]-=d[i]}for(;0==u[0];u.splice(0,1),--l);return u[0]?F(e,u,l):(e.s=3==A?-1:1,e.c=[e.e=0],e)},S.modulo=S.mod=function(e,t){var r,i;return(e=new D(e,t),this.c&&e.s&&(!e.c||e.c[0]))?e.c&&(!this.c||this.c[0])?(9==P?(i=e.s,e.s=1,r=w(this,e,0,3),e.s=i,r.s*=i):r=w(this,e,0,P),(e=this.minus(r.times(e))).c[0]||1!=P||(e.s=this.s),e):new D(this):new D(NaN)},S.multipliedBy=S.times=function(e,t){var r,i,n,a,s,o,l,u,d,h,p,f,m,g=this.c,y=(e=new D(e,t)).c;if(!g||!y||!g[0]||!y[0])return this.s&&e.s&&(!g||g[0]||y)&&(!y||y[0]||g)?(e.s*=this.s,g&&y?(e.c=[0],e.e=0):e.c=e.e=null):e.c=e.e=e.s=null,e;for(i=c(this.e/14)+c(e.e/14),e.s*=this.s,(l=g.length)<(h=y.length)&&(m=g,g=y,y=m,n=l,l=h,h=n),n=l+h,m=[];n--;m.push(0));for(n=h;--n>=0;){for(r=0,p=y[n]%1e7,f=y[n]/1e7|0,a=n+(s=l);a>n;)o=f*(u=g[--s]%1e7)+(d=g[s]/1e7|0)*p,r=((u=p*u+o%1e7*1e7+m[a]+r)/1e14|0)+(o/1e7|0)+f*d,m[a--]=u%1e14;m[a]=r}return r?++i:m.splice(0,1),F(e,m,i)},S.negated=function(){var e=new D(this);return e.s=-e.s||null,e},S.plus=function(e,t){var r,i=this.s;if(t=(e=new D(e,t)).s,!i||!t)return new D(NaN);if(i!=t)return e.s=-t,this.minus(e);var n=this.e/14,a=e.e/14,s=this.c,o=e.c;if(!n||!a){if(!s||!o)return new D(i/0);if(!s[0]||!o[0])return o[0]?e:new D(s[0]?this:0*i)}if(n=c(n),a=c(a),s=s.slice(),i=n-a){for(i>0?(a=n,r=o):(i=-i,r=s),r.reverse();i--;r.push(0));r.reverse()}for((i=s.length)-(t=o.length)<0&&(r=o,o=s,s=r,t=i),i=0;t;)i=(s[--t]=s[t]+o[t]+i)/1e14|0,s[t]=1e14===s[t]?0:s[t]%1e14;return i&&(s=[i].concat(s),++a),F(e,s,a)},S.precision=S.sd=function(e,t){var r,i,n;if(null!=e&&!!e!==e)return p(e,1,1e9),null==t?t=A:p(t,0,8),B(new D(this),e,t);if(!(r=this.c))return null;if(i=14*(n=r.length-1)+1,n=r[n]){for(;n%10==0;n/=10,i--);for(n=r[0];n>=10;n/=10,i++);}return e&&this.e+1>i&&(i=this.e+1),i},S.shiftedBy=function(e){return p(e,-0x1fffffffffffff,0x1fffffffffffff),this.times("1e"+e)},S.squareRoot=S.sqrt=function(){var e,t,r,i,n,a=this.c,s=this.s,o=this.e,l=O+4,u=new D("0.5");if(1!==s||!a||!a[0])return new D(!s||s<0&&(!a||a[0])?NaN:a?this:1/0);if(0==(s=Math.sqrt(+Z(this)))||s==1/0?(((t=d(a)).length+o)%2==0&&(t+="0"),s=Math.sqrt(+t),o=c((o+1)/2)-(o<0||o%2),r=new D(t=s==1/0?"5e"+o:(t=s.toExponential()).slice(0,t.indexOf("e")+1)+o)):r=new D(s+""),r.c[0]){for((s=(o=r.e)+l)<3&&(s=0);;)if(n=r,r=u.times(n.plus(w(this,n,l,1))),d(n.c).slice(0,s)===(t=d(r.c)).slice(0,s)){if(r.e<o&&--s,"9999"!=(t=t.slice(s-3,s+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(B(r,r.e+O+2,1),e=!r.times(r).eq(this));break}if(!i&&(B(n,n.e+O+2,0),n.times(n).eq(this))){r=n;break}l+=4,s+=4,i=1}}return B(r,r.e+O+1,A,e)},S.toExponential=function(e,t){return null!=e&&(p(e,0,1e9),e++),M(this,e,t,1)},S.toFixed=function(e,t){return null!=e&&(p(e,0,1e9),e=e+this.e+1),M(this,e,t)},S.toFormat=function(e,t,r){var i;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=j;else if("object"!=typeof r)throw Error(o+"Argument not an object: "+r);if(i=this.toFixed(e,t),this.c){var n,a=i.split("."),s=+r.groupSize,l=+r.secondaryGroupSize,u=r.groupSeparator||"",c=a[0],d=a[1],h=this.s<0,p=h?c.slice(1):c,f=p.length;if(l&&(n=s,s=l,l=n,f-=n),s>0&&f>0){for(n=f%s||s,c=p.substr(0,n);n<f;n+=s)c+=u+p.substr(n,s);l>0&&(c+=u+p.slice(n)),h&&(c="-"+c)}i=d?c+(r.decimalSeparator||"")+((l=+r.fractionGroupSize)?d.replace(RegExp("\\d{"+l+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):d):c}return(r.prefix||"")+i+(r.suffix||"")},S.toFraction=function(e){var t,r,i,n,a,s,l,c,h,p,f,m,g=this.c;if(null!=e&&(!(l=new D(e)).isInteger()&&(l.c||1!==l.s)||l.lt(I)))throw Error(o+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+Z(l));if(!g)return new D(this);for(t=new D(I),h=r=new D(I),i=c=new D(I),m=d(g),a=t.e=m.length-this.e-1,t.c[0]=u[(s=a%14)<0?14+s:s],e=!e||l.comparedTo(t)>0?a>0?t:h:l,s=C,C=1/0,l=new D(m),c.c[0]=0;p=w(l,t,0,1),1!=(n=r.plus(p.times(i))).comparedTo(e);)r=i,i=n,h=c.plus(p.times(n=h)),c=n,t=l.minus(p.times(n=t)),l=n;return n=w(e.minus(r),i,0,1),c=c.plus(n.times(h)),r=r.plus(n.times(i)),c.s=h.s=this.s,a*=2,f=1>w(h,i,a,A).minus(this).abs().comparedTo(w(c,r,a,A).minus(this).abs())?[h,i]:[c,r],C=s,f},S.toNumber=function(){return+Z(this)},S.toPrecision=function(e,t){return null!=e&&p(e,1,1e9),M(this,e,t,2)},S.toString=function(e){var t,r=this,i=r.s,n=r.e;return null===n?i?(t="Infinity",i<0&&(t="-"+t)):t="NaN":(null==e?t=n<=k||n>=x?m(d(r.c),n):g(d(r.c),n,"0"):10===e&&L?t=g(d((r=B(new D(r),O+n+1,A)).c),r.e,"0"):(p(e,2,U.length,"Base"),t=E(g(d(r.c),n,"0"),10,e,i,!0)),i<0&&r.c[0]&&(t="-"+t)),t},S.valueOf=S.toJSON=function(){return Z(this)},S._isBigNumber=!0,null!=t&&D.set(t),D}()).default=i.BigNumber=i,"function"==typeof define&&define.amd)e.r,void 0!==i&&e.v(i);else t.exports?t.exports=i:(r||(r="undefined"!=typeof self&&self?self:window),r.BigNumber=i)}(e.e)},231156,(e,t,r)=>{var i=e.r(332768),n=t.exports;!function(){"use strict";var e,t,r,a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function o(e){return a.lastIndex=0,a.test(e)?'"'+e.replace(a,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}"function"!=typeof n.stringify&&(n.stringify=function(n,a,s){var l;if(e="",t="","number"==typeof s)for(l=0;l<s;l+=1)t+=" ";else"string"==typeof s&&(t=s);if(r=a,a&&"function"!=typeof a&&("object"!=typeof a||"number"!=typeof a.length))throw Error("JSON.stringify");return function n(a,s){var l,u,c,d,h,p=e,f=s[a],m=null!=f&&(f instanceof i||i.isBigNumber(f));switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(a)),"function"==typeof r&&(f=r.call(s,a,f)),typeof f){case"string":if(m)return f;return o(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":case"bigint":return String(f);case"object":if(!f)return"null";if(e+=t,h=[],"[object Array]"===Object.prototype.toString.apply(f)){for(l=0,d=f.length;l<d;l+=1)h[l]=n(l,f)||"null";return c=0===h.length?"[]":e?"[\n"+e+h.join(",\n"+e)+"\n"+p+"]":"["+h.join(",")+"]",e=p,c}if(r&&"object"==typeof r)for(l=0,d=r.length;l<d;l+=1)"string"==typeof r[l]&&(c=n(u=r[l],f))&&h.push(o(u)+(e?": ":":")+c);else Object.keys(f).forEach(function(t){var r=n(t,f);r&&h.push(o(t)+(e?": ":":")+r)});return c=0===h.length?"{}":e?"{\n"+e+h.join(",\n"+e)+"\n"+p+"}":"{"+h.join(",")+"}",e=p,c}}("",{"":n})})}()},420279,(e,t,r)=>{var i=null;let n=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,a=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/;t.exports=function(t){"use strict";var r={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(null!=t){if(!0===t.strict&&(r.strict=!0),!0===t.storeAsString&&(r.storeAsString=!0),r.alwaysParseAsBig=!0===t.alwaysParseAsBig&&t.alwaysParseAsBig,r.useNativeBigInt=!0===t.useNativeBigInt&&t.useNativeBigInt,void 0!==t.constructorAction)if("error"===t.constructorAction||"ignore"===t.constructorAction||"preserve"===t.constructorAction)r.constructorAction=t.constructorAction;else throw Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${t.constructorAction}`);if(void 0!==t.protoAction)if("error"===t.protoAction||"ignore"===t.protoAction||"preserve"===t.protoAction)r.protoAction=t.protoAction;else throw Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${t.protoAction}`)}var s,o,l,u,c={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},d=function(e){throw{name:"SyntaxError",message:e,at:s,text:l}},h=function(e){return e&&e!==o&&d("Expected '"+e+"' instead of '"+o+"'"),o=l.charAt(s),s+=1,o},p=function(){var t,n="";for("-"===o&&(n="-",h("-"));o>="0"&&o<="9";)n+=o,h();if("."===o)for(n+=".";h()&&o>="0"&&o<="9";)n+=o;if("e"===o||"E"===o)for(n+=o,h(),("-"===o||"+"===o)&&(n+=o,h());o>="0"&&o<="9";)n+=o,h();if(isFinite(t=+n))return(null==i&&(i=e.r(332768)),n.length>15)?r.storeAsString?n:r.useNativeBigInt?BigInt(n):new i(n):r.alwaysParseAsBig?r.useNativeBigInt?BigInt(t):new i(t):t;d("Bad number")},f=function(){var e,t,r,i="";if('"'===o)for(var n=s;h();){if('"'===o)return s-1>n&&(i+=l.substring(n,s-1)),h(),i;if("\\"===o){if(s-1>n&&(i+=l.substring(n,s-1)),h(),"u"===o){for(t=0,r=0;t<4&&isFinite(e=parseInt(h(),16));t+=1)r=16*r+e;i+=String.fromCharCode(r)}else if("string"==typeof c[o])i+=c[o];else break;n=s}}d("Bad string")},m=function(){for(;o&&o<=" ";)h()},g=function(){switch(o){case"t":return h("t"),h("r"),h("u"),h("e"),!0;case"f":return h("f"),h("a"),h("l"),h("s"),h("e"),!1;case"n":return h("n"),h("u"),h("l"),h("l"),null}d("Unexpected '"+o+"'")},y=function(){var e=[];if("["===o){if(h("["),m(),"]"===o)return h("]"),e;for(;o;){if(e.push(u()),m(),"]"===o)return h("]"),e;h(","),m()}}d("Bad array")},_=function(){var e,t=Object.create(null);if("{"===o){if(h("{"),m(),"}"===o)return h("}"),t;for(;o;){if(e=f(),m(),h(":"),!0===r.strict&&Object.hasOwnProperty.call(t,e)&&d('Duplicate key "'+e+'"'),!0===n.test(e)?"error"===r.protoAction?d("Object contains forbidden prototype property"):"ignore"===r.protoAction?u():t[e]=u():!0===a.test(e)?"error"===r.constructorAction?d("Object contains forbidden constructor property"):"ignore"===r.constructorAction?u():t[e]=u():t[e]=u(),m(),"}"===o)return h("}"),t;h(","),m()}}d("Bad object")};return u=function(){switch(m(),o){case"{":return _();case"[":return y();case'"':return f();case"-":return p();default:return o>="0"&&o<="9"?p():g()}},function(e,t){var r;return l=e+"",s=0,o=" ",r=u(),m(),o&&d("Syntax error"),"function"==typeof t?function e(r,i){var n,a=r[i];return a&&"object"==typeof a&&Object.keys(a).forEach(function(t){void 0!==(n=e(a,t))?a[t]=n:delete a[t]}),t.call(r,i,a)}({"":r},""):r}}},796373,(e,t,r)=>{var i=e.r(231156).stringify,n=e.r(420279);t.exports=function(e){return{parse:n(e),stringify:i}},t.exports.parse=n(),t.exports.stringify=i},22531,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Colours=void 0;class i{static isEnabled(e){return e&&e.isTTY&&("function"!=typeof e.getColorDepth||e.getColorDepth()>2)}static refresh(){i.enabled=i.isEnabled(null==process?void 0:process.stderr),this.enabled?(i.reset="\x1b[0m",i.bright="\x1b[1m",i.dim="\x1b[2m",i.red="\x1b[31m",i.green="\x1b[32m",i.yellow="\x1b[33m",i.blue="\x1b[34m",i.magenta="\x1b[35m",i.cyan="\x1b[36m",i.white="\x1b[37m",i.grey="\x1b[90m"):(i.reset="",i.bright="",i.dim="",i.red="",i.green="",i.yellow="",i.blue="",i.magenta="",i.cyan="",i.white="",i.grey="")}}r.Colours=i,i.enabled=!1,i.reset="",i.bright="",i.dim="",i.red="",i.green="",i.yellow="",i.blue="",i.magenta="",i.cyan="",i.white="",i.grey="",i.refresh()},801908,(e,t,r)=>{"use strict";let i;var n,a,s,o=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),l=e.e&&e.e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),u=e.e&&e.e.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),i=0;i<r.length;i++)"default"!==r[i]&&o(t,e,r[i]);return l(t,e),t});Object.defineProperty(r,"__esModule",{value:!0}),r.env=r.DebugLogBackendBase=r.placeholder=r.AdhocDebugLogger=r.LogSeverity=void 0,r.getNodeBackend=y,r.getDebugBackend=function(e){return new _(e)},r.getStructuredBackend=function(e){return new v(e)},r.setBackend=function(e){i=e,b.clear()},r.log=w;let c=e.r(427699),d=u(e.r(605365)),h=u(e.r(224361)),p=e.r(22531);(a=s||(r.LogSeverity=s={})).DEFAULT="DEFAULT",a.DEBUG="DEBUG",a.INFO="INFO",a.WARNING="WARNING",a.ERROR="ERROR";class f extends c.EventEmitter{constructor(e,t){super(),this.namespace=e,this.upstream=t,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(e,t)=>this.on(e,t)}),this.func.debug=(...e)=>this.invokeSeverity(s.DEBUG,...e),this.func.info=(...e)=>this.invokeSeverity(s.INFO,...e),this.func.warn=(...e)=>this.invokeSeverity(s.WARNING,...e),this.func.error=(...e)=>this.invokeSeverity(s.ERROR,...e),this.func.sublog=e=>w(e,this.func)}invoke(e,...t){if(this.upstream)try{this.upstream(e,...t)}catch(e){}try{this.emit("log",e,t)}catch(e){}}invokeSeverity(e,...t){this.invoke({severity:e},...t)}}r.AdhocDebugLogger=f,r.placeholder=new f("",()=>{}).func;class m{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let t=null!=(e=d.env[r.env.nodeEnables])?e:"*";"all"===t&&(t="*"),this.filters=t.split(",")}log(e,t,...r){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let i=this.cached.get(e);i||(i=this.makeLogger(e),this.cached.set(e,i)),i(t,...r)}catch(e){console.error(e)}}}r.DebugLogBackendBase=m;class g extends m{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(t,...r)=>{var i;let n,a=`${p.Colours.green}${e}${p.Colours.reset}`,o=`${p.Colours.yellow}${d.pid}${p.Colours.reset}`;switch(t.severity){case s.ERROR:n=`${p.Colours.red}${t.severity}${p.Colours.reset}`;break;case s.INFO:n=`${p.Colours.magenta}${t.severity}${p.Colours.reset}`;break;case s.WARNING:n=`${p.Colours.yellow}${t.severity}${p.Colours.reset}`;break;default:n=null!=(i=t.severity)?i:s.DEFAULT}let l=h.formatWithOptions({colors:p.Colours.enabled},...r),u=Object.assign({},t);delete u.severity;let c=Object.getOwnPropertyNames(u).length?JSON.stringify(u):"",f=c?`${p.Colours.grey}${c}${p.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",o,a,n,l,c?` ${f}`:"")}:()=>{}}setFilters(){let e=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=RegExp(`^${e}$`,"i")}}function y(){return new g}class _ extends m{constructor(e){super(),this.debugPkg=e}makeLogger(e){let t=this.debugPkg(e);return(e,...r)=>{t(r[0],...r.slice(1))}}setFilters(){var e;let t=null!=(e=d.env.NODE_DEBUG)?e:"";d.env.NODE_DEBUG=`${t}${t?",":""}${this.filters.join(",")}`}}class v extends m{constructor(e){super(),this.upstream=null!=e?e:void 0}makeLogger(e){var t;let r=null==(t=this.upstream)?void 0:t.makeLogger(e);return(e,...t)=>{var i;let n=JSON.stringify(Object.assign({severity:null!=(i=e.severity)?i:s.INFO,message:h.format(...t)},e));r?r(e,n):console.log("%s",n)}}setFilters(){var e;null==(e=this.upstream)||e.setFilters()}}r.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};let b=new Map;function w(e,t){let n;if(!i&&!d.env[r.env.nodeEnables]||!e)return r.placeholder;t&&(e=`${t.instance.namespace}:${e}`);let a=b.get(e);if(a)return a.func;if(null===i)return r.placeholder;void 0===i&&(i=y());let s=new f(e,(t,...r)=>{if(n!==i){if(null===i)return;void 0===i&&(i=y()),n=i}null==i||i.log(e,t,...r)});return b.set(e,s),s.func}},642824,(e,t,r)=>{"use strict";var i=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),n(e.r(801908),r)},778600,(e,t,r)=>{"use strict";let i;var n,a=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=e.e&&e.e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e.e&&e.e.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),i=0;i<r.length;i++)"default"!==r[i]&&a(t,e,r[i]);return s(t,e),t}),l=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.gcpResidencyCache=r.METADATA_SERVER_DETECTION=r.HEADERS=r.HEADER_VALUE=r.HEADER_NAME=r.SECONDARY_HOST_ADDRESS=r.HOST_ADDRESS=r.BASE_PATH=void 0,r.instance=function(e){return m("instance",e)},r.project=function(e){return m("project",e)},r.universe=function(e){return m("universe",e)},r.bulk=y,r.isAvailable=_,r.resetIsAvailableCache=function(){i=void 0},r.getGCPResidency=v,r.setGCPResidency=b,r.requestTimeout=w;let u=e.r(401606),c=e.r(796373),d=e.r(199578),h=o(e.r(642824));r.BASE_PATH="/computeMetadata/v1",r.HOST_ADDRESS="http://169.254.169.254",r.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.",r.HEADER_NAME="Metadata-Flavor",r.HEADER_VALUE="Google",r.HEADERS=Object.freeze({[r.HEADER_NAME]:r.HEADER_VALUE});let p=h.log("gcp-metadata");function f(e){return e||(e=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||r.HOST_ADDRESS),/^https?:\/\//.test(e)||(e=`http://${e}`),new URL(r.BASE_PATH,e).href}async function m(e,t={},i=3,n=!1){let a=new Headers(r.HEADERS),s="",o={};("object"==typeof e?(new Headers(e.headers).forEach((e,t)=>a.set(t,e)),s=e.metadataKey,o=e.params||o,i=e.noResponseRetries||i,n=e.fastFail||n):s=e,"string"==typeof t)?s+=`/${t}`:(Object.keys(t).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw Error(`'${e}' is not a valid configuration option.`)}}),t.property&&(s+=`/${t.property}`),new Headers(t.headers).forEach((e,t)=>a.set(t,e)),o=t.params||o);let l=n?g:u.request,d={url:`${f()}/${s}`,headers:a,retryConfig:{noResponseRetries:i},params:o,responseType:"text",timeout:w()};p.info("instance request %j",d);let h=await l(d);p.info("instance metadata is %s",h.data);let y=h.headers.get(r.HEADER_NAME);if(y!==r.HEADER_VALUE)throw RangeError(`Invalid response from metadata service: incorrect ${r.HEADER_NAME} header. Expected '${r.HEADER_VALUE}', got ${y?`'${y}'`:"no header"}`);if("string"==typeof h.data)try{return c.parse(h.data)}catch{}return h.data}async function g(e){let t={...e,url:e.url?.toString().replace(f(),f(r.SECONDARY_HOST_ADDRESS))};return Promise.any([(0,u.request)(e),(0,u.request)(t)])}async function y(e){let t={};return await Promise.all(e.map(e=>(async()=>{let r=await m(e);t[e.metadataKey]=r})())),t}async function _(){if(process.env.METADATA_SERVER_DETECTION){let e=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(e in r.METADATA_SERVER_DETECTION))throw RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${e}\`, but it should be \`${Object.keys(r.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(e){case"assume-present":return!0;case"none":return!1;case"bios-only":return v()}}try{return void 0===i&&(i=m("instance",void 0,process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0,!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await i,!0}catch(e){if(process.env.DEBUG_AUTH&&console.info(e),"request-timeout"===e.type||e.response&&404===e.response.status)return!1;if(!(e.response&&404===e.response.status)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let t="UNKNOWN";e.code&&(t=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${t}`,"MetadataLookupWarning")}return!1}}function v(){return null===r.gcpResidencyCache&&b(),r.gcpResidencyCache}function b(e=null){r.gcpResidencyCache=null!==e?e:(0,d.detectGCPResidency)()}function w(){return 3e3*!v()}r.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"}),r.gcpResidencyCache=null,l(e.r(199578),r)},198991,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fromArrayBufferToHex=function(e){return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}},671170,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BrowserCrypto=void 0;let i=e.r(193484),n=e.r(198991);class a{constructor(){throw Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return i.fromByteArray(new Uint8Array(r))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),i.fromByteArray(t)}static padBase64(e){for(;e.length%4!=0;)e+="=";return e}async verify(e,t,r){let n={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},s=new TextEncoder().encode(t),o=i.toByteArray(a.padBase64(r)),l=await window.crypto.subtle.importKey("jwk",e,n,!0,["verify"]);return await window.crypto.subtle.verify(n,l,o,s)}async sign(e,t){let r={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},n=new TextEncoder().encode(t),a=await window.crypto.subtle.importKey("jwk",e,r,!0,["sign"]),s=await window.crypto.subtle.sign(r,a,n);return i.fromByteArray(new Uint8Array(s))}decodeBase64StringUtf8(e){let t=i.toByteArray(a.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return i.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return(0,n.fromArrayBufferToHex)(r)}async signWithHmacSha256(e,t){let r="string"==typeof e?e:String.fromCharCode(...new Uint16Array(e)),i=new TextEncoder,n=await window.crypto.subtle.importKey("raw",i.encode(r),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",n,i.encode(t))}}r.BrowserCrypto=a},912248,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NodeCrypto=void 0;let i=e.r(254799);r.NodeCrypto=class{async sha256DigestBase64(e){return i.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return i.randomBytes(e).toString("base64")}async verify(e,t,r){let n=i.createVerify("RSA-SHA256");return n.update(t),n.end(),n.verify(e,r,"base64")}async sign(e,t){let r=i.createSign("RSA-SHA256");return r.update(t),r.end(),r.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return i.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){var r,n;let a="string"==typeof e?e:(r=e,Buffer.from(r));return(n=i.createHmac("sha256",a).update(t).digest()).buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}}},833341,(e,t,r)=>{"use strict";var i=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.createCrypto=function(){return function(){;}(),new a.NodeCrypto},r.hasBrowserCrypto=s,e.r(671170);let a=e.r(912248);function s(){return!1}n(e.r(198991),r)},541846,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LRUCache=void 0,r.snakeToCamel=o,r.originalOrCamelOptions=function(e){return{get:function(t){let r=e||{};return r[t]??r[o(t)]}}},r.removeUndefinedValuesInObject=function(e){return Object.entries(e).forEach(([t,r])=>{(void 0===r||"undefined"===r)&&delete e[t]}),e},r.isValidFile=u,r.getWellKnownCertificateConfigFileLocation=function(){let e=process.env.CLOUDSDK_CONFIG||(n.platform().startsWith("win")?a.join(process.env.APPDATA||"",s):a.join(process.env.HOME||"",".config",s));return a.join(e,"certificate_config.json")};let i=e.r(522734),n=e.r(446786),a=e.r(814747),s="gcloud";function o(e){return e.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}class l{capacity;#u=new Map;maxAge;constructor(e){this.capacity=e.capacity,this.maxAge=e.maxAge}#c(e,t){this.#u.delete(e),this.#u.set(e,{value:t,lastAccessed:Date.now()})}set(e,t){this.#c(e,t),this.#d()}get(e){let t=this.#u.get(e);if(t)return this.#c(e,t.value),this.#d(),t.value}#d(){let e=this.maxAge?Date.now()-this.maxAge:0,t=this.#u.entries().next();for(;!t.done&&(this.#u.size>this.capacity||t.value[1].lastAccessed<e);)this.#u.delete(t.value[0]),t=this.#u.entries().next()}}async function u(e){try{return(await i.promises.lstat(e)).isFile()}catch(e){return!1}}r.LRUCache=l},572570,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.USER_AGENT=r.PRODUCT_NAME=r.pkg=void 0;let i=e.r(885083);r.pkg=i;let n="google-api-nodejs-client";r.PRODUCT_NAME=n,r.USER_AGENT=`${n}/${i.version}`},584950,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AuthClient=r.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=r.DEFAULT_UNIVERSE=void 0;let i=e.r(427699),n=e.r(401606),a=e.r(541846),s=e.r(642824),o=e.r(572570);r.DEFAULT_UNIVERSE="googleapis.com",r.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=3e5;class l extends i.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=r.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=r.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(e={}){super();const t=(0,a.originalOrCamelOptions)(e);this.apiKey=e.apiKey,this.projectId=t.get("project_id")??null,this.quotaProjectId=t.get("quota_project_id"),this.credentials=t.get("credentials")??{},this.universeDomain=t.get("universe_domain")??r.DEFAULT_UNIVERSE,this.transporter=e.transporter??new n.Gaxios(e.transporterOptions),!1!==t.get("useAuthRequestParameters")&&(this.transporter.interceptors.request.add(l.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(l.DEFAULT_RESPONSE_INTERCEPTOR)),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=e.forceRefreshOnFailure??!1}fetch(...e){let t,r=e[0],i=e[1],a=new Headers;return("string"==typeof r?t=new URL(r):r instanceof URL?t=r:r&&r.url&&(t=new URL(r.url)),r&&"object"==typeof r&&"headers"in r&&n.Gaxios.mergeHeaders(a,r.headers),i&&n.Gaxios.mergeHeaders(a,new Headers(i.headers)),"object"!=typeof r||r instanceof URL)?this.request({...i,headers:a,url:t}):this.request({...i,...r,headers:a,url:t})}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e.has("x-goog-user-project")&&this.quotaProjectId&&e.set("x-goog-user-project",this.quotaProjectId),e}addUserProjectAndAuthHeaders(e,t){let r=t.get("x-goog-user-project"),i=t.get("authorization");return r&&e.set("x-goog-user-project",r),i&&e.set("authorization",i),e}static log=(0,s.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async e=>{if(!e.headers.has("x-goog-api-client")){let t=process.version.replace(/^v/,"");e.headers.set("x-goog-api-client",`gl-node/${t}`)}let t=e.headers.get("User-Agent");t?t.includes(`${o.PRODUCT_NAME}/`)||e.headers.set("User-Agent",`${t} ${o.USER_AGENT}`):e.headers.set("User-Agent",o.USER_AGENT);try{let t=e[l.RequestMethodNameSymbol],r=`${Math.floor(1e3*Math.random())}`;e[l.RequestLogIdSymbol]=r;let i={url:e.url,headers:e.headers};t?l.log.info("%s [%s] request %j",t,r,i):l.log.info("[%s] request %j",r,i)}catch(e){}return e}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async e=>{try{let t=e.config,r=t[l.RequestMethodNameSymbol],i=t[l.RequestLogIdSymbol];r?l.log.info("%s [%s] response %j",r,i,e.data):l.log.info("[%s] response %j",i,e.data)}catch(e){}return e},rejected:async e=>{try{let t=e.config,r=t[l.RequestMethodNameSymbol],i=t[l.RequestLogIdSymbol];r?l.log.info("%s [%s] error %j",r,i,e.response?.data):l.log.error("[%s] error %j",i,e.response?.data)}catch(e){}throw e}};static setMethodName(e,t){try{e[l.RequestMethodNameSymbol]=t}catch(e){}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}r.AuthClient=l},898724,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoginTicket=void 0,r.LoginTicket=class{envelope;payload;constructor(e,t){this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}}},93628,(e,t,r)=>{"use strict";var i,n,a,s,o,l;Object.defineProperty(r,"__esModule",{value:!0}),r.OAuth2Client=r.ClientAuthentication=r.CertificateFormat=r.CodeChallengeMethod=void 0;let u=e.r(401606),c=e.r(145706),d=e.r(688947),h=e.r(384423),p=e.r(541846),f=e.r(833341),m=e.r(584950),g=e.r(898724);(s=i||(r.CodeChallengeMethod=i={})).Plain="plain",s.S256="S256",(o=n||(r.CertificateFormat=n={})).PEM="PEM",o.JWK="JWK",(l=a||(r.ClientAuthentication=a={})).ClientSecretPost="ClientSecretPost",l.ClientSecretBasic="ClientSecretBasic",l.None="None";class y extends m.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=n.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(e={},t,r){super("object"==typeof e?e:{}),"object"!=typeof e&&(e={clientId:e,clientSecret:t,redirectUri:r}),this._clientId=e.clientId||e.client_id,this._clientSecret=e.clientSecret||e.client_secret,this.redirectUri=e.redirectUri||e.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...e.endpoints},this.clientAuthentication=e.clientAuthentication||a.ClientSecretPost,this.issuers=e.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+c.stringify(e)}generateCodeVerifier(){throw Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,f.createCrypto)(),t=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),r=(await e.sha256DigestBase64(t)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:t,codeChallenge:r}}getToken(e,t){let r="string"==typeof e?{code:e}:e;if(!t)return this.getTokenAsync(r);this.getTokenAsync(r).then(e=>t(null,e.tokens,e.res),e=>t(e,null,e.response))}async getTokenAsync(e){let t=this.endpoints.oauth2TokenUrl.toString(),r=new Headers,i={client_id:e.client_id||this._clientId,code_verifier:e.codeVerifier,code:e.code,grant_type:"authorization_code",redirect_uri:e.redirect_uri||this.redirectUri};if(this.clientAuthentication===a.ClientSecretBasic){let e=Buffer.from(`${this._clientId}:${this._clientSecret}`);r.set("authorization",`Basic ${e.toString("base64")}`)}this.clientAuthentication===a.ClientSecretPost&&(i.client_secret=this._clientSecret);let n={...y.RETRY_CONFIG,method:"POST",url:t,data:new URLSearchParams((0,p.removeUndefinedValuesInObject)(i)),headers:r};m.AuthClient.setMethodName(n,"getTokenAsync");let s=await this.transporter.request(n),o=s.data;return s.data&&s.data.expires_in&&(o.expiry_date=new Date().getTime()+1e3*s.data.expires_in,delete o.expires_in),this.emit("tokens",o),{tokens:o,res:s}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let t=this.refreshTokenNoCache(e).then(t=>(this.refreshTokenPromises.delete(e),t),t=>{throw this.refreshTokenPromises.delete(e),t});return this.refreshTokenPromises.set(e,t),t}async refreshTokenNoCache(e){let t;if(!e)throw Error("No refresh token is set.");let r=this.endpoints.oauth2TokenUrl.toString(),i={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"};try{let e={...y.RETRY_CONFIG,method:"POST",url:r,data:new URLSearchParams((0,p.removeUndefinedValuesInObject)(i))};m.AuthClient.setMethodName(e,"refreshTokenNoCache"),t=await this.transporter.request(e)}catch(e){throw e instanceof u.GaxiosError&&"invalid_grant"===e.message&&e.response?.data&&/ReAuth/i.test(e.response.data.error_description)&&(e.message=JSON.stringify(e.response.data)),e}let n=t.data;return t.data&&t.data.expires_in&&(n.expiry_date=new Date().getTime()+1e3*t.data.expires_in,delete n.expires_in),this.emit("tokens",n),{tokens:n,res:t}}refreshAccessToken(e){if(!e)return this.refreshAccessTokenAsync();this.refreshAccessTokenAsync().then(t=>e(null,t.credentials,t.res),e)}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),t=e.tokens;return t.refresh_token=this.credentials.refresh_token,this.credentials=t,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(!e)return this.getAccessTokenAsync();this.getAccessTokenAsync().then(t=>e(null,t.token,t.res),e)}async getAccessTokenAsync(){if(!(!this.credentials.access_token||this.isTokenExpiring()))return{token:this.credentials.access_token};{if(!this.credentials.refresh_token)if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(e?.access_token)return this.setCredentials(e),{token:this.credentials.access_token}}else throw Error("No refresh token or refresh handler callback is set.");let e=await this.refreshAccessTokenAsync();if(!e.credentials||e.credentials&&!e.credentials.access_token)throw Error("Could not refresh access token.");return{token:e.credentials.access_token,res:e.res}}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let t=this.credentials;if(!t.access_token&&!t.refresh_token&&!this.apiKey&&!this.refreshHandler)throw Error("No access, refresh token, API key or refresh handler callback is set.");if(t.access_token&&!this.isTokenExpiring()){t.token_type=t.token_type||"Bearer";let e=new Headers({authorization:t.token_type+" "+t.access_token});return{headers:this.addSharedMetadataHeaders(e)}}if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(e?.access_token){this.setCredentials(e);let t=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(t)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let r=null,i=null;try{i=(r=await this.refreshToken(t.refresh_token)).tokens}catch(e){throw e.response&&(403===e.response.status||404===e.response.status)&&(e.message=`Could not refresh access token: ${e.message}`),e}let n=this.credentials;n.token_type=n.token_type||"Bearer",i.refresh_token=n.refresh_token,this.credentials=i;let a=new Headers({authorization:n.token_type+" "+i.access_token});return{headers:this.addSharedMetadataHeaders(a),res:r.res}}static getRevokeTokenUrl(e){return new y().getRevokeTokenURL(e).toString()}getRevokeTokenURL(e){let t=new URL(this.endpoints.oauth2RevokeUrl);return t.searchParams.append("token",e),t}revokeToken(e,t){let r={...y.RETRY_CONFIG,url:this.getRevokeTokenURL(e).toString(),method:"POST"};if(m.AuthClient.setMethodName(r,"revokeToken"),!t)return this.transporter.request(r);this.transporter.request(r).then(e=>t(null,e),t)}revokeCredentials(e){if(!e)return this.revokeCredentialsAsync();this.revokeCredentialsAsync().then(t=>e(null,t),e)}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw Error("No access token to revoke.")}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){try{let t=await this.getRequestMetadataAsync();return e.headers=u.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t.headers),this.apiKey&&e.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(e)}catch(i){let r=i.response;if(r){let i=r.status,n=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),a=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,s=r.config.data instanceof d.Readable,o=401===i||403===i;if(!t&&o&&!s&&n)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!t&&o&&!s&&a){let t=await this.processAndValidateRefreshHandler();return t?.access_token&&this.setCredentials(t),this.requestAsync(e,!0)}}throw i}}verifyIdToken(e,t){if(t&&"function"!=typeof t)throw Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(!t)return this.verifyIdTokenAsync(e);this.verifyIdTokenAsync(e).then(e=>t(null,e),t)}async verifyIdTokenAsync(e){if(!e.idToken)throw Error("The verifyIdToken method requires an ID Token");let t=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,t.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:t}=await this.transporter.request({...y.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),r=Object.assign({expiry_date:new Date().getTime()+1e3*t.expires_in,scopes:t.scope.split(" ")},t);return delete r.expires_in,delete r.scope,r}getFederatedSignonCerts(e){if(!e)return this.getFederatedSignonCertsAsync();this.getFederatedSignonCertsAsync().then(t=>e(null,t.certs,t.res),e)}async getFederatedSignonCertsAsync(){let e,t,r=new Date().getTime(),i=(0,f.hasBrowserCrypto)()?n.JWK:n.PEM;if(this.certificateExpiry&&r<this.certificateExpiry.getTime()&&this.certificateCacheFormat===i)return{certs:this.certificateCache,format:i};switch(i){case n.PEM:t=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case n.JWK:t=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw Error(`Unsupported certificate format ${i}`)}try{let r={...y.RETRY_CONFIG,url:t};m.AuthClient.setMethodName(r,"getFederatedSignonCertsAsync"),e=await this.transporter.request(r)}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}let a=e?.headers.get("cache-control"),s=-1;if(a){let e=/max-age=(?<maxAge>[0-9]+)/.exec(a)?.groups?.maxAge;e&&(s=1e3*Number(e))}let o={};switch(i){case n.PEM:o=e.data;break;case n.JWK:for(let t of e.data.keys)o[t.kid]=t;break;default:throw Error(`Unsupported certificate format ${i}`)}let l=new Date;return this.certificateExpiry=-1===s?null:new Date(l.getTime()+s),this.certificateCache=o,this.certificateCacheFormat=i,{certs:o,format:i,res:e}}getIapPublicKeys(e){if(!e)return this.getIapPublicKeysAsync();this.getIapPublicKeysAsync().then(t=>e(null,t.pubkeys,t.res),e)}async getIapPublicKeysAsync(){let e,t=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let r={...y.RETRY_CONFIG,url:t};m.AuthClient.setMethodName(r,"getIapPublicKeysAsync"),e=await this.transporter.request(r)}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,t,r,i,n){let a,s,o=(0,f.createCrypto)();n||(n=y.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let l=e.split(".");if(3!==l.length)throw Error("Wrong number of segments in token: "+e);let u=l[0]+"."+l[1],c=l[2];try{a=JSON.parse(o.decodeBase64StringUtf8(l[0]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token envelope: ${l[0]}': ${e.message}`),e}if(!a)throw Error("Can't parse token envelope: "+l[0]);try{s=JSON.parse(o.decodeBase64StringUtf8(l[1]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token payload '${l[0]}`),e}if(!s)throw Error("Can't parse token payload: "+l[1]);if(!Object.prototype.hasOwnProperty.call(t,a.kid))throw Error("No pem found for envelope: "+JSON.stringify(a));let d=t[a.kid];if("ES256"===a.alg&&(c=h.joseToDer(c,"ES256").toString("base64")),!await o.verify(d,u,c))throw Error("Invalid token signature: "+e);if(!s.iat)throw Error("No issue time in token: "+JSON.stringify(s));if(!s.exp)throw Error("No expiration time in token: "+JSON.stringify(s));let p=Number(s.iat);if(isNaN(p))throw Error("iat field using invalid format");let m=Number(s.exp);if(isNaN(m))throw Error("exp field using invalid format");let _=new Date().getTime()/1e3;if(m>=_+n)throw Error("Expiration time too far in future: "+JSON.stringify(s));let v=p-y.CLOCK_SKEW_SECS_,b=m+y.CLOCK_SKEW_SECS_;if(_<v)throw Error("Token used too early, "+_+" < "+v+": "+JSON.stringify(s));if(_>b)throw Error("Token used too late, "+_+" > "+b+": "+JSON.stringify(s));if(i&&0>i.indexOf(s.iss))throw Error("Invalid issuer, expected one of ["+i+"], but got "+s.iss);if(null!=r){let e=s.aud;if(!(r.constructor===Array?r.indexOf(e)>-1:e===r))throw Error("Wrong recipient, payload audience != requiredAudience")}return new g.LoginTicket(a,s)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return!!e&&e<=new Date().getTime()+this.eagerRefreshThresholdMillis}}r.OAuth2Client=y},616722,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Compute=void 0;let i=e.r(401606),n=e.r(778600),a=e.r(93628);class s extends a.OAuth2Client{serviceAccountEmail;scopes;constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(){let e,t=`service-accounts/${this.serviceAccountEmail}/token`;try{let r={property:t};this.scopes.length>0&&(r.params={scopes:this.scopes.join(",")}),e=await n.instance(r)}catch(e){throw e instanceof i.GaxiosError&&(e.message=`Could not refresh access token: ${e.message}`,this.wrapError(e)),e}let r=e;return e&&e.expires_in&&(r.expiry_date=new Date().getTime()+1e3*e.expires_in,delete r.expires_in),this.emit("tokens",r),{tokens:r,res:null}}async fetchIdToken(e){let t,r=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`;try{t=await n.instance({property:r})}catch(e){throw e instanceof Error&&(e.message=`Could not fetch ID token: ${e.message}`),e}return t}wrapError(e){let t=e.response;t&&t.status&&(e.status=t.status,403===t.status?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:404===t.status&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}}r.Compute=s},263547,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.IdTokenClient=void 0;let i=e.r(93628);class n extends i.OAuth2Client{targetAudience;idTokenProvider;constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let e=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:e,expiry_date:this.getIdTokenExpiryDate(e)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(e){let t=e.split(".")[1];if(t)return 1e3*JSON.parse(Buffer.from(t,"base64").toString("ascii")).exp}}r.IdTokenClient=n},913187,(e,t,r)=>{"use strict";var i,n;let a;Object.defineProperty(r,"__esModule",{value:!0}),r.GCPEnv=void 0,r.clear=function(){a=void 0},r.getEnv=o;let s=e.r(778600);async function o(){return a||(a=l())}async function l(){i.NONE;return process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME?i.APP_ENGINE:process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET?i.CLOUD_FUNCTIONS:await c()?await u()?i.KUBERNETES_ENGINE:process.env.K_CONFIGURATION?i.CLOUD_RUN:process.env.CLOUD_RUN_JOB?i.CLOUD_RUN_JOBS:i.COMPUTE_ENGINE:i.NONE}async function u(){try{return await s.instance("attributes/cluster-name"),!0}catch(e){return!1}}async function c(){return s.isAvailable()}(n=i||(r.GCPEnv=i={})).APP_ENGINE="APP_ENGINE",n.KUBERNETES_ENGINE="KUBERNETES_ENGINE",n.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",n.COMPUTE_ENGINE="COMPUTE_ENGINE",n.CLOUD_RUN="CLOUD_RUN",n.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",n.NONE="NONE"},646994,(e,t,r)=>{var i=e.r(401573).Buffer,n=e.r(688947);function a(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=i.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=i.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick((function(){this.emit("end",e),this.readable=!1,this.emit("close")}).bind(this)),this;throw TypeError("Unexpected data type ("+typeof e+")")}e.r(224361).inherits(a,n),a.prototype.write=function(e){this.buffer=i.concat([this.buffer,i.from(e)]),this.emit("data",e)},a.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1},t.exports=a},115694,(e,t,r)=>{var i,n=e.r(401573).Buffer,a=e.r(254799),s=e.r(384423),o=e.r(224361),l="secret must be a string or buffer",u="key must be a string or a buffer",c="function"==typeof a.createPublicKey;function d(e){if(!n.isBuffer(e)&&"string"!=typeof e&&(!c||"object"!=typeof e||"string"!=typeof e.type||"string"!=typeof e.asymmetricKeyType||"function"!=typeof e.export))throw m(u)}function h(e){if(!n.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw m("key must be a string, a buffer or an object")}function p(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function f(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var r=0;r<t;++r)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function m(e){var t=[].slice.call(arguments,1);return TypeError(o.format.bind(o,e).apply(null,t))}function g(e){var t;return t=e,n.isBuffer(t)||"string"==typeof t||(e=JSON.stringify(e)),e}function y(e){return function(t,r){!function(e){if(!n.isBuffer(e)){if("string"!=typeof e){if(!c||"object"!=typeof e||"secret"!==e.type||"function"!=typeof e.export)throw m(l)}}}(r),t=g(t);var i=a.createHmac("sha"+e,r);return p((i.update(t),i.digest("base64")))}}c&&(u+=" or a KeyObject",l+="or a KeyObject");var _="timingSafeEqual"in a?function(e,t){return e.byteLength===t.byteLength&&a.timingSafeEqual(e,t)}:function(t,r){return i||(i=e.r(704503)),i(t,r)};function v(e){return function(t,r,i){var a=y(e)(t,i);return _(n.from(r),n.from(a))}}function b(e){return function(t,r){h(r),t=g(t);var i=a.createSign("RSA-SHA"+e);return p((i.update(t),i.sign(r,"base64")))}}function w(e){return function(t,r,i){d(i),t=g(t),r=f(r);var n=a.createVerify("RSA-SHA"+e);return n.update(t),n.verify(i,r,"base64")}}function E(e){return function(t,r){h(r),t=g(t);var i=a.createSign("RSA-SHA"+e);return p((i.update(t),i.sign({key:r,padding:a.constants.RSA_PKCS1_PSS_PADDING,saltLength:a.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function T(e){return function(t,r,i){d(i),t=g(t),r=f(r);var n=a.createVerify("RSA-SHA"+e);return n.update(t),n.verify({key:i,padding:a.constants.RSA_PKCS1_PSS_PADDING,saltLength:a.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function S(e){var t=b(e);return function(){var r=t.apply(null,arguments);return s.derToJose(r,"ES"+e)}}function I(e){var t=w(e);return function(r,i,n){return t(r,i=s.joseToDer(i,"ES"+e).toString("base64"),n)}}function O(){return function(){return""}}function A(){return function(e,t){return""===t}}t.exports=function(e){var t=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!t)throw m('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var r=(t[1]||t[3]).toLowerCase(),i=t[2];return{sign:({hs:y,rs:b,ps:E,es:S,none:O})[r](i),verify:({hs:v,rs:w,ps:T,es:I,none:A})[r](i)}}},269154,(e,t,r)=>{var i=e.r(500874).Buffer;t.exports=function(e){return"string"==typeof e?e:"number"==typeof e||i.isBuffer(e)?e.toString():JSON.stringify(e)}},725717,(e,t,r)=>{var i=e.r(401573).Buffer,n=e.r(646994),a=e.r(115694),s=e.r(688947),o=e.r(269154),l=e.r(224361);function u(e,t){return i.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function c(e){var t,r,i,n=e.header,s=e.payload,c=e.secret||e.privateKey,d=e.encoding,h=a(n.alg),p=(t=(t=d)||"utf8",r=u(o(n),"binary"),i=u(o(s),t),l.format("%s.%s",r,i)),f=h.sign(p,c);return l.format("%s.%s",p,f)}function d(e){var t=e.secret;if(t=null==(t=null==t?e.privateKey:t)?e.key:t,!0===/^hs/i.test(e.header.alg)&&null==t)throw TypeError("secret must be a string or buffer or a KeyObject");var r=new n(t);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=r,this.payload=new n(e.payload),this.secret.once("close",(function(){!this.payload.writable&&this.readable&&this.sign()}).bind(this)),this.payload.once("close",(function(){!this.secret.writable&&this.readable&&this.sign()}).bind(this))}l.inherits(d,s),d.prototype.sign=function(){try{var e=c({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},d.sign=c,t.exports=d},155005,(e,t,r)=>{var i=e.r(401573).Buffer,n=e.r(646994),a=e.r(115694),s=e.r(688947),o=e.r(269154),l=e.r(224361),u=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function c(e){var t=e.split(".",1)[0],r=i.from(t,"base64").toString("binary");if("[object Object]"===Object.prototype.toString.call(r))return r;try{return JSON.parse(r)}catch(e){return}}function d(e){return e.split(".")[2]}function h(e){return u.test(e)&&!!c(e)}function p(e,t,r){if(!t){var i=Error("Missing algorithm parameter for jws.verify");throw i.code="MISSING_ALGORITHM",i}var n=d(e=o(e)),s=e.split(".",2).join(".");return a(t).verify(s,n,r)}function f(e,t){if(t=t||{},!h(e=o(e)))return null;var r,n,a=c(e);if(!a)return null;var s=(r=r||"utf8",n=e.split(".")[1],i.from(n,"base64").toString(r));return("JWT"===a.typ||t.json)&&(s=JSON.parse(s,t.encoding)),{header:a,payload:s,signature:d(e)}}function m(e){var t=(e=e||{}).secret;if(t=null==(t=null==t?e.publicKey:t)?e.key:t,!0===/^hs/i.test(e.algorithm)&&null==t)throw TypeError("secret must be a string or buffer or a KeyObject");var r=new n(t);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=r,this.signature=new n(e.signature),this.secret.once("close",(function(){!this.signature.writable&&this.readable&&this.verify()}).bind(this)),this.signature.once("close",(function(){!this.secret.writable&&this.readable&&this.verify()}).bind(this))}l.inherits(m,s),m.prototype.verify=function(){try{var e=p(this.signature.buffer,this.algorithm,this.key.buffer),t=f(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},m.decode=f,m.isValid=h,m.verify=p,t.exports=m},536418,(e,t,r)=>{var i=e.r(725717),n=e.r(155005);r.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],r.sign=i.sign,r.verify=n.verify,r.decode=n.decode,r.isValid=n.isValid,r.createSign=function(e){return new i(e)},r.createVerify=function(e){return new n(e)}},844118,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GoogleToken=void 0;var i,n=u(e.r(522734)),a=e.r(401606),s=u(e.r(536418)),o=u(e.r(814747)),l=e.r(224361);function u(e,t){if("function"==typeof WeakMap)var r=new WeakMap,i=new WeakMap;return(u=function(e,t){if(!t&&e&&e.__esModule)return e;var n,a,s={__proto__:null,default:e};if(null===e||"object"!=c(e)&&"function"!=typeof e)return s;if(n=t?i:r){if(n.has(e))return n.get(e);n.set(e,s)}for(var o in e)"default"!==o&&({}).hasOwnProperty.call(e,o)&&((a=(n=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,o))&&(a.get||a.set)?n(s,o,a):s[o]=e[o]);return s})(e,t)}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function h(e,t,r){return e.set(p(e,t),r),r}function p(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw TypeError("Private element is not present on this object")}function f(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,E(i.key),i)}}function m(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function y(e){var t="function"==typeof Map?new Map:void 0;return(y=function(e){if(null===e||!function(e){try{return -1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(_())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var n=new(e.bind.apply(e,i));return r&&v(n,r.prototype),n}(e,arguments,b(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v(r,e)})(e)}function _(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_=function(){return!!e})()}function v(e,t){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t,r){return(t=E(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e){var t=function(e,t){if("object"!=c(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=c(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==c(t)?t:t+""}function T(){var e,t,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",n=r.toStringTag||"@@toStringTag";function a(r,i,n,a){var l=Object.create((i&&i.prototype instanceof o?i:o).prototype);return S(l,"_invoke",function(r,i,n){var a,o,l,u=0,c=n||[],d=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,o=0,l=e,h.n=r,s}};function p(r,i){for(o=r,l=i,t=0;!d&&u&&!n&&t<c.length;t++){var n,a=c[t],p=h.p,f=a[2];r>3?(n=f===i)&&(l=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=p&&((n=r<2&&p<a[1])?(o=0,h.v=i,h.n=a[1]):p<f&&(n=r<3||a[0]>i||i>f)&&(a[4]=r,a[5]=i,h.n=f,o=0))}if(n||r>1)return s;throw d=!0,i}return function(n,c,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&p(c,f),o=c,l=f;(t=o<2?e:l)||!d;){a||(o?o<3?(o>1&&(h.n=-1),p(o,l)):h.n=l:h.v=l);try{if(u=2,a){if(o||(n="next"),t=a[n]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=a.return)&&t.call(a),o<2&&(l=TypeError("The iterator does not provide a '"+n+"' method"),o=1);a=e}else if((t=(d=h.n<0)?l:r.call(i,h))!==s)break}catch(t){a=e,o=1,l=t}finally{u=1}}return{value:t,done:d}}}(r,n,a),!0),l}var s={};function o(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=u.prototype=o.prototype=Object.create([][i]?t(t([][i]())):(S(t={},i,function(){return this}),t));function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,S(e,n,"GeneratorFunction")),e.prototype=Object.create(c),e}return l.prototype=u,S(c,"constructor",u),S(u,"constructor",l),l.displayName="GeneratorFunction",S(u,n,"GeneratorFunction"),S(c),S(c,n,"Generator"),S(c,i,function(){return this}),S(c,"toString",function(){return"[object Generator]"}),(T=function(){return{w:a,m:d}})()}function S(e,t,r,i){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}(S=function(e,t,r,i){if(t)n?n(e,t,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[t]=r;else{var a=function(t,r){S(e,t,function(e){return this._invoke(t,r,e)})};a("next",0),a("throw",1),a("return",2)}})(e,t,r,i)}function I(e,t,r,i,n,a,s){try{var o=e[a](s),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(i,n)}function O(e){return function(){var t=this,r=arguments;return new Promise(function(i,n){var a=e.apply(t,r);function s(e){I(a,i,n,s,o,"next",e)}function o(e){I(a,i,n,s,o,"throw",e)}s(void 0)})}}var A=n.readFile?(0,l.promisify)(n.readFile):O(T().m(function e(){return T().w(function(e){for(;;)switch(e.n){case 0:throw new x("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},e)})),k="https://oauth2.googleapis.com/token",x=function(e){function t(e,r){var i,n,a;return g(this,t),n=t,a=[e],n=b(n),w(i=function(e,t){if(t&&("object"==c(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");var r=e;if(void 0===r)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r}(this,_()?Reflect.construct(n,a||[],b(this).constructor):n.apply(this,a)),"code",void 0),i.code=r,i}if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&v(t,e),m(t)}(y(Error)),$=new WeakMap,C=new WeakSet;function N(e){return P.apply(this,arguments)}function P(){return(P=O(T().m(function e(t){return T().w(function(e){for(;;)switch(e.n){case 0:if(!$.get(p($,this))||t.forceRefresh){e.n=1;break}return e.a(2,$.get(p($,this)));case 1:return e.p=1,e.n=2,h($,this,p(C,this,R).call(this,t));case 2:return e.a(2,e.v);case 3:return e.p=3,h($,this,void 0),e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])}))).apply(this,arguments)}function R(e){return j.apply(this,arguments)}function j(){return(j=O(T().m(function e(t){var r;return T().w(function(e){for(;;)switch(e.n){case 0:if(!1!==this.isTokenExpiring()||!1!==t.forceRefresh){e.n=1;break}return e.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){e.n=2;break}throw Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){e.n=4;break}return e.n=3,this.getCredentials(this.keyFile);case 3:r=e.v,this.key=r.privateKey,this.iss=r.clientEmail||this.iss,r.clientEmail||p(C,this,U).call(this);case 4:return e.a(2,p(C,this,z).call(this))}},e,this)}))).apply(this,arguments)}function U(){if(!this.iss)throw new x("email is required.","MISSING_CREDENTIALS")}function L(){return D.apply(this,arguments)}function D(){return(D=O(T().m(function e(){var t;return T().w(function(e){for(;;)switch(e.n){case 0:if(this.accessToken){e.n=1;break}throw Error("No token to revoke.");case 1:return t="https://oauth2.googleapis.com/revoke?token="+this.accessToken,e.n=2,this.transporter.request({url:t,retry:!0});case 2:p(C,this,M).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return e.a(2)}},e,this)}))).apply(this,arguments)}function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.keyFile=e.keyFile,this.key=e.key,this.rawToken=void 0,this.iss=e.email||e.iss,this.sub=e.sub,this.additionalClaims=e.additionalClaims,"object"===c(e.scope)?this.scope=e.scope.join(" "):this.scope=e.scope,this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,e.transporter&&(this.transporter=e.transporter)}function z(){return F.apply(this,arguments)}function F(){return(F=O(T().m(function e(){var t,r,i,n,a,o,l,u,c,d;return T().w(function(e){for(;;)switch(e.n){case 0:return t=Math.floor(new Date().getTime()/1e3),r=this.additionalClaims||{},i=Object.assign({iss:this.iss,scope:this.scope,aud:k,exp:t+3600,iat:t,sub:this.sub},r),n=s.sign({header:{alg:"RS256"},payload:i,secret:this.key}),e.p=1,e.n=2,this.transporter.request({method:"POST",url:k,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:n}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return a=e.v,this.rawToken=a.data,this.expiresAt=null===a.data.expires_in||void 0===a.data.expires_in?void 0:(t+a.data.expires_in)*1e3,e.a(2,this.rawToken);case 3:throw e.p=3,d=e.v,this.rawToken=void 0,this.tokenExpires=void 0,(u=d.response&&null!=(o=d.response)&&o.data?null==(l=d.response)?void 0:l.data:{}).error&&(c=u.error_description?": ".concat(u.error_description):"",d.message="".concat(u.error).concat(c)),d;case 4:return e.a(2)}},e,this,[[1,3]])}))).apply(this,arguments)}r.GoogleToken=m(function e(t){g(this,e),d(this,C),C.add(this),w(this,"expiresAt",void 0),w(this,"key",void 0),w(this,"keyFile",void 0),w(this,"iss",void 0),w(this,"sub",void 0),w(this,"scope",void 0),w(this,"rawToken",void 0),w(this,"tokenExpires",void 0),w(this,"email",void 0),w(this,"additionalClaims",void 0),w(this,"eagerRefreshThresholdMillis",void 0),w(this,"transporter",{request:function(e){return(0,a.request)(e)}}),d(this,$),$.set(this,void 0),p(C,this,M).call(this,t)},[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var e=new Date().getTime();return!this.rawToken||!this.expiresAt||e>=this.expiresAt}},{key:"isTokenExpiring",value:function(){var e,t=new Date().getTime(),r=null!=(e=this.eagerRefreshThresholdMillis)?e:0;return!this.rawToken||!this.expiresAt||this.expiresAt<=t+r}},{key:"getToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"===c(e)&&(t=e,e=void 0),t=Object.assign({forceRefresh:!1},t),e){var r=e;p(C,this,N).call(this,t).then(function(e){return r(null,e)},e);return}return p(C,this,N).call(this,t)}},{key:"getCredentials",value:(i=O(T().m(function e(t){var r,i,n,a,s;return T().w(function(e){for(;;)switch(e.n){case 0:e.n=".json"===(s=o.extname(t))?1:".der"===s||".crt"===s||".pem"===s?4:".p12"===s||".pfx"===s?6:7;break;case 1:return e.n=2,A(t,"utf8");case 2:if(i=(r=JSON.parse(e.v)).private_key,n=r.client_email,!(!i||!n)){e.n=3;break}throw new x("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return e.a(2,{privateKey:i,clientEmail:n});case 4:return e.n=5,A(t,"utf8");case 5:return a=e.v,e.a(2,{privateKey:a});case 6:throw new x("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new x("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return e.a(2)}},e)})),function(e){return i.apply(this,arguments)})},{key:"revokeToken",value:function(e){return e?void p(C,this,L).call(this).then(function(){return e()},e):p(C,this,L).call(this)}}])},748702,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.JWTAccess=void 0;let i=e.r(536418),n=e.r(541846),a={alg:"RS256",typ:"JWT"};class s{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new n.LRUCache({capacity:500,maxAge:36e5});constructor(e,t,r,i){this.email=e,this.key=t,this.keyId=r,this.eagerRefreshThresholdMillis=i??3e5}getCachedKey(e,t){let r=e;if(t&&Array.isArray(t)&&t.length?r=e?`${e}_${t.join("_")}`:`${t.join("_")}`:"string"==typeof t&&(r=e?`${e}_${t}`:t),!r)throw Error("Scopes or url must be provided");return r}getRequestHeaders(e,t,r){let n,o=this.getCachedKey(e,r),l=this.cache.get(o),u=Date.now();if(l&&l.expiration-u>this.eagerRefreshThresholdMillis)return new Headers(l.headers);let c=Math.floor(Date.now()/1e3),d=s.getExpirationTime(c);if(Array.isArray(r)&&(r=r.join(" ")),n=r?{iss:this.email,sub:this.email,scope:r,exp:d,iat:c}:{iss:this.email,sub:this.email,aud:e,exp:d,iat:c},t){for(let e in n)if(t[e])throw Error(`The '${e}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let h=this.keyId?{...a,kid:this.keyId}:a,p=Object.assign(n,t),f=i.sign({header:h,payload:p,secret:this.key}),m=new Headers({authorization:`Bearer ${f}`});return this.cache.set(o,{expiration:1e3*d,headers:m}),m}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,r)=>{e||r(Error("Must pass in a stream containing the service account auth settings."));let i="";e.setEncoding("utf8").on("data",e=>i+=e).on("error",r).on("end",()=>{try{let e=JSON.parse(i);this.fromJSON(e),t()}catch(e){r(e)}})})}}r.JWTAccess=s},304835,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.JWT=void 0;let i=e.r(844118),n=e.r(748702),a=e.r(93628),s=e.r(584950);class o extends a.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(e={}){super(e),this.email=e.email,this.keyFile=e.keyFile,this.key=e.key,this.keyId=e.keyId,this.scopes=e.scopes,this.subject=e.subject,this.additionalClaims=e.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let t=new o(this);return t.scopes=e,t}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let t=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==s.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==s.DEFAULT_UNIVERSE)throw RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${s.DEFAULT_UNIVERSE}`);if(!this.apiKey&&t)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:e}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${e.id_token}`}))}}else{let t;this.access||(this.access=new n.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis)),this.hasUserScopes()?t=this.scopes:e||(t=this.defaultScopes);let r=this.useJWTAccessWithScope||this.universeDomain!==s.DEFAULT_UNIVERSE,i=await this.access.getRequestHeaders(e??void 0,this.additionalClaims,r?t:void 0);return{headers:this.addSharedMetadataHeaders(i)}}return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:new Headers}}async fetchIdToken(e){let t=new i.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await t.getToken({forceRefresh:!0}),!t.idToken)throw Error("Unknown error: Failed to fetch ID token");return t.idToken}hasUserScopes(){return!!this.scopes&&this.scopes.length>0}hasAnyScopes(){return!!this.scopes&&!!(this.scopes.length>0)||!!this.defaultScopes&&!!(this.defaultScopes.length>0)}authorize(e){if(!e)return this.authorizeAsync();this.authorizeAsync().then(t=>e(null,t),e)}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(){let e=this.createGToken(),t={access_token:(await e.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:e.expiresAt,id_token:e.idToken};return this.emit("tokens",t),{res:null,tokens:t}}createGToken(){return this.gtoken||(this.gtoken=new i.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,r)=>{if(!e)throw Error("Must pass in a stream containing the service account auth settings.");let i="";e.setEncoding("utf8").on("error",r).on("data",e=>i+=e).on("end",()=>{try{let e=JSON.parse(i);this.fromJSON(e),t()}catch(e){r(e)}})})}fromAPIKey(e){if("string"!=typeof e)throw Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let e=this.createGToken(),t=await e.getCredentials(this.keyFile);return{private_key:t.privateKey,client_email:t.clientEmail}}throw Error("A key or a keyFile must be provided to getCredentials.")}}r.JWT=o},863909,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.UserRefreshClient=r.USER_REFRESH_ACCOUNT_TYPE=void 0;let i=e.r(93628),n=e.r(584950);r.USER_REFRESH_ACCOUNT_TYPE="authorized_user";class a extends i.OAuth2Client{_refreshToken;constructor(e,t,r,i,n){const a=e&&"object"==typeof e?e:{clientId:e,clientSecret:t,refreshToken:r,eagerRefreshThresholdMillis:i,forceRefreshOnFailure:n};super(a),this._refreshToken=a.refreshToken,this.credentials.refresh_token=a.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(e){let t={...a.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:e})};return n.AuthClient.setMethodName(t,"fetchIdToken"),(await this.transporter.request(t)).data.id_token}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the user refresh token");if("authorized_user"!==e.type)throw Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}async fromStreamAsync(e){return new Promise((t,r)=>{if(!e)return r(Error("Must pass in a stream containing the user refresh token."));let i="";e.setEncoding("utf8").on("error",r).on("data",e=>i+=e).on("end",()=>{try{let e=JSON.parse(i);return this.fromJSON(e),t()}catch(e){return r(e)}})})}static fromJSON(e){let t=new a;return t.fromJSON(e),t}}r.UserRefreshClient=a},934426,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Impersonated=r.IMPERSONATED_ACCOUNT_TYPE=void 0;let i=e.r(93628),n=e.r(401606),a=e.r(541846);r.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";class s extends i.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(e={}){if(super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=e.sourceClient??new i.OAuth2Client,this.targetPrincipal=e.targetPrincipal??"",this.delegates=e.delegates??[],this.targetScopes=e.targetScopes??[],this.lifetime=e.lifetime??3600,(0,a.originalOrCamelOptions)(e).get("universe_domain")){if(this.sourceClient.universeDomain!==this.universeDomain)throw RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`)}else this.universeDomain=this.sourceClient.universeDomain;this.endpoint=e.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(e){await this.sourceClient.getAccessToken();let t=`projects/-/serviceAccounts/${this.targetPrincipal}`,r=`${this.endpoint}/v1/${t}:signBlob`,i={delegates:this.delegates,payload:Buffer.from(e).toString("base64")};return(await this.sourceClient.request({...s.RETRY_CONFIG,url:r,data:i,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let e="projects/-/serviceAccounts/"+this.targetPrincipal,t=`${this.endpoint}/v1/${e}:generateAccessToken`,r={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},i=await this.sourceClient.request({...s.RETRY_CONFIG,url:t,data:r,method:"POST"}),n=i.data;return this.credentials.access_token=n.accessToken,this.credentials.expiry_date=Date.parse(n.expireTime),{tokens:this.credentials,res:i}}catch(r){if(!(r instanceof Error))throw r;let e=0,t="";if(r instanceof n.GaxiosError&&(e=r?.response?.data?.error?.status,t=r?.response?.data?.error?.message),e&&t)throw r.message=`${e}: unable to impersonate: ${t}`,r;throw r.message=`unable to impersonate: ${r}`,r}}async fetchIdToken(e,t){await this.sourceClient.getAccessToken();let r=`projects/-/serviceAccounts/${this.targetPrincipal}`,i=`${this.endpoint}/v1/${r}:generateIdToken`,n={delegates:this.delegates,audience:e,includeEmail:t?.includeEmail??!0,useEmailAzp:t?.includeEmail??!0};return(await this.sourceClient.request({...s.RETRY_CONFIG,url:i,data:n,method:"POST"})).data.token}}r.Impersonated=s},939063,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OAuthClientAuthHandler=void 0,r.getErrorFromOAuthErrorResponse=function(e,t){let r=e.error,i=e.error_description,n=e.error_uri,a=`Error code ${r}`;void 0!==i&&(a+=`: ${i}`),void 0!==n&&(a+=` - ${n}`);let s=Error(a);if(t){let e=Object.keys(t);t.stack&&e.push("stack"),e.forEach(e=>{"message"!==e&&Object.defineProperty(s,e,{value:t[e],writable:!1,enumerable:!0})})}return s};let i=e.r(401606),n=e.r(833341),a=["PUT","POST","PATCH"];class s{#h=(0,n.createCrypto)();#p;transporter;constructor(e){e&&"clientId"in e?(this.#p=e,this.transporter=new i.Gaxios):(this.#p=e?.clientAuthentication,this.transporter=e?.transporter||new i.Gaxios)}applyClientAuthenticationOptions(e,t){e.headers=i.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){if(t)e.headers=i.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${t}`});else if(this.#p?.confidentialClientType==="basic"){e.headers=i.Gaxios.mergeHeaders(e.headers);let t=this.#p.clientId,r=this.#p.clientSecret||"",n=this.#h.encodeBase64StringUtf8(`${t}:${r}`);i.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${n}`})}}injectAuthenticatedRequestBody(e){if(this.#p?.confidentialClientType==="request-body"){let t=(e.method||"GET").toUpperCase();if(!a.includes(t))throw Error(`${t} HTTP method does not support ${this.#p.confidentialClientType} client authentication`);let r=new Headers(e.headers).get("content-type");if(r?.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let t=new URLSearchParams(e.data??"");t.append("client_id",this.#p.clientId),t.append("client_secret",this.#p.clientSecret||""),e.data=t}else if(r?.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:this.#p.clientId,client_secret:this.#p.clientSecret||""});else throw Error(`${r} content-types are not supported with ${this.#p.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}r.OAuthClientAuthHandler=s},526806,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StsCredentials=void 0;let i=e.r(401606),n=e.r(584950),a=e.r(939063),s=e.r(541846);class o extends a.OAuthClientAuthHandler{#f;constructor(e={tokenExchangeEndpoint:""},t){("object"!=typeof e||e instanceof URL)&&(e={tokenExchangeEndpoint:e,clientAuthentication:t}),super(e),this.#f=e.tokenExchangeEndpoint}async exchangeToken(e,t,r){let l={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:e.scope?.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:e.actingParty?.actorToken,actor_token_type:e.actingParty?.actorTokenType,options:r&&JSON.stringify(r)},u={...o.RETRY_CONFIG,url:this.#f.toString(),method:"POST",headers:t,data:new URLSearchParams((0,s.removeUndefinedValuesInObject)(l))};n.AuthClient.setMethodName(u,"exchangeToken"),this.applyClientAuthenticationOptions(u);try{let e=await this.transporter.request(u),t=e.data;return t.res=e,t}catch(e){if(e instanceof i.GaxiosError&&e.response)throw(0,a.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}r.StsCredentials=o},745311,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BaseExternalAccountClient=r.CLOUD_RESOURCE_MANAGER=r.EXTERNAL_ACCOUNT_TYPE=r.EXPIRATION_TIME_OFFSET=void 0;let i=e.r(401606),n=e.r(688947),a=e.r(584950),s=e.r(526806),o=e.r(541846),l=e.r(572570),u="https://www.googleapis.com/auth/cloud-platform";r.EXPIRATION_TIME_OFFSET=3e5,r.EXTERNAL_ACCOUNT_TYPE="external_account",r.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";class c extends a.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#m=null;constructor(e){super(e);const t=(0,o.originalOrCamelOptions)(e),i=t.get("type");if(i&&i!==r.EXTERNAL_ACCOUNT_TYPE)throw Error(`Expected "${r.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);const n=t.get("client_id"),a=t.get("client_secret");this.tokenUrl=t.get("token_url")??"https://sts.{universeDomain}/v1/token".replace("{universeDomain}",this.universeDomain);const l=t.get("subject_token_type"),c=t.get("workforce_pool_user_project"),d=t.get("service_account_impersonation_url"),h=t.get("service_account_impersonation"),p=(0,o.originalOrCamelOptions)(h).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(t.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),n&&(this.clientAuth={confidentialClientType:"basic",clientId:n,clientSecret:a}),this.stsCredential=new s.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=t.get("scopes")||[u],this.cachedAccessToken=null,this.audience=t.get("audience"),this.subjectTokenType=l,this.workforcePoolUserProject=c;const f=RegExp("//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+");if(this.workforcePoolUserProject&&!this.audience.match(f))throw Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=d,this.serviceAccountImpersonationLifetime=p,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=3600),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let e=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return e?.groups?.email||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let t=await this.getRequestHeaders(),r={...c.RETRY_CONFIG,headers:t,url:`${this.cloudResourceManagerURL.toString()}${e}`};a.AuthClient.setMethodName(r,"getProjectId");let i=await this.transporter.request(r);return this.projectId=i.data.projectId,this.projectId}return null}async requestAsync(e,t=!1){let r;try{let t=await this.getRequestHeaders();e.headers=i.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),r=await this.transporter.request(e)}catch(i){let r=i.response;if(r){let i=r.status,a=r.config.data instanceof n.Readable;if(!t&&(401===i||403===i)&&!a&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw i}return r}async refreshAccessTokenAsync(){this.#m=this.#m||this.#g();try{return await this.#m}finally{this.#m=null}}async #g(){let e=await this.retrieveSubjectToken(),t={grantType:"urn:ietf:params:oauth:grant-type:token-exchange",audience:this.audience,requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[u]:this.getScopesArray()},r=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,i=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),n=await this.stsCredential.exchangeToken(t,i,r);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(n.access_token):n.expires_in?this.cachedAccessToken={access_token:n.access_token,expiry_date:new Date().getTime()+1e3*n.expires_in,res:n.res}:this.cachedAccessToken={access_token:n.access_token,res:n.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(e){let t=e.match(/\/projects\/([^/]+)/);return t?t[1]:null}async getImpersonatedAccessToken(e){let t={...c.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};a.AuthClient.setMethodName(t,"getImpersonatedAccessToken");let r=await this.transporter.request(t),i=r.data;return{access_token:i.accessToken,expiry_date:new Date(i.expireTime).getTime(),res:r}}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}getScopesArray(){return"string"==typeof this.scopes?[this.scopes]:this.scopes||[u]}getMetricsHeaderValue(){let e=process.version.replace(/^v/,""),t=void 0!==this.serviceAccountImpersonationUrl,r=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${l.pkg.version} google-byoid-sdk source/${r} sa-impersonation/${t} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}}r.BaseExternalAccountClient=c},753281,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FileSubjectTokenSupplier=void 0;let i=e.r(224361),n=e.r(522734),a=(0,i.promisify)(n.readFile??(()=>{})),s=(0,i.promisify)(n.realpath??(()=>{})),o=(0,i.promisify)(n.lstat??(()=>{}));r.FileSubjectTokenSupplier=class{filePath;formatType;subjectTokenFieldName;constructor(e){this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e,t=this.filePath;try{if(t=await s(t),!(await o(t)).isFile())throw Error()}catch(e){throw e instanceof Error&&(e.message=`The file at ${t} does not exist, or it is not a file. ${e.message}`),e}let r=await a(t,{encoding:"utf8"});if("text"===this.formatType?e=r:"json"===this.formatType&&this.subjectTokenFieldName&&(e=JSON.parse(r)[this.subjectTokenFieldName]),!e)throw Error("Unable to parse the subject_token from the credential_source file");return e}}},202886,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.UrlSubjectTokenSupplier=void 0;let i=e.r(584950);r.UrlSubjectTokenSupplier=class{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(e){this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let t,r={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};if(i.AuthClient.setMethodName(r,"getSubjectToken"),"text"===this.formatType?t=(await e.transporter.request(r)).data:"json"===this.formatType&&this.subjectTokenFieldName&&(t=(await e.transporter.request(r)).data[this.subjectTokenFieldName]),!t)throw Error("Unable to parse the subject_token from the credential_source URL");return t}}},662193,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CertificateSubjectTokenSupplier=r.InvalidConfigurationError=r.CertificateSourceUnavailableError=r.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;let i=e.r(541846),n=e.r(522734),a=e.r(254799),s=e.r(524836);r.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";class o extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}}r.CertificateSourceUnavailableError=o;class l extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}}r.InvalidConfigurationError=l,r.CertificateSubjectTokenSupplier=class{certificateConfigPath;trustChainPath;cert;key;constructor(e){if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new l("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new l("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=e.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new l("Cannot create mTLS Agent with missing certificate or key");return new s.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#y();let{certPath:e,keyPath:t}=await this.#_();return{cert:this.cert,key:this.key}=await this.#v(e,t),await this.#b(this.cert)}async #y(){let e=this.certificateConfigPath;if(e){if(await (0,i.isValidFile)(e))return e;throw new o(`Provided certificate config path is invalid: ${e}`)}let t=process.env[r.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(t){if(await (0,i.isValidFile)(t))return t;throw new o(`Path from environment variable "${r.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${t}`)}let n=(0,i.getWellKnownCertificateConfigFileLocation)();if(await (0,i.isValidFile)(n))return n;throw new o(`Could not find certificate configuration file. Searched override path, the "${r.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${n}).`)}async #_(){let e,t=this.certificateConfigPath;try{e=await n.promises.readFile(t,"utf8")}catch(e){throw new o(`Failed to read certificate config file at: ${t}`)}try{let r=JSON.parse(e),i=r?.cert_configs?.workload?.cert_path,n=r?.cert_configs?.workload?.key_path;if(!i||!n)throw new l(`Certificate config file (${t}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:i,keyPath:n}}catch(e){if(e instanceof l)throw e;throw new l(`Failed to parse certificate config from ${t}: ${e.message}`)}}async #v(e,t){let r,i;try{r=await n.promises.readFile(e),new a.X509Certificate(r)}catch(r){let t=r instanceof Error?r.message:String(r);throw new o(`Failed to read certificate file at ${e}: ${t}`)}try{i=await n.promises.readFile(t),(0,a.createPrivateKey)(i)}catch(r){let e=r instanceof Error?r.message:String(r);throw new o(`Failed to read private key file at ${t}: ${e}`)}return{cert:r,key:i}}async #b(e){let t=new a.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([t.raw.toString("base64")]);try{let e,r=((await n.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((e,t)=>{try{return new a.X509Certificate(e)}catch(r){let e=r instanceof Error?r.message:String(r);throw new l(`Failed to parse certificate at index ${t} in trust chain file ${this.trustChainPath}: ${e}`)}}),i=r.findIndex(e=>t.raw.equals(e.raw));if(-1===i)e=[t,...r];else if(0===i)e=r;else throw new l(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${i}).`);return JSON.stringify(e.map(e=>e.raw.toString("base64")))}catch(t){if(t instanceof l)throw t;let e=t instanceof Error?t.message:String(t);throw new o(`Failed to process certificate chain from ${this.trustChainPath}: ${e}`)}}}},903060,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.IdentityPoolClient=void 0;let i=e.r(745311),n=e.r(541846),a=e.r(753281),s=e.r(202886),o=e.r(662193),l=e.r(526806),u=e.r(401606);class c extends i.BaseExternalAccountClient{subjectTokenSupplier;constructor(e){super(e);const t=(0,n.originalOrCamelOptions)(e),r=t.get("credential_source"),i=t.get("subject_token_supplier");if(!r&&!i)throw Error("A credential source or subject token supplier must be specified.");if(r&&i)throw Error("Only one of credential source or subject token supplier can be specified.");if(i)this.subjectTokenSupplier=i,this.credentialSourceType="programmatic";else{const e=(0,n.originalOrCamelOptions)(r),t=(0,n.originalOrCamelOptions)(e.get("format")),i=t.get("type")||"text",l=t.get("subject_token_field_name");if("json"!==i&&"text"!==i)throw Error(`Invalid credential_source format "${i}"`);if("json"===i&&!l)throw Error("Missing subject_token_field_name for JSON credential_source format");const u=e.get("file"),d=e.get("url"),h=e.get("certificate"),p=e.get("headers");if(u&&d||d&&h||u&&h)throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(u)this.credentialSourceType="file",this.subjectTokenSupplier=new a.FileSubjectTokenSupplier({filePath:u,formatType:i,subjectTokenFieldName:l});else if(d)this.credentialSourceType="url",this.subjectTokenSupplier=new s.UrlSubjectTokenSupplier({url:d,formatType:i,subjectTokenFieldName:l,headers:p,additionalGaxiosOptions:c.RETRY_CONFIG});else if(h){this.credentialSourceType="certificate";const e=new o.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:h.use_default_certificate_config,certificateConfigLocation:h.certificate_config_location,trustChainPath:h.trust_chain_path});this.subjectTokenSupplier=e}else throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let e=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof o.CertificateSubjectTokenSupplier){let e=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new l.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new u.Gaxios({agent:e})}),this.transporter=new u.Gaxios({...this.transporter.defaults||{},agent:e})}return e}}r.IdentityPoolClient=c},713956,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AwsRequestSigner=void 0;let i=e.r(401606),n=e.r(833341),a="AWS4-HMAC-SHA256";async function s(e,t,r){return await e.signWithHmacSha256(t,r)}async function o(e,t,r,i,n){let a=await s(e,`AWS4${t}`,r),o=await s(e,a,i),l=await s(e,o,n);return await s(e,l,"aws4_request")}async function l(e){let t=i.Gaxios.mergeHeaders(e.additionalAmzHeaders),r=e.requestPayload||"",l=e.host.split(".")[0],u=new Date,c=u.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),d=u.toISOString().replace(/[-]/g,"").replace(/T.*/,"");e.securityCredentials.token&&t.set("x-amz-security-token",e.securityCredentials.token);let h=i.Gaxios.mergeHeaders({host:e.host},t.has("date")?{}:{"x-amz-date":c},t),p="",f=[...h.keys()].sort();f.forEach(e=>{p+=`${e}:${h.get(e)}
`});let m=f.join(";"),g=await e.crypto.sha256DigestHex(r),y=`${e.method.toUpperCase()}
${e.canonicalUri}
${e.canonicalQuerystring}
${p}
${m}
${g}`,_=`${d}/${e.region}/${l}/aws4_request`,v=`${a}
${c}
${_}
`+await e.crypto.sha256DigestHex(y),b=await o(e.crypto,e.securityCredentials.secretAccessKey,d,e.region,l),w=await s(e.crypto,b,v),E=`${a} Credential=${e.securityCredentials.accessKeyId}/${_}, SignedHeaders=${m}, Signature=${(0,n.fromArrayBufferToHex)(w)}`;return{amzDate:t.has("date")?void 0:c,authorizationHeader:E,canonicalQuerystring:e.canonicalQuerystring}}r.AwsRequestSigner=class{getCredentials;region;crypto;constructor(e,t){this.getCredentials=e,this.region=t,this.crypto=(0,n.createCrypto)()}async getRequestOptions(e){if(!e.url)throw RangeError('"url" is required in "amzOptions"');let t="object"==typeof e.data?JSON.stringify(e.data):e.data,r=e.url,n=e.method||"GET",a=e.body||t,s=e.headers,o=await this.getCredentials(),u=new URL(r);if("string"!=typeof a&&void 0!==a)throw TypeError(`'requestPayload' is expected to be a string if provided. Got: ${a}`);let c=await l({crypto:this.crypto,host:u.host,canonicalUri:u.pathname,canonicalQuerystring:u.search.slice(1),method:n,region:this.region,securityCredentials:o,requestPayload:a,additionalAmzHeaders:s}),d=i.Gaxios.mergeHeaders(c.amzDate?{"x-amz-date":c.amzDate}:{},{authorization:c.authorizationHeader,host:u.host},s||{});o.token&&i.Gaxios.mergeHeaders(d,{"x-amz-security-token":o.token});let h={url:r,method:n,headers:d};return void 0!==a&&(h.body=a),h}}},436741,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DefaultAwsSecurityCredentialsSupplier=void 0;let i=e.r(584950);r.DefaultAwsSecurityCredentialsSupplier=class{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(e){this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(this.#w)return this.#w;let t=new Headers;if(!this.#w&&this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#E(e.transporter)),!this.regionUrl)throw RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let r={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:t};i.AuthClient.setMethodName(r,"getAwsRegion");let n=await e.transporter.request(r);return n.data.substr(0,n.data.length-1)}async getAwsSecurityCredentials(e){if(this.#T)return this.#T;let t=new Headers;this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#E(e.transporter));let r=await this.#S(t,e.transporter),i=await this.#I(r,t,e.transporter);return{accessKeyId:i.AccessKeyId,secretAccessKey:i.SecretAccessKey,token:i.Token}}async #E(e){let t={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return i.AuthClient.setMethodName(t,"#getImdsV2SessionToken"),(await e.request(t)).data}async #S(e,t){if(!this.securityCredentialsUrl)throw Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let r={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return i.AuthClient.setMethodName(r,"#getAwsRoleName"),(await t.request(r)).data}async #I(e,t,r){let n={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:t};return i.AuthClient.setMethodName(n,"#retrieveAwsSecurityCredentials"),(await r.request(n)).data}get #w(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get #T(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}}},909193,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AwsClient=void 0;let i=e.r(713956),n=e.r(745311),a=e.r(436741),s=e.r(541846),o=e.r(401606);class l extends n.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static #O="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(e){super(e);const t=(0,s.originalOrCamelOptions)(e),r=t.get("credential_source"),i=t.get("aws_security_credentials_supplier");if(!r&&!i)throw Error("A credential source or AWS security credentials supplier must be specified.");if(r&&i)throw Error("Only one of credential source or AWS security credentials supplier can be specified.");if(i)this.awsSecurityCredentialsSupplier=i,this.regionalCredVerificationUrl=l.#O,this.credentialSourceType="programmatic";else{const e=(0,s.originalOrCamelOptions)(r);this.environmentId=e.get("environment_id");const t=e.get("region_url"),i=e.get("url"),n=e.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new a.DefaultAwsSecurityCredentialsSupplier({regionUrl:t,securityCredentialsUrl:i,imdsV2SessionTokenUrl:n}),this.regionalCredVerificationUrl=e.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let e=this.environmentId?.match(/^(aws)(\d+)$/);if(e&&this.regionalCredVerificationUrl){if(1!==parseInt(e[2],10))throw Error(`aws version "${e[2]}" is not supported in the current build.`)}else throw Error('No valid AWS "credential_source" provided')}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new i.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let e=await this.awsRequestSigner.getRequestOptions({...l.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),t=[];return o.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},e.headers).forEach((e,r)=>t.push({key:r,value:e})),encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:t}))}}r.AwsClient=l},233873,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InvalidSubjectTokenError=r.InvalidMessageFieldError=r.InvalidCodeFieldError=r.InvalidTokenTypeFieldError=r.InvalidExpirationTimeFieldError=r.InvalidSuccessFieldError=r.InvalidVersionFieldError=r.ExecutableResponseError=r.ExecutableResponse=void 0;let i="urn:ietf:params:oauth:token-type:saml2",n="urn:ietf:params:oauth:token-type:id_token",a="urn:ietf:params:oauth:token-type:jwt";r.ExecutableResponse=class{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(e){if(!e.version)throw new o("Executable response must contain a 'version' field.");if(void 0===e.success)throw new l("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==i&&this.tokenType!==n&&this.tokenType!==a)throw new u(`Executable response must contain a 'token_type' field when successful and it must be one of ${n}, ${a}, or ${i}.`);if(this.tokenType===i){if(!e.saml_response)throw new h(`Executable response must contain a 'saml_response' field when token_type=${i}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new h(`Executable response must contain a 'id_token' field when token_type=${n} or ${a}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new c("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new d("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return void 0!==this.expirationTime&&this.expirationTime<Math.round(Date.now()/1e3)}};class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}r.ExecutableResponseError=s;class o extends s{}r.InvalidVersionFieldError=o;class l extends s{}r.InvalidSuccessFieldError=l,r.InvalidExpirationTimeFieldError=class extends s{};class u extends s{}r.InvalidTokenTypeFieldError=u;class c extends s{}r.InvalidCodeFieldError=c;class d extends s{}r.InvalidMessageFieldError=d;class h extends s{}r.InvalidSubjectTokenError=h},756423,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PluggableAuthHandler=r.ExecutableError=void 0;let i=e.r(233873),n=e.r(233405),a=e.r(522734);class s extends Error{code;constructor(e,t){super(`The executable failed with exit code: ${t} and error message: ${e}.`),this.code=t,Object.setPrototypeOf(this,new.target.prototype)}}r.ExecutableError=s;class o{commandComponents;timeoutMillis;outputFile;constructor(e){if(!e.command)throw Error("No command provided.");if(this.commandComponents=o.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,r)=>{let a=n.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),o="";a.stdout.on("data",e=>{o+=e}),a.stderr.on("data",e=>{o+=e});let l=setTimeout(()=>(a.removeAllListeners(),a.kill(),r(Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);a.on("close",e=>{if(clearTimeout(l),0!==e)return r(new s(o,e.toString()));try{let e=JSON.parse(o),r=new i.ExecutableResponse(e);return t(r)}catch(e){if(e instanceof i.ExecutableResponseError)return r(e);return r(new i.ExecutableResponseError(`The executable returned an invalid response: ${o}`))}})})}async retrieveCachedResponse(){let e;if(!this.outputFile||0===this.outputFile.length)return;try{e=await a.promises.realpath(this.outputFile)}catch{return}if(!(await a.promises.lstat(e)).isFile())return;let t=await a.promises.readFile(e,{encoding:"utf8"});if(""!==t)try{let e=JSON.parse(t);if(new i.ExecutableResponse(e).isValid())return new i.ExecutableResponse(e);return}catch(e){if(e instanceof i.ExecutableResponseError)throw e;throw new i.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw Error(`Provided command: "${e}" could not be parsed.`);for(let e=0;e<t.length;e++)'"'===t[e][0]&&'"'===t[e].slice(-1)&&(t[e]=t[e].slice(1,-1));return t}}r.PluggableAuthHandler=o},816207,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PluggableAuthClient=r.ExecutableError=void 0;let i=e.r(745311),n=e.r(233873),a=e.r(756423);var s=e.r(756423);Object.defineProperty(r,"ExecutableError",{enumerable:!0,get:function(){return s.ExecutableError}});class o extends i.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(e){if(super(e),!e.credential_source.executable||(this.command=e.credential_source.executable.command,!this.command))throw Error('No valid Pluggable Auth "credential_source" provided.');if(void 0===e.credential_source.executable.timeout_millis)this.timeoutMillis=3e4;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<5e3||this.timeoutMillis>12e4)throw Error("Timeout must be between 5000120000 milliseconds.");this.outputFile=e.credential_source.executable.output_file,this.handler=new a.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){let e;if("1"!==process.env.GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES)throw Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let t=new Map;t.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),t.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),t.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&t.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let r=this.getServiceAccountEmail();r&&t.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",r),e=await this.handler.retrieveResponseFromExecutable(t)}if(e.version>1)throw Error("Version of executable is not currently supported, maximum supported version is 1.");if(!e.success)throw new a.ExecutableError(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new n.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw Error("Executable response is expired.");return e.subjectToken}}r.PluggableAuthClient=o},443980,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ExternalAccountClient=void 0;let i=e.r(745311),n=e.r(903060),a=e.r(909193),s=e.r(816207);r.ExternalAccountClient=class{constructor(){throw Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){return e&&e.type===i.EXTERNAL_ACCOUNT_TYPE?e.credential_source?.environment_id?new a.AwsClient(e):e.credential_source?.executable?new s.PluggableAuthClient(e):new n.IdentityPoolClient(e):null}}},108300,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ExternalAccountAuthorizedUserClient=r.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;let i=e.r(584950),n=e.r(939063),a=e.r(401606),s=e.r(688947),o=e.r(745311);r.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";class l extends n.OAuthClientAuthHandler{#A;constructor(e){super(e),this.#A=e.tokenRefreshEndpoint}async refreshToken(e,t){let r={...l.RETRY_CONFIG,url:this.#A,method:"POST",headers:t,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})};i.AuthClient.setMethodName(r,"refreshToken"),this.applyClientAuthenticationOptions(r);try{let e=await this.transporter.request(r),t=e.data;return t.res=e,t}catch(e){if(e instanceof a.GaxiosError&&e.response)throw(0,n.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}class u extends i.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(e){super(e),e.universe_domain&&(this.universeDomain=e.universe_domain),this.refreshToken=e.refresh_token;const t={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new l({tokenRefreshEndpoint:e.token_url??"https://sts.{universeDomain}/v1/oauthtoken".replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:t}),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,"number"!=typeof e?.eagerRefreshThresholdMillis?this.eagerRefreshThresholdMillis=o.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!e?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let r;try{let t=await this.getRequestHeaders();e.headers=a.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),r=await this.transporter.request(e)}catch(i){let r=i.response;if(r){let i=r.status,n=r.config.data instanceof s.Readable;if(!t&&(401===i||403===i)&&!n&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw i}return r}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+1e3*e.expires_in,res:e.res},void 0!==e.refresh_token&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}r.ExternalAccountAuthorizedUserClient=u},921981,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GoogleAuth=r.GoogleAuthExceptionMessages=void 0;let i=e.r(233405),n=e.r(522734),a=e.r(401606),s=e.r(778600),o=e.r(446786),l=e.r(814747),u=e.r(833341),c=e.r(616722),d=e.r(263547),h=e.r(913187),p=e.r(304835),f=e.r(863909),m=e.r(934426),g=e.r(443980),y=e.r(745311),_=e.r(584950),v=e.r(108300),b=e.r(541846);r.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:"Unable to detect a Project Id in the current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_CREDENTIALS_FOUND:"Unable to find credentials in current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:"Unable to detect a Universe Domain in the current environment.\nTo learn more about Universe Domain retrieval, visit: \nhttps://cloud.google.com/compute/docs/metadata/predefined-metadata-keys"},r.GoogleAuth=class{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#k=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(e={}){if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw RangeError(r.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(!e)return this.getProjectIdAsync();this.getProjectIdAsync().then(t=>e(null,t),e)}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===r.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||=await this.getProductionProjectId(),e||=await this.getFileProjectId(),e||=await this.getDefaultServiceProjectId(),e||=await this.getGCEProjectId(),e||=await this.getExternalAccountClientProjectId())return this._cachedProjectId=e,e;throw Error(r.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let e;try{e=await s.universe("universe-domain"),e||=_.DEFAULT_UNIVERSE}catch(t){if(t&&t?.response?.status===404)e=_.DEFAULT_UNIVERSE;else throw t}return e}async getUniverseDomain(){let e=(0,b.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e??=(await this.getClient()).universeDomain}catch{e??=_.DEFAULT_UNIVERSE}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let r;if("function"==typeof e?t=e:r=e,!t)return this.getApplicationDefaultAsync(r);this.getApplicationDefaultAsync(r).then(e=>t(null,e.credential,e.projectId),t)}async getApplicationDefaultAsync(e={}){let t;if(this.cachedCredential)return await this.#x(this.cachedCredential,null);if((t=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e))||(t=await this._tryGetApplicationCredentialsFromWellKnownFile(e)))return t instanceof p.JWT?t.scopes=this.scopes:t instanceof y.BaseExternalAccountClient&&(t.scopes=this.getAnyScopes()),await this.#x(t);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await this.#x(new c.Compute(e));throw Error(r.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async #x(e,t=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let r=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:r}}async _checkIsGCE(){return void 0===this.checkIsGCE&&(this.checkIsGCE=s.getGCPResidency()||await s.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!t||0===t.length)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(e){throw e instanceof Error&&(e.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${e.message}`),e}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=process.env.APPDATA;else{let e=process.env.HOME;e&&(t=l.join(e,".config"))}return(t&&(t=l.join(t,"gcloud","application_default_credentials.json"),n.existsSync(t)||(t=null)),t)?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||0===e.length)throw Error("The file path is invalid.");try{if(e=n.realpathSync(e),!n.lstatSync(e).isFile())throw Error()}catch(t){throw t instanceof Error&&(t.message=`The file at ${e} does not exist, or it is not a file. ${t.message}`),t}let r=n.createReadStream(e);return this.fromStream(r,t)}fromImpersonatedJSON(e){if(!e)throw Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==m.IMPERSONATED_ACCOUNT_TYPE)throw Error(`The incoming JSON object does not have the "${m.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw Error("The incoming JSON object does not contain a service_account_impersonation_url field");let t=this.fromJSON(e.source_credentials);if(e.service_account_impersonation_url?.length>256)throw RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let r=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url)?.groups?.target;if(!r)throw RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let i=(this.scopes||e.scopes||this.defaultScopes)??[];return new m.Impersonated({...e,sourceClient:t,targetPrincipal:r,targetScopes:Array.isArray(i)?i:[i]})}fromJSON(e,t={}){let r,i=(0,b.originalOrCamelOptions)(t).get("universe_domain");return e.type===f.USER_REFRESH_ACCOUNT_TYPE?(r=new f.UserRefreshClient(t)).fromJSON(e):e.type===m.IMPERSONATED_ACCOUNT_TYPE?r=this.fromImpersonatedJSON(e):e.type===y.EXTERNAL_ACCOUNT_TYPE?(r=g.ExternalAccountClient.fromJSON({...e,...t})).scopes=this.getAnyScopes():e.type===v.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?r=new v.ExternalAccountAuthorizedUserClient({...e,...t}):(t.scopes=this.scopes,r=new p.JWT(t),this.setGapicJWTValues(r),r.fromJSON(e)),i&&(r.universeDomain=i),r}_cacheClientFromJSON(e,t){let r=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=r,r}fromStream(e,t={},r){let i={};if("function"==typeof t?r=t:i=t,!r)return this.fromStreamAsync(e,i);this.fromStreamAsync(e,i).then(e=>r(null,e),r)}fromStreamAsync(e,t){return new Promise((r,i)=>{if(!e)throw Error("Must pass in a stream containing the Google auth settings.");let n=[];e.setEncoding("utf8").on("error",i).on("data",e=>n.push(e)).on("end",()=>{try{try{let e=JSON.parse(n.join("")),i=this._cacheClientFromJSON(e,t);return r(i)}catch(t){if(!this.keyFilename)throw t;let e=new p.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=e,this.setGapicJWTValues(e),r(e)}}catch(e){return i(e)}})})}fromAPIKey(e,t={}){return new p.JWT({...t,apiKey:e})}_isWindows(){let e=o.platform();return!!e&&!!(e.length>=3)&&"win"===e.substring(0,3).toLowerCase()}async getDefaultServiceProjectId(){return new Promise(e=>{(0,i.exec)("gcloud config config-helper --format json",(t,r)=>{if(!t&&r)try{let t=JSON.parse(r).configuration.properties.core.project;e(t);return}catch(e){}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let e=await this.getClient();if(e&&e.projectId)return e.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){if(!this.jsonContent||this.jsonContent.type!==y.EXTERNAL_ACCOUNT_TYPE)return null;let e=await this.getClient();return await e.getProjectId()}async getGCEProjectId(){try{return await s.project("project-id")}catch(e){return null}}getCredentials(e){if(!e)return this.getCredentialsAsync();this.getCredentialsAsync().then(t=>e(null,t),e)}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof m.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof y.BaseExternalAccountClient){let t=e.getServiceAccountEmail();if(t)return{client_email:t,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[e,t]=await Promise.all([s.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:e,universe_domain:t}}throw Error(r.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#k=this.#k||this.#$();try{return await this.#k}finally{this.#k=null}}async #$(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=l.resolve(this.keyFilename),t=n.createReadStream(e);return await this.fromStreamAsync(t,this.clientOptions)}if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:t}=await this.#x(e);return t}{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new d.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){let e=await this.getClient();return(await e.getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let t=e.url,r=await this.getClient(),i=await r.getRequestHeaders(t);return e.headers=a.Gaxios.mergeHeaders(e.headers,i),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,h.getEnv)()}async sign(e,t){let r=await this.getClient(),i=await this.getUniverseDomain();if(t=t||`https://iamcredentials.${i}/v1/projects/-/serviceAccounts/`,r instanceof m.Impersonated)return(await r.sign(e)).signedBlob;let n=(0,u.createCrypto)();if(r instanceof p.JWT&&r.key)return await n.sign(r.key,e);let a=await this.getCredentials();if(!a.client_email)throw Error("Cannot sign data without `client_email`.");return this.signBlob(n,a.client_email,e,t)}async signBlob(e,t,r,i){let n=new URL(i+`${t}:signBlob`);return(await this.request({method:"POST",url:n.href,data:{payload:e.encodeBase64StringUtf8(r)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}}},990133,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.IAMAuth=void 0,r.IAMAuth=class{selector;token;constructor(e,t){this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}}},722381,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DownscopedClient=r.EXPIRATION_TIME_OFFSET=r.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;let i=e.r(401606),n=e.r(688947),a=e.r(584950),s=e.r(526806);r.MAX_ACCESS_BOUNDARY_RULES_COUNT=10,r.EXPIRATION_TIME_OFFSET=3e5;class o extends a.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(e,t={accessBoundary:{accessBoundaryRules:[]}}){if(super(e instanceof a.AuthClient?{}:e),e instanceof a.AuthClient?(this.authClient=e,this.credentialAccessBoundary=t):(this.authClient=e.authClient,this.credentialAccessBoundary=e.credentialAccessBoundary),0===this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length)throw Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>r.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw Error(`The provided access boundary has more than ${r.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(const e of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(0===e.availablePermissions.length)throw Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new s.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let r;try{let t=await this.getRequestHeaders();e.headers=i.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),r=await this.transporter.request(e)}catch(i){let r=i.response;if(r){let i=r.status,a=r.config.data instanceof n.Readable;if(!t&&(401===i||403===i)&&!a&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw i}return r}async refreshAccessTokenAsync(){let e=(await this.authClient.getAccessToken()).token,t=await this.stsCredential.exchangeToken({grantType:"urn:ietf:params:oauth:grant-type:token-exchange",requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:e,subjectTokenType:"urn:ietf:params:oauth:token-type:access_token"},void 0,this.credentialAccessBoundary),r=this.authClient.credentials?.expiry_date||null,i=t.expires_in?new Date().getTime()+1e3*t.expires_in:r;return this.cachedDownscopedAccessToken={access_token:t.access_token,expiry_date:i,res:t.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}r.DownscopedClient=o},772967,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PassThroughClient=void 0;let i=e.r(584950);class n extends i.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}}r.PassThroughClient=n},427471,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GoogleAuth=r.auth=r.PassThroughClient=r.ExternalAccountAuthorizedUserClient=r.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=r.ExecutableError=r.PluggableAuthClient=r.DownscopedClient=r.BaseExternalAccountClient=r.ExternalAccountClient=r.IdentityPoolClient=r.AwsRequestSigner=r.AwsClient=r.UserRefreshClient=r.LoginTicket=r.ClientAuthentication=r.OAuth2Client=r.CodeChallengeMethod=r.Impersonated=r.JWT=r.JWTAccess=r.IdTokenClient=r.IAMAuth=r.GCPEnv=r.Compute=r.DEFAULT_UNIVERSE=r.AuthClient=r.gaxios=r.gcpMetadata=void 0;let i=e.r(921981);Object.defineProperty(r,"GoogleAuth",{enumerable:!0,get:function(){return i.GoogleAuth}}),r.gcpMetadata=e.r(778600),r.gaxios=e.r(401606);var n=e.r(584950);Object.defineProperty(r,"AuthClient",{enumerable:!0,get:function(){return n.AuthClient}}),Object.defineProperty(r,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return n.DEFAULT_UNIVERSE}});var a=e.r(616722);Object.defineProperty(r,"Compute",{enumerable:!0,get:function(){return a.Compute}});var s=e.r(913187);Object.defineProperty(r,"GCPEnv",{enumerable:!0,get:function(){return s.GCPEnv}});var o=e.r(990133);Object.defineProperty(r,"IAMAuth",{enumerable:!0,get:function(){return o.IAMAuth}});var l=e.r(263547);Object.defineProperty(r,"IdTokenClient",{enumerable:!0,get:function(){return l.IdTokenClient}});var u=e.r(748702);Object.defineProperty(r,"JWTAccess",{enumerable:!0,get:function(){return u.JWTAccess}});var c=e.r(304835);Object.defineProperty(r,"JWT",{enumerable:!0,get:function(){return c.JWT}});var d=e.r(934426);Object.defineProperty(r,"Impersonated",{enumerable:!0,get:function(){return d.Impersonated}});var h=e.r(93628);Object.defineProperty(r,"CodeChallengeMethod",{enumerable:!0,get:function(){return h.CodeChallengeMethod}}),Object.defineProperty(r,"OAuth2Client",{enumerable:!0,get:function(){return h.OAuth2Client}}),Object.defineProperty(r,"ClientAuthentication",{enumerable:!0,get:function(){return h.ClientAuthentication}});var p=e.r(898724);Object.defineProperty(r,"LoginTicket",{enumerable:!0,get:function(){return p.LoginTicket}});var f=e.r(863909);Object.defineProperty(r,"UserRefreshClient",{enumerable:!0,get:function(){return f.UserRefreshClient}});var m=e.r(909193);Object.defineProperty(r,"AwsClient",{enumerable:!0,get:function(){return m.AwsClient}});var g=e.r(713956);Object.defineProperty(r,"AwsRequestSigner",{enumerable:!0,get:function(){return g.AwsRequestSigner}});var y=e.r(903060);Object.defineProperty(r,"IdentityPoolClient",{enumerable:!0,get:function(){return y.IdentityPoolClient}});var _=e.r(443980);Object.defineProperty(r,"ExternalAccountClient",{enumerable:!0,get:function(){return _.ExternalAccountClient}});var v=e.r(745311);Object.defineProperty(r,"BaseExternalAccountClient",{enumerable:!0,get:function(){return v.BaseExternalAccountClient}});var b=e.r(722381);Object.defineProperty(r,"DownscopedClient",{enumerable:!0,get:function(){return b.DownscopedClient}});var w=e.r(816207);Object.defineProperty(r,"PluggableAuthClient",{enumerable:!0,get:function(){return w.PluggableAuthClient}}),Object.defineProperty(r,"ExecutableError",{enumerable:!0,get:function(){return w.ExecutableError}});var E=e.r(108300);Object.defineProperty(r,"EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE",{enumerable:!0,get:function(){return E.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE}}),Object.defineProperty(r,"ExternalAccountAuthorizedUserClient",{enumerable:!0,get:function(){return E.ExternalAccountAuthorizedUserClient}});var T=e.r(772967);Object.defineProperty(r,"PassThroughClient",{enumerable:!0,get:function(){return T.PassThroughClient}}),r.auth=new i.GoogleAuth},531258,(e,t,r)=>{"use strict";let i=["nodebuffer","arraybuffer","fragments"],n="undefined"!=typeof Blob;n&&i.push("blob"),t.exports={BINARY_TYPES:i,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:n,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},139078,(e,t,r)=>{"use strict";let{EMPTY_BUFFER:i}=e.r(531258),n=Buffer[Symbol.species];function a(e,t,r,i,n){for(let a=0;a<n;a++)r[i+a]=e[a]^t[3&a]}function s(e,t){for(let r=0;r<e.length;r++)e[r]^=t[3&r]}function o(e){let t;return(o.readOnly=!0,Buffer.isBuffer(e))?e:(e instanceof ArrayBuffer?t=new n(e):ArrayBuffer.isView(e)?t=new n(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),o.readOnly=!1),t)}if(t.exports={concat:function(e,t){if(0===e.length)return i;if(1===e.length)return e[0];let r=Buffer.allocUnsafe(t),a=0;for(let t=0;t<e.length;t++){let i=e[t];r.set(i,a),a+=i.length}return a<t?new n(r.buffer,r.byteOffset,a):r},mask:a,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:o,unmask:s},!process.env.WS_NO_BUFFER_UTIL)try{let e=(()=>{let e=Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e})();t.exports.mask=function(t,r,i,n,s){s<48?a(t,r,i,n,s):e.mask(t,r,i,n,s)},t.exports.unmask=function(t,r){t.length<32?s(t,r):e.unmask(t,r)}}catch(e){}},515735,(e,t,r)=>{"use strict";let i=Symbol("kDone"),n=Symbol("kRun");t.exports=class{constructor(e){this[i]=()=>{this.pending--,this[n]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[n]()}[n](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[i])}}}},497012,(e,t,r)=>{"use strict";let i,n=e.r(406461),a=e.r(139078),s=e.r(515735),{kStatusCode:o}=e.r(531258),l=Buffer[Symbol.species],u=Buffer.from([0,0,255,255]),c=Symbol("permessage-deflate"),d=Symbol("total-length"),h=Symbol("callback"),p=Symbol("buffers"),f=Symbol("error");function m(e){this[p].push(e),this[d]+=e.length}function g(e){(this[d]+=e.length,this[c]._maxPayload<1||this[d]<=this[c]._maxPayload)?this[p].push(e):(this[f]=RangeError("Max payload size exceeded"),this[f].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[f][o]=1009,this.removeListener("data",g),this.reset())}function y(e){(this[c]._inflate=null,this[f])?this[h](this[f]):(e[o]=1007,this[h](e))}t.exports=class{constructor(e,t,r){this._maxPayload=0|r,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,i||(i=new s(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[h];this._deflate.close(),this._deflate=null,e&&e(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,r=e.find(e=>(!1!==t.serverNoContextTakeover||!e.server_no_context_takeover)&&(!e.server_max_window_bits||!1!==t.serverMaxWindowBits&&("number"!=typeof t.serverMaxWindowBits||!(t.serverMaxWindowBits>e.server_max_window_bits)))&&("number"!=typeof t.clientMaxWindowBits||!!e.client_max_window_bits));if(!r)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:(!0===r.client_max_window_bits||!1===t.clientMaxWindowBits)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let r=e[t];if(r.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(r=r[0],"client_max_window_bits"===t){if(!0!==r){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else if("server_max_window_bits"===t){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if("client_no_context_takeover"===t||"server_no_context_takeover"===t){if(!0!==r)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else throw Error(`Unknown parameter "${t}"`);e[t]=r})}),e}decompress(e,t,r){i.add(i=>{this._decompress(e,t,(e,t)=>{i(),r(e,t)})})}compress(e,t,r){i.add(i=>{this._compress(e,t,(e,t)=>{i(),r(e,t)})})}_decompress(e,t,r){let i=this._isServer?"client":"server";if(!this._inflate){let e=`${i}_max_window_bits`,t="number"!=typeof this.params[e]?n.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=n.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[c]=this,this._inflate[d]=0,this._inflate[p]=[],this._inflate.on("error",y),this._inflate.on("data",g)}this._inflate[h]=r,this._inflate.write(e),t&&this._inflate.write(u),this._inflate.flush(()=>{let e=this._inflate[f];if(e){this._inflate.close(),this._inflate=null,r(e);return}let n=a.concat(this._inflate[p],this._inflate[d]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[d]=0,this._inflate[p]=[],t&&this.params[`${i}_no_context_takeover`]&&this._inflate.reset()),r(null,n)})}_compress(e,t,r){let i=this._isServer?"server":"client";if(!this._deflate){let e=`${i}_max_window_bits`,t="number"!=typeof this.params[e]?n.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=n.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[d]=0,this._deflate[p]=[],this._deflate.on("data",m)}this._deflate[h]=r,this._deflate.write(e),this._deflate.flush(n.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=a.concat(this._deflate[p],this._deflate[d]);t&&(e=new l(e.buffer,e.byteOffset,e.length-4)),this._deflate[h]=null,this._deflate[d]=0,this._deflate[p]=[],t&&this.params[`${i}_no_context_takeover`]&&this._deflate.reset(),r(null,e)})}}},497112,(e,t,r)=>{"use strict";let{isUtf8:i}=e.r(500874),{hasBlob:n}=e.r(531258);function a(e){let t=e.length,r=0;for(;r<t;)if((128&e[r])==0)r++;else if((224&e[r])==192){if(r+1===t||(192&e[r+1])!=128||(254&e[r])==192)return!1;r+=2}else if((240&e[r])==224){if(r+2>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||224===e[r]&&(224&e[r+1])==128||237===e[r]&&(224&e[r+1])==160)return!1;r+=3}else{if((248&e[r])!=240||r+3>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||(192&e[r+3])!=128||240===e[r]&&(240&e[r+1])==128||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0}if(t.exports={isBlob:function(e){return n&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:a,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},i)t.exports.isValidUTF8=function(e){return e.length<24?a(e):i(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let e=(()=>{let e=Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e})();t.exports.isValidUTF8=function(t){return t.length<32?a(t):e(t)}}catch(e){}},217953,(e,t,r)=>{"use strict";let{Writable:i}=e.r(688947),n=e.r(497012),{BINARY_TYPES:a,EMPTY_BUFFER:s,kStatusCode:o,kWebSocket:l}=e.r(531258),{concat:u,toArrayBuffer:c,unmask:d}=e.r(139078),{isValidStatusCode:h,isValidUTF8:p}=e.r(497112),f=Buffer[Symbol.species];t.exports=class extends i{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||a[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[l]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let t=this._buffers[0];return this._buffers[0]=new f(t.buffer,t.byteOffset+e,t.length-e),new f(t.buffer,t.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0],i=t.length-e;e>=r.length?t.set(this._buffers.shift(),i):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),i),this._buffers[0]=new f(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0)return t}startLoop(e){this._loop=!0;do switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:this._loop=!1;return}while(this._loop)this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((48&t[0])!=0)return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));let r=(64&t[0])==64;if(r&&!this._extensions[n.extensionName])return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._fin=(128&t[0])==128,this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(r)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=r}else{if(!(this._opcode>7)||!(this._opcode<11))return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(r)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&t[1])==128,this._isServer){if(!this._masked)return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),r=t.readUInt32BE(0);r>2097151?e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*r+t.readUInt32BE(4),this.haveLength(e))}haveLength(e){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(e){let t=s;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&d(t,this._mask)}if(this._opcode>7)return void this.controlMessage(t,e);if(this._compressed){this._state=5,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[n.extensionName].decompress(e,this._fin,(e,r)=>{if(e)return t(e);if(r.length){if(this._messageLength+=r.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return void t(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(r)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=0;return}let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let i;i="nodebuffer"===this._binaryType?u(r,t):"arraybuffer"===this._binaryType?c(u(r,t)):"blob"===this._binaryType?new Blob(r):r,this._allowSynchronousEvents?(this.emit("message",i,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",i,!0),this._state=0,this.startLoop(e)}))}else{let i=u(r,t);if(!this._skipUTF8Validation&&!p(i))return void e(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));5===this._state||this._allowSynchronousEvents?(this.emit("message",i,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",i,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8===this._opcode){if(0===e.length)this._loop=!1,this.emit("conclude",1005,s),this.end();else{let r=e.readUInt16BE(0);if(!h(r))return void t(this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));let i=new f(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!p(i))return void t(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));this._loop=!1,this.emit("conclude",r,i),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}))}createError(e,t,r,i,n){this._loop=!1,this._errored=!0;let a=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(a,this.createError),a.code=n,a[o]=i,a}}},260238,(e,t,r)=>{"use strict";let i,{Duplex:n}=e.r(688947),{randomFillSync:a}=e.r(254799),s=e.r(497012),{EMPTY_BUFFER:o,kWebSocket:l,NOOP:u}=e.r(531258),{isBlob:c,isValidStatusCode:d}=e.r(497112),{mask:h,toBuffer:p}=e.r(139078),f=Symbol("kByteLength"),m=Buffer.alloc(4),g=8192;class y{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=u,this[l]=void 0}static frame(e,t){let r,n,s=!1,o=2,l=!1;t.mask&&(r=t.maskBuffer||m,t.generateMask?t.generateMask(r):(8192===g&&(void 0===i&&(i=Buffer.alloc(8192)),a(i,0,8192),g=0),r[0]=i[g++],r[1]=i[g++],r[2]=i[g++],r[3]=i[g++]),l=(r[0]|r[1]|r[2]|r[3])==0,o=6),"string"==typeof e?n=(!t.mask||l)&&void 0!==t[f]?t[f]:(e=Buffer.from(e)).length:(n=e.length,s=t.mask&&t.readOnly&&!l);let u=n;n>=65536?(o+=8,u=127):n>125&&(o+=2,u=126);let c=Buffer.allocUnsafe(s?n+o:o);return(c[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(c[0]|=64),c[1]=u,126===u?c.writeUInt16BE(n,2):127===u&&(c[2]=c[3]=0,c.writeUIntBE(n,4,6)),t.mask)?(c[1]|=128,c[o-4]=r[0],c[o-3]=r[1],c[o-2]=r[2],c[o-1]=r[3],l)?[c,e]:s?(h(e,r,c,o,n),[c]):(h(e,r,e,0,n),[c,e]):[c,e]}close(e,t,r,i){let n;if(void 0===e)n=o;else if("number"==typeof e&&d(e))if(void 0!==t&&t.length){let r=Buffer.byteLength(t);if(r>123)throw RangeError("The message must not be greater than 123 bytes");(n=Buffer.allocUnsafe(2+r)).writeUInt16BE(e,0),"string"==typeof t?n.write(t,2):n.set(t,2)}else(n=Buffer.allocUnsafe(2)).writeUInt16BE(e,0);else throw TypeError("First argument must be a valid error code number");let a={[f]:n.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,n,!1,a,i]):this.sendFrame(y.frame(n,a),i)}ping(e,t,r){let i,n;if("string"==typeof e?(i=Buffer.byteLength(e),n=!1):c(e)?(i=e.size,n=!1):(i=(e=p(e)).length,n=p.readOnly),i>125)throw RangeError("The data size must not be greater than 125 bytes");let a={[f]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:n,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,a,r]):this.getBlobData(e,!1,a,r):0!==this._state?this.enqueue([this.dispatch,e,!1,a,r]):this.sendFrame(y.frame(e,a),r)}pong(e,t,r){let i,n;if("string"==typeof e?(i=Buffer.byteLength(e),n=!1):c(e)?(i=e.size,n=!1):(i=(e=p(e)).length,n=p.readOnly),i>125)throw RangeError("The data size must not be greater than 125 bytes");let a={[f]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:n,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,a,r]):this.getBlobData(e,!1,a,r):0!==this._state?this.enqueue([this.dispatch,e,!1,a,r]):this.sendFrame(y.frame(e,a),r)}send(e,t,r){let i,n,a=this._extensions[s.extensionName],o=t.binary?2:1,l=t.compress;"string"==typeof e?(i=Buffer.byteLength(e),n=!1):c(e)?(i=e.size,n=!1):(i=(e=p(e)).length,n=p.readOnly),this._firstFragment?(this._firstFragment=!1,l&&a&&a.params[a._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=i>=a._threshold),this._compress=l):(l=!1,o=0),t.fin&&(this._firstFragment=!0);let u={[f]:i,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:o,readOnly:n,rsv1:l};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,u,r]):this.getBlobData(e,this._compress,u,r):0!==this._state?this.enqueue([this.dispatch,e,this._compress,u,r]):this.dispatch(e,this._compress,u,r)}getBlobData(e,t,r,i){this._bufferedBytes+=r[f],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){let e=Error("The socket was closed while the blob was being read");process.nextTick(_,this,e,i);return}this._bufferedBytes-=r[f];let n=p(e);t?this.dispatch(n,t,r,i):(this._state=0,this.sendFrame(y.frame(n,r),i),this.dequeue())}).catch(e=>{process.nextTick(v,this,e,i)})}dispatch(e,t,r,i){if(!t)return void this.sendFrame(y.frame(e,r),i);let n=this._extensions[s.extensionName];this._bufferedBytes+=r[f],this._state=1,n.compress(e,r.fin,(e,t)=>{this._socket.destroyed?_(this,Error("The socket was closed while data was being compressed"),i):(this._bufferedBytes-=r[f],this._state=0,r.readOnly=!1,this.sendFrame(y.frame(t,r),i),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][f],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][f],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function _(e,t,r){"function"==typeof r&&r(t);for(let r=0;r<e._queue.length;r++){let i=e._queue[r],n=i[i.length-1];"function"==typeof n&&n(t)}}function v(e,t,r){_(e,t,r),e.onerror(t)}t.exports=y},85205,(e,t,r)=>{"use strict";let{kForOnEventAttribute:i,kListener:n}=e.r(531258),a=Symbol("kCode"),s=Symbol("kData"),o=Symbol("kError"),l=Symbol("kMessage"),u=Symbol("kReason"),c=Symbol("kTarget"),d=Symbol("kType"),h=Symbol("kWasClean");class p{constructor(e){this[c]=null,this[d]=e}get target(){return this[c]}get type(){return this[d]}}Object.defineProperty(p.prototype,"target",{enumerable:!0}),Object.defineProperty(p.prototype,"type",{enumerable:!0});class f extends p{constructor(e,t={}){super(e),this[a]=void 0===t.code?0:t.code,this[u]=void 0===t.reason?"":t.reason,this[h]=void 0!==t.wasClean&&t.wasClean}get code(){return this[a]}get reason(){return this[u]}get wasClean(){return this[h]}}Object.defineProperty(f.prototype,"code",{enumerable:!0}),Object.defineProperty(f.prototype,"reason",{enumerable:!0}),Object.defineProperty(f.prototype,"wasClean",{enumerable:!0});class m extends p{constructor(e,t={}){super(e),this[o]=void 0===t.error?null:t.error,this[l]=void 0===t.message?"":t.message}get error(){return this[o]}get message(){return this[l]}}Object.defineProperty(m.prototype,"error",{enumerable:!0}),Object.defineProperty(m.prototype,"message",{enumerable:!0});class g extends p{constructor(e,t={}){super(e),this[s]=void 0===t.data?null:t.data}get data(){return this[s]}}function y(e,t,r){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,r):e.call(t,r)}Object.defineProperty(g.prototype,"data",{enumerable:!0}),t.exports={CloseEvent:f,ErrorEvent:m,Event:p,EventTarget:{addEventListener(e,t,r={}){let a;for(let a of this.listeners(e))if(!r[i]&&a[n]===t&&!a[i])return;if("message"===e)a=function(e,r){let i=new g("message",{data:r?e:e.toString()});i[c]=this,y(t,this,i)};else if("close"===e)a=function(e,r){let i=new f("close",{code:e,reason:r.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});i[c]=this,y(t,this,i)};else if("error"===e)a=function(e){let r=new m("error",{error:e,message:e.message});r[c]=this,y(t,this,r)};else{if("open"!==e)return;a=function(){let e=new p("open");e[c]=this,y(t,this,e)}}a[i]=!!r[i],a[n]=t,r.once?this.once(e,a):this.on(e,a)},removeEventListener(e,t){for(let r of this.listeners(e))if(r[n]===t&&!r[i]){this.removeListener(e,r);break}}},MessageEvent:g}},394393,(e,t,r)=>{"use strict";let{tokenChars:i}=e.r(497112);function n(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}t.exports={format:function(e){return Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>[t].concat(Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){let t,r,a=Object.create(null),s=Object.create(null),o=!1,l=!1,u=!1,c=-1,d=-1,h=-1,p=0;for(;p<e.length;p++)if(d=e.charCodeAt(p),void 0===t)if(-1===h&&1===i[d])-1===c&&(c=p);else if(0!==p&&(32===d||9===d))-1===h&&-1!==c&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p);let r=e.slice(c,h);44===d?(n(a,r,s),s=Object.create(null)):t=r,c=h=-1}else throw SyntaxError(`Unexpected character at index ${p}`);else if(void 0===r)if(-1===h&&1===i[d])-1===c&&(c=p);else if(32===d||9===d)-1===h&&-1!==c&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p),n(s,e.slice(c,h),!0),44===d&&(n(a,t,s),s=Object.create(null),t=void 0),c=h=-1}else if(61===d&&-1!==c&&-1===h)r=e.slice(c,p),c=h=-1;else throw SyntaxError(`Unexpected character at index ${p}`);else if(l){if(1!==i[d])throw SyntaxError(`Unexpected character at index ${p}`);-1===c?c=p:o||(o=!0),l=!1}else if(u)if(1===i[d])-1===c&&(c=p);else if(34===d&&-1!==c)u=!1,h=p;else if(92===d)l=!0;else throw SyntaxError(`Unexpected character at index ${p}`);else if(34===d&&61===e.charCodeAt(p-1))u=!0;else if(-1===h&&1===i[d])-1===c&&(c=p);else if(-1!==c&&(32===d||9===d))-1===h&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p);let i=e.slice(c,h);o&&(i=i.replace(/\\/g,""),o=!1),n(s,r,i),44===d&&(n(a,t,s),s=Object.create(null),t=void 0),r=void 0,c=h=-1}else throw SyntaxError(`Unexpected character at index ${p}`);if(-1===c||u||32===d||9===d)throw SyntaxError("Unexpected end of input");-1===h&&(h=p);let f=e.slice(c,h);return void 0===t?n(a,f,s):(void 0===r?n(s,f,!0):o?n(s,r,f.replace(/\\/g,"")):n(s,r,f),n(a,t,s)),a}}},106281,(e,t,r)=>{"use strict";let i=e.r(427699),n=e.r(524836),a=e.r(921517),s=e.r(504446),o=e.r(755004),{randomBytes:l,createHash:u}=e.r(254799),{Duplex:c,Readable:d}=e.r(688947),{URL:h}=e.r(792509),p=e.r(497012),f=e.r(217953),m=e.r(260238),{isBlob:g}=e.r(497112),{BINARY_TYPES:y,EMPTY_BUFFER:_,GUID:v,kForOnEventAttribute:b,kListener:w,kStatusCode:E,kWebSocket:T,NOOP:S}=e.r(531258),{EventTarget:{addEventListener:I,removeEventListener:O}}=e.r(85205),{format:A,parse:k}=e.r(394393),{toBuffer:x}=e.r(139078),$=Symbol("kAborted"),C=[8,13],N=["CONNECTING","OPEN","CLOSING","CLOSED"],P=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class R extends i{constructor(e,t,r){super(),this._binaryType=y[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=_,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=R.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(r=t,t=[]):t=[t]),function e(t,r,i,s){let o,c,d,f,m={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:C[1],maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=m.autoPong,!C.includes(m.protocolVersion))throw RangeError(`Unsupported protocol version: ${m.protocolVersion} (supported versions: ${C.join(", ")})`);if(r instanceof h)o=r;else try{o=new h(r)}catch(e){throw SyntaxError(`Invalid URL: ${r}`)}"http:"===o.protocol?o.protocol="ws:":"https:"===o.protocol&&(o.protocol="wss:"),t._url=o.href;let g="wss:"===o.protocol,y="ws+unix:"===o.protocol;if("ws:"===o.protocol||g||y?y&&!o.pathname?c="The URL's pathname is empty":o.hash&&(c="The URL contains a fragment identifier"):c='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',c){let e=SyntaxError(c);if(0!==t._redirects)return void j(t,e);throw e}let _=g?443:80,b=l(16).toString("base64"),w=g?n.request:a.request,E=new Set;if(m.createConnection=m.createConnection||(g?L:U),m.defaultPort=m.defaultPort||_,m.port=o.port||_,m.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,m.headers={...m.headers,"Sec-WebSocket-Version":m.protocolVersion,"Sec-WebSocket-Key":b,Connection:"Upgrade",Upgrade:"websocket"},m.path=o.pathname+o.search,m.timeout=m.handshakeTimeout,m.perMessageDeflate&&(d=new p(!0!==m.perMessageDeflate?m.perMessageDeflate:{},!1,m.maxPayload),m.headers["Sec-WebSocket-Extensions"]=A({[p.extensionName]:d.offer()})),i.length){for(let e of i){if("string"!=typeof e||!P.test(e)||E.has(e))throw SyntaxError("An invalid or duplicated subprotocol was specified");E.add(e)}m.headers["Sec-WebSocket-Protocol"]=i.join(",")}if(m.origin&&(m.protocolVersion<13?m.headers["Sec-WebSocket-Origin"]=m.origin:m.headers.Origin=m.origin),(o.username||o.password)&&(m.auth=`${o.username}:${o.password}`),y){let e=m.path.split(":");m.socketPath=e[0],m.path=e[1]}if(m.followRedirects){if(0===t._redirects){t._originalIpc=y,t._originalSecure=g,t._originalHostOrSocketPath=y?m.socketPath:o.host;let e=s&&s.headers;if(s={...s,headers:{}},e)for(let[t,r]of Object.entries(e))s.headers[t.toLowerCase()]=r}else if(0===t.listenerCount("redirect")){let e=y?!!t._originalIpc&&m.socketPath===t._originalHostOrSocketPath:!t._originalIpc&&o.host===t._originalHostOrSocketPath;e&&(!t._originalSecure||g)||(delete m.headers.authorization,delete m.headers.cookie,e||delete m.headers.host,m.auth=void 0)}m.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(m.auth).toString("base64")),f=t._req=w(m),t._redirects&&t.emit("redirect",t.url,f)}else f=t._req=w(m);m.timeout&&f.on("timeout",()=>{D(t,f,"Opening handshake has timed out")}),f.on("error",e=>{null===f||f[$]||(f=t._req=null,j(t,e))}),f.on("response",n=>{let a=n.headers.location,o=n.statusCode;if(a&&m.followRedirects&&o>=300&&o<400){let n;if(++t._redirects>m.maxRedirects)return void D(t,f,"Maximum redirects exceeded");f.abort();try{n=new h(a,r)}catch(e){j(t,SyntaxError(`Invalid URL: ${a}`));return}e(t,n,i,s)}else t.emit("unexpected-response",f,n)||D(t,f,`Unexpected server response: ${n.statusCode}`)}),f.on("upgrade",(e,r,i)=>{let n;if(t.emit("upgrade",e),t.readyState!==R.CONNECTING)return;f=t._req=null;let a=e.headers.upgrade;if(void 0===a||"websocket"!==a.toLowerCase())return void D(t,r,"Invalid Upgrade header");let s=u("sha1").update(b+v).digest("base64");if(e.headers["sec-websocket-accept"]!==s)return void D(t,r,"Invalid Sec-WebSocket-Accept header");let o=e.headers["sec-websocket-protocol"];if(void 0!==o?E.size?E.has(o)||(n="Server sent an invalid subprotocol"):n="Server sent a subprotocol but none was requested":E.size&&(n="Server sent no subprotocol"),n)return void D(t,r,n);o&&(t._protocol=o);let l=e.headers["sec-websocket-extensions"];if(void 0!==l){let e;if(!d)return void D(t,r,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{e=k(l)}catch(e){D(t,r,"Invalid Sec-WebSocket-Extensions header");return}let i=Object.keys(e);if(1!==i.length||i[0]!==p.extensionName)return void D(t,r,"Server indicated an extension that was not requested");try{d.accept(e[p.extensionName])}catch(e){D(t,r,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[p.extensionName]=d}t.setSocket(r,i,{allowSynchronousEvents:m.allowSynchronousEvents,generateMask:m.generateMask,maxPayload:m.maxPayload,skipUTF8Validation:m.skipUTF8Validation})}),m.finishRequest?m.finishRequest(f,t):f.end()}(this,e,t,r)):(this._autoPong=r.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){y.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){let i=new f({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation}),n=new m(e,this._extensions,r.generateMask);this._receiver=i,this._sender=n,this._socket=e,i[T]=this,n[T]=this,e[T]=this,i.on("conclude",z),i.on("drain",F),i.on("error",B),i.on("message",G),i.on("ping",H),i.on("pong",q),n.onerror=K,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",V),e.on("data",Y),e.on("end",X),e.on("error",Q),this._readyState=R.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=R.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[p.extensionName]&&this._extensions[p.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=R.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==R.CLOSED){if(this.readyState===R.CONNECTING)return void D(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===R.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=R.CLOSING,this._sender.close(e,t,!this._isServer,e=>{!e&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),J(this)}}pause(){this.readyState!==R.CONNECTING&&this.readyState!==R.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===R.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==R.OPEN)?M(this,e,r):(void 0===t&&(t=!this._isServer),this._sender.ping(e||_,t,r))}pong(e,t,r){if(this.readyState===R.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==R.OPEN)?M(this,e,r):(void 0===t&&(t=!this._isServer),this._sender.pong(e||_,t,r))}resume(){this.readyState!==R.CONNECTING&&this.readyState!==R.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===R.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(r=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==R.OPEN)return void M(this,e,r);let i={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[p.extensionName]||(i.compress=!1),this._sender.send(e||_,i,r)}terminate(){if(this.readyState!==R.CLOSED){if(this.readyState===R.CONNECTING)return void D(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=R.CLOSING,this._socket.destroy())}}}function j(e,t){e._readyState=R.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function U(e){return e.path=e.socketPath,s.connect(e)}function L(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=s.isIP(e.host)?"":e.host),o.connect(e)}function D(e,t,r){e._readyState=R.CLOSING;let i=Error(r);Error.captureStackTrace(i,D),t.setHeader?(t[$]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(j,e,i)):(t.destroy(i),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function M(e,t,r){if(t){let r=g(t)?t.size:x(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}if(r){let t=Error(`WebSocket is not open: readyState ${e.readyState} (${N[e.readyState]})`);process.nextTick(r,t)}}function z(e,t){let r=this[T];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,void 0!==r._socket[T]&&(r._socket.removeListener("data",Y),process.nextTick(W,r._socket),1005===e?r.close():r.close(e,t))}function F(){let e=this[T];e.isPaused||e._socket.resume()}function B(e){let t=this[T];void 0!==t._socket[T]&&(t._socket.removeListener("data",Y),process.nextTick(W,t._socket),t.close(e[E])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function Z(){this[T].emitClose()}function G(e,t){this[T].emit("message",e,t)}function H(e){let t=this[T];t._autoPong&&t.pong(e,!this._isServer,S),t.emit("ping",e)}function q(e){this[T].emit("pong",e)}function W(e){e.resume()}function K(e){let t=this[T];t.readyState!==R.CLOSED&&(t.readyState===R.OPEN&&(t._readyState=R.CLOSING,J(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function J(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),3e4)}function V(){let e,t=this[T];this.removeListener("close",V),this.removeListener("data",Y),this.removeListener("end",X),t._readyState=R.CLOSING,this._readableState.endEmitted||t._closeFrameReceived||t._receiver._writableState.errorEmitted||null===(e=t._socket.read())||t._receiver.write(e),t._receiver.end(),this[T]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",Z),t._receiver.on("finish",Z))}function Y(e){this[T]._receiver.write(e)||this.pause()}function X(){let e=this[T];e._readyState=R.CLOSING,e._receiver.end(),this.end()}function Q(){let e=this[T];this.removeListener("error",Q),this.on("error",S),e&&(e._readyState=R.CLOSING,this.destroy())}Object.defineProperty(R,"CONNECTING",{enumerable:!0,value:N.indexOf("CONNECTING")}),Object.defineProperty(R.prototype,"CONNECTING",{enumerable:!0,value:N.indexOf("CONNECTING")}),Object.defineProperty(R,"OPEN",{enumerable:!0,value:N.indexOf("OPEN")}),Object.defineProperty(R.prototype,"OPEN",{enumerable:!0,value:N.indexOf("OPEN")}),Object.defineProperty(R,"CLOSING",{enumerable:!0,value:N.indexOf("CLOSING")}),Object.defineProperty(R.prototype,"CLOSING",{enumerable:!0,value:N.indexOf("CLOSING")}),Object.defineProperty(R,"CLOSED",{enumerable:!0,value:N.indexOf("CLOSED")}),Object.defineProperty(R.prototype,"CLOSED",{enumerable:!0,value:N.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(R.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(R.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[b])return t[w];return null},set(t){for(let t of this.listeners(e))if(t[b]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[b]:!0})}})}),R.prototype.addEventListener=I,R.prototype.removeEventListener=O,t.exports=R},366212,(e,t,r)=>{"use strict";e.r(106281);let{Duplex:i}=e.r(688947);function n(e){e.emit("close")}function a(){!this.destroyed&&this._writableState.finished&&this.destroy()}function s(e){this.removeListener("error",s),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}t.exports=function(e,t){let r=!0,o=new i({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,r){let i=!r&&o._readableState.objectMode?t.toString():t;o.push(i)||e.pause()}),e.once("error",function(e){o.destroyed||(r=!1,o.destroy(e))}),e.once("close",function(){o.destroyed||o.push(null)}),o._destroy=function(t,i){if(e.readyState===e.CLOSED){i(t),process.nextTick(n,o);return}let a=!1;e.once("error",function(e){a=!0,i(e)}),e.once("close",function(){a||i(t),process.nextTick(n,o)}),r&&e.terminate()},o._final=function(t){e.readyState===e.CONNECTING?e.once("open",function(){o._final(t)}):null!==e._socket&&(e._socket._writableState.finished?(t(),o._readableState.endEmitted&&o.destroy()):(e._socket.once("finish",function(){t()}),e.close()))},o._read=function(){e.isPaused&&e.resume()},o._write=function(t,r,i){e.readyState===e.CONNECTING?e.once("open",function(){o._write(t,r,i)}):e.send(t,i)},o.on("end",a),o.on("error",s),o}},409915,(e,t,r)=>{"use strict";let{tokenChars:i}=e.r(497112);t.exports={parse:function(e){let t=new Set,r=-1,n=-1,a=0;for(;a<e.length;a++){let s=e.charCodeAt(a);if(-1===n&&1===i[s])-1===r&&(r=a);else if(0!==a&&(32===s||9===s))-1===n&&-1!==r&&(n=a);else if(44===s){if(-1===r)throw SyntaxError(`Unexpected character at index ${a}`);-1===n&&(n=a);let i=e.slice(r,n);if(t.has(i))throw SyntaxError(`The "${i}" subprotocol is duplicated`);t.add(i),r=n=-1}else throw SyntaxError(`Unexpected character at index ${a}`)}if(-1===r||-1!==n)throw SyntaxError("Unexpected end of input");let s=e.slice(r,a);if(t.has(s))throw SyntaxError(`The "${s}" subprotocol is duplicated`);return t.add(s),t}}},903441,(e,t,r)=>{"use strict";let i=e.r(427699),n=e.r(921517),{Duplex:a}=e.r(688947),{createHash:s}=e.r(254799),o=e.r(394393),l=e.r(497012),u=e.r(409915),c=e.r(106281),{GUID:d,kWebSocket:h}=e.r(531258),p=/^[+/0-9A-Za-z]{22}==$/;function f(e){e._state=2,e.emit("close")}function m(){this.destroy()}function g(e,t,r,i){r=r||n.STATUS_CODES[t],i={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...i},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${n.STATUS_CODES[t]}\r
`+Object.keys(i).map(e=>`${e}: ${i[e]}`).join("\r\n")+"\r\n\r\n"+r)}function y(e,t,r,i,n,a){if(e.listenerCount("wsClientError")){let i=Error(n);Error.captureStackTrace(i,y),e.emit("wsClientError",i,r,t)}else g(r,i,n,a)}t.exports=class extends i{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:c,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=n.createServer((e,t)=>{let r=n.STATUS_CODES[426];t.writeHead(426,{"Content-Length":r.length,"Content-Type":"text/plain"}),t.end(r)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(let r of Object.keys(t))e.on(r,t[r]);return function(){for(let r of Object.keys(t))e.removeListener(r,t[r])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,r,i)=>{this.handleUpgrade(t,r,i,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state){e&&this.once("close",()=>{e(Error("The server is not running"))}),process.nextTick(f,this);return}if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(f,this);else{let e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{f(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,i){t.on("error",m);let n=e.headers["sec-websocket-key"],a=e.headers.upgrade,s=+e.headers["sec-websocket-version"];if("GET"!==e.method)return void y(this,e,t,405,"Invalid HTTP method");if(void 0===a||"websocket"!==a.toLowerCase())return void y(this,e,t,400,"Invalid Upgrade header");if(void 0===n||!p.test(n))return void y(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");if(13!==s&&8!==s)return void y(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});if(!this.shouldHandle(e))return void g(t,400);let c=e.headers["sec-websocket-protocol"],d=new Set;if(void 0!==c)try{d=u.parse(c)}catch(r){y(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let h=e.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&void 0!==h){let r=new l(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let e=o.parse(h);e[l.extensionName]&&(r.accept(e[l.extensionName]),f[l.extensionName]=r)}catch(r){y(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let a={origin:e.headers[`${8===s?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(a,(a,s,o,l)=>{if(!a)return g(t,s||401,o,l);this.completeUpgrade(f,n,d,e,t,r,i)});if(!this.options.verifyClient(a))return g(t,401)}this.completeUpgrade(f,n,d,e,t,r,i)}completeUpgrade(e,t,r,i,n,a,u){if(!n.readable||!n.writable)return n.destroy();if(n[h])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return g(n,503);let c=s("sha1").update(t+d).digest("base64"),p=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${c}`],y=new this.options.WebSocket(null,void 0,this.options);if(r.size){let e=this.options.handleProtocols?this.options.handleProtocols(r,i):r.values().next().value;e&&(p.push(`Sec-WebSocket-Protocol: ${e}`),y._protocol=e)}if(e[l.extensionName]){let t=e[l.extensionName].params,r=o.format({[l.extensionName]:[t]});p.push(`Sec-WebSocket-Extensions: ${r}`),y._extensions=e}this.emit("headers",p,i),n.write(p.concat("\r\n").join("\r\n")),n.removeListener("error",m),y.setSocket(n,a,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(y),y.on("close",()=>{this.clients.delete(y),this._shouldEmitClose&&!this.clients.size&&process.nextTick(f,this)})),u(y,i)}}},331950,929492,703932,164476,221078,351250,14006,574394,203068,880002,684734,520676,995515,404650,466405,e=>{"use strict";let t,r,i,n,a,s,o,l,u,c,d,h,p,f;(e2=ta||(ta={})).STRING="string",e2.NUMBER="number",e2.INTEGER="integer",e2.BOOLEAN="boolean",e2.ARRAY="array",e2.OBJECT="object",(e6=ts||(ts={})).LANGUAGE_UNSPECIFIED="language_unspecified",e6.PYTHON="python",(e9=to||(to={})).OUTCOME_UNSPECIFIED="outcome_unspecified",e9.OUTCOME_OK="outcome_ok",e9.OUTCOME_FAILED="outcome_failed",e9.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";let m=["user","model","function","system"];(e3=tl||(tl={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e3.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e3.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e3.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e3.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e3.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(e5=tu||(tu={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e5.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e5.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e5.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e5.BLOCK_NONE="BLOCK_NONE",(e8=tc||(tc={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e8.NEGLIGIBLE="NEGLIGIBLE",e8.LOW="LOW",e8.MEDIUM="MEDIUM",e8.HIGH="HIGH",(e7=td||(td={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e7.SAFETY="SAFETY",e7.OTHER="OTHER",(te=th||(th={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",te.STOP="STOP",te.MAX_TOKENS="MAX_TOKENS",te.SAFETY="SAFETY",te.RECITATION="RECITATION",te.LANGUAGE="LANGUAGE",te.BLOCKLIST="BLOCKLIST",te.PROHIBITED_CONTENT="PROHIBITED_CONTENT",te.SPII="SPII",te.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",te.OTHER="OTHER",(tt=tp||(tp={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",tt.RETRIEVAL_QUERY="RETRIEVAL_QUERY",tt.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",tt.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",tt.CLASSIFICATION="CLASSIFICATION",tt.CLUSTERING="CLUSTERING",(tr=tf||(tf={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",tr.AUTO="AUTO",tr.ANY="ANY",tr.NONE="NONE",(ti=tm||(tm={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",ti.MODE_DYNAMIC="MODE_DYNAMIC";class g extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class y extends g{constructor(e,t){super(e),this.response=t}}class _ extends g{constructor(e,t,r,i){super(e),this.status=t,this.statusText=r,this.errorDetails=i}}class v extends g{}class b extends g{}(tn=tg||(tg={})).GENERATE_CONTENT="generateContent",tn.STREAM_GENERATE_CONTENT="streamGenerateContent",tn.COUNT_TOKENS="countTokens",tn.EMBED_CONTENT="embedContent",tn.BATCH_EMBED_CONTENTS="batchEmbedContents";class w{constructor(e,t,r,i,n){this.model=e,this.task=t,this.apiKey=r,this.stream=i,this.requestOptions=n}toString(){var e,t;let r=(null==(e=this.requestOptions)?void 0:e.apiVersion)||"v1beta",i=(null==(t=this.requestOptions)?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",n=`${i}/${r}/${this.model}:${this.task}`;return this.stream&&(n+="?alt=sse"),n}}async function E(e){var t,r;let i,n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",(r=e.requestOptions,i=[],(null==r?void 0:r.apiClient)&&i.push(r.apiClient),i.push("genai-js/0.24.0"),i.join(" "))),n.append("x-goog-api-key",e.apiKey);let a=null==(t=e.requestOptions)?void 0:t.customHeaders;if(a){if(!(a instanceof Headers))try{a=new Headers(a)}catch(e){throw new v(`unable to convert customHeaders value ${JSON.stringify(a)} to Headers: ${e.message}`)}for(let[e,t]of a.entries()){if("x-goog-api-key"===e)throw new v(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new v(`Header name ${e} can only be set using the apiClient field`);n.append(e,t)}}return n}async function T(e,t,r,i,n,a){let s=new w(e,t,r,i,a);return{url:s.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let r=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>r.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{r.abort()}),t.signal=r.signal}return t}(a)),{method:"POST",headers:await E(s),body:n})}}async function S(e,t,r,i,n,a={},s=fetch){let{url:o,fetchOptions:l}=await T(e,t,r,i,n,a);return I(o,l,s)}async function I(e,t,r=fetch){let i;try{i=await r(e,t)}catch(r){var n=r,a=e;let t=n;throw"AbortError"===t.name?(t=new b(`Request aborted when fetching ${a.toString()}: ${n.message}`)).stack=n.stack:n instanceof _||n instanceof v||((t=new g(`Error fetching from ${a.toString()}: ${n.message}`)).stack=n.stack),t}return i.ok||await O(i,e),i}async function O(e,t){let r,i="";try{let t=await e.json();i=t.error.message,t.error.details&&(i+=` ${JSON.stringify(t.error.details)}`,r=t.error.details)}catch(e){}throw new _(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${i}`,e.status,e.statusText,r)}function A(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),$(e.candidates[0]))throw new y(`${C(e)}`,e);return function(e){var t,r,i,n;let a=[];if(null==(r=null==(t=e.candidates)?void 0:t[0].content)?void 0:r.parts)for(let t of null==(n=null==(i=e.candidates)?void 0:i[0].content)?void 0:n.parts)t.text&&a.push(t.text),t.executableCode&&a.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&a.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}(e)}if(e.promptFeedback)throw new y(`Text not available. ${C(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),$(e.candidates[0]))throw new y(`${C(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),k(e)[0]}if(e.promptFeedback)throw new y(`Function call not available. ${C(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),$(e.candidates[0]))throw new y(`${C(e)}`,e);return k(e)}if(e.promptFeedback)throw new y(`Function call not available. ${C(e)}`,e)},e}function k(e){var t,r,i,n;let a=[];if(null==(r=null==(t=e.candidates)?void 0:t[0].content)?void 0:r.parts)for(let t of null==(n=null==(i=e.candidates)?void 0:i[0].content)?void 0:n.parts)t.functionCall&&a.push(t.functionCall);return a.length>0?a:void 0}let x=[th.RECITATION,th.SAFETY,th.LANGUAGE];function $(e){return!!e.finishReason&&x.includes(e.finishReason)}function C(e){var t,r,i;let n="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)n+="Response was blocked",(null==(t=e.promptFeedback)?void 0:t.blockReason)&&(n+=` due to ${e.promptFeedback.blockReason}`),(null==(r=e.promptFeedback)?void 0:r.blockReasonMessage)&&(n+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null==(i=e.candidates)?void 0:i[0]){let t=e.candidates[0];$(t)&&(n+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(n+=`: ${t.finishMessage}`))}return n}function N(e){return this instanceof N?(this.v=e,this):new N(e)}"function"==typeof SuppressedError&&SuppressedError;let P=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function R(e){let t=[],r=e.getReader();for(;;){let{done:e,value:i}=await r.read();if(e)return A(function(e){let t=e[e.length-1],r={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates){let e=0;for(let i of t.candidates)if(r.candidates||(r.candidates=[]),r.candidates[e]||(r.candidates[e]={index:e}),r.candidates[e].citationMetadata=i.citationMetadata,r.candidates[e].groundingMetadata=i.groundingMetadata,r.candidates[e].finishReason=i.finishReason,r.candidates[e].finishMessage=i.finishMessage,r.candidates[e].safetyRatings=i.safetyRatings,i.content&&i.content.parts){r.candidates[e].content||(r.candidates[e].content={role:i.content.role||"user",parts:[]});let t={};for(let n of i.content.parts)n.text&&(t.text=n.text),n.functionCall&&(t.functionCall=n.functionCall),n.executableCode&&(t.executableCode=n.executableCode),n.codeExecutionResult&&(t.codeExecutionResult=n.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),r.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(r.usageMetadata=t.usageMetadata)}return r}(t));t.push(i)}}async function j(e,t,r,i){return function(e){let t,[r,i]=(t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})).getReader(),new ReadableStream({start(e){let r="";return function i(){return t.read().then(({value:t,done:n})=>{let a;if(n)return r.trim()?void e.error(new g("Failed to parse stream")):void e.close();let s=(r+=t).match(P);for(;s;){try{a=JSON.parse(s[1])}catch(t){e.error(new g(`Error parsing JSON response: "${s[1]}"`));return}e.enqueue(a),s=(r=r.substring(s[0].length)).match(P)}return i()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new b("Request aborted when reading from the stream"):new g("Error reading from the stream")})}()}})).tee();return{stream:function(e){return function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,n=r.apply(e,t||[]),a=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(e){n[e]&&(i[e]=function(t){return new Promise(function(r,i){a.push([e,t,r,i])>1||o(e,t)})})}function o(e,t){try{var r;(r=n[e](t)).value instanceof N?Promise.resolve(r.value.v).then(l,u):c(a[0][2],r)}catch(e){c(a[0][3],e)}}function l(e){o("next",e)}function u(e){o("throw",e)}function c(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:r}=yield N(t.read());if(r)break;yield yield N(A(e))}})}(r),response:R(i)}}(await S(t,tg.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(r),i))}async function U(e,t,r,i){let n=await S(t,tg.GENERATE_CONTENT,e,!1,JSON.stringify(r),i);return{response:A(await n.json())}}function L(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)if(!e.role)return{role:"system",parts:e.parts};else return e}}function D(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let r of e)"string"==typeof r?t.push({text:r}):t.push(r);var r=t;let i={role:"user",parts:[]},n={role:"function",parts:[]},a=!1,s=!1;for(let e of r)"functionResponse"in e?(n.parts.push(e),s=!0):(i.parts.push(e),a=!0);if(a&&s)throw new g("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!a&&!s)throw new g("No content is provided for sending chat message.");return a?i:n}function M(e){let t;return t=e.contents?e:{contents:[D(e)]},e.systemInstruction&&(t.systemInstruction=L(e.systemInstruction)),t}let z=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],F={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function B(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;let r=null==(t=e.candidates[0])?void 0:t.content;if(void 0===r||void 0===r.parts||0===r.parts.length)return!1;for(let e of r.parts)if(void 0===e||0===Object.keys(e).length||void 0!==e.text&&""===e.text)return!1;return!0}let Z="SILENT_ERROR";class G{constructor(e,t,r,i={}){this.model=t,this.params=r,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==r?void 0:r.history)&&(!function(e){let t=!1;for(let r of e){let{role:e,parts:i}=r;if(!t&&"user"!==e)throw new g(`First content should be with role 'user', got ${e}`);if(!m.includes(e))throw new g(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(m)}`);if(!Array.isArray(i))throw new g("Content should have 'parts' property with an array of Parts");if(0===i.length)throw new g("Each Content should have at least one part");let n={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of i)for(let t of z)t in e&&(n[t]+=1);let a=F[e];for(let t of z)if(!a.includes(t)&&n[t]>0)throw new g(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var r,i,n,a,s,o;let l;await this._sendPromise;let u=D(e),c={safetySettings:null==(r=this.params)?void 0:r.safetySettings,generationConfig:null==(i=this.params)?void 0:i.generationConfig,tools:null==(n=this.params)?void 0:n.tools,toolConfig:null==(a=this.params)?void 0:a.toolConfig,systemInstruction:null==(s=this.params)?void 0:s.systemInstruction,cachedContent:null==(o=this.params)?void 0:o.cachedContent,contents:[...this._history,u]},d=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>U(this._apiKey,this.model,c,d)).then(e=>{var t;if(B(e.response)){this._history.push(u);let r=Object.assign({parts:[],role:"model"},null==(t=e.response.candidates)?void 0:t[0].content);this._history.push(r)}else{let t=C(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}l=e}),await this._sendPromise,l}async sendMessageStream(e,t={}){var r,i,n,a,s,o;await this._sendPromise;let l=D(e),u={safetySettings:null==(r=this.params)?void 0:r.safetySettings,generationConfig:null==(i=this.params)?void 0:i.generationConfig,tools:null==(n=this.params)?void 0:n.tools,toolConfig:null==(a=this.params)?void 0:a.toolConfig,systemInstruction:null==(s=this.params)?void 0:s.systemInstruction,cachedContent:null==(o=this.params)?void 0:o.cachedContent,contents:[...this._history,l]},c=Object.assign(Object.assign({},this._requestOptions),t),d=j(this._apiKey,this.model,u,c);return this._sendPromise=this._sendPromise.then(()=>d).catch(e=>{throw Error(Z)}).then(e=>e.response).then(e=>{if(B(e)){this._history.push(l);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=C(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==Z&&console.error(e)}),d}}async function H(e,t,r,i){return(await S(t,tg.COUNT_TOKENS,e,!1,JSON.stringify(r),i)).json()}async function q(e,t,r,i){return(await S(t,tg.EMBED_CONTENT,e,!1,JSON.stringify(r),i)).json()}async function W(e,t,r,i){let n=r.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await S(t,tg.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:n}),i)).json()}class K{constructor(e,t,r={}){this.apiKey=e,this._requestOptions=r,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=L(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var r;let i=M(e),n=Object.assign(Object.assign({},this._requestOptions),t);return U(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(r=this.cachedContent)?void 0:r.name},i),n)}async generateContentStream(e,t={}){var r;let i=M(e),n=Object.assign(Object.assign({},this._requestOptions),t);return j(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(r=this.cachedContent)?void 0:r.name},i),n)}startChat(e){var t;return new G(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(t=this.cachedContent)?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let r=function(e,t){var r;let i={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null==(r=null==t?void 0:t.cachedContent)?void 0:r.name,contents:[]},n=null!=e.generateContentRequest;if(e.contents){if(n)throw new v("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=e.contents}else if(n)i=Object.assign(Object.assign({},i),e.generateContentRequest);else{let t=D(e);i.contents=[t]}return{generateContentRequest:i}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),t);return H(this.apiKey,this.model,r,i)}async embedContent(e,t={}){let r="string"==typeof e||Array.isArray(e)?{content:D(e)}:e,i=Object.assign(Object.assign({},this._requestOptions),t);return q(this.apiKey,this.model,r,i)}async batchEmbedContents(e,t={}){let r=Object.assign(Object.assign({},this._requestOptions),t);return W(this.apiKey,this.model,e,r)}}class J{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new g("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new K(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,r){if(!e.name)throw new v("Cached content must contain a `name` field.");if(!e.model)throw new v("Cached content must contain a `model` field.");for(let r of["model","systemInstruction"])if((null==t?void 0:t[r])&&e[r]&&(null==t?void 0:t[r])!==e[r]){if("model"===r&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new v(`Different value for "${r}" specified in modelParams (${t[r]}) and cachedContent (${e[r]})`)}let i=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new K(this.apiKey,i,r)}}var V,Y,X,Q,ee,et,er,ei,en,ea,es,eo,el,eu,ec,ed,eh,ep,ef,em,eg,ey,e_,ev,eb,ew,eE,eT,eS,eI,eO,eA,ek,ex,e$,eC,eN,eP,eR,ej,eU,eL,eD,eM,ez,eF,eB,eZ,eG,eH,eq,eW,eK,eJ,eV,eY,eX,eQ,e0,e1,e4,e2,e6,e9,e3,e5,e8,e7,te,tt,tr,ti,tn,ta,ts,to,tl,tu,tc,td,th,tp,tf,tm,tg,ty,t_,tv,tb,tw,tE,tT,tS,tI,tO,tA,tk,tx,t$,tC,tN,tP,tR,tj,tU,tL,tD,tM,tz,tF,tB,tZ,tG,tH,tq,tW,tK,tJ,tV,tY,tX,tQ,t0,t1,t4,t2,t6,t9,t3,t5,t8,t7,re,rt,rr,ri,rn,ra,rs,ro,rl,ru,rc,rd,rh,rp,rf,rm,rg,ry,r_,rv,rb,rw,rE,rT,rS,rI,rO,rA,rk,rx,r$,rC,rN,rP,rR,rj,rU,rL,rD,rM,rz,rF,rB,rZ,rG,rH,rq,rW,rK,rJ,rV,rY,rX,rQ,r0,r1,r4,r2,r6,r9,r3,r5,r8,r7,ie,it,ir,ii,ia,is,io,il,iu,ic,id,ih,ip,im,ig,iy,i_,iv,ib,iw,iE,iT,iS=Object.defineProperty,iI=(e,t)=>{for(var r in t)iS(e,r,{get:t[r],enumerable:!0})};iI({},{getEnv:()=>iC,getEnvironmentVariable:()=>iP,getRuntimeEnvironment:()=>iN,isBrowser:()=>iO,isDeno:()=>ix,isJsDom:()=>ik,isNode:()=>i$,isWebWorker:()=>iA});let iO=()=>!1,iA=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,ik=()=>"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom"),ix=()=>"undefined"!=typeof Deno,i$=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!ix(),iC=()=>iO()?"browser":i$()?"node":iA()?"webworker":ik()?"jsdom":ix()?"deno":"other";function iN(){return void 0===t&&(t={library:"langchain-js",runtime:iC()}),t}function iP(e){try{if("undefined"!=typeof process)return process.env?.[e];if(ix())return Deno?.env.get(e);return}catch{return}}function iR(e){return"object"==typeof e&&null!==e&&"type"in e&&"string"==typeof e.type&&"source_type"in e&&("url"===e.source_type||"base64"===e.source_type||"text"===e.source_type||"id"===e.source_type)}function ij(e){return iR(e)&&"url"===e.source_type&&"url"in e&&"string"==typeof e.url}function iU(e){return iR(e)&&"base64"===e.source_type&&"data"in e&&"string"==typeof e.data}function iL(e){return iR(e)&&"text"===e.source_type&&"text"in e&&"string"==typeof e.text}function iD(e){return iR(e)&&"id"===e.source_type&&"id"in e&&"string"==typeof e.id}function iM(e){if(iR(e)){if("url"===e.source_type)return{type:"image_url",image_url:{url:e.url}};if("base64"===e.source_type){if(!e.mime_type)throw Error("mime_type key is required for base64 data.");let t=e.mime_type;return{type:"image_url",image_url:{url:`data:${t};base64,${e.data}`}}}}throw Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function iz(e){let t=e.split(";")[0].split("/");if(2!==t.length)throw Error(`Invalid mime type: "${e}" - does not match type/subtype format.`);let r=t[0].trim(),i=t[1].trim();if(""===r||""===i)throw Error(`Invalid mime type: "${e}" - type or subtype is empty.`);let n={};for(let t of e.split(";").slice(1)){let r=t.split("=");if(2!==r.length)throw Error(`Invalid parameter syntax in mime type: "${e}".`);let i=r[0].trim(),a=r[1].trim();if(""===i)throw Error(`Invalid parameter syntax in mime type: "${e}".`);n[i]=a}return{type:r,subtype:i,parameters:n}}function iF({dataUrl:e,asTypedArray:t=!1}){let r=e.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);if(r)return{mime_type:r[1].toLowerCase(),data:t?Uint8Array.from(atob(r[2]),e=>e.charCodeAt(0)):r[2]}}function iB(e,t){if("text"===e.type){if(!t.fromStandardTextBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardTextBlock\` method.`);return t.fromStandardTextBlock(e)}if("image"===e.type){if(!t.fromStandardImageBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardImageBlock\` method.`);return t.fromStandardImageBlock(e)}if("audio"===e.type){if(!t.fromStandardAudioBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardAudioBlock\` method.`);return t.fromStandardAudioBlock(e)}if("file"===e.type){if(!t.fromStandardFileBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardFileBlock\` method.`);return t.fromStandardFileBlock(e)}throw Error(`Unable to convert content block type '${e.type}' to provider-specific format: not recognized.`)}let iZ=/([\p{Alpha}\p{N}_]|$)/u;function iG(e,t){return t?.[e]||function(e,{separator:t="_",preserveConsecutiveUppercase:r=!1}={}){if("string"!=typeof e||"string"!=typeof t)throw TypeError("The `text` and `separator` arguments should be of type `string`");if(e.length<2)return r?e:e.toLowerCase();let i=`$1${t}$2`,n=e.replace(/([\p{Lowercase_Letter}\d])(\p{Uppercase_Letter})/gu,i);if(r){var a;return(a=n.replace(/((?<![\p{Uppercase_Letter}\d])[\p{Uppercase_Letter}\d](?![\p{Uppercase_Letter}\d]))/gu,e=>e.toLowerCase())).replace(/(?<!\p{Uppercase_Letter})(\p{Uppercase_Letter}+)(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,(e,r,i)=>r+t+i.toLowerCase())}return n.replace(/(\p{Uppercase_Letter})(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,i).toLowerCase()}(e)}function iH(e){return Array.isArray(e)?[...e]:{...e}}function iq(e){let t=Object.getPrototypeOf(e);return"function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}RegExp(/[_.\- ]+/.source+iZ.source,"gu"),RegExp(String.raw`\d+`+iZ.source,"gu"),iI({},{Serializable:()=>iW,get_lc_unique_name:()=>iq});var iW=class e{lc_serializable=!1;lc_kwargs;static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,iq(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){void 0!==this.lc_serializable_keys?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([e])=>this.lc_serializable_keys?.includes(e))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof e||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let t={},r={},i=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let e=Object.getPrototypeOf(this);e;e=Object.getPrototypeOf(e))Object.assign(t,Reflect.get(e,"lc_aliases",this)),Object.assign(r,Reflect.get(e,"lc_secrets",this)),Object.assign(i,Reflect.get(e,"lc_attributes",this));return Object.keys(r).forEach(e=>{let t=this,r=i,[n,...a]=e.split(".").reverse();for(let e of a.reverse()){if(!(e in t)||void 0===t[e])return;e in r&&void 0!==r[e]||("object"==typeof t[e]&&null!=t[e]?r[e]={}:Array.isArray(t[e])&&(r[e]=[])),t=t[e],r=r[e]}n in t&&void 0!==t[n]&&(r[n]=r[n]||t[n])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:function(e,t,r){let i={};for(let n in e)Object.hasOwn(e,n)&&(i[t(n,r)]=e[n]);return i}(Object.keys(r).length?function(e,t){let r=iH(e);for(let[e,i]of Object.entries(t)){let[t,...n]=e.split(".").reverse(),a=r;for(let e of n.reverse()){if(void 0===a[e])break;a[e]=iH(a[e]),a=a[e]}void 0!==a[t]&&(a[t]={lc:1,type:"secret",id:[i]})}return r}(i,r):i,iG,t)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function iK(e,t){return iJ(e)&&e.type===t}function iJ(e){return"object"==typeof e&&null!==e}function iV(e){return Array.isArray(e)}function iY(e){return"string"==typeof e}function iX(e){return"number"==typeof e}function iQ(e){return e instanceof Uint8Array}function i0(e){try{return JSON.parse(e)}catch{return}}let i1=e=>e();function i4(e){if(iK(e,"document")&&iJ(e.source)&&"type"in e.source){if("base64"===e.source.type&&iY(e.source.media_type)&&iY(e.source.data))return{type:"file",mimeType:e.source.media_type,data:e.source.data};else if("url"===e.source.type&&iY(e.source.url))return{type:"file",url:e.source.url};else if("file"===e.source.type&&iY(e.source.file_id))return{type:"file",fileId:e.source.file_id};else if("text"===e.source.type&&iY(e.source.data))return{type:"file",mimeType:String(e.source.media_type??"text/plain"),data:e.source.data}}else if(iK(e,"image")&&iJ(e.source)&&"type"in e.source){if("base64"===e.source.type&&iY(e.source.media_type)&&iY(e.source.data))return{type:"image",mimeType:e.source.media_type,data:e.source.data};else if("url"===e.source.type&&iY(e.source.url))return{type:"image",url:e.source.url};else if("file"===e.source.type&&iY(e.source.file_id))return{type:"image",fileId:e.source.file_id}}}function i2(e){return Array.from(function*(){for(let t of e){let e=i4(t);e?yield e:yield t}}())}function i6(e){return Array.from(function*(){for(let r of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content){if(iK(r,"text")&&iY(r.text)){let{text:e,citations:t,...i}=r;if(iV(t)&&t.length){let r=t.reduce((e,t)=>{let r=function(e){if("char_location"===e.type&&iY(e.document_title)&&iX(e.start_char_index)&&iX(e.end_char_index)&&iY(e.cited_text)){let{document_title:t,start_char_index:r,end_char_index:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"char",title:t??void 0,startIndex:r,endIndex:i,citedText:n}}if("page_location"===e.type&&iY(e.document_title)&&iX(e.start_page_number)&&iX(e.end_page_number)&&iY(e.cited_text)){let{document_title:t,start_page_number:r,end_page_number:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"page",title:t??void 0,startIndex:r,endIndex:i,citedText:n}}if("content_block_location"===e.type&&iY(e.document_title)&&iX(e.start_block_index)&&iX(e.end_block_index)&&iY(e.cited_text)){let{document_title:t,start_block_index:r,end_block_index:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"block",title:t??void 0,startIndex:r,endIndex:i,citedText:n}}if("web_search_result_location"===e.type&&iY(e.url)&&iY(e.title)&&iY(e.encrypted_index)&&iY(e.cited_text)){let{url:t,title:r,encrypted_index:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"url",url:t,title:r,startIndex:Number(i),endIndex:Number(i),citedText:n}}if("search_result_location"===e.type&&iY(e.source)&&iY(e.title)&&iX(e.start_block_index)&&iX(e.end_block_index)&&iY(e.cited_text)){let{source:t,title:r,start_block_index:i,end_block_index:n,cited_text:a,...s}=e;return{...s,type:"citation",source:"search",url:t,title:r??void 0,startIndex:i,endIndex:n,citedText:a}}}(t);return r?[...e,r]:e},[]);yield{...i,type:"text",text:e,annotations:r};continue}yield{...i,type:"text",text:e};continue}if(iK(r,"thinking")&&iY(r.thinking)){let{thinking:e,signature:t,...i}=r;yield{...i,type:"reasoning",reasoning:e,signature:t};continue}if(iK(r,"redacted_thinking")){yield{type:"non_standard",value:r};continue}else if(iK(r,"tool_use")&&iY(r.name)&&iY(r.id)){yield{type:"tool_call",id:r.id,name:r.name,args:r.input};continue}else if(iK(r,"input_json_delta")){var t;if(t=e,"function"==typeof t?._getType&&"function"==typeof t.concat&&"ai"===t._getType()&&e.tool_call_chunks?.length){let t=e.tool_call_chunks[0];yield{type:"tool_call_chunk",id:t.id,name:t.name,args:t.args,index:t.index};continue}}else if(iK(r,"server_tool_use")&&iY(r.name)&&iY(r.id)){let{name:e,id:t}=r;if("web_search"===e){let e=i1(()=>{if("string"==typeof r.input)return r.input;if(iJ(r.input)&&iY(r.input.query))return r.input.query;if(iY(r.partial_json)){let e=i0(r.partial_json);if(e?.query)return e.query}return""});yield{id:t,type:"server_tool_call",name:"web_search",args:{query:e}};continue}if("code_execution"===r.name){let e=i1(()=>{if("string"==typeof r.input)return r.input;if(iJ(r.input)&&iY(r.input.code))return r.input.code;if(iY(r.partial_json)){let e=i0(r.partial_json);if(e?.code)return e.code}return""});yield{id:t,type:"server_tool_call",name:"code_execution",args:{code:e}};continue}}else if(iK(r,"web_search_tool_result")&&iY(r.tool_use_id)&&iV(r.content)){let{content:e,tool_use_id:t}=r,i=e.reduce((e,t)=>iK(t,"web_search_result")?[...e,t.url]:e,[]);yield{type:"server_tool_call_result",name:"web_search",toolCallId:t,status:"success",output:{urls:i}};continue}else if(iK(r,"code_execution_tool_result")&&iY(r.tool_use_id)&&iJ(r.content)){yield{type:"server_tool_call_result",name:"code_execution",toolCallId:r.tool_use_id,status:"success",output:r.content};continue}else if(iK(r,"mcp_tool_use")){yield{id:r.id,type:"server_tool_call",name:"mcp_tool_use",args:r.input};continue}else if(iK(r,"mcp_tool_result")&&iY(r.tool_use_id)&&iJ(r.content)){yield{type:"server_tool_call_result",name:"mcp_tool_use",toolCallId:r.tool_use_id,status:"success",output:r.content};continue}else if(iK(r,"container_upload")){yield{type:"server_tool_call",name:"container_upload",args:r.input};continue}else if(iK(r,"search_result")){yield{id:r.id,type:"non_standard",value:r};continue}else if(iK(r,"tool_result")){yield{id:r.id,type:"non_standard",value:r};continue}else{let e=i4(r);if(e){yield e;continue}}yield{type:"non_standard",value:r}}}())}function i9(e){return ij(e)?{type:e.type,mimeType:e.mime_type,url:e.url,metadata:e.metadata}:iU(e)?{type:e.type,mimeType:e.mime_type??"application/octet-stream",data:e.data,metadata:e.metadata}:iD(e)?{type:e.type,mimeType:e.mime_type,fileId:e.id,metadata:e.metadata}:e}function i3(e){return e.map(i9)}function i5(e){let t=[];for(let r of e)(iK(r,"image_url")&&iJ(r.image_url)||iK(r,"input_audio")&&iJ(r.input_audio)||iK(r,"file")&&iJ(r.file)?0:1)?t.push(r):t.push(function(e){if(iK(e,"image_url")&&iJ(e.image_url)&&iY(e.image_url.url)){let t=iF({dataUrl:e.image_url.url});return t?{type:"image",mimeType:t.mime_type,data:t.data}:{type:"image",url:e.image_url.url}}if(iK(e,"input_audio")&&iJ(e.input_audio)&&iY(e.input_audio.data)&&iY(e.input_audio.format))return{type:"audio",data:e.input_audio.data,mimeType:`audio/${e.input_audio.format}`};if(iK(e,"file")&&iJ(e.file)&&iY(e.file.data)){let t=iF({dataUrl:e.file.data});if(t)return{type:"file",data:t.data,mimeType:t.mime_type};if(iY(e.file.file_id))return{type:"file",fileId:e.file.file_id}}return e}(r));return t}function i8(e){if("url_citation"===e.type){let{url:t,title:r,start_index:i,end_index:n}=e;return{type:"citation",url:t,title:r,startIndex:i,endIndex:n}}if("file_citation"===e.type){let{file_id:t,filename:r,index:i}=e;return{type:"citation",title:r,startIndex:i,endIndex:i,fileId:t}}return e}function i7(e){return Array.from(function*(){if(iJ(e.additional_kwargs?.reasoning)&&iV(e.additional_kwargs.reasoning.summary)){let t=e.additional_kwargs.reasoning.summary.reduce((e,t)=>iJ(t)&&iY(t.text)?`${e}${t.text}`:e,"");yield{type:"reasoning",reasoning:t}}for(let t of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content)if(iK(t,"text")){let{text:e,annotations:r,...i}=t;Array.isArray(r)?yield{...i,type:"text",text:String(e),annotations:r.map(i8)}:yield{...i,type:"text",text:String(e)}}for(let t of e.tool_calls??[])yield{type:"tool_call",id:t.id,name:t.name,args:t.args};if(iJ(e.additional_kwargs)&&iV(e.additional_kwargs.tool_outputs))for(let t of e.additional_kwargs.tool_outputs){if(iK(t,"web_search_call")){yield{id:t.id,type:"server_tool_call",name:"web_search",args:{query:t.query}};continue}if(iK(t,"file_search_call")){yield{id:t.id,type:"server_tool_call",name:"file_search",args:{query:t.query}};continue}if(iK(t,"computer_call")){yield{type:"non_standard",value:t};continue}else if(iK(t,"code_interpreter_call")){if(iY(t.code)&&(yield{id:t.id,type:"server_tool_call",name:"code_interpreter",args:{code:t.code}}),iV(t.outputs)){let e=i1(()=>{if("in_progress"!==t.status){if("completed"===t.status)return 0;if("incomplete"===t.status)return 127;if("interpreting"!==t.status&&"failed"===t.status)return 1}});for(let r of t.outputs)if(iK(r,"logs")){yield{type:"server_tool_call_result",toolCallId:t.id??"",status:"success",output:{type:"code_interpreter_output",returnCode:e??0,stderr:[0,void 0].includes(e)?void 0:String(r.logs),stdout:[0,void 0].includes(e)?String(r.logs):void 0}};continue}}continue}else if(iK(t,"mcp_call")){yield{id:t.id,type:"server_tool_call",name:"mcp_call",args:t.input};continue}else if(iK(t,"mcp_list_tools")){yield{id:t.id,type:"server_tool_call",name:"mcp_list_tools",args:t.input};continue}else if(iK(t,"mcp_approval_request")){yield{type:"non_standard",value:t};continue}else if(iK(t,"image_generation_call")){yield{type:"non_standard",value:t};continue}iJ(t)&&(yield{type:"non_standard",value:t})}}())}function ne(e){return"object"==typeof e&&null!==e&&"type"in e&&"content"in e&&("string"==typeof e.content||Array.isArray(e.content))}let nt=Symbol.for("langchain.message");function nr(e,t){if("string"==typeof e)return""===e?t:"string"==typeof t?e+t:Array.isArray(t)&&0===t.length?e:Array.isArray(t)&&t.some(e=>iR(e))?[{type:"text",source_type:"text",text:e},...t]:[{type:"text",text:e},...t];return Array.isArray(t)?no(e,t)??[...e,...t]:""===t?e:Array.isArray(e)&&e.some(e=>iR(e))?[...e,{type:"file",source_type:"text",text:t}]:[...e,{type:"text",text:t}]}function ni(e,t){return"error"===e||"error"===t?"error":"success"}var nn=class extends iW{lc_namespace=["langchain_core","messages"];lc_serializable=!0;get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}[nt]=!0;id;name;content;additional_kwargs;response_metadata;_getType(){return this.type}getType(){return this._getType()}constructor(e){const t="string"==typeof e||Array.isArray(e)?{content:e}:e;t.additional_kwargs||(t.additional_kwargs={}),t.response_metadata||(t.response_metadata={}),super(t),this.name=t.name,void 0===t.content&&void 0!==t.contentBlocks?(this.content=t.contentBlocks,this.response_metadata={output_version:"v1",...t.response_metadata}):(void 0!==t.content?this.content=t.content??[]:this.content=[],this.response_metadata=t.response_metadata),this.additional_kwargs=t.additional_kwargs,this.id=t.id}get text(){return"string"==typeof this.content?this.content:Array.isArray(this.content)?this.content.map(e=>"string"==typeof e?e:"text"===e.type?e.text:"").join(""):""}get contentBlocks(){return[i3,i5,i2].reduce((e,t)=>t(e),"string"==typeof this.content?[{type:"text",text:this.content}]:this.content)}toDict(){return{type:this.getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}static isInstance(e){return"object"==typeof e&&null!==e&&nt in e&&!0===e[nt]&&ne(e)}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){var t,r;if(null===e)return this;let i=(t=this._printableFields,r=Math.max(4,e),JSON.stringify(function e(t,i){if("object"!=typeof t||null==t)return t;if(i>=r)return Array.isArray(t)?"[Array]":"[Object]";if(Array.isArray(t))return t.map(t=>e(t,i+1));let n={};for(let r of Object.keys(t))n[r]=e(t[r],i+1);return n}(t,0),null,2));return`${this.constructor.lc_name()} ${i}`}toFormattedString(e="pretty"){return function(e,t="pretty"){return"pretty"===t?function(e){let t=[],r=` ${e.type.charAt(0).toUpperCase()+e.type.slice(1)} Message `,i=Math.floor((80-r.length)/2),n="=".repeat(i),a=r.length%2==0?n:`${n}=`;if(t.push(`${n}${r}${a}`),"ai"===e.type&&e.tool_calls&&e.tool_calls.length>0)for(let r of(t.push("Tool Calls:"),e.tool_calls))for(let[e,i]of(t.push(`  ${r.name} (${r.id})`),t.push(` Call ID: ${r.id}`),t.push("  Args:"),Object.entries(r.args)))t.push(`    ${e}: ${i}`);return"tool"===e.type&&e.name&&t.push(`Name: ${e.name}`),"string"==typeof e.content&&e.content.trim()&&(t.length>1&&t.push(""),t.push(e.content)),t.join("\n")}(e):JSON.stringify(e)}(this,e)}};function na(e){return Array.isArray(e)&&e.every(e=>"number"==typeof e.index)}function ns(e={},t={}){let r={...e};for(let[e,i]of Object.entries(t))if(null==r[e])r[e]=i;else if(null==i)continue;else if(typeof r[e]!=typeof i||Array.isArray(r[e])!==Array.isArray(i))throw Error(`field[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e])if("type"===e)continue;else["id","name","output_version","model_provider"].includes(e)?i&&(r[e]=i):r[e]+=i;else if("object"!=typeof r[e]||Array.isArray(r[e]))if(Array.isArray(r[e]))r[e]=no(r[e],i);else{if(r[e]===i)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}else r[e]=ns(r[e],i);return r}function no(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;let r=[...e];for(let e of t)if("object"==typeof e&&null!==e&&"index"in e&&"number"==typeof e.index){let t=r.findIndex(t=>{let r="object"==typeof t,i="index"in t&&t.index===e.index,n="id"in t&&"id"in e&&t?.id===e?.id,a=!("id"in t)||!t?.id||!("id"in e)||!e?.id;return r&&i&&(n||a)});-1!==t&&"object"==typeof r[t]&&null!==r[t]?r[t]=ns(r[t],e):r.push(e)}else{if("object"==typeof e&&null!==e&&"text"in e&&""===e.text)continue;r.push(e)}return r}}function nl(e,t){if(!e&&!t)throw Error("Cannot merge two undefined objects.");if(!e||!t)return e||t;if(typeof e!=typeof t)throw Error(`Cannot merge objects of different types.
Left ${typeof e}
Right ${typeof t}`);if("string"==typeof e&&"string"==typeof t)return e+t;if(Array.isArray(e)&&Array.isArray(t))return no(e,t);if("object"==typeof e&&"object"==typeof t)return ns(e,t);else if(e===t)return e;else throw Error(`Can not merge objects of different types.
Left ${e}
Right ${t}`)}var nu=class e extends nn{static isInstance(t){if(!super.isInstance(t))return!1;let r=Object.getPrototypeOf(t);for(;null!==r;){if(r===e.prototype)return!0;r=Object.getPrototypeOf(r)}return!1}};function nc(e){return"string"==typeof e.role}function nd(e){return"function"==typeof e?._getType}function nh(e){return nu.isInstance(e)}function np(e){return null!=e&&"object"==typeof e&&"lc_direct_tool_output"in e&&!0===e.lc_direct_tool_output}iI({},{ToolMessage:()=>nf,ToolMessageChunk:()=>nm,defaultToolCallParser:()=>ng,isDirectToolOutput:()=>np,isToolMessage:()=>ny,isToolMessageChunk:()=>n_});var nf=class extends nn{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}lc_direct_tool_output=!0;type="tool";status;tool_call_id;metadata;artifact;constructor(e,t,r){const i="string"==typeof e||Array.isArray(e)?{content:e,name:r,tool_call_id:t}:e;super(i),this.tool_call_id=i.tool_call_id,this.artifact=i.artifact,this.status=i.status,this.metadata=i.metadata}static isInstance(e){return super.isInstance(e)&&"tool"===e.type}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},nm=class extends nu{type="tool";tool_call_id;status;artifact;constructor(e){super(e),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}concat(e){return new this.constructor({content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:ns(this.response_metadata,e.response_metadata),artifact:nl(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:ni(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function ng(e){let t=[],r=[];for(let i of e)if(!i.function)continue;else{let e=i.function.name;try{let r=JSON.parse(i.function.arguments);t.push({name:e||"",args:r||{},id:i.id})}catch{r.push({name:e,args:i.function.arguments,id:i.id,error:"Malformed args."})}}return[t,r]}function ny(e){return"object"==typeof e&&null!==e&&"getType"in e&&"function"==typeof e.getType&&"tool"===e.getType()}function n_(e){return"tool"===e._getType()}function nv(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${t}/
`,e}function nb(e){return!!(e&&"object"==typeof e&&"type"in e&&"tool_call"===e.type)}var nw=class extends Error{output;constructor(e,t){super(e),this.output=t}};function nE(e,t=nT){let r=(e=e.trim()).indexOf("```");if(-1===r)return t(e);let i=e.substring(r+3);i.startsWith("json\n")?i=i.substring(5):i.startsWith("json")?i=i.substring(4):i.startsWith("\n")&&(i=i.substring(1));let n=i.indexOf("```"),a=i;return -1!==n&&(a=i.substring(0,n)),t(a.trim())}function nT(e){try{if(void 0===e)return null;return function(e){try{return JSON.parse(e)}catch{}let t=e.trim();if(0===t.length)throw Error("Unexpected end of JSON input");let r=0;function i(){for(;r<t.length&&/\s/.test(t[r]);)r+=1}function n(){if('"'!==t[r])throw Error(`Expected '"' at position ${r}, got '${t[r]}'`);r+=1;let e="",i=!1;for(;r<t.length;){let n=t[r];if(i){if("n"===n)e+="\n";else if("t"===n)e+="	";else if("r"===n)e+="\r";else if("\\"===n)e+="\\";else if('"'===n)e+='"';else if("b"===n)e+="\b";else if("f"===n)e+="\f";else if("/"===n)e+="/";else if("u"===n){let i=t.substring(r+1,r+5);if(/^[0-9A-Fa-f]{0,4}$/.test(i))4===i.length?e+=String.fromCharCode(Number.parseInt(i,16)):e+=`u${i}`,r+=i.length;else throw Error(`Invalid unicode escape sequence '\\u${i}' at position ${r}`)}else throw Error(`Invalid escape sequence '\\${n}' at position ${r}`);i=!1}else if("\\"===n)i=!0;else{if('"'===n)return r+=1,e;e+=n}r+=1}return i&&(e+="\\"),e}let a=function e(){if(i(),r>=t.length)throw Error(`Unexpected end of input at position ${r}`);let a=t[r];if("{"===a){if("{"!==t[r])throw Error(`Expected '{' at position ${r}, got '${t[r]}'`);let a={};if(r+=1,i(),r>=t.length)return a;if("}"===t[r])return r+=1,a;for(;r<t.length&&(i(),!(r>=t.length));){let s=n();if(i(),r>=t.length)break;if(":"!==t[r])throw Error(`Expected ':' at position ${r}, got '${t[r]}'`);if(r+=1,i(),r>=t.length||(a[s]=e(),i(),r>=t.length))break;if("}"===t[r]){r+=1;break}if(","===t[r]){r+=1;continue}throw Error(`Expected ',' or '}' at position ${r}, got '${t[r]}'`)}return a}if("["===a){if("["!==t[r])throw Error(`Expected '[' at position ${r}, got '${t[r]}'`);let n=[];if(r+=1,i(),r>=t.length)return n;if("]"===t[r])return r+=1,n;for(;r<t.length&&(i(),!(r>=t.length))&&(n.push(e()),i(),!(r>=t.length));){;if("]"===t[r]){r+=1;break}if(","===t[r]){r+=1;continue}throw Error(`Expected ',' or ']' at position ${r}, got '${t[r]}'`)}return n}if('"'===a)return n();if("null".startsWith(t.substring(r,r+4)))return r+=Math.min(4,t.length-r),null;if("true".startsWith(t.substring(r,r+4)))return r+=Math.min(4,t.length-r),!0;if("false".startsWith(t.substring(r,r+5)))return r+=Math.min(5,t.length-r),!1;if("-"===a||a>="0"&&a<="9"){let e=r,i="";if("-"===t[r]&&(i+="-",r+=1),r<t.length&&"0"===t[r]&&(i+="0",t[r+=1]>="0"&&t[r]<="9"))throw Error(`Invalid number at position ${e}`);if(r<t.length&&t[r]>="1"&&t[r]<="9")for(;r<t.length&&t[r]>="0"&&t[r]<="9";)i+=t[r],r+=1;if(r<t.length&&"."===t[r])for(i+=".",r+=1;r<t.length&&t[r]>="0"&&t[r]<="9";)i+=t[r],r+=1;if(r<t.length&&("e"===t[r]||"E"===t[r]))for(i+=t[r],(r+=1)<t.length&&("+"===t[r]||"-"===t[r])&&(i+=t[r],r+=1);r<t.length&&t[r]>="0"&&t[r]<="9";)i+=t[r],r+=1;if("-"===i)return -0;let n=Number.parseFloat(i);if(Number.isNaN(n))throw r=e,Error(`Invalid number '${i}' at position ${e}`);return n}throw Error(`Unexpected character '${a}' at position ${r}`)}();if(i(),r<t.length)throw Error(`Unexpected character '${t[r]}' at position ${r}`);return a}(e)}catch{return null}}var nS=class e extends nn{static lc_name(){return"ChatMessage"}type="generic";role;static _chatMessageClass(){return e}constructor(e,t){("string"==typeof e||Array.isArray(e))&&(e={content:e,role:t}),super(e),this.role=e.role}static isInstance(e){return super.isInstance(e)&&"generic"===e.type}get _printableFields(){return{...super._printableFields,role:this.role}}},nI=class extends nu{static lc_name(){return"ChatMessageChunk"}type="generic";role;constructor(e,t){("string"==typeof e||Array.isArray(e))&&(e={content:e,role:t}),super(e),this.role=e.role}concat(e){return new this.constructor({content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:ns(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&"generic"===e.type}get _printableFields(){return{...super._printableFields,role:this.role}}};function nO(e){return"generic"===e._getType()}function nA(e){return"generic"===e._getType()}var nk=class extends nn{static lc_name(){return"FunctionMessage"}type="function";name;constructor(e){super(e),this.name=e.name}},nx=class extends nu{static lc_name(){return"FunctionMessageChunk"}type="function";concat(e){return new this.constructor({content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:ns(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};function n$(e){return"function"===e._getType()}function nC(e){return"function"===e._getType()}var nN=class extends nn{static lc_name(){return"HumanMessage"}type="human";constructor(e){super(e)}static isInstance(e){return super.isInstance(e)&&"human"===e.type}},nP=class extends nu{static lc_name(){return"HumanMessageChunk"}type="human";constructor(e){super(e)}concat(e){return new this.constructor({content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:ns(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&"human"===e.type}};function nR(e){return"human"===e.getType()}function nj(e){return"human"===e.getType()}var nU=class extends nn{type="remove";id;constructor(e){super({...e,content:[]}),this.id=e.id}get _printableFields(){return{...super._printableFields,id:this.id}}static isInstance(e){return super.isInstance(e)&&"remove"===e.type}},nL=class e extends nn{static lc_name(){return"SystemMessage"}type="system";constructor(e){super(e)}concat(t){if("string"==typeof t)return new e({...this,content:nr(this.content,t)});if(e.isInstance(t))return new e({...this,additional_kwargs:{...this.additional_kwargs,...t.additional_kwargs},response_metadata:{...this.response_metadata,...t.response_metadata},content:nr(this.content,t.content)});throw Error("Unexpected chunk type for system message")}static isInstance(e){return super.isInstance(e)&&"system"===e.type}},nD=class extends nu{static lc_name(){return"SystemMessageChunk"}type="system";constructor(e){super(e)}concat(e){return new this.constructor({content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:ns(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&"system"===e.type}};function nM(e){return"system"===e._getType()}function nz(e){return"system"===e._getType()}function nF(e){switch(e){case"csv":return"text/csv";case"doc":case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"html":return"text/html";case"md":return"text/markdown";case"pdf":return"application/pdf";case"txt":return"text/plain";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"gif":return"image/gif";case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"flv":return"video/flv";case"mkv":return"video/mkv";case"mov":return"video/mov";case"mp4":return"video/mp4";case"mpeg":return"video/mpeg";case"mpg":return"video/mpg";case"three_gp":return"video/three_gp";case"webm":return"video/webm";case"wmv":return"video/wmv";default:return"application/octet-stream"}}function nB(e){return Array.from(function*(){for(let t of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content){if(iK(t,"cache_point")){yield{type:"non_standard",value:t};continue}if(iK(t,"citations_content")&&iJ(t.citationsContent)){let e=iV(t.citationsContent.content)?t.citationsContent.content.reduce((e,t)=>iJ(t)&&iY(t.text)?e+t.text:e,""):"",r=iV(t.citationsContent.citations)?t.citationsContent.citations.reduce((e,t)=>{if(iJ(t)){let r=iV(t.sourceContent)?t.sourceContent.reduce((e,t)=>iJ(t)&&iY(t.text)?e+t.text:e,""):"",i=i1(()=>{if(iJ(t.location)){let e=t.location.documentChar||t.location.documentPage||t.location.documentChunk;if(iJ(e))return{source:iX(e.documentIndex)?e.documentIndex.toString():void 0,startIndex:iX(e.start)?e.start:void 0,endIndex:iX(e.end)?e.end:void 0}}return{}});e.push({type:"citation",citedText:r,...i})}return e},[]):[];yield{type:"text",text:e,annotations:r};continue}if(iK(t,"document")&&iJ(t.document)){yield function(e){if(iJ(e.document)&&iJ(e.document.source)){let t=nF(iJ(e.document)&&iY(e.document.format)?e.document.format:"");if(iJ(e.document.source)){if(iJ(e.document.source.s3Location)&&iY(e.document.source.s3Location.uri))return{type:"file",mimeType:t,fileId:e.document.source.s3Location.uri};if(iQ(e.document.source.bytes))return{type:"file",mimeType:t,data:e.document.source.bytes};if(iY(e.document.source.text))return{type:"file",mimeType:t,data:Buffer.from(e.document.source.text).toString("base64")};if(iV(e.document.source.content))return{type:"file",mimeType:t,data:e.document.source.content.reduce((e,t)=>iJ(t)&&iY(t.text)?e+t.text:e,"")}}}return{type:"non_standard",value:e}}(t);continue}else if(iK(t,"guard_content")){yield{type:"non_standard",value:t};continue}else if(iK(t,"image")&&iJ(t.image)){yield function(e){if(iK(e,"image")&&iJ(e.image)){let t=nF(iJ(e.image)&&iY(e.image.format)?e.image.format:"");if(iJ(e.image.source)){if(iJ(e.image.source.s3Location)&&iY(e.image.source.s3Location.uri))return{type:"image",mimeType:t,fileId:e.image.source.s3Location.uri};if(iQ(e.image.source.bytes))return{type:"image",mimeType:t,data:e.image.source.bytes}}}return{type:"non_standard",value:e}}(t);continue}else if(iK(t,"reasoning_content")&&iY(t.reasoningText)){yield{type:"reasoning",reasoning:t.reasoningText};continue}else if(iK(t,"text")&&iY(t.text)){yield{type:"text",text:t.text};continue}else if(iK(t,"tool_result")){yield{type:"non_standard",value:t};continue}else if(iK(t,"tool_call"))continue;else if(iK(t,"video")&&iJ(t.video)){yield function(e){if(iK(e,"video")&&iJ(e.video)){let t=nF(iJ(e.video)&&iY(e.video.format)?e.video.format:"");if(iJ(e.video.source)){if(iJ(e.video.source.s3Location)&&iY(e.video.source.s3Location.uri))return{type:"video",mimeType:t,fileId:e.video.source.s3Location.uri};if(iQ(e.video.source.bytes))return{type:"video",mimeType:t,data:e.video.source.bytes}}}return{type:"non_standard",value:e}}(t);continue}yield{type:"non_standard",value:t}}}())}function nZ(e){return Array.from(function*(){for(let t of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content){if(iK(t,"text")&&iY(t.text)){yield{type:"text",text:t.text};continue}if(iK(t,"inlineData")&&iJ(t.inlineData)&&iY(t.inlineData.mimeType)&&iY(t.inlineData.data)){yield{type:"file",mimeType:t.inlineData.mimeType,data:t.inlineData.data};continue}if(iK(t,"functionCall")&&iJ(t.functionCall)&&iY(t.functionCall.name)&&iJ(t.functionCall.args)){yield{type:"tool_call",id:e.id,name:t.functionCall.name,args:t.functionCall.args};continue}else if(iK(t,"functionResponse")){yield{type:"non_standard",value:t};continue}else if(iK(t,"fileData")&&iJ(t.fileData)&&iY(t.fileData.mimeType)&&iY(t.fileData.fileUri)){yield{type:"file",mimeType:t.fileData.mimeType,fileId:t.fileData.fileUri};continue}else if(iK(t,"executableCode")){yield{type:"non_standard",value:t};continue}else if(iK(t,"codeExecutionResult")){yield{type:"non_standard",value:t};continue}yield{type:"non_standard",value:t}}}())}function nG(e){return Array.from(function*(){let t="string"==typeof e.content?[{type:"text",text:e.content}]:e.content;for(let r of t){if(iK(r,"reasoning")&&iY(r.reasoning)){let i=i1(()=>{let i=t.indexOf(r);if(iV(e.additional_kwargs?.signatures)&&i>=0)return e.additional_kwargs.signatures.at(i)});iY(i)?yield{type:"reasoning",reasoning:r.reasoning,signature:i}:yield{type:"reasoning",reasoning:r.reasoning};continue}if(iK(r,"text")&&iY(r.text)){yield{type:"text",text:r.text};continue}if(iK(r,"image_url")){if(iY(r.image_url))if(r.image_url.startsWith("data:")){let e=/^data:([^;]+);base64,(.+)$/,t=r.image_url.match(e);t?yield{type:"image",data:t[2],mimeType:t[1]}:yield{type:"image",url:r.image_url}}else yield{type:"image",url:r.image_url};continue}else if(iK(r,"media")&&iY(r.mimeType)&&iY(r.data)){yield{type:"file",mimeType:r.mimeType,data:r.data};continue}yield{type:"non_standard",value:r}}}())}function nH(e){return globalThis.lc_block_translators_registry.get(e)}function nq(e,t){return ns(e??{},t??{})}function nW(e,t){let r={};return(e?.audio!==void 0||t?.audio!==void 0)&&(r.audio=(e?.audio??0)+(t?.audio??0)),(e?.image!==void 0||t?.image!==void 0)&&(r.image=(e?.image??0)+(t?.image??0)),(e?.video!==void 0||t?.video!==void 0)&&(r.video=(e?.video??0)+(t?.video??0)),(e?.document!==void 0||t?.document!==void 0)&&(r.document=(e?.document??0)+(t?.document??0)),(e?.text!==void 0||t?.text!==void 0)&&(r.text=(e?.text??0)+(t?.text??0)),r}function nK(e,t){var r,i,n,a;let s,o;return{input_tokens:(e?.input_tokens??0)+(t?.input_tokens??0),output_tokens:(e?.output_tokens??0)+(t?.output_tokens??0),total_tokens:(e?.total_tokens??0)+(t?.total_tokens??0),input_token_details:(s={...nW(r=e?.input_token_details,i=t?.input_token_details)},(r?.cache_read!==void 0||i?.cache_read!==void 0)&&(s.cache_read=(r?.cache_read??0)+(i?.cache_read??0)),(r?.cache_creation!==void 0||i?.cache_creation!==void 0)&&(s.cache_creation=(r?.cache_creation??0)+(i?.cache_creation??0)),s),output_token_details:(o={...nW(n=e?.output_token_details,a=t?.output_token_details)},(n?.reasoning!==void 0||a?.reasoning!==void 0)&&(o.reasoning=(n?.reasoning??0)+(a?.reasoning??0)),o)}}globalThis.lc_block_translators_registry??=new Map([["anthropic",{translateContent:i6,translateContentChunk:i6}],["bedrock-converse",{translateContent:nB,translateContentChunk:nB}],["google-genai",{translateContent:nZ,translateContentChunk:nZ}],["google-vertexai",{translateContent:nG,translateContentChunk:nG}],["openai",{translateContent:e=>{if("string"==typeof e.content){let t=[];for(let r of("string"==typeof e.content?t.push({type:"text",text:e.content}):t.push(...i5(e.content)),e.tool_calls??[]))t.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return t}return i7(e)},translateContentChunk:e=>{if("string"==typeof e.content){let t=[];for(let r of("string"==typeof e.content?t.push({type:"text",text:e.content}):t.push(...i5(e.content)),e.tool_calls??[]))t.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return t}return Array.from(function*(){for(let t of(yield*i7(e),e.tool_call_chunks??[]))yield{type:"tool_call_chunk",id:t.id,name:t.name,args:t.args}}())}}]]);var nJ=class extends nn{type="ai";tool_calls=[];invalid_tool_calls=[];usage_metadata;get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e){let t;if("string"==typeof e||Array.isArray(e))t={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:{}};else{t=e;const r=t.additional_kwargs?.tool_calls,i=t.tool_calls;null!=r&&r.length>0&&(void 0===i||0===i.length)&&console.warn("New LangChain packages are available that more efficiently handle tool calling.\n\nPlease upgrade your packages to versions that set message tool calls. e.g., `pnpm install @langchain/anthropic`, pnpm install @langchain/openai`, etc.");try{if(null!=r&&void 0===i){const[e,i]=ng(r);t.tool_calls=e??[],t.invalid_tool_calls=i??[]}else t.tool_calls=t.tool_calls??[],t.invalid_tool_calls=t.invalid_tool_calls??[]}catch{t.tool_calls=[],t.invalid_tool_calls=[]}if(void 0!==t.response_metadata&&"output_version"in t.response_metadata&&"v1"===t.response_metadata.output_version&&(t.contentBlocks=t.content,t.content=void 0),void 0!==t.contentBlocks){t.contentBlocks.push(...t.tool_calls.map(e=>({type:"tool_call",id:e.id,name:e.name,args:e.args})));const e=t.contentBlocks.filter(e=>"tool_call"===e.type).filter(e=>!t.tool_calls?.some(t=>t.id===e.id&&t.name===e.name));e.length>0&&(t.tool_calls=e.map(e=>({type:"tool_call",id:e.id,name:e.name,args:e.args})))}}super(t),"string"!=typeof t&&(this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=t.usage_metadata}static lc_name(){return"AIMessage"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&"v1"===this.response_metadata.output_version)return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&"string"==typeof this.response_metadata.model_provider){let e=nH(this.response_metadata.model_provider);if(e)return e.translateContent(this)}let e=super.contentBlocks;if(this.tool_calls){let t=this.tool_calls.filter(t=>!e.some(e=>e.id===t.id&&e.name===t.name));e.push(...t.map(e=>({...e,type:"tool_call",id:e.id,name:e.name,args:e.args})))}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}static isInstance(e){return super.isInstance(e)&&"ai"===e.type}};function nV(e){return"ai"===e._getType()}function nY(e){return"ai"===e._getType()}var nX=class extends nu{type="ai";tool_calls=[];invalid_tool_calls=[];tool_call_chunks=[];usage_metadata;constructor(e){let t;super(t="string"==typeof e||Array.isArray(e)?{content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]}:void 0===e.tool_call_chunks||0===e.tool_call_chunks.length?{...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}:{...e,...n8(e.tool_call_chunks??[]),usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&"v1"===this.response_metadata.output_version)return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&"string"==typeof this.response_metadata.model_provider){let e=nH(this.response_metadata.model_provider);if(e)return e.translateContent(this)}let e=super.contentBlocks;if(this.tool_calls&&"string"!=typeof this.content){let t=this.content.filter(e=>"tool_call"===e.type).map(e=>e.id);for(let r of this.tool_calls)r.id&&!t.includes(r.id)&&e.push({...r,type:"tool_call",id:r.id,name:r.name,args:r.args})}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:nq(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){let r=no(this.tool_call_chunks,e.tool_call_chunks);void 0!==r&&r.length>0&&(t.tool_call_chunks=r)}return(void 0!==this.usage_metadata||void 0!==e.usage_metadata)&&(t.usage_metadata=nK(this.usage_metadata,e.usage_metadata)),new this.constructor(t)}static isInstance(e){return super.isInstance(e)&&"ai"===e.type}};let nQ=e=>e();function n0(e){return nb(e)?e:"string"==typeof e.id&&"function"===e.type&&"object"==typeof e.function&&null!==e.function&&"arguments"in e.function&&"string"==typeof e.function.arguments&&"name"in e.function&&"string"==typeof e.function.name?{id:e.id,args:JSON.parse(e.function.arguments),name:e.function.name,type:"tool_call"}:e}function n1(e){let t,r;if("object"==typeof e&&null!=e&&1===e.lc&&Array.isArray(e.id)&&null!=e.kwargs&&"object"==typeof e.kwargs){let i=e.id.at(-1);t="HumanMessage"===i||"HumanMessageChunk"===i?"user":"AIMessage"===i||"AIMessageChunk"===i?"assistant":"SystemMessage"===i||"SystemMessageChunk"===i?"system":"FunctionMessage"===i||"FunctionMessageChunk"===i?"function":"ToolMessage"===i||"ToolMessageChunk"===i?"tool":"unknown",r=e.kwargs}else{let{type:i,...n}=e;t=i,r=n}if("human"===t||"user"===t)return new nN(r);if("ai"===t||"assistant"===t){let{tool_calls:e,...t}=r;if(!Array.isArray(e))return new nJ(r);let i=e.map(n0);return new nJ({...t,tool_calls:i})}if("system"===t)return new nL(r);if("developer"===t)return new nL({...r,additional_kwargs:{...r.additional_kwargs,__openai_role__:"developer"}});if("tool"===t&&"tool_call_id"in r)return new nf({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});if("remove"===t&&"id"in r&&"string"==typeof r.id)return new nU({...r,id:r.id});throw nv(Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(e,null,2)}`),"MESSAGE_COERCION_FAILURE")}function n4(e){if("string"==typeof e)return new nN(e);if(nd(e))return e;if(Array.isArray(e)){let[t,r]=e;return n1({type:t,content:r})}if(!nc(e))return n1(e);{let{role:t,...r}=e;return n1({...r,type:t})}}function n2(e,t="Human",r="AI"){let i=[];for(let n of e){let e;if("human"===n._getType())e=t;else if("ai"===n._getType())e=r;else if("system"===n._getType())e="System";else if("tool"===n._getType())e="Tool";else if("generic"===n._getType())e=n.role;else throw Error(`Got unsupported message type: ${n._getType()}`);let a=n.name?`${n.name}, `:"",s="string"==typeof n.content?n.content:JSON.stringify(n.content,null,2);i.push(`${e}: ${a}${s}`)}return i.join("\n")}function n6(e){let t=void 0!==e.data?e:{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}};switch(t.type){case"human":return new nN(t.data);case"ai":return new nJ(t.data);case"system":return new nL(t.data);case"function":if(void 0===t.data.name)throw Error("Name must be defined for function messages");return new nk(t.data);case"tool":if(void 0===t.data.tool_call_id)throw Error("Tool call ID must be defined for tool messages");return new nf(t.data);case"generic":if(void 0===t.data.role)throw Error("Role must be defined for chat messages");return new nS(t.data);default:throw Error(`Got unexpected type: ${t.type}`)}}function n9(e){return e.map(n6)}function n3(e){return e.map(e=>e.toDict())}function n5(e){let t=e._getType();if("human"===t)return new nP({...e});if("ai"===t){let t={...e};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),new nX({...t})}if("system"===t)return new nD({...e});if("function"===t)return new nx({...e});if(nS.isInstance(e))return new nI({...e});else throw Error("Unknown message type.")}function n8(e){let t=e.reduce((e,t)=>{let r=e.findIndex(([e])=>"id"in t&&t.id&&"index"in t&&void 0!==t.index?t.id===e.id&&t.index===e.index:"id"in t&&t.id?t.id===e.id:"index"in t&&void 0!==t.index&&t.index===e.index);return -1!==r?e[r].push(t):e.push([t]),e},[]),r=[],i=[];for(let e of t){let t=null,n=e[0]?.name??"",a=e.map(e=>e.args||"").join("").trim(),s=a.length?a:"{}",o=e[0]?.id;try{if(t=nT(s),!o||null===t||"object"!=typeof t||Array.isArray(t))throw Error("Malformed tool call chunk args.");r.push({name:n,args:t,id:o,type:"tool_call"})}catch{i.push({name:n,args:s,id:o,error:"Malformed args.",type:"invalid_tool_call"})}}return{tool_call_chunks:e,tool_calls:r,invalid_tool_calls:i}}var n7=e.i(666680);let ae={randomUUID:n7.default.randomUUID},at=new Uint8Array(256),ar=at.length,ai=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,an=function(e){return"string"==typeof e&&ai.test(e)},aa=[];for(let e=0;e<256;++e)aa.push((e+256).toString(16).slice(1));function as(e,t=0){return(aa[e[t+0]]+aa[e[t+1]]+aa[e[t+2]]+aa[e[t+3]]+"-"+aa[e[t+4]]+aa[e[t+5]]+"-"+aa[e[t+6]]+aa[e[t+7]]+"-"+aa[e[t+8]]+aa[e[t+9]]+"-"+aa[e[t+10]]+aa[e[t+11]]+aa[e[t+12]]+aa[e[t+13]]+aa[e[t+14]]+aa[e[t+15]]).toLowerCase()}let ao=function(e,t,r){if(ae.randomUUID&&!t&&!e)return ae.randomUUID();let i=(e=e||{}).random||(e.rng||function(){return ar>at.length-16&&(n7.default.randomFillSync(at),ar=0),at.slice(ar,ar+=16)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=i[e];return t}return as(i)};iI({},{BaseCallbackHandler:()=>ac,callbackHandlerPrefersStreaming:()=>au,isBaseCallbackHandler:()=>ad});var al=class{};function au(e){return"lc_prefer_streaming"in e&&e.lc_prefer_streaming}var ac=class extends al{lc_serializable=!1;get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,iq(this.constructor)]}lc_kwargs;ignoreLLM=!1;ignoreChain=!1;ignoreAgent=!1;ignoreRetriever=!1;ignoreCustomEvent=!1;raiseError=!1;awaitHandlers="false"===iP("LANGCHAIN_CALLBACKS_BACKGROUND");constructor(e){super(),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return iW.prototype.toJSON.call(this)}toJSONNotImplemented(){return iW.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends ac{name=ao();constructor(){super(),Object.assign(this,e)}}return new t}};let ad=e=>void 0!==e&&"function"==typeof e.copy&&"string"==typeof e.name&&"boolean"==typeof e.awaitHandlers,ah=function(e){let t;if(!an(e))throw TypeError("Invalid UUID");let r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/0x10000000000&255,r[11]=t/0x100000000&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r},ap=function(e,t,r){function i(e,t,i,n){var a;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof t&&(t=ah(t)),(null==(a=t)?void 0:a.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let s=new Uint8Array(16+e.length);if(s.set(t),s.set(e,t.length),(s=r(s))[6]=15&s[6]|80,s[8]=63&s[8]|128,i){n=n||0;for(let e=0;e<16;++e)i[n+e]=s[e];return i}return as(s)}try{i.name="v5"}catch(e){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i}(0,0,function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),n7.default.createHash("sha1").update(e).digest()}),af="gen_ai.request.model",am="gen_ai.usage.input_tokens",ag="gen_ai.usage.output_tokens",ay="gen_ai.usage.total_tokens",a_="langsmith.span.tags";e.s(["__version__",()=>aw],222201);let av=Symbol.for("ls:fetch_implementation"),ab=()=>aI("PROJECT")??aS("LANGCHAIN_SESSION")??"default",aw="0.3.72",aE=()=>r||(r="undefined"!=typeof Bun?"bun":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||"undefined"!=typeof Deno?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom")?"jsdom":"undefined"!=typeof Deno?"deno":"other":"node");function aT(){return void 0===i&&(i={library:"langsmith",runtime:aE(),sdk:"langsmith-js",sdk_version:aw,...function(){if(void 0!==n)return n;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=aS(t);void 0!==r&&(e[t]=r)}return n=e,e}()}),i}function aS(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}function aI(e){return aS(`LANGSMITH_${e}`)||aS(`LANGCHAIN_${e}`)}function aO(){return"true"===aS("OTEL_ENABLED")||"true"===aI("OTEL_ENABLED")}class aA{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){let r;if(!this.hasWarned&&aO()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0),1===t.length&&"function"==typeof t[0]?r=t[0]:2===t.length&&"function"==typeof t[1]?r=t[1]:3===t.length&&"function"==typeof t[2]&&(r=t[2]),"function"==typeof r)return r()}}let ak=Symbol.for("ls:otel_trace"),ax=Symbol.for("ls:otel_context"),a$=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),aC=new class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new aA})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},aN=new class{active(){return{}}with(e,t){return t()}},aP=new class{getTraceInstance(){return globalThis[ak]??aC}getContextInstance(){return globalThis[ax]??aN}initializeGlobalInstances(e){void 0===globalThis[ak]&&(globalThis[ak]=e.trace),void 0===globalThis[ax]&&(globalThis[ax]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[a$]=e}getDefaultOTLPTracerComponents(){return globalThis[a$]??void 0}};function aR(){return aP.getTraceInstance()}let aj={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};class aU{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let r of e)try{if(!r.run)continue;if("post"===r.operation){let e=this.createSpanForRun(r,r.run,t.get(r.id));e&&!r.run.end_time&&this.spans.set(r.id,e)}else this.updateSpanForRun(r,r.run)}catch(e){console.error(`Error processing operation ${r.id}:`,e)}}createSpanForRun(e,t,r){let i=r&&aR().getSpan(r);if(i)try{return this.finishSpanSetup(i,t,e)}catch(t){console.error(`Failed to create span for run ${e.id}:`,t);return}}finishSpanSetup(e,t,r){return this.setSpanAttributes(e,t,r),t.error?(e.setStatus({code:2}),e.recordException(Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let r=this.spans.get(e.id);if(!r)return void console.debug(`No span found for run ${e.id} during update`);this.setSpanAttributes(r,t,e),t.error?(r.setStatus({code:2}),r.recordException(Error(t.error))):r.setStatus({code:1});let i=t.end_time;i&&(r.end(new Date(i)),this.spans.delete(e.id))}catch(t){console.error(`Failed to update span for run ${e.id}:`,t)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let e=t.invocation_params;if(e.model)return e.model;if(e.model_name)return e.model_name}}}setSpanAttributes(e,t,r){if("run_type"in t&&t.run_type){var i;e.setAttribute("langsmith.span.kind",t.run_type);let r=aj[i=t.run_type||"chain"]||i;e.setAttribute("gen_ai.operation.name",r)}"name"in t&&t.name&&e.setAttribute("langsmith.trace.name",t.name),"session_id"in t&&t.session_id&&e.setAttribute("langsmith.trace.session_id",t.session_id),"session_name"in t&&t.session_name&&e.setAttribute("langsmith.trace.session_name",t.session_name),this.setGenAiSystem(e,t);let n=this.extractModelName(t);for(let[r,i]of(n&&e.setAttribute(af,n),"prompt_tokens"in t&&"number"==typeof t.prompt_tokens&&e.setAttribute(am,t.prompt_tokens),"completion_tokens"in t&&"number"==typeof t.completion_tokens&&e.setAttribute(ag,t.completion_tokens),"total_tokens"in t&&"number"==typeof t.total_tokens&&e.setAttribute(ay,t.total_tokens),this.setInvocationParameters(e,t),Object.entries(t.extra?.metadata||{})))null!=i&&e.setAttribute(`langsmith.metadata.${r}`,String(i));let a=t.tags;if(a&&Array.isArray(a)?e.setAttribute(a_,a.join(", ")):a&&e.setAttribute(a_,String(a)),"serialized"in t&&"object"==typeof t.serialized){let r=t.serialized;r.name&&e.setAttribute("gen_ai.serialized.name",String(r.name)),r.signature&&e.setAttribute("gen_ai.serialized.signature",String(r.signature)),r.doc&&e.setAttribute("gen_ai.serialized.doc",String(r.doc))}this.setIOAttributes(e,r)}setGenAiSystem(e,t){let r="langchain",i=this.extractModelName(t);if(i){let e=i.toLowerCase();e.includes("anthropic")||e.startsWith("claude")?r="anthropic":e.includes("bedrock")?r="aws.bedrock":e.includes("azure")&&e.includes("openai")?r="az.ai.openai":e.includes("azure")&&e.includes("inference")?r="az.ai.inference":e.includes("cohere")?r="cohere":e.includes("deepseek")?r="deepseek":e.includes("gemini")?r="gemini":e.includes("groq")?r="groq":e.includes("watson")||e.includes("ibm")?r="ibm.watsonx.ai":e.includes("mistral")?r="mistral_ai":e.includes("gpt")||e.includes("openai")?r="openai":e.includes("perplexity")||e.includes("sonar")?r="perplexity":e.includes("vertex")?r="vertex_ai":(e.includes("xai")||e.includes("grok"))&&(r="xai")}e.setAttribute("gen_ai.system",r)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let r=t.extra.metadata.invocation_params;void 0!==r.max_tokens&&e.setAttribute("gen_ai.request.max_tokens",r.max_tokens),void 0!==r.temperature&&e.setAttribute("gen_ai.request.temperature",r.temperature),void 0!==r.top_p&&e.setAttribute("gen_ai.request.top_p",r.top_p),void 0!==r.frequency_penalty&&e.setAttribute("gen_ai.request.frequency_penalty",r.frequency_penalty),void 0!==r.presence_penalty&&e.setAttribute("gen_ai.request.presence_penalty",r.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let r=t.run.inputs;"object"==typeof r&&null!==r&&(r.model&&Array.isArray(r.messages)&&e.setAttribute(af,r.model),void 0!==r.stream&&e.setAttribute("langsmith.request.streaming",r.stream),r.extra_headers&&e.setAttribute("langsmith.request.headers",JSON.stringify(r.extra_headers)),r.extra_query&&e.setAttribute("gen_ai.request.extra_query",JSON.stringify(r.extra_query)),r.extra_body&&e.setAttribute("gen_ai.request.extra_body",JSON.stringify(r.extra_body))),e.setAttribute("gen_ai.prompt",JSON.stringify(r))}catch(e){console.debug(`Failed to process inputs for run ${t.id}`,e)}if(t.run.outputs)try{let r=t.run.outputs,i=this.getUnifiedRunTokens(r);if(i&&(e.setAttribute(am,i[0]),e.setAttribute(ag,i[1]),e.setAttribute(ay,i[0]+i[1])),r&&"object"==typeof r){if(r.model&&e.setAttribute("gen_ai.response.model",String(r.model)),r.id&&e.setAttribute("gen_ai.response.id",r.id),r.choices&&Array.isArray(r.choices)){let t=r.choices.map(e=>e.finish_reason).filter(e=>e).map(String);t.length>0&&e.setAttribute("gen_ai.response.finish_reasons",t.join(", "))}if(r.service_tier&&e.setAttribute("gen_ai.response.service_tier",r.service_tier),r.system_fingerprint&&e.setAttribute("gen_ai.response.system_fingerprint",r.system_fingerprint),r.usage_metadata&&"object"==typeof r.usage_metadata){let t=r.usage_metadata;t.input_token_details&&e.setAttribute("gen_ai.usage.input_token_details",JSON.stringify(t.input_token_details)),t.output_token_details&&e.setAttribute("gen_ai.usage.output_token_details",JSON.stringify(t.output_token_details))}}e.setAttribute("gen_ai.completion",JSON.stringify(r))}catch(e){console.debug(`Failed to process outputs for run ${t.id}`,e)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;for(let r of Object.keys(e)){let i=e[r];if(i&&"object"==typeof i&&((t=this.extractUnifiedRunTokens(i.usage_metadata))||1===i.lc&&i.kwargs&&"object"==typeof i.kwargs&&(t=this.extractUnifiedRunTokens(i.kwargs.usage_metadata))))return t}let r=e.generations||[];if(!Array.isArray(r))return null;for(let e of Array.isArray(r[0])?r.flat():r)if("object"==typeof e&&e.message&&"object"==typeof e.message&&e.message.kwargs&&"object"==typeof e.message.kwargs&&(t=this.extractUnifiedRunTokens(e.message.kwargs.usage_metadata)))return t;return null}extractUnifiedRunTokens(e){return e&&"object"==typeof e&&"number"==typeof e.input_tokens&&"number"==typeof e.output_tokens?[e.input_tokens,e.output_tokens]:null}}var aL=e.i(990242),aD=e.i(559176);let aM=[429,500,502,503,504];class az{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in aD.default?this.queue=new aD.default.default({concurrency:this.maxConcurrency}):this.queue=new aD.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>(0,aL.default)(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response;if(r&&await r(t))return;let i=t?.status??e?.status;if(i&&!aM.includes(+i))throw e},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}}function aF(e){return"function"==typeof e?._getType}function aB(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}let aZ=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function aG(e,t){if(!aZ.test(e))throw Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`);return e}let aH={};function aq(e){aH[e]||(console.warn(e),aH[e]=!0)}function aW(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw Error(`Invalid identifier format: ${e}`);let[t,r]=e.split(":"),i=r||"latest";if(t.includes("/")){let[r,n]=t.split("/",2);if(!r||!n)throw Error(`Invalid identifier format: ${e}`);return[r,n,i]}if(!t)throw Error(`Invalid identifier format: ${e}`);return["-",t,i]}e.i(969551);class aK extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function aJ(e,t,r){let i;if(e.ok){r&&(i=await e.text());return}if(403===e.status)try{let t=await e.json(),r=t?.error;"org_scoped_key_requires_workspace"===r&&(i="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch(r){let t=Error(`${e.status} ${e.statusText}`);throw t.status=e?.status,t}if(void 0===i)try{i=await e.text()}catch(e){i=""}let n=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Message: ${i}`;if(409===e.status)throw new aK(n);let a=Error(n);throw a.status=e.status,a}let aV="ERR_CONFLICTING_ENDPOINTS";class aY extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:aV}),this.name="ConflictingEndpointsError"}}var aX={result:"[Circular]"},aQ=[],a0=[];let a1=new TextEncoder;function a4(e){return a1.encode(e)}function a2(e){if(e&&"object"==typeof e&&null!==e){if(e instanceof Map)return Object.fromEntries(e);else if(e instanceof Set)return Array.from(e);else if(e instanceof Date)return e.toISOString();else if(e instanceof RegExp)return e.toString();else if(e instanceof Error)return{name:e.name,message:e.message}}else if("bigint"==typeof e)return e.toString();return e}function a6(e,t,r,i,n){try{let t=JSON.stringify(e,function(e,t){if(r){let i=r.call(this,e,t);if(void 0!==i)return i}return a2(t)},i);return a4(t)}catch(o){let s;if(!o.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${t?`
Context: ${t}`:""}`),a4("[Unserializable]");"true"!==aI("SUPPRESS_CIRCULAR_JSON_WARNINGS")&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${t?`
Context: ${t}`:""}`),void 0===n&&(n={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function e(t,r,i,n,a,s,o){if(s+=1,"object"==typeof t&&null!==t){for(l=0;l<n.length;l++)if(n[l]===t)return void a9(aX,t,r,a);if(void 0!==o.depthLimit&&s>o.depthLimit||void 0!==o.edgesLimit&&i+1>o.edgesLimit)return void a9("[...]",t,r,a);if(n.push(t),Array.isArray(t))for(l=0;l<t.length;l++)e(t[l],l,l,n,t,s,o);else{var l,u=Object.keys(t=a2(t));for(l=0;l<u.length;l++){var c=u[l];e(t[c],c,l,n,t,s,o)}}n.pop()}}(e,"",0,[],void 0,0,n);try{var a;s=0===a0.length?JSON.stringify(e,r,i):JSON.stringify(e,(a=r,a=void 0!==a?a:function(e,t){return t},function(e,t){if(a0.length>0)for(var r=0;r<a0.length;r++){var i=a0[r];if(i[1]===e&&i[0]===t){t=i[2],a0.splice(r,1);break}}return a.call(this,e,t)}),i)}catch(e){return a4("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==aQ.length;){let e=aQ.pop();4===e.length?Object.defineProperty(e[0],e[1],e[3]):e[0][e[1]]=e[2]}}return a4(s)}}function a9(e,t,r,i){var n=Object.getOwnPropertyDescriptor(i,r);void 0!==n.get?n.configurable?(Object.defineProperty(i,r,{value:e}),aQ.push([i,r,t,n])):a0.push([t,r,e]):(i[r]=e,aQ.push([i,r,t]))}function a3(e){let t=aT(),r=function(){let e=function(){try{if("undefined"!=typeof process&&process.env)return Object.entries(process.env).reduce((e,[t,r])=>(e[t]=String(r),e),{});return}catch(e){return}}()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[i,n]of Object.entries(e))(i.startsWith("LANGCHAIN_")||i.startsWith("LANGSMITH_"))&&"string"==typeof n&&!r.includes(i)&&!i.toLowerCase().includes("key")&&!i.toLowerCase().includes("secret")&&!i.toLowerCase().includes("token")&&("LANGCHAIN_REVISION_ID"===i?t.revision_id=n:t[i]=n);return t}(),i=e.extra??{},n=i.metadata;return e.extra={...i,runtime:{...t,...i?.runtime},metadata:{...r,...r.revision_id||"revision_id"in e&&e.revision_id?{revision_id:("revision_id"in e?e.revision_id:void 0)??r.revision_id}:{},...n}},e}async function a5(e){let t=[];for await(let r of e)t.push(r);return t}function a8(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}let a7=async e=>{if(e?.status===429){let t=1e3*parseInt(e.headers.get("retry-after")??"10",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};function se(e){return"number"==typeof e?Number(e.toFixed(4)):e}class st{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,r=new Promise(e=>{t=e}),i=a6(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:r,size:i}),this.sizeBytes+=i,r}pop({upToSizeBytes:e,upToSize:t}){if(e<1)throw Error("Number of bytes to pop off may not be less than 1.");let r=[],i=0;for(;i+(this.peek()?.size??0)<e&&this.items.length>0&&r.length<t;){let e=this.items.shift();e&&(r.push(e),i+=e.size,this.sizeBytes-=e.size)}if(0===r.length&&this.items.length>0){let e=this.items.shift();r.push(e),i+=e.size,this.sizeBytes-=e.size}return[r.map(e=>({action:e.action,item:e.payload,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl})),()=>r.forEach(e=>e.itemPromiseResolve())]}}let sr="https://api.smith.langchain.com";class si{get _fetch(){let e;return this.fetchImplementation||(e=this.debug,async(...t)=>{if(e||"true"===aI("DEBUG")){let[e,r]=t;console.log(` ${r?.method||"GET"} ${e}`)}let r=await (globalThis[av]??((...e)=>fetch(...e)))(...t);return(e||"true"===aI("DEBUG"))&&console.log(` ${r.status} ${r.statusText} ${r.url}`),r})}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new st}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===aS("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:"true"===aS("LANGSMITH_DEBUG")});const t=si.getDefaultClientConfig();if(this.tracingSampleRate=(e=>{let t=e?.toString()??aI("TRACING_SAMPLING_RATE");if(void 0===t)return;let r=parseFloat(t);if(r<0||r>1)throw Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${r}`);return r})(e.tracingSamplingRate),this.apiUrl=a8(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=a8(e.apiKey??t.apiKey),this.webUrl=a8(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=a8(e.workspaceId??aI("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new az({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation,this.batchIngestCaller=new az({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:a7,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,aO()&&(this.langSmithToOTELTranslator=new aU)}static getDefaultClientConfig(){let e=aI("API_KEY");return{apiUrl:aI("ENDPOINT")??sr,apiKey:e,webUrl:void 0,hideInputs:"true"===aI("HIDE_INPUTS"),hideOutputs:"true"===aI("HIDE_OUTPUTS")}}getHostUrl(){let e;if(this.webUrl)return this.webUrl;if("localhost"===(e=this.apiUrl.replace("http://","").replace("https://","").split("/")[0].split(":")[0])||"127.0.0.1"===e||"::1"===e)return this.webUrl="http://localhost:3000",this.webUrl;if(this.apiUrl.endsWith("/api/v1"))return this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl;if(this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api"))return this.webUrl=this.apiUrl.replace("/api",""),this.webUrl;if(this.apiUrl.split(".",1)[0].includes("dev"))return this.webUrl="https://dev.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("eu"))return this.webUrl="https://eu.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("beta"))return this.webUrl="https://beta.smith.langchain.com",this.webUrl;else return this.webUrl="https://smith.langchain.com",this.webUrl}get headers(){let e={"User-Agent":`langsmith-js/${aw}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return"/v1"!==this.apiUrl.slice(-3)&&"/v1/"!==this.apiUrl.slice(-4)?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}async processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=await this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",i=`${this.apiUrl}${e}?${r}`;return await this.caller.call(async()=>{let t=await this._fetch(i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,`fetch ${e}`),t})}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams,r){let i=Number(t.get("offset"))||0,n=Number(t.get("limit"))||100;for(;;){t.set("offset",String(i)),t.set("limit",String(n));let a=`${this.apiUrl}${e}?${t}`,s=await this.caller.call(async()=>{let t=await this._fetch(a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,`fetch ${e}`),t}),o=r?r(await s.json()):await s.json();if(0===o.length||(yield o,o.length<n))break;i+=o.length}}async *_getCursorPaginatedList(e,t=null,r="POST",i="runs"){let n=t?{...t}:{};for(;;){let t=JSON.stringify(n),a=await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:t});return await aJ(i,`fetch ${e}`),i}),s=await a.json();if(!s||!s[i])break;yield s[i];let o=s.cursors;if(!o||!o.next)break;n.cursor=o.next}}_shouldSample(){return void 0===this.tracingSampleRate||Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let r of e)this.filteredPostUuids.has(r.trace_id)?r.id===r.trace_id&&this.filteredPostUuids.delete(r.trace_id):t.push(r);return t}{let t=[];for(let r of e){let e=r.trace_id??r.id;this.filteredPostUuids.has(e)||(r.id===e?this._shouldSample()?t.push(r):this.filteredPostUuids.add(e):t.push(r))}return t}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??0x1800000}async _getBatchSizeLimit(){let e=await this._ensureServerInfo();return this.batchSizeLimit??e.batch_ingest_config?.size_limit??100}async _getDatasetExamplesMultiPartSupport(){let e=await this._ensureServerInfo();return e.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t}){let r=[];for(;this.autoBatchQueue.items.length>0;){let[i,n]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:t});if(!i.length){n();break}let a=i.reduce((e,t)=>{let r=t.apiUrl??this.apiUrl,i=t.apiKey??this.apiKey,n=t.apiKey===this.apiKey&&t.apiUrl===this.apiUrl?"default":`${r}|${i}`;return e[n]||(e[n]=[]),e[n].push(t),e},{}),s=[];for(let[e,t]of Object.entries(a)){let r=this._processBatch(t,{apiUrl:"default"===e?void 0:e.split("|")[0],apiKey:"default"===e?void 0:e.split("|")[1]});s.push(r)}let o=Promise.all(s).finally(n);r.push(o)}return Promise.all(r)}async _processBatch(e,t){if(e.length)try{if(void 0!==this.langSmithToOTELTranslator)this._sendBatchToOTELTranslator(e);else{let r={runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)},i=await this._ensureServerInfo();if(i?.batch_ingest_config?.use_multipart_endpoint){let e=i?.instance_flags?.gzip_body_enabled;await this.multipartIngestRuns(r,{...t,useGzip:e})}else await this.batchIngestRuns(r,t)}}catch(e){console.error("Error exporting batch:",e)}}_sendBatchToOTELTranslator(e){if(void 0!==this.langSmithToOTELTranslator){let t=new Map,r=[];for(let i of e)i.item.id&&i.otelContext&&(t.set(i.item.id,i.otelContext),"create"===i.action?r.push({operation:"post",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}):r.push({operation:"patch",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}));this.langSmithToOTELTranslator.exportBatch(r,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=a3(e.item);let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let r=await this._getBatchSizeLimitBytes(),i=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>r||this.autoBatchQueue.items.length>i)&&this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:i}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:i})},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){let e=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4),...this.fetchOptions});return await aJ(e,"get server info"),e}),t=await e.json();return this.debug&&console.log("\n=== LangSmith Server Configuration ===\n"+JSON.stringify(t,null,2)+"\n"),t}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes(),t=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t})}_cloneCurrentOTELContext(){let e=aR(),t=aP.getContextInstance();if(void 0!==this.langSmithToOTELTranslator){let r=e.getActiveSpan();if(r)return e.setSpan(t.active(),r)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;let r={...this.headers,"Content-Type":"application/json"},i=e.project_name;delete e.project_name;let n=await this.prepareRunCreateOrUpdateInputs({session_name:i,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==n.trace_id&&void 0!==n.dotted_order){let e=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:n,otelContext:e,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let a=a3(n);t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey),t?.workspaceId!==void 0&&(r["x-tenant-id"]=t.workspaceId);let s=a6(a,`Creating run with id: ${a.id}`);await this.caller.call(async()=>{let e=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await aJ(e,"create run",!0),e})}async batchIngestRuns({runCreates:e,runUpdates:t},r){if(void 0===e&&void 0===t)return;let i=await Promise.all(e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]),n=await Promise.all(t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]);if(i.length>0&&n.length>0){let e=i.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of n)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);i=Object.values(e),n=t}let a={post:i,patch:n};if(!a.post.length&&!a.patch.length)return;let s={post:[],patch:[]};for(let e of["post","patch"]){let t=a[e].reverse(),r=t.pop();for(;void 0!==r;)s[e].push(r),r=t.pop()}if(s.post.length>0||s.patch.length>0){let e=s.post.map(e=>e.id).concat(s.patch.map(e=>e.id)).join(",");await this._postBatchIngestRuns(a6(s,`Ingesting runs with ids: ${e}`),r)}}async _postBatchIngestRuns(e,t){let r={...this.headers,"Content-Type":"application/json",Accept:"application/json"};t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey),await this.batchIngestCaller.call(async()=>{let i=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await aJ(i,"batch create run",!0),i})}async multipartIngestRuns({runCreates:e,runUpdates:t},r){if(void 0===e&&void 0===t)return;let i={},n=[];for(let t of e??[]){let e=await this.prepareRunCreateOrUpdateInputs(t);void 0!==e.id&&void 0!==e.attachments&&(i[e.id]=e.attachments),delete e.attachments,n.push(e)}let a=[];for(let e of t??[])a.push(await this.prepareRunCreateOrUpdateInputs(e));if(void 0!==n.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==a.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(n.length>0&&a.length>0){let e=n.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of a)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);n=Object.values(e),a=t}if(0===n.length&&0===a.length)return;let s=[],o=[];for(let[e,t]of[["post",n],["patch",a]])for(let r of t){let{inputs:t,outputs:n,events:a,extra:l,error:u,serialized:c,attachments:d,...h}=r,p={inputs:t,outputs:n,events:a,extra:l,error:u,serialized:c},f=a6(h,`Serializing for multipart ingestion of run with id: ${h.id}`);for(let[t,r]of(o.push({name:`${e}.${h.id}`,payload:new Blob([f],{type:`application/json; length=${f.length}`})}),Object.entries(p))){if(void 0===r)continue;let i=a6(r,`Serializing ${t} for multipart ingestion of run with id: ${h.id}`);o.push({name:`${e}.${h.id}.${t}`,payload:new Blob([i],{type:`application/json; length=${i.length}`})})}if(void 0!==h.id){let e=i[h.id];if(e)for(let[t,r]of(delete i[h.id],Object.entries(e))){let e,i;if(Array.isArray(r)?[e,i]=r:(e=r.mimeType,i=r.data),t.includes(".")){console.warn(`Skipping attachment '${t}' for run ${h.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}o.push({name:`attachment.${h.id}.${t}`,payload:new Blob([i],{type:`${e}; length=${i.byteLength}`})})}}s.push(`trace=${h.trace_id},id=${h.id}`)}await this._sendMultipartRequest(o,s.join("; "),r)}async _createNodeFetchBody(e,t){let r=[];for(let i of e)r.push(new Blob([`--${t}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${i.name}"\r
`,`Content-Type: ${i.payload.type}\r
\r
`])),r.push(i.payload),r.push(new Blob(["\r\n"]));r.push(new Blob([`--${t}--\r
`]));let i=new Blob(r);return await i.arrayBuffer()}async _createMultipartStream(e,t){let r=new TextEncoder;return new ReadableStream({async start(i){let n=async e=>{"string"==typeof e?i.enqueue(r.encode(e)):i.enqueue(e)};for(let r of e){await n(`--${t}\r
`),await n(`Content-Disposition: form-data; name="${r.name}"\r
`),await n(`Content-Type: ${r.payload.type}\r
\r
`);let e=r.payload.stream().getReader();try{let t;for(;!(t=await e.read()).done;)i.enqueue(t.value)}finally{e.releaseLock()}await n("\r\n")}await n(`--${t}--\r
`),i.close()}})}async _sendMultipartRequest(e,t,r){let i,n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=!!(i=globalThis[av])&&"function"==typeof i&&"Headers"in i&&"Request"in i&&"Response"in i,s=()=>this._createNodeFetchBody(e,n),o=()=>this._createMultipartStream(e,n),l=async e=>this.batchIngestCaller.call(async()=>{let t=await e(),i={...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`};r?.apiKey!==void 0&&(i["x-api-key"]=r.apiKey);let a=t;r?.useGzip&&"object"==typeof t&&"pipeThrough"in t&&(a=t.pipeThrough(new CompressionStream("gzip")),i["Content-Encoding"]="gzip");let s=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:i,body:a,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(s,"Failed to send multipart request",!0),s});try{let e,i=!1;a||this.multipartStreamingDisabled||"bun"===aE()?e=await l(s):(i=!0,e=await l(o)),(!this.multipartStreamingDisabled||i)&&422===e.status&&(r?.apiUrl??this.apiUrl)!==sr&&(console.warn(`Streaming multipart upload to ${r?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,e=await l(s))}catch(e){console.warn(`${e.message.trim()}

Context: ${t}`)}}async updateRun(e,t,r){aG(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));let i={...t,id:e};if(!this._filterForSampling([i],!0).length)return;if(this.autoBatchTracing&&void 0!==i.trace_id&&void 0!==i.dotted_order){let e=this._cloneCurrentOTELContext();return void 0!==t.end_time&&void 0===i.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?void await this.processRunOperation({action:"update",item:i,otelContext:e,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error):void this.processRunOperation({action:"update",item:i,otelContext:e,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error)}let n={...this.headers,"Content-Type":"application/json"};r?.apiKey!==void 0&&(n["x-api-key"]=r.apiKey),r?.workspaceId!==void 0&&(n["x-tenant-id"]=r.workspaceId);let a=a6(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{let t=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await aJ(t,"update run",!0),t})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){aG(e);let r=await this._get(`/runs/${e}`);return t&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:aI("PROJECT")||"default"})).id;let i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await a5(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},i={};for(let n of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===n.parent_run_id||void 0===n.parent_run_id)throw Error(`Child run ${n.id} has no parent`);n.dotted_order?.startsWith(e.dotted_order??"")&&n.id!==e.id&&(n.parent_run_id in r||(r[n.parent_run_id]=[]),r[n.parent_run_id].push(n),i[n.id]=n)}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(i[t].child_runs=r[t]);return e}async *listRuns(e){let{projectId:t,projectName:r,parentRunId:i,traceId:n,referenceExampleId:a,startTime:s,executionOrder:o,isRoot:l,runType:u,error:c,id:d,query:h,filter:p,traceFilter:f,treeFilter:m,limit:g,select:y,order:_}=e,v=[];if(t&&(v=Array.isArray(t)?t:[t]),r){let e=Array.isArray(r)?r:[r],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));v.push(...t)}let b={session:v.length?v:null,run_type:u,reference_example:a,query:h,filter:p,trace_filter:f,tree_filter:m,execution_order:o,parent_run:i,start_time:s?s.toISOString():null,error:c,id:d,limit:g,trace:n,select:y||["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l,order:_},w=0;for await(let e of this._getCursorPaginatedList("/runs/query",b))if(g){if(w>=g)break;if(e.length+w>g){let t=e.slice(0,g-w);yield*t;break}w+=e.length,yield*e}else yield*e}async *listGroupRuns(e){let{projectId:t,projectName:r,groupBy:i,filter:n,startTime:a,endTime:s,limit:o,offset:l}=e,u={session_id:t||(await this.readProject({projectName:r})).id,group_by:i,filter:n,start_time:a?a.toISOString():null,end_time:s?s.toISOString():null,limit:Number(o)||100},c=Number(l)||0,d="/runs/group",h=`${this.apiUrl}${d}`;for(;;){let e=JSON.stringify(Object.fromEntries(Object.entries({...u,offset:c}).filter(([e,t])=>void 0!==t))),t=await this.caller.call(async()=>{let t=await this._fetch(h,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await aJ(t,`Failed to fetch ${d}`),t}),{groups:r,total:i}=await t.json();if(0===r.length)break;for(let e of r)yield e;if((c+=r.length)>=i)break}}async getRunStats({id:e,trace:t,parentRun:r,runType:i,projectNames:n,projectIds:a,referenceExampleIds:s,startTime:o,endTime:l,error:u,query:c,filter:d,traceFilter:h,treeFilter:p,isRoot:f,dataSourceType:m}){let g=a||[];n&&(g=[...a||[],...await Promise.all(n.map(e=>this.readProject({projectName:e}).then(e=>e.id)))]);let y=JSON.stringify(Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:i,session:g,reference_example:s,start_time:o,end_time:l,error:u,query:c,filter:d,trace_filter:h,tree_filter:p,is_root:f,data_source_type:m}).filter(([e,t])=>void 0!==t))),_=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await aJ(e,"get run stats"),e});return await _.json()}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||ao()};aG(e);let i=JSON.stringify(r),n=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await aJ(t,"share run"),t}),a=await n.json();if(null===a||!("share_token"in a))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){aG(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,"unshare run",!0),t})}async readRunSharedLink(e){aG(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,"read run shared link"),t}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);aG(e);let i=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,"list shared runs"),t});return await i.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),aG(e);let r=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,"read dataset shared schema"),t}),i=await r.json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};aG(e);let i=JSON.stringify(r),n=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await aJ(t,"share dataset"),t}),a=await n.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){aG(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,"unshare dataset",!0),t})}async readSharedDataset(e){aG(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,"read shared dataset"),t});return await t.json()}async listSharedExamples(e,t){let r={};t?.exampleIds&&(r.id=t.exampleIds);let i=new URLSearchParams;Object.entries(r).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>i.append(e,t)):i.append(e,t)});let n=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,"list shared examples"),t}),a=await n.json();if(!n.ok){if("detail"in a)throw Error(`Failed to list shared examples.
Status: ${n.status}
Message: ${Array.isArray(a.detail)?a.detail.join("\n"):"Unspecified error"}`);throw Error(`Failed to list shared examples: ${n.status} ${n.statusText}`)}return a.map(e=>({...e,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:i=!1,projectExtra:n=null,referenceDatasetId:a=null}){let s=`${this.apiUrl}/sessions${i?"?upsert=true":""}`,o=n||{};r&&(o.metadata=r);let l={name:e,extra:o,description:t};null!==a&&(l.reference_dataset_id=a);let u=JSON.stringify(l),c=await this.caller.call(async()=>{let e=await this._fetch(s,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await aJ(e,"create project"),e});return await c.json()}async updateProject(e,{name:t=null,description:r=null,metadata:i=null,projectExtra:n=null,endTime:a=null}){let s=`${this.apiUrl}/sessions/${e}`,o=n;i&&(o={...o||{},metadata:i});let l=JSON.stringify({name:t,extra:o,description:r,end_time:a?new Date(a).toISOString():null}),u=await this.caller.call(async()=>{let e=await this._fetch(s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await aJ(e,"update project"),e});return await u.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions",i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)aG(e),r+=`/${e}`;else if(void 0!==t)i.append("name",t);else throw Error("Must provide projectName or projectId");let n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${r}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(e,"has project"),e});try{let e=await n.json();if(!n.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let i,n="/sessions",a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)aG(e),n+=`/${e}`;else if(void 0!==t)a.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==r&&a.append("include_stats",r.toString());let s=await this._get(n,a);if(Array.isArray(s)){if(0===s.length)throw Error(`Project[id=${e}, name=${t}] not found`);i=s[0]}else i=s;return i}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${r.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:i,referenceDatasetName:n,includeStats:a,datasetVersion:s,referenceFree:o,metadata:l}={}){let u=new URLSearchParams;if(void 0!==e)for(let t of e)u.append("id",t);if(void 0!==t&&u.append("name",t),void 0!==r&&u.append("name_contains",r),void 0!==i)u.append("reference_dataset",i);else if(void 0!==n){let e=await this.readDataset({datasetName:n});u.append("reference_dataset",e.id)}for await(let e of(void 0!==a&&u.append("include_stats",a.toString()),void 0!==s&&u.append("dataset_version",s),void 0!==o&&u.append("reference_free",o.toString()),void 0!==l&&u.append("metadata",JSON.stringify(l)),this._getPaginated("/sessions",u)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");aG(r=void 0===e?(await this.readProject({projectName:t})).id:e),await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(e,`delete session ${r} (${t})`,!0),e})}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:i,description:n,dataType:a,name:s}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(e=>{l.append("input_keys",e)}),i.forEach(e=>{l.append("output_keys",e)}),n&&l.append("description",n),a&&l.append("data_type",a),s&&l.append("name",s);let u=await this.caller.call(async()=>{let e=await this._fetch(o,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await aJ(e,"upload CSV"),e});return await u.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:i,outputsSchema:n,metadata:a}={}){let s={name:e,description:t,extra:a?{metadata:a}:void 0};r&&(s.data_type=r),i&&(s.inputs_schema_definition=i),n&&(s.outputs_schema_definition=n);let o=JSON.stringify(s),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await aJ(e,"create dataset"),e});return await l.json()}async readDataset({datasetId:e,datasetName:t}){let r,i="/datasets",n=new URLSearchParams({limit:"1"});if(e&&t)throw Error("Must provide either datasetName or datasetId, not both");if(e)aG(e),i+=`/${e}`;else if(t)n.append("name",t);else throw Error("Must provide datasetName or datasetId");let a=await this._get(i,n);if(Array.isArray(a)){if(0===a.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=a[0]}else r=a;return r}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:i}){let n=e;if(void 0===n&&void 0===t)throw Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");void 0===n&&(n=(await this.readDataset({datasetName:t})).id);let a=new URLSearchParams({from_version:"string"==typeof r?r:r.toISOString(),to_version:"string"==typeof i?i:i.toISOString()});return await this._get(`/datasets/${n}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide either datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:i,datasetNameContains:n,metadata:a}={}){let s=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)s.append("id",e);for await(let e of(void 0!==i&&s.append("name",i),void 0!==n&&s.append("name_contains",n),void 0!==a&&s.append("metadata",JSON.stringify(a)),this._getPaginated("/datasets",s)))yield*e}async updateDataset(e){let{datasetId:t,datasetName:r,...i}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let n=t??(await this.readDataset({datasetName:r})).id;aG(n);let a=JSON.stringify(i),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${n}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await aJ(e,"update dataset"),e});return await s.json()}async updateDatasetTag(e){let{datasetId:t,datasetName:r,asOf:i,tag:n}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:r})).id;aG(a);let s=JSON.stringify({as_of:"string"==typeof i?i:i.toISOString(),tag:n});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await aJ(e,"update dataset tags",!0),e})}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",i=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(i=(await this.readDataset({datasetName:t})).id),void 0!==i)aG(i),r+=`/${i}`;else throw Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(e,`delete ${r}`,!0),e})}async indexDataset({datasetId:e,datasetName:t,tag:r}){let i=e;if(i||t)if(i&&t)throw Error("Must provide either datasetName or datasetId, not both");else i||(i=(await this.readDataset({datasetName:t})).id);else throw Error("Must provide either datasetName or datasetId");aG(i);let n=JSON.stringify({tag:r}),a=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await aJ(e,"index dataset"),e});await a.json()}async similarExamples(e,t,r,{filter:i}={}){let n={limit:r,inputs:e};void 0!==i&&(n.filter=i),aG(t);let a=JSON.stringify(n),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:a});return await aJ(e,"fetch similar examples"),e});return(await s.json()).examples}async createExample(e,t,r){let i;if(sn(e)&&(void 0!==t||void 0!==r))throw Error("Cannot provide outputs or options when using ExampleCreate object");let n=t?r?.datasetId:e.dataset_id,a=t?r?.datasetName:e.dataset_name;if(void 0===n&&void 0===a)throw Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==a)throw Error("Must provide either datasetName or datasetId, not both");void 0===n&&(n=(await this.readDataset({datasetName:a})).id);let s=(t?r?.createdAt:e.created_at)||new Date;i=sn(e)?e:{inputs:e,outputs:t,created_at:s?.toISOString(),id:r?.exampleId,metadata:r?.metadata,split:r?.split,source_run_id:r?.sourceRunId,use_source_run_io:r?.useSourceRunIO,use_source_run_attachments:r?.useSourceRunAttachments,attachments:r?.attachments};let o=await this._uploadExamplesMultipart(n,[i]);return await this.readExample(o.example_ids?.[0]??ao())}async createExamples(e){if(Array.isArray(e)){if(0===e.length)return[];let t=e[0].dataset_id,r=e[0].dataset_name;if(void 0===t&&void 0===r)throw Error("Must provide either datasetName or datasetId");if(void 0!==t&&void 0!==r)throw Error("Must provide either datasetName or datasetId, not both");void 0===t&&(t=(await this.readDataset({datasetName:r})).id);let i=await this._uploadExamplesMultipart(t,e);return await Promise.all(i.example_ids.map(e=>this.readExample(e)))}let{inputs:t,outputs:r,metadata:i,splits:n,sourceRunIds:a,useSourceRunIOs:s,useSourceRunAttachments:o,attachments:l,exampleIds:u,datasetId:c,datasetName:d}=e;if(void 0===t)throw Error("Must provide inputs when using legacy parameters");let h=c;if(void 0===h&&void 0===d)throw Error("Must provide either datasetName or datasetId");if(void 0!==h&&void 0!==d)throw Error("Must provide either datasetName or datasetId, not both");void 0===h&&(h=(await this.readDataset({datasetName:d})).id);let p=t.map((e,t)=>({dataset_id:h,inputs:e,outputs:r?.[t],metadata:i?.[t],split:n?.[t],id:u?.[t],attachments:l?.[t],source_run_id:a?.[t],use_source_run_io:s?.[t],use_source_run_attachments:o?.[t]})),f=await this._uploadExamplesMultipart(h,p);return await Promise.all(f.example_ids.map(e=>this.readExample(e)))}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let i=e.map(e=>aF(e)?aB(e):e),n=aF(t)?aB(t):t;return this.createExample({input:i},{output:n},r)}async readExample(e){aG(e);let t=`/examples/${e}`,{attachment_urls:r,...i}=await this._get(t);return r&&(i.attachments=Object.entries(r).reduce((e,[t,r])=>(e[t.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type},e),{})),i}async *listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:i,splits:n,inlineS3Urls:a,metadata:s,limit:o,offset:l,filter:u,includeAttachments:c}={}){let d;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)d=e;else if(void 0!==t)d=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let h=new URLSearchParams({dataset:d}),p=i?"string"==typeof i?i:i?.toISOString():void 0;if(p&&h.append("as_of",p),h.append("inline_s3_urls",(a??!0).toString()),void 0!==r)for(let e of r)h.append("id",e);if(void 0!==n)for(let e of n)h.append("splits",e);if(void 0!==s){let e=JSON.stringify(s);h.append("metadata",e)}void 0!==o&&h.append("limit",o.toString()),void 0!==l&&h.append("offset",l.toString()),void 0!==u&&h.append("filter",u),!0===c&&["attachment_urls","outputs","metadata"].forEach(e=>h.append("select",e));let f=0;for await(let e of this._getPaginated("/examples",h)){for(let t of e){let{attachment_urls:e,...r}=t;e&&(r.attachments=Object.entries(e).reduce((e,[t,r])=>(e[t.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type||void 0},e),{})),yield r,f++}if(void 0!==o&&f>=o)break}}async deleteExample(e){aG(e);let t=`/examples/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(e,`delete ${t}`,!0),e})}async updateExample(e,t){let r,i,n;return aG(r=t?e:e.id),n=void 0!==(i=t?{id:r,...t}:e).dataset_id?i.dataset_id:(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(n,[i])}async updateExamples(e){let t;return t=void 0===e[0].dataset_id?(await this.readExample(e[0].id)).dataset_id:e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:i}){let n;if(aG(n=e||(await this.readDataset({datasetName:t})).id),r&&i||!r&&!i)throw Error("Exactly one of asOf and tag must be specified.");let a=new URLSearchParams;void 0!==r&&a.append("as_of","string"==typeof r?r:r.toISOString()),void 0!==i&&a.append("tag",i);let s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${n}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(e,"read dataset version"),e});return await s.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let i;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");aG(i=void 0===e?(await this.readDataset({datasetName:t})).id:e);let n=new URLSearchParams,a=r?"string"==typeof r?r:r?.toISOString():void 0;return a&&n.append("as_of",a),await this._get(`/datasets/${i}/splits`,n)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:i,remove:n=!1}){let a;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");aG(a=void 0===e?(await this.readDataset({datasetName:t})).id:e);let s=JSON.stringify({split_name:r,examples:i.map(e=>(aG(e),e)),remove:n});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await aJ(e,"update dataset splits",!0),e})}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:i,referenceExample:n}={loadChildRuns:!1}){let a;if(aq("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof e)a=await this.readRun(e,{loadChildRuns:i});else if("object"==typeof e&&"id"in e)a=e;else throw Error(`Invalid run type: ${typeof e}`);null!==a.reference_example_id&&void 0!==a.reference_example_id&&(n=await this.readExample(a.reference_example_id));let s=await t.evaluateRun(a,n),[o,l]=await this._logEvaluationFeedback(s,a,r);return l[0]}async createFeedback(e,t,{score:r,value:i,correction:n,comment:a,sourceInfo:s,feedbackSourceType:o="api",sourceRunId:l,feedbackId:u,feedbackConfig:c,projectId:d,comparativeExperimentId:h}){if(!e&&!d)throw Error("One of runId or projectId must be provided");if(e&&d)throw Error("Only one of runId or projectId can be provided");let p={type:o??"api",metadata:s??{}};void 0===l||p?.metadata===void 0||p.metadata.__run||(p.metadata.__run={run_id:l}),p?.metadata!==void 0&&p.metadata.__run?.run_id!==void 0&&aG(p.metadata.__run.run_id);let f={id:u??ao(),run_id:e,key:t,score:se(r),value:i,correction:n,comment:a,feedback_source:p,comparative_experiment_id:h,feedbackConfig:c,session_id:d},m=JSON.stringify(f),g=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{let e=await this._fetch(g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:m});return await aJ(e,"create feedback",!0),e}),f}async updateFeedback(e,{score:t,value:r,correction:i,comment:n}){let a={};null!=t&&(a.score=se(t)),null!=r&&(a.value=r),null!=i&&(a.correction=i),null!=n&&(a.comment=n),aG(e);let s=JSON.stringify(a);await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await aJ(t,"update feedback",!0),t})}async readFeedback(e){aG(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){aG(e);let t=`/feedback/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(e,`delete ${t}`,!0),e})}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let i=new URLSearchParams;if(e)for(let t of e)aG(t),i.append("run",t);if(t)for(let e of t)i.append("key",e);if(r)for(let e of r)i.append("source",e);for await(let e of this._getPaginated("/feedback",i))yield*e}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:i}={}){let n={run_id:e,feedback_key:t,feedback_config:i};r?"string"==typeof r?n.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(n.expires_in=r):n.expires_in={hours:3};let a=JSON.stringify(n),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await aJ(e,"create presigned feedback token"),e});return await s.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:i,description:n,metadata:a,id:s}){if(0===t.length)throw Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!r)throw Error("A reference dataset is required");let o={id:s,name:e,experiment_ids:t,reference_dataset_id:r,description:n,created_at:(i??new Date)?.toISOString(),extra:{}};a&&(o.extra.metadata=a);let l=JSON.stringify(o);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await aJ(e,"create comparative experiment"),e})).json()}async *listPresignedFeedbackTokens(e){aG(e);let t=new URLSearchParams({run_id:e});for await(let e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){return"results"in e?e.results:Array.isArray(e)?e:[e]}async _logEvaluationFeedback(e,t,r){let i=this._selectEvalResults(e),n=[];for(let e of i){let i=r||{};e.evaluatorInfo&&(i={...e.evaluatorInfo,...i});let a=null;e.targetRunId?a=e.targetRunId:t&&(a=t.id),n.push(await this.createFeedback(a,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:i,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[i,n]}async logEvaluationFeedback(e,t,r){let[i]=await this._logEvaluationFeedback(e,t,r);return i}async *listAnnotationQueues(e={}){let{queueIds:t,name:r,nameContains:i,limit:n}=e,a=new URLSearchParams;t&&t.forEach((e,t)=>{aG(e,`queueIds[${t}]`),a.append("ids",e)}),r&&a.append("name",r),i&&a.append("name_contains",i),a.append("limit",(void 0!==n?Math.min(n,100):100).toString());let s=0;for await(let e of this._getPaginated("/annotation-queues",a))if(yield*e,s++,void 0!==n&&s>=n)break}async createAnnotationQueue(e){let{name:t,description:r,queueId:i,rubricInstructions:n}=e,a=JSON.stringify(Object.fromEntries(Object.entries({name:t,description:r,id:i||ao(),rubric_instructions:n}).filter(([e,t])=>void 0!==t)));return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await aJ(e,"create annotation queue"),e})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${aG(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,"read annotation queue"),t})).json()}async updateAnnotationQueue(e,t){let{name:r,description:i,rubricInstructions:n}=t,a=JSON.stringify({name:r,description:i,rubric_instructions:n});await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${aG(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await aJ(t,"update annotation queue",!0),t})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${aG(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){let r=JSON.stringify(t.map((e,t)=>aG(e,`runIds[${t}]`).toString()));await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${aG(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await aJ(t,"add runs to annotation queue",!0),t})}async getRunFromAnnotationQueue(e,t){let r=`/annotation-queues/${aG(e,"queueId")}/run`;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(e,"get run from annotation queue"),e})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{let r=await this._fetch(`${this.apiUrl}/annotation-queues/${aG(e,"queueId")}/runs/${aG(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(r,"delete run from annotation queue",!0),r})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${aG(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,"get size from annotation queue"),t})).json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){let r=await this._getSettings();return Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(t,"get latest commit hash"),t}),r=await t.json();if(0!==r.commits.length)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[r,i,n]=aW(e),a=JSON.stringify({like:t});return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/likes/${r}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await aJ(e,`${t?"like":"unlike"} prompt`),e})).json()}async _getPromptUrl(e){let[t,r,i]=aW(e);if(await this._currentTenantIsOwner(t)){let e=await this._getSettings();return"latest"!==i?`${this.getHostUrl()}/prompts/${r}/${i.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${e.id}`}return"latest"!==i?`${this.getHostUrl()}/hub/${t}/${r}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async *listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,e=>e.commits))yield*t}async *listPrompts(e){let t=new URLSearchParams;for await(let r of(t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query),this._getPaginated("/repos",t,e=>e.repos)))yield*r}async getPrompt(e){let[t,r,i]=aW(e),n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return e?.status===404?null:(await aJ(e,"get prompt"),e)}),a=await n?.json();return a?.repo?a.repo:null}async createPrompt(e,t){let r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[i,n,a]=aW(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);let s=JSON.stringify({repo_handle:n,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic}),o=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await aJ(e,"create prompt"),e}),{repo:l}=await o.json();return l}async createCommit(e,t,r){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[i,n,a]=aW(e),s=r?.parentCommitHash!=="latest"&&r?.parentCommitHash?r?.parentCommitHash:await this._getLatestCommitHash(`${i}/${n}`),o=JSON.stringify({manifest:JSON.parse(JSON.stringify(t)),parent_commit:s}),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${i}/${n}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await aJ(e,"create commit"),e}),u=await l.json();return this._getPromptUrl(`${i}/${n}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=e.id,i=new Blob([a6({...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split}},`Serializing body for example with id: ${t}`)],{type:"application/json"});if(r.append(t,i),e.inputs){let i=new Blob([a6(e.inputs,`Serializing inputs for example with id: ${t}`)],{type:"application/json"});r.append(`${t}.inputs`,i)}if(e.outputs){let i=new Blob([a6(e.outputs,`Serializing outputs whle updating example with id: ${t}`)],{type:"application/json"});r.append(`${t}.outputs`,i)}if(e.attachments)for(let[i,n]of Object.entries(e.attachments)){let e,a;Array.isArray(n)?[e,a]=n:(e=n.mimeType,a=n.data);let s=new Blob([a],{type:`${e}; length=${a.byteLength}`});r.append(`${t}.attachment.${i}`,s)}if(e.attachments_operations){let i=new Blob([a6(e.attachments_operations,`Serializing attachments while updating example with id: ${t}`)],{type:"application/json"});r.append(`${t}.attachments_operations`,i)}}let i=e??t[0]?.dataset_id;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${i}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await aJ(e,"update examples"),e})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=(e.id??ao()).toString(),i=new Blob([a6({created_at:e.created_at,...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split},...e.source_run_id&&{source_run_id:e.source_run_id},...e.use_source_run_io&&{use_source_run_io:e.use_source_run_io},...e.use_source_run_attachments&&{use_source_run_attachments:e.use_source_run_attachments}},`Serializing body for uploaded example with id: ${t}`)],{type:"application/json"});if(r.append(t,i),e.inputs){let i=new Blob([a6(e.inputs,`Serializing inputs for uploaded example with id: ${t}`)],{type:"application/json"});r.append(`${t}.inputs`,i)}if(e.outputs){let i=new Blob([a6(e.outputs,`Serializing outputs for uploaded example with id: ${t}`)],{type:"application/json"});r.append(`${t}.outputs`,i)}if(e.attachments)for(let[i,n]of Object.entries(e.attachments)){let e,a;Array.isArray(n)?[e,a]=n:(e=n.mimeType,a=n.data);let s=new Blob([a],{type:`${e}; length=${a.byteLength}`});r.append(`${t}.attachment.${i}`,s)}}return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await aJ(t,"upload examples"),t})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[r,i]=aW(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let n={};if(t?.description!==void 0&&(n.description=t.description),t?.readme!==void 0&&(n.readme=t.readme),t?.tags!==void 0&&(n.tags=t.tags),t?.isPublic!==void 0&&(n.is_public=t.isPublic),t?.isArchived!==void 0&&(n.is_archived=t.isArchived),0===Object.keys(n).length)throw Error("No valid update options provided");let a=JSON.stringify(n);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${r}/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await aJ(e,"update prompt"),e})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[t,r,i]=aW(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(e,"delete prompt"),e})).json()}async pullPromptCommit(e,t){let[r,i,n]=aW(e),a=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${r}/${i}/${n}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await aJ(e,"pull prompt commit"),e}),s=await a.json();return{owner:r,repo:i,commit_hash:s.commit_hash,manifest:s.manifest,examples:s.examples}}async _pullPrompt(e,t){return JSON.stringify((await this.pullPromptCommit(e,{includeModel:t?.includeModel})).manifest)}async pushPrompt(e,t){return(await this.promptExists(e)?t&&Object.keys(t).some(e=>"object"!==e)&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object)?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:r=this.apiUrl,datasetName:i}=t,[n,a]=this.parseTokenOrUrl(e,r),s=new si({apiUrl:n,apiKey:"placeholder"}),o=await s.readSharedDataset(a),l=i||o.name;try{if(await this.hasDataset({datasetId:l}))return void console.log(`Dataset ${l} already exists in your tenant. Skipping.`)}catch(e){}let u=await s.listSharedExamples(a),c=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(e=>e.inputs),outputs:u.flatMap(e=>e.outputs?[e.outputs]:[]),datasetId:c.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,r=2,i="dataset"){try{return aG(e),[t,e]}catch(e){}try{let n=new URL(e).pathname.split("/").filter(e=>""!==e);if(n.length>=r){let e=n[n.length-r];return[t,e]}throw Error(`Invalid public ${i} URL: ${e}`)}catch(t){throw Error(`Invalid public ${i} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),void 0!==this.langSmithToOTELTranslator&&await aP.getDefaultOTLPTracerComponents()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}}function sn(e){return"dataset_id"in e||"dataset_name"in e}let sa=Symbol.for("lc:context_variables");function ss(e,t,r=1){let i=r.toFixed(0).slice(0,3).padStart(3,"0"),n=`${new Date(e).toISOString().slice(0,-1)}${i}Z`;return{dottedOrder:n.replace(/[-:.]/g,"")+t,microsecondPrecisionDatestring:n}}class so{constructor(e,t,r,i){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=r,this.replicas=i}static fromHeader(e){let t,r,i=e.split(","),n={},a=[];for(let e of i){let[i,s]=e.split("="),o=decodeURIComponent(s);"langsmith-metadata"===i?n=JSON.parse(o):"langsmith-tags"===i?a=o.split(","):"langsmith-project"===i?t=o:"langsmith-replicas"===i&&(r=JSON.parse(o))}return new so(n,a,t,r)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class sl{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){return null!=e&&"function"==typeof e.createChild&&"function"==typeof e.postRun}(e))return void Object.assign(this,{...e});const t=sl.getDefaultConfig(),{metadata:r,...i}=e,n=i.client??sl.getSharedClient(),a={...r,...i?.extra?.metadata};if(i.extra={...i.extra,metadata:a},Object.assign(this,{...t,...i,client:n}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=function(e){return e?e.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):function(){let e=aS("LANGSMITH_RUNS_ENDPOINTS");if(!e)return[];try{let r=JSON.parse(e);if(Array.isArray(r)){let e=[];for(let t of r){if("object"!=typeof t||null===t){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof t}`);continue}if("string"!=typeof t.api_url){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof t.api_url}`);continue}if("string"!=typeof t.api_key){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof t.api_key}`);continue}e.push({apiUrl:t.api_url.replace(/\/$/,""),apiKey:t.api_key})}return e}if("object"!=typeof r||null===r)return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof r}`),[];{var t=r;if(Object.keys(t).length>0&&aI("ENDPOINT"))throw new aY;let e=[];for(let[t,i]of Object.entries(r)){let r=t.replace(/\/$/,"");if("string"==typeof i)e.push({apiUrl:r,apiKey:i});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${t}: expected string, got ${typeof i}`);continue}}return e}}catch(e){if("object"==typeof e&&null!==e&&e.code===aV)throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}()}(this.replicas),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){const{dottedOrder:e,microsecondPrecisionDatestring:t}=ss(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e,this._serialized_start_time=t}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:ao(),run_type:"chain",project_name:ab(),child_runs:[],api_url:aS("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:aS("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return sl.sharedClient||(sl.sharedClient=new si),sl.sharedClient}createChild(e){var t,r;let i=this.child_execution_order+1,n=new sl({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:i,child_execution_order:i});sa in this&&(n[sa]=this[sa]);let a=Symbol.for("lc:child_config"),s=e.extra?.[a]??this.extra[a];if(null!=(t=s)&&"object"==typeof t.callbacks&&(sc(t.callbacks?.handlers)||sc(t.callbacks))){let e={...s},t="object"==typeof(r=e.callbacks)&&null!=r&&Array.isArray(r.handlers)?e.callbacks.copy?.():void 0;t&&(Object.assign(t,{_parentRunId:n.id}),t.handlers?.find(su)?.updateFromRunTree?.(n),e.callbacks=t),n.extra[a]=e}let o=new Set,l=this;for(;null!=l&&!o.has(l.id);)o.add(l.id),l.child_execution_order=Math.max(l.child_execution_order,i),l=l.parent_run;return this.child_runs.push(n),n}async end(e,t,r=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,i&&Object.keys(i).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...i}}:{metadata:i})}_convertToCreate(e,t,r=!0){let i,n,a=e.extra??{};if(a?.runtime?.library===void 0&&(a.runtime||(a.runtime={}),t))for(let[e,r]of Object.entries(t))a.runtime[e]||(a.runtime[e]=r);return r?(n=e.parent_run?.id??e.parent_run_id,i=[]):(i=e.child_runs.map(e=>this._convertToCreate(e,t,r)),n=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:n,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,r=!0){let i,n=this._convertToCreate(this,t,r);if(e===this.project_name)return n;let a=t=>ap(`${t}:${e}`,ap.DNS),s=a(n.id),o=n.trace_id?a(n.trace_id):void 0,l=n.parent_run_id?a(n.parent_run_id):void 0;if(n.dotted_order){let e=n.dotted_order.split(".").map(e=>{let t=e.slice(0,-36),r=e.slice(-36);return[new Date(parseInt(t.slice(0,4)),parseInt(t.slice(4,6))-1,parseInt(t.slice(6,8)),parseInt(t.slice(9,11)),parseInt(t.slice(11,13)),parseInt(t.slice(13,15)),parseInt(t.slice(15,21))/1e3),r]}),t=[];for(let r=0;r<e.length-1;r++){let[i,n]=e[r],s=a(n);t.push(i.toISOString().replace(/[-:]/g,"").replace(".","")+s)}let[r]=e[e.length-1];t.push(r.toISOString().replace(/[-:]/g,"").replace(".","")+s),i=t.join(".")}else i=void 0;return{...n,id:s,trace_id:o,parent_run_id:l,dotted_order:i,session_name:e}}async postRun(e=!0){try{let t=aT();if(this.replicas&&this.replicas.length>0)for(let{projectName:e,apiKey:r,apiUrl:i,workspaceId:n}of this.replicas){let a=this._remapForProject(e??this.project_name,t,!0);await this.client.createRun(a,{apiKey:r,apiUrl:i,workspaceId:n})}else{let r=this._convertToCreate(this,t,e);await this.client.createRun(r)}if(!e)for(let e of(aq("Posting with excludeChildRuns=false is deprecated and will be removed in a future version."),this.child_runs))await e.postRun(!1)}catch(e){console.error(`Error in postRun for run ${this.id}:`,e)}}async patchRun(e){if(this.replicas&&this.replicas.length>0)for(let{projectName:t,apiKey:r,apiUrl:i,workspaceId:n,updates:a}of this.replicas){let s=this._remapForProject(t??this.project_name),o={id:s.id,outputs:s.outputs,error:s.error,parent_run_id:s.parent_run_id,session_name:s.session_name,reference_example_id:s.reference_example_id,end_time:s.end_time,dotted_order:s.dotted_order,trace_id:s.trace_id,events:s.events,tags:s.tags,extra:s.extra,attachments:this.attachments,...a};e?.excludeInputs||(o.inputs=s.inputs),await this.client.updateRun(s.id,o,{apiKey:r,apiUrl:i,workspaceId:n})}else try{let t={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(t.inputs=this.inputs),await this.client.updateRun(this.id,t)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),"string"==typeof e?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var r;let i,n,a,s=e?.callbacks,o=void 0!==r?r:!!["TRACING_V2","TRACING"].find(e=>"true"===aI(e));if(s){let e=s?.getParentRunId?.()??"",t=s?.handlers?.find(e=>e?.name=="langchain_tracer");i=t?.getRun?.(e),n=t?.projectName,a=t?.client,o=o||!!t}return i?new sl({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:a,tracingEnabled:o,project_name:n,tags:[...new Set((i?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...i?.extra?.metadata,...e?.metadata}}}).createChild(t):new sl({...t,client:a,tracingEnabled:o,project_name:n})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=r["langsmith-trace"];if(!i||"string"!=typeof i)return;let n=i.trim(),a=n.split(".").map(e=>{let[t,r]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:r}}),s=a[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:a.at(-1)?.uuid,trace_id:s,dotted_order:n};if(r.baggage&&"string"==typeof r.baggage){let e=so.fromHeader(r.baggage);o.metadata=e.metadata,o.tags=e.tags,o.project_name=e.project_name,o.replicas=e.replicas}return new sl(o)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new so(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[r,i]of Object.entries(t))e.set(r,i);return t}}function su(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function sc(e){return Array.isArray(e)&&e.some(e=>su(e))}function sd(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}function sh(e){return"function"==typeof e._addRunToRunMap}Object.defineProperty(sl,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null}),iI({},{BaseTracer:()=>sp,isBaseTracer:()=>sh});var sp=class extends ac{runMap=new Map;runTreeMap=new Map;usesRunTreeMap=!1;constructor(e){super(...arguments)}copy(){return this}getRunById(e){if(void 0!==e)return this.usesRunTreeMap?(e=>{if(e)return e.events=e.events??[],e.child_runs=e.child_runs??[],e})(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let{dottedOrder:t,microsecondPrecisionDatestring:r}=ss(new Date(e.start_time).getTime(),e.id,e.execution_order),i={...e},n=this.getRunById(i.parent_run_id);if(void 0!==i.parent_run_id?n&&(this._addChildRun(n,i),n.child_execution_order=Math.max(n.child_execution_order,i.child_execution_order),i.trace_id=n.trace_id,void 0!==n.dotted_order&&(i.dotted_order=[n.dotted_order,t].join("."),i._serialized_start_time=r)):(i.trace_id=i.id,i.dotted_order=t,i._serialized_start_time=r),this.usesRunTreeMap){let e=function e(t,r){if(t)return new sl({...t,start_time:t._serialized_start_time??t.start_time,parent_run:e(r),child_runs:t.child_runs.map(t=>e(t)).filter(e=>void 0!==e),extra:{...t.extra,runtime:iN()},tracingEnabled:!1})}(i,n);void 0!==e&&this.runTreeMap.set(i.id,e)}else this.runMap.set(i.id,i);return i}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){let t=void 0!==e&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,i,n,a,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c=s?{...n,metadata:s}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:a||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,r,i,n,a,s,o){let l=this.getRunById(r)??this._createRunForLLMStart(e,t,r,i,n,a,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}_createRunForChatModelStart(e,t,r,i,n,a,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c=s?{...n,metadata:s}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:a||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,r,i,n,a,s,o){let l=this.getRunById(r)??this._createRunForChatModelStart(e,t,r,i,n,a,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}async handleLLMEnd(e,t,r,i,n){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...n},await this.onLLMEnd?.(a),await this._endTrace(a),a}async handleLLMError(e,t,r,i,n){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...n},await this.onLLMError?.(a),await this._endTrace(a),a}_createRunForChainStart(e,t,r,i,n,a,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return this._addRunToRunMap(c)}async handleChainStart(e,t,r,i,n,a,s,o){let l=this.getRunById(r)??this._createRunForChainStart(e,t,r,i,n,a,s,o);return await this.onRunCreate?.(l),await this.onChainStart?.(l),l}async handleChainEnd(e,t,r,i,n){let a=this.getRunById(t);if(!a)throw Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=sd(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),n?.inputs!==void 0&&(a.inputs=sd(n.inputs,"input")),await this.onChainEnd?.(a),await this._endTrace(a),a}async handleChainError(e,t,r,i,n){let a=this.getRunById(t);if(!a)throw Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),n?.inputs!==void 0&&(a.inputs=sd(n.inputs,"input")),await this.onChainError?.(a),await this._endTrace(a),a}_createRunForToolStart(e,t,r,i,n,a,s){let o=this._getExecutionOrder(i),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,r,i,n,a,s){let o=this.getRunById(r)??this._createRunForToolStart(e,t,r,i,n,a,s);return await this.onRunCreate?.(o),await this.onToolStart?.(o),o}async handleToolEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,t,r,i,n,a,s){let o=this._getExecutionOrder(i),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,r,i,n,a,s){let o=this.getRunById(r)??this._createRunForRetrieverStart(e,t,r,i,n,a,s);return await this.onRunCreate?.(o),await this.onRetrieverStart?.(o),o}async handleRetrieverEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,i,n,a){let s=this.getRunById(r);if(!s||s?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),await this.onLLMNewToken?.(s,e,{chunk:a?.chunk}),s}};let sf=(e=0)=>t=>`\u001B[${t+e}m`,sm=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,sg=(e=0)=>(t,r,i)=>`\u001B[${38+e};2;${t};${r};${i}m`,sy={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};Object.keys(sy.modifier),[...Object.keys(sy.color),...Object.keys(sy.bgColor)];let s_=function(){let e=new Map;for(let[t,r]of Object.entries(sy)){for(let[t,i]of Object.entries(r))sy[t]={open:`\u001B[${i[0]}m`,close:`\u001B[${i[1]}m`},r[t]=sy[t],e.set(i[0],i[1]);Object.defineProperty(sy,t,{value:r,enumerable:!1})}return Object.defineProperty(sy,"codes",{value:e,enumerable:!1}),sy.color.close="\x1b[39m",sy.bgColor.close="\x1b[49m",sy.color.ansi=sf(),sy.color.ansi256=sm(),sy.color.ansi16m=sg(),sy.bgColor.ansi=sf(10),sy.bgColor.ansi256=sm(10),sy.bgColor.ansi16m=sg(10),Object.defineProperties(sy,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value(e){let t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!t)return[0,0,0];let[r]=t;3===r.length&&(r=[...r].map(e=>e+e).join(""));let i=Number.parseInt(r,16);return[i>>16&255,i>>8&255,255&i]},enumerable:!1},hexToAnsi256:{value:e=>sy.rgbToAnsi256(...sy.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){let t,r,i;if(e<8)return 30+e;if(e<16)return 90+(e-8);if(e>=232)r=t=((e-232)*10+8)/255,i=t;else{let n=(e-=16)%36;t=Math.floor(e/36)/5,r=Math.floor(n/6)/5,i=n%6/5}let n=2*Math.max(t,r,i);if(0===n)return 30;let a=30+(Math.round(i)<<2|Math.round(r)<<1|Math.round(t));return 2===n&&(a+=60),a},enumerable:!1},rgbToAnsi:{value:(e,t,r)=>sy.ansi256ToAnsi(sy.rgbToAnsi256(e,t,r)),enumerable:!1},hexToAnsi:{value:e=>sy.ansi256ToAnsi(sy.hexToAnsi256(e)),enumerable:!1}}),sy}();function sv(e,t){return`${e.open}${t}${e.close}`}function sb(e,t){try{return JSON.stringify(e,null,2)}catch{return t}}function sw(e){return"string"==typeof e?e.trim():null==e?e:sb(e,e.toString())}function sE(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}iI({},{ConsoleCallbackHandler:()=>sS});let{color:sT}=s_;var sS=class extends sp{name="console_callback_handler";persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=[...this.getParents(e).reverse(),e].map((e,t,r)=>{let i=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?sv(s_.bold,i):i}).join(" > ");return sv(sT.grey,t)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.green,"[chain/start]")} [${t}] Entering Chain run with input: ${sb(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.cyan,"[chain/end]")} [${t}] [${sE(e)}] Exiting Chain run with output: ${sb(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.red,"[chain/error]")} [${t}] [${sE(e)}] Chain run errored with error: ${sb(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${sv(sT.green,"[llm/start]")} [${t}] Entering LLM run with input: ${sb(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.cyan,"[llm/end]")} [${t}] [${sE(e)}] Exiting LLM run with output: ${sb(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.red,"[llm/error]")} [${t}] [${sE(e)}] LLM run errored with error: ${sb(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.green,"[tool/start]")} [${t}] Entering Tool run with input: "${sw(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.cyan,"[tool/end]")} [${t}] [${sE(e)}] Exiting Tool run with output: "${sw(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.red,"[tool/error]")} [${t}] [${sE(e)}] Tool run errored with error: ${sb(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${sb(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.cyan,"[retriever/end]")} [${t}] [${sE(e)}] Exiting Retriever run with output: ${sb(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.red,"[retriever/error]")} [${t}] [${sE(e)}] Retriever run errored with error: ${sb(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${sv(sT.blue,"[agent/action]")} [${t}] Agent selected action: ${sb(e.actions[e.actions.length-1],"[action]")}`)}};e.i(222201);let sI=()=>(void 0===a&&(a=new si("false"===iP("LANGCHAIN_CALLBACKS_BACKGROUND")?{blockOnRootRunFinalization:!0}:{})),a),sO=Symbol.for("ls:tracing_async_local_storage"),sA=new class{getStore(){}run(e,t){return t()}},sk=new class{getInstance(){return globalThis[sO]??sA}initializeGlobalInstance(e){void 0===globalThis[sO]&&(globalThis[sO]=e)}};function sx(e){return"function"==typeof e&&"langsmith:traceable"in e}Symbol.for("langsmith:traceable:root"),iI({},{LangChainTracer:()=>s$});var s$=class e extends sp{name="langchain_tracer";projectName;exampleId;client;replicas;usesRunTreeMap=!0;constructor(t={}){super(t);const{exampleId:r,projectName:i,client:n,replicas:a}=t;this.projectName=i??ab(),this.replicas=a,this.exampleId=r,this.client=n??sI();const s=e.getTraceableRunTree();s&&this.updateFromRunTree(s)}async persistRun(e){}async onRunCreate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.postRun()}async onRunUpdate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.patchRun()}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){this.runTreeMap.set(e.id,e);let t=e,r=new Set;for(;t.parent_run&&!r.has(t.id)&&(r.add(t.id),t.parent_run);){;t=t.parent_run}r.clear();let i=[t];for(;i.length>0;){let e=i.shift();!(!e||r.has(e.id))&&(r.add(e.id),this.runTreeMap.set(e.id,e),e.child_runs&&i.push(...e.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){let t=this.runTreeMap.get(e);if(t)return new sl({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return function(e=!1){let t=sk.getInstance().getStore();if(!e&&void 0===t)throw Error("Could not get the current run tree.\n\nPlease make sure you are calling this method within a traceable function and that tracing is enabled.");return t}(!0)}catch{return}}};let sC=Symbol.for("ls:tracing_async_local_storage"),sN=Symbol.for("lc:context_variables"),sP=()=>globalThis[sC];var sR=e.i(231309);sR.default;var sj=sR;class sU extends Error{name="TimeoutError";constructor(e,t){super(e,t),Error.captureStackTrace?.(this,sU)}}let sL=e=>e.reason??new DOMException("This operation was aborted.","AbortError");class sD{#C=[];enqueue(e,t){let{priority:r=0,id:i}=t??{},n={priority:r,id:i,run:e};if(0===this.size||this.#C[this.size-1].priority>=r)return void this.#C.push(n);let a=function(e,t,r){let i=0,n=e.length;for(;n>0;){let a=Math.trunc(n/2),s=i+a;0>=r(e[s],t)?(i=++s,n-=a+1):n=a}return i}(this.#C,n,(e,t)=>t.priority-e.priority);this.#C.splice(a,0,n)}setPriority(e,t){let r=this.#C.findIndex(t=>t.id===e);if(-1===r)throw ReferenceError(`No promise function with the id "${e}" exists in the queue.`);let[i]=this.#C.splice(r,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){let e=this.#C.shift();return e?.run}filter(e){return this.#C.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this.#C.length}}class sM extends sj.default{#N;#P;#R=0;#j;#U=!1;#L=!1;#D;#M=0;#z=0;#F;#B;#C;#Z;#G=0;#H;#q;#W=1n;#K=new Map;timeout;constructor(e){if(super(),!("number"==typeof(e={carryoverIntervalCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:sD,...e}).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);if(this.#N=e.carryoverIntervalCount??e.carryoverConcurrencyCount??!1,this.#P=e.intervalCap===1/0||0===e.interval,this.#j=e.intervalCap,this.#D=e.interval,this.#C=new e.queueClass,this.#Z=e.queueClass,this.concurrency=e.concurrency,void 0!==e.timeout&&!(Number.isFinite(e.timeout)&&e.timeout>0))throw TypeError(`Expected \`timeout\` to be a positive finite number, got \`${e.timeout}\` (${typeof e.timeout})`);this.timeout=e.timeout,this.#q=!1===e.autoStart,this.#J()}get #V(){return this.#P||this.#R<this.#j}get #Y(){return this.#G<this.#H}#X(){this.#G--,0===this.#G&&this.emit("pendingZero"),this.#Q(),this.emit("next")}#ee(){this.#et(),this.#er(),this.#B=void 0}get #ei(){let e=Date.now();if(void 0===this.#F){let t=this.#M-e;if(!(t<0))return this.#en(t),!0;if(this.#z>0){let t=e-this.#z;if(t<this.#D)return this.#en(this.#D-t),!0}this.#R=this.#N?this.#G:0}return!1}#en(e){void 0===this.#B&&(this.#B=setTimeout(()=>{this.#ee()},e))}#ea(){this.#F&&(clearInterval(this.#F),this.#F=void 0)}#es(){this.#B&&(clearTimeout(this.#B),this.#B=void 0)}#Q(){if(0===this.#C.size)return this.#ea(),this.emit("empty"),0===this.#G&&(this.#es(),this.emit("idle")),!1;let e=!1;if(!this.#q){let t=!this.#ei;if(this.#V&&this.#Y){let r=this.#C.dequeue();this.#P||(this.#R++,this.#eo()),this.emit("active"),this.#z=Date.now(),r(),t&&this.#er(),e=!0}}return e}#er(){this.#P||void 0!==this.#F||(this.#F=setInterval(()=>{this.#et()},this.#D),this.#M=Date.now()+this.#D)}#et(){0===this.#R&&0===this.#G&&this.#F&&this.#ea(),this.#R=this.#N?this.#G:0,this.#el(),this.#eo()}#el(){for(;this.#Q(););}get concurrency(){return this.#H}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#H=e,this.#el()}setPriority(e,t){if("number"!=typeof t||!Number.isFinite(t))throw TypeError(`Expected \`priority\` to be a finite number, got \`${t}\` (${typeof t})`);this.#C.setPriority(e,t)}async add(e,t={}){return t.id??=(this.#W++).toString(),t={timeout:this.timeout,...t},new Promise((r,i)=>{let n=Symbol(`task-${t.id}`);this.#C.enqueue(async()=>{let a;this.#G++,this.#K.set(n,{id:t.id,priority:t.priority??0,startTime:Date.now(),timeout:t.timeout});try{try{t.signal?.throwIfAborted()}catch(e){throw!this.#P&&this.#R--,this.#K.delete(n),e}let i=e({signal:t.signal});if(t.timeout&&(i=function(e,t){let r,i,{milliseconds:n,fallback:a,message:s,customTimers:o={setTimeout,clearTimeout},signal:l}=t,u=new Promise((t,u)=>{if("number"!=typeof n||1!==Math.sign(n))throw TypeError(`Expected \`milliseconds\` to be a positive number, got \`${n}\``);if(l?.aborted)return void u(sL(l));if(l&&(i=()=>{u(sL(l))},l.addEventListener("abort",i,{once:!0})),e.then(t,u),n===1/0)return;let c=new sU;r=o.setTimeout.call(void 0,()=>{if(a){try{t(a())}catch(e){u(e)}return}"function"==typeof e.cancel&&e.cancel(),!1===s?t():s instanceof Error?u(s):(c.message=s??`Promise timed out after ${n} milliseconds`,u(c))},n)}).finally(()=>{u.clear(),i&&l&&l.removeEventListener("abort",i)});return u.clear=()=>{o.clearTimeout.call(void 0,r),r=void 0},u}(Promise.resolve(i),{milliseconds:t.timeout,message:`Task timed out after ${t.timeout}ms (queue has ${this.#G} running, ${this.#C.size} waiting)`})),t.signal){let{signal:e}=t;i=Promise.race([i,new Promise((t,r)=>{a=()=>{r(e.reason)},e.addEventListener("abort",a,{once:!0})})])}let s=await i;r(s),this.emit("completed",s)}catch(e){i(e),this.emit("error",e)}finally{a&&t.signal?.removeEventListener("abort",a),this.#K.delete(n),queueMicrotask(()=>{this.#X()})}},t),this.emit("add"),this.#Q()})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this.#q&&(this.#q=!1,this.#el()),this}pause(){this.#q=!0}clear(){this.#C=new this.#Z,this.#eu()}async onEmpty(){0!==this.#C.size&&await this.#ec("empty")}async onSizeLessThan(e){this.#C.size<e||await this.#ec("next",()=>this.#C.size<e)}async onIdle(){(0!==this.#G||0!==this.#C.size)&&await this.#ec("idle")}async onPendingZero(){0!==this.#G&&await this.#ec("pendingZero")}async onRateLimit(){this.isRateLimited||await this.#ec("rateLimit")}async onRateLimitCleared(){this.isRateLimited&&await this.#ec("rateLimitCleared")}async onError(){return new Promise((e,t)=>{let r=e=>{this.off("error",r),t(e)};this.on("error",r)})}async #ec(e,t){return new Promise(r=>{let i=()=>{(!t||t())&&(this.off(e,i),r())};this.on(e,i)})}get size(){return this.#C.size}sizeBy(e){return this.#C.filter(e).length}get pending(){return this.#G}get isPaused(){return this.#q}#J(){this.#P||(this.on("add",()=>{this.#C.size>0&&this.#eo()}),this.on("next",()=>{this.#eo()}))}#eo(){this.#P||this.#L||(this.#L=!0,queueMicrotask(()=>{this.#L=!1,this.#eu()}))}#eu(){let e=this.#U,t=!this.#P&&this.#R>=this.#j&&this.#C.size>0;t!==e&&(this.#U=t,this.emit(t?"rateLimit":"rateLimitCleared"))}get isRateLimited(){return this.#U}get isSaturated(){return this.#G===this.#H&&this.#C.size>0||this.isRateLimited&&this.#C.size>0}get runningTasks(){return[...this.#K.values()].map(e=>({...e}))}}async function sz(e,t){if(!0===t){let t=sP();void 0!==t?await t.run(void 0,async()=>e()):await e()}else void 0===s&&(s=new("default"in sM?sM.default:sM)({autoStart:!0,concurrency:1})),s.add(async()=>{let t=sP();void 0!==t?await t.run(void 0,async()=>e()):await e()})}async function sF(){let e=sI();await Promise.allSettled([void 0!==s?s.onIdle():Promise.resolve(),e.awaitPendingTraceBatches()])}function sB(e){let t=sP();if(void 0===t)return;let r=t.getStore();return r?.[sN]?.[e]}iI({},{awaitAllCallbacks:()=>sF,consumeCallback:()=>sz});let sZ=Symbol("lc:configure_hooks");function sG(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}iI({},{BaseCallbackManager:()=>sH,BaseRunManager:()=>sq,CallbackManager:()=>sY,CallbackManagerForChainRun:()=>sJ,CallbackManagerForLLMRun:()=>sK,CallbackManagerForRetrieverRun:()=>sW,CallbackManagerForToolRun:()=>sV,ensureHandler:()=>sX,parseCallbackConfigArg:()=>sG});var sH=class{setHandler(e){return this.setHandlers([e])}},sq=class{constructor(e,t,r,i,n,a,s,o){this.runId=e,this.handlers=t,this.inheritableHandlers=r,this.tags=i,this.inheritableTags=n,this.metadata=a,this.inheritableMetadata=s,this._parentRunId=o}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>sz(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,i,n){await Promise.all(this.handlers.map(r=>sz(async()=>{try{await r.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleCustomEvent: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}},sW=class extends sq{getChild(e){let t=new sY(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>sz(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw e}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>sz(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}},t.awaitHandlers)))}},sK=class extends sq{async handleLLMNewToken(e,t,r,i,n,a){await Promise.all(this.handlers.map(r=>sz(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}async handleLLMError(e,t,r,i,n){await Promise.all(this.handlers.map(t=>sz(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleLLMEnd(e,t,r,i,n){await Promise.all(this.handlers.map(t=>sz(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}},sJ=class extends sq{getChild(e){let t=new sY(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,i,n){await Promise.all(this.handlers.map(t=>sz(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleChainEnd(e,t,r,i,n){await Promise.all(this.handlers.map(t=>sz(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>sz(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>sz(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}},sV=class extends sq{getChild(e){let t=new sY(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>sz(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>sz(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}},sY=class e extends sH{handlers=[];inheritableHandlers=[];tags=[];inheritableTags=[];metadata={};inheritableMetadata={};name="callback_manager";_parentRunId;constructor(e,t){super(),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r,i,n,a,s,o){return Promise.all(t.map(async(t,i)=>{let a=0===i&&r?r:ao();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return sh(r)&&r._createRunForLLMStart(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o),sz(async()=>{try{await r.handleLLMStart?.(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new sK(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,i,n,a,s,o){return Promise.all(t.map(async(t,i)=>{let a=0===i&&r?r:ao();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return sh(r)&&r._createRunForChatModelStart(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o),sz(async()=>{try{if(r.handleChatModelStart)await r.handleChatModelStart?.(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o);else if(r.handleLLMStart){let i=n2(t);await r.handleLLMStart?.(e,[i],a,this._parentRunId,n,this.tags,this.metadata,o)}}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new sK(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=ao(),i,n,a,s){return await Promise.all(this.handlers.map(n=>{if(!n.ignoreChain)return sh(n)&&n._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,i,s),sz(async()=>{try{await n.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,i,s)}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleChainStart: ${e}`),n.raiseError)throw e}},n.awaitHandlers)})),new sJ(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=ao(),i,n,a,s){return await Promise.all(this.handlers.map(i=>{if(!i.ignoreAgent)return sh(i)&&i._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,s),sz(async()=>{try{await i.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleToolStart: ${e}`),i.raiseError)throw e}},i.awaitHandlers)})),new sV(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=ao(),i,n,a,s){return await Promise.all(this.handlers.map(i=>{if(!i.ignoreRetriever)return sh(i)&&i._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,s),sz(async()=>{try{await i.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleRetrieverStart: ${e}`),i.raiseError)throw e}},i.awaitHandlers)})),new sW(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,i,n){await Promise.all(this.handlers.map(i=>sz(async()=>{if(!i.ignoreCustomEvent)try{await i.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${e}`),i.raiseError)throw e}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(t=[],r=!0){let i=new e(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);i.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);i.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);i.addMetadata({[e]:this.metadata[e]},t)}for(let e of t)i.handlers.filter(e=>"console_callback_handler"===e.name).some(t=>t.name===e.name)||i.addHandler(e,r);return i}static fromHandlers(e){class t extends ac{name=ao();constructor(){super(),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static configure(e,t,r,i,n,a,s){return this._configureSync(e,t,r,i,n,a,s)}static _configureSync(t,r,i,n,a,s,o){var l;let u;(t||r)&&(Array.isArray(t)||!t?(u=new e).setHandlers(t?.map(sX)??[],!0):u=t,u=u.copy(Array.isArray(r)?r.map(sX):r?.handlers,!1));let c="true"===iP("LANGCHAIN_VERBOSE")||o?.verbose,d=s$.getTraceableRunTree()?.tracingEnabled||(void 0!==l?l:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>"true"===iP(e))),h=d||(iP("LANGCHAIN_TRACING")??!1);if(c||h){if(u||(u=new e),c&&!u.handlers.some(e=>e.name===sS.prototype.name)){let e=new sS;u.addHandler(e,!0)}if(h&&!u.handlers.some(e=>"langchain_tracer"===e.name)&&d){let e=new s$;u.addHandler(e,!0)}if(d){let e=s$.getTraceableRunTree();if(e&&void 0===u._parentRunId){u._parentRunId=e.id;let t=u.handlers.find(e=>"langchain_tracer"===e.name);t?.updateFromRunTree(e)}}}for(let{contextVar:t,inheritable:r=!0,handlerClass:i,envVar:n}of sB(sZ)||[]){let a,s=n&&"true"===iP(n)&&i,o=void 0!==t?sB(t):void 0;o&&ad(o)?a=o:s&&(a=new i({})),void 0!==a&&(u||(u=new e),u.handlers.some(e=>e.name===a.name)||u.addHandler(a,r))}return(i||n)&&u&&(u.addTags(i??[]),u.addTags(n??[],!1)),(a||s)&&u&&(u.addMetadata(a??{}),u.addMetadata(s??{},!1)),u}};function sX(e){return"name"in e?e:ac.fromMethods(e)}var sQ=class{getStore(){}run(e,t){return t()}enterWith(e){}};let s0=new sQ,s1=Symbol.for("lc:child_config"),s4=new class{getInstance(){return sP()??s0}getRunnableConfig(){let e=this.getInstance();return e.getStore()?.extra?.[s1]}runWithConfig(e,t,r){let i,n=sY._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),a=this.getInstance(),s=a.getStore(),o=n?.getParentRunId(),l=n?.handlers?.find(e=>e?.name==="langchain_tracer");return l&&o?i=l.getRunTreeWithTracingConfig(o):r||(i=new sl({name:"<runnable_lambda>",tracingEnabled:!1})),i&&(i.extra={...i.extra,[s1]:e}),void 0!==s&&void 0!==s[sN]&&(void 0===i&&(i={}),i[sN]=s[sN]),a.run(i,t)}initializeGlobalInstance(e){void 0===sP()&&(globalThis[sC]=e)}};async function s2(e){return sY._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function s6(...e){let t={};for(let r of e.filter(e=>!!e))for(let e of Object.keys(r))if("metadata"===e)t[e]={...t[e],...r[e]};else if("tags"===e){let i=t[e]??[];t[e]=[...new Set(i.concat(r[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...r[e]};else if("timeout"===e)void 0===t.timeout?t.timeout=r.timeout:void 0!==r.timeout&&(t.timeout=Math.min(t.timeout,r.timeout));else if("signal"===e)void 0===t.signal?t.signal=r.signal:void 0!==r.signal&&("any"in AbortSignal?t.signal=AbortSignal.any([t.signal,r.signal]):t.signal=r.signal);else if("callbacks"===e){let e=t.callbacks,i=r.callbacks;if(Array.isArray(i))if(e)if(Array.isArray(e))t.callbacks=e.concat(i);else{let r=e.copy();for(let e of i)r.addHandler(sX(e),!0);t.callbacks=r}else t.callbacks=i;else if(i)if(e)if(Array.isArray(e)){let r=i.copy();for(let t of e)r.addHandler(sX(t),!0);t.callbacks=r}else t.callbacks=new sY(i._parentRunId,{handlers:e.handlers.concat(i.handlers),inheritableHandlers:e.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(i.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(i.inheritableTags))),metadata:{...e.metadata,...i.metadata}});else t.callbacks=i}else t[e]=r[e]??t[e];return t}iI({},{AsyncLocalStorageProviderSingleton:()=>s4,MockAsyncLocalStorage:()=>sQ,_CONTEXT_VARIABLES_KEY:()=>sN});let s9=new Set(["string","number","boolean"]);function s3(e){let t=s4.getRunnableConfig(),r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){let{runId:e,runName:i,...n}=t;r=Object.entries(n).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)}if(e&&(r=Object.entries(e).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)),r?.configurable)for(let e of Object.keys(r.configurable))s9.has(typeof r.configurable[e])&&!r.metadata?.[e]&&(r.metadata||(r.metadata={}),r.metadata[e]=r.configurable[e]);if(void 0!==r.timeout){if(r.timeout<=0)throw Error("Timeout must be a positive number");let e=AbortSignal.timeout(r.timeout);void 0!==r.signal?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,e])):r.signal=e,delete r.timeout}return r}function s5(e={},{callbacks:t,maxConcurrency:r,recursionLimit:i,runName:n,configurable:a,runId:s}={}){let o=s3(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==i&&(o.recursionLimit=i),void 0!==r&&(o.maxConcurrency=r),void 0!==n&&(o.runName=n),void 0!==a&&(o.configurable={...o.configurable,...a}),void 0!==s&&delete o.runId,o}function s8(e){if(e)return{configurable:e.configurable,recursionLimit:e.recursionLimit,callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,maxConcurrency:e.maxConcurrency,timeout:e.timeout,signal:e.signal,store:e.store}}async function s7(e,t){let r;return void 0===t?e:Promise.race([e.catch(e=>{if(!t?.aborted)throw e}),new Promise((e,i)=>{r=()=>{i(oe(t))},t.addEventListener("abort",r),t.aborted&&i(oe(t))})]).finally(()=>t.removeEventListener("abort",r))}function oe(e){return e?.reason instanceof Error?e.reason:"string"==typeof e?.reason?Error(e.reason):Error("Aborted")}iI({},{AsyncGeneratorWithSetup:()=>on,IterableReadableStream:()=>ot,atee:()=>or,concat:()=>oi,pipeGeneratorWithSetup:()=>oa});var ot=class e extends ReadableStream{reader;ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();if(e.done)return this.reader.releaseLock(),{done:!0,value:void 0};return{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}static fromReadableStream(t){let r=t.getReader();return new e({start:e=>(function t(){return r.read().then(({done:r,value:i})=>r?void e.close():(e.enqueue(i),t()))})(),cancel(){r.releaseLock()}})}static fromAsyncGenerator(t){return new e({async pull(e){let{value:r,done:i}=await t.next();i&&e.close(),e.enqueue(r)},async cancel(e){await t.return(e)}})}};function or(e,t=2){let r=Array.from({length:t},()=>[]);return r.map(async function*(t){for(;;)if(0===t.length){let t=await e.next();for(let e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}})}function oi(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){let r={...e};for(let[e,i]of Object.entries(t))e in r&&!Array.isArray(r[e])?r[e]=oi(r[e],i):r[e]=i;return r}else throw Error(`Cannot concat ${typeof e} and ${typeof t}`)}var on=class{generator;setup;config;signal;firstResult;firstResultUsed=!1;constructor(e){this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{s4.runWithConfig(s8(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(e=>t(void 0),r)},!0)})}async next(...e){return(this.signal?.throwIfAborted(),this.firstResultUsed)?s4.runWithConfig(s8(this.config),this.signal?async()=>s7(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}};async function oa(e,t,r,i,...n){let a=new on({generator:t,startSetup:r,signal:i}),s=await a.setup;return{output:e(a,s,...n),setup:s}}iI({},{ChatGenerationChunk:()=>ol,GenerationChunk:()=>oo,RUN_KEY:()=>os});let os="__run";var oo=class e{text;generationInfo;constructor(e){this.text=e.text,this.generationInfo=e.generationInfo}concat(t){return new e({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo}})}},ol=class e extends oo{message;constructor(e){super(e),this.message=e.message}concat(t){return new e({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo},message:this.message.concat(t.message)})}};function ou(e,t,r){function i(r,i){var n;for(let a in Object.defineProperty(r,"_zod",{value:r._zod??{},enumerable:!1}),(n=r._zod).traits??(n.traits=new Set),r._zod.traits.add(e),t(r,i),s.prototype)a in r||Object.defineProperty(r,a,{value:s.prototype[a].bind(r)});r._zod.constr=s,r._zod.def=i}let n=r?.Parent??Object;class a extends n{}function s(e){var t;let n=r?.Parent?new a:this;for(let r of(i(n,e),(t=n._zod).deferred??(t.deferred=[]),n._zod.deferred))r();return n}return Object.defineProperty(a,"name",{value:e}),Object.defineProperty(s,"init",{value:i}),Object.defineProperty(s,Symbol.hasInstance,{value:t=>!!r?.Parent&&t instanceof r.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(s,"name",{value:e}),s}let oc=Symbol("zod_brand");class od extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}let oh={};function op(e){return e&&Object.assign(oh,e),oh}function of(e){return e}function om(e){return e}function og(e){}function oy(e){throw Error()}function o_(e){}function ov(e){let t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,r])=>-1===t.indexOf(+e)).map(([e,t])=>t)}function ob(e,t="|"){return e.map(e=>oZ(e)).join(t)}function ow(e,t){return"bigint"==typeof t?t.toString():t}function oE(e){return{get value(){{let t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function oT(e){return null==e}function oS(e){let t=+!!e.startsWith("^"),r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function oI(e,t){let r=(e.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,n=r>i?r:i;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}function oO(e,t,r){Object.defineProperty(e,t,{get(){{let i=r();return e[t]=i,i}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function oA(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function ok(e,t){return t?t.reduce((e,t)=>e?.[t],e):e}function ox(e){let t=Object.keys(e);return Promise.all(t.map(t=>e[t])).then(e=>{let r={};for(let i=0;i<t.length;i++)r[t[i]]=e[i];return r})}function o$(e=10){let t="abcdefghijklmnopqrstuvwxyz",r="";for(let i=0;i<e;i++)r+=t[Math.floor(Math.random()*t.length)];return r}function oC(e){return JSON.stringify(e)}e.s(["$ZodAsyncError",()=>od,"$brand",0,oc,"$constructor",()=>ou,"config",()=>op,"globalConfig",0,oh],779192);let oN=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function oP(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}let oR=oE(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(e){return!1}});function oj(e){if(!1===oP(e))return!1;let t=e.constructor;if(void 0===t)return!0;let r=t.prototype;return!1!==oP(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}function oU(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}let oL=new Set(["string","number","symbol"]),oD=new Set(["string","number","bigint","boolean","symbol","undefined"]);function oM(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function oz(e,t,r){let i=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(i._zod.parent=e),i}function oF(e){if(!e)return{};if("string"==typeof e)return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");e.error=e.message}return(delete e.message,"string"==typeof e.error)?{...e,error:()=>e.error}:e}function oB(e){let t;return new Proxy({},{get:(r,i,n)=>(t??(t=e()),Reflect.get(t,i,n)),set:(r,i,n,a)=>(t??(t=e()),Reflect.set(t,i,n,a)),has:(r,i)=>(t??(t=e()),Reflect.has(t,i)),deleteProperty:(r,i)=>(t??(t=e()),Reflect.deleteProperty(t,i)),ownKeys:r=>(t??(t=e()),Reflect.ownKeys(t)),getOwnPropertyDescriptor:(r,i)=>(t??(t=e()),Reflect.getOwnPropertyDescriptor(t,i)),defineProperty:(r,i,n)=>(t??(t=e()),Reflect.defineProperty(t,i,n))})}function oZ(e){return"bigint"==typeof e?e.toString()+"n":"string"==typeof e?`"${e}"`:`${e}`}function oG(e){return Object.keys(e).filter(t=>"optional"===e[t]._zod.optin&&"optional"===e[t]._zod.optout)}let oH={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},oq={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function oW(e,t){let r={},i=e._zod.def;for(let e in t){if(!(e in i.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&(r[e]=i.shape[e])}return oz(e,{...e._zod.def,shape:r,checks:[]})}function oK(e,t){let r={...e._zod.def.shape},i=e._zod.def;for(let e in t){if(!(e in i.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&delete r[e]}return oz(e,{...e._zod.def,shape:r,checks:[]})}function oJ(e,t){let r={...e._zod.def,get shape(){let r={...e._zod.def.shape,...t};return oA(this,"shape",r),r},checks:[]};return oz(e,r)}function oV(e,t){return oz(e,{...e._zod.def,get shape(){let r={...e._zod.def.shape,...t._zod.def.shape};return oA(this,"shape",r),r},catchall:t._zod.def.catchall,checks:[]})}function oY(e,t,r){let i=t._zod.def.shape,n={...i};if(r)for(let t in r){if(!(t in i))throw Error(`Unrecognized key: "${t}"`);r[t]&&(n[t]=e?new e({type:"optional",innerType:i[t]}):i[t])}else for(let t in i)n[t]=e?new e({type:"optional",innerType:i[t]}):i[t];return oz(t,{...t._zod.def,shape:n,checks:[]})}function oX(e,t,r){let i=t._zod.def.shape,n={...i};if(r)for(let t in r){if(!(t in n))throw Error(`Unrecognized key: "${t}"`);r[t]&&(n[t]=new e({type:"nonoptional",innerType:i[t]}))}else for(let t in i)n[t]=new e({type:"nonoptional",innerType:i[t]});return oz(t,{...t._zod.def,shape:n,checks:[]})}function oQ(e,t=0){for(let r=t;r<e.issues.length;r++)if(!0!==e.issues[r].continue)return!0;return!1}function o0(e,t){return t.map(t=>(t.path??(t.path=[]),t.path.unshift(e),t))}function o1(e){return"string"==typeof e?e:e?.message}function o4(e,t,r){let i={...e,path:e.path??[]};return e.message||(i.message=o1(e.inst?._zod.def?.error?.(e))??o1(t?.error?.(e))??o1(r.customError?.(e))??o1(r.localeError?.(e))??"Invalid input"),delete i.inst,delete i.continue,t?.reportInput||delete i.input,i}function o2(e){return e instanceof Set?"set":e instanceof Map?"map":e instanceof File?"file":"unknown"}function o6(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function o9(...e){let[t,r,i]=e;return"string"==typeof t?{message:t,code:"custom",input:r,inst:i}:{...t}}function o3(e){return Object.entries(e).filter(([e,t])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}class o5{constructor(...e){}}e.s(["BIGINT_FORMAT_RANGES",0,oq,"Class",()=>o5,"NUMBER_FORMAT_RANGES",0,oH,"aborted",()=>oQ,"allowsEval",0,oR,"assert",()=>o_,"assertEqual",()=>of,"assertIs",()=>og,"assertNever",()=>oy,"assertNotEqual",()=>om,"assignProp",()=>oA,"cached",()=>oE,"captureStackTrace",0,oN,"cleanEnum",()=>o3,"cleanRegex",()=>oS,"clone",()=>oz,"createTransparentProxy",()=>oB,"defineLazy",()=>oO,"esc",()=>oC,"escapeRegex",()=>oM,"extend",()=>oJ,"finalizeIssue",()=>o4,"floatSafeRemainder",()=>oI,"getElementAtPath",()=>ok,"getEnumValues",()=>ov,"getLengthableOrigin",()=>o6,"getParsedType",0,e=>{let t=typeof e;switch(t){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(e)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return"promise";if("undefined"!=typeof Map&&e instanceof Map)return"map";if("undefined"!=typeof Set&&e instanceof Set)return"set";if("undefined"!=typeof Date&&e instanceof Date)return"date";if("undefined"!=typeof File&&e instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${t}`)}},"getSizableOrigin",()=>o2,"isObject",()=>oP,"isPlainObject",()=>oj,"issue",()=>o9,"joinValues",()=>ob,"jsonStringifyReplacer",()=>ow,"merge",()=>oV,"normalizeParams",()=>oF,"nullish",()=>oT,"numKeys",()=>oU,"omit",()=>oK,"optionalKeys",()=>oG,"partial",()=>oY,"pick",()=>oW,"prefixIssues",()=>o0,"primitiveTypes",0,oD,"promiseAllObject",()=>ox,"propertyKeyTypes",0,oL,"randomString",()=>o$,"required",()=>oX,"stringifyPrimitive",()=>oZ,"unwrapMessage",()=>o1],596309);let o8=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,ow,2),enumerable:!0})},o7=ou("$ZodError",o8),le=ou("$ZodError",o8,{Parent:Error});function lt(e,t=e=>e.message){let r={},i=[];for(let n of e.issues)n.path.length>0?(r[n.path[0]]=r[n.path[0]]||[],r[n.path[0]].push(t(n))):i.push(t(n));return{formErrors:i,fieldErrors:r}}function lr(e,t){let r=t||function(e){return e.message},i={_errors:[]},n=e=>{for(let t of e.issues)if("invalid_union"===t.code&&t.errors.length)t.errors.map(e=>n({issues:e}));else if("invalid_key"===t.code)n({issues:t.issues});else if("invalid_element"===t.code)n({issues:t.issues});else if(0===t.path.length)i._errors.push(r(t));else{let e=i,n=0;for(;n<t.path.length;){let i=t.path[n];n===t.path.length-1?(e[i]=e[i]||{_errors:[]},e[i]._errors.push(r(t))):e[i]=e[i]||{_errors:[]},e=e[i],n++}}};return n(e),i}function li(e,t){let r=t||function(e){return e.message},i={errors:[]},n=(e,t=[])=>{var a,s;for(let o of e.issues)if("invalid_union"===o.code&&o.errors.length)o.errors.map(e=>n({issues:e},o.path));else if("invalid_key"===o.code)n({issues:o.issues},o.path);else if("invalid_element"===o.code)n({issues:o.issues},o.path);else{let e=[...t,...o.path];if(0===e.length){i.errors.push(r(o));continue}let n=i,l=0;for(;l<e.length;){let t=e[l],i=l===e.length-1;"string"==typeof t?(n.properties??(n.properties={}),(a=n.properties)[t]??(a[t]={errors:[]}),n=n.properties[t]):(n.items??(n.items=[]),(s=n.items)[t]??(s[t]={errors:[]}),n=n.items[t]),i&&n.errors.push(r(o)),l++}}};return n(e),i}function ln(e){let t=[];for(let r of e)"number"==typeof r?t.push(`[${r}]`):"symbol"==typeof r?t.push(`[${JSON.stringify(String(r))}]`):/[^\w$]/.test(r)?t.push(`[${JSON.stringify(r)}]`):(t.length&&t.push("."),t.push(r));return t.join("")}function la(e){let t=[];for(let r of[...e.issues].sort((e,t)=>e.path.length-t.path.length))t.push(` ${r.message}`),r.path?.length&&t.push(`   at ${ln(r.path)}`);return t.join("\n")}e.s(["$ZodError",0,o7,"$ZodRealError",0,le,"flattenError",()=>lt,"formatError",()=>lr,"prettifyError",()=>la,"toDotPath",()=>ln,"treeifyError",()=>li],545731);let ls=e=>(t,r,i,n)=>{let a=i?Object.assign(i,{async:!1}):{async:!1},s=t._zod.run({value:r,issues:[]},a);if(s instanceof Promise)throw new od;if(s.issues.length){let t=new(n?.Err??e)(s.issues.map(e=>o4(e,a,op())));throw oN(t,n?.callee),t}return s.value},lo=ls(le),ll=e=>async(t,r,i,n)=>{let a=i?Object.assign(i,{async:!0}):{async:!0},s=t._zod.run({value:r,issues:[]},a);if(s instanceof Promise&&(s=await s),s.issues.length){let t=new(n?.Err??e)(s.issues.map(e=>o4(e,a,op())));throw oN(t,n?.callee),t}return s.value},lu=ll(le),lc=e=>(t,r,i)=>{let n=i?{...i,async:!1}:{async:!1},a=t._zod.run({value:r,issues:[]},n);if(a instanceof Promise)throw new od;return a.issues.length?{success:!1,error:new(e??o7)(a.issues.map(e=>o4(e,n,op())))}:{success:!0,data:a.value}},ld=lc(le),lh=e=>async(t,r,i)=>{let n=i?Object.assign(i,{async:!0}):{async:!0},a=t._zod.run({value:r,issues:[]},n);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new e(a.issues.map(e=>o4(e,n,op())))}:{success:!0,data:a.value}},lp=lh(le);e.s(["_parse",0,ls,"_parseAsync",0,ll,"_safeParse",0,lc,"_safeParseAsync",0,lh,"parse",0,lo,"parseAsync",0,lu,"safeParse",0,ld,"safeParseAsync",0,lp],744213);let lf=/^[cC][^\s-]{8,}$/,lm=/^[0-9a-z]+$/,lg=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,ly=/^[0-9a-vA-V]{20}$/,l_=/^[A-Za-z0-9]{27}$/,lv=/^[a-zA-Z0-9_-]{21}$/,lb=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,lw=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,lE=e=>e?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,lT=lE(4),lS=lE(6),lI=lE(7),lO=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,lA="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function lk(){return RegExp(lA,"u")}let lx=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,l$=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,lC=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,lN=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,lP=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,lR=/^[A-Za-z0-9_-]*$/,lj=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,lU=/^\+(?:[0-9]){6,14}[0-9]$/,lL="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",lD=RegExp(`^${lL}$`);function lM(e){let t="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof e.precision?-1===e.precision?`${t}`:0===e.precision?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function lz(e){return RegExp(`^${lM(e)}$`)}function lF(e){let t=lM({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-]\\d{2}:\\d{2})");let i=`${t}(?:${r.join("|")})`;return RegExp(`^${lL}T(?:${i})$`)}let lB=e=>{let t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${t}$`)},lZ=/^\d+n?$/,lG=/^\d+$/,lH=/^-?\d+(?:\.\d+)?/i,lq=/true|false/i,lW=/null/i,lK=/undefined/i,lJ=/^[^A-Z]*$/,lV=/^[^a-z]*$/;e.s(["_emoji",0,lA,"base64",0,lP,"base64url",0,lR,"bigint",0,lZ,"boolean",0,lq,"browserEmail",0,/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,"cidrv4",0,lC,"cidrv6",0,lN,"cuid",0,lf,"cuid2",0,lm,"date",0,lD,"datetime",()=>lF,"domain",0,/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,"duration",0,lb,"e164",0,lU,"email",0,lO,"emoji",()=>lk,"extendedDuration",0,/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,"guid",0,lw,"hostname",0,lj,"html5Email",0,/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,"integer",0,lG,"ipv4",0,lx,"ipv6",0,l$,"ksuid",0,l_,"lowercase",0,lJ,"nanoid",0,lv,"null",()=>lW,"number",0,lH,"rfc5322Email",0,/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,"string",0,lB,"time",()=>lz,"ulid",0,lg,"undefined",()=>lK,"unicodeEmail",0,/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,"uppercase",0,lV,"uuid",0,lE,"uuid4",0,lT,"uuid6",0,lS,"uuid7",0,lI,"xid",0,ly],916714);let lY=ou("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),lX={number:"number",bigint:"bigint",object:"date"},lQ=ou("$ZodCheckLessThan",(e,t)=>{lY.init(e,t);let r=lX[typeof t.value];e._zod.onattach.push(e=>{let r=e._zod.bag,i=(t.inclusive?r.maximum:r.exclusiveMaximum)??1/0;t.value<i&&(t.inclusive?r.maximum=t.value:r.exclusiveMaximum=t.value)}),e._zod.check=i=>{(t.inclusive?i.value<=t.value:i.value<t.value)||i.issues.push({origin:r,code:"too_big",maximum:t.value,input:i.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),l0=ou("$ZodCheckGreaterThan",(e,t)=>{lY.init(e,t);let r=lX[typeof t.value];e._zod.onattach.push(e=>{let r=e._zod.bag,i=(t.inclusive?r.minimum:r.exclusiveMinimum)??-1/0;t.value>i&&(t.inclusive?r.minimum=t.value:r.exclusiveMinimum=t.value)}),e._zod.check=i=>{(t.inclusive?i.value>=t.value:i.value>t.value)||i.issues.push({origin:r,code:"too_small",minimum:t.value,input:i.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),l1=ou("$ZodCheckMultipleOf",(e,t)=>{lY.init(e,t),e._zod.onattach.push(e=>{var r;(r=e._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof r.value?r.value%t.value===BigInt(0):0===oI(r.value,t.value))||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),l4=ou("$ZodCheckNumberFormat",(e,t)=>{lY.init(e,t),t.format=t.format||"float64";let r=t.format?.includes("int"),i=r?"int":"number",[n,a]=oH[t.format];e._zod.onattach.push(e=>{let i=e._zod.bag;i.format=t.format,i.minimum=n,i.maximum=a,r&&(i.pattern=lG)}),e._zod.check=s=>{let o=s.value;if(r){if(!Number.isInteger(o))return void s.issues.push({expected:i,format:t.format,code:"invalid_type",input:o,inst:e});if(!Number.isSafeInteger(o))return void(o>0?s.issues.push({input:o,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:i,continue:!t.abort}):s.issues.push({input:o,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:i,continue:!t.abort}))}o<n&&s.issues.push({origin:"number",input:o,code:"too_small",minimum:n,inclusive:!0,inst:e,continue:!t.abort}),o>a&&s.issues.push({origin:"number",input:o,code:"too_big",maximum:a,inst:e})}}),l2=ou("$ZodCheckBigIntFormat",(e,t)=>{lY.init(e,t);let[r,i]=oq[t.format];e._zod.onattach.push(e=>{let n=e._zod.bag;n.format=t.format,n.minimum=r,n.maximum=i}),e._zod.check=n=>{let a=n.value;a<r&&n.issues.push({origin:"bigint",input:a,code:"too_small",minimum:r,inclusive:!0,inst:e,continue:!t.abort}),a>i&&n.issues.push({origin:"bigint",input:a,code:"too_big",maximum:i,inst:e})}}),l6=ou("$ZodCheckMaxSize",(e,t)=>{lY.init(e,t),e._zod.when=e=>{let t=e.value;return!oT(t)&&void 0!==t.size},e._zod.onattach.push(e=>{let r=e._zod.bag.maximum??1/0;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{let i=r.value;i.size<=t.maximum||r.issues.push({origin:o2(i),code:"too_big",maximum:t.maximum,input:i,inst:e,continue:!t.abort})}}),l9=ou("$ZodCheckMinSize",(e,t)=>{lY.init(e,t),e._zod.when=e=>{let t=e.value;return!oT(t)&&void 0!==t.size},e._zod.onattach.push(e=>{let r=e._zod.bag.minimum??-1/0;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{let i=r.value;i.size>=t.minimum||r.issues.push({origin:o2(i),code:"too_small",minimum:t.minimum,input:i,inst:e,continue:!t.abort})}}),l3=ou("$ZodCheckSizeEquals",(e,t)=>{lY.init(e,t),e._zod.when=e=>{let t=e.value;return!oT(t)&&void 0!==t.size},e._zod.onattach.push(e=>{let r=e._zod.bag;r.minimum=t.size,r.maximum=t.size,r.size=t.size}),e._zod.check=r=>{let i=r.value,n=i.size;if(n===t.size)return;let a=n>t.size;r.issues.push({origin:o2(i),...a?{code:"too_big",maximum:t.size}:{code:"too_small",minimum:t.size},input:r.value,inst:e,continue:!t.abort})}}),l5=ou("$ZodCheckMaxLength",(e,t)=>{lY.init(e,t),e._zod.when=e=>{let t=e.value;return!oT(t)&&void 0!==t.length},e._zod.onattach.push(e=>{let r=e._zod.bag.maximum??1/0;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{let i=r.value;if(i.length<=t.maximum)return;let n=o6(i);r.issues.push({origin:n,code:"too_big",maximum:t.maximum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),l8=ou("$ZodCheckMinLength",(e,t)=>{lY.init(e,t),e._zod.when=e=>{let t=e.value;return!oT(t)&&void 0!==t.length},e._zod.onattach.push(e=>{let r=e._zod.bag.minimum??-1/0;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{let i=r.value;if(i.length>=t.minimum)return;let n=o6(i);r.issues.push({origin:n,code:"too_small",minimum:t.minimum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),l7=ou("$ZodCheckLengthEquals",(e,t)=>{lY.init(e,t),e._zod.when=e=>{let t=e.value;return!oT(t)&&void 0!==t.length},e._zod.onattach.push(e=>{let r=e._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=r=>{let i=r.value,n=i.length;if(n===t.length)return;let a=o6(i),s=n>t.length;r.issues.push({origin:a,...s?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},input:r.value,inst:e,continue:!t.abort})}}),ue=ou("$ZodCheckStringFormat",(e,t)=>{var r;lY.init(e,t),e._zod.onattach.push(e=>{let r=e._zod.bag;r.format=t.format,t.pattern&&(r.patterns??(r.patterns=new Set),r.patterns.add(t.pattern))}),(r=e._zod).check??(r.check=r=>{if(!t.pattern)throw Error("Not implemented.");t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})})}),ut=ou("$ZodCheckRegex",(e,t)=>{ue.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),ur=ou("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=lJ),ue.init(e,t)}),ui=ou("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=lV),ue.init(e,t)}),un=ou("$ZodCheckIncludes",(e,t)=>{lY.init(e,t);let r=oM(t.includes),i=new RegExp("number"==typeof t.position?`^.{${t.position}}${r}`:r);t.pattern=i,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(i)}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),ua=ou("$ZodCheckStartsWith",(e,t)=>{lY.init(e,t);let r=RegExp(`^${oM(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),us=ou("$ZodCheckEndsWith",(e,t)=>{lY.init(e,t);let r=RegExp(`.*${oM(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}});function uo(e,t,r){e.issues.length&&t.issues.push(...o0(r,e.issues))}let ul=ou("$ZodCheckProperty",(e,t)=>{lY.init(e,t),e._zod.check=e=>{let r=t.schema._zod.run({value:e.value[t.property],issues:[]},{});if(r instanceof Promise)return r.then(r=>uo(r,e,t.property));uo(r,e,t.property)}}),uu=ou("$ZodCheckMimeType",(e,t)=>{lY.init(e,t);let r=new Set(t.mime);e._zod.onattach.push(e=>{e._zod.bag.mime=t.mime}),e._zod.check=i=>{r.has(i.value.type)||i.issues.push({code:"invalid_value",values:t.mime,input:i.value.type,inst:e})}}),uc=ou("$ZodCheckOverwrite",(e,t)=>{lY.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});e.s(["$ZodCheck",0,lY,"$ZodCheckBigIntFormat",0,l2,"$ZodCheckEndsWith",0,us,"$ZodCheckGreaterThan",0,l0,"$ZodCheckIncludes",0,un,"$ZodCheckLengthEquals",0,l7,"$ZodCheckLessThan",0,lQ,"$ZodCheckLowerCase",0,ur,"$ZodCheckMaxLength",0,l5,"$ZodCheckMaxSize",0,l6,"$ZodCheckMimeType",0,uu,"$ZodCheckMinLength",0,l8,"$ZodCheckMinSize",0,l9,"$ZodCheckMultipleOf",0,l1,"$ZodCheckNumberFormat",0,l4,"$ZodCheckOverwrite",0,uc,"$ZodCheckProperty",0,ul,"$ZodCheckRegex",0,ut,"$ZodCheckSizeEquals",0,l3,"$ZodCheckStartsWith",0,ua,"$ZodCheckStringFormat",0,ue,"$ZodCheckUpperCase",0,ui],727412);class ud{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let t=e.split("\n").filter(e=>e),r=Math.min(...t.map(e=>e.length-e.trimStart().length));for(let e of t.map(e=>e.slice(r)).map(e=>" ".repeat(2*this.indent)+e))this.content.push(e)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(e=>`  ${e}`)].join("\n"))}}e.s(["Doc",()=>ud],748059);let uh={major:4,minor:0,patch:0};e.s(["version",0,uh],248380);let up=ou("$ZodType",(e,t)=>{var r;e??(e={}),oO(e._zod,"id",()=>t.type+"_"+o$(10)),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=uh;let i=[...e._zod.def.checks??[]];for(let t of(e._zod.traits.has("$ZodCheck")&&i.unshift(e),i))for(let r of t._zod.onattach)r(e);if(0===i.length)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,r)=>{let i,n=oQ(e);for(let a of t){if(a._zod.when){if(!a._zod.when(e))continue}else if(n)continue;let t=e.issues.length,s=a._zod.check(e);if(s instanceof Promise&&r?.async===!1)throw new od;if(i||s instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await s,e.issues.length!==t&&(n||(n=oQ(e,t)))});else{if(e.issues.length===t)continue;n||(n=oQ(e,t))}}return i?i.then(()=>e):e};e._zod.run=(r,n)=>{let a=e._zod.parse(r,n);if(a instanceof Promise){if(!1===n.async)throw new od;return a.then(e=>t(e,i,n))}return t(a,i,n)}}e["~standard"]={validate:t=>{try{let r=ld(e,t);return r.success?{value:r.data}:{issues:r.error?.issues}}catch(r){return lp(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}}),uf=ou("$ZodString",(e,t)=>{up.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??lB(e._zod.bag),e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=String(r.value)}catch(e){}return"string"==typeof r.value||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),um=ou("$ZodStringFormat",(e,t)=>{ue.init(e,t),uf.init(e,t)}),ug=ou("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=lw),um.init(e,t)}),uy=ou("$ZodUUID",(e,t)=>{if(t.version){let e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(void 0===e)throw Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=lE(e))}else t.pattern??(t.pattern=lE());um.init(e,t)}),u_=ou("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=lO),um.init(e,t)}),uv=ou("$ZodURL",(e,t)=>{um.init(e,t),e._zod.check=r=>{try{let i=new URL(r.value);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(i.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:lj.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort}));return}catch(i){r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),ub=ou("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=lk()),um.init(e,t)}),uw=ou("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=lv),um.init(e,t)}),uE=ou("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=lf),um.init(e,t)}),uT=ou("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=lm),um.init(e,t)}),uS=ou("$ZodULID",(e,t)=>{t.pattern??(t.pattern=lg),um.init(e,t)}),uI=ou("$ZodXID",(e,t)=>{t.pattern??(t.pattern=ly),um.init(e,t)}),uO=ou("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=l_),um.init(e,t)}),uA=ou("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=lF(t)),um.init(e,t),e._zod.check}),uk=ou("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=lD),um.init(e,t)}),ux=ou("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=lz(t)),um.init(e,t),e._zod.check}),u$=ou("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=lb),um.init(e,t)}),uC=ou("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=lx),um.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv4"})}),uN=ou("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=l$),um.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),uP=ou("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=lC),um.init(e,t)}),uR=ou("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=lN),um.init(e,t),e._zod.check=r=>{let[i,n]=r.value.split("/");try{if(!n)throw Error();let e=Number(n);if(`${e}`!==n||e<0||e>128)throw Error();new URL(`http://[${i}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function uj(e){if(""===e)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}let uU=ou("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=lP),um.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{uj(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function uL(e){if(!lR.test(e))return!1;let t=e.replace(/[-_]/g,e=>"-"===e?"+":"/");return uj(t.padEnd(4*Math.ceil(t.length/4),"="))}let uD=ou("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=lR),um.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{uL(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),uM=ou("$ZodE164",(e,t)=>{t.pattern??(t.pattern=lU),um.init(e,t)});function uz(e,t=null){try{let r=e.split(".");if(3!==r.length)return!1;let[i]=r,n=JSON.parse(atob(i));if("typ"in n&&n?.typ!=="JWT"||!n.alg||t&&(!("alg"in n)||n.alg!==t))return!1;return!0}catch{return!1}}let uF=ou("$ZodJWT",(e,t)=>{um.init(e,t),e._zod.check=r=>{uz(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),uB=ou("$ZodNumber",(e,t)=>{up.init(e,t),e._zod.pattern=e._zod.bag.pattern??lH,e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=Number(r.value)}catch(e){}let n=r.value;if("number"==typeof n&&!Number.isNaN(n)&&Number.isFinite(n))return r;let a="number"==typeof n?Number.isNaN(n)?"NaN":Number.isFinite(n)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:n,inst:e,...a?{received:a}:{}}),r}}),uZ=ou("$ZodNumber",(e,t)=>{l4.init(e,t),uB.init(e,t)}),uG=ou("$ZodBoolean",(e,t)=>{up.init(e,t),e._zod.pattern=lq,e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=!!r.value}catch(e){}let n=r.value;return"boolean"==typeof n||r.issues.push({expected:"boolean",code:"invalid_type",input:n,inst:e}),r}}),uH=ou("$ZodBigInt",(e,t)=>{up.init(e,t),e._zod.pattern=lZ,e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=BigInt(r.value)}catch(e){}let{value:n}=r;return"bigint"==typeof n||r.issues.push({expected:"bigint",code:"invalid_type",input:n,inst:e}),r}}),uq=ou("$ZodBigInt",(e,t)=>{l2.init(e,t),uH.init(e,t)}),uW=ou("$ZodSymbol",(e,t)=>{up.init(e,t),e._zod.parse=(t,r)=>{let{value:i}=t;return"symbol"==typeof i||t.issues.push({expected:"symbol",code:"invalid_type",input:i,inst:e}),t}}),uK=ou("$ZodUndefined",(e,t)=>{up.init(e,t),e._zod.pattern=lK,e._zod.values=new Set([void 0]),e._zod.parse=(t,r)=>{let{value:i}=t;return void 0===i||t.issues.push({expected:"undefined",code:"invalid_type",input:i,inst:e}),t}}),uJ=ou("$ZodNull",(e,t)=>{up.init(e,t),e._zod.pattern=lW,e._zod.values=new Set([null]),e._zod.parse=(t,r)=>{let{value:i}=t;return null===i||t.issues.push({expected:"null",code:"invalid_type",input:i,inst:e}),t}}),uV=ou("$ZodAny",(e,t)=>{up.init(e,t),e._zod.parse=e=>e}),uY=ou("$ZodUnknown",(e,t)=>{up.init(e,t),e._zod.parse=e=>e}),uX=ou("$ZodNever",(e,t)=>{up.init(e,t),e._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)}),uQ=ou("$ZodVoid",(e,t)=>{up.init(e,t),e._zod.parse=(t,r)=>{let{value:i}=t;return void 0===i||t.issues.push({expected:"void",code:"invalid_type",input:i,inst:e}),t}}),u0=ou("$ZodDate",(e,t)=>{up.init(e,t),e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=new Date(r.value)}catch(e){}let n=r.value,a=n instanceof Date;return a&&!Number.isNaN(n.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:n,...a?{received:"Invalid Date"}:{},inst:e}),r}});function u1(e,t,r){e.issues.length&&t.issues.push(...o0(r,e.issues)),t.value[r]=e.value}let u4=ou("$ZodArray",(e,t)=>{up.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!Array.isArray(n))return r.issues.push({expected:"array",code:"invalid_type",input:n,inst:e}),r;r.value=Array(n.length);let a=[];for(let e=0;e<n.length;e++){let s=n[e],o=t.element._zod.run({value:s,issues:[]},i);o instanceof Promise?a.push(o.then(t=>u1(t,r,e))):u1(o,r,e)}return a.length?Promise.all(a).then(()=>r):r}});function u2(e,t,r){e.issues.length&&t.issues.push(...o0(r,e.issues)),t.value[r]=e.value}function u6(e,t,r,i){e.issues.length?void 0===i[r]?r in i?t.value[r]=void 0:t.value[r]=e.value:t.issues.push(...o0(r,e.issues)):void 0===e.value?r in i&&(t.value[r]=void 0):t.value[r]=e.value}let u9=ou("$ZodObject",(e,t)=>{let r,i;up.init(e,t);let n=oE(()=>{let e=Object.keys(t.shape);for(let r of e)if(!(t.shape[r]instanceof up))throw Error(`Invalid element at key "${r}": expected a Zod schema`);let r=oG(t.shape);return{shape:t.shape,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(r)}});oO(e._zod,"propValues",()=>{let e=t.shape,r={};for(let t in e){let i=e[t]._zod;if(i.values)for(let e of(r[t]??(r[t]=new Set),i.values))r[t].add(e)}return r});let a=!oh.jitless,s=a&&oR.value,{catchall:o}=t;e._zod.parse=(l,u)=>{i??(i=n.value);let c=l.value;if(!oP(c))return l.issues.push({expected:"object",code:"invalid_type",input:c,inst:e}),l;let d=[];if(a&&s&&u?.async===!1&&!0!==u.jitless)r||(r=(e=>{let t=new ud(["shape","payload","ctx"]),{keys:r,optionalKeys:i}=n.value,a=e=>{let t=oC(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");let s=Object.create(null);for(let e of r)s[e]=o$(15);for(let e of(t.write("const newResult = {}"),r))if(i.has(e)){let r=s[e];t.write(`const ${r} = ${a(e)};`);let i=oC(e);t.write(`
        if (${r}.issues.length) {
          if (input[${i}] === undefined) {
            if (${i} in input) {
              newResult[${i}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${r}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${i}, ...iss.path] : [${i}],
              }))
            );
          }
        } else if (${r}.value === undefined) {
          if (${i} in input) newResult[${i}] = undefined;
        } else {
          newResult[${i}] = ${r}.value;
        }
        `)}else{let r=s[e];t.write(`const ${r} = ${a(e)};`),t.write(`
          if (${r}.issues.length) payload.issues = payload.issues.concat(${r}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${oC(e)}, ...iss.path] : [${oC(e)}]
          })));`),t.write(`newResult[${oC(e)}] = ${r}.value`)}t.write("payload.value = newResult;"),t.write("return payload;");let o=t.compile();return(t,r)=>o(e,t,r)})(t.shape)),l=r(l,u);else{l.value={};let e=i.shape;for(let t of i.keys){let r=e[t],i=r._zod.run({value:c[t],issues:[]},u),n="optional"===r._zod.optin&&"optional"===r._zod.optout;i instanceof Promise?d.push(i.then(e=>n?u6(e,l,t,c):u2(e,l,t))):n?u6(i,l,t,c):u2(i,l,t)}}if(!o)return d.length?Promise.all(d).then(()=>l):l;let h=[],p=i.keySet,f=o._zod,m=f.def.type;for(let e of Object.keys(c)){if(p.has(e))continue;if("never"===m){h.push(e);continue}let t=f.run({value:c[e],issues:[]},u);t instanceof Promise?d.push(t.then(t=>u2(t,l,e))):u2(t,l,e)}return(h.length&&l.issues.push({code:"unrecognized_keys",keys:h,input:c,inst:e}),d.length)?Promise.all(d).then(()=>l):l}});function u3(e,t,r,i){for(let r of e)if(0===r.issues.length)return t.value=r.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(e=>e.issues.map(e=>o4(e,i,op())))}),t}let u5=ou("$ZodUnion",(e,t)=>{up.init(e,t),oO(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),oO(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){let e=t.options.map(e=>e._zod.pattern);return RegExp(`^(${e.map(e=>oS(e.source)).join("|")})$`)}}),e._zod.parse=(r,i)=>{let n=!1,a=[];for(let e of t.options){let t=e._zod.run({value:r.value,issues:[]},i);if(t instanceof Promise)a.push(t),n=!0;else{if(0===t.issues.length)return t;a.push(t)}}return n?Promise.all(a).then(t=>u3(t,r,e,i)):u3(a,r,e,i)}}),u8=ou("$ZodDiscriminatedUnion",(e,t)=>{u5.init(e,t);let r=e._zod.parse;oO(e._zod,"propValues",()=>{let e={};for(let r of t.options){let i=r._zod.propValues;if(!i||0===Object.keys(i).length)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(r)}"`);for(let[t,r]of Object.entries(i))for(let i of(e[t]||(e[t]=new Set),r))e[t].add(i)}return e});let i=oE(()=>{let e=t.options,r=new Map;for(let i of e){let e=i._zod.propValues[t.discriminator];if(!e||0===e.size)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(i)}"`);for(let t of e){if(r.has(t))throw Error(`Duplicate discriminator value "${String(t)}"`);r.set(t,i)}}return r});e._zod.parse=(n,a)=>{let s=n.value;if(!oP(s))return n.issues.push({code:"invalid_type",expected:"object",input:s,inst:e}),n;let o=i.value.get(s?.[t.discriminator]);return o?o._zod.run(n,a):t.unionFallback?r(n,a):(n.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:s,path:[t.discriminator],inst:e}),n)}}),u7=ou("$ZodIntersection",(e,t)=>{up.init(e,t),e._zod.parse=(e,r)=>{let{value:i}=e,n=t.left._zod.run({value:i,issues:[]},r),a=t.right._zod.run({value:i,issues:[]},r);return n instanceof Promise||a instanceof Promise?Promise.all([n,a]).then(([t,r])=>ce(e,t,r)):ce(e,n,a)}});function ce(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),oQ(e))return e;let i=function e(t,r){if(t===r||t instanceof Date&&r instanceof Date&&+t==+r)return{valid:!0,data:t};if(oj(t)&&oj(r)){let i=Object.keys(r),n=Object.keys(t).filter(e=>-1!==i.indexOf(e)),a={...t,...r};for(let i of n){let n=e(t[i],r[i]);if(!n.valid)return{valid:!1,mergeErrorPath:[i,...n.mergeErrorPath]};a[i]=n.data}return{valid:!0,data:a}}if(Array.isArray(t)&&Array.isArray(r)){if(t.length!==r.length)return{valid:!1,mergeErrorPath:[]};let i=[];for(let n=0;n<t.length;n++){let a=e(t[n],r[n]);if(!a.valid)return{valid:!1,mergeErrorPath:[n,...a.mergeErrorPath]};i.push(a.data)}return{valid:!0,data:i}}return{valid:!1,mergeErrorPath:[]}}(t.value,r.value);if(!i.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return e.value=i.data,e}let ct=ou("$ZodTuple",(e,t)=>{up.init(e,t);let r=t.items,i=r.length-[...r].reverse().findIndex(e=>"optional"!==e._zod.optin);e._zod.parse=(n,a)=>{let s=n.value;if(!Array.isArray(s))return n.issues.push({input:s,inst:e,expected:"tuple",code:"invalid_type"}),n;n.value=[];let o=[];if(!t.rest){let t=s.length>r.length,a=s.length<i-1;if(t||a)return n.issues.push({input:s,inst:e,origin:"array",...t?{code:"too_big",maximum:r.length}:{code:"too_small",minimum:r.length}}),n}let l=-1;for(let e of r){if(++l>=s.length&&l>=i)continue;let t=e._zod.run({value:s[l],issues:[]},a);t instanceof Promise?o.push(t.then(e=>cr(e,n,l))):cr(t,n,l)}if(t.rest)for(let e of s.slice(r.length)){l++;let r=t.rest._zod.run({value:e,issues:[]},a);r instanceof Promise?o.push(r.then(e=>cr(e,n,l))):cr(r,n,l)}return o.length?Promise.all(o).then(()=>n):n}});function cr(e,t,r){e.issues.length&&t.issues.push(...o0(r,e.issues)),t.value[r]=e.value}let ci=ou("$ZodRecord",(e,t)=>{up.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!oj(n))return r.issues.push({expected:"record",code:"invalid_type",input:n,inst:e}),r;let a=[];if(t.keyType._zod.values){let s,o=t.keyType._zod.values;for(let e of(r.value={},o))if("string"==typeof e||"number"==typeof e||"symbol"==typeof e){let s=t.valueType._zod.run({value:n[e],issues:[]},i);s instanceof Promise?a.push(s.then(t=>{t.issues.length&&r.issues.push(...o0(e,t.issues)),r.value[e]=t.value})):(s.issues.length&&r.issues.push(...o0(e,s.issues)),r.value[e]=s.value)}for(let e in n)o.has(e)||(s=s??[]).push(e);s&&s.length>0&&r.issues.push({code:"unrecognized_keys",input:n,inst:e,keys:s})}else for(let s of(r.value={},Reflect.ownKeys(n))){if("__proto__"===s)continue;let o=t.keyType._zod.run({value:s,issues:[]},i);if(o instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(o.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:o.issues.map(e=>o4(e,i,op())),input:s,path:[s],inst:e}),r.value[o.value]=o.value;continue}let l=t.valueType._zod.run({value:n[s],issues:[]},i);l instanceof Promise?a.push(l.then(e=>{e.issues.length&&r.issues.push(...o0(s,e.issues)),r.value[o.value]=e.value})):(l.issues.length&&r.issues.push(...o0(s,l.issues)),r.value[o.value]=l.value)}return a.length?Promise.all(a).then(()=>r):r}}),cn=ou("$ZodMap",(e,t)=>{up.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!(n instanceof Map))return r.issues.push({expected:"map",code:"invalid_type",input:n,inst:e}),r;let a=[];for(let[s,o]of(r.value=new Map,n)){let l=t.keyType._zod.run({value:s,issues:[]},i),u=t.valueType._zod.run({value:o,issues:[]},i);l instanceof Promise||u instanceof Promise?a.push(Promise.all([l,u]).then(([t,a])=>{ca(t,a,r,s,n,e,i)})):ca(l,u,r,s,n,e,i)}return a.length?Promise.all(a).then(()=>r):r}});function ca(e,t,r,i,n,a,s){e.issues.length&&(oL.has(typeof i)?r.issues.push(...o0(i,e.issues)):r.issues.push({origin:"map",code:"invalid_key",input:n,inst:a,issues:e.issues.map(e=>o4(e,s,op()))})),t.issues.length&&(oL.has(typeof i)?r.issues.push(...o0(i,t.issues)):r.issues.push({origin:"map",code:"invalid_element",input:n,inst:a,key:i,issues:t.issues.map(e=>o4(e,s,op()))})),r.value.set(e.value,t.value)}let cs=ou("$ZodSet",(e,t)=>{up.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!(n instanceof Set))return r.issues.push({input:n,inst:e,expected:"set",code:"invalid_type"}),r;let a=[];for(let e of(r.value=new Set,n)){let n=t.valueType._zod.run({value:e,issues:[]},i);n instanceof Promise?a.push(n.then(e=>co(e,r))):co(n,r)}return a.length?Promise.all(a).then(()=>r):r}});function co(e,t){e.issues.length&&t.issues.push(...e.issues),t.value.add(e.value)}let cl=ou("$ZodEnum",(e,t)=>{up.init(e,t);let r=ov(t.entries);e._zod.values=new Set(r),e._zod.pattern=RegExp(`^(${r.filter(e=>oL.has(typeof e)).map(e=>"string"==typeof e?oM(e):e.toString()).join("|")})$`),e._zod.parse=(t,i)=>{let n=t.value;return e._zod.values.has(n)||t.issues.push({code:"invalid_value",values:r,input:n,inst:e}),t}}),cu=ou("$ZodLiteral",(e,t)=>{up.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=RegExp(`^(${t.values.map(e=>"string"==typeof e?oM(e):e?e.toString():String(e)).join("|")})$`),e._zod.parse=(r,i)=>{let n=r.value;return e._zod.values.has(n)||r.issues.push({code:"invalid_value",values:t.values,input:n,inst:e}),r}}),cc=ou("$ZodFile",(e,t)=>{up.init(e,t),e._zod.parse=(t,r)=>{let i=t.value;return i instanceof File||t.issues.push({expected:"file",code:"invalid_type",input:i,inst:e}),t}}),cd=ou("$ZodTransform",(e,t)=>{up.init(e,t),e._zod.parse=(e,r)=>{let i=t.transform(e.value,e);if(r.async)return(i instanceof Promise?i:Promise.resolve(i)).then(t=>(e.value=t,e));if(i instanceof Promise)throw new od;return e.value=i,e}}),ch=ou("$ZodOptional",(e,t)=>{up.init(e,t),e._zod.optin="optional",e._zod.optout="optional",oO(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),oO(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${oS(e.source)})?$`):void 0}),e._zod.parse=(e,r)=>void 0===e.value?e:t.innerType._zod.run(e,r)}),cp=ou("$ZodNullable",(e,t)=>{up.init(e,t),oO(e._zod,"optin",()=>t.innerType._zod.optin),oO(e._zod,"optout",()=>t.innerType._zod.optout),oO(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${oS(e.source)}|null)$`):void 0}),oO(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,r)=>null===e.value?e:t.innerType._zod.run(e,r)}),cf=ou("$ZodDefault",(e,t)=>{up.init(e,t),e._zod.optin="optional",oO(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{if(void 0===e.value)return e.value=t.defaultValue,e;let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(e=>cm(e,t)):cm(i,t)}});function cm(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}let cg=ou("$ZodPrefault",(e,t)=>{up.init(e,t),e._zod.optin="optional",oO(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>(void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,r))}),cy=ou("$ZodNonOptional",(e,t)=>{up.init(e,t),oO(e._zod,"values",()=>{let e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(r,i)=>{let n=t.innerType._zod.run(r,i);return n instanceof Promise?n.then(t=>c_(t,e)):c_(n,e)}});function c_(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}let cv=ou("$ZodSuccess",(e,t)=>{up.init(e,t),e._zod.parse=(e,r)=>{let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(t=>(e.value=0===t.issues.length,e)):(e.value=0===i.issues.length,e)}}),cb=ou("$ZodCatch",(e,t)=>{up.init(e,t),oO(e._zod,"optin",()=>t.innerType._zod.optin),oO(e._zod,"optout",()=>t.innerType._zod.optout),oO(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(i=>(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(e=>o4(e,r,op()))},input:e.value}),e.issues=[]),e)):(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(e=>o4(e,r,op()))},input:e.value}),e.issues=[]),e)}}),cw=ou("$ZodNaN",(e,t)=>{up.init(e,t),e._zod.parse=(t,r)=>("number"==typeof t.value&&Number.isNaN(t.value)||t.issues.push({input:t.value,inst:e,expected:"nan",code:"invalid_type"}),t)}),cE=ou("$ZodPipe",(e,t)=>{up.init(e,t),oO(e._zod,"values",()=>t.in._zod.values),oO(e._zod,"optin",()=>t.in._zod.optin),oO(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(e,r)=>{let i=t.in._zod.run(e,r);return i instanceof Promise?i.then(e=>cT(e,t,r)):cT(i,t,r)}});function cT(e,t,r){return oQ(e)?e:t.out._zod.run({value:e.value,issues:e.issues},r)}let cS=ou("$ZodReadonly",(e,t)=>{up.init(e,t),oO(e._zod,"propValues",()=>t.innerType._zod.propValues),oO(e._zod,"optin",()=>t.innerType._zod.optin),oO(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(e,r)=>{let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(cI):cI(i)}});function cI(e){return e.value=Object.freeze(e.value),e}let cO=ou("$ZodTemplateLiteral",(e,t)=>{up.init(e,t);let r=[];for(let e of t.parts)if(e instanceof up){if(!e._zod.pattern)throw Error(`Invalid template literal part, no pattern found: ${[...e._zod.traits].shift()}`);let t=e._zod.pattern instanceof RegExp?e._zod.pattern.source:e._zod.pattern;if(!t)throw Error(`Invalid template literal part: ${e._zod.traits}`);let i=+!!t.startsWith("^"),n=t.endsWith("$")?t.length-1:t.length;r.push(t.slice(i,n))}else if(null===e||oD.has(typeof e))r.push(oM(`${e}`));else throw Error(`Invalid template literal part: ${e}`);e._zod.pattern=RegExp(`^${r.join("")}$`),e._zod.parse=(t,r)=>("string"!=typeof t.value?t.issues.push({input:t.value,inst:e,expected:"template_literal",code:"invalid_type"}):(e._zod.pattern.lastIndex=0,e._zod.pattern.test(t.value)||t.issues.push({input:t.value,inst:e,code:"invalid_format",format:"template_literal",pattern:e._zod.pattern.source})),t)}),cA=ou("$ZodPromise",(e,t)=>{up.init(e,t),e._zod.parse=(e,r)=>Promise.resolve(e.value).then(e=>t.innerType._zod.run({value:e,issues:[]},r))}),ck=ou("$ZodLazy",(e,t)=>{up.init(e,t),oO(e._zod,"innerType",()=>t.getter()),oO(e._zod,"pattern",()=>e._zod.innerType._zod.pattern),oO(e._zod,"propValues",()=>e._zod.innerType._zod.propValues),oO(e._zod,"optin",()=>e._zod.innerType._zod.optin),oO(e._zod,"optout",()=>e._zod.innerType._zod.optout),e._zod.parse=(t,r)=>e._zod.innerType._zod.run(t,r)}),cx=ou("$ZodCustom",(e,t)=>{lY.init(e,t),up.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=r=>{let i=r.value,n=t.fn(i);if(n instanceof Promise)return n.then(t=>c$(t,r,i,e));c$(n,r,i,e)}});function c$(e,t,r,i){if(!e){let e={code:"custom",input:r,inst:i,path:[...i._zod.def.path??[]],continue:!i._zod.def.abort};i._zod.def.params&&(e.params=i._zod.def.params),t.issues.push(o9(e))}}function cC(e,t,r,i){let n=Math.abs(e),a=n%10,s=n%100;return s>=11&&s<=19?i:1===a?t:a>=2&&a<=4?r:i}function cN(){let e,t;return{localeError:(e={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}},t={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Invalid input: expected ${r.expected}, received ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Invalid input: expected ${oZ(r.values[0])}`;return`Invalid option: expected one of ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Too big: expected ${r.origin??"value"} to have ${t}${r.maximum.toString()} ${i.unit??"elements"}`;return`Too big: expected ${r.origin??"value"} to be ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Too small: expected ${r.origin} to have ${t}${r.minimum.toString()} ${i.unit}`;return`Too small: expected ${r.origin} to be ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Invalid string: must start with "${r.prefix}"`;if("ends_with"===r.format)return`Invalid string: must end with "${r.suffix}"`;if("includes"===r.format)return`Invalid string: must include "${r.includes}"`;if("regex"===r.format)return`Invalid string: must match pattern ${r.pattern}`;return`Invalid ${t[r.format]??r.format}`;case"not_multiple_of":return`Invalid number: must be a multiple of ${r.divisor}`;case"unrecognized_keys":return`Unrecognized key${r.keys.length>1?"s":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`Invalid key in ${r.origin}`;case"invalid_union":default:return"Invalid input";case"invalid_element":return`Invalid value in ${r.origin}`}})}}function cP(e,t,r,i){let n=Math.abs(e),a=n%10,s=n%100;return s>=11&&s<=19?i:1===a?t:a>=2&&a<=4?r:i}e.s(["$ZodAny",0,uV,"$ZodArray",0,u4,"$ZodBase64",0,uU,"$ZodBase64URL",0,uD,"$ZodBigInt",0,uH,"$ZodBigIntFormat",0,uq,"$ZodBoolean",0,uG,"$ZodCIDRv4",0,uP,"$ZodCIDRv6",0,uR,"$ZodCUID",0,uE,"$ZodCUID2",0,uT,"$ZodCatch",0,cb,"$ZodCustom",0,cx,"$ZodDate",0,u0,"$ZodDefault",0,cf,"$ZodDiscriminatedUnion",0,u8,"$ZodE164",0,uM,"$ZodEmail",0,u_,"$ZodEmoji",0,ub,"$ZodEnum",0,cl,"$ZodFile",0,cc,"$ZodGUID",0,ug,"$ZodIPv4",0,uC,"$ZodIPv6",0,uN,"$ZodISODate",0,uk,"$ZodISODateTime",0,uA,"$ZodISODuration",0,u$,"$ZodISOTime",0,ux,"$ZodIntersection",0,u7,"$ZodJWT",0,uF,"$ZodKSUID",0,uO,"$ZodLazy",0,ck,"$ZodLiteral",0,cu,"$ZodMap",0,cn,"$ZodNaN",0,cw,"$ZodNanoID",0,uw,"$ZodNever",0,uX,"$ZodNonOptional",0,cy,"$ZodNull",0,uJ,"$ZodNullable",0,cp,"$ZodNumber",0,uB,"$ZodNumberFormat",0,uZ,"$ZodObject",0,u9,"$ZodOptional",0,ch,"$ZodPipe",0,cE,"$ZodPrefault",0,cg,"$ZodPromise",0,cA,"$ZodReadonly",0,cS,"$ZodRecord",0,ci,"$ZodSet",0,cs,"$ZodString",0,uf,"$ZodStringFormat",0,um,"$ZodSuccess",0,cv,"$ZodSymbol",0,uW,"$ZodTemplateLiteral",0,cO,"$ZodTransform",0,cd,"$ZodTuple",0,ct,"$ZodType",0,up,"$ZodULID",0,uS,"$ZodURL",0,uv,"$ZodUUID",0,uy,"$ZodUndefined",0,uK,"$ZodUnion",0,u5,"$ZodUnknown",0,uY,"$ZodVoid",0,uQ,"$ZodXID",0,uI,"isValidBase64",()=>uj,"isValidBase64URL",()=>uL,"isValidJWT",()=>uz],654200),e.s([],295314);let cR=Symbol("ZodOutput"),cj=Symbol("ZodInput");class cU{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){let r=t[0];if(this._map.set(e,r),r&&"object"==typeof r&&"id"in r){if(this._idmap.has(r.id))throw Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}remove(e){return this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let r={...this.get(t)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function cL(){return new cU}let cD=cL();function cM(e,t){return new e({type:"string",...oF(t)})}function cz(e,t){return new e({type:"string",coerce:!0,...oF(t)})}function cF(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...oF(t)})}function cB(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...oF(t)})}function cZ(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...oF(t)})}function cG(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...oF(t)})}function cH(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...oF(t)})}function cq(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...oF(t)})}function cW(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...oF(t)})}function cK(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...oF(t)})}function cJ(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...oF(t)})}function cV(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...oF(t)})}function cY(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...oF(t)})}function cX(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...oF(t)})}function cQ(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...oF(t)})}function c0(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...oF(t)})}function c1(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...oF(t)})}function c4(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...oF(t)})}function c2(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...oF(t)})}function c6(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...oF(t)})}function c9(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...oF(t)})}function c3(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...oF(t)})}function c5(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...oF(t)})}function c8(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...oF(t)})}e.s(["$ZodRegistry",()=>cU,"$input",0,cj,"$output",0,cR,"globalRegistry",0,cD,"registry",()=>cL],947483);let c7={Any:null,Minute:-1,Second:0,Millisecond:3,Microsecond:6};function de(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...oF(t)})}function dt(e,t){return new e({type:"string",format:"date",check:"string_format",...oF(t)})}function dr(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...oF(t)})}function di(e,t){return new e({type:"string",format:"duration",check:"string_format",...oF(t)})}function dn(e,t){return new e({type:"number",checks:[],...oF(t)})}function da(e,t){return new e({type:"number",coerce:!0,checks:[],...oF(t)})}function ds(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...oF(t)})}function dl(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"float32",...oF(t)})}function du(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"float64",...oF(t)})}function dc(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"int32",...oF(t)})}function dd(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"uint32",...oF(t)})}function dh(e,t){return new e({type:"boolean",...oF(t)})}function dp(e,t){return new e({type:"boolean",coerce:!0,...oF(t)})}function df(e,t){return new e({type:"bigint",...oF(t)})}function dm(e,t){return new e({type:"bigint",coerce:!0,...oF(t)})}function dg(e,t){return new e({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...oF(t)})}function dy(e,t){return new e({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...oF(t)})}function d_(e,t){return new e({type:"symbol",...oF(t)})}function dv(e,t){return new e({type:"undefined",...oF(t)})}function db(e,t){return new e({type:"null",...oF(t)})}function dw(e){return new e({type:"any"})}function dE(e){return new e({type:"unknown"})}function dT(e,t){return new e({type:"never",...oF(t)})}function dS(e,t){return new e({type:"void",...oF(t)})}function dI(e,t){return new e({type:"date",...oF(t)})}function dO(e,t){return new e({type:"date",coerce:!0,...oF(t)})}function dA(e,t){return new e({type:"nan",...oF(t)})}function dk(e,t){return new lQ({check:"less_than",...oF(t),value:e,inclusive:!1})}function dx(e,t){return new lQ({check:"less_than",...oF(t),value:e,inclusive:!0})}function d$(e,t){return new l0({check:"greater_than",...oF(t),value:e,inclusive:!1})}function dC(e,t){return new l0({check:"greater_than",...oF(t),value:e,inclusive:!0})}function dN(e){return d$(0,e)}function dP(e){return dk(0,e)}function dR(e){return dx(0,e)}function dj(e){return dC(0,e)}function dU(e,t){return new l1({check:"multiple_of",...oF(t),value:e})}function dL(e,t){return new l6({check:"max_size",...oF(t),maximum:e})}function dD(e,t){return new l9({check:"min_size",...oF(t),minimum:e})}function dM(e,t){return new l3({check:"size_equals",...oF(t),size:e})}function dz(e,t){return new l5({check:"max_length",...oF(t),maximum:e})}function dF(e,t){return new l8({check:"min_length",...oF(t),minimum:e})}function dB(e,t){return new l7({check:"length_equals",...oF(t),length:e})}function dZ(e,t){return new ut({check:"string_format",format:"regex",...oF(t),pattern:e})}function dG(e){return new ur({check:"string_format",format:"lowercase",...oF(e)})}function dH(e){return new ui({check:"string_format",format:"uppercase",...oF(e)})}function dq(e,t){return new un({check:"string_format",format:"includes",...oF(t),includes:e})}function dW(e,t){return new ua({check:"string_format",format:"starts_with",...oF(t),prefix:e})}function dK(e,t){return new us({check:"string_format",format:"ends_with",...oF(t),suffix:e})}function dJ(e,t,r){return new ul({check:"property",property:e,schema:t,...oF(r)})}function dV(e,t){return new uu({check:"mime_type",mime:e,...oF(t)})}function dY(e){return new uc({check:"overwrite",tx:e})}function dX(e){return dY(t=>t.normalize(e))}function dQ(){return dY(e=>e.trim())}function d0(){return dY(e=>e.toLowerCase())}function d1(){return dY(e=>e.toUpperCase())}function d4(e,t,r){return new e({type:"array",element:t,...oF(r)})}function d2(e,t,r){return new e({type:"union",options:t,...oF(r)})}function d6(e,t,r,i){return new e({type:"union",options:r,discriminator:t,...oF(i)})}function d9(e,t,r){return new e({type:"intersection",left:t,right:r})}function d3(e,t,r,i){let n=r instanceof up,a=n?i:r;return new e({type:"tuple",items:t,rest:n?r:null,...oF(a)})}function d5(e,t,r,i){return new e({type:"record",keyType:t,valueType:r,...oF(i)})}function d8(e,t,r,i){return new e({type:"map",keyType:t,valueType:r,...oF(i)})}function d7(e,t,r){return new e({type:"set",valueType:t,...oF(r)})}function he(e,t,r){return new e({type:"enum",entries:Array.isArray(t)?Object.fromEntries(t.map(e=>[e,e])):t,...oF(r)})}function ht(e,t,r){return new e({type:"enum",entries:t,...oF(r)})}function hr(e,t,r){return new e({type:"literal",values:Array.isArray(t)?t:[t],...oF(r)})}function hi(e,t){return new e({type:"file",...oF(t)})}function hn(e,t){return new e({type:"transform",transform:t})}function ha(e,t){return new e({type:"optional",innerType:t})}function hs(e,t){return new e({type:"nullable",innerType:t})}function ho(e,t,r){return new e({type:"default",innerType:t,get defaultValue(){return"function"==typeof r?r():r}})}function hl(e,t,r){return new e({type:"nonoptional",innerType:t,...oF(r)})}function hu(e,t){return new e({type:"success",innerType:t})}function hc(e,t,r){return new e({type:"catch",innerType:t,catchValue:"function"==typeof r?r:()=>r})}function hd(e,t,r){return new e({type:"pipe",in:t,out:r})}function hh(e,t){return new e({type:"readonly",innerType:t})}function hp(e,t,r){return new e({type:"template_literal",parts:t,...oF(r)})}function hf(e,t){return new e({type:"lazy",getter:t})}function hm(e,t){return new e({type:"promise",innerType:t})}function hg(e,t,r){let i=oF(r);return i.abort??(i.abort=!0),new e({type:"custom",check:"custom",fn:t,...i})}function hy(e,t,r){return new e({type:"custom",check:"custom",fn:t,...oF(r)})}function h_(e,t){let{case:r,error:i,truthy:n,falsy:a}=oF(t),s=n??["true","1","yes","on","y","enabled"],o=a??["false","0","no","off","n","disabled"];"sensitive"!==r&&(s=s.map(e=>"string"==typeof e?e.toLowerCase():e),o=o.map(e=>"string"==typeof e?e.toLowerCase():e));let l=new Set(s),u=new Set(o),c=e.Pipe??cE,d=e.Boolean??uG,h=e.String??uf,p=new(e.Transform??cd)({type:"transform",transform:(e,t)=>{let i=e;return"sensitive"!==r&&(i=i.toLowerCase()),!!l.has(i)||!u.has(i)&&(t.issues.push({code:"invalid_value",expected:"stringbool",values:[...l,...u],input:t.value,inst:p}),{})},error:i}),f=new c({type:"pipe",in:new h({type:"string",error:i}),out:p,error:i});return new c({type:"pipe",in:f,out:new d({type:"boolean",error:i}),error:i})}e.s(["TimePrecision",0,c7,"_any",()=>dw,"_array",()=>d4,"_base64",()=>c9,"_base64url",()=>c3,"_bigint",()=>df,"_boolean",()=>dh,"_catch",()=>hc,"_cidrv4",()=>c2,"_cidrv6",()=>c6,"_coercedBigint",()=>dm,"_coercedBoolean",()=>dp,"_coercedDate",()=>dO,"_coercedNumber",()=>da,"_coercedString",()=>cz,"_cuid",()=>cV,"_cuid2",()=>cY,"_custom",()=>hg,"_date",()=>dI,"_default",()=>ho,"_discriminatedUnion",()=>d6,"_e164",()=>c5,"_email",()=>cF,"_emoji",()=>cK,"_endsWith",()=>dK,"_enum",()=>he,"_file",()=>hi,"_float32",()=>dl,"_float64",()=>du,"_gt",()=>d$,"_gte",()=>dC,"_guid",()=>cB,"_includes",()=>dq,"_int",()=>ds,"_int32",()=>dc,"_int64",()=>dg,"_intersection",()=>d9,"_ipv4",()=>c1,"_ipv6",()=>c4,"_isoDate",()=>dt,"_isoDateTime",()=>de,"_isoDuration",()=>di,"_isoTime",()=>dr,"_jwt",()=>c8,"_ksuid",()=>c0,"_lazy",()=>hf,"_length",()=>dB,"_literal",()=>hr,"_lowercase",()=>dG,"_lt",()=>dk,"_lte",()=>dx,"_map",()=>d8,"_max",()=>dx,"_maxLength",()=>dz,"_maxSize",()=>dL,"_mime",()=>dV,"_min",()=>dC,"_minLength",()=>dF,"_minSize",()=>dD,"_multipleOf",()=>dU,"_nan",()=>dA,"_nanoid",()=>cJ,"_nativeEnum",()=>ht,"_negative",()=>dP,"_never",()=>dT,"_nonnegative",()=>dj,"_nonoptional",()=>hl,"_nonpositive",()=>dR,"_normalize",()=>dX,"_null",()=>db,"_nullable",()=>hs,"_number",()=>dn,"_optional",()=>ha,"_overwrite",()=>dY,"_pipe",()=>hd,"_positive",()=>dN,"_promise",()=>hm,"_property",()=>dJ,"_readonly",()=>hh,"_record",()=>d5,"_refine",()=>hy,"_regex",()=>dZ,"_set",()=>d7,"_size",()=>dM,"_startsWith",()=>dW,"_string",()=>cM,"_stringbool",()=>h_,"_success",()=>hu,"_symbol",()=>d_,"_templateLiteral",()=>hp,"_toLowerCase",()=>d0,"_toUpperCase",()=>d1,"_transform",()=>hn,"_trim",()=>dQ,"_tuple",()=>d3,"_uint32",()=>dd,"_uint64",()=>dy,"_ulid",()=>cX,"_undefined",()=>dv,"_union",()=>d2,"_unknown",()=>dE,"_uppercase",()=>dH,"_url",()=>cW,"_uuid",()=>cZ,"_uuidv4",()=>cG,"_uuidv6",()=>cH,"_uuidv7",()=>cq,"_void",()=>dS,"_xid",()=>cQ],143191);class hv{constructor(e){this._def=e,this.def=e}implement(e){if("function"!=typeof e)throw Error("implement() must be called with a function");let t=(...r)=>{let i=this._def.input?lo(this._def.input,r,void 0,{callee:t}):r;if(!Array.isArray(i))throw Error("Invalid arguments schema: not an array or tuple schema.");let n=e(...i);return this._def.output?lo(this._def.output,n,void 0,{callee:t}):n};return t}implementAsync(e){if("function"!=typeof e)throw Error("implement() must be called with a function");let t=async(...r)=>{let i=this._def.input?await lu(this._def.input,r,void 0,{callee:t}):r;if(!Array.isArray(i))throw Error("Invalid arguments schema: not an array or tuple schema.");let n=await e(...i);return this._def.output?lu(this._def.output,n,void 0,{callee:t}):n};return t}input(...e){let t=this.constructor;return new t(Array.isArray(e[0])?{type:"function",input:new ct({type:"tuple",items:e[0],rest:e[1]}),output:this._def.output}:{type:"function",input:e[0],output:this._def.output})}output(e){return new this.constructor({type:"function",input:this._def.input,output:e})}}function hb(e){return new hv({type:"function",input:Array.isArray(e?.input)?d3(ct,e?.input):e?.input??d4(u4,dE(uY)),output:e?.output??dE(uY)})}e.s(["$ZodFunction",()=>hv,"function",()=>hb],115225);class hw{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??cD,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var r;let i=e._zod.def,n=this.seen.get(e);if(n)return n.count++,t.schemaPath.includes(e)&&(n.cycle=t.path),n.schema;let a={schema:{},count:1,cycle:void 0};this.seen.set(e,a);let s=e._zod.toJSONSchema?.();if(s)a.schema=s;else{let r={...t,schemaPath:[...t.schemaPath,e],path:t.path},n=e._zod.parent;if(n)a.ref=n,this.process(n,r),this.seen.get(n).isParent=!0;else{let t=a.schema;switch(i.type){case"string":{t.type="string";let{minimum:r,maximum:i,format:n,patterns:s,contentEncoding:o}=e._zod.bag;if("number"==typeof r&&(t.minLength=r),"number"==typeof i&&(t.maxLength=i),n&&(t.format=({guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""})[n]??n,""===t.format&&delete t.format),o&&(t.contentEncoding=o),s&&s.size>0){let e=[...s];1===e.length?t.pattern=e[0].source:e.length>1&&(a.schema.allOf=[...e.map(e=>({..."draft-7"===this.target?{type:"string"}:{},pattern:e.source}))])}break}case"number":{let{minimum:r,maximum:i,format:n,multipleOf:a,exclusiveMaximum:s,exclusiveMinimum:o}=e._zod.bag;"string"==typeof n&&n.includes("int")?t.type="integer":t.type="number","number"==typeof o&&(t.exclusiveMinimum=o),"number"==typeof r&&(t.minimum=r,"number"==typeof o&&(o>=r?delete t.minimum:delete t.exclusiveMinimum)),"number"==typeof s&&(t.exclusiveMaximum=s),"number"==typeof i&&(t.maximum=i,"number"==typeof s&&(s<=i?delete t.maximum:delete t.exclusiveMaximum)),"number"==typeof a&&(t.multipleOf=a);break}case"boolean":case"success":t.type="boolean";break;case"bigint":if("throw"===this.unrepresentable)throw Error("BigInt cannot be represented in JSON Schema");break;case"symbol":if("throw"===this.unrepresentable)throw Error("Symbols cannot be represented in JSON Schema");break;case"undefined":case"null":t.type="null";break;case"any":case"unknown":break;case"never":t.not={};break;case"void":if("throw"===this.unrepresentable)throw Error("Void cannot be represented in JSON Schema");break;case"date":if("throw"===this.unrepresentable)throw Error("Date cannot be represented in JSON Schema");break;case"array":{let{minimum:n,maximum:a}=e._zod.bag;"number"==typeof n&&(t.minItems=n),"number"==typeof a&&(t.maxItems=a),t.type="array",t.items=this.process(i.element,{...r,path:[...r.path,"items"]});break}case"object":{t.type="object",t.properties={};let e=i.shape;for(let i in e)t.properties[i]=this.process(e[i],{...r,path:[...r.path,"properties",i]});let n=new Set([...new Set(Object.keys(e))].filter(e=>{let t=i.shape[e]._zod;return"input"===this.io?void 0===t.optin:void 0===t.optout}));n.size>0&&(t.required=Array.from(n)),i.catchall?._zod.def.type==="never"?t.additionalProperties=!1:i.catchall?i.catchall&&(t.additionalProperties=this.process(i.catchall,{...r,path:[...r.path,"additionalProperties"]})):"output"===this.io&&(t.additionalProperties=!1);break}case"union":t.anyOf=i.options.map((e,t)=>this.process(e,{...r,path:[...r.path,"anyOf",t]}));break;case"intersection":{let e=this.process(i.left,{...r,path:[...r.path,"allOf",0]}),n=this.process(i.right,{...r,path:[...r.path,"allOf",1]}),a=e=>"allOf"in e&&1===Object.keys(e).length;t.allOf=[...a(e)?e.allOf:[e],...a(n)?n.allOf:[n]];break}case"tuple":{t.type="array";let n=i.items.map((e,t)=>this.process(e,{...r,path:[...r.path,"prefixItems",t]}));if("draft-2020-12"===this.target?t.prefixItems=n:t.items=n,i.rest){let e=this.process(i.rest,{...r,path:[...r.path,"items"]});"draft-2020-12"===this.target?t.items=e:t.additionalItems=e}i.rest&&(t.items=this.process(i.rest,{...r,path:[...r.path,"items"]}));let{minimum:a,maximum:s}=e._zod.bag;"number"==typeof a&&(t.minItems=a),"number"==typeof s&&(t.maxItems=s);break}case"record":t.type="object",t.propertyNames=this.process(i.keyType,{...r,path:[...r.path,"propertyNames"]}),t.additionalProperties=this.process(i.valueType,{...r,path:[...r.path,"additionalProperties"]});break;case"map":if("throw"===this.unrepresentable)throw Error("Map cannot be represented in JSON Schema");break;case"set":if("throw"===this.unrepresentable)throw Error("Set cannot be represented in JSON Schema");break;case"enum":{let e=ov(i.entries);e.every(e=>"number"==typeof e)&&(t.type="number"),e.every(e=>"string"==typeof e)&&(t.type="string"),t.enum=e;break}case"literal":{let e=[];for(let t of i.values)if(void 0===t){if("throw"===this.unrepresentable)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof t)if("throw"===this.unrepresentable)throw Error("BigInt literals cannot be represented in JSON Schema");else e.push(Number(t));else e.push(t);if(0===e.length);else if(1===e.length){let r=e[0];t.type=null===r?"null":typeof r,t.const=r}else e.every(e=>"number"==typeof e)&&(t.type="number"),e.every(e=>"string"==typeof e)&&(t.type="string"),e.every(e=>"boolean"==typeof e)&&(t.type="string"),e.every(e=>null===e)&&(t.type="null"),t.enum=e;break}case"file":{let r={type:"string",format:"binary",contentEncoding:"binary"},{minimum:i,maximum:n,mime:a}=e._zod.bag;void 0!==i&&(r.minLength=i),void 0!==n&&(r.maxLength=n),a?1===a.length?(r.contentMediaType=a[0],Object.assign(t,r)):t.anyOf=a.map(e=>({...r,contentMediaType:e})):Object.assign(t,r);break}case"transform":if("throw"===this.unrepresentable)throw Error("Transforms cannot be represented in JSON Schema");break;case"nullable":t.anyOf=[this.process(i.innerType,r),{type:"null"}];break;case"nonoptional":case"promise":case"optional":this.process(i.innerType,r),a.ref=i.innerType;break;case"default":this.process(i.innerType,r),a.ref=i.innerType,t.default=JSON.parse(JSON.stringify(i.defaultValue));break;case"prefault":this.process(i.innerType,r),a.ref=i.innerType,"input"===this.io&&(t._prefault=JSON.parse(JSON.stringify(i.defaultValue)));break;case"catch":{let e;this.process(i.innerType,r),a.ref=i.innerType;try{e=i.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}t.default=e;break}case"nan":if("throw"===this.unrepresentable)throw Error("NaN cannot be represented in JSON Schema");break;case"template_literal":{let r=e._zod.pattern;if(!r)throw Error("Pattern not found in template literal");t.type="string",t.pattern=r.source;break}case"pipe":{let e="input"===this.io?"transform"===i.in._zod.def.type?i.out:i.in:i.out;this.process(e,r),a.ref=e;break}case"readonly":this.process(i.innerType,r),a.ref=i.innerType,t.readOnly=!0;break;case"lazy":{let t=e._zod.innerType;this.process(t,r),a.ref=t;break}case"custom":if("throw"===this.unrepresentable)throw Error("Custom types cannot be represented in JSON Schema")}}}let o=this.metadataRegistry.get(e);return o&&Object.assign(a.schema,o),"input"===this.io&&function e(t,r){let i=r??{seen:new Set};if(i.seen.has(t))return!1;i.seen.add(t);let n=t._zod.def;switch(n.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":case"custom":case"success":case"catch":return!1;case"array":return e(n.element,i);case"object":for(let t in n.shape)if(e(n.shape[t],i))return!0;return!1;case"union":for(let t of n.options)if(e(t,i))return!0;return!1;case"intersection":return e(n.left,i)||e(n.right,i);case"tuple":for(let t of n.items)if(e(t,i))return!0;if(n.rest&&e(n.rest,i))return!0;return!1;case"record":case"map":return e(n.keyType,i)||e(n.valueType,i);case"set":return e(n.valueType,i);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":case"default":case"prefault":return e(n.innerType,i);case"lazy":return e(n.getter(),i);case"transform":return!0;case"pipe":return e(n.in,i)||e(n.out,i)}throw Error(`Unknown schema type: ${n.type}`)}(e)&&(delete a.schema.examples,delete a.schema.default),"input"===this.io&&a.schema._prefault&&((r=a.schema).default??(r.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,t){let r={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},i=this.seen.get(e);if(!i)throw Error("Unprocessed schema. This is a bug in Zod.");let n=e=>{let t="draft-2020-12"===this.target?"$defs":"definitions";if(r.external){let i=r.external.registry.get(e[0])?.id;if(i)return{ref:r.external.uri(i)};let n=e[1].defId??e[1].schema.id??`schema${this.counter++}`;return e[1].defId=n,{defId:n,ref:`${r.external.uri("__shared")}#/${t}/${n}`}}if(e[1]===i)return{ref:"#"};let n=`#/${t}/`,a=e[1].schema.id??`__schema${this.counter++}`;return{defId:a,ref:n+a}},a=e=>{if(e[1].schema.$ref)return;let t=e[1],{ref:r,defId:i}=n(e);t.def={...t.schema},i&&(t.defId=i);let a=t.schema;for(let e in a)delete a[e];a.$ref=r};for(let t of this.seen.entries()){let i=t[1];if(e===t[0]){a(t);continue}if(r.external){let i=r.external.registry.get(t[0])?.id;if(e!==t[0]&&i){a(t);continue}}if(this.metadataRegistry.get(t[0])?.id){a(t);continue}if(i.cycle){if("throw"===r.cycles)throw Error(`Cycle detected: #/${i.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`);"ref"===r.cycles&&a(t);continue}if(i.count>1&&"ref"===r.reused){a(t);continue}}let s=(e,t)=>{let r=this.seen.get(e),i=r.def??r.schema,n={...i};if(null===r.ref)return;let a=r.ref;if(r.ref=null,a){s(a,t);let e=this.seen.get(a).schema;e.$ref&&"draft-7"===t.target?(i.allOf=i.allOf??[],i.allOf.push(e)):(Object.assign(i,e),Object.assign(i,n))}r.isParent||this.override({zodSchema:e,jsonSchema:i})};for(let e of[...this.seen.entries()].reverse())s(e[0],{target:this.target});let o={};"draft-2020-12"===this.target?o.$schema="https://json-schema.org/draft/2020-12/schema":"draft-7"===this.target?o.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),Object.assign(o,i.def);let l=r.external?.defs??{};for(let e of this.seen.entries()){let t=e[1];t.def&&t.defId&&(l[t.defId]=t.def)}!r.external&&Object.keys(l).length>0&&("draft-2020-12"===this.target?o.$defs=l:o.definitions=l);try{return JSON.parse(JSON.stringify(o))}catch(e){throw Error("Error converting schema to JSON.")}}}function hE(e,t){if(e instanceof cU){let r=new hw(t),i={};for(let t of e._idmap.entries()){let[e,i]=t;r.process(i)}let n={},a={registry:e,uri:t?.uri||(e=>e),defs:i};for(let i of e._idmap.entries()){let[e,s]=i;n[e]=r.emit(s,{...t,external:a})}return Object.keys(i).length>0&&(n.__shared={["draft-2020-12"===r.target?"$defs":"definitions"]:i}),{schemas:n}}let r=new hw(t);return r.process(e),r.emit(e,t)}e.s(["JSONSchemaGenerator",()=>hw,"toJSONSchema",()=>hE],864457),e.s([],279795),e.s([],954957),e.i(654200),e.s(["$ZodAny",0,uV,"$ZodArray",0,u4,"$ZodBase64",0,uU,"$ZodBase64URL",0,uD,"$ZodBigInt",0,uH,"$ZodBigIntFormat",0,uq,"$ZodBoolean",0,uG,"$ZodCIDRv4",0,uP,"$ZodCIDRv6",0,uR,"$ZodCUID",0,uE,"$ZodCUID2",0,uT,"$ZodCatch",0,cb,"$ZodCustom",0,cx,"$ZodDate",0,u0,"$ZodDefault",0,cf,"$ZodDiscriminatedUnion",0,u8,"$ZodE164",0,uM,"$ZodEmail",0,u_,"$ZodEmoji",0,ub,"$ZodEnum",0,cl,"$ZodFile",0,cc,"$ZodGUID",0,ug,"$ZodIPv4",0,uC,"$ZodIPv6",0,uN,"$ZodISODate",0,uk,"$ZodISODateTime",0,uA,"$ZodISODuration",0,u$,"$ZodISOTime",0,ux,"$ZodIntersection",0,u7,"$ZodJWT",0,uF,"$ZodKSUID",0,uO,"$ZodLazy",0,ck,"$ZodLiteral",0,cu,"$ZodMap",0,cn,"$ZodNaN",0,cw,"$ZodNanoID",0,uw,"$ZodNever",0,uX,"$ZodNonOptional",0,cy,"$ZodNull",0,uJ,"$ZodNullable",0,cp,"$ZodNumber",0,uB,"$ZodNumberFormat",0,uZ,"$ZodObject",0,u9,"$ZodOptional",0,ch,"$ZodPipe",0,cE,"$ZodPrefault",0,cg,"$ZodPromise",0,cA,"$ZodReadonly",0,cS,"$ZodRecord",0,ci,"$ZodSet",0,cs,"$ZodString",0,uf,"$ZodStringFormat",0,um,"$ZodSuccess",0,cv,"$ZodSymbol",0,uW,"$ZodTemplateLiteral",0,cO,"$ZodTransform",0,cd,"$ZodTuple",0,ct,"$ZodType",0,up,"$ZodULID",0,uS,"$ZodURL",0,uv,"$ZodUUID",0,uy,"$ZodUndefined",0,uK,"$ZodUnion",0,u5,"$ZodUnknown",0,uY,"$ZodVoid",0,uQ,"$ZodXID",0,uI,"clone",()=>oz,"isValidBase64",()=>uj,"isValidBase64URL",()=>uL,"isValidJWT",()=>uz],456701);var hT=e.i(596309),hT=hT;function hS(e){if("object"!=typeof e||null===e||!("_zod"in e))return!1;let t=e._zod;return"object"==typeof t&&null!==t&&"def"in t}function hI(e){if("object"!=typeof e||null===e||!("_def"in e)||"_zod"in e)return!1;let t=e._def;return"object"==typeof t&&null!=t&&"typeName"in t}function hO(e){return hS(e)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),hI(e)}function hA(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&!!(hS(e)||hI(e))}function hk(e){return"object"==typeof e&&null!==e&&"_def"in e&&"object"==typeof e._def&&null!==e._def&&"typeName"in e._def&&"ZodLiteral"===e._def.typeName||!1}function hx(e){return!!hS(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"literal"===e._zod.def.type||!1)}function h$(e){return!!(hk(e)||hx(e))}async function hC(e,t){if(hS(e))try{let r=await lu(e,t);return{success:!0,data:r}}catch(e){return{success:!1,error:e}}if(hI(e))return await e.safeParseAsync(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function hN(e,t){if(hS(e))return await lu(e,t);if(hI(e))return await e.parseAsync(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function hP(e,t){if(hS(e))try{let r=lo(e,t);return{success:!0,data:r}}catch(e){return{success:!1,error:e}}if(hI(e))return e.safeParse(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function hR(e,t){if(hS(e))return lo(e,t);if(hI(e))return e.parse(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function hj(e){return hS(e)?cD.get(e)?.description:hI(e)||"description"in e&&"string"==typeof e.description?e.description:void 0}function hU(e){if(!hA(e))return!1;if(hI(e)){let t=e._def;if("ZodObject"===t.typeName)return!e.shape||0===Object.keys(e.shape).length;if("ZodRecord"===t.typeName)return!0}if(hS(e)){let t=e._zod.def;if("object"===t.type)return!e.shape||0===Object.keys(e.shape).length;if("record"===t.type)return!0}return"object"==typeof e&&null!==e&&!("shape"in e)}function hL(e){return!!hA(e)&&(hI(e)?"ZodString"===e._def.typeName:!!hS(e)&&"string"===e._zod.def.type)}function hD(e){return"object"==typeof e&&null!==e&&"_def"in e&&"object"==typeof e._def&&null!==e._def&&"typeName"in e._def&&"ZodObject"===e._def.typeName||!1}function hM(e){return!!hS(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"object"===e._zod.def.type||!1)}function hz(e){return!!hS(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"array"===e._zod.def.type||!1)}function hF(e){return!!hS(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"optional"===e._zod.def.type||!1)}function hB(e){return!!hS(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"nullable"===e._zod.def.type||!1)}function hZ(e){return!!(hD(e)||hM(e))}function hG(e){if(hI(e))return e.shape;if(hS(e))return e._zod.def.shape;throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hH(e,t){if(hI(e))return e.extend(t);if(hS(e))return hT.extend(e,t);throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hq(e){if(hI(e))return e.partial();if(hS(e))return hT.partial(ch,e,void 0);throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hW(e,t=!1){if(hI(e))return e.strict();if(hM(e)){let r=e._zod.def.shape;if(t)for(let[i,n]of Object.entries(e._zod.def.shape)){if(hM(n)){let e=hW(n,t);r[i]=e}else if(hz(n)){let e=n._zod.def.element;hM(e)&&(e=hW(e,t)),r[i]=oz(n,{...n._zod.def,element:e})}else r[i]=n;let e=cD.get(n);e&&cD.add(r[i],e)}let i=oz(e,{...e._zod.def,shape:r,catchall:dT(uX)}),n=cD.get(e);return n&&cD.add(i,n),i}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hK(e){if(hI(e))try{let t=e.parse(void 0);return()=>t}catch{return}if(hS(e))try{let t=lo(e,void 0);return()=>t}catch{}}function hJ(e,t=!1){return function e(t,r,i){let n=i.get(t);if(void 0!==n)return n;if(hI(t))return hI(t)&&"typeName"in t._def&&"ZodEffects"===t._def.typeName?e(t._def.schema,r,i):t;if(hS(t)){let n=t;if(hS(t)&&"pipe"===t._zod.def.type&&(n=e(t._zod.def.in,r,i)),r){if(hM(n)){let t=n._zod.def.shape;for(let[a,s]of Object.entries(n._zod.def.shape))t[a]=e(s,r,i);n=oz(n,{...n._zod.def,shape:t})}else if(hz(n)){let t=e(n._zod.def.element,r,i);n=oz(n,{...n._zod.def,element:t})}else if(hF(n)){let t=e(n._zod.def.innerType,r,i);n=oz(n,{...n._zod.def,innerType:t})}else if(hB(n)){let t=e(n._zod.def.innerType,r,i);n=oz(n,{...n._zod.def,innerType:t})}}let a=cD.get(t);return a&&cD.add(n,a),i.set(t,n),n}throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}(e,t,new WeakMap)}function hV(e,t){if(hI(e)){let r=hG(e),i={};for(let[e,n]of Object.entries(r))t(e,n)?i[e]=n.optional():i[e]=n;return e.extend(i)}if(hS(e)){let r=hG(e),i={...e._zod.def.shape};for(let[e,n]of Object.entries(r))t(e,n)&&(i[e]=new ch({type:"optional",innerType:n}));let n=oz(e,{...e._zod.def,shape:i}),a=cD.get(e);return a&&cD.add(n,a),n}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hY(e){return e instanceof Error&&("ZodError"===e.constructor.name||"$ZodError"===e.constructor.name)}let hX=Symbol("Let zodToJsonSchema decide on which parser to use"),hQ={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},h0=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function h1(e){if("openAi"!==e.target)return{};let t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?h0(t,e.currentPath):t.join("/")}}function h4(e,t,r,i){i?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function h2(e,t,r,i,n){e[t]=r,h4(e,t,i,n)}e.i(454188);var h6=e.i(963319);function h9(e,t){return pg(e.type._def,t)}let h3=/^[cC][^\s-]{8,}$/,h5=/^[0-9a-z]+$/,h8=/^[0-9A-HJKMNP-TV-Z]{26}$/,h7=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,pe=()=>(void 0===h&&(h=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),h),pt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,pr=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,pi=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,pn=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,pa=/^[a-zA-Z0-9_-]{21}$/,ps=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function po(e,t){let r={type:"string"};if(e.checks)for(let i of e.checks)switch(i.kind){case"min":h2(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t);break;case"max":h2(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"email":switch(t.emailStrategy){case"format:email":pc(r,"email",i.message,t);break;case"format:idn-email":pc(r,"idn-email",i.message,t);break;case"pattern:zod":pd(r,h7,i.message,t)}break;case"url":pc(r,"uri",i.message,t);break;case"uuid":pc(r,"uuid",i.message,t);break;case"regex":pd(r,i.regex,i.message,t);break;case"cuid":pd(r,h3,i.message,t);break;case"cuid2":pd(r,h5,i.message,t);break;case"startsWith":pd(r,RegExp(`^${pl(i.value,t)}`),i.message,t);break;case"endsWith":pd(r,RegExp(`${pl(i.value,t)}$`),i.message,t);break;case"datetime":pc(r,"date-time",i.message,t);break;case"date":pc(r,"date",i.message,t);break;case"time":pc(r,"time",i.message,t);break;case"duration":pc(r,"duration",i.message,t);break;case"length":h2(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t),h2(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"includes":pd(r,RegExp(pl(i.value,t)),i.message,t);break;case"ip":"v6"!==i.version&&pc(r,"ipv4",i.message,t),"v4"!==i.version&&pc(r,"ipv6",i.message,t);break;case"base64url":pd(r,pn,i.message,t);break;case"jwt":pd(r,ps,i.message,t);break;case"cidr":"v6"!==i.version&&pd(r,pt,i.message,t),"v4"!==i.version&&pd(r,pr,i.message,t);break;case"emoji":pd(r,pe(),i.message,t);break;case"ulid":pd(r,h8,i.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":pc(r,"binary",i.message,t);break;case"contentEncoding:base64":h2(r,"contentEncoding","base64",i.message,t);break;case"pattern:zod":pd(r,pi,i.message,t)}break;case"nanoid":pd(r,pa,i.message,t)}return r}function pl(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)pu.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let pu=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function pc(e,t,r,i){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&i.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&i.errorMessages&&{errorMessage:{format:r}}})):h2(e,"format",t,r,i)}function pd(e,t,r,i){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&i.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:ph(t,i),...r&&i.errorMessages&&{errorMessage:{pattern:r}}})):h2(e,"pattern",ph(t,i),r,i)}function ph(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},i=r.i?e.source.toLowerCase():e.source,n="",a=!1,s=!1,o=!1;for(let e=0;e<i.length;e++){if(a){n+=i[e],a=!1;continue}if(r.i){if(s){if(i[e].match(/[a-z]/)){o?(n+=i[e],n+=`${i[e-2]}-${i[e]}`.toUpperCase(),o=!1):"-"===i[e+1]&&i[e+2]?.match(/[a-z]/)?(n+=i[e],o=!0):n+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){n+=`[${i[e]}${i[e].toUpperCase()}]`;continue}}if(r.m){if("^"===i[e]){n+=`(^|(?<=[\r
]))`;continue}else if("$"===i[e]){n+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===i[e]){n+=s?`${i[e]}\r
`:`[${i[e]}\r
]`;continue}n+=i[e],"\\"===i[e]?a=!0:s&&"]"===i[e]?s=!1:s||"["!==i[e]||(s=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return n}function pp(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===h6.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,i)=>({...r,[i]:pg(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",i]})??h1(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:pg(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===h6.ZodFirstPartyTypeKind.ZodString&&e.keyType._def.checks?.length){let{type:i,...n}=po(e.keyType._def,t);return{...r,propertyNames:n}}if(e.keyType?._def.typeName===h6.ZodFirstPartyTypeKind.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===h6.ZodFirstPartyTypeKind.ZodBranded&&e.keyType._def.type._def.typeName===h6.ZodFirstPartyTypeKind.ZodString&&e.keyType._def.type._def.checks?.length){let{type:i,...n}=h9(e.keyType._def,t);return{...r,propertyNames:n}}return r}let pf={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},pm=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>pg(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0};function pg(e,t,r=!1){let i=t.seen.get(e);if(t.override){let n=t.override?.(e,t,i,r);if(n!==hX)return n}if(i&&!r){let e=py(i,t);if(void 0!==e)return e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let a=((e,t,r)=>{switch(t){case h6.ZodFirstPartyTypeKind.ZodString:return po(e,r);case h6.ZodFirstPartyTypeKind.ZodNumber:let i={type:"number"};if(!e.checks)return i;for(let t of e.checks)switch(t.kind){case"int":i.type="integer",h4(i,"type",t.message,r);break;case"min":"jsonSchema7"===r.target?t.inclusive?h2(i,"minimum",t.value,t.message,r):h2(i,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(i.exclusiveMinimum=!0),h2(i,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?h2(i,"maximum",t.value,t.message,r):h2(i,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(i.exclusiveMaximum=!0),h2(i,"maximum",t.value,t.message,r));break;case"multipleOf":h2(i,"multipleOf",t.value,t.message,r)}return i;case h6.ZodFirstPartyTypeKind.ZodObject:return function(e,t){let r="openAi"===t.target,i={type:"object",properties:{}},n=[],a=e.shape();for(let e in a){let s=a[e];if(void 0===s||void 0===s._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(s);o&&r&&("ZodOptional"===s._def.typeName&&(s=s._def.innerType),s.isNullable()||(s=s.nullable()),o=!1);let l=pg(s._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(i.properties[e]=l,o||n.push(e))}n.length&&(i.required=n);let s=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return pg(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==s&&(i.additionalProperties=s),i}(e,r);case h6.ZodFirstPartyTypeKind.ZodBigInt:let n={type:"integer",format:"int64"};if(!e.checks)return n;for(let t of e.checks)switch(t.kind){case"min":"jsonSchema7"===r.target?t.inclusive?h2(n,"minimum",t.value,t.message,r):h2(n,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(n.exclusiveMinimum=!0),h2(n,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?h2(n,"maximum",t.value,t.message,r):h2(n,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(n.exclusiveMaximum=!0),h2(n,"maximum",t.value,t.message,r));break;case"multipleOf":h2(n,"multipleOf",t.value,t.message,r)}return n;case h6.ZodFirstPartyTypeKind.ZodBoolean:return{type:"boolean"};case h6.ZodFirstPartyTypeKind.ZodDate:return function e(t,r,i){let n=i??r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map(i=>e(t,r,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var a=t,s=r;let o={type:"integer",format:"unix-time"};if("openApi3"===s.target)return o;for(let e of a.checks)switch(e.kind){case"min":h2(o,"minimum",e.value,e.message,s);break;case"max":h2(o,"maximum",e.value,e.message,s)}return o}}(e,r);case h6.ZodFirstPartyTypeKind.ZodUndefined:return{not:h1(r)};case h6.ZodFirstPartyTypeKind.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case h6.ZodFirstPartyTypeKind.ZodArray:let a;return a={type:"array"},e.type?._def&&e.type?._def?.typeName!==h6.ZodFirstPartyTypeKind.ZodAny&&(a.items=pg(e.type._def,{...r,currentPath:[...r.currentPath,"items"]})),e.minLength&&h2(a,"minItems",e.minLength.value,e.minLength.message,r),e.maxLength&&h2(a,"maxItems",e.maxLength.value,e.maxLength.message,r),e.exactLength&&(h2(a,"minItems",e.exactLength.value,e.exactLength.message,r),h2(a,"maxItems",e.exactLength.value,e.exactLength.message,r)),a;case h6.ZodFirstPartyTypeKind.ZodUnion:case h6.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:if("openApi3"===r.target)return pm(e,r);let s=e.options instanceof Map?Array.from(e.options.values()):e.options;if(s.every(e=>e._def.typeName in pf&&(!e._def.checks||!e._def.checks.length))){let e=s.reduce((e,t)=>{let r=pf[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(s.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=s.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];return e;default:return e}},[]);if(e.length===s.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:s.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(s.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:s.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return pm(e,r);case h6.ZodFirstPartyTypeKind.ZodIntersection:let o,l,u;return o=[pg(e.left._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),pg(e.right._def,{...r,currentPath:[...r.currentPath,"allOf","1"]})].filter(e=>!!e),l="jsonSchema2019-09"===r.target?{unevaluatedProperties:!1}:void 0,u=[],o.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)u.push(...e.allOf),void 0===e.unevaluatedProperties&&(l=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...i}=e;t=i}else l=void 0;u.push(t)}}),u.length?{allOf:u,...l}:void 0;case h6.ZodFirstPartyTypeKind.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>pg(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:pg(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>pg(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case h6.ZodFirstPartyTypeKind.ZodRecord:return pp(e,r);case h6.ZodFirstPartyTypeKind.ZodLiteral:let c;return"bigint"!=(c=typeof e.value)&&"number"!==c&&"boolean"!==c&&"string"!==c?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===r.target?{type:"bigint"===c?"integer":c,enum:[e.value]}:{type:"bigint"===c?"integer":c,const:e.value};case h6.ZodFirstPartyTypeKind.ZodEnum:return{type:"string",enum:Array.from(e.values)};case h6.ZodFirstPartyTypeKind.ZodNativeEnum:let d,h,p;return d=e.values,{type:1===(p=Array.from(new Set((h=Object.keys(e.values).filter(e=>"number"!=typeof d[d[e]]).map(e=>d[e])).map(e=>typeof e)))).length?"string"===p[0]?"string":"number":["string","number"],enum:h};case h6.ZodFirstPartyTypeKind.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===r.target?{type:pf[e.innerType._def.typeName],nullable:!0}:{type:[pf[e.innerType._def.typeName],"null"]};if("openApi3"===r.target){let t=pg(e.innerType._def,{...r,currentPath:[...r.currentPath]});return t&&"$ref"in t?{allOf:[t],nullable:!0}:t&&{...t,nullable:!0}}let f=pg(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","0"]});return f&&{anyOf:[f,{type:"null"}]};case h6.ZodFirstPartyTypeKind.ZodOptional:if(r.currentPath.toString()===r.propertyPath?.toString())return pg(e.innerType._def,r);let m=pg(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","1"]});return m?{anyOf:[{not:h1(r)},m]}:h1(r);case h6.ZodFirstPartyTypeKind.ZodMap:if("record"===r.mapStrategy)return pp(e,r);return{type:"array",maxItems:125,items:{type:"array",items:[pg(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||h1(r),pg(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||h1(r)],minItems:2,maxItems:2}};case h6.ZodFirstPartyTypeKind.ZodSet:let g;return g={type:"array",uniqueItems:!0,items:pg(e.valueType._def,{...r,currentPath:[...r.currentPath,"items"]})},e.minSize&&h2(g,"minItems",e.minSize.value,e.minSize.message,r),e.maxSize&&h2(g,"maxItems",e.maxSize.value,e.maxSize.message,r),g;case h6.ZodFirstPartyTypeKind.ZodLazy:return()=>e.getter()._def;case h6.ZodFirstPartyTypeKind.ZodPromise:return pg(e.type._def,r);case h6.ZodFirstPartyTypeKind.ZodNaN:case h6.ZodFirstPartyTypeKind.ZodNever:return"openAi"===r.target?void 0:{not:h1({...r,currentPath:[...r.currentPath,"not"]})};case h6.ZodFirstPartyTypeKind.ZodEffects:return"input"===r.effectStrategy?pg(e.schema._def,r):h1(r);case h6.ZodFirstPartyTypeKind.ZodAny:case h6.ZodFirstPartyTypeKind.ZodUnknown:return h1(r);case h6.ZodFirstPartyTypeKind.ZodDefault:return{...pg(e.innerType._def,r),default:e.defaultValue()};case h6.ZodFirstPartyTypeKind.ZodBranded:return h9(e,r);case h6.ZodFirstPartyTypeKind.ZodReadonly:case h6.ZodFirstPartyTypeKind.ZodCatch:return pg(e.innerType._def,r);case h6.ZodFirstPartyTypeKind.ZodPipeline:if("input"===r.pipeStrategy)return pg(e.in._def,r);if("output"===r.pipeStrategy)return pg(e.out._def,r);let y=pg(e.in._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),_=pg(e.out._def,{...r,currentPath:[...r.currentPath,"allOf",y?"1":"0"]});return{allOf:[y,_].filter(e=>void 0!==e)};case h6.ZodFirstPartyTypeKind.ZodFunction:case h6.ZodFirstPartyTypeKind.ZodVoid:case h6.ZodFirstPartyTypeKind.ZodSymbol:default:return}})(e,e.typeName,t),s="function"==typeof a?pg(a(),t):a;if(s&&p_(e,t,s),t.postProcess){let r=t.postProcess(s,e,t);return n.jsonSchema=s,r}return n.jsonSchema=s,s}let py=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:h0(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),h1(t);return"seen"===t.$refStrategy?h1(t):void 0}},p_=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);function pv(e,t){let r=typeof e;if(r!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;let r=e.length;if(r!==t.length)return!1;for(let i=0;i<r;i++)if(!pv(e[i],t[i]))return!1;return!0}if("object"===r){if(!e||!t)return e===t;let r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(let i of r)if(!pv(e[i],t[i]))return!1;return!0}return e===t}function pb(e){return encodeURI(e.replace(/~/g,"~0").replace(/\//g,"~1"))}let pw={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},pE={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},pT={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},pS="undefined"!=typeof self&&self.location&&"null"!==self.location.origin?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function pI(e,t=Object.create(null),r=pS,i=""){if(e&&"object"==typeof e&&!Array.isArray(e)){let n=e.$id||e.id;if(n){let a=new URL(n,r.href);a.hash.length>1?t[a.href]=e:(a.hash="",""===i?r=a:pI(e,t,r))}}else if(!0!==e&&!1!==e)return t;let n=r.href+(i?"#"+i:"");if(void 0!==t[n])throw Error(`Duplicate schema URI "${n}".`);if(t[n]=e,!0===e||!1===e)return t;if(void 0===e.__absolute_uri__&&Object.defineProperty(e,"__absolute_uri__",{enumerable:!1,value:n}),e.$ref&&void 0===e.__absolute_ref__){let t=new URL(e.$ref,r.href);t.hash=t.hash,Object.defineProperty(e,"__absolute_ref__",{enumerable:!1,value:t.href})}if(e.$recursiveRef&&void 0===e.__absolute_recursive_ref__){let t=new URL(e.$recursiveRef,r.href);t.hash=t.hash,Object.defineProperty(e,"__absolute_recursive_ref__",{enumerable:!1,value:t.href})}for(let n in e.$anchor&&(t[new URL("#"+e.$anchor,r.href).href]=e),e){if(pT[n])continue;let a=`${i}/${pb(n)}`,s=e[n];if(Array.isArray(s)){if(pw[n]){let e=s.length;for(let i=0;i<e;i++)pI(s[i],t,r,`${a}/${i}`)}}else if(pE[n])for(let e in s)pI(s[e],t,r,`${a}/${pb(e)}`);else pI(s,t,r,a)}return t}let pO=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,pA=[0,31,28,31,30,31,30,31,31,30,31,30,31],pk=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function px(e){return e.test.bind(e)}let p$={date:pC,time:pN.bind(void 0,!1),"date-time":function(e){let t=e.split(pP);return 2==t.length&&pC(t[0])&&pN(!0,t[1])},duration:e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e)),uri:function(e){return pR.test(e)&&pj.test(e)},"uri-reference":px(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),"uri-template":px(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),url:px(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),email:e=>{if('"'===e[0])return!1;let[t,r,...i]=e.split("@");return!(!t||!r||0!==i.length||t.length>64||r.length>253||"."===t[0]||t.endsWith(".")||t.includes(".."))&&!!/^[a-z0-9.-]+$/i.test(r)&&!!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t)&&r.split(".").every(e=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(e))},hostname:px(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),ipv4:px(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),ipv6:px(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),regex:function(e){if(pU.test(e))return!1;try{return RegExp(e,"u"),!0}catch(e){return!1}},uuid:px(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),"json-pointer":px(/^(?:\/(?:[^~/]|~0|~1)*)*$/),"json-pointer-uri-fragment":px(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),"relative-json-pointer":px(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/)};function pC(e){var t;let r=e.match(pO);if(!r)return!1;let i=+r[1],n=+r[2],a=+r[3];return n>=1&&n<=12&&a>=1&&a<=(2==n&&(t=i)%4==0&&(t%100!=0||t%400==0)?29:pA[n])}function pN(e,t){let r=t.match(pk);if(!r)return!1;let i=+r[1],n=+r[2],a=+r[3],s=!!r[5];return(i<=23&&n<=59&&a<=59||23==i&&59==n&&60==a)&&(!e||s)}let pP=/t|\s/i,pR=/\/|:/,pj=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,pU=/[^\\]\\Z/;function pL(e,t,r="2019-09",i=pI(t),n=!0,a=null,s="#",o="#",l=Object.create(null)){let u;if(!0===t)return{valid:!0,errors:[]};if(!1===t)return{valid:!1,errors:[{instanceLocation:s,keyword:"false",keywordLocation:s,error:"False boolean schema."}]};let c=typeof e;switch(c){case"boolean":case"number":case"string":u=c;break;case"object":u=null===e?"null":Array.isArray(e)?"array":"object";break;default:throw Error(`Instances of "${c}" type are not supported.`)}let{$ref:d,$recursiveRef:h,$recursiveAnchor:p,type:f,const:m,enum:g,required:y,not:_,anyOf:v,allOf:b,oneOf:w,if:E,then:T,else:S,format:I,properties:O,patternProperties:A,additionalProperties:k,unevaluatedProperties:x,minProperties:$,maxProperties:C,propertyNames:N,dependentRequired:P,dependentSchemas:R,dependencies:j,prefixItems:U,items:L,additionalItems:D,unevaluatedItems:M,contains:z,minContains:F,maxContains:B,minItems:Z,maxItems:G,uniqueItems:H,minimum:q,maximum:W,exclusiveMinimum:K,exclusiveMaximum:J,multipleOf:V,minLength:Y,maxLength:X,pattern:Q,__absolute_ref__:ee,__absolute_recursive_ref__:et}=t,er=[];if(!0===p&&null===a&&(a=t),"#"===h){let u=null===a?i[et]:a,c=`${o}/$recursiveRef`,d=pL(e,null===a?t:a,r,i,n,u,s,c,l);d.valid||er.push({instanceLocation:s,keyword:"$recursiveRef",keywordLocation:c,error:"A subschema had errors."},...d.errors)}if(void 0!==d){let t=i[ee||d];if(void 0===t){let e=`Unresolved $ref "${d}".`;throw ee&&ee!==d&&(e+=`  Absolute URI "${ee}".`),Error(e+=`
Known schemas:
- ${Object.keys(i).join("\n- ")}`)}let u=`${o}/$ref`,c=pL(e,t,r,i,n,a,s,u,l);if(c.valid||er.push({instanceLocation:s,keyword:"$ref",keywordLocation:u,error:"A subschema had errors."},...c.errors),"4"===r||"7"===r)return{valid:0===er.length,errors:er}}if(Array.isArray(f)){let t=f.length,r=!1;for(let i=0;i<t;i++)if(u===f[i]||"integer"===f[i]&&"number"===u&&e%1==0&&e==e){r=!0;break}r||er.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${f.join('", "')}".`})}else"integer"===f?("number"!==u||e%1||e!=e)&&er.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${f}".`}):void 0!==f&&u!==f&&er.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${f}".`});if(void 0!==m&&("object"===u||"array"===u?pv(e,m)||er.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`}):e!==m&&er.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`})),void 0!==g&&("object"===u||"array"===u?g.some(t=>pv(e,t))||er.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(t=>e===t)||er.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),void 0!==_){let t=`${o}/not`;pL(e,_,r,i,n,a,s,t).valid&&er.push({instanceLocation:s,keyword:"not",keywordLocation:t,error:'Instance matched "not" schema.'})}let ei=[];if(void 0!==v){let t=`${o}/anyOf`,u=er.length,c=!1;for(let o=0;o<v.length;o++){let u=v[o],d=Object.create(l),h=pL(e,u,r,i,n,!0===p?a:null,s,`${t}/${o}`,d);er.push(...h.errors),c=c||h.valid,h.valid&&ei.push(d)}c?er.length=u:er.splice(u,0,{instanceLocation:s,keyword:"anyOf",keywordLocation:t,error:"Instance does not match any subschemas."})}if(void 0!==b){let t=`${o}/allOf`,u=er.length,c=!0;for(let o=0;o<b.length;o++){let u=b[o],d=Object.create(l),h=pL(e,u,r,i,n,!0===p?a:null,s,`${t}/${o}`,d);er.push(...h.errors),c=c&&h.valid,h.valid&&ei.push(d)}c?er.length=u:er.splice(u,0,{instanceLocation:s,keyword:"allOf",keywordLocation:t,error:"Instance does not match every subschema."})}if(void 0!==w){let t=`${o}/oneOf`,u=er.length,c=w.filter((o,u)=>{let c=Object.create(l),d=pL(e,o,r,i,n,!0===p?a:null,s,`${t}/${u}`,c);return er.push(...d.errors),d.valid&&ei.push(c),d.valid}).length;1===c?er.length=u:er.splice(u,0,{instanceLocation:s,keyword:"oneOf",keywordLocation:t,error:`Instance does not match exactly one subschema (${c} matches).`})}if(("object"===u||"array"===u)&&Object.assign(l,...ei),void 0!==E){let t=`${o}/if`;if(pL(e,E,r,i,n,a,s,t,l).valid){if(void 0!==T){let u=pL(e,T,r,i,n,a,s,`${o}/then`,l);u.valid||er.push({instanceLocation:s,keyword:"if",keywordLocation:t,error:'Instance does not match "then" schema.'},...u.errors)}}else if(void 0!==S){let u=pL(e,S,r,i,n,a,s,`${o}/else`,l);u.valid||er.push({instanceLocation:s,keyword:"if",keywordLocation:t,error:'Instance does not match "else" schema.'},...u.errors)}}if("object"===u){if(void 0!==y)for(let t of y)t in e||er.push({instanceLocation:s,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${t}".`});let t=Object.keys(e);if(void 0!==$&&t.length<$&&er.push({instanceLocation:s,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${$} properties.`}),void 0!==C&&t.length>C&&er.push({instanceLocation:s,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${C} properties.`}),void 0!==N){let t=`${o}/propertyNames`;for(let o in e){let e=`${s}/${pb(o)}`,l=pL(o,N,r,i,n,a,e,t);l.valid||er.push({instanceLocation:s,keyword:"propertyNames",keywordLocation:t,error:`Property name "${o}" does not match schema.`},...l.errors)}}if(void 0!==P){let t=`${o}/dependantRequired`;for(let r in P)if(r in e)for(let i of P[r])i in e||er.push({instanceLocation:s,keyword:"dependentRequired",keywordLocation:t,error:`Instance has "${r}" but does not have "${i}".`})}if(void 0!==R)for(let t in R){let u=`${o}/dependentSchemas`;if(t in e){let o=pL(e,R[t],r,i,n,a,s,`${u}/${pb(t)}`,l);o.valid||er.push({instanceLocation:s,keyword:"dependentSchemas",keywordLocation:u,error:`Instance has "${t}" but does not match dependant schema.`},...o.errors)}}if(void 0!==j){let t=`${o}/dependencies`;for(let o in j)if(o in e){let l=j[o];if(Array.isArray(l))for(let r of l)r in e||er.push({instanceLocation:s,keyword:"dependencies",keywordLocation:t,error:`Instance has "${o}" but does not have "${r}".`});else{let u=pL(e,l,r,i,n,a,s,`${t}/${pb(o)}`);u.valid||er.push({instanceLocation:s,keyword:"dependencies",keywordLocation:t,error:`Instance has "${o}" but does not match dependant schema.`},...u.errors)}}}let u=Object.create(null),c=!1;if(void 0!==O){let t=`${o}/properties`;for(let o in O){if(!(o in e))continue;let d=`${s}/${pb(o)}`,h=pL(e[o],O[o],r,i,n,a,d,`${t}/${pb(o)}`);if(h.valid)l[o]=u[o]=!0;else if(c=n,er.push({instanceLocation:s,keyword:"properties",keywordLocation:t,error:`Property "${o}" does not match schema.`},...h.errors),c)break}}if(!c&&void 0!==A){let t=`${o}/patternProperties`;for(let o in A){let d=RegExp(o,"u"),h=A[o];for(let p in e){if(!d.test(p))continue;let f=`${s}/${pb(p)}`,m=pL(e[p],h,r,i,n,a,f,`${t}/${pb(o)}`);m.valid?l[p]=u[p]=!0:(c=n,er.push({instanceLocation:s,keyword:"patternProperties",keywordLocation:t,error:`Property "${p}" matches pattern "${o}" but does not match associated schema.`},...m.errors))}}}if(c||void 0===k){if(!c&&void 0!==x){let t=`${o}/unevaluatedProperties`;for(let o in e)if(!l[o]){let u=`${s}/${pb(o)}`,c=pL(e[o],x,r,i,n,a,u,t);c.valid?l[o]=!0:er.push({instanceLocation:s,keyword:"unevaluatedProperties",keywordLocation:t,error:`Property "${o}" does not match unevaluated properties schema.`},...c.errors)}}}else{let t=`${o}/additionalProperties`;for(let o in e){if(u[o])continue;let d=`${s}/${pb(o)}`,h=pL(e[o],k,r,i,n,a,d,t);h.valid?l[o]=!0:(c=n,er.push({instanceLocation:s,keyword:"additionalProperties",keywordLocation:t,error:`Property "${o}" does not match additional properties schema.`},...h.errors))}}}else if("array"===u){void 0!==G&&e.length>G&&er.push({instanceLocation:s,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${e.length} > ${G}).`}),void 0!==Z&&e.length<Z&&er.push({instanceLocation:s,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${e.length} < ${Z}).`});let t=e.length,u=0,c=!1;if(void 0!==U){let d=`${o}/prefixItems`,h=Math.min(U.length,t);for(;u<h;u++){let t=pL(e[u],U[u],r,i,n,a,`${s}/${u}`,`${d}/${u}`);if(l[u]=!0,!t.valid&&(c=n,er.push({instanceLocation:s,keyword:"prefixItems",keywordLocation:d,error:"Items did not match schema."},...t.errors),c))break}}if(void 0!==L){let d=`${o}/items`;if(Array.isArray(L)){let o=Math.min(L.length,t);for(;u<o;u++){let t=pL(e[u],L[u],r,i,n,a,`${s}/${u}`,`${d}/${u}`);if(l[u]=!0,!t.valid&&(c=n,er.push({instanceLocation:s,keyword:"items",keywordLocation:d,error:"Items did not match schema."},...t.errors),c))break}}else for(;u<t;u++){let t=pL(e[u],L,r,i,n,a,`${s}/${u}`,d);if(l[u]=!0,!t.valid&&(c=n,er.push({instanceLocation:s,keyword:"items",keywordLocation:d,error:"Items did not match schema."},...t.errors),c))break}if(!c&&void 0!==D){let d=`${o}/additionalItems`;for(;u<t;u++){let t=pL(e[u],D,r,i,n,a,`${s}/${u}`,d);l[u]=!0,t.valid||(c=n,er.push({instanceLocation:s,keyword:"additionalItems",keywordLocation:d,error:"Items did not match additional items schema."},...t.errors))}}}if(void 0!==z)if(0===t&&void 0===F)er.push({instanceLocation:s,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(void 0!==F&&t<F)er.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${t}) than minContains (${F}).`});else{let u=`${o}/contains`,c=er.length,d=0;for(let o=0;o<t;o++){let t=pL(e[o],z,r,i,n,a,`${s}/${o}`,u);t.valid?(l[o]=!0,d++):er.push(...t.errors)}d>=(F||0)&&(er.length=c),void 0===F&&void 0===B&&0===d?er.splice(c,0,{instanceLocation:s,keyword:"contains",keywordLocation:u,error:"Array does not contain item matching schema."}):void 0!==F&&d<F?er.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${F} items matching schema. Only ${d} items were found.`}):void 0!==B&&d>B&&er.push({instanceLocation:s,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${B} items matching schema. ${d} items were found.`})}if(!c&&void 0!==M){let c=`${o}/unevaluatedItems`;for(;u<t;u++){if(l[u])continue;let t=pL(e[u],M,r,i,n,a,`${s}/${u}`,c);l[u]=!0,t.valid||er.push({instanceLocation:s,keyword:"unevaluatedItems",keywordLocation:c,error:"Items did not match unevaluated items schema."},...t.errors)}}if(H)for(let r=0;r<t;r++){let i=e[r],n="object"==typeof i&&null!==i;for(let a=0;a<t;a++){if(r===a)continue;let t=e[a],l="object"==typeof t&&null!==t;(i===t||n&&l&&pv(i,t))&&(er.push({instanceLocation:s,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${r} and ${a}.`}),r=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER)}}}else if("number"===u){if("4"===r?(void 0!==q&&(!0===K&&e<=q||e<q)&&er.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${K?"or equal to ":""} ${q}.`}),void 0!==W&&(!0===J&&e>=W||e>W)&&er.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${J?"or equal to ":""} ${W}.`})):(void 0!==q&&e<q&&er.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${q}.`}),void 0!==W&&e>W&&er.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${W}.`}),void 0!==K&&e<=K&&er.push({instanceLocation:s,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${e} is less than ${K}.`}),void 0!==J&&e>=J&&er.push({instanceLocation:s,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${e} is greater than or equal to ${J}.`})),void 0!==V){let t=e%V;Math.abs(0-t)>=11920929e-14&&Math.abs(V-t)>=11920929e-14&&er.push({instanceLocation:s,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${e} is not a multiple of ${V}.`})}}else if("string"===u){let t=void 0===Y&&void 0===X?0:function(e){let t,r=0,i=e.length,n=0;for(;n<i;)r++,(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<i&&(64512&(t=e.charCodeAt(n)))==56320&&n++;return r}(e);void 0!==Y&&t<Y&&er.push({instanceLocation:s,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${t} < ${Y}).`}),void 0!==X&&t>X&&er.push({instanceLocation:s,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${t} > ${X}).`}),void 0===Q||RegExp(Q,"u").test(e)||er.push({instanceLocation:s,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),void 0!==I&&p$[I]&&!p$[I](e)&&er.push({instanceLocation:s,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${I}".`})}return{valid:0===er.length,errors:er}}(V=ty||(ty={}))[V.Flag=1]="Flag",V[V.Basic=2]="Basic",V[V.Detailed=4]="Detailed";class pD{schema;draft;shortCircuit;lookup;constructor(e,t="2019-09",r=!0){this.schema=e,this.draft=t,this.shortCircuit=r,this.lookup=pI(e)}validate(e){return pL(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e={...e,$id:t}),pI(e,this.lookup)}}function pM(e){if(hS(e)){let t=hJ(e,!0);return hM(t)?hE(hW(t,!0)):hE(e)}return hI(e)?((e,t)=>{let r,i,n=(i=void 0!==(r="string"==typeof t?{...hQ,name:t}:{...hQ,...t}).name?[...r.basePath,r.definitionPath,r.name]:r.basePath,{...r,flags:{hasReferencedOpenAiAnyType:!1},currentPath:i,propertyPath:void 0,seen:new Map(Object.entries(r.definitions).map(([e,t])=>[t._def,{def:t._def,path:[...r.basePath,r.definitionPath,e],jsonSchema:void 0}]))}),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,r])=>({...e,[t]:pg(r._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??h1(n)}),{}):void 0,s="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,o=pg(e._def,void 0===s?n:{...n,currentPath:[...n.basePath,n.definitionPath,s]},!1)??h1(n),l="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==l&&(o.title=l),n.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[n.openAiAnyTypeName]||(a[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===n.$refStrategy?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));let u=void 0===s?a?{...o,[n.definitionPath]:a}:o:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...a,[s]:o}};return"jsonSchema7"===n.target?u.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===n.target||"openAi"===n.target)&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===n.target&&("anyOf"in u||"oneOf"in u||"allOf"in u||"type"in u&&Array.isArray(u.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),u})(e):e}function pz(e){if(!e||"object"!=typeof e||0===Object.keys(e).length||Array.isArray(e))return!1;if("type"in e)return"string"==typeof e.type?"string"===e.type:!!Array.isArray(e.type)&&e.type.every(e=>"string"===e);if("enum"in e)return Array.isArray(e.enum)&&e.enum.length>0&&e.enum.every(e=>"string"==typeof e);if("const"in e)return"string"==typeof e.const;if("allOf"in e&&Array.isArray(e.allOf))return e.allOf.some(e=>pz(e));if("anyOf"in e&&Array.isArray(e.anyOf)||"oneOf"in e&&Array.isArray(e.oneOf)){let t="anyOf"in e?e.anyOf:e.oneOf;return t.length>0&&t.every(e=>pz(e))}if("not"in e)return!1;if("$ref"in e&&"string"==typeof e.$ref){let t=e.$ref,r=pI(e);if(r[t])return pz(r[t])}return!1}iI({},{Validator:()=>pD,deepCompareStrict:()=>pv,toJsonSchema:()=>pM,validatesOnlyStrings:()=>pz});let pF=Object.prototype.toString,pB=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function pZ(e,t,{min:r=0,allowInfinity:i=!1}={}){if(void 0!==t){if("number"!=typeof t||Number.isNaN(t))throw TypeError(`Expected \`${e}\` to be a number${i?" or Infinity":""}.`);if(!i&&!Number.isFinite(t))throw TypeError(`Expected \`${e}\` to be a finite number.`);if(t<r)throw TypeError(`Expected \`${e}\` to be \u2265 ${r}.`)}}var pG=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}};function pH(e,t){return Number.isFinite(t)?t-(performance.now()-e):t}async function pq({error:e,attemptNumber:t,retriesConsumed:r,startTime:i,options:n}){let a,s=e instanceof Error?e:TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(s instanceof pG)throw s.originalError;let o=Number.isFinite(n.retries)?Math.max(0,n.retries-r):n.retries,l=n.maxRetryTime??1/0,u=Object.freeze({error:s,attemptNumber:t,retriesLeft:o,retriesConsumed:r});if(await n.onFailedAttempt(u),0>=pH(i,l))throw s;let c=await n.shouldConsumeRetry(u),d=pH(i,l);if(d<=0||o<=0)throw s;if(s instanceof TypeError&&!function(e){if(!(e&&"[object Error]"===pF.call(e)&&"TypeError"===e.name&&"string"==typeof e.message))return!1;let{message:t,stack:r}=e;return"Load failed"===t?void 0===r||"__sentry_captured__"in e:!!t.startsWith("error sending request for url")||pB.has(t)}(s)){if(c)throw s;return n.signal?.throwIfAborted(),!1}if(!await n.shouldRetry(u))throw s;if(!c)return n.signal?.throwIfAborted(),!1;let h=Math.min((a=Math.max(1,r+1),Math.min(Math.round((n.randomize?Math.random()+1:1)*n.minTimeout*n.factor**(a-1)),n.maxTimeout)),d);return h>0&&await new Promise((e,t)=>{let r=()=>{clearTimeout(i),n.signal?.removeEventListener("abort",r),t(n.signal.reason)},i=setTimeout(()=>{n.signal?.removeEventListener("abort",r),e()},h);n.unref&&i.unref?.(),n.signal?.addEventListener("abort",r,{once:!0})}),n.signal?.throwIfAborted(),!0}async function pW(e,t={}){var r=(t={...t}).retries;if("number"==typeof r){if(r<0)throw TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(r))throw TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(void 0!==r)throw TypeError("Expected `retries` to be a number or Infinity.");if(Object.hasOwn(t,"forever"))throw Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");t.retries??=10,t.factor??=2,t.minTimeout??=1e3,t.maxTimeout??=1/0,t.maxRetryTime??=1/0,t.randomize??=!1,t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.shouldConsumeRetry??=()=>!0,pZ("factor",t.factor,{min:0,allowInfinity:!1}),pZ("minTimeout",t.minTimeout,{min:0,allowInfinity:!1}),pZ("maxTimeout",t.maxTimeout,{min:0,allowInfinity:!0}),pZ("maxRetryTime",t.maxRetryTime,{min:0,allowInfinity:!0}),t.factor>0||(t.factor=1),t.signal?.throwIfAborted();let i=0,n=0,a=performance.now();for(;!Number.isFinite(t.retries)||n<=t.retries;){i++;try{t.signal?.throwIfAborted();let r=await e(i);return t.signal?.throwIfAborted(),r}catch(e){await pq({error:e,attemptNumber:i,retriesConsumed:n,startTime:a,options:t})&&n++}}throw Error("Retry attempts exhausted without throwing an error.")}let pK=Object.prototype.hasOwnProperty;function pJ(e,t){return pK.call(e,t)}function pV(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)pJ(e,r)&&t.push(r);return t}function pY(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function pX(e){let t,r=0,i=e.length;for(;r<i;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function pQ(e){return -1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function p0(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function p1(e,t){let r=[e];for(let e in t){let i="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==i&&r.push(`${e}: ${i}`)}return r.join("\n")}var p4=class extends Error{constructor(e,t,r,i,n){super(p1(e,{name:t,index:r,operation:i,tree:n})),this.name=t,this.index=r,this.operation=i,this.tree=n,Object.setPrototypeOf(this,new.target.prototype),this.message=p1(e,{name:t,index:r,operation:i,tree:n})}},p2={};iI(p2,{JsonPatchError:()=>p6,_areEquals:()=>fn,applyOperation:()=>p7,applyPatch:()=>fe,applyReducer:()=>ft,deepClone:()=>p9,getValueByPointer:()=>p8,validate:()=>fi,validator:()=>fr});let p6=p4,p9=pY,p3={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var i=e[t];return delete e[t],{newDocument:r,removed:i}},replace:function(e,t,r){var i=e[t];return e[t]=this.value,{newDocument:r,removed:i}},move:function(e,t,r){let i=p8(r,this.path);i&&(i=pY(i));let n=p7(r,{op:"remove",path:this.from}).removed;return p7(r,{op:"add",path:this.path,value:n}),{newDocument:r,removed:i}},copy:function(e,t,r){let i=p8(r,this.from);return p7(r,{op:"add",path:this.path,value:pY(i)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:fn(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var p5={add:function(e,t,r){return pX(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var i=e[t];return e[t]=this.value,{newDocument:r,removed:i}},move:p3.move,copy:p3.copy,test:p3.test,_get:p3._get};function p8(e,t){if(""==t)return e;var r={op:"_get",path:t};return p7(e,r),r.value}function p7(e,t,r=!1,i=!0,n=!0,a=0){if(r&&("function"==typeof r?r(t,0,e,t.path):fr(t,0)),""===t.path){let i={newDocument:e};if("add"===t.op)return i.newDocument=t.value,i;if("replace"===t.op)return i.newDocument=t.value,i.removed=e,i;if("move"===t.op||"copy"===t.op)return i.newDocument=p8(e,t.from),"move"===t.op&&(i.removed=e),i;else if("test"===t.op){if(i.test=fn(e,t.value),!1===i.test)throw new p6("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i.newDocument=e,i}else if("remove"===t.op)return i.removed=e,i.newDocument=null,i;else if("_get"===t.op)return t.value=e,i;else if(!r)return i;else throw new p6("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e)}{let s,o,l;i||(e=pY(e));let u=(t.path||"").split("/"),c=e,d=1,h=u.length;for(o="function"==typeof r?r:fr;;){if((s=u[d])&&-1!=s.indexOf("~")&&(s=p0(s)),n&&("__proto__"==s||"prototype"==s&&d>0&&"constructor"==u[d-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===l&&(void 0===c[s]?l=u.slice(0,d).join("/"):d==h-1&&(l=t.path),void 0!==l&&o(t,0,e,l)),d++,Array.isArray(c)){if("-"===s)s=c.length;else if(r&&!pX(s))throw new p6("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);else pX(s)&&(s=~~s);if(d>=h){if(r&&"add"===t.op&&s>c.length)throw new p6("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);let i=p5[t.op].call(t,c,s,e);if(!1===i.test)throw new p6("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i}}else if(d>=h){let r=p3[t.op].call(t,c,s,e);if(!1===r.test)throw new p6("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return r}if(c=c[s],r&&d<h&&(!c||"object"!=typeof c))throw new p6("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}}function fe(e,t,r,i=!0,n=!0){if(r&&!Array.isArray(t))throw new p6("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=pY(e));let a=Array(t.length);for(let i=0,s=t.length;i<s;i++)a[i]=p7(e,t[i],r,!0,n,i),e=a[i].newDocument;return a.newDocument=e,a}function ft(e,t,r){let i=p7(e,t);if(!1===i.test)throw new p6("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return i.newDocument}function fr(e,t,r,i){if("object"!=typeof e||null===e||Array.isArray(e))throw new p6("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(p3[e.op]){if("string"!=typeof e.path)throw new p6("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);else if(0!==e.path.indexOf("/")&&e.path.length>0)throw new p6('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);else if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new p6("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new p6("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t){if(Array.isArray(t)){for(let r=0,i=t.length;r<i;r++)if(e(t[r]))return!0}else if("object"==typeof t){let i=pV(t),n=i.length;for(var r=0;r<n;r++)if(e(t[i[r]]))return!0}}return!1}(e.value))throw new p6("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var n=e.path.split("/").length,a=i.split("/").length;if(n!==a+1&&n!==a)throw new p6("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==i)throw new p6("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var s=fi([{op:"_get",path:e.from,value:void 0}],r);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new p6("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new p6("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function fi(e,t,r){try{if(!Array.isArray(e))throw new p6("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)fe(pY(t),pY(e),r||!0);else{r=r||fr;for(var i=0;i<e.length;i++)r(e[i],i,t,void 0)}}catch(e){if(e instanceof p6)return e;throw e}}function fn(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,i,n,a=Array.isArray(e),s=Array.isArray(t);if(a&&s){if((i=e.length)!=t.length)return!1;for(r=i;0!=r--;)if(!fn(e[r],t[r]))return!1;return!0}if(a!=s)return!1;var o=Object.keys(e);if((i=o.length)!==Object.keys(t).length)return!1;for(r=i;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=i;0!=r--;)if(!fn(e[n=o[r]],t[n]))return!1;return!0}return e!=e&&t!=t}function fa(e,t,r=!1){var i=[];return!function e(t,r,i,n,a){if(r!==t){"function"==typeof r.toJSON&&(r=r.toJSON());for(var s=pV(r),o=pV(t),l=!1,u=o.length-1;u>=0;u--){var c=o[u],d=t[c];if(pJ(r,c)&&(void 0!==r[c]||void 0===d||!1!==Array.isArray(r))){var h=r[c];"object"==typeof d&&null!=d&&"object"==typeof h&&null!=h&&Array.isArray(d)===Array.isArray(h)?e(d,h,i,n+"/"+pQ(c),a):d!==h&&(a&&i.push({op:"test",path:n+"/"+pQ(c),value:pY(d)}),i.push({op:"replace",path:n+"/"+pQ(c),value:pY(h)}))}else Array.isArray(t)===Array.isArray(r)?(a&&i.push({op:"test",path:n+"/"+pQ(c),value:pY(d)}),i.push({op:"remove",path:n+"/"+pQ(c)}),l=!0):(a&&i.push({op:"test",path:n,value:t}),i.push({op:"replace",path:n,value:r}))}if(l||s.length!=o.length)for(var u=0;u<s.length;u++){var c=s[u];pJ(t,c)||void 0===r[c]||i.push({op:"add",path:n+"/"+pQ(c),value:pY(r[c])})}}}(e,t,i,"",r),i}({...p2,JsonPatchError:p4,deepClone:pY,escapePathComponent:pQ,unescapePathComponent:p0}),iI({},{LogStreamCallbackHandler:()=>fd,RunLog:()=>fo,RunLogPatch:()=>fs,isLogStreamHandler:()=>fl});var fs=class{ops;constructor(e){this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=fe({},t);return new fo({ops:t,state:r[r.length-1].newDocument})}},fo=class e extends fs{state;constructor(e){super(e),this.state=e.state}concat(t){let r=this.ops.concat(t.ops),i=fe(this.state,t.ops);return new e({ops:r,state:i[i.length-1].newDocument})}static fromRunLogPatch(t){let r=fe({},t.ops);return new e({ops:t.ops,state:r[r.length-1].newDocument})}};let fl=e=>"log_stream_tracer"===e.name;async function fu(e,t){if("original"===t)throw Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:r}=e;return["retriever","llm","prompt"].includes(e.run_type)?r:1!==Object.keys(r).length||r?.input!==""?r.input:void 0}async function fc(e,t){let{outputs:r}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?r:void 0!==r&&1===Object.keys(r).length&&r?.output!==void 0?r.output:r}var fd=class extends sp{autoClose=!0;includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;_schemaFormat="original";rootId;keyMapByRunId={};counterMapByRunName={};transformStream;writer;receiveStream;name="log_stream_tracer";lc_prefer_streaming=!0;constructor(e){super({_awaitHandler:!0,...e}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ot.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let t=this.keyMapByRunId[e];t&&await this.writer.write(new fs({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new fs({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(r.inputs=await fu(e,this._schemaFormat)),await this.writer.write(new fs({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(void 0===t)return;let r=[];"streaming_events"===this._schemaFormat&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await fu(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await fc(e,this._schemaFormat)}),void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let i=new fs({ops:r});await this.writer.write(i)}finally{if(e.id===this.rootId){let t=new fs({ops:[{op:"replace",path:"/final_output",value:await fc(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let i,n=this.keyMapByRunId[e.id];if(void 0===n)return;if(void 0!==e.inputs.messages){var a;i=void 0!==(a=r?.chunk)&&void 0!==a.message?r?.chunk:new nX({id:`run-${e.id}`,content:t})}else i=t;let s=new fs({ops:[{op:"add",path:`/logs/${n}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${n}/streamed_output/-`,value:i}]});await this.writer.write(s)}};function fh({name:e,serialized:t}){return void 0!==e?e:t?.name!==void 0?t.name:t?.id!==void 0&&Array.isArray(t?.id)?t.id[t.id.length-1]:"Unnamed"}let fp=e=>"event_stream_tracer"===e.name;var ff=class extends sp{autoClose=!0;includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;runInfoMap=new Map;tappedPromises=new Map;transformStream;writer;receiveStream;name="event_stream_tracer";lc_prefer_streaming=!0;constructor(e){super({_awaitHandler:!0,...e}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ot.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.runType)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.runType)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){let r=await t.next();if(r.done)return;let i=this.runInfoMap.get(e);if(void 0===i)return void(yield r.value);function n(e,t){return"llm"===e&&"string"==typeof t?new oo({text:t}):t}let a=this.tappedPromises.get(e);if(void 0===a){let s;a=new Promise(e=>{s=e}),this.tappedPromises.set(e,a);try{let a={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};for await(let e of(await this.send({...a,data:{chunk:n(i.runType,r.value)}},i),yield r.value,t))"tool"!==i.runType&&"retriever"!==i.runType&&await this.send({...a,data:{chunk:n(i.runType,e)}},i),yield e}finally{s?.()}}else for await(let e of(yield r.value,t))yield e}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let r=this.tappedPromises.get(e.run_id);void 0!==r?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=fh(e),r=void 0!==e.inputs.messages?"chat_model":"llm",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,i);let n=`on_${r}_start`;await this.send({event:n,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onLLMNewToken(e,t,r){let i,n,a=this.runInfoMap.get(e.id);if(void 0===a)throw Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===a.runType)n="on_chat_model_stream",i=r?.chunk===void 0?new nX({content:t,id:`run-${e.id}`}):r.chunk.message;else if("llm"===a.runType)n="on_llm_stream",i=r?.chunk===void 0?new oo({text:t}):r.chunk;else throw Error(`Unexpected run type ${a.runType}`);await this.send({event:n,data:{chunk:i},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){let t,r,i=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===i)throw Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let n=e.outputs?.generations;if("chat_model"===i.runType){for(let e of n??[]){if(void 0!==r)break;r=e[0]?.message}t="on_chat_model_end"}else if("llm"===i.runType)r={generations:n?.map(e=>e.map(e=>({text:e.text,generationInfo:e.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},t="on_llm_end";else throw Error(`onLLMEnd: Unexpected run type: ${i.runType}`);await this.sendEndEvent({event:t,data:{output:r,input:i.inputs},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}async onChainStart(e){let t=fh(e),r=e.run_type??"chain",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},n={};""===e.inputs.input&&1===Object.keys(e.inputs).length?(n={},i.inputs={}):void 0!==e.inputs.input?(n.input=e.inputs.input,i.inputs=e.inputs.input):(n.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),await this.send({event:`on_${r}_start`,data:n,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,i=e.inputs??t.inputs??{},n={output:e.outputs?.output??e.outputs,input:i};i.input&&1===Object.keys(i).length&&(n.input=i.input,t.inputs=i.input),await this.sendEndEvent({event:r,data:n,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=fh(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(void 0===t.inputs)throw Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=fh(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,r),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){let i=this.runInfoMap.get(r);if(void 0===i)throw Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:i.tags,metadata:i.metadata,data:t},i)}async finish(){Promise.all([...this.tappedPromises.values()]).finally(()=>{this.writer.close()})}};iI({},{AsyncCaller:()=>fy});let fm=[400,401,402,403,404,405,406,407,409],fg=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&fm.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};var fy=class{maxConcurrency;maxRetries;onFailedAttempt;queue;constructor(e){this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??fg;const t="default"in sM?sM.default:sM;this.queue=new t({concurrency:this.maxConcurrency})}async call(e,...t){return this.queue.add(()=>pW(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:({error:e})=>this.onFailedAttempt?.(e),retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){if(e.signal){let i;return Promise.race([this.call(t,...r),new Promise((t,r)=>{i=()=>{r(oe(e.signal))},e.signal?.addEventListener("abort",i)})]).finally(()=>{e.signal&&i&&e.signal.removeEventListener("abort",i)})}return this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}},f_=class extends sp{name="RootListenersTracer";rootId;config;argOnStart;argOnEnd;argOnError;constructor({config:e,onStart:t,onEnd:r,onError:i}){super({_awaitHandler:!0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){!this.rootId&&(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function fv(e){return!!e&&e.lc_runnable}var fb=class{includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;constructor(e){this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags,i=e.tags??[];return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(t)),void 0!==this.includeTags&&(r=r||i.some(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(r=r&&i.every(e=>!this.excludeTags?.includes(e))),r}};function fw(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}let fE=["*","_","`"];async function fT(e,t){let r=t?.backgroundColor??"white",i=t?.imageType??"png",n=btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");void 0!==r&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));let a=`https://mermaid.ink/img/${n}?bgColor=${r}&type=${i}`,s=await fetch(a);if(!s.ok)throw Error(`Failed to render the graph using the Mermaid.INK API.
Status code: ${s.status}
Status text: ${s.statusText}`);return await s.blob()}iI({},{Graph:()=>fS});var fS=class e{nodes={};edges=[];constructor(e){this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=an(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...fv(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...pM(t.data.schema),title:t.data.name}}})),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return void 0!==t.data&&(r.data=t.data),void 0!==t.conditional&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(void 0!==t&&void 0!==this.nodes[t])throw Error(`Node with id ${t} already exists`);let i=t??ao(),n={id:i,data:e,name:function(e,t){if(void 0!==e&&!an(e))return e;if(!fv(t))return t.name??"UnknownSchema";try{let e=t.getName();return e=e.startsWith("Runnable")?e.slice(8):e}catch{return t.getName()}}(t,e),metadata:r};return this.nodes[i]=n,n}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,i){if(void 0===this.nodes[e.id])throw Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw Error(`Target node ${t.id} not in graph`);let n={source:e.id,target:t.id,data:r,conditional:i};return this.edges.push(n),n}firstNode(){return fI(this)}lastNode(){return fO(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(e=>e.id).every(an)&&(r="");let i=e=>r?`${r}:${e}`:e;Object.entries(e.nodes).forEach(([e,t])=>{this.nodes[i(e)]={...t,id:i(e)}});let n=e.edges.map(e=>({...e,source:i(e.source),target:i(e.target)}));this.edges=[...this.edges,...n];let a=e.firstNode(),s=e.lastNode();return[a?{id:i(a.id),data:a.data}:void 0,s?{id:i(s.id),data:s.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&fI(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&fO(this,[e.id])&&this.removeNode(e)}reid(){let t=Object.fromEntries(Object.values(this.nodes).map(e=>[e.id,e.name])),r=new Map;Object.values(t).forEach(e=>{r.set(e,(r.get(e)||0)+1)});let i=e=>{let i=t[e];return an(e)&&1===r.get(i)?i:e};return new e({nodes:Object.fromEntries(Object.entries(this.nodes).map(([e,t])=>[i(e),{...t,id:i(e)}])),edges:this.edges.map(e=>({...e,source:i(e.source),target:i(e.target)}))})}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:i={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:n}=e??{},a=this.reid(),s=a.firstNode(),o=a.lastNode();return function(e,t,r){let{firstNode:i,lastNode:n,nodeColors:a,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=r??{},u=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:"graph TD;\n";if(s){let t="default",r={[t]:"{0}({1})"};for(let[a,s]of(void 0!==i&&(r[i]="{0}([{1}]):::first"),void 0!==n&&(r[n]="{0}([{1}]):::last"),Object.entries(e))){let e=s.name.split(":").pop()??"",i=fE.some(t=>e.startsWith(t)&&e.endsWith(t))?`<p>${e}</p>`:e;Object.keys(s.metadata??{}).length&&(i+=`<hr/><small><em>${Object.entries(s.metadata??{}).map(([e,t])=>`${e} = ${t}`).join("\n")}</em></small>`);let n=(r[a]??r[t]).replace("{0}",fw(a)).replace("{1}",i);u+=`	${n}
`}}let c={};for(let e of t){let t=e.source.split(":"),r=e.target.split(":"),i=t.filter((e,t)=>e===r[t]).join(":");c[i]||(c[i]=[]),c[i].push(e)}let d=new Set;function h(e,t){let r=1===e.length&&e[0].source===e[0].target;if(t&&!r){let e=t.split(":").pop();if(d.has(e))throw Error(`Found duplicate subgraph '${e}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(e),u+=`	subgraph ${e}
`}for(let t of e){let{source:e,target:r,data:i,conditional:n}=t,a="";if(void 0!==i){let e=i,t=e.split(" ");t.length>l&&(e=Array.from({length:Math.ceil(t.length/l)},(e,r)=>t.slice(r*l,(r+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),a=n?` -. &nbsp;${e}&nbsp; .-> `:` -- &nbsp;${e}&nbsp; --> `}else a=n?" -.-> ":" --> ";u+=`	${fw(e)}${a}${fw(r)};
`}for(let e in c)e.startsWith(`${t}:`)&&e!==t&&h(c[e],e);t&&!r&&(u+="	end\n")}for(let e in h(c[""]??[],""),c)e.includes(":")||""===e||h(c[e],e);return s&&(u+=function(e){let t="";for(let[r,i]of Object.entries(e))t+=`	classDef ${r} ${i};
`;return t}(a??{})),u}(a.nodes,a.edges,{firstNode:s?.id,lastNode:o?.id,withStyles:t,curveStyle:r,nodeColors:i,wrapLabelNWords:n})}async drawMermaidPng(e){return fT(this.drawMermaid(e),{backgroundColor:e?.backgroundColor})}};function fI(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.source)).map(e=>e.target)),i=[];for(let n of Object.values(e.nodes))t.includes(n.id)||r.has(n.id)||i.push(n);return 1===i.length?i[0]:void 0}function fO(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.target)).map(e=>e.source)),i=[];for(let n of Object.values(e.nodes))t.includes(n.id)||r.has(n.id)||i.push(n);return 1===i.length?i[0]:void 0}function fA(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}function fk(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*fx(e,t){for(;;){let{value:r,done:i}=s4.runWithConfig(s8(e),t.next.bind(t),!0);if(i)break;yield r}}async function*f$(e,t){let r=t[Symbol.asyncIterator]();for(;;){let{value:i,done:n}=await s4.runWithConfig(s8(e),r.next.bind(t),!0);if(n)break;yield i}}var fC=e.i(331612);function fN(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}var fP=class extends iW{lc_runnable=!0;name;getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}withRetry(e){return new fU({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new fR({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new fB({runnable:this,fallbacks:Array.isArray(e)?e:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(s3);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([e])=>"runId"!==e));return Array.from({length:t},(t,i)=>s3(0===i?e:r))}return Array.from({length:t},()=>s3(e))}async batch(e,t,r){let i=this._getOptionsList(t??{},e.length),n=new fy({maxConcurrency:i[0]?.maxConcurrency??r?.maxConcurrency,onFailedAttempt:e=>{throw e}});return Promise.all(e.map((e,t)=>n.call(async()=>{try{return await this.invoke(e,i[t])}catch(e){if(r?.returnExceptions)return e;throw e}})))}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=s3(t),i=new on({generator:this._streamIterator(e,r),config:r});return await i.setup,ot.fromAsyncGenerator(i)}_separateRunnableConfigFromCallOptions(e){let t;t=void 0===e?s3(e):s3({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){let i,n=s3(r),a=await s2(n),s=await a?.handleChainStart(this.toJSON(),fN(t,"input"),n.runId,n?.runType,void 0,void 0,n?.runName??this.getName());delete n.runId;try{let a=e.call(this,t,n,s);i=await s7(a,r?.signal)}catch(e){throw await s?.handleChainError(e),e}return await s?.handleChainEnd(fN(i,"output")),i}async _batchWithConfig(e,t,r,i){let n,a=this._getOptionsList(r??{},t.length),s=await Promise.all(a.map(s2)),o=await Promise.all(s.map(async(e,r)=>{let i=await e?.handleChainStart(this.toJSON(),fN(t[r],"input"),a[r].runId,a[r].runType,void 0,void 0,a[r].runName??this.getName());return delete a[r].runId,i}));try{let r=e.call(this,t,a,o,i);n=await s7(r,a?.[0]?.signal)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(fN(n,"output")))),n}_concatOutputChunks(e,t){return oi(e,t)}async *_transformStreamWithConfig(e,t,r){let i,n,a,s=!0,o=!0,l=s3(r),u=await s2(l),c=this;async function*d(){for await(let t of e){if(s)if(void 0===i)i=t;else try{i=c._concatOutputChunks(i,t)}catch{i=void 0,s=!1}yield t}}try{let e=await oa(t.bind(this),d(),async()=>u?.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),r?.signal,l);delete l.runId,a=e.setup;let i=a?.handlers.find(fp),s=e.output;void 0!==i&&void 0!==a&&(s=i.tapOutputIterable(a.runId,s));let c=a?.handlers.find(fl);for await(let e of(void 0!==c&&void 0!==a&&(s=c.tapOutputIterable(a.runId,s)),s))if(yield e,o)if(void 0===n)n=e;else try{n=this._concatOutputChunks(n,e)}catch{n=void 0,o=!1}}catch(e){throw await a?.handleChainError(e,void 0,void 0,void 0,{inputs:fN(i,"input")}),e}await a?.handleChainEnd(n??{},void 0,void 0,void 0,{inputs:fN(i,"input")})}getGraph(e){let t=new fS,r=t.addNode({name:`${this.getName()}Input`,schema:fC.z.any()}),i=t.addNode(this),n=t.addNode({name:`${this.getName()}Output`,schema:fC.z.any()});return t.addEdge(r,i),t.addEdge(i,n),t}pipe(e){return new fL({first:this,last:fZ(e)})}pick(e){return this.pipe(new fH(e))}assign(e){return this.pipe(new fG(new fD({steps:e})))}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:this._concatOutputChunks(r,t);yield*this._streamIterator(r,s3(t))}async *streamLog(e,t,r){let i=new fd({...r,autoClose:!1,_schemaFormat:"original"}),n=s3(t);yield*this._streamLog(e,i,n)}async *_streamLog(e,t,r){let{callbacks:i}=r;if(void 0===i)r.callbacks=[t];else if(Array.isArray(i))r.callbacks=i.concat([t]);else{let e=i.copy();e.addHandler(t,!0),r.callbacks=e}let n=this.stream(e,r),a=async function(){try{for await(let e of(await n)){let r=new fs({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await t.writer.write(r)}}finally{await t.writer.close()}}();try{for await(let e of t)yield e}finally{await a}}streamEvents(e,t,r){var i;let n,a,s;if("v1"===t.version)n=this._streamEventsV1(e,t,r);else if("v2"===t.version)n=this._streamEventsV2(e,t,r);else throw Error('Only versions "v1" and "v2" of the schema are currently supported.');if("text/event-stream"!==t.encoding)return ot.fromAsyncGenerator(n);return i=n,a=new TextEncoder,s=new ReadableStream({async start(e){for await(let t of i)e.enqueue(a.encode(`event: data
data: ${JSON.stringify(t)}

`));e.enqueue(a.encode("event: end\n\n")),e.close()}}),ot.fromReadableStream(s)}async *_streamEventsV2(e,t,r){let i,n=new ff({...r,autoClose:!1}),a=s3(t),s=a.runId??ao();a.runId=s;let o=a.callbacks;if(void 0===o)a.callbacks=[n];else if(Array.isArray(o))a.callbacks=o.concat(n);else{let e=o.copy();e.addHandler(n,!0),a.callbacks=e}let l=new AbortController,u=this,c=async function(){let r,i=null;try{t?.signal?"any"in AbortSignal?r=AbortSignal.any([l.signal,t.signal]):(r=t.signal,i=()=>{l.abort()},t.signal.addEventListener("abort",i,{once:!0})):r=l.signal;let o=await u.stream(e,{...a,signal:r});for await(let e of n.tapOutputIterable(s,o))if(l.signal.aborted)break}finally{await n.finish(),r&&i&&r.removeEventListener("abort",i)}}(),d=!1;try{for await(let t of n){if(!d){t.data.input=e,d=!0,i=t.run_id,yield t;continue}t.run_id===i&&t.event.endsWith("_end")&&t.data?.input&&delete t.data.input,yield t}}finally{l.abort(),await c}}async *_streamEventsV1(e,t,r){let i,n=!1,a=s3(t),s=a.tags??[],o=a.metadata??{},l=a.runName??this.getName(),u=new fd({...r,autoClose:!1,_schemaFormat:"streaming_events"}),c=new fb({...r});for await(let t of this._streamLog(e,u,a)){if(void 0===(i=i?i.concat(t):fo.fromRunLogPatch(t)).state)throw Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!n){n=!0;let t={...i.state},r={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:s,metadata:o,data:{input:e}};c.includeEvent(r,t.type)&&(yield r)}for(let e of[...new Set(t.ops.filter(e=>e.path.startsWith("/logs/")).map(e=>e.path.split("/")[2]))]){let t,r={},n=i.state.logs[e];if("start"==(t=void 0===n.end_time?n.streamed_output.length>0?"stream":"start":"end"))void 0!==n.inputs&&(r.input=n.inputs);else if("end"===t)void 0!==n.inputs&&(r.input=n.inputs),r.output=n.final_output;else if("stream"===t){let e=n.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${n.name}"`);r={chunk:n.streamed_output[0]},n.streamed_output=[]}yield{event:`on_${n.type}_${t}`,name:n.name,run_id:n.id,tags:n.tags,metadata:n.metadata,data:r}}let{state:r}=i;if(r.streamed_output.length>0){let e=r.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${r.name}"`);let t={chunk:r.streamed_output[0]};r.streamed_output=[];let i={event:`on_${r.type}_stream`,run_id:r.id,tags:s,metadata:o,name:l,data:t};c.includeEvent(i,r.type)&&(yield i)}}let d=i?.state;if(void 0!==d){let e={event:`on_${d.type}_end`,name:l,run_id:d.id,tags:s,metadata:o,data:{output:d.final_output}};c.includeEvent(e,d.type)&&(yield e)}}static isRunnable(e){return fv(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new fR({bound:this,config:{},configFactories:[i=>({callbacks:[new f_({config:i,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){var t,r;let i,n;return t=this,i=(r=e).name??t.getName(),n=r.description??hj(r.schema),new fq(hL(r.schema)?{name:i,description:n,schema:fC.z.object({input:fC.z.string()}).transform(e=>e.input),bound:t}:{name:i,description:n,schema:r.schema,bound:t})}},fR=class e extends fP{static lc_name(){return"RunnableBinding"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;bound;config;kwargs;configFactories;constructor(e){super(e),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=s6(this.config,...e);return s6(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new fU({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(t,this.kwargs))}async batch(e,t,r){let i=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig(s3(e),this.kwargs))):await this._mergeConfig(s3(t),this.kwargs);return this.bound.batch(e,i,r)}_concatOutputChunks(e,t){return this.bound._concatOutputChunks(e,t)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(s3(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(s3(t),this.kwargs))}async *transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(s3(t),this.kwargs))}streamEvents(e,t,r){let i=this,n=async function*(){yield*i.bound.streamEvents(e,{...await i._mergeConfig(s3(t),i.kwargs),version:t.version},r)};return ot.fromAsyncGenerator(n())}static isRunnableBinding(e){return e.bound&&fP.isRunnable(e.bound)}withListeners({onStart:t,onEnd:r,onError:i}){return new e({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[e=>({callbacks:[new f_({config:e,onStart:t,onEnd:r,onError:i})]})]})}},fj=class e extends fP{static lc_name(){return"RunnableEach"}lc_serializable=!0;lc_namespace=["langchain_core","runnables"];bound;constructor(e){super(e),this.bound=e.bound}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,s5(t,{callbacks:r?.getChild()}))}withListeners({onStart:t,onEnd:r,onError:i}){return new e({bound:this.bound.withListeners({onStart:t,onEnd:r,onError:i})})}},fU=class extends fR{static lc_name(){return"RunnableRetry"}lc_namespace=["langchain_core","runnables"];maxAttemptNumber=3;onFailedAttempt=()=>{};constructor(e){super(e),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let i=e>1?`retry:attempt:${e}`:void 0;return s5(t,{callbacks:r?.getChild(i)})}async _invoke(e,t,r){return pW(i=>super.invoke(e,this._patchConfigForRetry(i,t,r)),{onFailedAttempt:({error:t})=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,i){let n={};try{await pW(async a=>{let s,o=e.map((e,t)=>t).filter(e=>void 0===n[e.toString()]||n[e.toString()]instanceof Error),l=o.map(t=>e[t]),u=o.map(e=>this._patchConfigForRetry(a,t?.[e],r?.[e])),c=await super.batch(l,u,{...i,returnExceptions:!0});for(let e=0;e<c.length;e+=1){let t=c[e],r=o[e];t instanceof Error&&void 0===s&&((s=t).input=l[e]),n[r.toString()]=t}if(s)throw s;return c},{onFailedAttempt:({error:e})=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(i?.returnExceptions!==!0)throw e}return Object.keys(n).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>n[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}},fL=class e extends fP{static lc_name(){return"RunnableSequence"}first;middle=[];last;omitSequenceTags=!1;lc_serializable=!0;lc_namespace=["langchain_core","runnables"];constructor(e){super(e),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r,i=s3(t),n=await s2(i),a=await n?.handleChainStart(this.toJSON(),fN(e,"input"),i.runId,void 0,void 0,void 0,i?.runName);delete i.runId;let s=e;try{let e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){let n=e[r].invoke(s,s5(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${r+1}`)}));s=await s7(n,t?.signal)}if(t?.signal?.aborted)throw oe(t.signal);r=await this.last.invoke(s,s5(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(e){throw await a?.handleChainError(e),e}return await a?.handleChainEnd(fN(r,"output")),r}async batch(e,t,r){let i=this._getOptionsList(t??{},e.length),n=await Promise.all(i.map(s2)),a=await Promise.all(n.map(async(t,r)=>{let n=await t?.handleChainStart(this.toJSON(),fN(e[r],"input"),i[r].runId,void 0,void 0,void 0,i[r].runName);return delete i[r].runId,n})),s=e;try{for(let e=0;e<this.steps.length;e+=1){let t=this.steps[e].batch(s,a.map((t,r)=>{let n=t?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`);return s5(i[r],{callbacks:n})}),r);s=await s7(t,i[0]?.signal)}}catch(e){throw await Promise.all(a.map(t=>t?.handleChainError(e))),e}return await Promise.all(a.map(e=>e?.handleChainEnd(fN(s,"output")))),s}_concatOutputChunks(e,t){return this.last._concatOutputChunks(e,t)}async *_streamIterator(e,t){let r,i=await s2(t),{runId:n,...a}=t??{},s=await i?.handleChainStart(this.toJSON(),fN(e,"input"),n,void 0,void 0,void 0,a?.runName),o=[this.first,...this.middle,this.last],l=!0;async function*u(){yield e}try{let e=o[0].transform(u(),s5(a,{callbacks:s?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let t=1;t<o.length;t+=1){let r=o[t];e=await r.transform(e,s5(a,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${t+1}`)}))}for await(let i of e)if(t?.signal?.throwIfAborted(),yield i,l)if(void 0===r)r=i;else try{r=this._concatOutputChunks(r,i)}catch{r=void 0,l=!1}}catch(e){throw await s?.handleChainError(e),e}await s?.handleChainEnd(fN(r,"output"))}getGraph(e){let t=new fS,r=null;return this.steps.forEach((i,n)=>{let a=i.getGraph(e);0!==n&&a.trimFirstNode(),n!==this.steps.length-1&&a.trimLastNode(),t.extend(a);let s=a.firstNode();if(!s)throw Error(`Runnable ${i} has no first node`);r&&t.addEdge(r,s),r=a.lastNode()}),t}pipe(t){return new e(e.isRunnableSequence(t)?{first:this.first,middle:this.middle.concat([this.last,t.first,...t.middle]),last:t.last,name:this.name??t.name}:{first:this.first,middle:[...this.middle,this.last],last:fZ(t),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&fP.isRunnable(e)}static from([t,...r],i){let n={};return"string"==typeof i?n.name=i:void 0!==i&&(n=i),new e({...n,first:fZ(t),middle:r.slice(0,-1).map(fZ),last:fZ(r[r.length-1])})}},fD=class e extends fP{static lc_name(){return"RunnableMap"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;steps;getStepsKeys(){return Object.keys(this.steps)}constructor(e){for(const[t,r]of(super(e),this.steps={},Object.entries(e.steps)))this.steps[t]=fZ(r)}static from(t){return new e({steps:t})}async invoke(e,t){let r=s3(t),i=await s2(r),n=await i?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let a={};try{let i=Object.entries(this.steps).map(async([t,i])=>{a[t]=await i.invoke(e,s5(r,{callbacks:n?.getChild(`map:key:${t}`)}))});await s7(Promise.all(i),t?.signal)}catch(e){throw await n?.handleChainError(e),e}return await n?.handleChainEnd(a),a}async *_transform(e,t,r){let i={...this.steps},n=or(e,Object.keys(i).length),a=new Map(Object.entries(i).map(([e,i],a)=>{let s=i.transform(n[a],s5(r,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then(t=>({key:e,gen:s,result:t}))]}));for(;a.size;){let e=Promise.race(a.values()),{key:t,result:i,gen:n}=await s7(e,r?.signal);a.delete(t),i.done||(yield{[t]:i.value},a.set(t,n.next().then(e=>({key:t,gen:n,result:e}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=s3(t),n=new on({generator:this.transform(r(),i),config:i});return await n.setup,ot.fromAsyncGenerator(n)}},fM=class e extends fP{lc_serializable=!1;lc_namespace=["langchain_core","runnables"];func;constructor(e){if(super(e),!sx(e.func))throw Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[r]=this._getOptionsList(t??{},1),i=await s2(r);return s7(this.func(s5(r,{callbacks:i}),e),r?.signal)}async *_streamIterator(e,t){let[r]=this._getOptionsList(t??{},1),i=await this.invoke(e,t);if(fk(i)){for await(let e of i)r?.signal?.throwIfAborted(),yield e;return}if(null!=i&&"object"==typeof i&&"next"in i&&"function"==typeof i.next){for(;;){r?.signal?.throwIfAborted();let e=i.next();if(e.done)break;yield e.value}return}yield i}static from(t){return new e({func:t})}},fz=class e extends fP{static lc_name(){return"RunnableLambda"}lc_namespace=["langchain_core","runnables"];func;constructor(e){if(sx(e.func))return fM.from(e.func);if(super(e),sx(e.func))throw Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.");this.func=e.func}static from(t){return new e({func:t})}async _invoke(e,t,r){return new Promise((i,n)=>{let a=s5(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??25)-1});s4.runWithConfig(s8(a),async()=>{try{let r=await this.func(e,{...a});if(r&&fP.isRunnable(r)){if(t?.recursionLimit===0)throw Error("Recursion limit reached.");r=await r.invoke(e,{...a,recursionLimit:(a.recursionLimit??25)-1})}else if(fk(r)){let e;for await(let i of f$(a,r))if(t?.signal?.throwIfAborted(),void 0===e)e=i;else try{e=this._concatOutputChunks(e,i)}catch{e=i}r=e}else if(fA(r)){let e;for(let i of fx(a,r))if(t?.signal?.throwIfAborted(),void 0===e)e=i;else try{e=this._concatOutputChunks(e,i)}catch{e=i}r=e}i(r)}catch(e){n(e)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async *_transform(e,t,r){let i;for await(let t of e)if(void 0===i)i=t;else try{i=this._concatOutputChunks(i,t)}catch{i=t}let n=s5(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??25)-1}),a=await new Promise((e,t)=>{s4.runWithConfig(s8(n),async()=>{try{let t=await this.func(i,{...n,config:n});e(t)}catch(e){t(e)}})});if(a&&fP.isRunnable(a)){if(r?.recursionLimit===0)throw Error("Recursion limit reached.");for await(let e of(await a.stream(i,n)))yield e}else if(fk(a))for await(let e of f$(n,a))r?.signal?.throwIfAborted(),yield e;else if(fA(a))for(let e of fx(n,a))r?.signal?.throwIfAborted(),yield e;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=s3(t),n=new on({generator:this.transform(r(),i),config:i});return await n.setup,ot.fromAsyncGenerator(n)}},fF=class extends fD{},fB=class extends fP{static lc_name(){return"RunnableWithFallbacks"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;runnable;fallbacks;constructor(e){super(e),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r=s3(t),i=await s2(r),{runId:n,...a}=r,s=await i?.handleChainStart(this.toJSON(),fN(e,"input"),n,void 0,void 0,void 0,a?.runName),o=s5(a,{callbacks:s?.getChild()});return await s4.runWithConfig(o,async()=>{let t;for(let i of this.runnables()){r?.signal?.throwIfAborted();try{let t=await i.invoke(e,o);return await s?.handleChainEnd(fN(t,"output")),t}catch(e){void 0===t&&(t=e)}}if(void 0===t)throw Error("No error stored at end of fallback.");throw await s?.handleChainError(t),t})}async *_streamIterator(e,t){let r,i,n,a=s3(t),s=await s2(a),{runId:o,...l}=a,u=await s?.handleChainStart(this.toJSON(),fN(e,"input"),o,void 0,void 0,void 0,l?.runName);for(let t of this.runnables()){a?.signal?.throwIfAborted();let n=s5(l,{callbacks:u?.getChild()});try{let r=await t.stream(e,n);i=f$(n,r);break}catch(e){void 0===r&&(r=e)}}if(void 0===i){let e=r??Error("No error stored at end of fallback.");throw await u?.handleChainError(e),e}try{for await(let e of i){yield e;try{n=void 0===n?n:this._concatOutputChunks(n,e)}catch{n=void 0}}}catch(e){throw await u?.handleChainError(e),e}await u?.handleChainEnd(fN(n,"output"))}async batch(e,t,r){let i;if(r?.returnExceptions)throw Error("Not implemented.");let n=this._getOptionsList(t??{},e.length),a=await Promise.all(n.map(e=>s2(e))),s=await Promise.all(a.map(async(t,r)=>{let i=await t?.handleChainStart(this.toJSON(),fN(e[r],"input"),n[r].runId,void 0,void 0,void 0,n[r].runName);return delete n[r].runId,i}));for(let t of this.runnables()){n[0].signal?.throwIfAborted();try{let i=await t.batch(e,s.map((e,t)=>s5(n[t],{callbacks:e?.getChild()})),r);return await Promise.all(s.map((e,t)=>e?.handleChainEnd(fN(i[t],"output")))),i}catch(e){void 0===i&&(i=e)}}if(!i)throw Error("No error stored at end of fallbacks.");throw await Promise.all(s.map(e=>e?.handleChainError(i))),i}};function fZ(e){if("function"==typeof e)return new fz({func:e});if(fP.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,i]of Object.entries(e))t[r]=fZ(i);return new fD({steps:t})}}var fG=class extends fP{static lc_name(){return"RunnableAssign"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;mapper;constructor(e){e instanceof fD&&(e={mapper:e}),super(e),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async *_transform(e,t,r){let i=this.mapper.getStepsKeys(),[n,a]=or(e),s=this.mapper.transform(a,s5(r,{callbacks:t?.getChild()})),o=s.next();for await(let e of n){if("object"!=typeof e||Array.isArray(e))throw Error(`RunnableAssign can only be used with objects as input, got ${typeof e}`);let t=Object.fromEntries(Object.entries(e).filter(([e])=>!i.includes(e)));Object.keys(t).length>0&&(yield t)}for await(let e of(yield(await o).value,s))yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=s3(t),n=new on({generator:this.transform(r(),i),config:i});return await n.setup,ot.fromAsyncGenerator(n)}},fH=class extends fP{static lc_name(){return"RunnablePick"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;keys;constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{let t=this.keys.map(t=>[t,e[t]]).filter(e=>void 0!==e[1]);return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async *_transform(e){for await(let t of e){let e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=s3(t),n=new on({generator:this.transform(r(),i),config:i});return await n.setup,ot.fromAsyncGenerator(n)}},fq=class extends fR{name;description;schema;constructor(e){super({bound:fL.from([fz.from(async e=>{let t;if(nb(e))try{t=await hN(this.schema,e.args)}catch{throw new nw("Received tool input did not match expected schema",JSON.stringify(e.args))}else t=e;return t}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name}),config:e.config??{}}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};let fW=(e,t)=>{let r=[...new Set(t?.map(e=>{if("string"==typeof e)return e;let t=new e({});if(!("getType"in t)||"function"!=typeof t.getType)throw Error("Invalid type provided.");return t.getType()}))],i=e.getType();return r.some(e=>e===i)};function fK(e,t){return Array.isArray(e)?fJ(e,t):fz.from(t=>fJ(t,e))}function fJ(e,t={}){let{includeNames:r,excludeNames:i,includeTypes:n,excludeTypes:a,includeIds:s,excludeIds:o}=t,l=[];for(let t of e)if(!(i&&t.name&&i.includes(t.name))){if(a&&fW(t,a))continue;if(o&&t.id&&o.includes(t.id))continue;n||s||r?r&&t.name&&r.some(e=>e===t.name)||n&&fW(t,n)?l.push(t):s&&t.id&&s.some(e=>e===t.id)&&l.push(t):l.push(t)}return l}function fV(e){return Array.isArray(e)?fY(e):fz.from(fY)}function fY(e){if(!e.length)return[];let t=[];for(let r of e){let e=t.pop();if(e)if("tool"===r.getType()||r.getType()!==e.getType())t.push(e,r);else{let i=n5(e),n=n5(r),a=i.concat(n);"string"==typeof i.content&&"string"==typeof n.content&&(a.content=`${i.content}
${n.content}`),t.push(function(e){let t,r=e.getType(),i=Object.fromEntries(Object.entries(e).filter(([e])=>!["type","tool_call_chunks"].includes(e)&&!e.startsWith("lc_")));if(r in f4&&(t=f2(r,i)),!t)throw Error(`Unrecognized message chunk class ${r}. Supported classes are ${Object.keys(f4)}`);return t}(a))}else t.push(r)}return t}function fX(e,t){if(!Array.isArray(e))return fz.from(t=>fQ(t,e)).withConfig({runName:"trim_messages"});if(!t)throw Error("Options parameter is required when providing messages.");return fQ(e,t)}async function fQ(e,t){let r,{maxTokens:i,tokenCounter:n,strategy:a="last",allowPartial:s=!1,endOn:o,startOn:l,includeSystem:u=!1,textSplitter:c}=t;if(l&&"first"===a)throw Error("`startOn` should only be specified if `strategy` is 'last'.");if(u&&"first"===a)throw Error("`includeSystem` should only be specified if `strategy` is 'last'.");r="getNumTokens"in n?async e=>(await Promise.all(e.map(e=>n.getNumTokens(e.content)))).reduce((e,t)=>e+t,0):async e=>n(e);let d=f6;if(c&&(d="splitText"in c?c.splitText:async e=>c(e)),"first"===a)return f0(e,{maxTokens:i,tokenCounter:r,textSplitter:d,partialStrategy:s?"first":void 0,endOn:o});if("last"===a)return f1(e,{maxTokens:i,tokenCounter:r,textSplitter:d,allowPartial:s,includeSystem:u,startOn:l,endOn:o});throw Error(`Unrecognized strategy: '${a}'. Must be one of 'first' or 'last'.`)}async function f0(e,t){let{maxTokens:r,tokenCounter:i,textSplitter:n,partialStrategy:a,endOn:s}=t,o=[...e],l=0;for(let e=0;e<o.length;e+=1){let t=e>0?o.slice(0,-e):o;if(await i(t)<=r){l=o.length-e;break}}if(l<o.length&&a){let e=!1;if(Array.isArray(o[l].content)){let t=o[l];if("string"==typeof t.content)throw Error("Expected content to be an array.");let n=t.content.length,s="last"===a?[...t.content].reverse():t.content;for(let u=1;u<=n;u+=1){let n="first"===a?s.slice(0,u):s.slice(-u),c=Object.fromEntries(Object.entries(t).filter(([e])=>"type"!==e&&!e.startsWith("lc_"))),d=f2(t.getType(),{...c,content:n}),h=[...o.slice(0,l),d];if(await i(h)<=r)o=h,l+=1,e=!0;else break}e&&"last"===a&&(t.content=[...s].reverse())}if(!e){let e,t=o[l];if(Array.isArray(t.content)&&t.content.some(e=>"string"==typeof e||"text"===e.type)){let r=t.content.find(e=>"text"===e.type&&e.text);e=r?.text}else"string"==typeof t.content&&(e=t.content);if(e){let s=await n(e),u=s.length;"last"===a&&s.reverse();for(let e=0;e<u-1;e+=1)if(s.pop(),t.content=s.join(""),await i([...o.slice(0,l),t])<=r){"last"===a&&(t.content=[...s].reverse().join("")),o=[...o.slice(0,l),t],l+=1;break}}}}if(s){let e=Array.isArray(s)?s:[s];for(;l>0&&!fW(o[l-1],e);)l-=1}return o.slice(0,l)}async function f1(e,t){let{allowPartial:r=!1,includeSystem:i=!1,endOn:n,startOn:a,...s}=t,o=e.map(e=>{let t=Object.fromEntries(Object.entries(e).filter(([e])=>"type"!==e&&!e.startsWith("lc_")));return f2(e.getType(),t,nh(e))});if(n){let e=Array.isArray(n)?n:[n];for(;o.length>0&&!fW(o[o.length-1],e);)o=o.slice(0,-1)}let l=i&&o[0]?.getType()==="system",u=l?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return(u=await f0(u,{...s,partialStrategy:r?"last":void 0,endOn:a}),l)?[u[0],...u.slice(1).reverse()]:u.reverse()}let f4={human:{message:nN,messageChunk:nP},ai:{message:nJ,messageChunk:nX},system:{message:nL,messageChunk:nD},developer:{message:nL,messageChunk:nD},tool:{message:nf,messageChunk:nm},function:{message:nk,messageChunk:nx},generic:{message:nS,messageChunk:nI},remove:{message:nU,messageChunk:nU}};function f2(e,t,r){let i,n;switch(e){case"human":r?i=new nP(t):n=new nN(t);break;case"ai":if(r){let e={...t};"tool_calls"in e&&(e={...e,tool_call_chunks:e.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),i=new nX(e)}else n=new nJ(t);break;case"system":r?i=new nD(t):n=new nL(t);break;case"developer":r?i=new nD({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}}):n=new nL({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in t)r?i=new nm(t):n=new nf(t);else throw Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(r)i=new nx(t);else{if(!t.name)throw Error("FunctionMessage must have a 'name' field");n=new nk(t)}break;case"generic":if("role"in t)r?i=new nI(t):n=new nS(t);else throw Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw Error(`Unrecognized message type ${e}`)}if(r&&i)return i;if(n)return n;throw Error(`Unrecognized message type ${e}`)}function f6(e){let t=e.split("\n");return Promise.resolve([...t.slice(0,-1).map(e=>`${e}
`),t[t.length-1]])}let f9=["text","reasoning","tool_call","tool_call_chunk","invalid_tool_call","server_tool_call","server_tool_call_chunk","server_tool_call_result","image","video","audio","text-plain","file"];iI({},{AIMessage:()=>nJ,AIMessageChunk:()=>nX,BaseMessage:()=>nn,BaseMessageChunk:()=>nu,ChatMessage:()=>nS,ChatMessageChunk:()=>nI,FunctionMessage:()=>nk,FunctionMessageChunk:()=>nx,HumanMessage:()=>nN,HumanMessageChunk:()=>nP,KNOWN_BLOCK_TYPES:()=>f9,RemoveMessage:()=>nU,SystemMessage:()=>nL,SystemMessageChunk:()=>nD,ToolMessage:()=>nf,ToolMessageChunk:()=>nm,_isMessageFieldWithRole:()=>nc,_mergeDicts:()=>ns,_mergeLists:()=>no,_mergeObj:()=>nl,_mergeStatus:()=>ni,coerceMessageLikeToMessage:()=>n4,collapseToolCallChunks:()=>n8,convertToChunk:()=>n5,convertToOpenAIImageBlock:()=>iM,convertToProviderContentBlock:()=>iB,defaultTextSplitter:()=>f6,defaultToolCallParser:()=>ng,filterMessages:()=>fK,getBufferString:()=>n2,iife:()=>nQ,isAIMessage:()=>nV,isAIMessageChunk:()=>nY,isBase64ContentBlock:()=>iU,isBaseMessage:()=>nd,isBaseMessageChunk:()=>nh,isChatMessage:()=>nO,isChatMessageChunk:()=>nA,isDataContentBlock:()=>iR,isDirectToolOutput:()=>np,isFunctionMessage:()=>n$,isFunctionMessageChunk:()=>nC,isHumanMessage:()=>nR,isHumanMessageChunk:()=>nj,isIDContentBlock:()=>iD,isMessage:()=>ne,isOpenAIToolCallArray:()=>na,isPlainTextContentBlock:()=>iL,isSystemMessage:()=>nM,isSystemMessageChunk:()=>nz,isToolMessage:()=>ny,isToolMessageChunk:()=>n_,isURLContentBlock:()=>ij,mapChatMessagesToStoredMessages:()=>n3,mapStoredMessageToChatMessage:()=>n6,mapStoredMessagesToChatMessages:()=>n9,mergeContent:()=>nr,mergeMessageRuns:()=>fV,mergeResponseMetadata:()=>nq,mergeUsageMetadata:()=>nK,parseBase64DataUrl:()=>iF,parseMimeType:()=>iz,trimMessages:()=>fX}),iI({},{BasePromptValue:()=>f3,ChatPromptValue:()=>f8,ImagePromptValue:()=>f7,StringPromptValue:()=>f5});var f3=class extends iW{},f5=class extends f3{static lc_name(){return"StringPromptValue"}lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;value;constructor(e){super({value:e}),this.value=e}toString(){return this.value}toChatMessages(){return[new nN(this.value)]}},f8=class extends f3{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ChatPromptValue"}messages;constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),this.messages=e.messages}toString(){return n2(this.messages)}toChatMessages(){return this.messages}},f7=class extends f3{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ImagePromptValue"}imageUrl;value;constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new nN({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}},me="0123456789abcdef".split(""),mt=[-0x80000000,8388608,32768,128],mr=[24,16,8,0],mi=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2],mn=[];function ma(e,t){t?(mn[0]=mn[16]=mn[1]=mn[2]=mn[3]=mn[4]=mn[5]=mn[6]=mn[7]=mn[8]=mn[9]=mn[10]=mn[11]=mn[12]=mn[13]=mn[14]=mn[15]=0,this.blocks=mn):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=0xc1059ed8,this.h1=0x367cd507,this.h2=0x3070dd17,this.h3=0xf70e5939,this.h4=0xffc00b31,this.h5=0x68581511,this.h6=0x64f98fa7,this.h7=0xbefa4fa4):(this.h0=0x6a09e667,this.h1=0xbb67ae85,this.h2=0x3c6ef372,this.h3=0xa54ff53a,this.h4=0x510e527f,this.h5=0x9b05688c,this.h6=0x1f83d9ab,this.h7=0x5be0cd19),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}ma.prototype.update=function(e){if(!this.finalized){var t,r=typeof e;if("string"!==r){if("object"===r){if(null===e)throw Error(ERROR);else if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(e)))throw Error(ERROR)}else throw Error(ERROR);t=!0}for(var i,n,a=0,s=e.length,o=this.blocks;a<s;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),t)for(n=this.start;a<s&&n<64;++a)o[n>>>2]|=e[a]<<mr[3&n++];else for(n=this.start;a<s&&n<64;++a)(i=e.charCodeAt(a))<128?o[n>>>2]|=i<<mr[3&n++]:(i<2048?o[n>>>2]|=(192|i>>>6)<<mr[3&n++]:(i<55296||i>=57344?o[n>>>2]|=(224|i>>>12)<<mr[3&n++]:(i=65536+((1023&i)<<10|1023&e.charCodeAt(++a)),o[n>>>2]|=(240|i>>>18)<<mr[3&n++],o[n>>>2]|=(128|i>>>12&63)<<mr[3&n++]),o[n>>>2]|=(128|i>>>6&63)<<mr[3&n++]),o[n>>>2]|=(128|63&i)<<mr[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=o[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>0xffffffff&&(this.hBytes+=this.bytes/0x100000000|0,this.bytes=this.bytes%0x100000000),this}},ma.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>>2]|=mt[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},ma.prototype.hash=function(){var e,t,r,i,n,a,s,o,l,u,c=this.h0,d=this.h1,h=this.h2,p=this.h3,f=this.h4,m=this.h5,g=this.h6,y=this.h7,_=this.blocks;for(e=16;e<64;++e)t=((n=_[e-15])>>>7|n<<25)^(n>>>18|n<<14)^n>>>3,r=((n=_[e-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,_[e]=_[e-16]+t+_[e-7]+r|0;for(e=0,u=d&h;e<64;e+=4)this.first?(this.is224?(s=300032,y=(n=_[0]-0x543c9a5b)-0x8f1a6c7|0,p=n+0x170e9b5|0):(s=0x2a01a605,y=(n=_[0]-0xc881298)-0x5ab00ac6|0,p=n+0x8909ae5|0),this.first=!1):(t=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),r=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7),i=(s=c&d)^c&h^u,n=y+r+(f&m^~f&g)+mi[e]+_[e],a=t+i,y=p+n|0,p=n+a|0),t=(p>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10),r=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7),i=(o=p&c)^p&d^s,n=m+r+(g&y^~g&f)+mi[e+1]+_[e+1],a=t+i,g=h+n|0,t=((h=n+a|0)>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),r=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7),i=(l=h&p)^h&c^o,n=f+r+(m&g^~m&y)+mi[e+2]+_[e+2],a=t+i,m=d+n|0,t=((d=n+a|0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),r=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7),i=(u=d&h)^d&p^l,n=f+r+(m&g^~m&y)+mi[e+3]+_[e+3],a=t+i,f=c+n|0,c=n+a|0,this.chromeBugWorkAround=!0;this.h0=this.h0+c|0,this.h1=this.h1+d|0,this.h2=this.h2+h|0,this.h3=this.h3+p|0,this.h4=this.h4+f|0,this.h5=this.h5+m|0,this.h6=this.h6+g|0,this.h7=this.h7+y|0},ma.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,i=this.h3,n=this.h4,a=this.h5,s=this.h6,o=this.h7,l=me[e>>>28&15]+me[e>>>24&15]+me[e>>>20&15]+me[e>>>16&15]+me[e>>>12&15]+me[e>>>8&15]+me[e>>>4&15]+me[15&e]+me[t>>>28&15]+me[t>>>24&15]+me[t>>>20&15]+me[t>>>16&15]+me[t>>>12&15]+me[t>>>8&15]+me[t>>>4&15]+me[15&t]+me[r>>>28&15]+me[r>>>24&15]+me[r>>>20&15]+me[r>>>16&15]+me[r>>>12&15]+me[r>>>8&15]+me[r>>>4&15]+me[15&r]+me[i>>>28&15]+me[i>>>24&15]+me[i>>>20&15]+me[i>>>16&15]+me[i>>>12&15]+me[i>>>8&15]+me[i>>>4&15]+me[15&i]+me[n>>>28&15]+me[n>>>24&15]+me[n>>>20&15]+me[n>>>16&15]+me[n>>>12&15]+me[n>>>8&15]+me[n>>>4&15]+me[15&n]+me[a>>>28&15]+me[a>>>24&15]+me[a>>>20&15]+me[a>>>16&15]+me[a>>>12&15]+me[a>>>8&15]+me[a>>>4&15]+me[15&a]+me[s>>>28&15]+me[s>>>24&15]+me[s>>>20&15]+me[s>>>16&15]+me[s>>>12&15]+me[s>>>8&15]+me[s>>>4&15]+me[15&s];return this.is224||(l+=me[o>>>28&15]+me[o>>>24&15]+me[o>>>20&15]+me[o>>>16&15]+me[o>>>12&15]+me[o>>>8&15]+me[o>>>4&15]+me[15&o]),l},ma.prototype.toString=ma.prototype.hex,ma.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,i=this.h3,n=this.h4,a=this.h5,s=this.h6,o=this.h7,l=[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s];return this.is224||l.push(o>>>24&255,o>>>16&255,o>>>8&255,255&o),l},ma.prototype.array=ma.prototype.digest,ma.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e};let ms=(...e)=>new ma(!1,!0).update(e.join("")).hex();iI({},{sha256:()=>ms}),iI({},{BaseCache:()=>mc,InMemoryCache:()=>mh,defaultHashKeyEncoder:()=>mo,deserializeStoredGeneration:()=>ml,serializeGeneration:()=>mu});let mo=(...e)=>ms(e.join("_"));function ml(e){return void 0!==e.message?{text:e.text,message:n6(e.message)}:{text:e.text}}function mu(e){let t={text:e.text};return void 0!==e.message&&(t.message=e.message.toDict()),t}var mc=class{keyEncoder=mo;makeDefaultKeyEncoder(e){this.keyEncoder=e}};let md=new Map;var mh=class e extends mc{cache;constructor(e){super(),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,r){this.cache.set(this.keyEncoder(e,t),r)}static global(){return new e(md)}},mp=e.i(193484),mf=Object.defineProperty,mm=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){for(const[t,r]of(this.patStr=e.pat_str,Object.entries(e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{let[r,i,...n]=t.split(" "),a=Number.parseInt(i,10);return n.forEach((t,r)=>e[t]=a+r),e},{})))){const e=mp.default.toByteArray(t);this.rankMap.set(e.join(","),r),this.textMap.set(r,e)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e),{})}encode(e,t=[],r="all"){let i=RegExp(this.patStr,"ug"),n=mm.specialTokenRegex(Object.keys(this.specialTokens)),a=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter(e=>!s.has(e)):r);if(o.size>0){let t=mm.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;n.lastIndex=r,!(null==(t=n.exec(e))||s.has(t[0]));)r=t.index+1;let o=t?.index??e.length;for(let t of e.substring(l,o).matchAll(i)){let e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));if(null!=r){a.push(r);continue}a.push(...function(e,t){return 1===e.length?[t.get(e.join(","))]:(function(e,t){let r=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;r.length>1;){let i=null;for(let n=0;n<r.length-1;n++){let a=e.slice(r[n].start,r[n+1].end),s=t.get(a.join(","));null!=s&&(null==i||s<i[0])&&(i=[s,n])}if(null!=i){let e=i[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}else break}return r})(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(e=>null!=e)}(e,this.rankMap))}if(null==t)break;let u=this.specialTokens[t[0]];a.push(u),l=t.index+t[0].length}return a}decode(e){let t=[],r=0;for(let i=0;i<e.length;++i){let n=e[i],a=this.textMap.get(n)??this.inverseSpecialTokens[n];null!=a&&(t.push(a),r+=a.length)}let i=new Uint8Array(r),n=0;for(let e of t)i.set(e,n),n+=e.length;return this.textDecoder.decode(i)}};Y="specialTokenRegex",X=e=>RegExp(e.map(e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"g"),(p="symbol"!=typeof Y?Y+"":Y)in mm?mf(mm,p,{enumerable:!0,configurable:!0,writable:!0,value:X}):mm[p]=X,iI({},{encodingForModel:()=>mv,getEncoding:()=>m_});let mg={},my=new fy({});async function m_(e){return e in mg||(mg[e]=my.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(e=>e.json()).then(e=>new mm(e)).catch(t=>{throw delete mg[e],t})),await mg[e]}async function mv(e){return m_(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw Error("Unknown model")}}(e))}iI({},{BaseLangChain:()=>mI,BaseLanguageModel:()=>mO,calculateMaxTokens:()=>mS,getEmbeddingContextSize:()=>mw,getModelContextSize:()=>mE,getModelNameForTiktoken:()=>mb,isOpenAITool:()=>mT});let mb=e=>e.startsWith("gpt-5")?"gpt-5":e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e.startsWith("gpt-4o")?"gpt-4o":e,mw=e=>"text-embedding-ada-002"===e?8191:2046,mE=e=>{switch(mb(e)){case"gpt-5":case"gpt-5-turbo":case"gpt-5-turbo-preview":return 4e5;case"gpt-4o":case"gpt-4o-mini":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4-turbo":case"gpt-4-turbo-preview":case"gpt-4-turbo-2024-04-09":case"gpt-4-0125-preview":case"gpt-4-1106-preview":return 128e3;case"gpt-4-32k":case"gpt-4-32k-0314":case"gpt-4-32k-0613":case"gemini-pro":case"gemini-pro-vision":return 32768;case"gpt-4":case"gpt-4-0314":case"gpt-4-0613":return 8192;case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-16k-0613":return 16384;case"gpt-3.5-turbo":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-1106":case"gpt-3.5-turbo-0125":return 4096;case"text-davinci-003":case"text-davinci-002":default:return 4097;case"text-davinci-001":return 2049;case"text-curie-001":case"text-babbage-001":case"text-ada-001":case"code-cushman-001":return 2048;case"code-davinci-002":case"code-davinci-001":return 8e3;case"claude-3-5-sonnet-20241022":case"claude-3-5-sonnet-20240620":case"claude-3-opus-20240229":case"claude-3-sonnet-20240229":case"claude-3-haiku-20240307":case"claude-2.1":return 2e5;case"claude-2.0":case"claude-instant-1.2":return 1e5;case"gemini-1.5-pro":case"gemini-1.5-pro-latest":case"gemini-1.5-flash":case"gemini-1.5-flash-latest":return 1e6}};function mT(e){return"object"==typeof e&&!!e&&("type"in e&&"function"===e.type&&"function"in e&&"object"==typeof e.function&&!!e.function&&"name"in e.function&&"parameters"in e.function||!1)}let mS=async({prompt:e,modelName:t})=>{let r;try{r=(await mv(mb(t))).encode(e).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),r=Math.ceil(e.length/4)}return mE(t)-r};var mI=class extends fP{verbose;callbacks;tags;metadata;get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},mO=class extends mI{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}caller;cache;constructor({callbacks:e,callbackManager:t,...r}){const{cache:i,...n}=r;super({callbacks:e??t,...n}),"object"==typeof i?this.cache=i:i?this.cache=mh.global():this.cache=void 0,this.caller=new fy(r??{})}_encoding;async getNumTokens(e){let t,r=Math.ceil((t="string"==typeof e?e:e.map(e=>"string"==typeof e?e:"text"===e.type&&"text"in e?e.text:"").join("")).length/4);if(!this._encoding)try{this._encoding=await mv("modelName"in this?mb(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{r=this._encoding.encode(t).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return r}static _convertInputToPromptValue(e){return"string"==typeof e?new f5(e):Array.isArray(e)?new f8(e.map(n4)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){return Object.entries({...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()}).filter(([e,t])=>void 0!==t).map(([e,t])=>`${e}:${JSON.stringify(t)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw Error("Use .toJSON() instead")}get profile(){return{}}},mA=class extends fP{static lc_name(){return"RunnablePassthrough"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;func;constructor(e){super(e),e&&(this.func=e.func)}async invoke(e,t){let r=s3(t);return this.func&&await this.func(e,r),this._callWithConfig(e=>Promise.resolve(e),e,r)}async *transform(e,t){let r,i=s3(t),n=!0;for await(let t of this._transformStreamWithConfig(e,e=>e,i))if(yield t,n)if(void 0===r)r=t;else try{r=oi(r,t)}catch{r=void 0,n=!1}this.func&&void 0!==r&&await this.func(r,i)}static assign(e){return new fG(new fD({steps:e}))}};function mk(e){return new e.constructor({...e,content:e.contentBlocks,response_metadata:{...e.response_metadata,output_version:"v1"}})}function mx(e){let t=[];for(let r of e){let e=r;if(Array.isArray(r.content))for(let t=0;t<r.content.length;t++){let i=r.content[t];(ij(i)||iU(i))&&e===r&&(e=new r.constructor({...e,content:[...r.content.slice(0,t),iM(i),...r.content.slice(t+1)]}))}t.push(e)}return t}iI({},{BaseChatModel:()=>m$,SimpleChatModel:()=>mC});var m$=class e extends mO{lc_namespace=["langchain","chat_models",this._llmType()];disableStreaming=!1;outputVersion;get callKeys(){return[...super.callKeys,"outputVersion"]}constructor(e){super(e),this.outputVersion=(()=>{let t=e.outputVersion??iP("LC_OUTPUT_VERSION");return t&&["v0","v1"].includes(t)?t:"v0"})()}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(t,r){let i=e._convertInputToPromptValue(t);return(await this.generatePrompt([i],r,r?.callbacks)).generations[0][0].message}async *_streamResponseChunks(e,t,r){throw Error("Not implemented.")}async *_streamIterator(t,r){if(this._streamResponseChunks===e.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(t,r);else{let i,n,a=e._convertInputToPromptValue(t).toChatMessages(),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(r),l={...s.metadata,...this.getLsParams(o)},u=await sY.configure(s.callbacks,this.callbacks,s.tags,this.tags,l,this.metadata,{verbose:this.verbose}),c={options:o,invocation_params:this?.invocationParams(o),batch_size:1},d=o.outputVersion??this.outputVersion,h=await u?.handleChatModelStart(this.toJSON(),[mx(a)],s.runId,void 0,c,void 0,void 0,s.runName);try{for await(let e of this._streamResponseChunks(a,o,h?.[0])){if(null==e.message.id){let t=h?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata},"v1"===d?yield mk(e.message):yield e.message,i=i?i.concat(e):e,nY(e.message)&&void 0!==e.message.usage_metadata&&(n={tokenUsage:{promptTokens:e.message.usage_metadata.input_tokens,completionTokens:e.message.usage_metadata.output_tokens,totalTokens:e.message.usage_metadata.total_tokens}})}}catch(e){throw await Promise.all((h??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((h??[]).map(e=>e?.handleLLMEnd({generations:[[i]],llmOutput:n})))}}getLsParams(e){let t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(t,r,i,n){let a,s=t.map(e=>e.map(n4));if(void 0!==n&&n.length===s.length)a=n;else{let e={...i.metadata,...this.getLsParams(r)},t=await sY.configure(i.callbacks,this.callbacks,i.tags,this.tags,e,this.metadata,{verbose:this.verbose}),n={options:r,invocation_params:this?.invocationParams(r),batch_size:1};a=await t?.handleChatModelStart(this.toJSON(),s.map(mx),i.runId,void 0,n,void 0,void 0,i.runName)}let o=r.outputVersion??this.outputVersion,l=[],u=[];if(a?.[0].handlers.find(au)&&!this.disableStreaming&&1===s.length&&this._streamResponseChunks!==e.prototype._streamResponseChunks)try{let e,t;for await(let i of(await this._streamResponseChunks(s[0],r,a?.[0]))){if(null==i.message.id){let e=a?.at(0)?.runId;null!=e&&i.message._updateId(`run-${e}`)}e=void 0===e?i:oi(e,i),nY(i.message)&&void 0!==i.message.usage_metadata&&(t={tokenUsage:{promptTokens:i.message.usage_metadata.input_tokens,completionTokens:i.message.usage_metadata.output_tokens,totalTokens:i.message.usage_metadata.total_tokens}})}if(void 0===e)throw Error("Received empty response from chat model call.");l.push([e]),await a?.[0].handleLLMEnd({generations:l,llmOutput:t})}catch(e){throw await a?.[0].handleLLMError(e),e}else{let e=await Promise.allSettled(s.map(async(e,t)=>{let i=await this._generate(e,{...r,promptIndex:t},a?.[t]);if("v1"===o)for(let e of i.generations)e.message=mk(e.message);return i}));await Promise.all(e.map(async(e,t)=>{if("fulfilled"!==e.status)return await a?.[t]?.handleLLMError(e.reason),Promise.reject(e.reason);{let r=e.value;for(let e of r.generations){if(null==e.message.id){let t=a?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata}}return 1===r.generations.length&&(r.generations[0].message.response_metadata={...r.llmOutput,...r.generations[0].message.response_metadata}),l[t]=r.generations,u[t]=r.llmOutput,a?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}}))}let c={generations:l,llmOutput:u.length?this._combineLLMOutput?.(...u):void 0};return Object.defineProperty(c,os,{value:a?{runIds:a?.map(e=>e.runId)}:void 0,configurable:!0}),c}async _generateCached({messages:t,cache:r,llmStringKey:i,parsedOptions:n,handledOptions:a}){let s=t.map(e=>e.map(n4)),o={...a.metadata,...this.getLsParams(n)},l=await sY.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:n,invocation_params:this?.invocationParams(n),batch_size:1},c=await l?.handleChatModelStart(this.toJSON(),s.map(mx),a.runId,void 0,u,void 0,void 0,a.runName),d=[],h=(await Promise.allSettled(s.map(async(t,n)=>{let a=e._convertInputToPromptValue(t).toString(),s=await r.lookup(a,i);return null==s&&d.push(n),s}))).map((e,t)=>({result:e,runManager:c?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),p=n.outputVersion??this.outputVersion,f=[];await Promise.all(h.map(async({result:e,runManager:t},r)=>{if("fulfilled"!==e.status)return await t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(e.reason);{let i=e.value;return f[r]=i.map(e=>("message"in e&&nd(e.message)&&nV(e.message)&&(e.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0},"v1"===p&&(e.message=mk(e.message))),e.generationInfo={...e.generationInfo,tokenUsage:{}},e)),i.length&&await t?.handleLLMNewToken(i[0].text),t?.handleLLMEnd({generations:[i]},void 0,void 0,void 0,{cached:!0})}}));let m={generations:f,missingPromptIndices:d,startedRunManagers:c};return Object.defineProperty(m,os,{value:c?{runIds:c?.map(e=>e.runId)}:void 0,configurable:!0}),m}async generate(t,r,i){let n;n=Array.isArray(r)?{stop:r}:r;let a=t.map(e=>e.map(n4)),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(n);if(s.callbacks=s.callbacks??i,!this.cache)return this._generateUncached(a,o,s);let{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d,startedRunManagers:h}=await this._generateCached({messages:a,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:s}),p={};if(d.length>0){let t=await this._generateUncached(d.map(e=>a[e]),o,s,void 0!==h?d.map(e=>h?.[e]):void 0);await Promise.all(t.generations.map(async(t,r)=>{let i=d[r];c[i]=t;let n=e._convertInputToPromptValue(a[i]).toString();return l.update(n,u,t)})),p=t.llmOutput??{}}return{generations:c,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}async generatePrompt(e,t,r){let i=e.map(e=>e.toChatMessages());return this.generate(i,t,r)}withStructuredOutput(e,t){let r;if("function"!=typeof this.bindTools)throw Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t?.strict)throw Error('"strict" mode is not supported for this model by default.');let i=t?.name,n=hj(e)??"A function available to call.",a=t?.method,s=t?.includeRaw;if("jsonMode"===a)throw Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let o=i??"extract";hA(e)?r=[{type:"function",function:{name:o,description:n,parameters:pM(e)}}]:("name"in e&&(o=e.name),r=[{type:"function",function:{name:o,description:n,parameters:e}}]);let l=this.bindTools(r),u=fz.from(e=>{if(!nX.isInstance(e))throw Error("Input is not an AIMessageChunk.");if(!e.tool_calls||0===e.tool_calls.length)throw Error("No tool calls found in the response.");let t=e.tool_calls.find(e=>e.name===o);if(!t)throw Error(`No tool call found with name ${o}.`);return t.args});if(!s)return l.pipe(u).withConfig({runName:"StructuredOutput"});let c=mA.assign({parsed:(e,t)=>u.invoke(e.raw,t)}),d=mA.assign({parsed:()=>null}),h=c.withFallbacks({fallbacks:[d]});return fL.from([{raw:l},h]).withConfig({runName:"StructuredOutputRunnable"})}},mC=class extends m${async _generate(e,t,r){let i=new nJ(await this._call(e,t,r));if("string"!=typeof i.content)throw Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:i.content,message:i}]}}},mN=class extends fP{static lc_name(){return"RouterRunnable"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;runnables;constructor(e){super(e),this.runnables=e.runnables}async invoke(e,t){let{key:r,input:i}=e,n=this.runnables[r];if(void 0===n)throw Error(`No runnable associated with key "${r}".`);return n.invoke(i,s3(t))}async batch(e,t,r){let i=e.map(e=>e.key),n=e.map(e=>e.input);if(void 0!==i.find(e=>void 0===this.runnables[e]))throw Error("One or more keys do not have a corresponding runnable.");let a=i.map(e=>this.runnables[e]),s=this._getOptionsList(t??{},e.length),o=s[0]?.maxConcurrency??r?.maxConcurrency,l=o&&o>0?o:e.length,u=[];for(let e=0;e<n.length;e+=l){let t=n.slice(e,e+l).map((e,t)=>a[t].invoke(e,s[t])),r=await Promise.all(t);u.push(r)}return u.flat()}async stream(e,t){let{key:r,input:i}=e,n=this.runnables[r];if(void 0===n)throw Error(`No runnable associated with key "${r}".`);return n.stream(i,t)}},mP=class extends fP{static lc_name(){return"RunnableBranch"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;default;branches;constructor(e){super(e),this.branches=e.branches,this.default=e.default}static from(e){if(e.length<1)throw Error("RunnableBranch requires at least one branch");return new this({branches:e.slice(0,-1).map(([e,t])=>[fZ(e),fZ(t)]),default:fZ(e[e.length-1])})}async _invoke(e,t,r){let i;for(let n=0;n<this.branches.length;n+=1){let[a,s]=this.branches[n];if(await a.invoke(e,s5(t,{callbacks:r?.getChild(`condition:${n+1}`)}))){i=await s.invoke(e,s5(t,{callbacks:r?.getChild(`branch:${n+1}`)}));break}}return i||(i=await this.default.invoke(e,s5(t,{callbacks:r?.getChild("branch:default")}))),i}async invoke(e,t={}){return this._callWithConfig(this._invoke,e,t)}async *_streamIterator(e,t){let r,i,n=await s2(t),a=await n?.handleChainStart(this.toJSON(),fN(e,"input"),t?.runId,void 0,void 0,void 0,t?.runName),s=!0;try{for(let n=0;n<this.branches.length;n+=1){let[o,l]=this.branches[n];if(await o.invoke(e,s5(t,{callbacks:a?.getChild(`condition:${n+1}`)}))){for await(let o of i=await l.stream(e,s5(t,{callbacks:a?.getChild(`branch:${n+1}`)})))if(yield o,s)if(void 0===r)r=o;else try{r=oi(r,o)}catch{r=void 0,s=!1}break}}if(void 0===i){for await(let n of i=await this.default.stream(e,s5(t,{callbacks:a?.getChild("branch:default")})))if(yield n,s)if(void 0===r)r=n;else try{r=oi(r,n)}catch{r=void 0,s=!1}}}catch(e){throw await a?.handleChainError(e),e}await a?.handleChainEnd(r??{})}},mR=class extends fR{runnable;inputMessagesKey;outputMessagesKey;historyMessagesKey;getMessageHistory;constructor(e){let t=fz.from((e,t)=>this._enterHistory(e,t??{})).withConfig({runName:"loadHistory"});const r=e.historyMessagesKey??e.inputMessagesKey;r&&(t=mA.assign({[r]:t}).withConfig({runName:"insertHistory"})),super({...e,config:e.config??{},bound:t.pipe(e.runnable.withListeners({onEnd:(e,t)=>this._exitHistory(e,t??{})})).withConfig({runName:"RunnableWithMessageHistory"})}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let t;if("object"!=typeof e||Array.isArray(e)||nd(e))t=e;else{let r;r=this.inputMessagesKey?this.inputMessagesKey:1===Object.keys(e).length?Object.keys(e)[0]:"input",t=Array.isArray(e[r])&&Array.isArray(e[r][0])?e[r][0]:e[r]}if("string"==typeof t)return[new nN(t)];if(Array.isArray(t))return t;if(nd(t))return[t];throw Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(t,null,2)}`)}_getOutputMessages(e){let t;if(Array.isArray(e)||nd(e)||"string"==typeof e)t=e;else{let r;r=void 0!==this.outputMessagesKey?this.outputMessagesKey:1===Object.keys(e).length?Object.keys(e)[0]:"output",t=void 0!==e.generations?e.generations[0][0].message:e[r]}if("string"==typeof t)return[new nJ(t)];if(Array.isArray(t))return t;if(nd(t))return[t];throw Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){let r=t?.configurable?.messageHistory,i=await r.getMessages();return void 0===this.historyMessagesKey?i.concat(this._getInputMessages(e)):i}async _exitHistory(e,t){let r,i=t.configurable?.messageHistory;r=Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?e.inputs[0]:e.inputs;let n=this._getInputMessages(r);if(void 0===this.historyMessagesKey){let e=await i.getMessages();n=n.slice(e.length)}let a=e.outputs;if(!a)throw Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);let s=this._getOutputMessages(a);await i.addMessages([...n,...s])}async _mergeConfig(...e){let t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){let e={[this.inputMessagesKey??"input"]:"foo"};throw Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(e)}, ${JSON.stringify({configurable:{sessionId:"123"}})})`)}let{sessionId:r}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(r),t}};iI({},{RouterRunnable:()=>mN,Runnable:()=>fP,RunnableAssign:()=>fG,RunnableBinding:()=>fR,RunnableBranch:()=>mP,RunnableEach:()=>fj,RunnableLambda:()=>fz,RunnableMap:()=>fD,RunnableParallel:()=>fF,RunnablePassthrough:()=>mA,RunnablePick:()=>fH,RunnableRetry:()=>fU,RunnableSequence:()=>fL,RunnableToolLike:()=>fq,RunnableWithFallbacks:()=>fB,RunnableWithMessageHistory:()=>mR,_coerceToRunnable:()=>fZ,ensureConfig:()=>s3,getCallbackManagerForConfig:()=>s2,mergeConfigs:()=>s6,patchConfig:()=>s5,pickRunnableConfigKeys:()=>s8,raceWithSignal:()=>s7}),iI({},{extendInteropZodObject:()=>hH,getInteropZodDefaultGetter:()=>hK,getInteropZodObjectShape:()=>hG,getSchemaDescription:()=>hj,interopParse:()=>hR,interopParseAsync:()=>hN,interopSafeParse:()=>hP,interopSafeParseAsync:()=>hC,interopZodObjectMakeFieldsOptional:()=>hV,interopZodObjectPartial:()=>hq,interopZodObjectPassthrough:()=>function e(t,r=!1){if(hD(t))return t.passthrough();if(hM(t)){let i=t._zod.def.shape;if(r)for(let[n,a]of Object.entries(t._zod.def.shape)){if(hM(a)){let t=e(a,r);i[n]=t}else if(hz(a)){let t=a._zod.def.element;hM(t)&&(t=e(t,r)),i[n]=oz(a,{...a._zod.def,element:t})}else i[n]=a;let t=cD.get(a);t&&cD.add(i[n],t)}let n=oz(t,{...t._zod.def,shape:i,catchall:dE(uY)}),a=cD.get(t);return a&&cD.add(n,a),n}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")},interopZodObjectStrict:()=>hW,interopZodTransformInputSchema:()=>hJ,isInteropZodError:()=>hY,isInteropZodLiteral:()=>h$,isInteropZodObject:()=>hZ,isInteropZodSchema:()=>hA,isShapelessZodSchema:()=>hU,isSimpleStringZodSchema:()=>hL,isZodArrayV4:()=>hz,isZodLiteralV3:()=>hk,isZodLiteralV4:()=>hx,isZodNullableV4:()=>hB,isZodObjectV3:()=>hD,isZodObjectV4:()=>hM,isZodOptionalV4:()=>hF,isZodSchema:()=>hO,isZodSchemaV3:()=>hI,isZodSchemaV4:()=>hS});var mj=class extends fP{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return"string"==typeof e.content?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return"string"==typeof e?this._callWithConfig(async(e,t)=>this.parseResult([{text:e}],t?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(e,t)=>this.parseResult([{message:e,text:this._baseMessageToString(e)}],t?.callbacks),e,{...t,runType:"parser"})}},mU=class extends mj{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw Error("_type not implemented")}},mL=class extends Error{llmOutput;observation;sendToLLM;constructor(e,t,r,i=!1){if(super(e),this.llmOutput=t,this.observation=r,this.sendToLLM=i,i&&(void 0===r||void 0===t))throw Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");nv(this,"OUTPUT_PARSING_FAILURE")}},mD=class extends mU{async *_transform(e){for await(let t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async *transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},mM=class extends mD{diff=!1;constructor(e){super(e),this.diff=e?.diff??this.diff}async *_transform(e){let t,r;for await(let i of e){let e;if("string"!=typeof i&&"string"!=typeof i.content)throw Error("Cannot handle non-string output.");if(nh(i)){if("string"!=typeof i.content)throw Error("Cannot handle non-string message output.");e=new ol({message:i,text:i.content})}else if(nd(i)){if("string"!=typeof i.content)throw Error("Cannot handle non-string message output.");e=new ol({message:n5(i),text:i.content})}else e=new oo({text:i});r=void 0===r?e:r.concat(e);let n=await this.parsePartialResult([r]);null==n||pv(n,t)||(this.diff?yield this._diff(t,n):yield n,t=n)}}getFormatInstructions(){return""}};iI({},{applyPatch:()=>fe,compare:()=>fa});var mz=class extends mM{static lc_name(){return"JsonOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_concatOutputChunks(e,t){return this.diff?super._concatOutputChunks(e,t):t}_diff(e,t){if(t)return e?fa(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return nE(e[0].text)}async parse(e){return nE(e,JSON.parse)}getFormatInstructions(){return""}},mF=class extends mD{static lc_name(){return"BytesOutputParser"}lc_namespace=["langchain_core","output_parsers","bytes"];lc_serializable=!0;textEncoder=new TextEncoder;parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}},mB=class extends mD{re;async *_transform(e){let t="";for await(let r of e)if("string"==typeof r?t+=r:t+=r.content,this.re){let e=[...t.matchAll(this.re)];if(e.length>1){let r=0;for(let t of e.slice(0,-1))yield[t[1]],r+=(t.index??0)+t[0].length;t=t.slice(r)}}else{let e=await this.parse(t);if(e.length>1){for(let t of e.slice(0,-1))yield[t];t=e[e.length-1]}}for(let e of(await this.parse(t)))yield[e]}},mZ=class extends mB{static lc_name(){return"CommaSeparatedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;async parse(e){try{return e.trim().split(",").map(e=>e.trim())}catch{throw new mL(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},mG=class extends mB{lc_namespace=["langchain_core","output_parsers","list"];length;separator;constructor({length:e,separator:t}){super(...arguments),this.length=e,this.separator=t||","}async parse(e){try{let t=e.trim().split(this.separator).map(e=>e.trim());if(void 0!==this.length&&t.length!==this.length)throw new mL(`Incorrect number of items. Expected ${this.length}, got ${t.length}.`);return t}catch(t){if(Object.getPrototypeOf(t)===mL.prototype)throw t;throw new mL(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${void 0===this.length?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},mH=class extends mB{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/\d+\.\s([^\n]+)/g;async parse(e){return[...e.matchAll(this.re)??[]].map(e=>e[1])}},mq=class extends mB{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/^\s*[-*]\s([^\n]+)$/gm;async parse(e){return[...e.matchAll(this.re)??[]].map(e=>e[1])}},mW=class extends mD{static lc_name(){return"StrOutputParser"}lc_namespace=["langchain_core","output_parsers","string"];lc_serializable=!0;parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw Error(`Cannot coerce "${e.type}" message part into a string.`)}throw Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((e,t)=>e+this._messageContentToString(t),"")}},mK=class extends mU{static lc_name(){return"StructuredOutputParser"}lc_namespace=["langchain","output_parsers","structured"];toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),this.schema=e}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(fC.z.object(Object.fromEntries(Object.entries(e).map(([e,t])=>[e,fC.z.string().describe(t)]))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(pM(this.schema))}
\`\`\`
`}async parse(e){try{let t=e.trim(),r=(t.match(/^```(?:json)?\s*([\s\S]*?)```/)?.[1]||t.match(/```json\s*([\s\S]*?)```/)?.[1]||t).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(e,t)=>{let r=t.replace(/\n/g,"\\n");return`"${r}"`}).replace(/\n/g,"");return await hN(this.schema,JSON.parse(r))}catch(t){throw new mL(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}},mJ=class extends mK{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(e){let t=e?.interpolationDepth??1;if(t<1)throw Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(pM(this.schema)).replaceAll("{","{".repeat(t)).replaceAll("}","}".repeat(t))}
\`\`\``}_schemaToInstruction(e,t=2){if("type"in e){let r,i=!1;if(Array.isArray(e.type)){let t=e.type.findIndex(e=>"null"===e);-1!==t&&(i=!0,e.type.splice(t,1)),r=e.type.join(" | ")}else r=e.type;if("object"===e.type&&e.properties){let r=e.description?` // ${e.description}`:"",i=Object.entries(e.properties).map(([r,i])=>{let n=e.required?.includes(r)?"":" (optional)";return`${" ".repeat(t)}"${r}": ${this._schemaToInstruction(i,t+2)}${n}`}).join("\n");return`{
${i}
${" ".repeat(t-2)}}${r}`}if("array"===e.type&&e.items){let r=e.description?` // ${e.description}`:"";return`array[
${" ".repeat(t)}${this._schemaToInstruction(e.items,t+2)}
${" ".repeat(t-2)}] ${r}`}let n=i?" (nullable)":"",a=e.description?` // ${e.description}`:"";return`${r}${a}${n}`}if("anyOf"in e)return e.anyOf.map(e=>this._schemaToInstruction(e,t)).join(`
${" ".repeat(t-2)}`);throw Error("unsupported schema type")}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(fC.z.object(Object.fromEntries(Object.entries(e).map(([e,t])=>[e,fC.z.string().describe(t)]))))}},mV=class extends mU{structuredInputParser;constructor({inputSchema:e}){super(...arguments),this.structuredInputParser=new mJ(e)}async parse(e){let t;try{t=await this.structuredInputParser.parse(e)}catch(t){throw new mL(`Failed to parse. Text: "${e}". Error: ${t}`,e)}return this.outputProcessor(t)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}};let mY=function(){let e={};e.parser=function(e,t){return new r(e,t)},e.SAXParser=r,e.SAXStream=l,e.createStream=function(e,t){return new l(e,t)},e.MAX_BUFFER_LENGTH=65536;let t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function r(i,n){if(!(this instanceof r))return new r(i,n);(function(e){for(var r=0,i=t.length;r<i;r++)e[t[r]]=""})(this),this.q=this.c="",this.bufferCheckPosition=e.MAX_BUFFER_LENGTH,this.opt=n||{},this.opt.lowercase=this.opt.lowercase||this.opt.lowercasetags,this.looseCase=this.opt.lowercase?"toLowerCase":"toUpperCase",this.tags=[],this.closed=this.closedRoot=this.sawRoot=!1,this.tag=this.error=null,this.strict=!!i,this.noscript=!!(i||this.opt.noscript),this.state=v.BEGIN,this.strictEntities=this.opt.strictEntities,this.ENTITIES=this.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),this.attribList=[],this.opt.xmlns&&(this.ns=Object.create(d)),this.trackPosition=!1!==this.opt.position,this.trackPosition&&(this.position=this.line=this.column=0),w(this,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}),r.prototype={end:function(){O(this)},write:function(r){if(this.error)throw this.error;if(this.closed)return I(this,"Cannot write after close. Assign an onready handler.");if(null===r)return O(this);"object"==typeof r&&(r=r.toString());for(var i=0,n="";n=R(r,i++),this.c=n,n;)switch(this.trackPosition&&(this.position++,"\n"===n?(this.line++,this.column=0):this.column++),this.state){case v.BEGIN:if(this.state=v.BEGIN_WHITESPACE,"\uFEFF"===n)continue;P(this,n);continue;case v.BEGIN_WHITESPACE:P(this,n);continue;case v.TEXT:if(this.sawRoot&&!this.closedRoot){for(var a=i-1;n&&"<"!==n&&"&"!==n;)(n=R(r,i++))&&this.trackPosition&&(this.position++,"\n"===n?(this.line++,this.column=0):this.column++);this.textNode+=r.substring(a,i-1)}"<"!==n||this.sawRoot&&this.closedRoot&&!this.strict?(g(n)||this.sawRoot&&!this.closedRoot||A(this,"Text data outside of root node."),"&"===n?this.state=v.TEXT_ENTITY:this.textNode+=n):(this.state=v.OPEN_WAKA,this.startTagPosition=this.position);continue;case v.SCRIPT:"<"===n?this.state=v.SCRIPT_ENDING:this.script+=n;continue;case v.SCRIPT_ENDING:"/"===n?this.state=v.CLOSE_TAG:(this.script+="<"+n,this.state=v.SCRIPT);continue;case v.OPEN_WAKA:"!"===n?(this.state=v.SGML_DECL,this.sgmlDecl=""):g(n)||(_(h,n)?(this.state=v.OPEN_TAG,this.tagName=n):"/"===n?(this.state=v.CLOSE_TAG,this.tagName=""):"?"===n?(this.state=v.PROC_INST,this.procInstName=this.procInstBody=""):(A(this,"Unencoded <"),this.startTagPosition+1<this.position&&(n=Array(this.position-this.startTagPosition).join(" ")+n),this.textNode+="<"+n,this.state=v.TEXT));continue;case v.SGML_DECL:"[CDATA["===(this.sgmlDecl+n).toUpperCase()?(E(this,"onopencdata"),this.state=v.CDATA,this.sgmlDecl="",this.cdata=""):this.sgmlDecl+n==="--"?(this.state=v.COMMENT,this.comment="",this.sgmlDecl=""):"DOCTYPE"===(this.sgmlDecl+n).toUpperCase()?(this.state=v.DOCTYPE,(this.doctype||this.sawRoot)&&A(this,"Inappropriately located doctype declaration"),this.doctype="",this.sgmlDecl=""):">"===n?(E(this,"onsgmldeclaration",this.sgmlDecl),this.sgmlDecl="",this.state=v.TEXT):(y(n)&&(this.state=v.SGML_DECL_QUOTED),this.sgmlDecl+=n);continue;case v.SGML_DECL_QUOTED:n===this.q&&(this.state=v.SGML_DECL,this.q=""),this.sgmlDecl+=n;continue;case v.DOCTYPE:">"===n?(this.state=v.TEXT,E(this,"ondoctype",this.doctype),this.doctype=!0):(this.doctype+=n,"["===n?this.state=v.DOCTYPE_DTD:y(n)&&(this.state=v.DOCTYPE_QUOTED,this.q=n));continue;case v.DOCTYPE_QUOTED:this.doctype+=n,n===this.q&&(this.q="",this.state=v.DOCTYPE);continue;case v.DOCTYPE_DTD:this.doctype+=n,"]"===n?this.state=v.DOCTYPE:y(n)&&(this.state=v.DOCTYPE_DTD_QUOTED,this.q=n);continue;case v.DOCTYPE_DTD_QUOTED:this.doctype+=n,n===this.q&&(this.state=v.DOCTYPE_DTD,this.q="");continue;case v.COMMENT:"-"===n?this.state=v.COMMENT_ENDING:this.comment+=n;continue;case v.COMMENT_ENDING:"-"===n?(this.state=v.COMMENT_ENDED,this.comment=S(this.opt,this.comment),this.comment&&E(this,"oncomment",this.comment),this.comment=""):(this.comment+="-"+n,this.state=v.COMMENT);continue;case v.COMMENT_ENDED:">"!==n?(A(this,"Malformed comment"),this.comment+="--"+n,this.state=v.COMMENT):this.state=v.TEXT;continue;case v.CDATA:"]"===n?this.state=v.CDATA_ENDING:this.cdata+=n;continue;case v.CDATA_ENDING:"]"===n?this.state=v.CDATA_ENDING_2:(this.cdata+="]"+n,this.state=v.CDATA);continue;case v.CDATA_ENDING_2:">"===n?(this.cdata&&E(this,"oncdata",this.cdata),E(this,"onclosecdata"),this.cdata="",this.state=v.TEXT):"]"===n?this.cdata+="]":(this.cdata+="]]"+n,this.state=v.CDATA);continue;case v.PROC_INST:"?"===n?this.state=v.PROC_INST_ENDING:g(n)?this.state=v.PROC_INST_BODY:this.procInstName+=n;continue;case v.PROC_INST_BODY:!this.procInstBody&&g(n)||("?"===n?this.state=v.PROC_INST_ENDING:this.procInstBody+=n);continue;case v.PROC_INST_ENDING:">"===n?(E(this,"onprocessinginstruction",{name:this.procInstName,body:this.procInstBody}),this.procInstName=this.procInstBody="",this.state=v.TEXT):(this.procInstBody+="?"+n,this.state=v.PROC_INST_BODY);continue;case v.OPEN_TAG:_(p,n)?this.tagName+=n:(!function(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,r=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(r.ns=t.ns),e.attribList.length=0,E(e,"onopentagstart",r)}(this),">"===n?$(this):"/"===n?this.state=v.OPEN_TAG_SLASH:(g(n)||A(this,"Invalid character in tag name"),this.state=v.ATTRIB));continue;case v.OPEN_TAG_SLASH:">"===n?($(this,!0),C(this)):(A(this,"Forward-slash in opening tag not followed by >"),this.state=v.ATTRIB);continue;case v.ATTRIB:g(n)||(">"===n?$(this):"/"===n?this.state=v.OPEN_TAG_SLASH:_(h,n)?(this.attribName=n,this.attribValue="",this.state=v.ATTRIB_NAME):A(this,"Invalid attribute name"));continue;case v.ATTRIB_NAME:"="===n?this.state=v.ATTRIB_VALUE:">"===n?(A(this,"Attribute without value"),this.attribValue=this.attribName,x(this),$(this)):g(n)?this.state=v.ATTRIB_NAME_SAW_WHITE:_(p,n)?this.attribName+=n:A(this,"Invalid attribute name");continue;case v.ATTRIB_NAME_SAW_WHITE:if("="===n)this.state=v.ATTRIB_VALUE;else{if(g(n))continue;A(this,"Attribute without value"),this.tag.attributes[this.attribName]="",this.attribValue="",E(this,"onattribute",{name:this.attribName,value:""}),this.attribName="",">"===n?$(this):_(h,n)?(this.attribName=n,this.state=v.ATTRIB_NAME):(A(this,"Invalid attribute name"),this.state=v.ATTRIB)}continue;case v.ATTRIB_VALUE:g(n)||(y(n)?(this.q=n,this.state=v.ATTRIB_VALUE_QUOTED):(A(this,"Unquoted attribute value"),this.state=v.ATTRIB_VALUE_UNQUOTED,this.attribValue=n));continue;case v.ATTRIB_VALUE_QUOTED:if(n!==this.q){"&"===n?this.state=v.ATTRIB_VALUE_ENTITY_Q:this.attribValue+=n;continue}x(this),this.q="",this.state=v.ATTRIB_VALUE_CLOSED;continue;case v.ATTRIB_VALUE_CLOSED:g(n)?this.state=v.ATTRIB:">"===n?$(this):"/"===n?this.state=v.OPEN_TAG_SLASH:_(h,n)?(A(this,"No whitespace between attributes"),this.attribName=n,this.attribValue="",this.state=v.ATTRIB_NAME):A(this,"Invalid attribute name");continue;case v.ATTRIB_VALUE_UNQUOTED:if(!(">"===(s=n)||g(s))){"&"===n?this.state=v.ATTRIB_VALUE_ENTITY_U:this.attribValue+=n;continue}x(this),">"===n?$(this):this.state=v.ATTRIB;continue;case v.CLOSE_TAG:this.tagName?">"===n?C(this):_(p,n)?this.tagName+=n:this.script?(this.script+="</"+this.tagName,this.tagName="",this.state=v.SCRIPT):(g(n)||A(this,"Invalid tagname in closing tag"),this.state=v.CLOSE_TAG_SAW_WHITE):g(n)||(_(h,n)?this.tagName=n:this.script?(this.script+="</"+n,this.state=v.SCRIPT):A(this,"Invalid tagname in closing tag."));continue;case v.CLOSE_TAG_SAW_WHITE:if(g(n))continue;">"===n?C(this):A(this,"Invalid characters in closing tag");continue;case v.TEXT_ENTITY:case v.ATTRIB_VALUE_ENTITY_Q:case v.ATTRIB_VALUE_ENTITY_U:switch(this.state){case v.TEXT_ENTITY:o=v.TEXT,l="textNode";break;case v.ATTRIB_VALUE_ENTITY_Q:o=v.ATTRIB_VALUE_QUOTED,l="attribValue";break;case v.ATTRIB_VALUE_ENTITY_U:o=v.ATTRIB_VALUE_UNQUOTED,l="attribValue"}if(";"===n)if(this.opt.unparsedEntities){var s,o,l,u=N(this);this.entity="",this.state=o,this.write(u)}else this[l]+=N(this),this.entity="",this.state=o;else _(this.entity.length?m:f,n)?this.entity+=n:(A(this,"Invalid character in entity name"),this[l]+="&"+this.entity+n,this.entity="",this.state=o);continue;default:throw Error(this,"Unknown state: "+this.state)}return this.position>=this.bufferCheckPosition&&function(r){for(var i=Math.max(e.MAX_BUFFER_LENGTH,10),n=0,a=0,s=t.length;a<s;a++){var o=r[t[a]].length;if(o>i)switch(t[a]){case"textNode":T(r);break;case"cdata":E(r,"oncdata",r.cdata),r.cdata="";break;case"script":E(r,"onscript",r.script),r.script="";break;default:I(r,"Max buffer length exceeded: "+t[a])}n=Math.max(n,o)}r.bufferCheckPosition=e.MAX_BUFFER_LENGTH-n+r.position}(this),this},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){T(this),""!==this.cdata&&(E(this,"oncdata",this.cdata),this.cdata=""),""!==this.script&&(E(this,"onscript",this.script),this.script="")}};var i,n,a,s=ReadableStream;s||(s=function(){});var o=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e});function l(e,t){if(!(this instanceof l))return new l(e,t);s.apply(this),this._parser=new r(e,t),this.writable=!0,this.readable=!0;var i=this;this._parser.onend=function(){i.emit("end")},this._parser.onerror=function(e){i.emit("error",e),i._parser.error=null},this._decoder=null,o.forEach(function(e){Object.defineProperty(i,"on"+e,{get:function(){return i._parser["on"+e]},set:function(t){if(!t)return i.removeAllListeners(e),i._parser["on"+e]=t,t;i.on(e,t)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(s.prototype,{constructor:{value:l}}),l.prototype.write=function(e){return this._parser.write(e.toString()),this.emit("data",e),!0},l.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},l.prototype.on=function(e,t){var r=this;return r._parser["on"+e]||-1===o.indexOf(e)||(r._parser["on"+e]=function(){var t=1==arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),r.emit.apply(r,t)}),s.prototype.on.call(r,e,t)};var u="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/2000/xmlns/",d={xml:u,xmlns:c},h=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,f=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,m=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function g(e){return" "===e||"\n"===e||"\r"===e||"	"===e}function y(e){return'"'===e||"'"===e}function _(e,t){return e.test(t)}var v=0;for(var b in e.STATE={BEGIN:v++,BEGIN_WHITESPACE:v++,TEXT:v++,TEXT_ENTITY:v++,OPEN_WAKA:v++,SGML_DECL:v++,SGML_DECL_QUOTED:v++,DOCTYPE:v++,DOCTYPE_QUOTED:v++,DOCTYPE_DTD:v++,DOCTYPE_DTD_QUOTED:v++,COMMENT_STARTING:v++,COMMENT:v++,COMMENT_ENDING:v++,COMMENT_ENDED:v++,CDATA:v++,CDATA_ENDING:v++,CDATA_ENDING_2:v++,PROC_INST:v++,PROC_INST_BODY:v++,PROC_INST_ENDING:v++,OPEN_TAG:v++,OPEN_TAG_SLASH:v++,ATTRIB:v++,ATTRIB_NAME:v++,ATTRIB_NAME_SAW_WHITE:v++,ATTRIB_VALUE:v++,ATTRIB_VALUE_QUOTED:v++,ATTRIB_VALUE_CLOSED:v++,ATTRIB_VALUE_UNQUOTED:v++,ATTRIB_VALUE_ENTITY_Q:v++,ATTRIB_VALUE_ENTITY_U:v++,CLOSE_TAG:v++,CLOSE_TAG_SAW_WHITE:v++,SCRIPT:v++,SCRIPT_ENDING:v++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var r=e.ENTITIES[t],i="number"==typeof r?String.fromCharCode(r):r;e.ENTITIES[t]=i}),e.STATE)e.STATE[e.STATE[b]]=b;function w(e,t,r){e[t]&&e[t](r)}function E(e,t,r){e.textNode&&T(e),w(e,t,r)}function T(e){e.textNode=S(e.opt,e.textNode),e.textNode&&w(e,"ontext",e.textNode),e.textNode=""}function S(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function I(e,t){return T(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),e.error=t=Error(t),w(e,"onerror",t),e}function O(e){return e.sawRoot&&!e.closedRoot&&A(e,"Unclosed root tag"),e.state!==v.BEGIN&&e.state!==v.BEGIN_WHITESPACE&&e.state!==v.TEXT&&I(e,"Unexpected end"),T(e),e.c="",e.closed=!0,w(e,"onend"),r.call(e,e.strict,e.opt),e}function A(e,t){if("object"!=typeof e||!(e instanceof r))throw Error("bad call to strictFail");e.strict&&I(e,t)}function k(e,t){var r=0>e.indexOf(":")?["",e]:e.split(":"),i=r[0],n=r[1];return t&&"xmlns"===e&&(i="xmlns",n=""),{prefix:i,local:n}}function x(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName)){e.attribName=e.attribValue="";return}if(e.opt.xmlns){var t=k(e.attribName,!0),r=t.prefix,i=t.local;if("xmlns"===r)if("xml"===i&&e.attribValue!==u)A(e,"xml: prefix must be bound to "+u+"\nActual: "+e.attribValue);else if("xmlns"===i&&e.attribValue!==c)A(e,"xmlns: prefix must be bound to "+c+"\nActual: "+e.attribValue);else{var n=e.tag,a=e.tags[e.tags.length-1]||e;n.ns===a.ns&&(n.ns=Object.create(a.ns)),n.ns[i]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,E(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}function $(e,t){if(e.opt.xmlns){var r=e.tag,i=k(e.tagName);r.prefix=i.prefix,r.local=i.local,r.uri=r.ns[i.prefix]||"",r.prefix&&!r.uri&&(A(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),r.uri=i.prefix);var n=e.tags[e.tags.length-1]||e;r.ns&&n.ns!==r.ns&&Object.keys(r.ns).forEach(function(t){E(e,"onopennamespace",{prefix:t,uri:r.ns[t]})});for(var a=0,s=e.attribList.length;a<s;a++){var o=e.attribList[a],l=o[0],u=o[1],c=k(l,!0),d=c.prefix,h=c.local,p=""===d?"":r.ns[d]||"",f={name:l,value:u,prefix:d,local:h,uri:p};d&&"xmlns"!==d&&!p&&(A(e,"Unbound namespace prefix: "+JSON.stringify(d)),f.uri=d),e.tag.attributes[l]=f,E(e,"onattribute",f)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),E(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=v.TEXT:e.state=v.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function C(e){if(!e.tagName){A(e,"Weird empty close tag."),e.textNode+="</>",e.state=v.TEXT;return}if(e.script){if("script"!==e.tagName){e.script+="</"+e.tagName+">",e.tagName="",e.state=v.SCRIPT;return}E(e,"onscript",e.script),e.script=""}var t=e.tags.length,r=e.tagName;e.strict||(r=r[e.looseCase]());for(var i=r;t--;)if(e.tags[t].name!==i)A(e,"Unexpected close tag");else break;if(t<0){A(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",e.state=v.TEXT;return}e.tagName=r;for(var n=e.tags.length;n-- >t;){var a=e.tag=e.tags.pop();e.tagName=e.tag.name,E(e,"onclosetag",e.tagName);var s={};for(var o in a.ns)s[o]=a.ns[o];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&a.ns!==l.ns&&Object.keys(a.ns).forEach(function(t){var r=a.ns[t];E(e,"onclosenamespace",{prefix:t,uri:r})})}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=v.TEXT}function N(e){var t,r=e.entity,i=r.toLowerCase(),n="";return e.ENTITIES[r]?e.ENTITIES[r]:e.ENTITIES[i]?e.ENTITIES[i]:("#"===(r=i).charAt(0)&&(n="x"===r.charAt(1)?(t=parseInt(r=r.slice(2),16)).toString(16):(t=parseInt(r=r.slice(1),10)).toString(10)),r=r.replace(/^0+/,""),isNaN(t)||n.toLowerCase()!==r)?(A(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t)}function P(e,t){"<"===t?(e.state=v.OPEN_WAKA,e.startTagPosition=e.position):g(t)||(A(e,"Non-whitespace before first tag."),e.textNode=t,e.state=v.TEXT)}function R(e,t){var r="";return t<e.length&&(r=e.charAt(t)),r}return v=e.STATE,String.fromCodePoint||(i=String.fromCharCode,n=Math.floor,a=function(){var e,t,r=[],a=-1,s=arguments.length;if(!s)return"";for(var o="";++a<s;){var l=Number(arguments[a]);if(!isFinite(l)||l<0||l>1114111||n(l)!==l)throw RangeError("Invalid code point: "+l);l<=65535?r.push(l):(l-=65536,e=(l>>10)+55296,t=l%1024+56320,r.push(e,t)),(a+1===s||r.length>16384)&&(o+=i.apply(null,r),r.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:a,configurable:!0,writable:!0}):String.fromCodePoint=a),e}(),mX=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;var mQ=class extends mM{tags;constructor(e){super(e),this.tags=e?.tags}static lc_name(){return"XMLOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_diff(e,t){if(t)return e?fa(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return m1(e[0].text)}async parse(e){return m1(e)}getFormatInstructions(){return this.tags&&this.tags.length>0?mX.replace("{tags}",this.tags?.join(", ")??""):mX}};let m0=e=>{if(0===Object.keys(e).length)return{};let t={};return e.children.length>0?t[e.name]=e.children.map(m0):t[e.name]=e.text??void 0,t};function m1(e){let t=e.split("\n").map(e=>e.replace(/^\s+/,"")).join("\n").trim(),r=mY.parser(!0),i={},n=[];r.onopentag=e=>{let t={name:e.name,attributes:e.attributes,children:[],text:"",isSelfClosing:e.isSelfClosing};n.length>0?n[n.length-1].children.push(t):i=t,e.isSelfClosing||n.push(t)},r.onclosetag=()=>{if(n.length>0){let e=n.pop();0===n.length&&e&&(i=e)}},r.ontext=e=>{if(n.length>0){let t=n[n.length-1];t.text+=e}},r.onattribute=e=>{n.length>0&&(n[n.length-1].attributes[e.name]=e.value)};let a=/```(xml)?(.*)```/s.exec(t),s=a?a[2]:t;return r.write(s).close(),i&&"?xml"===i.name&&(i=i.children[0]),m0(i)}iI({},{AsymmetricStructuredOutputParser:()=>mV,BaseCumulativeTransformOutputParser:()=>mM,BaseLLMOutputParser:()=>mj,BaseOutputParser:()=>mU,BaseTransformOutputParser:()=>mD,BytesOutputParser:()=>mF,CommaSeparatedListOutputParser:()=>mZ,CustomListOutputParser:()=>mG,JsonMarkdownStructuredOutputParser:()=>mJ,JsonOutputParser:()=>mz,ListOutputParser:()=>mB,MarkdownListOutputParser:()=>mq,NumberedListOutputParser:()=>mH,OutputParserException:()=>mL,StringOutputParser:()=>mW,StructuredOutputParser:()=>mK,XMLOutputParser:()=>mQ,XML_FORMAT_INSTRUCTIONS:()=>mX,parseJsonMarkdown:()=>nE,parsePartialJson:()=>nT,parseXMLMarkdown:()=>m1});let m4=Symbol("Let zodToJsonSchema decide on which parser to use"),m2={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function m6(e,t,r,i){i?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function m9(e,t,r,i,n){e[t]=r,m6(e,t,i,n)}function m3(e,t){return gy(e.type._def,t)}let m5=/^[cC][^\s-]{8,}$/,m8=/^[0-9a-z]+$/,m7=/^[0-9A-HJKMNP-TV-Z]{26}$/,ge=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,gt=()=>(void 0===f&&(f=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),f),gr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,gi=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,gn=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ga=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,gs=/^[a-zA-Z0-9_-]{21}$/,go=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function gl(e,t){let r={type:"string"};if(e.checks)for(let i of e.checks)switch(i.kind){case"min":m9(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t);break;case"max":m9(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"email":switch(t.emailStrategy){case"format:email":gd(r,"email",i.message,t);break;case"format:idn-email":gd(r,"idn-email",i.message,t);break;case"pattern:zod":gh(r,ge,i.message,t)}break;case"url":gd(r,"uri",i.message,t);break;case"uuid":gd(r,"uuid",i.message,t);break;case"regex":gh(r,i.regex,i.message,t);break;case"cuid":gh(r,m5,i.message,t);break;case"cuid2":gh(r,m8,i.message,t);break;case"startsWith":gh(r,RegExp(`^${gu(i.value,t)}`),i.message,t);break;case"endsWith":gh(r,RegExp(`${gu(i.value,t)}$`),i.message,t);break;case"datetime":gd(r,"date-time",i.message,t);break;case"date":gd(r,"date",i.message,t);break;case"time":gd(r,"time",i.message,t);break;case"duration":gd(r,"duration",i.message,t);break;case"length":m9(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t),m9(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"includes":gh(r,RegExp(gu(i.value,t)),i.message,t);break;case"ip":"v6"!==i.version&&gd(r,"ipv4",i.message,t),"v4"!==i.version&&gd(r,"ipv6",i.message,t);break;case"base64url":gh(r,ga,i.message,t);break;case"jwt":gh(r,go,i.message,t);break;case"cidr":"v6"!==i.version&&gh(r,gr,i.message,t),"v4"!==i.version&&gh(r,gi,i.message,t);break;case"emoji":gh(r,gt(),i.message,t);break;case"ulid":gh(r,m7,i.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":gd(r,"binary",i.message,t);break;case"contentEncoding:base64":m9(r,"contentEncoding","base64",i.message,t);break;case"pattern:zod":gh(r,gn,i.message,t)}break;case"nanoid":gh(r,gs,i.message,t)}return r}function gu(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)gc.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let gc=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function gd(e,t,r,i){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&i.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&i.errorMessages&&{errorMessage:{format:r}}})):m9(e,"format",t,r,i)}function gh(e,t,r,i){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&i.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:gp(t,i),...r&&i.errorMessages&&{errorMessage:{pattern:r}}})):m9(e,"pattern",gp(t,i),r,i)}function gp(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},i=r.i?e.source.toLowerCase():e.source,n="",a=!1,s=!1,o=!1;for(let e=0;e<i.length;e++){if(a){n+=i[e],a=!1;continue}if(r.i){if(s){if(i[e].match(/[a-z]/)){o?(n+=i[e],n+=`${i[e-2]}-${i[e]}`.toUpperCase(),o=!1):"-"===i[e+1]&&i[e+2]?.match(/[a-z]/)?(n+=i[e],o=!0):n+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){n+=`[${i[e]}${i[e].toUpperCase()}]`;continue}}if(r.m){if("^"===i[e]){n+=`(^|(?<=[\r
]))`;continue}else if("$"===i[e]){n+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===i[e]){n+=s?`${i[e]}\r
`:`[${i[e]}\r
]`;continue}n+=i[e],"\\"===i[e]?a=!0:s&&"]"===i[e]?s=!1:s||"["!==i[e]||(s=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return n}function gf(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===h6.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,i)=>({...r,[i]:gy(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",i]})??{}}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:gy(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===h6.ZodFirstPartyTypeKind.ZodString&&e.keyType._def.checks?.length){let{type:i,...n}=gl(e.keyType._def,t);return{...r,propertyNames:n}}if(e.keyType?._def.typeName===h6.ZodFirstPartyTypeKind.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===h6.ZodFirstPartyTypeKind.ZodBranded&&e.keyType._def.type._def.typeName===h6.ZodFirstPartyTypeKind.ZodString&&e.keyType._def.type._def.checks?.length){let{type:i,...n}=m3(e.keyType._def,t);return{...r,propertyNames:n}}return r}let gm={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},gg=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>gy(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0};function gy(e,t,r=!1){let i=t.seen.get(e);if(t.override){let n=t.override?.(e,t,i,r);if(n!==m4)return n}if(i&&!r){let e=g_(i,t);if(void 0!==e)return e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let a=((e,t,r)=>{switch(t){case h6.ZodFirstPartyTypeKind.ZodString:return gl(e,r);case h6.ZodFirstPartyTypeKind.ZodNumber:let i={type:"number"};if(!e.checks)return i;for(let t of e.checks)switch(t.kind){case"int":i.type="integer",m6(i,"type",t.message,r);break;case"min":"jsonSchema7"===r.target?t.inclusive?m9(i,"minimum",t.value,t.message,r):m9(i,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(i.exclusiveMinimum=!0),m9(i,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?m9(i,"maximum",t.value,t.message,r):m9(i,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(i.exclusiveMaximum=!0),m9(i,"maximum",t.value,t.message,r));break;case"multipleOf":m9(i,"multipleOf",t.value,t.message,r)}return i;case h6.ZodFirstPartyTypeKind.ZodObject:return function(e,t){let r="openAi"===t.target,i={type:"object",properties:{}},n=[],a=e.shape();for(let e in a){let s=a[e];if(void 0===s||void 0===s._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(s);o&&r&&(s instanceof h6.ZodOptional&&(s=s._def.innerType),s.isNullable()||(s=s.nullable()),o=!1);let l=gy(s._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(i.properties[e]=l,o||n.push(e))}n.length&&(i.required=n);let s=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return gy(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==s&&(i.additionalProperties=s),i}(e,r);case h6.ZodFirstPartyTypeKind.ZodBigInt:let n={type:"integer",format:"int64"};if(!e.checks)return n;for(let t of e.checks)switch(t.kind){case"min":"jsonSchema7"===r.target?t.inclusive?m9(n,"minimum",t.value,t.message,r):m9(n,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(n.exclusiveMinimum=!0),m9(n,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?m9(n,"maximum",t.value,t.message,r):m9(n,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(n.exclusiveMaximum=!0),m9(n,"maximum",t.value,t.message,r));break;case"multipleOf":m9(n,"multipleOf",t.value,t.message,r)}return n;case h6.ZodFirstPartyTypeKind.ZodBoolean:return{type:"boolean"};case h6.ZodFirstPartyTypeKind.ZodDate:return function e(t,r,i){let n=i??r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((i,n)=>e(t,r,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var a=t,s=r;let o={type:"integer",format:"unix-time"};if("openApi3"===s.target)return o;for(let e of a.checks)switch(e.kind){case"min":m9(o,"minimum",e.value,e.message,s);break;case"max":m9(o,"maximum",e.value,e.message,s)}return o}}(e,r);case h6.ZodFirstPartyTypeKind.ZodUndefined:return{not:{}};case h6.ZodFirstPartyTypeKind.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case h6.ZodFirstPartyTypeKind.ZodArray:let a;return a={type:"array"},e.type?._def&&e.type?._def?.typeName!==h6.ZodFirstPartyTypeKind.ZodAny&&(a.items=gy(e.type._def,{...r,currentPath:[...r.currentPath,"items"]})),e.minLength&&m9(a,"minItems",e.minLength.value,e.minLength.message,r),e.maxLength&&m9(a,"maxItems",e.maxLength.value,e.maxLength.message,r),e.exactLength&&(m9(a,"minItems",e.exactLength.value,e.exactLength.message,r),m9(a,"maxItems",e.exactLength.value,e.exactLength.message,r)),a;case h6.ZodFirstPartyTypeKind.ZodUnion:case h6.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:if("openApi3"===r.target)return gg(e,r);let s=e.options instanceof Map?Array.from(e.options.values()):e.options;if(s.every(e=>e._def.typeName in gm&&(!e._def.checks||!e._def.checks.length))){let e=s.reduce((e,t)=>{let r=gm[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(s.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=s.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===s.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:s.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(s.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:s.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return gg(e,r);case h6.ZodFirstPartyTypeKind.ZodIntersection:let o,l,u;return o=[gy(e.left._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),gy(e.right._def,{...r,currentPath:[...r.currentPath,"allOf","1"]})].filter(e=>!!e),l="jsonSchema2019-09"===r.target?{unevaluatedProperties:!1}:void 0,u=[],o.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)u.push(...e.allOf),void 0===e.unevaluatedProperties&&(l=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...i}=e;t=i}else l=void 0;u.push(t)}}),u.length?{allOf:u,...l}:void 0;case h6.ZodFirstPartyTypeKind.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>gy(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:gy(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>gy(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case h6.ZodFirstPartyTypeKind.ZodRecord:return gf(e,r);case h6.ZodFirstPartyTypeKind.ZodLiteral:let c;return"bigint"!=(c=typeof e.value)&&"number"!==c&&"boolean"!==c&&"string"!==c?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===r.target?{type:"bigint"===c?"integer":c,enum:[e.value]}:{type:"bigint"===c?"integer":c,const:e.value};case h6.ZodFirstPartyTypeKind.ZodEnum:return{type:"string",enum:Array.from(e.values)};case h6.ZodFirstPartyTypeKind.ZodNativeEnum:let d,h,p;return d=e.values,{type:1===(p=Array.from(new Set((h=Object.keys(e.values).filter(e=>"number"!=typeof d[d[e]]).map(e=>d[e])).map(e=>typeof e)))).length?"string"===p[0]?"string":"number":["string","number"],enum:h};case h6.ZodFirstPartyTypeKind.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===r.target?{type:gm[e.innerType._def.typeName],nullable:!0}:{type:[gm[e.innerType._def.typeName],"null"]};if("openApi3"===r.target){let t=gy(e.innerType._def,{...r,currentPath:[...r.currentPath]});return t&&"$ref"in t?{allOf:[t],nullable:!0}:t&&{...t,nullable:!0}}let f=gy(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","0"]});return f&&{anyOf:[f,{type:"null"}]};case h6.ZodFirstPartyTypeKind.ZodOptional:if(r.currentPath.toString()===r.propertyPath?.toString())return gy(e.innerType._def,r);let m=gy(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","1"]});return m?{anyOf:[{not:{}},m]}:{};case h6.ZodFirstPartyTypeKind.ZodMap:if("record"===r.mapStrategy)return gf(e,r);return{type:"array",maxItems:125,items:{type:"array",items:[gy(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||{},gy(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case h6.ZodFirstPartyTypeKind.ZodSet:let g;return g={type:"array",uniqueItems:!0,items:gy(e.valueType._def,{...r,currentPath:[...r.currentPath,"items"]})},e.minSize&&m9(g,"minItems",e.minSize.value,e.minSize.message,r),e.maxSize&&m9(g,"maxItems",e.maxSize.value,e.maxSize.message,r),g;case h6.ZodFirstPartyTypeKind.ZodLazy:return()=>e.getter()._def;case h6.ZodFirstPartyTypeKind.ZodPromise:return gy(e.type._def,r);case h6.ZodFirstPartyTypeKind.ZodNaN:case h6.ZodFirstPartyTypeKind.ZodNever:return{not:{}};case h6.ZodFirstPartyTypeKind.ZodEffects:return"input"===r.effectStrategy?gy(e.schema._def,r):{};case h6.ZodFirstPartyTypeKind.ZodAny:case h6.ZodFirstPartyTypeKind.ZodUnknown:return{};case h6.ZodFirstPartyTypeKind.ZodDefault:return{...gy(e.innerType._def,r),default:e.defaultValue()};case h6.ZodFirstPartyTypeKind.ZodBranded:return m3(e,r);case h6.ZodFirstPartyTypeKind.ZodReadonly:case h6.ZodFirstPartyTypeKind.ZodCatch:return gy(e.innerType._def,r);case h6.ZodFirstPartyTypeKind.ZodPipeline:if("input"===r.pipeStrategy)return gy(e.in._def,r);if("output"===r.pipeStrategy)return gy(e.out._def,r);let y=gy(e.in._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),_=gy(e.out._def,{...r,currentPath:[...r.currentPath,"allOf",y?"1":"0"]});return{allOf:[y,_].filter(e=>void 0!==e)};case h6.ZodFirstPartyTypeKind.ZodFunction:case h6.ZodFirstPartyTypeKind.ZodVoid:case h6.ZodFirstPartyTypeKind.ZodSymbol:default:return}})(e,e.typeName,t),s="function"==typeof a?gy(a(),t):a;if(s&&gb(e,t,s),t.postProcess){let r=t.postProcess(s,e,t);return n.jsonSchema=s,r}return n.jsonSchema=s,s}let g_=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:gv(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},gv=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},gb=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);function gw(e){if("object"==typeof e&&null!==e){let t={...e};for(let e in"additionalProperties"in t&&delete t.additionalProperties,"$schema"in t&&delete t.$schema,"strict"in t&&delete t.strict,t)e in t&&(Array.isArray(t[e])?t[e]=t[e].map(gw):"object"==typeof t[e]&&null!==t[e]&&(t[e]=gw(t[e])));return t}return e}function gE(e){let{$schema:t,...r}=gw(hO(e)?((e,t)=>{let r,i,n=(i=void 0!==(r="string"==typeof t?{...m2,name:t}:{...m2,...t}).name?[...r.basePath,r.definitionPath,r.name]:r.basePath,{...r,currentPath:i,propertyPath:void 0,seen:new Map(Object.entries(r.definitions).map(([e,t])=>[t._def,{def:t._def,path:[...r.basePath,r.definitionPath,e],jsonSchema:void 0}]))}),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,r])=>({...e,[t]:gy(r._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??{}}),{}):void 0,s="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,o=gy(e._def,void 0===s?n:{...n,currentPath:[...n.basePath,n.definitionPath,s]},!1)??{},l="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==l&&(o.title=l);let u=void 0===s?a?{...o,[n.definitionPath]:a}:o:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...a,[s]:o}};return"jsonSchema7"===n.target?u.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===n.target||"openAi"===n.target)&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===n.target&&("anyOf"in u||"oneOf"in u||"allOf"in u||"type"in u&&Array.isArray(u.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),u})(e):e);return r}function gT(e){return void 0!==e&&Array.isArray(e.lc_namespace)}function gS(e){return void 0!==e&&fP.isRunnable(e)&&"lc_name"in e.constructor&&"function"==typeof e.constructor.lc_name&&"RunnableToolLike"===e.constructor.lc_name()}function gI(e){return!!e&&"object"==typeof e&&"name"in e&&"schema"in e&&(hA(e.schema)||null!=e.schema&&"object"==typeof e.schema&&"type"in e.schema&&"string"==typeof e.schema.type&&["null","boolean","object","array","number","string"].includes(e.schema.type))}function gO(e){return gI(e)||gS(e)||gT(e)}function gA(e,t){let r="number"==typeof t?void 0:t;return{name:e.name,description:e.description,parameters:pM(e.schema),...r?.strict!==void 0?{strict:r.strict}:{}}}function gk(e,t){let r,i="number"==typeof t?void 0:t;return r=gO(e)?{type:"function",function:gA(e)}:e,i?.strict!==void 0&&(r.function.strict=i.strict),r}iI({},{convertToOpenAIFunction:()=>gA,convertToOpenAITool:()=>gk,isLangChainTool:()=>gO,isRunnableToolLike:()=>gS,isStructuredTool:()=>gT,isStructuredToolParams:()=>gI});var gx=e.i(254799);let g$={randomUUID:gx.randomUUID},gC=new Uint8Array(256),gN=gC.length,gP=[];for(let e=0;e<256;++e)gP.push((e+256).toString(16).slice(1));let gR=function(e,t,r){if(g$.randomUUID&&!t&&!e)return g$.randomUUID();let i=(e=e||{}).random??e.rng?.()??(gN>gC.length-16&&((0,gx.randomFillSync)(gC),gN=0),gC.slice(gN,gN+=16));if(i.length<16)throw Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=i[e];return t}return function(e,t=0){return(gP[e[t+0]]+gP[e[t+1]]+gP[e[t+2]]+gP[e[t+3]]+"-"+gP[e[t+4]]+gP[e[t+5]]+"-"+gP[e[t+6]]+gP[e[t+7]]+"-"+gP[e[t+8]]+gP[e[t+9]]+"-"+gP[e[t+10]]+gP[e[t+11]]+gP[e[t+12]]+gP[e[t+13]]+gP[e[t+14]]+gP[e[t+15]]).toLowerCase()}(i)};function gj(e,t,r=!1){return e.reduce((i,n,a)=>{let s;if(!nd(n))throw Error("Unsupported message input");let o=(s=n._getType(),nS.isInstance(n)?n.role:"tool"===s?s:n.name??s);if("system"===o&&0!==a)throw Error("System message should be the first one");let l=function(e){switch(e){case"supervisor":case"ai":case"model":return"model";case"system":return"system";case"human":return"user";case"tool":case"function":return"function";default:throw Error(`Unknown / unsupported author: ${e}`)}}(o),u=i.content[i.content.length];if(!i.mergeWithPreviousContent&&u&&u.role===l)throw Error("Google Generative AI requires alternate messages between authors");let c=function(e,t,r){if("string"==typeof e.content&&""!==e.content&&!ny(e))return[{text:e.content}];let i=[],n=[],a=[];if("tool_calls"in e&&Array.isArray(e.tool_calls)&&e.tool_calls.length>0)i=e.tool_calls.map(e=>({functionCall:{name:e.name,args:e.args}}));else if(ny(e)&&e.content){let t=e.name??r.map(e=>nV(e)?e.tool_calls??[]:[]).flat().find(t=>t.id===e.tool_call_id)?.name;if(void 0===t)throw Error(`Google requires a tool name for each tool call response, and we could not infer a called tool name for ToolMessage "${e.id}" from your passed messages. Please populate a "name" field on that ToolMessage explicitly.`);n=[{functionResponse:{name:t,response:"string"==typeof e.content?{result:e.content}:e.content}}]}else Array.isArray(e.content)&&(a=e.content.map(e=>{if("text"===e.type)return{text:e.text};if("executableCode"===e.type)return{executableCode:e.executableCode};if("codeExecutionResult"===e.type)return{codeExecutionResult:e.codeExecutionResult};if("image_url"===e.type){let r;if(!t)throw Error("This model does not support images");if("string"==typeof e.image_url)r=e.image_url;else if("object"==typeof e.image_url&&"url"in e.image_url)r=e.image_url.url;else throw Error("Please provide image as base64 encoded data URL");let[i,n]=r.split(",");if(!i.startsWith("data:"))throw Error("Please provide image as base64 encoded data URL");let[a,s]=i.replace(/^data:/,"").split(";");if("base64"!==s)throw Error("Please provide image as base64 encoded data URL");return{inlineData:{data:n,mimeType:a}}}if("media"===e.type){if("mimeType"in e&&"data"in e)return{inlineData:{mimeType:e.mimeType,data:e.data}};if("mimeType"in e&&"fileUri"in e)return{fileData:{mimeType:e.mimeType,fileUri:e.fileUri}};throw Error("Invalid media content")}if("tool_use"===e.type)return{functionCall:{name:e.name,args:e.input}};if(e.type?.includes("/")&&2===e.type.split("/").length&&"data"in e&&"string"==typeof e.data)return{inlineData:{mimeType:e.type,data:e.data}};throw Error(`Unknown content type ${e.type}`)}));return[...a,...i,...n]}(n,t,e.slice(0,a));if(i.mergeWithPreviousContent){let e=i.content[i.content.length-1];if(!e)throw Error("There was a problem parsing your system message. Please try a prompt without one.");return e.parts.push(...c),{mergeWithPreviousContent:!1,content:i.content}}let d=l;"function"!==d&&("system"!==d||r)||(d="user");let h={role:d,parts:c};return{mergeWithPreviousContent:"system"===o&&!r,content:[...i.content,h]}},{content:[],mergeWithPreviousContent:!1}).content}e.s(["v4",0,gR],929492);class gU extends mj{static lc_name(){return"GoogleGenerativeAIToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","google_genai","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;let t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new mL(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){let t=e.flatMap(e=>{let{message:t}=e;return"tool_calls"in t&&Array.isArray(t.tool_calls)?t.tool_calls:[]});if(void 0===t[0])throw Error("No parseable tool calls provided to GoogleGenerativeAIToolsOutputParser.");let[r]=t;return await this._validateResult(r.args)}}function gL(e,t){let r,i,n=(r=[],i=[],(e.forEach(e=>{var t,n;if(gO(e)){let[i]=(t=[e]).every(e=>"functionDeclarations"in e&&Array.isArray(e.functionDeclarations))?t:[{functionDeclarations:t.map(e=>{if(gO(e)){let t=gE(e.schema);return"object"===t.type&&"properties"in t&&0===Object.keys(t.properties).length?{name:e.name,description:e.description}:{name:e.name,description:e.description,parameters:t}}return mT(e)?{name:e.function.name,description:e.function.description??"A function available to call.",parameters:function(e){let{$schema:t,...r}=gw(e);return r}(e.function.parameters)}:e})}];i.functionDeclarations&&r.push(...i.functionDeclarations)}else if(mT(e)){let{functionDeclarations:t}={functionDeclarations:[{name:(n=e).function.name,description:n.function.description,parameters:gw(n.function.parameters)}]};if(t)r.push(...t);else throw Error("Failed to convert OpenAI structured tool to GenerativeAI tool")}else i.push(e)}),i.find(e=>"functionDeclarations"in e))?i.map(e=>{if(r?.length>0&&"functionDeclarations"in e){let t={functionDeclarations:[...e.functionDeclarations||[],...r]};return r=[],t}return e}):[...i,...r.length>0?[{functionDeclarations:r}]:[]]),a=function(e,t){if(!e.length||!t)return;let{toolChoice:r,allowedFunctionNames:i}=t,n={any:tf.ANY,auto:tf.AUTO,none:tf.NONE};return r&&["any","auto","none"].includes(r)?{functionCallingConfig:{mode:n[r]??"MODE_UNSPECIFIED",allowedFunctionNames:i}}:"string"==typeof r||i?{functionCallingConfig:{mode:tf.ANY,allowedFunctionNames:[...i??[],...r&&"string"==typeof r?[r]:[]]}}:void 0}(n,t);return{tools:n,toolConfig:a}}class gD extends m${static lc_name(){return"ChatGoogleGenerativeAI"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get lc_aliases(){return{apiKey:"google_api_key"}}get _isMultimodalModel(){return this.model.includes("vision")||this.model.startsWith("gemini-1.5")||this.model.startsWith("gemini-2")}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","google_genai"]}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"convertSystemMessageToHumanContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=e.model.replace(/^models\//,""),this.maxOutputTokens=e.maxOutputTokens??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw Error("`maxOutputTokens` must be a positive integer");if(this.temperature=e.temperature??this.temperature,this.temperature&&(this.temperature<0||this.temperature>2))throw Error("`temperature` must be in the range of [0.0,2.0]");if(this.topP=e.topP??this.topP,this.topP&&this.topP<0)throw Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw Error("`topP` must be below 1.");if(this.topK=e.topK??this.topK,this.topK&&this.topK<0)throw Error("`topK` must be a positive integer");if(this.stopSequences=e.stopSequences??this.stopSequences,this.apiKey=e.apiKey??iP("GOOGLE_API_KEY"),!this.apiKey)throw Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=e.safetySettings??this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(e=>e.category)).size!==this.safetySettings.length)throw Error("The categories in `safetySettings` array must be unique");this.streaming=e.streaming??this.streaming,this.json=e.json,this.client=new J(this.apiKey).getGenerativeModel({model:this.model,safetySettings:this.safetySettings,generationConfig:{stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK,...this.json?{responseMimeType:"application/json"}:{}}},{apiVersion:e.apiVersion,baseUrl:e.baseUrl}),this.streamUsage=e.streamUsage??this.streamUsage}useCachedContent(e,t,r){this.apiKey&&(this.client=new J(this.apiKey).getGenerativeModelFromCachedContent(e,t,r))}get useSystemInstruction(){return"boolean"==typeof this.convertSystemMessageToHumanContent?!this.convertSystemMessageToHumanContent:this.computeUseSystemInstruction}get computeUseSystemInstruction(){return!("gemini-1.0-pro-001"===this.model||this.model.startsWith("gemini-pro-vision"))&&!this.model.startsWith("gemini-1.0-pro-vision")&&"gemini-pro"!==this.model&&!0}getLsParams(e){return{ls_provider:"google_genai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.client.generationConfig.temperature,ls_max_tokens:this.client.generationConfig.maxOutputTokens,ls_stop:e.stop}}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}bindTools(e,t){return this.bind({tools:gL(e)?.tools,...t})}invocationParams(e){let t=e?.tools?.length?gL(e.tools,{toolChoice:e.tool_choice,allowedFunctionNames:e.allowedFunctionNames}):void 0;return e?.responseSchema?(this.client.generationConfig.responseSchema=e.responseSchema,this.client.generationConfig.responseMimeType="application/json"):(this.client.generationConfig.responseSchema=void 0,this.client.generationConfig.responseMimeType=this.json?"application/json":void 0),{...t?.tools?{tools:t.tools}:{},...t?.toolConfig?{toolConfig:t.toolConfig}:{}}}async _generate(e,t,r){let i,n=gj(e,this._isMultimodalModel,this.useSystemInstruction),a=n;if("system"===n[0].role){let[e]=n;this.client.systemInstruction=e,a=n.slice(1)}let s=this.invocationParams(t);if(this.streaming){let i=this._streamResponseChunks(e,t,r),n={};for await(let e of i){let t=e.generationInfo?.completion??0;void 0===n[t]?n[t]=e:n[t]=n[t].concat(e)}return{generations:Object.entries(n).sort(([e],[t])=>parseInt(e,10)-parseInt(t,10)).map(([e,t])=>t),llmOutput:{estimatedTokenUsage:{}}}}let o=await this.completionWithRetry({...s,contents:a});if("usageMetadata"in o.response){let e=o.response.usageMetadata;i={input_tokens:e.promptTokenCount??0,output_tokens:e.candidatesTokenCount??0,total_tokens:e.totalTokenCount??0}}let l=function(e,t){let r;if(!e.candidates||0===e.candidates.length||!e.candidates[0])return{generations:[],llmOutput:{filters:e.promptFeedback}};let i=e.functionCalls(),[n]=e.candidates,{content:a,...s}=n;r=a?.parts.length===1&&a.parts[0].text?a.parts[0].text:a.parts.map(e=>"text"in e?{type:"text",text:e.text}:"executableCode"in e?{type:"executableCode",executableCode:e.executableCode}:"codeExecutionResult"in e?{type:"codeExecutionResult",codeExecutionResult:e.codeExecutionResult}:e);let o="";return"string"==typeof r?o=r:"text"in r[0]&&(o=r[0].text),{generations:[{text:o,message:new nJ({content:r,tool_calls:i?.map(e=>({...e,type:"tool_call",id:"id"in e&&"string"==typeof e.id?e.id:gR()})),additional_kwargs:{...s},usage_metadata:t?.usageMetadata}),generationInfo:s}],llmOutput:{tokenUsage:{promptTokens:t?.usageMetadata?.input_tokens,completionTokens:t?.usageMetadata?.output_tokens,totalTokens:t?.usageMetadata?.total_tokens}}}}(o.response,{usageMetadata:i});return await r?.handleLLMNewToken(l.generations[0].text??""),l}async *_streamResponseChunks(e,t,r){let i,n=gj(e,this._isMultimodalModel,this.useSystemInstruction),a=n;if("system"===n[0].role){let[e]=n;this.client.systemInstruction=e,a=n.slice(1)}let s={...this.invocationParams(t),contents:a},o=await this.caller.callWithOptions({signal:t?.signal},async()=>{let{stream:e}=await this.client.generateContentStream(s);return e}),l=0;for await(let e of o){if("usageMetadata"in e&&!1!==this.streamUsage&&!1!==t.streamUsage){let t=e.usageMetadata;if(i){let e=(t.candidatesTokenCount??0)-i.output_tokens;i={input_tokens:0,output_tokens:e,total_tokens:e}}else i={input_tokens:t.promptTokenCount??0,output_tokens:t.candidatesTokenCount??0,total_tokens:t.totalTokenCount??0}}let n=function(e,t){let r;if(!e.candidates||0===e.candidates.length)return null;let i=e.functionCalls(),[n]=e.candidates,{content:a,...s}=n;a?.parts&&a.parts.every(e=>"text"in e)?r=a.parts.map(e=>e.text).join(""):a.parts&&(r=a.parts.map(e=>"text"in e?{type:"text",text:e.text}:"executableCode"in e?{type:"executableCode",executableCode:e.executableCode}:"codeExecutionResult"in e?{type:"codeExecutionResult",codeExecutionResult:e.codeExecutionResult}:e));let o="";r&&"string"==typeof r?o=r:r&&"object"==typeof r&&"text"in r[0]&&(o=r[0].text);let l=[];return i&&l.push(...i.map(e=>({...e,args:JSON.stringify(e.args),index:t.index,type:"tool_call_chunk",id:"id"in e&&"string"==typeof e.id?e.id:gR()}))),new ol({text:o,message:new nX({content:r||"",name:a?a.role:void 0,tool_call_chunks:l,additional_kwargs:{},usage_metadata:t.usageMetadata}),generationInfo:s})}(e,{usageMetadata:i,index:l});l+=1,n&&(yield n,await r?.handleLLMNewToken(n.text??""))}}async completionWithRetry(e,t){return this.caller.callWithOptions({signal:t?.signal},async()=>{try{return await this.client.generateContent(e)}catch(e){throw e.message?.includes("400 Bad Request")&&(e.status=400),e}})}withStructuredOutput(e,t){let r,i,n=t?.name,a=t?.method,s=t?.includeRaw;if("jsonMode"===a)throw Error('ChatGoogleGenerativeAI only supports "jsonSchema" or "functionCalling" as a method.');if("functionCalling"===a){let t,a=n??"extract";if(hO(e)){let r=gE(e);t=[{functionDeclarations:[{name:a,description:r.description??"A function available to call.",parameters:r}]}],i=new gU({returnSingle:!0,keyName:a,zodSchema:e})}else{let r;"string"==typeof e.name&&"object"==typeof e.parameters&&null!=e.parameters?((r=e).parameters=gw(e.parameters),a=e.name):r={name:a,description:e.description??"",parameters:gw(e)},t=[{functionDeclarations:[r]}],i=new gU({returnSingle:!0,keyName:a})}r=this.bind({tools:t,tool_choice:a})}else{let t=gE(e);r=this.bind({responseSchema:t}),i=new mz}if(!s)return r.pipe(i).withConfig({runName:"ChatGoogleGenerativeAIStructuredOutput"});let o=mA.assign({parsed:(e,t)=>i.invoke(e.raw,t)}),l=mA.assign({parsed:()=>null}),u=o.withFallbacks({fallbacks:[l]});return fL.from([{raw:r},u]).withConfig({runName:"StructuredOutputRunnable"})}}iI({},{Embeddings:()=>gM});var gM=class{caller;constructor(e){this.caller=new fy(e??{})}};iI({},{chunkArray:()=>gz});let gz=(e,t)=>e.reduce((e,r,i)=>{let n=Math.floor(i/t),a=e[n]||[];return e[n]=a.concat([r]),e},[]);function gF(e,t,r,i,n){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r}function gB(e,t,r,i){if("a"===r&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)}let gZ=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return gZ=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^r()&15>>e/4).toString(16))};function gG(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let gH=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class gq extends Error{}class gW extends gq{constructor(e,t,r,i){super(`${gW.makeMessage(e,t,r)}`),this.status=e,this.headers=i,this.requestID=i?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,r){let i=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,r,i){if(!e||!i)return new gJ({message:r,cause:gH(t)});let n=t?.error;return 400===e?new gY(e,n,r,i):401===e?new gX(e,n,r,i):403===e?new gQ(e,n,r,i):404===e?new g0(e,n,r,i):409===e?new g1(e,n,r,i):422===e?new g4(e,n,r,i):429===e?new g2(e,n,r,i):e>=500?new g6(e,n,r,i):new gW(e,n,r,i)}}class gK extends gW{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class gJ extends gW{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class gV extends gJ{constructor({message:e}={}){super({message:e??"Request timed out."})}}class gY extends gW{}class gX extends gW{}class gQ extends gW{}class g0 extends gW{}class g1 extends gW{}class g4 extends gW{}class g2 extends gW{}class g6 extends gW{}class g9 extends gq{constructor(){super("Could not parse response content as the length limit was reached")}}class g3 extends gq{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class g5 extends Error{constructor(e){super(e)}}let g8=/^[a-z][a-z0-9+.-]*:/i,g7=e=>(g7=Array.isArray)(e),ye=g7;function yt(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let yr=e=>new Promise(t=>setTimeout(t,e)),yi="5.12.2",yn=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",ya=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function ys(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function yo(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return ys({start(){},async pull(e){let{done:r,value:i}=await t.next();r?e.close():e.enqueue(i)},async cancel(){await t.return?.()}})}function yl(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function yu(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),r=t.cancel();t.releaseLock(),await r}let yc=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),yd="RFC3986",yh=e=>String(e),yp={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:yh},yf=(e,t)=>(yf=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),ym=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function yg(e,t){if(g7(e)){let r=[];for(let i=0;i<e.length;i+=1)r.push(t(e[i]));return r}return t(e)}let yy={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},y_=function(e,t){Array.prototype.push.apply(e,g7(t)?t:[t])},yv={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,r,i,n)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===r)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let s="";for(let e=0;e<a.length;e+=1024){let t=a.length>=1024?a.slice(e,e+1024):a,r=[];for(let e=0;e<t.length;++e){let i=t.charCodeAt(e);if(45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122||"RFC1738"===n&&(40===i||41===i)){r[r.length]=t.charAt(e);continue}if(i<128){r[r.length]=ym[i];continue}if(i<2048){r[r.length]=ym[192|i>>6]+ym[128|63&i];continue}if(i<55296||i>=57344){r[r.length]=ym[224|i>>12]+ym[128|i>>6&63]+ym[128|63&i];continue}e+=1,i=65536+((1023&i)<<10|1023&t.charCodeAt(e)),r[r.length]=ym[240|i>>18]+ym[128|i>>12&63]+ym[128|i>>6&63]+ym[128|63&i]}s+=r.join("")}return s},encodeValuesOnly:!1,format:yd,formatter:yh,indices:!1,serializeDate:e=>(l??(l=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},yb={};function yw(e){let t;return(u??(u=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function yE(e){let t;return(c??(c=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class yT{constructor(){t_.set(this,void 0),tv.set(this,void 0),gF(this,t_,new Uint8Array,"f"),gF(this,tv,null,"f")}decode(e){let t;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?yw(e):e;gF(this,t_,function(e){let t=0;for(let r of e)t+=r.length;let r=new Uint8Array(t),i=0;for(let t of e)r.set(t,i),i+=t.length;return r}([gB(this,t_,"f"),r]),"f");let i=[];for(;null!=(t=function(e,t){for(let r=t??0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}(gB(this,t_,"f"),gB(this,tv,"f")));){if(t.carriage&&null==gB(this,tv,"f")){gF(this,tv,t.index,"f");continue}if(null!=gB(this,tv,"f")&&(t.index!==gB(this,tv,"f")+1||t.carriage)){i.push(yE(gB(this,t_,"f").subarray(0,gB(this,tv,"f")-1))),gF(this,t_,gB(this,t_,"f").subarray(gB(this,tv,"f")),"f"),gF(this,tv,null,"f");continue}let e=null!==gB(this,tv,"f")?t.preceding-1:t.preceding,r=yE(gB(this,t_,"f").subarray(0,e));i.push(r),gF(this,t_,gB(this,t_,"f").subarray(t.index),"f"),gF(this,tv,null,"f")}return i}flush(){return gB(this,t_,"f").length?this.decode("\n"):[]}}t_=new WeakMap,tv=new WeakMap,yT.NEWLINE_CHARS=new Set(["\n","\r"]),yT.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let yS={off:0,error:200,warn:300,info:400,debug:500},yI=(e,t,r)=>{if(e){if(Object.prototype.hasOwnProperty.call(yS,e))return e;y$(r).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(yS))}`)}};function yO(){}function yA(e,t,r){return!t||yS[e]>yS[r]?yO:t[e].bind(t)}let yk={error:yO,warn:yO,info:yO,debug:yO},yx=new WeakMap;function y$(e){let t=e.logger,r=e.logLevel??"off";if(!t)return yk;let i=yx.get(t);if(i&&i[0]===r)return i[1];let n={error:yA("error",t,r),warn:yA("warn",t,r),info:yA("info",t,r),debug:yA("debug",t,r)};return yx.set(t,[r,n]),n}let yC=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class yN{constructor(e,t,r){this.iterator=e,tb.set(this,void 0),this.controller=t,gF(this,tb,r,"f")}static fromSSEResponse(e,t,r){let i=!1,n=r?y$(r):console;async function*a(){if(i)throw new gq("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let r=!1;try{for await(let i of yP(e,t))if(!r){if(i.data.startsWith("[DONE]")){r=!0;continue}if(null!==i.event&&i.event.startsWith("thread.")){let e;try{e=JSON.parse(i.data)}catch(e){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),e}if("error"==i.event)throw new gW(void 0,e.error,e.message,void 0);yield{event:i.event,data:e}}else{let t;try{t=JSON.parse(i.data)}catch(e){throw n.error("Could not parse message into JSON:",i.data),n.error("From chunk:",i.raw),e}if(t&&t.error)throw new gW(void 0,t.error,void 0,e.headers);yield t}}r=!0}catch(e){if(gG(e))return;throw e}finally{r||t.abort()}}return new yN(a,t,r)}static fromReadableStream(e,t,r){let i=!1;async function*n(){let t=new yT;for await(let r of yl(e))for(let e of t.decode(r))yield e;for(let e of t.flush())yield e}return new yN(async function*(){if(i)throw new gq("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(gG(e))return;throw e}finally{e||t.abort()}},t,r)}[(tb=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),i=i=>({next:()=>{if(0===i.length){let i=r.next();e.push(i),t.push(i)}return i.shift()}});return[new yN(()=>i(e),this.controller,gB(this,tb,"f")),new yN(()=>i(t),this.controller,gB(this,tb,"f"))]}toReadableStream(){let e,t=this;return ys({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:r,done:i}=await e.next();if(i)return t.close();let n=yw(JSON.stringify(r)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*yP(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new gq("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new gq("Attempted to iterate over a response with no body")}let r=new yj,i=new yT;for await(let t of yR(yl(e.body)))for(let e of i.decode(t)){let t=r.decode(e);t&&(yield t)}for(let e of i.flush()){let t=r.decode(e);t&&(yield t)}}async function*yR(e){let t=new Uint8Array;for await(let r of e){let e;if(null==r)continue;let i=r instanceof ArrayBuffer?new Uint8Array(r):"string"==typeof r?yw(r):r,n=new Uint8Array(t.length+i.length);for(n.set(t),n.set(i,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class yj{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let r;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[i,n,a]=-1!==(r=(t=e).indexOf(":"))?[t.substring(0,r),":",t.substring(r+1)]:[t,"",""];return a.startsWith(" ")&&(a=a.substring(1)),"event"===i?this.event=a:"data"===i&&this.data.push(a),null}}async function yU(e,t){let{response:r,requestLogID:i,retryOfRequestLogID:n,startTime:a}=t,s=await (async()=>{if(t.options.stream)return(y$(e).debug("response",r.status,r.url,r.headers,r.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(r,t.controller,e):yN.fromSSEResponse(r,t.controller,e);if(204===r.status)return null;if(t.options.__binaryResponse)return r;let i=r.headers.get("content-type"),n=i?.split(";")[0]?.trim();return n?.includes("application/json")||n?.endsWith("+json")?yL(await r.json(),r):await r.text()})();return y$(e).debug(`[${i}] response parsed`,yC({retryOfRequestLogID:n,url:r.url,status:r.status,body:s,durationMs:Date.now()-a})),s}function yL(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class yD extends Promise{constructor(e,t,r=yU){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=r,tw.set(this,void 0),gF(this,tw,e,"f")}_thenUnwrap(e){return new yD(gB(this,tw,"f"),this.responsePromise,async(t,r)=>yL(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(gB(this,tw,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}tw=new WeakMap;class yM{constructor(e,t,r,i){tE.set(this,void 0),gF(this,tE,e,"f"),this.options=i,this.response=t,this.body=r}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new gq("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await gB(this,tE,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(tE=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class yz extends yD{constructor(e,t,r){super(e,t,async(e,t)=>new r(e,t.response,await yU(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class yF extends yM{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class yB extends yM{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){var e;let t=this.getPaginatedItems(),r=t[t.length-1]?.id;return r?{...this.options,query:{..."object"!=typeof(e=this.options.query)?{}:e??{},after:r}}:null}}let yZ=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function yG(e,t,r){return yZ(),new File(e,t??"unknown_file",r)}function yH(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let yq=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],yW=async(e,t)=>({...e,body:await yJ(e.body,t)}),yK=new WeakMap,yJ=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,r=yK.get(t);if(r)return r;let i=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,r=new FormData;if(r.toString()===await new e(r).text())return!1;return!0}catch{return!0}})();return yK.set(t,i),i}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let r=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>yX(r,e,t))),r},yV=e=>e instanceof Blob&&"name"in e,yY=e=>{if("object"==typeof e&&null!==e&&(e instanceof Response||yq(e)||yV(e)))return!0;if(Array.isArray(e))return e.some(yY);if(e&&"object"==typeof e){for(let t in e)if(yY(e[t]))return!0}return!1},yX=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(r instanceof Response)e.append(t,yG([await r.blob()],yH(r)));else if(yq(r))e.append(t,yG([await new Response(yo(r)).blob()],yH(r)));else if(yV(r))e.append(t,r,yH(r));else if(Array.isArray(r))await Promise.all(r.map(r=>yX(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,i])=>yX(e,`${t}[${r}]`,i)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}},yQ=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function y0(e,t,r){let i,n;if(yZ(),null!=(i=e=await e)&&"object"==typeof i&&"string"==typeof i.name&&"number"==typeof i.lastModified&&yQ(i))return e instanceof File?e:yG([await e.arrayBuffer()],e.name);if(null!=(n=e)&&"object"==typeof n&&"string"==typeof n.url&&"function"==typeof n.blob){let i=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),yG(await y1(i),t,r)}let a=await y1(e);if(t||(t=yH(e)),!r?.type){let e=a.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(r={...r,type:e})}return yG(a,t,r)}async function y1(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(yQ(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(yq(e))for await(let r of e)t.push(...await y1(r));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class y4{constructor(e){this._client=e}}function y2(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let y6=Object.freeze(Object.create(null)),y9=((e=y2)=>function(t,...r){let i;if(1===t.length)return t[0];let n=!1,a=[],s=t.reduce((t,i,s)=>{/[?#]/.test(i)&&(n=!0);let o=r[s],l=(n?encodeURIComponent:e)(""+o);return s!==r.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??y6)??y6)?.toString)&&(l=o+"",a.push({start:t.length+i.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+i+(s===r.length?"":l)},""),o=s.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(i=l.exec(o));)a.push({start:i.index,length:i[0].length,error:`Value "${i[0]}" can't be safely passed as a path parameter`});if(a.sort((e,t)=>e.start-t.start),a.length>0){let e=0,t=a.reduce((t,r)=>{let i=" ".repeat(r.start-e),n="^".repeat(r.length);return e=r.start+r.length,t+i+n},"");throw new gq(`Path parameters result in path with invalid segments:
${a.map(e=>e.error).join("\n")}
${s}
${t}`)}return s})(y2);class y3 extends y4{list(e,t={},r){return this._client.getAPIList(y9`/chat/completions/${e}/messages`,yB,{query:t,...r})}}function y5(e){return void 0!==e&&"function"in e&&void 0!==e.function}function y8(e){return e?.$brand==="auto-parseable-response-format"}function y7(e){return e?.$brand==="auto-parseable-tool"}function _e(e,t){let r=e.choices.map(e=>{var r,i;if("length"===e.finish_reason)throw new g9;if("content_filter"===e.finish_reason)throw new g3;return _r(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>{var r,i;let n;return r=t,i=e,n=r.tools?.find(e=>y5(e)&&e.function?.name===i.function.name),{...i,function:{...i.function,parsed_arguments:y7(n)?n.$parseRaw(i.function.arguments):n?.function.strict?JSON.parse(i.function.arguments):null}}})??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(r=t,i=e.message.content,r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(i):JSON.parse(i):null):null}}});return{...e,choices:r}}function _t(e){return!!y8(e.response_format)||(e.tools?.some(e=>y7(e)||"function"===e.type&&!0===e.function.strict)??!1)}function _r(e){for(let t of e||[])if("function"!==t.type)throw new gq(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let _i=e=>e?.role==="assistant",_n=e=>e?.role==="tool";class _a{constructor(){tT.add(this),this.controller=new AbortController,tS.set(this,void 0),tI.set(this,()=>{}),tO.set(this,()=>{}),tA.set(this,void 0),tk.set(this,()=>{}),tx.set(this,()=>{}),t$.set(this,{}),tC.set(this,!1),tN.set(this,!1),tP.set(this,!1),tR.set(this,!1),gF(this,tS,new Promise((e,t)=>{gF(this,tI,e,"f"),gF(this,tO,t,"f")}),"f"),gF(this,tA,new Promise((e,t)=>{gF(this,tk,e,"f"),gF(this,tx,t,"f")}),"f"),gB(this,tS,"f").catch(()=>{}),gB(this,tA,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},gB(this,tT,"m",tj).bind(this))},0)}_connected(){this.ended||(gB(this,tI,"f").call(this),this._emit("connect"))}get ended(){return gB(this,tC,"f")}get errored(){return gB(this,tN,"f")}get aborted(){return gB(this,tP,"f")}abort(){this.controller.abort()}on(e,t){return(gB(this,t$,"f")[e]||(gB(this,t$,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=gB(this,t$,"f")[e];if(!r)return this;let i=r.findIndex(e=>e.listener===t);return i>=0&&r.splice(i,1),this}once(e,t){return(gB(this,t$,"f")[e]||(gB(this,t$,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{gF(this,tR,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)})}async done(){gF(this,tR,!0,"f"),await gB(this,tA,"f")}_emit(e,...t){if(gB(this,tC,"f"))return;"end"===e&&(gF(this,tC,!0,"f"),gB(this,tk,"f").call(this));let r=gB(this,t$,"f")[e];if(r&&(gB(this,t$,"f")[e]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];gB(this,tR,"f")||r?.length||Promise.reject(e),gB(this,tO,"f").call(this,e),gB(this,tx,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];gB(this,tR,"f")||r?.length||Promise.reject(e),gB(this,tO,"f").call(this,e),gB(this,tx,"f").call(this,e),this._emit("end")}}_emitFinal(){}}tS=new WeakMap,tI=new WeakMap,tO=new WeakMap,tA=new WeakMap,tk=new WeakMap,tx=new WeakMap,t$=new WeakMap,tC=new WeakMap,tN=new WeakMap,tP=new WeakMap,tR=new WeakMap,tT=new WeakSet,tj=function(e){if(gF(this,tN,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new gK),e instanceof gK)return gF(this,tP,!0,"f"),this._emit("abort",e);if(e instanceof gq)return this._emit("error",e);if(e instanceof Error){let t=new gq(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new gq(String(e)))};class _s extends _a{constructor(){super(...arguments),tU.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),_n(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(_i(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new gq("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),gB(this,tU,"m",tL).call(this)}async finalMessage(){return await this.done(),gB(this,tU,"m",tD).call(this)}async finalFunctionToolCall(){return await this.done(),gB(this,tU,"m",tM).call(this)}async finalFunctionToolCallResult(){return await this.done(),gB(this,tU,"m",tz).call(this)}async totalUsage(){return await this.done(),gB(this,tU,"m",tF).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=gB(this,tU,"m",tD).call(this);t&&this._emit("finalMessage",t);let r=gB(this,tU,"m",tL).call(this);r&&this._emit("finalContent",r);let i=gB(this,tU,"m",tM).call(this);i&&this._emit("finalFunctionToolCall",i);let n=gB(this,tU,"m",tz).call(this);null!=n&&this._emit("finalFunctionToolCallResult",n),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",gB(this,tU,"m",tF).call(this))}async _createChatCompletion(e,t,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),gB(this,tU,"m",tB).call(this,t);let n=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(_e(n,t))}async _runChatCompletion(e,t,r){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){let i="tool",{tool_choice:n="auto",stream:a,...s}=t,o="string"!=typeof n&&"function"===n.type&&n?.function?.name,{maxChatCompletions:l=10}=r||{},u=t.tools.map(e=>{if(y7(e)){if(!e.$callback)throw new gq("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),c={};for(let e of u)"function"===e.type&&(c[e.function.name||e.function.function.name]=e.function);let d="tools"in t?u.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...s,tool_choice:n,tools:d,messages:[...this.messages]},r),a=t.choices[0]?.message;if(!a)throw new gq("missing message in ChatCompletion response");if(!a.tool_calls?.length)break;for(let e of a.tool_calls){let t;if("function"!==e.type)continue;let r=e.id,{name:n,arguments:a}=e.function,s=c[n];if(s){if(o&&o!==n){let e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:i,tool_call_id:r,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(c).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:r,content:e});continue}try{t="function"==typeof s.parse?await s.parse(a):a}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:i,tool_call_id:r,content:e});continue}let l=await s.function(t,this),u=gB(this,tU,"m",tZ).call(this,l);if(this._addMessage({role:i,tool_call_id:r,content:u}),o)return}}}}tU=new WeakSet,tL=function(){return gB(this,tU,"m",tD).call(this).content??null},tD=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(_i(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new gq("stream ended without producing a ChatCompletionMessage with role=assistant")},tM=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(_i(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},tz=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(_n(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},tF=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},tB=function(e){if(null!=e.n&&e.n>1)throw new gq("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},tZ=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class _o extends _s{static runTools(e,t,r){let i=new _o,n={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,n)),i}_addMessage(e,t=!0){super._addMessage(e,t),_i(e)&&e.content&&this._emit("content",e.content)}}let _l=511;class _u extends Error{}class _c extends Error{}let _d=e=>(function(e,t=_l){var r,i;let n,a,s,o,l,u,c,d,h,p;if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return r=e.trim(),i=t,n=r.length,a=0,s=e=>{throw new _u(`${e} at position ${a}`)},o=e=>{throw new _c(`${e} at position ${a}`)},l=()=>(p(),a>=n&&s("Unexpected end of input"),'"'===r[a])?u():"{"===r[a]?c():"["===r[a]?d():"null"===r.substring(a,a+4)||16&i&&n-a<4&&"null".startsWith(r.substring(a))?(a+=4,null):"true"===r.substring(a,a+4)||32&i&&n-a<4&&"true".startsWith(r.substring(a))?(a+=4,!0):"false"===r.substring(a,a+5)||32&i&&n-a<5&&"false".startsWith(r.substring(a))?(a+=5,!1):"Infinity"===r.substring(a,a+8)||128&i&&n-a<8&&"Infinity".startsWith(r.substring(a))?(a+=8,1/0):"-Infinity"===r.substring(a,a+9)||256&i&&1<n-a&&n-a<9&&"-Infinity".startsWith(r.substring(a))?(a+=9,-1/0):"NaN"===r.substring(a,a+3)||64&i&&n-a<3&&"NaN".startsWith(r.substring(a))?(a+=3,NaN):h(),u=()=>{let e=a,t=!1;for(a++;a<n&&('"'!==r[a]||t&&"\\"===r[a-1]);)t="\\"===r[a]&&!t,a++;if('"'==r.charAt(a))try{return JSON.parse(r.substring(e,++a-Number(t)))}catch(e){o(String(e))}else if(1&i)try{return JSON.parse(r.substring(e,a-Number(t))+'"')}catch(t){return JSON.parse(r.substring(e,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{a++,p();let e={};try{for(;"}"!==r[a];){if(p(),a>=n&&8&i)return e;let t=u();p(),a++;try{let r=l();Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}catch(t){if(8&i)return e;throw t}p(),","===r[a]&&a++}}catch(t){if(8&i)return e;s("Expected '}' at end of object")}return a++,e},d=()=>{a++;let e=[];try{for(;"]"!==r[a];)e.push(l()),p(),","===r[a]&&a++}catch(t){if(4&i)return e;s("Expected ']' at end of array")}return a++,e},h=()=>{if(0===a){"-"===r&&2&i&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(e){if(2&i)try{if("."===r[r.length-1])return JSON.parse(r.substring(0,r.lastIndexOf(".")));return JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch(e){}o(String(e))}}let e=a;for("-"===r[a]&&a++;r[a]&&!",]}".includes(r[a]);)a++;a!=n||2&i||s("Unterminated number literal");try{return JSON.parse(r.substring(e,a))}catch(t){"-"===r.substring(e,a)&&2&i&&s("Not sure what '-' is");try{return JSON.parse(r.substring(e,r.lastIndexOf("e")))}catch(e){o(String(e))}}},p=()=>{for(;a<n&&" \n\r	".includes(r[a]);)a++},l()})(e,2^_l);class _h extends _s{constructor(e){super(),tG.add(this),tH.set(this,void 0),tq.set(this,void 0),tW.set(this,void 0),gF(this,tH,e,"f"),gF(this,tq,[],"f")}get currentChatCompletionSnapshot(){return gB(this,tW,"f")}static fromReadableStream(e){let t=new _h(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let i=new _h(t);return i._run(()=>i._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,t,r){super._createChatCompletion;let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),gB(this,tG,"m",tK).call(this);let n=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});for await(let e of(this._connected(),n))gB(this,tG,"m",tV).call(this,e);if(n.controller.signal?.aborted)throw new gK;return this._addChatCompletion(gB(this,tG,"m",tQ).call(this))}async _fromReadableStream(e,t){let r,i=t?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),gB(this,tG,"m",tK).call(this),this._connected();let n=yN.fromReadableStream(e,this.controller);for await(let e of n)r&&r!==e.id&&this._addChatCompletion(gB(this,tG,"m",tQ).call(this)),gB(this,tG,"m",tV).call(this,e),r=e.id;if(n.controller.signal?.aborted)throw new gK;return this._addChatCompletion(gB(this,tG,"m",tQ).call(this))}[(tH=new WeakMap,tq=new WeakMap,tW=new WeakMap,tG=new WeakSet,tK=function(){this.ended||gF(this,tW,void 0,"f")},tJ=function(e){let t=gB(this,tq,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},gB(this,tq,"f")[e.index]=t),t},tV=function(e){if(this.ended)return;let t=gB(this,tG,"m",t1).call(this,e);for(let r of(this._emit("chunk",e,t),e.choices)){let e=t.choices[r.index];null!=r.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",r.delta.content,e.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=r.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:e.message.refusal}),r.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:e.logprobs?.content??[]}),r.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let i=gB(this,tG,"m",tJ).call(this,e);for(let t of(e.finish_reason&&(gB(this,tG,"m",tX).call(this,e),null!=i.current_tool_call_index&&gB(this,tG,"m",tY).call(this,e,i.current_tool_call_index)),r.delta.tool_calls??[]))i.current_tool_call_index!==t.index&&(gB(this,tG,"m",tX).call(this,e),null!=i.current_tool_call_index&&gB(this,tG,"m",tY).call(this,e,i.current_tool_call_index)),i.current_tool_call_index=t.index;for(let t of r.delta.tool_calls??[]){let r=e.message.tool_calls?.[t.index];r?.type&&(r?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:r.function?.name,index:t.index,arguments:r.function.arguments,parsed_arguments:r.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):_m(r?.type))}}},tY=function(e,t){if(gB(this,tG,"m",tJ).call(this,e).done_tool_calls.has(t))return;let r=e.message.tool_calls?.[t];if(!r)throw Error("no tool call snapshot");if(!r.type)throw Error("tool call snapshot missing `type`");if("function"===r.type){let e=gB(this,tH,"f")?.tools?.find(e=>y5(e)&&e.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:t,arguments:r.function.arguments,parsed_arguments:y7(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else _m(r.type)},tX=function(e){let t=gB(this,tG,"m",tJ).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let r=gB(this,tG,"m",t0).call(this);this._emit("content.done",{content:e.message.content,parsed:r?r.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},tQ=function(){if(this.ended)throw new gq("stream has ended, this shouldn't happen");let e=gB(this,tW,"f");if(!e)throw new gq("request ended without sending any chunks");return gF(this,tW,void 0,"f"),gF(this,tq,[],"f"),function(e,t){var r;let{id:i,choices:n,created:a,model:s,system_fingerprint:o,...l}=e;return r={...l,id:i,choices:n.map(({message:t,finish_reason:r,index:i,logprobs:n,...a})=>{if(!r)throw new gq(`missing finish_reason for choice ${i}`);let{content:s=null,function_call:o,tool_calls:l,...u}=t,c=t.role;if(!c)throw new gq(`missing role for choice ${i}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new gq(`missing function_call.arguments for choice ${i}`);if(!l)throw new gq(`missing function_call.name for choice ${i}`);return{...a,message:{content:s,function_call:{arguments:e,name:l},role:c,refusal:t.refusal??null},finish_reason:r,index:i,logprobs:n}}return l?{...a,index:i,finish_reason:r,logprobs:n,message:{...u,role:c,content:s,refusal:t.refusal??null,tool_calls:l.map((t,r)=>{let{function:n,type:a,id:s,...o}=t,{arguments:l,name:u,...c}=n||{};if(null==s)throw new gq(`missing choices[${i}].tool_calls[${r}].id
${_p(e)}`);if(null==a)throw new gq(`missing choices[${i}].tool_calls[${r}].type
${_p(e)}`);if(null==u)throw new gq(`missing choices[${i}].tool_calls[${r}].function.name
${_p(e)}`);if(null==l)throw new gq(`missing choices[${i}].tool_calls[${r}].function.arguments
${_p(e)}`);return{...o,id:s,type:a,function:{...c,name:u,arguments:l}}})}}:{...a,message:{...u,content:s,role:c,refusal:t.refusal??null},finish_reason:r,index:i,logprobs:n}}),created:a,model:s,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&_t(t)?_e(r,t):{...r,choices:r.choices.map(e=>(_r(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,gB(this,tH,"f"))},t0=function(){let e=gB(this,tH,"f")?.response_format;return y8(e)?e:null},t1=function(e){var t,r,i,n;let a=gB(this,tW,"f"),{choices:s,...o}=e;for(let{delta:s,finish_reason:l,index:u,logprobs:c=null,...d}of(a?Object.assign(a,o):a=gF(this,tW,{...o,choices:[]},"f"),e.choices)){let e=a.choices[u];if(e||(e=a.choices[u]={finish_reason:l,index:u,message:{},logprobs:c,...d}),c)if(e.logprobs){let{content:i,refusal:n,...a}=c;_f(a),Object.assign(e.logprobs,a),i&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...i)),n&&((r=e.logprobs).refusal??(r.refusal=[]),e.logprobs.refusal.push(...n))}else e.logprobs=Object.assign({},c);if(l&&(e.finish_reason=l,gB(this,tH,"f")&&_t(gB(this,tH,"f")))){if("length"===l)throw new g9;if("content_filter"===l)throw new g3}if(Object.assign(e,d),!s)continue;let{content:o,refusal:h,function_call:p,role:f,tool_calls:m,...g}=s;if(_f(g),Object.assign(e.message,g),h&&(e.message.refusal=(e.message.refusal||"")+h),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((i=e.message.function_call).arguments??(i.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&gB(this,tG,"m",t0).call(this)&&(e.message.parsed=_d(e.message.content))),m)for(let{index:t,id:r,type:i,function:a,...s}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(n=e.message.tool_calls)[t]??(n[t]={});Object.assign(o,s),r&&(o.id=r),i&&(o.type=i),a&&(o.function??(o.function={name:a.name??"",arguments:""})),a?.name&&(o.function.name=a.name),a?.arguments&&(o.function.arguments+=a.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let r=e.tools?.find(e=>y5(e)&&e.function?.name===t.function.name);return y5(r)&&(y7(r)||r?.function.strict||!1)}(gB(this,tH,"f"),o)&&(o.function.parsed_arguments=_d(o.function.arguments)))}}return a},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",r=>{let i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),this.on("error",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new yN(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function _p(e){return JSON.stringify(e)}function _f(e){}function _m(e){}class _g extends _h{static fromReadableStream(e){let t=new _g(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){let i=new _g(t),n={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,n)),i}}class _y extends y4{constructor(){super(...arguments),this.messages=new y3(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(y9`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(y9`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",yB,{query:e,...t})}delete(e,t){return this._client.delete(y9`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new gq(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new gq(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>_e(t,e))}runTools(e,t){return e.stream?_g.runTools(this._client,e,t):_o.runTools(this._client,e,t)}stream(e,t){return _h.createChatCompletion(this._client,e,t)}}_y.Messages=y3;class __ extends y4{constructor(){super(...arguments),this.completions=new _y(this._client)}}__.Completions=_y,e.s([],110219);let _v=Symbol("brand.privateNullableHeaders"),_b=e=>{let t=new Headers,r=new Set;for(let i of e){let e=new Set;for(let[n,a]of function*(e){let t;if(!e)return;if(_v in e){let{values:t,nulls:r}=e;for(let e of(yield*t.entries(),r))yield[e,null];return}let r=!1;for(let i of(e instanceof Headers?t=e.entries():ye(e)?t=e:(r=!0,t=Object.entries(e??{})),t)){let e=i[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=ye(i[1])?i[1]:[i[1]],n=!1;for(let i of t)void 0!==i&&(r&&!n&&(n=!0,yield[e,null]),yield[e,i])}}(i)){let i=n.toLowerCase();e.has(i)||(t.delete(n),e.add(i)),null===a?(t.delete(n),r.add(i)):(t.append(n,a),r.delete(i))}}return{[_v]:!0,values:t,nulls:r}};class _w extends y4{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:_b([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class _E extends y4{create(e,t){return this._client.post("/audio/transcriptions",yW({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class _T extends y4{create(e,t){return this._client.post("/audio/translations",yW({body:e,...t,__metadata:{model:e.model}},this._client))}}class _S extends y4{constructor(){super(...arguments),this.transcriptions=new _E(this._client),this.translations=new _T(this._client),this.speech=new _w(this._client)}}_S.Transcriptions=_E,_S.Translations=_T,_S.Speech=_w;class _I extends y4{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(y9`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",yB,{query:e,...t})}cancel(e,t){return this._client.post(y9`/batches/${e}/cancel`,t)}}class _O extends y4{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(y9`/assistants/${e}`,{...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(y9`/assistants/${e}`,{body:t,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",yB,{query:e,...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(y9`/assistants/${e}`,{...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class _A extends y4{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class _k extends y4{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class _x extends y4{constructor(){super(...arguments),this.sessions=new _A(this._client),this.transcriptionSessions=new _k(this._client)}}_x.Sessions=_A,_x.TranscriptionSessions=_k;class _$ extends y4{create(e,t,r){return this._client.post(y9`/threads/${e}/messages`,{body:t,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{thread_id:i}=t;return this._client.get(y9`/threads/${i}/messages/${e}`,{...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:i,...n}=t;return this._client.post(y9`/threads/${i}/messages/${e}`,{body:n,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(y9`/threads/${e}/messages`,yB,{query:t,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{thread_id:i}=t;return this._client.delete(y9`/threads/${i}/messages/${e}`,{...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class _C extends y4{retrieve(e,t,r){let{thread_id:i,run_id:n,...a}=t;return this._client.get(y9`/threads/${i}/runs/${n}/steps/${e}`,{query:a,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t,r){let{thread_id:i,...n}=t;return this._client.getAPIList(y9`/threads/${i}/runs/${e}/steps`,yB,{query:n,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}let _N=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class _P extends _a{constructor(){super(...arguments),t4.add(this),t6.set(this,[]),t9.set(this,{}),t3.set(this,{}),t5.set(this,void 0),t8.set(this,void 0),t7.set(this,void 0),re.set(this,void 0),rt.set(this,void 0),rr.set(this,void 0),ri.set(this,void 0),rn.set(this,void 0),ra.set(this,void 0)}[(t6=new WeakMap,t9=new WeakMap,t3=new WeakMap,t5=new WeakMap,t8=new WeakMap,t7=new WeakMap,re=new WeakMap,rt=new WeakMap,rr=new WeakMap,ri=new WeakMap,rn=new WeakMap,ra=new WeakMap,t4=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),this.on("error",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new t2;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let i=yN.fromReadableStream(e,this.controller);for await(let e of i)gB(this,t4,"m",rs).call(this,e);if(i.controller.signal?.aborted)throw new gK;return this._addRun(gB(this,t4,"m",ro).call(this))}toReadableStream(){return new yN(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,i){let n=new t2;return n._run(()=>n._runToolAssistantStream(e,t,r,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createToolAssistantStream(e,t,r,i){let n=i?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},s=await e.submitToolOutputs(t,a,{...i,signal:this.controller.signal});for await(let e of(this._connected(),s))gB(this,t4,"m",rs).call(this,e);if(s.controller.signal?.aborted)throw new gK;return this._addRun(gB(this,t4,"m",ro).call(this))}static createThreadAssistantStream(e,t,r){let i=new t2;return i._run(()=>i._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,t,r,i){let n=new t2;return n._run(()=>n._runAssistantStream(e,t,r,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),n}currentEvent(){return gB(this,ri,"f")}currentRun(){return gB(this,rn,"f")}currentMessageSnapshot(){return gB(this,t5,"f")}currentRunStepSnapshot(){return gB(this,ra,"f")}async finalRunSteps(){return await this.done(),Object.values(gB(this,t9,"f"))}async finalMessages(){return await this.done(),Object.values(gB(this,t3,"f"))}async finalRun(){if(await this.done(),!gB(this,t8,"f"))throw Error("Final run was not received.");return gB(this,t8,"f")}async _createThreadAssistantStream(e,t,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let n={...t,stream:!0},a=await e.createAndRun(n,{...r,signal:this.controller.signal});for await(let e of(this._connected(),a))gB(this,t4,"m",rs).call(this,e);if(a.controller.signal?.aborted)throw new gK;return this._addRun(gB(this,t4,"m",ro).call(this))}async _createAssistantStream(e,t,r,i){let n=i?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},s=await e.create(t,a,{...i,signal:this.controller.signal});for await(let e of(this._connected(),s))gB(this,t4,"m",rs).call(this,e);if(s.controller.signal?.aborted)throw new gK;return this._addRun(gB(this,t4,"m",ro).call(this))}static accumulateDelta(e,t){for(let[r,i]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=i;continue}let t=e[r];if(null==t||"index"===r||"type"===r){e[r]=i;continue}if("string"==typeof t&&"string"==typeof i)t+=i;else if("number"==typeof t&&"number"==typeof i)t+=i;else if(yt(t)&&yt(i))t=this.accumulateDelta(t,i);else if(Array.isArray(t)&&Array.isArray(i)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...i);continue}for(let e of i){if(!yt(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let r=e.index;if(null==r)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof r)throw Error(`Expected array delta entry \`index\` property to be a number but got ${r}`);let i=t[r];null==i?t.push(e):t[r]=this.accumulateDelta(i,e)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${i}, accValue: ${t}`);e[r]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,i){return await this._createAssistantStream(t,e,r,i)}async _runToolAssistantStream(e,t,r,i){return await this._createToolAssistantStream(t,e,r,i)}}t2=_P,rs=function(e){if(!this.ended)switch(gF(this,ri,e,"f"),gB(this,t4,"m",rc).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":gB(this,t4,"m",rf).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":gB(this,t4,"m",ru).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":gB(this,t4,"m",rl).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},ro=function(){if(this.ended)throw new gq("stream has ended, this shouldn't happen");if(!gB(this,t8,"f"))throw Error("Final run has not been received");return gB(this,t8,"f")},rl=function(e){let[t,r]=gB(this,t4,"m",rh).call(this,e,gB(this,t5,"f"));for(let e of(gF(this,t5,t,"f"),gB(this,t3,"f")[t.id]=t,r)){let r=t.content[e.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let r of e.data.delta.content){if("text"==r.type&&r.text){let e=r.text,i=t.content[r.index];if(i&&"text"==i.type)this._emit("textDelta",e,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=gB(this,t7,"f")){if(gB(this,re,"f"))switch(gB(this,re,"f").type){case"text":this._emit("textDone",gB(this,re,"f").text,gB(this,t5,"f"));break;case"image_file":this._emit("imageFileDone",gB(this,re,"f").image_file,gB(this,t5,"f"))}gF(this,t7,r.index,"f")}gF(this,re,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==gB(this,t7,"f")){let t=e.data.content[gB(this,t7,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,gB(this,t5,"f"));break;case"text":this._emit("textDone",t.text,gB(this,t5,"f"))}}gB(this,t5,"f")&&this._emit("messageDone",e.data),gF(this,t5,void 0,"f")}},ru=function(e){let t=gB(this,t4,"m",rd).call(this,e);switch(gF(this,ra,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&"tool_calls"==r.step_details.type&&r.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of r.step_details.tool_calls)e.index==gB(this,rt,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(gB(this,rr,"f")&&this._emit("toolCallDone",gB(this,rr,"f")),gF(this,rt,e.index,"f"),gF(this,rr,t.step_details.tool_calls[e.index],"f"),gB(this,rr,"f")&&this._emit("toolCallCreated",gB(this,rr,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":gF(this,ra,void 0,"f"),"tool_calls"==e.data.step_details.type&&gB(this,rr,"f")&&(this._emit("toolCallDone",gB(this,rr,"f")),gF(this,rr,void 0,"f")),this._emit("runStepDone",e.data,t)}},rc=function(e){gB(this,t6,"f").push(e),this._emit("event",e)},rd=function(e){switch(e.event){case"thread.run.step.created":return gB(this,t9,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=gB(this,t9,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let i=t2.accumulateDelta(t,r.delta);gB(this,t9,"f")[e.data.id]=i}return gB(this,t9,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":gB(this,t9,"f")[e.data.id]=e.data}if(gB(this,t9,"f")[e.data.id])return gB(this,t9,"f")[e.data.id];throw Error("No snapshot available")},rh=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(let e of i.delta.content)if(e.index in t.content){let r=t.content[e.index];t.content[e.index]=gB(this,t4,"m",rp).call(this,e,r)}else t.content[e.index]=e,r.push(e);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},rp=function(e,t){return t2.accumulateDelta(t,e)},rf=function(e){switch(gF(this,rn,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":gF(this,t8,e.data,"f"),gB(this,rr,"f")&&(this._emit("toolCallDone",gB(this,rr,"f")),gF(this,rr,void 0,"f"))}};class _R extends y4{constructor(){super(...arguments),this.steps=new _C(this._client)}create(e,t,r){let{include:i,...n}=t;return this._client.post(y9`/threads/${e}/runs`,{query:{include:i},body:n,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}retrieve(e,t,r){let{thread_id:i}=t;return this._client.get(y9`/threads/${i}/runs/${e}`,{...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:i,...n}=t;return this._client.post(y9`/threads/${i}/runs/${e}`,{body:n,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(y9`/threads/${e}/runs`,yB,{query:t,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{thread_id:i}=t;return this._client.post(y9`/threads/${i}/runs/${e}/cancel`,{...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let i=await this.create(e,t,r);return await this.poll(i.id,{thread_id:e},r)}createAndStream(e,t,r){return _P.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let i=_b([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:a}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...i}}).withResponse();switch(n.status){case"queued":case"in_progress":case"cancelling":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await yr(s);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return n}}}stream(e,t,r){return _P.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){let{thread_id:i,...n}=t;return this._client.post(y9`/threads/${i}/runs/${e}/submit_tool_outputs`,{body:n,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){let i=await this.submitToolOutputs(e,t,r);return await this.poll(i.id,t,r)}submitToolOutputsStream(e,t,r){return _P.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}}_R.Steps=_C;class _j extends y4{constructor(){super(...arguments),this.runs=new _R(this._client),this.messages=new _$(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(y9`/threads/${e}`,{...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(y9`/threads/${e}`,{body:t,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t){return this._client.delete(y9`/threads/${e}`,{...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return _P.createThreadAssistantStream(e,this._client.beta.threads,t)}}_j.Runs=_R,_j.Messages=_$;class _U extends y4{constructor(){super(...arguments),this.realtime=new _x(this._client),this.assistants=new _O(this._client),this.threads=new _j(this._client)}}_U.Realtime=_x,_U.Assistants=_O,_U.Threads=_j;class _L extends y4{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class _D extends y4{retrieve(e,t,r){let{container_id:i}=t;return this._client.get(y9`/containers/${i}/files/${e}/content`,{...r,headers:_b([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}}class _M extends y4{constructor(){super(...arguments),this.content=new _D(this._client)}create(e,t,r){return this._client.post(y9`/containers/${e}/files`,yW({body:t,...r},this._client))}retrieve(e,t,r){let{container_id:i}=t;return this._client.get(y9`/containers/${i}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(y9`/containers/${e}/files`,yB,{query:t,...r})}delete(e,t,r){let{container_id:i}=t;return this._client.delete(y9`/containers/${i}/files/${e}`,{...r,headers:_b([{Accept:"*/*"},r?.headers])})}}_M.Content=_D;class _z extends y4{constructor(){super(...arguments),this.files=new _M(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(y9`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",yB,{query:e,...t})}delete(e,t){return this._client.delete(y9`/containers/${e}`,{...t,headers:_b([{Accept:"*/*"},t?.headers])})}}_z.Files=_M;class _F extends y4{create(e,t){let r=!!e.encoding_format,i=r?e.encoding_format:"base64";r&&y$(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let n=this._client.post("/embeddings",{body:{...e,encoding_format:i},...t});return r?n:(y$(this._client).debug("embeddings/decoding base64 embeddings from base64"),n._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),r=t.length,i=new Uint8Array(r);for(let e=0;e<r;e++)i[e]=t.charCodeAt(e);return Array.from(new Float32Array(i.buffer))}})(t)}),e)))}}class _B extends y4{retrieve(e,t,r){let{eval_id:i,run_id:n}=t;return this._client.get(y9`/evals/${i}/runs/${n}/output_items/${e}`,r)}list(e,t,r){let{eval_id:i,...n}=t;return this._client.getAPIList(y9`/evals/${i}/runs/${e}/output_items`,yB,{query:n,...r})}}class _Z extends y4{constructor(){super(...arguments),this.outputItems=new _B(this._client)}create(e,t,r){return this._client.post(y9`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){let{eval_id:i}=t;return this._client.get(y9`/evals/${i}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(y9`/evals/${e}/runs`,yB,{query:t,...r})}delete(e,t,r){let{eval_id:i}=t;return this._client.delete(y9`/evals/${i}/runs/${e}`,r)}cancel(e,t,r){let{eval_id:i}=t;return this._client.post(y9`/evals/${i}/runs/${e}`,r)}}_Z.OutputItems=_B;class _G extends y4{constructor(){super(...arguments),this.runs=new _Z(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(y9`/evals/${e}`,t)}update(e,t,r){return this._client.post(y9`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",yB,{query:e,...t})}delete(e,t){return this._client.delete(y9`/evals/${e}`,t)}}_G.Runs=_Z;class _H extends y4{create(e,t){return this._client.post("/files",yW({body:e,...t},this._client))}retrieve(e,t){return this._client.get(y9`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",yB,{query:e,...t})}delete(e,t){return this._client.delete(y9`/files/${e}`,t)}content(e,t){return this._client.get(y9`/files/${e}/content`,{...t,headers:_b([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){let i=new Set(["processed","error","deleted"]),n=Date.now(),a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await yr(t),a=await this.retrieve(e),Date.now()-n>r)throw new gV({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class _q extends y4{}class _W extends y4{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class _K extends y4{constructor(){super(...arguments),this.graders=new _W(this._client)}}_K.Graders=_W;class _J extends y4{create(e,t,r){return this._client.getAPIList(y9`/fine_tuning/checkpoints/${e}/permissions`,yF,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(y9`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){let{fine_tuned_model_checkpoint:i}=t;return this._client.delete(y9`/fine_tuning/checkpoints/${i}/permissions/${e}`,r)}}class _V extends y4{constructor(){super(...arguments),this.permissions=new _J(this._client)}}_V.Permissions=_J;class _Y extends y4{list(e,t={},r){return this._client.getAPIList(y9`/fine_tuning/jobs/${e}/checkpoints`,yB,{query:t,...r})}}class _X extends y4{constructor(){super(...arguments),this.checkpoints=new _Y(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(y9`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",yB,{query:e,...t})}cancel(e,t){return this._client.post(y9`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(y9`/fine_tuning/jobs/${e}/events`,yB,{query:t,...r})}pause(e,t){return this._client.post(y9`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(y9`/fine_tuning/jobs/${e}/resume`,t)}}_X.Checkpoints=_Y;class _Q extends y4{constructor(){super(...arguments),this.methods=new _q(this._client),this.jobs=new _X(this._client),this.checkpoints=new _V(this._client),this.alpha=new _K(this._client)}}_Q.Methods=_q,_Q.Jobs=_X,_Q.Checkpoints=_V,_Q.Alpha=_K;class _0 extends y4{}class _1 extends y4{constructor(){super(...arguments),this.graderModels=new _0(this._client)}}_1.GraderModels=_0;class _4 extends y4{createVariation(e,t){return this._client.post("/images/variations",yW({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",yW({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class _2 extends y4{retrieve(e,t){return this._client.get(y9`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",yF,e)}delete(e,t){return this._client.delete(y9`/models/${e}`,t)}}class _6 extends y4{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function _9(e,t){let r=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var r,i;let n=(r=e.tools??[],i=t.name,r.find(e=>"function"===e.type&&e.name===i));return{...t,...t,parsed_arguments:n?.$brand==="auto-parseable-tool"?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let r=e.content.map(e=>{var r,i;return"output_text"===e.type?{...e,parsed:(r=t,i=e.text,r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(i):JSON.parse(i))}:e});return{...e,content:r}}return e}),i=Object.assign({},e,{output:r});return Object.getOwnPropertyDescriptor(e,"output_text")||_3(i),Object.defineProperty(i,"output_parsed",{enumerable:!0,get(){for(let e of i.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),i}function _3(e){let t=[];for(let r of e.output)if("message"===r.type)for(let e of r.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class _5 extends _a{constructor(e){super(),rm.add(this),rg.set(this,void 0),ry.set(this,void 0),r_.set(this,void 0),gF(this,rg,e,"f")}static createResponse(e,t,r){let i=new _5(t);return i._run(()=>i._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,t,r){let i,n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),gB(this,rm,"m",rv).call(this);let a=null;for await(let n of("response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected(),i))gB(this,rm,"m",rb).call(this,n,a);if(i.controller.signal?.aborted)throw new gK;return gB(this,rm,"m",rw).call(this)}[(rg=new WeakMap,ry=new WeakMap,r_=new WeakMap,rm=new WeakSet,rv=function(){this.ended||gF(this,ry,void 0,"f")},rb=function(e,t){if(this.ended)return;let r=(e,r)=>{(null==t||r.sequence_number>t)&&this._emit(e,r)},i=gB(this,rm,"m",rE).call(this,e);switch(r("event",e),e.type){case"response.output_text.delta":{let t=i.output[e.output_index];if(!t)throw new gq(`missing output at index ${e.output_index}`);if("message"===t.type){let i=t.content[e.content_index];if(!i)throw new gq(`missing content at index ${e.content_index}`);if("output_text"!==i.type)throw new gq(`expected content to be 'output_text', got ${i.type}`);r("response.output_text.delta",{...e,snapshot:i.text})}break}case"response.function_call_arguments.delta":{let t=i.output[e.output_index];if(!t)throw new gq(`missing output at index ${e.output_index}`);"function_call"===t.type&&r("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:r(e.type,e)}},rw=function(){if(this.ended)throw new gq("stream has ended, this shouldn't happen");let e=gB(this,ry,"f");if(!e)throw new gq("request ended without sending any events");gF(this,ry,void 0,"f");let t=function(e,t){var r;return t&&(r=t,y8(r.text?.format))?_9(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,gB(this,rg,"f"));return gF(this,r_,t,"f"),t},rE=function(e){let t=gB(this,ry,"f");if(!t){if("response.created"!==e.type)throw new gq(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return gF(this,ry,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let r=t.output[e.output_index];if(!r)throw new gq(`missing output at index ${e.output_index}`);"message"===r.type&&r.content.push(e.part);break}case"response.output_text.delta":{let r=t.output[e.output_index];if(!r)throw new gq(`missing output at index ${e.output_index}`);if("message"===r.type){let t=r.content[e.content_index];if(!t)throw new gq(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new gq(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let r=t.output[e.output_index];if(!r)throw new gq(`missing output at index ${e.output_index}`);"function_call"===r.type&&(r.arguments+=e.delta);break}case"response.completed":gF(this,ry,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),this.on("error",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=gB(this,r_,"f");if(!e)throw new gq("stream ended without producing a ChatCompletion");return e}}class _8 extends y4{list(e,t={},r){return this._client.getAPIList(y9`/responses/${e}/input_items`,yB,{query:t,...r})}}class _7 extends y4{constructor(){super(...arguments),this.inputItems=new _8(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&_3(e),e))}retrieve(e,t={},r){return this._client.get(y9`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&_3(e),e))}delete(e,t){return this._client.delete(y9`/responses/${e}`,{...t,headers:_b([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>_9(t,e))}stream(e,t){return _5.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(y9`/responses/${e}/cancel`,t)}}_7.InputItems=_8;class ve extends y4{create(e,t,r){return this._client.post(y9`/uploads/${e}/parts`,yW({body:t,...r},this._client))}}class vt extends y4{constructor(){super(...arguments),this.parts=new ve(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(y9`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(y9`/uploads/${e}/complete`,{body:t,...r})}}vt.Parts=ve;let vr=async e=>{let t=await Promise.allSettled(e),r=t.filter(e=>"rejected"===e.status);if(r.length){for(let e of r)console.error(e.reason);throw Error(`${r.length} promise(s) failed - see the above errors`)}let i=[];for(let e of t)"fulfilled"===e.status&&i.push(e.value);return i};class vi extends y4{create(e,t,r){return this._client.post(y9`/vector_stores/${e}/file_batches`,{body:t,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:i}=t;return this._client.get(y9`/vector_stores/${i}/file_batches/${e}`,{...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{vector_store_id:i}=t;return this._client.post(y9`/vector_stores/${i}/file_batches/${e}/cancel`,{...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let i=await this.create(e,t);return await this.poll(e,i.id,r)}listFiles(e,t,r){let{vector_store_id:i,...n}=t;return this._client.getAPIList(y9`/vector_stores/${i}/file_batches/${e}/files`,yB,{query:n,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async poll(e,t,r){let i=_b([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:a}=await this.retrieve(t,{vector_store_id:e},{...r,headers:i}).withResponse();switch(n.status){case"in_progress":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await yr(s);break;case"failed":case"cancelled":case"completed":return n}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},i){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let n=Math.min(i?.maxConcurrency??5,t.length),a=this._client,s=t.values(),o=[...r];async function l(e){for(let t of e){let e=await a.files.create({file:t,purpose:"assistants"},i);o.push(e.id)}}let u=Array(n).fill(s).map(l);return await vr(u),await this.createAndPoll(e,{file_ids:o})}}class vn extends y4{create(e,t,r){return this._client.post(y9`/vector_stores/${e}/files`,{body:t,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:i}=t;return this._client.get(y9`/vector_stores/${i}/files/${e}`,{...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{vector_store_id:i,...n}=t;return this._client.post(y9`/vector_stores/${i}/files/${e}`,{body:n,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(y9`/vector_stores/${e}/files`,yB,{query:t,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{vector_store_id:i}=t;return this._client.delete(y9`/vector_stores/${i}/files/${e}`,{...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let i=await this.create(e,t,r);return await this.poll(e,i.id,r)}async poll(e,t,r){let i=_b([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let n=await this.retrieve(t,{vector_store_id:e},{...r,headers:i}).withResponse(),a=n.data;switch(a.status){case"in_progress":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=n.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await yr(s);break;case"failed":case"completed":return a}}}async upload(e,t,r){let i=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:i.id},r)}async uploadAndPoll(e,t,r){let i=await this.upload(e,t,r);return await this.poll(e,i.id,r)}content(e,t,r){let{vector_store_id:i}=t;return this._client.getAPIList(y9`/vector_stores/${i}/files/${e}/content`,yF,{...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class va extends y4{constructor(){super(...arguments),this.files=new vn(this._client),this.fileBatches=new vi(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(y9`/vector_stores/${e}`,{...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(y9`/vector_stores/${e}`,{body:t,...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",yB,{query:e,...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(y9`/vector_stores/${e}`,{...t,headers:_b([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,r){return this._client.getAPIList(y9`/vector_stores/${e}/search`,yF,{body:t,method:"post",...r,headers:_b([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}va.Files=vn,va.FileBatches=vi;class vs extends y4{constructor(){super(...arguments),rT.add(this)}async unwrap(e,t,r=this._client.webhookSecret,i=300){return await this.verifySignature(e,t,r,i),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,i=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");gB(this,rT,"m",rS).call(this,r);let n=_b([t]).values,a=gB(this,rT,"m",rI).call(this,n,"webhook-signature"),s=gB(this,rT,"m",rI).call(this,n,"webhook-timestamp"),o=gB(this,rT,"m",rI).call(this,n,"webhook-id"),l=parseInt(s,10);if(isNaN(l))throw new g5("Invalid webhook timestamp format");let u=Math.floor(Date.now()/1e3);if(u-l>i)throw new g5("Webhook timestamp is too old");if(l>u+i)throw new g5("Webhook timestamp is too new");let c=a.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),d=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),h=o?`${o}.${s}.${e}`:`${s}.${e}`,p=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of c)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",p,t,new TextEncoder().encode(h)))return}catch{continue}throw new g5("The given webhook signature does not match the expected signature")}}rT=new WeakSet,rS=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},rI=function(e,t){if(!e)throw Error("Headers are required");let r=e.get(t);if(null==r)throw Error(`Missing required header: ${t}`);return r},e.i(110219);class vo{constructor({baseURL:e=_N("OPENAI_BASE_URL"),apiKey:t=_N("OPENAI_API_KEY"),organization:r=_N("OPENAI_ORG_ID")??null,project:i=_N("OPENAI_PROJECT_ID")??null,webhookSecret:n=_N("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(rO.add(this),rk.set(this,void 0),this.completions=new _L(this),this.chat=new __(this),this.embeddings=new _F(this),this.files=new _H(this),this.images=new _4(this),this.audio=new _S(this),this.moderations=new _6(this),this.models=new _2(this),this.fineTuning=new _Q(this),this.graders=new _1(this),this.vectorStores=new va(this),this.webhooks=new vs(this),this.beta=new _U(this),this.batches=new _I(this),this.uploads=new vt(this),this.responses=new _7(this),this.evals=new _G(this),this.containers=new _z(this),void 0===t)throw new gq("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const s={apiKey:t,organization:r,project:i,webhookSecret:n,...a,baseURL:e||"https://api.openai.com/v1"};s.dangerouslyAllowBrowser,this.baseURL=s.baseURL,this.timeout=s.timeout??rA.DEFAULT_TIMEOUT,this.logger=s.logger??console;const o="warn";this.logLevel=o,this.logLevel=yI(s.logLevel,"ClientOptions.logLevel",this)??yI(_N("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=s.fetchOptions,this.maxRetries=s.maxRetries??2,this.fetch=s.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),gF(this,rk,yc,"f"),this._options=s,this.apiKey=t,this.organization=r,this.project=i,this.webhookSecret=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return _b([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let r,i=e,n=function(e=yv){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let r=e.charset||yv.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let i=yd;if(void 0!==e.format){if(!yf(yp,e.format))throw TypeError("Unknown format option provided.");i=e.format}let n=yp[i],a=yv.filter;if(("function"==typeof e.filter||g7(e.filter))&&(a=e.filter),t=e.arrayFormat&&e.arrayFormat in yy?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":yv.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let s=void 0===e.allowDots?!0==!!e.encodeDotInKeys||yv.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:yv.addQueryPrefix,allowDots:s,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:yv.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:yv.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?yv.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:yv.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:yv.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:yv.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:yv.encodeValuesOnly,filter:a,format:i,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:yv.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:yv.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:yv.strictNullHandling}}(t);"function"==typeof n.filter?i=(0,n.filter)("",i):g7(n.filter)&&(r=n.filter);let a=[];if("object"!=typeof i||null===i)return"";let s=yy[n.arrayFormat],o="comma"===s&&n.commaRoundTrip;r||(r=Object.keys(i)),n.sort&&r.sort(n.sort);let l=new WeakMap;for(let e=0;e<r.length;++e){let t=r[e];n.skipNulls&&null===i[t]||y_(a,function e(t,r,i,n,a,s,o,l,u,c,d,h,p,f,m,g,y,_){var v,b;let w,E=t,T=_,S=0,I=!1;for(;void 0!==(T=T.get(yb))&&!I;){let e=T.get(t);if(S+=1,void 0!==e)if(e===S)throw RangeError("Cyclic object value");else I=!0;void 0===T.get(yb)&&(S=0)}if("function"==typeof c?E=c(r,E):E instanceof Date?E=p?.(E):"comma"===i&&g7(E)&&(E=yg(E,function(e){return e instanceof Date?p?.(e):e})),null===E){if(s)return u&&!g?u(r,yv.encoder,y,"key",f):r;E=""}if("string"==typeof(v=E)||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v||(b=E)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(u){let e=g?r:u(r,yv.encoder,y,"key",f);return[m?.(e)+"="+m?.(u(E,yv.encoder,y,"value",f))]}return[m?.(r)+"="+m?.(String(E))]}let O=[];if(void 0===E)return O;if("comma"===i&&g7(E))g&&u&&(E=yg(E,u)),w=[{value:E.length>0?E.join(",")||null:void 0}];else if(g7(c))w=c;else{let e=Object.keys(E);w=d?e.sort(d):e}let A=l?String(r).replace(/\./g,"%2E"):String(r),k=n&&g7(E)&&1===E.length?A+"[]":A;if(a&&g7(E)&&0===E.length)return k+"[]";for(let r=0;r<w.length;++r){let v=w[r],b="object"==typeof v&&void 0!==v.value?v.value:E[v];if(o&&null===b)continue;let T=h&&l?v.replace(/\./g,"%2E"):v,I=g7(E)?"function"==typeof i?i(k,T):k:k+(h?"."+T:"["+T+"]");_.set(t,S);let A=new WeakMap;A.set(yb,_),y_(O,e(b,I,i,n,a,s,o,l,"comma"===i&&g&&g7(E)?null:u,c,d,h,p,f,m,g,y,A))}return O}(i[t],t,s,o,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}let u=a.join(n.delimiter),c=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?c+="utf8=%26%2310003%3B&":c+="utf8=%E2%9C%93&"),u.length>0?c+u:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${yi}`}defaultIdempotencyKey(){return`stainless-node-retry-${gZ()}`}makeStatusError(e,t,r,i){return gW.generate(e,t,r,i)}buildURL(e,t,r){let i=!gB(this,rO,"m",rx).call(this)&&r||this.baseURL,n=new URL(g8.test(e)?e:i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(a)&&(t={...a,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new yD(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let i=await e,n=i.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(i);let{req:a,url:s,timeout:o}=await this.buildRequest(i,{retryCount:n-t});await this.prepareRequest(a,{url:s,options:i});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),u=void 0===r?"":`, retryOf: ${r}`,c=Date.now();if(y$(this).debug(`[${l}] sending request`,yC({retryOfRequestLogID:r,method:i.method,url:s,options:i,headers:a.headers})),i.signal?.aborted)throw new gK;let d=new AbortController,h=await this.fetchWithTimeout(s,a,o,d).catch(gH),p=Date.now();if(h instanceof Error){let e=`retrying, ${t} attempts remaining`;if(i.signal?.aborted)throw new gK;let n=gG(h)||/timed? ?out/i.test(String(h)+("cause"in h?String(h.cause):""));if(t)return y$(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),y$(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,yC({retryOfRequestLogID:r,url:s,durationMs:p-c,message:h.message})),this.retryRequest(i,t,r??l);if(y$(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),y$(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,yC({retryOfRequestLogID:r,url:s,durationMs:p-c,message:h.message})),n)throw new gV;throw new gJ({cause:h})}let f=[...h.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${u}${f}] ${a.method} ${s} ${h.ok?"succeeded":"failed"} with status ${h.status} in ${p-c}ms`;if(!h.ok){let e=await this.shouldRetry(h);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await yu(h.body),y$(this).info(`${m} - ${e}`),y$(this).debug(`[${l}] response error (${e})`,yC({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,durationMs:p-c})),this.retryRequest(i,t,r??l,h.headers)}let n=e?"error; no more retries left":"error; not retryable";y$(this).info(`${m} - ${n}`);let a=await h.text().catch(e=>gH(e).message),s=(e=>{try{return JSON.parse(e)}catch(e){return}})(a),o=s?void 0:a;throw y$(this).debug(`[${l}] response error (${n})`,yC({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,message:o,durationMs:Date.now()-c})),this.makeStatusError(h.status,s,o,h.headers)}return y$(this).info(m),y$(this).debug(`[${l}] response start`,yC({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,durationMs:p-c})),{response:h,options:i,controller:d,requestLogID:l,retryOfRequestLogID:r,startTime:c}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){return new yz(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,r,i){let{signal:n,method:a,...s}=t||{};n&&n.addEventListener("abort",()=>i.abort());let o=setTimeout(()=>i.abort(),r),l=globalThis.ReadableStream&&s.body instanceof globalThis.ReadableStream||"object"==typeof s.body&&null!==s.body&&Symbol.asyncIterator in s.body,u={signal:i.signal,...l?{duplex:"half"}:{},method:"GET",...s};a&&(u.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,u)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,r,i){let n,a=i?.get("retry-after-ms");if(a){let e=parseFloat(a);Number.isNaN(e)||(n=e)}let s=i?.get("retry-after");if(s&&!n){let e=parseFloat(s);n=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let r=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,r)}return await yr(n),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:i,path:n,query:a,defaultBaseURL:s}=r,o=this.buildURL(n,a,s);"timeout"in r&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new gq(`${e} must be an integer`);if(t<0)throw new gq(`${e} must be a positive integer`)})("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:l,body:u}=this.buildBody({options:r}),c=await this.buildHeaders({options:e,method:i,bodyHeaders:l,retryCount:t});return{req:{method:i,headers:c,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&u instanceof globalThis.ReadableStream&&{duplex:"half"},...u&&{body:u},...this.fetchOptions??{},...r.fetchOptions??{}},url:o,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:i}){let n={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=e.idempotencyKey);let a=_b([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...o??(o=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yi,"X-Stainless-OS":ya(Deno.build.os),"X-Stainless-Arch":yn(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yi,"X-Stainless-OS":ya(globalThis.process.platform??"unknown"),"X-Stainless-Arch":yn(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,i=r[2]||0,n=r[3]||0;return{browser:e,version:`${t}.${i}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=_b([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&r.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:yo(e)}:gB(this,rk,"f").call(this,{body:e,headers:r})}}function vl(e,t){let r;if(void 0===e.function)return;if(t?.partial)try{r=nT(e.function.arguments??"{}")}catch{return}else try{r=JSON.parse(e.function.arguments)}catch(t){throw new mL([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"\nare not valid JSON.",`Error: ${t.message}`].join("\n"))}let i={name:e.function.name,args:r,type:"tool_call"};return t?.returnId&&(i.id=e.id),i}function vu(e){if(void 0===e.id)throw Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}}function vc(e,t){return{name:e.function?.name,args:e.function?.arguments,id:e.id,error:t,type:"invalid_tool_call"}}rA=vo,rk=new WeakMap,rO=new WeakSet,rx=function(){return"https://api.openai.com/v1"!==this.baseURL},vo.OpenAI=rA,vo.DEFAULT_TIMEOUT=6e5,vo.OpenAIError=gq,vo.APIError=gW,vo.APIConnectionError=gJ,vo.APIConnectionTimeoutError=gV,vo.APIUserAbortError=gK,vo.NotFoundError=g0,vo.ConflictError=g1,vo.RateLimitError=g2,vo.BadRequestError=gY,vo.AuthenticationError=gX,vo.InternalServerError=g6,vo.PermissionDeniedError=gQ,vo.UnprocessableEntityError=g4,vo.InvalidWebhookSignatureError=g5,vo.toFile=y0,vo.Completions=_L,vo.Chat=__,vo.Embeddings=_F,vo.Files=_H,vo.Images=_4,vo.Audio=_S,vo.Moderations=_6,vo.Models=_2,vo.FineTuning=_Q,vo.Graders=_1,vo.VectorStores=va,vo.Webhooks=vs,vo.Beta=_U,vo.Batches=_I,vo.Uploads=vt,vo.Responses=_7,vo.Evals=_G,vo.Containers=_z;var vd=class extends mM{static lc_name(){return"JsonOutputToolsParser"}returnId=!1;lc_namespace=["langchain","output_parsers","openai_tools"];lc_serializable=!0;constructor(e){super(e),this.returnId=e?.returnId??this.returnId}_diff(){throw Error("Not supported.")}async parse(){throw Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let r,i=e[0].message;if(nV(i)&&i.tool_calls?.length?r=i.tool_calls.map(e=>{let{id:t,...r}=e;return this.returnId?{id:t,...r}:r}):void 0!==i.additional_kwargs.tool_calls&&(r=JSON.parse(JSON.stringify(i.additional_kwargs.tool_calls)).map(e=>vl(e,{returnId:this.returnId,partial:t}))),!r)return[];let n=[];for(let e of r)if(void 0!==e){let t={type:e.name,args:e.args,id:e.id};n.push(t)}return n}},vh=class extends vd{static lc_name(){return"JsonOutputKeyToolsParser"}lc_namespace=["langchain","output_parsers","openai_tools"];lc_serializable=!0;returnId=!1;keyName;returnSingle=!1;zodSchema;constructor(e){super(e),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;let t=await hC(this.zodSchema,e);if(t.success)return t.data;throw new mL(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error?.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let t=(await super.parsePartialResult(e)).filter(e=>e.type===this.keyName),r=t;if(t.length)return(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?r[0]:r}async parseResult(e){let t=(await super.parsePartialResult(e,!1)).filter(e=>e.type===this.keyName),r=t;return t.length?(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?this._validateResult(r[0]):await Promise.all(r.map(e=>this._validateResult(e))):void 0}};iI({},{JsonOutputKeyToolsParser:()=>vh,JsonOutputToolsParser:()=>vd,convertLangChainToolCallToOpenAI:()=>vu,makeInvalidToolCall:()=>vc,parseToolCall:()=>vl});let vp=Symbol("Let zodToJsonSchema decide on which parser to use"),vf={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},vm=e=>"_def"in e?e._def:e;function vg(e,t,r,i){i?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function vy(e,t,r,i,n){e[t]=r,vg(e,t,i,n)}let v_=/^[cC][^\s-]{8,}$/,vv=/^[0-9a-z]+$/,vb=/^[0-9A-HJKMNP-TV-Z]{26}$/,vw=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,vE=()=>(void 0===d&&(d=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),d),vT=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,vS=/^[a-zA-Z0-9_-]{21}$/;function vI(e,t){let r={type:"string"};function i(e){return"escape"===t.patternStrategy?vO(e):e}if(e.checks)for(let n of e.checks)switch(n.kind){case"min":vy(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,n.value):n.value,n.message,t);break;case"max":vy(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"email":switch(t.emailStrategy){case"format:email":vA(r,"email",n.message,t);break;case"format:idn-email":vA(r,"idn-email",n.message,t);break;case"pattern:zod":vk(r,vw,n.message,t)}break;case"url":vA(r,"uri",n.message,t);break;case"uuid":vA(r,"uuid",n.message,t);break;case"regex":vk(r,n.regex,n.message,t);break;case"cuid":vk(r,v_,n.message,t);break;case"cuid2":vk(r,vv,n.message,t);break;case"startsWith":vk(r,RegExp(`^${i(n.value)}`),n.message,t);break;case"endsWith":vk(r,RegExp(`${i(n.value)}$`),n.message,t);break;case"datetime":vA(r,"date-time",n.message,t);break;case"date":vA(r,"date",n.message,t);break;case"time":vA(r,"time",n.message,t);break;case"duration":vA(r,"duration",n.message,t);break;case"length":vy(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,n.value):n.value,n.message,t),vy(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"includes":vk(r,RegExp(i(n.value)),n.message,t);break;case"ip":"v6"!==n.version&&vA(r,"ipv4",n.message,t),"v4"!==n.version&&vA(r,"ipv6",n.message,t);break;case"emoji":vk(r,vE,n.message,t);break;case"ulid":vk(r,vb,n.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":vA(r,"binary",n.message,t);break;case"contentEncoding:base64":vy(r,"contentEncoding","base64",n.message,t);break;case"pattern:zod":vk(r,vT,n.message,t)}break;case"nanoid":vk(r,vS,n.message,t)}return r}let vO=e=>Array.from(e).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),vA=(e,t,r,i)=>{e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&i.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&i.errorMessages&&{errorMessage:{format:r}}})):vy(e,"format",t,r,i)},vk=(e,t,r,i)=>{e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&i.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:vx(t,i),...r&&i.errorMessages&&{errorMessage:{pattern:r}}})):vy(e,"pattern",vx(t,i),r,i)},vx=(e,t)=>{let r="function"==typeof e?e():e;if(!t.applyRegexFlags||!r.flags)return r.source;let i={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=i.i?r.source.toLowerCase():r.source,a="",s=!1,o=!1,l=!1;for(let e=0;e<n.length;e++){if(s){a+=n[e],s=!1;continue}if(i.i){if(o){if(n[e].match(/[a-z]/)){l?(a+=n[e],a+=`${n[e-2]}-${n[e]}`.toUpperCase(),l=!1):"-"===n[e+1]&&n[e+2]?.match(/[a-z]/)?(a+=n[e],l=!0):a+=`${n[e]}${n[e].toUpperCase()}`;continue}}else if(n[e].match(/[a-z]/)){a+=`[${n[e]}${n[e].toUpperCase()}]`;continue}}if(i.m){if("^"===n[e]){a+=`(^|(?<=[\r
]))`;continue}else if("$"===n[e]){a+=`($|(?=[\r
]))`;continue}}if(i.s&&"."===n[e]){a+=o?`${n[e]}\r
`:`[${n[e]}\r
]`;continue}a+=n[e],"\\"===n[e]?s=!0:o&&"]"===n[e]?o=!1:o||"["!==n[e]||(o=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return a};function v$(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===h6.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,i)=>({...r,[i]:vP(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",i]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:vP(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===h6.ZodFirstPartyTypeKind.ZodString&&e.keyType._def.checks?.length){let i=Object.entries(vI(e.keyType._def,t)).reduce((e,[t,r])=>"type"===t?e:{...e,[t]:r},{});return{...r,propertyNames:i}}return e.keyType?._def.typeName===h6.ZodFirstPartyTypeKind.ZodEnum?{...r,propertyNames:{enum:e.keyType._def.values}}:r}let vC={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},vN=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>vP(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0};function vP(e,t,r=!1){let i=t.seen.get(e);if(t.override){let n=t.override?.(e,t,i,r);if(n!==vp)return n}if(i&&!r){let e=vR(i,t);if(void 0!==e)return"$ref"in e&&t.seenRefs.add(e.$ref),e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let a=vU(e,e.typeName,t,r);return a&&vL(e,t,a),n.jsonSchema=a,a}let vR=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"extract-to-root":let r=e.path.slice(t.basePath.length+1).join("_");return r!==t.name&&"duplicate-ref"===t.nameStrategy&&(t.definitions[r]=e.def),{$ref:[...t.basePath,t.definitionPath,r].join("/")};case"relative":return{$ref:vj(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},vj=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},vU=(e,t,r,i)=>{switch(t){case h6.ZodFirstPartyTypeKind.ZodString:return vI(e,r);case h6.ZodFirstPartyTypeKind.ZodNumber:let n={type:"number"};if(!e.checks)return n;for(let t of e.checks)switch(t.kind){case"int":n.type="integer",vg(n,"type",t.message,r);break;case"min":"jsonSchema7"===r.target?t.inclusive?vy(n,"minimum",t.value,t.message,r):vy(n,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(n.exclusiveMinimum=!0),vy(n,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?vy(n,"maximum",t.value,t.message,r):vy(n,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(n.exclusiveMaximum=!0),vy(n,"maximum",t.value,t.message,r));break;case"multipleOf":vy(n,"multipleOf",t.value,t.message,r)}return n;case h6.ZodFirstPartyTypeKind.ZodObject:let a;return(a={type:"object",...Object.entries(e.shape()).reduce((e,[t,i])=>{if(void 0===i||void 0===i._def)return e;let n=[...r.currentPath,"properties",t],a=vP(i._def,{...r,currentPath:n,propertyPath:n});if(void 0===a)return e;if(r.openaiStrictMode&&i.isOptional()&&!i.isNullable()&&void 0===i._def?.defaultValue)throw Error(`Zod field at \`${n.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...e.properties,[t]:a},required:i.isOptional()&&!r.openaiStrictMode?e.required:[...e.required,t]}},{properties:{},required:[]}),additionalProperties:"strict"===r.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:vP(e.catchall._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:vP(e.catchall._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??!0}).required.length||delete a.required,a;case h6.ZodFirstPartyTypeKind.ZodBigInt:let s={type:"integer",format:"int64"};if(!e.checks)return s;for(let t of e.checks)switch(t.kind){case"min":"jsonSchema7"===r.target?t.inclusive?vy(s,"minimum",t.value,t.message,r):vy(s,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(s.exclusiveMinimum=!0),vy(s,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?vy(s,"maximum",t.value,t.message,r):vy(s,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(s.exclusiveMaximum=!0),vy(s,"maximum",t.value,t.message,r));break;case"multipleOf":vy(s,"multipleOf",t.value,t.message,r)}return s;case h6.ZodFirstPartyTypeKind.ZodBoolean:return{type:"boolean"};case h6.ZodFirstPartyTypeKind.ZodDate:return function e(t,r,i){let n=i??r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((i,n)=>e(t,r,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var a=t,s=r;let o={type:"integer",format:"unix-time"};if("openApi3"===s.target)return o;for(let e of a.checks)switch(e.kind){case"min":vy(o,"minimum",e.value,e.message,s);break;case"max":vy(o,"maximum",e.value,e.message,s)}return o}}(e,r);case h6.ZodFirstPartyTypeKind.ZodUndefined:return{not:{}};case h6.ZodFirstPartyTypeKind.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case h6.ZodFirstPartyTypeKind.ZodArray:let o;return o={type:"array"},e.type?._def?.typeName!==h6.ZodFirstPartyTypeKind.ZodAny&&(o.items=vP(e.type._def,{...r,currentPath:[...r.currentPath,"items"]})),e.minLength&&vy(o,"minItems",e.minLength.value,e.minLength.message,r),e.maxLength&&vy(o,"maxItems",e.maxLength.value,e.maxLength.message,r),e.exactLength&&(vy(o,"minItems",e.exactLength.value,e.exactLength.message,r),vy(o,"maxItems",e.exactLength.value,e.exactLength.message,r)),o;case h6.ZodFirstPartyTypeKind.ZodUnion:case h6.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:if("openApi3"===r.target)return vN(e,r);let l=e.options instanceof Map?Array.from(e.options.values()):e.options;if(l.every(e=>e._def.typeName in vC&&(!e._def.checks||!e._def.checks.length))){let e=l.reduce((e,t)=>{let r=vC[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(l.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=l.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===l.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:l.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(l.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:l.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return vN(e,r);case h6.ZodFirstPartyTypeKind.ZodIntersection:let u,c,d;return u=[vP(e.left._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),vP(e.right._def,{...r,currentPath:[...r.currentPath,"allOf","1"]})].filter(e=>!!e),c="jsonSchema2019-09"===r.target?{unevaluatedProperties:!1}:void 0,d=[],u.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)d.push(...e.allOf),void 0===e.unevaluatedProperties&&(c=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...i}=e;t=i}else c=void 0;d.push(t)}}),d.length?{allOf:d,...c}:void 0;case h6.ZodFirstPartyTypeKind.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>vP(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:vP(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>vP(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case h6.ZodFirstPartyTypeKind.ZodRecord:return v$(e,r);case h6.ZodFirstPartyTypeKind.ZodLiteral:let h;return"bigint"!=(h=typeof e.value)&&"number"!==h&&"boolean"!==h&&"string"!==h?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===r.target?{type:"bigint"===h?"integer":h,enum:[e.value]}:{type:"bigint"===h?"integer":h,const:e.value};case h6.ZodFirstPartyTypeKind.ZodEnum:return{type:"string",enum:[...e.values]};case h6.ZodFirstPartyTypeKind.ZodNativeEnum:let p,f,m;return p=e.values,{type:1===(m=Array.from(new Set((f=Object.keys(e.values).filter(e=>"number"!=typeof p[p[e]]).map(e=>p[e])).map(e=>typeof e)))).length?"string"===m[0]?"string":"number":["string","number"],enum:f};case h6.ZodFirstPartyTypeKind.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===r.target||"property"===r.nullableStrategy?{type:vC[e.innerType._def.typeName],nullable:!0}:{type:[vC[e.innerType._def.typeName],"null"]};if("openApi3"===r.target){let t=vP(e.innerType._def,{...r,currentPath:[...r.currentPath]});return t&&"$ref"in t?{allOf:[t],nullable:!0}:t&&{...t,nullable:!0}}let g=vP(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","0"]});return g&&{anyOf:[g,{type:"null"}]};case h6.ZodFirstPartyTypeKind.ZodOptional:if(r.propertyPath&&r.currentPath.slice(0,r.propertyPath.length).toString()===r.propertyPath.toString())return vP(e.innerType._def,{...r,currentPath:r.currentPath});let y=vP(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","1"]});return y?{anyOf:[{not:{}},y]}:{};case h6.ZodFirstPartyTypeKind.ZodMap:if("record"===r.mapStrategy)return v$(e,r);return{type:"array",maxItems:125,items:{type:"array",items:[vP(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||{},vP(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case h6.ZodFirstPartyTypeKind.ZodSet:let _;return _={type:"array",uniqueItems:!0,items:vP(e.valueType._def,{...r,currentPath:[...r.currentPath,"items"]})},e.minSize&&vy(_,"minItems",e.minSize.value,e.minSize.message,r),e.maxSize&&vy(_,"maxItems",e.maxSize.value,e.maxSize.message,r),_;case h6.ZodFirstPartyTypeKind.ZodLazy:return vP(e.getter()._def,r);case h6.ZodFirstPartyTypeKind.ZodPromise:return vP(e.type._def,r);case h6.ZodFirstPartyTypeKind.ZodNaN:case h6.ZodFirstPartyTypeKind.ZodNever:return{not:{}};case h6.ZodFirstPartyTypeKind.ZodEffects:return"input"===r.effectStrategy?vP(e.schema._def,r,i):{};case h6.ZodFirstPartyTypeKind.ZodAny:case h6.ZodFirstPartyTypeKind.ZodUnknown:return{};case h6.ZodFirstPartyTypeKind.ZodDefault:return{...vP(e.innerType._def,r),default:e.defaultValue()};case h6.ZodFirstPartyTypeKind.ZodBranded:return vP(e.type._def,r);case h6.ZodFirstPartyTypeKind.ZodReadonly:case h6.ZodFirstPartyTypeKind.ZodCatch:return vP(e.innerType._def,r);case h6.ZodFirstPartyTypeKind.ZodPipeline:if("input"===r.pipeStrategy)return vP(e.in._def,r);if("output"===r.pipeStrategy)return vP(e.out._def,r);let v=vP(e.in._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),b=vP(e.out._def,{...r,currentPath:[...r.currentPath,"allOf",v?"1":"0"]});return{allOf:[v,b].filter(e=>void 0!==e)};case h6.ZodFirstPartyTypeKind.ZodFunction:case h6.ZodFirstPartyTypeKind.ZodVoid:case h6.ZodFirstPartyTypeKind.ZodSymbol:default:return}},vL=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);function vD(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${t}/
`,e}function vM(e){let t;return e.constructor.name===gV.name?(t=Error(e.message)).name="TimeoutError":e.constructor.name===gK.name?(t=Error(e.message)).name="AbortError":t=400===e.status&&e.message.includes("tool_calls")?vD(e,"INVALID_TOOL_RESULTS"):401===e.status?vD(e,"MODEL_AUTHENTICATION"):429===e.status?vD(e,"MODEL_RATE_LIMIT"):404===e.status?vD(e,"MODEL_NOT_FOUND"):e,t}function vz(e){if(e){if("any"===e||"required"===e)return"required";if("auto"===e)return"auto";if("none"===e)return"none";else if("string"==typeof e)return{type:"function",function:{name:e}};else return e}}function vF(e,t){let r=[];for(let[i,n]of Object.entries(e.properties??{}))n.description&&t<2&&r.push(`// ${n.description}`),e.required?.includes(i)?r.push(`${i}: ${vB(n,t)},`):r.push(`${i}?: ${vB(n,t)},`);return r.map(e=>" ".repeat(t)+e).join("\n")}function vB(e,t){if(void 0!==e.anyOf&&Array.isArray(e.anyOf))return e.anyOf.map(e=>vB(e,t)).join(" | ");switch(e.type){case"string":if(e.enum)return e.enum.map(e=>`"${e}"`).join(" | ");return"string";case"number":if(e.enum)return e.enum.map(e=>`${e}`).join(" | ");return"number";case"integer":if(e.enum)return e.enum.map(e=>`${e}`).join(" | ");return"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",vF(e,t+2),"}"].join("\n");case"array":if(e.items)return`${vB(e.items,t)}[]`;return"any[]";default:return""}}function vZ(e){return"type"in e&&"function"!==e.type&&"custom"!==e.type}function vG(e){return"type"in e&&"custom"===e.type&&"custom"in e&&"object"==typeof e.custom&&null!==e.custom}let vH="__openai_function_call_ids__";function vq(e){return!!e&&!!(/^o\d/.test(e??"")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat"))}function vW(e){let t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!nS.isInstance(e))throw Error("Invalid generic chat message");return"system"!==e.role&&"developer"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&"tool"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role;default:throw Error(`Unknown message type: ${t}`)}}let vK={providerName:"ChatOpenAI",fromStandardTextBlock:e=>({type:"text",text:e.text}),fromStandardImageBlock(e){if("url"===e.source_type)return{type:"image_url",image_url:{url:e.url,...e.metadata?.detail?{detail:e.metadata.detail}:{}}};if("base64"===e.source_type)return{type:"image_url",image_url:{url:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.detail?{detail:e.metadata.detail}:{}}};throw Error(`Image content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(e){if("url"===e.source_type){let t,r=iF({dataUrl:e.url});if(!r)throw Error(`URL audio blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);let i=r.mime_type||e.mime_type||"";try{t=iz(i)}catch{throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==t.type||"wav"!==t.subtype&&"mp3"!==t.subtype)throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:t.subtype,data:r.data}}}if("base64"===e.source_type){let t;try{t=iz(e.mime_type??"")}catch{throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==t.type||"wav"!==t.subtype&&"mp3"!==t.subtype)throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:t.subtype,data:e.data}}}throw Error(`Audio content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(e){if("url"===e.source_type){if(!iF({dataUrl:e.url}))throw Error(`URL file blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:e.url,...e.metadata?.filename||e.metadata?.name?{filename:e.metadata?.filename||e.metadata?.name}:{}}}}if("base64"===e.source_type)return{type:"file",file:{file_data:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.filename||e.metadata?.name||e.metadata?.title?{filename:e.metadata?.filename||e.metadata?.name||e.metadata?.title}:{}}};if("id"===e.source_type)return{type:"file",file:{file_id:e.id}};throw Error(`File content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)}};function vJ(e,t){return e.flatMap(e=>{let r=vW(e);"system"===r&&vq(t)&&(r="developer");let i={role:r,content:"string"==typeof e.content?e.content:e.content.map(e=>iR(e)?iB(e,vK):e)};return(null!=e.name&&(i.name=e.name),null!=e.additional_kwargs.function_call&&(i.function_call=e.additional_kwargs.function_call,i.content=""),nV(e)&&e.tool_calls?.length?(i.tool_calls=e.tool_calls.map(vu),i.content=""):(null!=e.additional_kwargs.tool_calls&&(i.tool_calls=e.additional_kwargs.tool_calls),null!=e.tool_call_id&&(i.tool_call_id=e.tool_call_id)),e.additional_kwargs.audio&&"object"==typeof e.additional_kwargs.audio&&"id"in e.additional_kwargs.audio)?[i,{role:"assistant",audio:{id:e.additional_kwargs.audio.id}}]:i})}class vV extends m${_llmType(){return"openai"}static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning","reasoningEffort","service_tier"]}get lc_secrets(){return{apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{apiKey:"openai_api_key",modelName:"model",reasoningEffort:"reasoning_effort"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","model","modelName","modelKwargs","stop","stopSequences","timeout","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","zdrEnabled","reasoning","reasoningEffort","promptCacheKey","verbosity"]}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}constructor(e){super(e??{}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zdrEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"service_tier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"promptCacheKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbosity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.apiKey=e?.apiKey??e?.configuration?.apiKey??iP("OPENAI_API_KEY"),this.organization=e?.configuration?.organization??iP("OPENAI_ORGANIZATION"),this.model=e?.model??e?.modelName??this.model,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this.stop,this.user=e?.user,this.__includeRawResponse=e?.__includeRawResponse,this.audio=e?.audio,this.modalities=e?.modalities,this.reasoning=e?.reasoning??e?.reasoningEffort?{effort:e.reasoningEffort}:void 0,this.maxTokens=e?.maxCompletionTokens??e?.maxTokens,this.disableStreaming=e?.disableStreaming===!0,this.streaming=e?.streaming===!0,this.promptCacheKey=e?.promptCacheKey??this.promptCacheKey,this.verbosity=e?.verbosity??this.verbosity,e?.streaming===!1&&(this.disableStreaming=!0),!0===this.disableStreaming&&(this.streaming=!1),this.streamUsage=e?.streamUsage??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e?.configuration},e?.supportsStrictToolCalling!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),e?.service_tier!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=e?.zdrEnabled??!1}_getReasoningParams(e){let t;if(vq(this.model))return void 0!==this.reasoning&&(t={...t,...this.reasoning}),e?.reasoning!==void 0&&(t={...t,...e.reasoning}),t}_getResponseFormat(e){return e&&"json_schema"===e.type&&e.json_schema.schema&&hA(e.json_schema.schema)?function(e,t,r){if(hI(e)){var i,n,a,s;let o;return a={type:"json_schema",json_schema:{...r,name:t,strict:!0,schema:((e,t)=>{let r,i,n=(i=void 0!==(r="string"==typeof t?{...vf,basePath:["#"],definitions:{},name:t}:{...vf,basePath:["#"],definitions:{},...t}).name?[...r.basePath,r.definitionPath,r.name]:r.basePath,{...r,currentPath:i,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(r.definitions).map(([e,t])=>[vm(t),{def:vm(t),path:[...r.basePath,r.definitionPath,e],jsonSchema:void 0}]))}),a="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,s=vP(e._def,void 0===a?n:{...n,currentPath:[...n.basePath,n.definitionPath,a]},!1)??{},o="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==o&&(s.title=o);let l=(()=>{if(function(e){if(!e)return!0;for(let t in e)return!1;return!0}(n.definitions))return;let e={},t=new Set;for(let r=0;r<500;r++){let r=Object.entries(n.definitions).filter(([e])=>!t.has(e));if(0===r.length)break;for(let[i,a]of r)e[i]=vP(vm(a),{...n,currentPath:[...n.basePath,n.definitionPath,i]},!0)??{},t.add(i)}return e})(),u=void 0===a?l?{...s,[n.definitionPath]:l}:s:"duplicate-ref"===n.nameStrategy?{...s,...l||n.seenRefs.size?{[n.definitionPath]:{...l,...n.seenRefs.size?{[a]:s}:void 0}}:void 0}:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...l,[a]:s}};return"jsonSchema7"===n.target?u.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===n.target&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),u})(e,{openaiStrictMode:!0,name:{name:t}.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}},s=t=>e.parse(JSON.parse(t)),Object.defineProperties(o={...a},{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:s,enumerable:!1}}),o}if(hS(e)){let a;return i={type:"json_schema",json_schema:{...r,name:t,strict:!0,schema:hE(e,{cycles:"ref",reused:"ref",override(e){e.jsonSchema.title=t}})}},n=t=>lo(e,JSON.parse(t)),Object.defineProperties(a={...i},{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:n,enumerable:!1}}),a}throw Error("Unsupported schema response format")}(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}_combineCallOptions(e){return{...this.defaultOptions,...e??{}}}_getClientOptions(e){if(!this.client){let e=function(e){let{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:i,azureOpenAIBasePath:n,baseURL:a,azureADTokenProvider:s,azureOpenAIEndpoint:o}=e;if((i||s)&&n&&t)return`${n}/${t}`;if((i||s)&&o&&t)return`${o}/openai/deployments/${t}`;if(i||s){if(!r)throw Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${t}`}return a}({baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new vo(t)}return{...this.clientConfig,...e}}_convertChatOpenAIToolToCompletionsTool(e,t){var r;let i;return"object"==typeof e&&null!==e&&"metadata"in e&&"object"==typeof e.metadata&&null!==e.metadata&&"customTool"in e.metadata&&"object"==typeof e.metadata.customTool&&null!==e.metadata.customTool?{type:"custom",custom:{name:(r=e.metadata.customTool).name,description:r.description,format:(()=>{if(r.format){if("grammar"===r.format.type)return{type:"grammar",grammar:{definition:r.format.definition,syntax:r.format.syntax}};if("text"===r.format.type)return{type:"text"}}})()}}:mT(e)?t?.strict!==void 0?{...e,function:{...e.function,strict:t.strict}}:e:("function"===(i=gO(e)?gk(e):e).type&&t?.strict!==void 0&&(i.function.strict=t.strict),i)}bindTools(e,t){let r;return t?.strict!==void 0?r=t.strict:void 0!==this.supportsStrictToolCalling&&(r=this.supportsStrictToolCalling),this.withConfig({tools:e.map(e=>vZ(e)?e:this._convertChatOpenAIToolToCompletionsTool(e,{strict:r})),...t})}async stream(e,t){return super.stream(e,this._combineCallOptions(t))}async invoke(e,t){return super.invoke(e,this._combineCallOptions(t))}_combineLLMOutput(...e){return e.reduce((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}async getNumTokensFromMessages(e){let t=0,r=0,i=0;"gpt-3.5-turbo-0301"===this.model?(r=4,i=-1):(r=3,i=1);let n=await Promise.all(e.map(async e=>{let n=await this.getNumTokens(e.content),a=await this.getNumTokens(vW(e)),s=void 0!==e.name?i+await this.getNumTokens(e.name):0,o=n+r+a+s;if("function"===e._getType()&&(o-=2),e.additional_kwargs?.function_call&&(o+=3),e?.additional_kwargs.function_call?.name&&(o+=await this.getNumTokens(e.additional_kwargs.function_call?.name)),e.additional_kwargs.function_call?.arguments)try{o+=await this.getNumTokens(JSON.stringify(JSON.parse(e.additional_kwargs.function_call?.arguments)))}catch(t){console.error("Error parsing function arguments",t,JSON.stringify(e.additional_kwargs.function_call)),o+=await this.getNumTokens(e.additional_kwargs.function_call?.arguments)}return t+=o,o}));return{totalCount:t+=3,countPerMessage:n}}async _getNumTokensFromGenerations(e){return(await Promise.all(e.map(async e=>e.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([e.message])).countPerMessage[0]:await this.getNumTokens(e.message.content)))).reduce((e,t)=>e+t,0)}async _getEstimatedTokenCountFromPrompt(e,t,r){let i=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&"auto"!==r){let e=function(e){let t=["namespace functions {",""];for(let r of e)r.description&&t.push(`// ${r.description}`),Object.keys(r.parameters.properties??{}).length>0?(t.push(`type ${r.name} = (_: {`),t.push(vF(r.parameters,0)),t.push("}) => any;")):t.push(`type ${r.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join("\n")}(t);i+=await this.getNumTokens(e),i+=9}return t&&e.find(e=>"system"===e._getType())&&(i-=4),"none"===r?i+=1:"object"==typeof r&&(i+=await this.getNumTokens(r.name)+4),i}_getStructuredOutputMethod(e){let t={...e};if(this.model.startsWith("gpt-3")||this.model.startsWith("gpt-4-")||"gpt-4"===this.model)"jsonSchema"===t.method&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`);else if(t?.method===void 0)return"jsonSchema";return t.method}withStructuredOutput(e,t){let r,i,n,a,s,o;if(void 0!==e&&"object"==typeof e.schema?(r=e.schema,i=e.name,n=e.method,a=e.includeRaw):(r=e,i=t?.name,n=t?.method,a=t?.includeRaw),t?.strict!==void 0&&"jsonMode"===n)throw Error("Argument `strict` is only supported for `method` = 'function_calling'");if("jsonMode"===(n=this._getStructuredOutputMethod({...t,method:n}))){o=hA(r)?mK.fromZodSchema(r):new mz;let e=pM(r);s=this.withConfig({response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"json_mode"},schema:{title:i??"extract",...e}}})}else if("jsonSchema"===n){let e={name:i??"extract",description:hj(r),schema:r,strict:t?.strict},n=pM(e.schema);if(s=this.withConfig({response_format:{type:"json_schema",json_schema:e},ls_structured_output_format:{kwargs:{method:"json_schema"},schema:{title:e.name,description:e.description,...n}}}),hA(r)){let e=mK.fromZodSchema(r);o=fz.from(t=>"parsed"in t.additional_kwargs?t.additional_kwargs.parsed:e)}else o=new mz}else{let e=i??"extract";if(hA(r)){let i=pM(r);s=this.withConfig({tools:[{type:"function",function:{name:e,description:i.description,parameters:i}}],tool_choice:{type:"function",function:{name:e}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:e,...i}},...t?.strict!==void 0?{strict:t.strict}:{}}),o=new vh({returnSingle:!0,keyName:e,zodSchema:r})}else{let i;"string"==typeof r.name&&"object"==typeof r.parameters&&null!=r.parameters?(i=r,e=r.name):i={name:e=r.title??e,description:r.description??"",parameters:r};let n=pM(r);s=this.withConfig({tools:[{type:"function",function:i}],tool_choice:{type:"function",function:{name:e}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:e,...n}},...t?.strict!==void 0?{strict:t.strict}:{}}),o=new vh({returnSingle:!0,keyName:e})}}if(!a)return s.pipe(o);let l=mA.assign({parsed:(e,t)=>o.invoke(e.raw,t)}),u=mA.assign({parsed:()=>null}),c=l.withFallbacks({fallbacks:[u]});return fL.from([{raw:s},c])}}class vY extends vV{invocationParams(e){var t;let r;e?.strict!==void 0?r=e.strict:void 0!==this.supportsStrictToolCalling&&(r=this.supportsStrictToolCalling);let i={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e?.previous_response_id,truncation:e?.truncation,include:e?.include,tools:e?.tools?.length?this._reduceChatOpenAITools(e.tools,{stream:this.streaming,strict:r}):void 0,tool_choice:null!=(t=e?.tool_choice)&&"object"==typeof t&&"type"in t&&"function"!==t.type?e?.tool_choice:(()=>{let t=vz(e?.tool_choice);if("object"==typeof t&&"type"in t){if("function"===t.type)return{type:"function",name:t.function.name};else if("allowed_tools"===t.type)return{type:"allowed_tools",mode:t.allowed_tools.mode,tools:t.allowed_tools.tools};else if("custom"===t.type)return{type:"custom",name:t.custom.name}}})(),text:(()=>{if(e?.text)return e.text;let t=this._getResponseFormat(e?.response_format);return t?.type==="json_schema"?null!=t.json_schema.schema?{format:{type:"json_schema",schema:t.json_schema.schema,description:t.json_schema.description,name:t.json_schema.name,strict:t.json_schema.strict},verbosity:e?.verbosity}:void 0:{format:t,verbosity:e?.verbosity}})(),parallel_tool_calls:e?.parallel_tool_calls,max_output_tokens:-1===this.maxTokens?void 0:this.maxTokens,prompt_cache_key:e?.promptCacheKey??this.promptCacheKey,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},n=this._getReasoningParams(e);return void 0!==n&&(i.reasoning=n),i}async _generate(e,t){let r=this.invocationParams(t);if(r.stream){let r;for await(let i of this._streamResponseChunks(e,t))i.message.response_metadata={...i.generationInfo,...i.message.response_metadata},r=r?.concat(i)??i;return{generations:r?[r]:[],llmOutput:{estimatedTokenUsage:r?.message?.usage_metadata}}}{let i=this._convertMessagesToResponsesParams(e),n=await this.completionWithRetry({input:i,...r,stream:!1},{signal:t?.signal,...t?.options});return{generations:[{text:n.output_text,message:this._convertResponsesMessageToBaseMessage(n)}],llmOutput:{id:n.id,estimatedTokenUsage:n.usage?{promptTokens:n.usage.input_tokens,completionTokens:n.usage.output_tokens,totalTokens:n.usage.total_tokens}:void 0}}}}async *_streamResponseChunks(e,t,r){for await(let i of(await this.completionWithRetry({...this.invocationParams(t),input:this._convertMessagesToResponsesParams(e),stream:!0},t))){let e=this._convertResponsesDeltaToBaseMessageChunk(i);null!=e&&(yield e,await r?.handleLLMNewToken(e.text||"",{prompt:t.promptIndex??0,completion:0},void 0,void 0,void 0,{chunk:e}))}}async completionWithRetry(e,t){return this.caller.call(async()=>{let r=this._getClientOptions(t);try{if(e.text?.format?.type==="json_schema"&&!e.stream)return await this.client.responses.parse(e,r);return await this.client.responses.create(e,r)}catch(e){throw vM(e)}})}_convertResponsesMessageToBaseMessage(e){let t;if(e.error){let t=Error(e.error.message);throw t.name=e.error.code,t}let r=[],i=[],n=[],a={model:e.model,created_at:e.created_at,id:e.id,incomplete_details:e.incomplete_details,metadata:e.metadata,object:e.object,status:e.status,user:e.user,service_tier:e.service_tier,model_name:e.model},s={};for(let a of e.output)if("message"===a.type)t=a.id,r.push(...a.content.flatMap(e=>"output_text"===e.type?("parsed"in e&&null!=e.parsed&&(s.parsed=e.parsed),{type:"text",text:e.text,annotations:e.annotations}):"refusal"===e.type?(s.refusal=e.refusal,[]):e));else if("function_call"===a.type){let e={function:{name:a.name,arguments:a.arguments},id:a.call_id};try{i.push(vl(e,{returnId:!0}))}catch(r){let t;"object"==typeof r&&null!=r&&"message"in r&&"string"==typeof r.message&&(t=r.message),n.push(vc(e,t))}s[vH]??={},a.id&&(s[vH][a.call_id]=a.id)}else if("reasoning"===a.type)s.reasoning=a;else if("custom_tool_call"===a.type){let e=function(e){if("custom_tool_call"===e.type)return{...e,type:"tool_call",call_id:e.id,id:e.call_id,name:e.name,isCustomTool:!0,args:{input:e.input}}}(a);e?i.push(e):n.push(vc(a,"Malformed custom tool call"))}else s.tool_outputs??=[],s.tool_outputs.push(a);return new nJ({id:t,content:r,tool_calls:i,invalid_tool_calls:n,usage_metadata:e.usage,additional_kwargs:s,response_metadata:a})}_convertResponsesDeltaToBaseMessageChunk(e){let t,r,i=[],n={},a=[],s={},o={};if("response.output_text.delta"===e.type)i.push({type:"text",text:e.delta,index:e.content_index});else if("response.output_text.annotation.added"===e.type)i.push({type:"text",text:"",annotations:[e.annotation],index:e.content_index});else if("response.output_item.added"===e.type&&"message"===e.item.type)r=e.item.id;else if("response.output_item.added"===e.type&&"function_call"===e.item.type)a.push({type:"tool_call_chunk",name:e.item.name,args:e.item.arguments,id:e.item.call_id,index:e.output_index}),o[vH]={[e.item.call_id]:e.item.id};else if("response.output_item.done"===e.type&&["web_search_call","file_search_call","computer_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call","custom_tool_call"].includes(e.item.type))o.tool_outputs=[e.item];else if("response.created"===e.type)s.id=e.response.id,s.model_name=e.response.model,s.model=e.response.model;else if("response.completed"===e.type){let r=this._convertResponsesMessageToBaseMessage(e.response);for(let[i,n]of(t=e.response.usage,e.response.text?.format?.type==="json_schema"&&(o.parsed??=JSON.parse(r.text)),Object.entries(e.response)))"id"!==i&&(s[i]=n)}else if("response.function_call_arguments.delta"===e.type||"response.custom_tool_call_input.delta"===e.type)a.push({type:"tool_call_chunk",args:e.delta,index:e.output_index});else if("response.web_search_call.completed"===e.type||"response.file_search_call.completed"===e.type)n={tool_outputs:{id:e.item_id,type:e.type.replace("response.","").replace(".completed",""),status:"completed"}};else if("response.refusal.done"===e.type)o.refusal=e.refusal;else if("response.output_item.added"===e.type&&"item"in e&&"reasoning"===e.item.type){let t=e.item.summary?e.item.summary.map((e,t)=>({...e,index:t})):void 0;o.reasoning={id:e.item.id,type:e.item.type,...t?{summary:t}:{}}}else if("response.reasoning_summary_part.added"===e.type)o.reasoning={type:"reasoning",summary:[{...e.part,index:e.summary_index}]};else if("response.reasoning_summary_text.delta"===e.type)o.reasoning={type:"reasoning",summary:[{text:e.delta,type:"summary_text",index:e.summary_index}]};else if("response.image_generation_call.partial_image"===e.type)return null;else return null;return new ol({text:i.map(e=>e.text).join(""),message:new nX({id:r,content:i,tool_call_chunks:a,usage_metadata:t,additional_kwargs:o,response_metadata:s}),generationInfo:n})}_convertMessagesToResponsesParams(e){return e.flatMap(e=>{let t=e.additional_kwargs,r=vW(e);if("system"===r&&vq(this.model)&&(r="developer"),"function"===r)throw Error("Function messages are not supported in Responses API");if("tool"===r)return t?.type==="computer_call_output"?{type:"computer_call_output",output:(()=>{if("string"==typeof e.content)return{type:"computer_screenshot",image_url:e.content};if(Array.isArray(e.content)){let t=e.content.find(e=>"computer_screenshot"===e.type);if(t)return t;let r=e.content.find(e=>"image_url"===e.type);if(r)return{type:"computer_screenshot",image_url:"string"==typeof r.image_url?r.image_url:r.image_url.url}}throw Error("Invalid computer call output")})(),call_id:e.tool_call_id}:e.metadata?.customTool?{type:"custom_tool_call_output",call_id:e.tool_call_id,output:e.content}:{type:"function_call_output",call_id:e.tool_call_id,id:e.id?.startsWith("fc_")?e.id:void 0,output:"string"!=typeof e.content?JSON.stringify(e.content):e.content};if("assistant"===r){if(!this.zdrEnabled&&null!=e.response_metadata.output&&Array.isArray(e.response_metadata.output)&&e.response_metadata.output.length>0&&e.response_metadata.output.every(e=>"type"in e))return e.response_metadata.output;let r=[];if(t?.reasoning&&!this.zdrEnabled){let e=this._convertReasoningSummary(t.reasoning);r.push(e)}let{content:i}=e;t?.refusal&&("string"==typeof i&&(i=[{type:"output_text",text:i,annotations:[]}]),i=[...i,{type:"refusal",refusal:t.refusal}]),("string"==typeof i||i.length>0)&&r.push({type:"message",role:"assistant",...e.id&&!this.zdrEnabled&&e.id.startsWith("msg_")?{id:e.id}:{},content:"string"==typeof i?i:i.flatMap(e=>"text"===e.type?{type:"output_text",text:e.text,annotations:e.annotations??[]}:"output_text"===e.type||"refusal"===e.type?e:[])});let n=t?.[vH];nV(e)&&e.tool_calls?.length?r.push(...e.tool_calls.map(e=>"tool_call"===e.type&&"isCustomTool"in e&&!0===e.isCustomTool?{type:"custom_tool_call",id:e.call_id,call_id:e.id??"",input:e.args.input,name:e.name}:{type:"function_call",name:e.name,arguments:JSON.stringify(e.args),call_id:e.id,...this.zdrEnabled?{id:n?.[e.id]}:{}})):t?.tool_calls&&r.push(...t.tool_calls.map(e=>({type:"function_call",name:e.function.name,call_id:e.id,arguments:e.function.arguments,...this.zdrEnabled?{id:n?.[e.id]}:{}})));let a=e.response_metadata.output?.length?e.response_metadata.output:t.tool_outputs,s=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(null!=a){let e=a?.filter(e=>s.includes(e.type));e.length>0&&r.push(...e)}return r}if("user"===r||"system"===r||"developer"===r){if("string"==typeof e.content)return{type:"message",role:r,content:e.content};let t=[],i=e.content.flatMap(e=>("mcp_approval_response"===e.type&&t.push({type:"mcp_approval_response",approval_request_id:e.approval_request_id,approve:e.approve}),iR(e))?iB(e,vK):"text"===e.type?{type:"input_text",text:e.text}:"image_url"===e.type?{type:"input_image",image_url:"string"==typeof e.image_url?e.image_url:e.image_url.url,detail:"string"==typeof e.image_url?"auto":e.image_url.detail}:"input_text"===e.type||"input_image"===e.type||"input_file"===e.type?e:[]);return i.length>0&&t.push({type:"message",role:r,content:i}),t}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${r}`),[]})}_convertReasoningSummary(e){let t=(e.summary.length>1?e.summary.reduce((e,t)=>{let r=e.at(-1);return r.index===t.index?r.text+=t.text:e.push(t),e},[{...e.summary[0]}]):e.summary).map(e=>Object.fromEntries(Object.entries(e).filter(([e])=>"index"!==e)));return{...e,summary:t}}_reduceChatOpenAITools(e,t){let r=[];for(let i of e)vZ(i)?("image_generation"===i.type&&t?.stream&&(i.partial_images=1),r.push(i)):mT(i)?r.push({type:"function",name:i.function.name,parameters:i.function.parameters,description:i.function.description,strict:t?.strict??null}):vG(i)&&r.push(function(e){return{type:"custom",name:e.custom.name,description:e.custom.description,format:(()=>{if(e.custom.format){if("grammar"===e.custom.format.type)return{type:"grammar",definition:e.custom.format.grammar.definition,syntax:e.custom.format.grammar.syntax};if("text"===e.custom.format.type)return{type:"text"}}})()}}(i));return r}}class vX extends vV{invocationParams(e,t){let r;e?.strict!==void 0?r=e.strict:void 0!==this.supportsStrictToolCalling&&(r=this.supportsStrictToolCalling);let i={};e?.stream_options!==void 0?i={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t?.streaming)&&(i={stream_options:{include_usage:!0}});let n={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:e?.tools?.length?e.tools.map(e=>this._convertChatOpenAIToolToCompletionsTool(e,{strict:r})):void 0,tool_choice:vz(e?.tool_choice),response_format:this._getResponseFormat(e?.response_format),seed:e?.seed,...i,parallel_tool_calls:e?.parallel_tool_calls,...this.audio||e?.audio?{audio:this.audio||e?.audio}:{},...this.modalities||e?.modalities?{modalities:this.modalities||e?.modalities}:{},...this.modelKwargs,prompt_cache_key:e?.promptCacheKey??this.promptCacheKey,verbosity:e?.verbosity??this.verbosity};e?.prediction!==void 0&&(n.prediction=e.prediction),void 0!==this.service_tier&&(n.service_tier=this.service_tier),e?.service_tier!==void 0&&(n.service_tier=e.service_tier);let a=this._getReasoningParams(e);return void 0!==a&&void 0!==a.effort&&(n.reasoning_effort=a.effort),vq(n.model)?n.max_completion_tokens=-1===this.maxTokens?void 0:this.maxTokens:n.max_tokens=-1===this.maxTokens?void 0:this.maxTokens,n}async _generate(e,t,r){let i={},n=this.invocationParams(t),a=vJ(e,this.model);if(n.stream){let n=this._streamResponseChunks(e,t,r),a={};for await(let e of n){e.message.response_metadata={...e.generationInfo,...e.message.response_metadata};let t=e.generationInfo?.completion??0;void 0===a[t]?a[t]=e:a[t]=a[t].concat(e)}let s=Object.entries(a).sort(([e],[t])=>parseInt(e,10)-parseInt(t,10)).map(([e,t])=>t),{functions:o,function_call:l}=this.invocationParams(t),u=await this._getEstimatedTokenCountFromPrompt(e,o,l),c=await this._getNumTokensFromGenerations(s);return i.input_tokens=u,i.output_tokens=c,i.total_tokens=u+c,{generations:s,llmOutput:{estimatedTokenUsage:{promptTokens:i.input_tokens,completionTokens:i.output_tokens,totalTokens:i.total_tokens}}}}{let e=await this.completionWithRetry({...n,stream:!1,messages:a},{signal:t?.signal,...t?.options}),{completion_tokens:r,prompt_tokens:s,total_tokens:o,prompt_tokens_details:l,completion_tokens_details:u}=e?.usage??{};r&&(i.output_tokens=(i.output_tokens??0)+r),s&&(i.input_tokens=(i.input_tokens??0)+s),o&&(i.total_tokens=(i.total_tokens??0)+o),(l?.audio_tokens!==null||l?.cached_tokens!==null)&&(i.input_token_details={...l?.audio_tokens!==null&&{audio:l?.audio_tokens},...l?.cached_tokens!==null&&{cache_read:l?.cached_tokens}}),(u?.audio_tokens!==null||u?.reasoning_tokens!==null)&&(i.output_token_details={...u?.audio_tokens!==null&&{audio:u?.audio_tokens},...u?.reasoning_tokens!==null&&{reasoning:u?.reasoning_tokens}});let c=[];for(let t of e?.choices??[]){let r={text:t.message?.content??"",message:this._convertCompletionsMessageToBaseMessage(t.message??{role:"assistant"},e)};r.generationInfo={...t.finish_reason?{finish_reason:t.finish_reason}:{},...t.logprobs?{logprobs:t.logprobs}:{}},nV(r.message)&&(r.message.usage_metadata=i),r.message=new nJ(Object.fromEntries(Object.entries(r.message).filter(([e])=>!e.startsWith("lc_")))),c.push(r)}return{generations:c,llmOutput:{tokenUsage:{promptTokens:i.input_tokens,completionTokens:i.output_tokens,totalTokens:i.total_tokens}}}}}async *_streamResponseChunks(e,t,r){let i,n,a=vJ(e,this.model),s={...this.invocationParams(t,{streaming:!0}),messages:a,stream:!0};for await(let e of(await this.completionWithRetry(s,t))){let a=e?.choices?.[0];if(e.usage&&(n=e.usage),!a)continue;let{delta:s}=a;if(!s)continue;let o=this._convertCompletionsDeltaToBaseMessageChunk(s,e,i);i=s.role??i;let l={prompt:t.promptIndex??0,completion:a.index??0};if("string"!=typeof o.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let u={...l};null!=a.finish_reason&&(u.finish_reason=a.finish_reason,u.system_fingerprint=e.system_fingerprint,u.model_name=e.model,u.service_tier=e.service_tier),this.logprobs&&(u.logprobs=a.logprobs);let c=new ol({message:o,text:o.content,generationInfo:u});yield c,await r?.handleLLMNewToken(c.text??"",l,void 0,void 0,void 0,{chunk:c})}if(n){let e={...n.prompt_tokens_details?.audio_tokens!==null&&{audio:n.prompt_tokens_details?.audio_tokens},...n.prompt_tokens_details?.cached_tokens!==null&&{cache_read:n.prompt_tokens_details?.cached_tokens}},t={...n.completion_tokens_details?.audio_tokens!==null&&{audio:n.completion_tokens_details?.audio_tokens},...n.completion_tokens_details?.reasoning_tokens!==null&&{reasoning:n.completion_tokens_details?.reasoning_tokens}},r=new ol({message:new nX({content:"",response_metadata:{usage:{...n}},usage_metadata:{input_tokens:n.prompt_tokens,output_tokens:n.completion_tokens,total_tokens:n.total_tokens,...Object.keys(e).length>0&&{input_token_details:e},...Object.keys(t).length>0&&{output_token_details:t}}}),text:""});yield r}if(t.signal?.aborted)throw Error("AbortError")}async completionWithRetry(e,t){let r=this._getClientOptions(t),i=e.response_format&&"json_schema"===e.response_format.type;return this.caller.call(async()=>{try{if(i&&!e.stream)return await this.client.chat.completions.parse(e,r);return await this.client.chat.completions.create(e,r)}catch(e){throw vM(e)}})}_convertCompletionsMessageToBaseMessage(e,t){let r=e.tool_calls;if("assistant"!==e.role)return new nS(e.content||"",e.role??"unknown");{var i,n;let a=[],s=[];for(let e of r??[])try{a.push(vl(e,{returnId:!0}))}catch(t){s.push(vc(e,t.message))}let o={function_call:e.function_call,tool_calls:r};void 0!==this.__includeRawResponse&&(o.__raw_response=t);let l={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(o.audio=e.audio),new nJ({content:(i=e.content||"",(n=t.choices?.[0]?.message)&&"object"==typeof n&&"images"in n&&Array.isArray(n.images)?[{type:"text",text:i,source_type:"text"},...n.images.filter(e=>"string"==typeof e?.image_url?.url).map(e=>({type:"image",url:e.image_url.url,source_type:"url"}))]:i),tool_calls:a,invalid_tool_calls:s,additional_kwargs:o,response_metadata:l,id:t.id})}}_convertCompletionsDeltaToBaseMessageChunk(e,t,r){let i,n=e.role??r,a=e.content??"";i=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},this.__includeRawResponse&&(i.__raw_response=t),e.audio&&(i.audio={...e.audio,index:t.choices[0].index});let s={usage:{...t.usage}};if("user"===n)return new nP({content:a,response_metadata:s});if("assistant"===n){let r=[];if(Array.isArray(e.tool_calls))for(let t of e.tool_calls)r.push({name:t.function?.name,args:t.function?.arguments,id:t.id,index:t.index,type:"tool_call_chunk"});return new nX({content:a,tool_call_chunks:r,additional_kwargs:i,id:t.id,response_metadata:s})}if("system"===n)return new nD({content:a,response_metadata:s});if("developer"===n)return new nD({content:a,response_metadata:s,additional_kwargs:{__openai_role__:"developer"}});if("function"===n)return new nx({content:a,additional_kwargs:i,name:e.name,response_metadata:s});else if("tool"===n)return new nm({content:a,additional_kwargs:i,tool_call_id:e.tool_call_id,response_metadata:s});else return new nI({content:a,role:n,response_metadata:s})}}class vQ extends vV{get lc_serializable_keys(){return[...super.lc_serializable_keys,"useResponsesApi"]}constructor(e){super(e),Object.defineProperty(this,"fields",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"completions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.useResponsesApi=e?.useResponsesApi??!1,this.responses=e?.responses??new vY(e),this.completions=e?.completions??new vX(e)}_useResponsesApi(e){let t=e?.tools?.some(vZ),r=e?.previous_response_id!=null||e?.text!=null||e?.truncation!=null||e?.include!=null||e?.reasoning?.summary!=null||this.reasoning?.summary!=null,i=e?.tools?.some(vG);return this.useResponsesApi||t||r||i}getLsParams(e){let t=this._combineCallOptions(e);return this._useResponsesApi(e)?this.responses.getLsParams(t):this.completions.getLsParams(t)}invocationParams(e){let t=this._combineCallOptions(e);return this._useResponsesApi(e)?this.responses.invocationParams(t):this.completions.invocationParams(t)}async _generate(e,t,r){return this._useResponsesApi(t)?this.responses._generate(e,t):this.completions._generate(e,t,r)}async *_streamResponseChunks(e,t,r){this._useResponsesApi(t)?yield*this.responses._streamResponseChunks(e,this._combineCallOptions(t),r):yield*this.completions._streamResponseChunks(e,this._combineCallOptions(t),r)}withConfig(e){let t=new vQ(this.fields);return t.defaultOptions={...this.defaultOptions,...e},t}}iI({},{BaseLLM:()=>v0,LLM:()=>v1});var v0=class e extends mO{lc_namespace=["langchain","llms",this._llmType()];async invoke(t,r){let i=e._convertInputToPromptValue(t);return(await this.generatePrompt([i],r,r?.callbacks)).generations[0][0].text}async *_streamResponseChunks(e,t,r){throw Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async *_streamIterator(t,r){if(this._streamResponseChunks===e.prototype._streamResponseChunks)yield this.invoke(t,r);else{let i=e._convertInputToPromptValue(t),[n,a]=this._separateRunnableConfigFromCallOptionsCompat(r),s=await sY.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),o={options:a,invocation_params:this?.invocationParams(a),batch_size:1},l=await s?.handleLLMStart(this.toJSON(),[i.toString()],n.runId,void 0,o,void 0,void 0,n.runName),u=new oo({text:""});try{for await(let e of this._streamResponseChunks(i.toString(),a,l?.[0]))u=u?u.concat(e):e,"string"==typeof e.text&&(yield e.text)}catch(e){throw await Promise.all((l??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((l??[]).map(e=>e?.handleLLMEnd({generations:[[u]]})))}}async generatePrompt(e,t,r){let i=e.map(e=>e.toString());return this.generate(i,t,r)}invocationParams(e){return{}}_flattenLLMResult(e){let t=[];for(let r=0;r<e.generations.length;r+=1){let i=e.generations[r];if(0===r)t.push({generations:[i],llmOutput:e.llmOutput});else{let r=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[i],llmOutput:r})}}return t}async _generateUncached(t,r,i,n){let a,s;if(void 0!==n&&n.length===t.length)a=n;else{let e=await sY.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),n={options:r,invocation_params:this?.invocationParams(r),batch_size:t.length};a=await e?.handleLLMStart(this.toJSON(),t,i.runId,void 0,n,void 0,void 0,i?.runName)}if(a?.[0].handlers.find(au)&&1===t.length&&this._streamResponseChunks!==e.prototype._streamResponseChunks)try{let e;for await(let i of(await this._streamResponseChunks(t[0],r,a?.[0])))e=void 0===e?i:oi(e,i);if(void 0===e)throw Error("Received empty response from chat model call.");s={generations:[[e]],llmOutput:{}},await a?.[0].handleLLMEnd(s)}catch(e){throw await a?.[0].handleLLMError(e),e}else{try{s=await this._generate(t,r,a?.[0])}catch(e){throw await Promise.all((a??[]).map(t=>t?.handleLLMError(e))),e}let e=this._flattenLLMResult(s);await Promise.all((a??[]).map((t,r)=>t?.handleLLMEnd(e[r])))}let o=a?.map(e=>e.runId)||void 0;return Object.defineProperty(s,os,{value:o?{runIds:o}:void 0,configurable:!0}),s}async _generateCached({prompts:e,cache:t,llmStringKey:r,parsedOptions:i,handledOptions:n,runId:a}){let s=await sY.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),o={options:i,invocation_params:this?.invocationParams(i),batch_size:e.length},l=await s?.handleLLMStart(this.toJSON(),e,a,void 0,o,void 0,void 0,n?.runName),u=[],c=(await Promise.allSettled(e.map(async(e,i)=>{let n=await t.lookup(e,r);return null==n&&u.push(i),n}))).map((e,t)=>({result:e,runManager:l?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),d=[];await Promise.all(c.map(async({result:e,runManager:t},r)=>{if("fulfilled"!==e.status)return await t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(e.reason);{let i=e.value;return d[r]=i.map(e=>(e.generationInfo={...e.generationInfo,tokenUsage:{}},e)),i.length&&await t?.handleLLMNewToken(i[0].text),t?.handleLLMEnd({generations:[i]},void 0,void 0,void 0,{cached:!0})}}));let h={generations:d,missingPromptIndices:u,startedRunManagers:l};return Object.defineProperty(h,os,{value:l?{runIds:l?.map(e=>e.runId)}:void 0,configurable:!0}),h}async generate(e,t,r){let i;if(!Array.isArray(e))throw Error("Argument 'prompts' is expected to be a string[]");i=Array.isArray(t)?{stop:t}:t;let[n,a]=this._separateRunnableConfigFromCallOptionsCompat(i);if(n.callbacks=n.callbacks??r,!this.cache)return this._generateUncached(e,a,n);let{cache:s}=this,o=this._getSerializedCacheKeyParametersForCall(a),{generations:l,missingPromptIndices:u,startedRunManagers:c}=await this._generateCached({prompts:e,cache:s,llmStringKey:o,parsedOptions:a,handledOptions:n,runId:n.runId}),d={};if(u.length>0){let t=await this._generateUncached(u.map(t=>e[t]),a,n,void 0!==c?u.map(e=>c?.[e]):void 0);await Promise.all(t.generations.map(async(t,r)=>{let i=u[r];return l[i]=t,s.update(e[i],o,t)})),d=t.llmOutput??{}}return{generations:l,llmOutput:d}}_identifyingParams(){return{}}_modelType(){return"base_llm"}},v1=class extends v0{async _generate(e,t,r){return{generations:await Promise.all(e.map((e,i)=>this._call(e,{...t,promptIndex:i},r).then(e=>[{text:e}])))}}};e.s(["ZodAny",()=>wc,"ZodArray",()=>wb,"ZodBase64",()=>bH,"ZodBase64URL",()=>bW,"ZodBigInt",()=>b7,"ZodBigIntFormat",()=>wt,"ZodBoolean",()=>b5,"ZodCIDRv4",()=>bF,"ZodCIDRv6",()=>bZ,"ZodCUID",()=>bA,"ZodCUID2",()=>bx,"ZodCatch",()=>Ee,"ZodCustom",()=>Ef,"ZodDate",()=>w_,"ZodDefault",()=>w4,"ZodDiscriminatedUnion",()=>wx,"ZodE164",()=>bJ,"ZodEmail",()=>bh,"ZodEmoji",()=>bT,"ZodEnum",()=>wB,"ZodFile",()=>wW,"ZodGUID",()=>bf,"ZodIPv4",()=>bL,"ZodIPv6",()=>bM,"ZodIntersection",()=>wC,"ZodJWT",()=>bY,"ZodKSUID",()=>bj,"ZodLazy",()=>Ec,"ZodLiteral",()=>wH,"ZodMap",()=>wD,"ZodNaN",()=>Er,"ZodNanoID",()=>bI,"ZodNever",()=>wf,"ZodNonOptional",()=>w3,"ZodNull",()=>wl,"ZodNullable",()=>wQ,"ZodNumber",()=>bQ,"ZodNumberFormat",()=>b1,"ZodObject",()=>wT,"ZodOptional",()=>wY,"ZodPipe",()=>En,"ZodPrefault",()=>w6,"ZodPromise",()=>Eh,"ZodReadonly",()=>Es,"ZodRecord",()=>wj,"ZodSet",()=>wz,"ZodString",()=>bu,"ZodStringFormat",()=>bd,"ZodSuccess",()=>w8,"ZodSymbol",()=>wn,"ZodTemplateLiteral",()=>El,"ZodTransform",()=>wJ,"ZodTuple",()=>wP,"ZodType",()=>bo,"ZodULID",()=>bC,"ZodURL",()=>bw,"ZodUUID",()=>bg,"ZodUndefined",()=>ws,"ZodUnion",()=>wA,"ZodUnknown",()=>wh,"ZodVoid",()=>wg,"ZodXID",()=>bP,"_ZodString",()=>bl,"_default",()=>w2,"any",()=>wd,"array",()=>ww,"base64",()=>bq,"base64url",()=>bK,"bigint",()=>we,"boolean",()=>b8,"catch",()=>Et,"check",()=>Em,"cidrv4",()=>bB,"cidrv6",()=>bG,"cuid",()=>bk,"cuid2",()=>b$,"custom",()=>Eg,"date",()=>wv,"discriminatedUnion",()=>w$,"e164",()=>bV,"email",()=>bp,"emoji",()=>bS,"enum",()=>wZ,"file",()=>wK,"float32",()=>b2,"float64",()=>b6,"guid",()=>bm,"instanceof",()=>Ev,"int",()=>b4,"int32",()=>b9,"int64",()=>wr,"intersection",()=>wN,"ipv4",()=>bD,"ipv6",()=>bz,"json",()=>Ew,"jwt",()=>bX,"keyof",()=>wE,"ksuid",()=>bU,"lazy",()=>Ed,"literal",()=>wq,"looseObject",()=>wO,"map",()=>wM,"nan",()=>Ei,"nanoid",()=>bO,"nativeEnum",()=>wG,"never",()=>wm,"nonoptional",()=>w5,"null",()=>wu,"nullable",()=>w0,"nullish",()=>w1,"number",()=>b0,"object",()=>wS,"optional",()=>wX,"partialRecord",()=>wL,"pipe",()=>Ea,"prefault",()=>w9,"preprocess",()=>EE,"promise",()=>Ep,"readonly",()=>Eo,"record",()=>wU,"refine",()=>Ey,"set",()=>wF,"strictObject",()=>wI,"string",()=>bc,"stringbool",()=>Eb,"success",()=>w7,"superRefine",()=>E_,"symbol",()=>wa,"templateLiteral",()=>Eu,"transform",()=>wV,"tuple",()=>wR,"uint32",()=>b3,"uint64",()=>wi,"ulid",()=>bN,"undefined",()=>wo,"union",()=>wk,"unknown",()=>wp,"url",()=>bE,"uuid",()=>by,"uuidv4",()=>b_,"uuidv6",()=>bv,"uuidv7",()=>bb,"void",()=>wy,"xid",()=>bR],45770);var hT=hT;e.s([],841213),e.s(["ZodISODate",()=>v6,"ZodISODateTime",()=>v4,"ZodISODuration",()=>v8,"ZodISOTime",()=>v3,"date",()=>v9,"datetime",()=>v2,"duration",()=>v7,"time",()=>v5],599290);let v4=ou("ZodISODateTime",(e,t)=>{uA.init(e,t),bd.init(e,t)});function v2(e){return de(v4,e)}let v6=ou("ZodISODate",(e,t)=>{uk.init(e,t),bd.init(e,t)});function v9(e){return dt(v6,e)}let v3=ou("ZodISOTime",(e,t)=>{ux.init(e,t),bd.init(e,t)});function v5(e){return dr(v3,e)}let v8=ou("ZodISODuration",(e,t)=>{u$.init(e,t),bd.init(e,t)});function v7(e){return di(v8,e)}let be=(e,t)=>{o7.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>lr(e,t)},flatten:{value:t=>lt(e,t)},addIssue:{value:t=>e.issues.push(t)},addIssues:{value:t=>e.issues.push(...t)},isEmpty:{get:()=>0===e.issues.length}})},bt=ou("ZodError",be),br=ou("ZodError",be,{Parent:Error});e.s(["ZodError",0,bt,"ZodRealError",0,br],122538);let bi=ls(br),bn=ll(br),ba=lc(br),bs=lh(br);e.s(["parse",0,bi,"parseAsync",0,bn,"safeParse",0,ba,"safeParseAsync",0,bs],655937);let bo=ou("ZodType",(e,t)=>(up.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone({...t,checks:[...t.checks??[],...r.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),e.clone=(t,r)=>oz(e,t,r),e.brand=()=>e,e.register=(t,r)=>(t.add(e,r),e),e.parse=(t,r)=>bi(e,t,r,{callee:e.parse}),e.safeParse=(t,r)=>ba(e,t,r),e.parseAsync=async(t,r)=>bn(e,t,r,{callee:e.parseAsync}),e.safeParseAsync=async(t,r)=>bs(e,t,r),e.spa=e.safeParseAsync,e.refine=(t,r)=>e.check(Ey(t,r)),e.superRefine=t=>e.check(E_(t)),e.overwrite=t=>e.check(dY(t)),e.optional=()=>wX(e),e.nullable=()=>w0(e),e.nullish=()=>wX(w0(e)),e.nonoptional=t=>w5(e,t),e.array=()=>ww(e),e.or=t=>wk([e,t]),e.and=t=>wN(e,t),e.transform=t=>Ea(e,wV(t)),e.default=t=>w2(e,t),e.prefault=t=>w9(e,t),e.catch=t=>Et(e,t),e.pipe=t=>Ea(e,t),e.readonly=()=>Eo(e),e.describe=t=>{let r=e.clone();return cD.add(r,{description:t}),r},Object.defineProperty(e,"description",{get:()=>cD.get(e)?.description,configurable:!0}),e.meta=(...t)=>{if(0===t.length)return cD.get(e);let r=e.clone();return cD.add(r,t[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),bl=ou("_ZodString",(e,t)=>{uf.init(e,t),bo.init(e,t);let r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...t)=>e.check(dZ(...t)),e.includes=(...t)=>e.check(dq(...t)),e.startsWith=(...t)=>e.check(dW(...t)),e.endsWith=(...t)=>e.check(dK(...t)),e.min=(...t)=>e.check(dF(...t)),e.max=(...t)=>e.check(dz(...t)),e.length=(...t)=>e.check(dB(...t)),e.nonempty=(...t)=>e.check(dF(1,...t)),e.lowercase=t=>e.check(dG(t)),e.uppercase=t=>e.check(dH(t)),e.trim=()=>e.check(dQ()),e.normalize=(...t)=>e.check(dX(...t)),e.toLowerCase=()=>e.check(d0()),e.toUpperCase=()=>e.check(d1())}),bu=ou("ZodString",(e,t)=>{uf.init(e,t),bl.init(e,t),e.email=t=>e.check(cF(bh,t)),e.url=t=>e.check(cW(bw,t)),e.jwt=t=>e.check(c8(bY,t)),e.emoji=t=>e.check(cK(bT,t)),e.guid=t=>e.check(cB(bf,t)),e.uuid=t=>e.check(cZ(bg,t)),e.uuidv4=t=>e.check(cG(bg,t)),e.uuidv6=t=>e.check(cH(bg,t)),e.uuidv7=t=>e.check(cq(bg,t)),e.nanoid=t=>e.check(cJ(bI,t)),e.guid=t=>e.check(cB(bf,t)),e.cuid=t=>e.check(cV(bA,t)),e.cuid2=t=>e.check(cY(bx,t)),e.ulid=t=>e.check(cX(bC,t)),e.base64=t=>e.check(c9(bH,t)),e.base64url=t=>e.check(c3(bW,t)),e.xid=t=>e.check(cQ(bP,t)),e.ksuid=t=>e.check(c0(bj,t)),e.ipv4=t=>e.check(c1(bL,t)),e.ipv6=t=>e.check(c4(bM,t)),e.cidrv4=t=>e.check(c2(bF,t)),e.cidrv6=t=>e.check(c6(bZ,t)),e.e164=t=>e.check(c5(bJ,t)),e.datetime=t=>e.check(v2(t)),e.date=t=>e.check(v9(t)),e.time=t=>e.check(v5(t)),e.duration=t=>e.check(v7(t))});function bc(e){return cM(bu,e)}let bd=ou("ZodStringFormat",(e,t)=>{um.init(e,t),bl.init(e,t)}),bh=ou("ZodEmail",(e,t)=>{u_.init(e,t),bd.init(e,t)});function bp(e){return cF(bh,e)}let bf=ou("ZodGUID",(e,t)=>{ug.init(e,t),bd.init(e,t)});function bm(e){return cB(bf,e)}let bg=ou("ZodUUID",(e,t)=>{uy.init(e,t),bd.init(e,t)});function by(e){return cZ(bg,e)}function b_(e){return cG(bg,e)}function bv(e){return cH(bg,e)}function bb(e){return cq(bg,e)}let bw=ou("ZodURL",(e,t)=>{uv.init(e,t),bd.init(e,t)});function bE(e){return cW(bw,e)}let bT=ou("ZodEmoji",(e,t)=>{ub.init(e,t),bd.init(e,t)});function bS(e){return cK(bT,e)}let bI=ou("ZodNanoID",(e,t)=>{uw.init(e,t),bd.init(e,t)});function bO(e){return cJ(bI,e)}let bA=ou("ZodCUID",(e,t)=>{uE.init(e,t),bd.init(e,t)});function bk(e){return cV(bA,e)}let bx=ou("ZodCUID2",(e,t)=>{uT.init(e,t),bd.init(e,t)});function b$(e){return cY(bx,e)}let bC=ou("ZodULID",(e,t)=>{uS.init(e,t),bd.init(e,t)});function bN(e){return cX(bC,e)}let bP=ou("ZodXID",(e,t)=>{uI.init(e,t),bd.init(e,t)});function bR(e){return cQ(bP,e)}let bj=ou("ZodKSUID",(e,t)=>{uO.init(e,t),bd.init(e,t)});function bU(e){return c0(bj,e)}let bL=ou("ZodIPv4",(e,t)=>{uC.init(e,t),bd.init(e,t)});function bD(e){return c1(bL,e)}let bM=ou("ZodIPv6",(e,t)=>{uN.init(e,t),bd.init(e,t)});function bz(e){return c4(bM,e)}let bF=ou("ZodCIDRv4",(e,t)=>{uP.init(e,t),bd.init(e,t)});function bB(e){return c2(bF,e)}let bZ=ou("ZodCIDRv6",(e,t)=>{uR.init(e,t),bd.init(e,t)});function bG(e){return c6(bZ,e)}let bH=ou("ZodBase64",(e,t)=>{uU.init(e,t),bd.init(e,t)});function bq(e){return c9(bH,e)}let bW=ou("ZodBase64URL",(e,t)=>{uD.init(e,t),bd.init(e,t)});function bK(e){return c3(bW,e)}let bJ=ou("ZodE164",(e,t)=>{uM.init(e,t),bd.init(e,t)});function bV(e){return c5(bJ,e)}let bY=ou("ZodJWT",(e,t)=>{uF.init(e,t),bd.init(e,t)});function bX(e){return c8(bY,e)}let bQ=ou("ZodNumber",(e,t)=>{uB.init(e,t),bo.init(e,t),e.gt=(t,r)=>e.check(d$(t,r)),e.gte=(t,r)=>e.check(dC(t,r)),e.min=(t,r)=>e.check(dC(t,r)),e.lt=(t,r)=>e.check(dk(t,r)),e.lte=(t,r)=>e.check(dx(t,r)),e.max=(t,r)=>e.check(dx(t,r)),e.int=t=>e.check(b4(t)),e.safe=t=>e.check(b4(t)),e.positive=t=>e.check(d$(0,t)),e.nonnegative=t=>e.check(dC(0,t)),e.negative=t=>e.check(dk(0,t)),e.nonpositive=t=>e.check(dx(0,t)),e.multipleOf=(t,r)=>e.check(dU(t,r)),e.step=(t,r)=>e.check(dU(t,r)),e.finite=()=>e;let r=e._zod.bag;e.minValue=Math.max(r.minimum??-1/0,r.exclusiveMinimum??-1/0)??null,e.maxValue=Math.min(r.maximum??1/0,r.exclusiveMaximum??1/0)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function b0(e){return dn(bQ,e)}let b1=ou("ZodNumberFormat",(e,t)=>{uZ.init(e,t),bQ.init(e,t)});function b4(e){return ds(b1,e)}function b2(e){return dl(b1,e)}function b6(e){return du(b1,e)}function b9(e){return dc(b1,e)}function b3(e){return dd(b1,e)}let b5=ou("ZodBoolean",(e,t)=>{uG.init(e,t),bo.init(e,t)});function b8(e){return dh(b5,e)}let b7=ou("ZodBigInt",(e,t)=>{uH.init(e,t),bo.init(e,t),e.gte=(t,r)=>e.check(dC(t,r)),e.min=(t,r)=>e.check(dC(t,r)),e.gt=(t,r)=>e.check(d$(t,r)),e.gte=(t,r)=>e.check(dC(t,r)),e.min=(t,r)=>e.check(dC(t,r)),e.lt=(t,r)=>e.check(dk(t,r)),e.lte=(t,r)=>e.check(dx(t,r)),e.max=(t,r)=>e.check(dx(t,r)),e.positive=t=>e.check(d$(BigInt(0),t)),e.negative=t=>e.check(dk(BigInt(0),t)),e.nonpositive=t=>e.check(dx(BigInt(0),t)),e.nonnegative=t=>e.check(dC(BigInt(0),t)),e.multipleOf=(t,r)=>e.check(dU(t,r));let r=e._zod.bag;e.minValue=r.minimum??null,e.maxValue=r.maximum??null,e.format=r.format??null});function we(e){return df(b7,e)}let wt=ou("ZodBigIntFormat",(e,t)=>{uq.init(e,t),b7.init(e,t)});function wr(e){return dg(wt,e)}function wi(e){return dy(wt,e)}let wn=ou("ZodSymbol",(e,t)=>{uW.init(e,t),bo.init(e,t)});function wa(e){return d_(wn,e)}let ws=ou("ZodUndefined",(e,t)=>{uK.init(e,t),bo.init(e,t)});function wo(e){return dv(ws,e)}let wl=ou("ZodNull",(e,t)=>{uJ.init(e,t),bo.init(e,t)});function wu(e){return db(wl,e)}let wc=ou("ZodAny",(e,t)=>{uV.init(e,t),bo.init(e,t)});function wd(){return dw(wc)}let wh=ou("ZodUnknown",(e,t)=>{uY.init(e,t),bo.init(e,t)});function wp(){return dE(wh)}let wf=ou("ZodNever",(e,t)=>{uX.init(e,t),bo.init(e,t)});function wm(e){return dT(wf,e)}let wg=ou("ZodVoid",(e,t)=>{uQ.init(e,t),bo.init(e,t)});function wy(e){return dS(wg,e)}let w_=ou("ZodDate",(e,t)=>{u0.init(e,t),bo.init(e,t),e.min=(t,r)=>e.check(dC(t,r)),e.max=(t,r)=>e.check(dx(t,r));let r=e._zod.bag;e.minDate=r.minimum?new Date(r.minimum):null,e.maxDate=r.maximum?new Date(r.maximum):null});function wv(e){return dI(w_,e)}let wb=ou("ZodArray",(e,t)=>{u4.init(e,t),bo.init(e,t),e.element=t.element,e.min=(t,r)=>e.check(dF(t,r)),e.nonempty=t=>e.check(dF(1,t)),e.max=(t,r)=>e.check(dz(t,r)),e.length=(t,r)=>e.check(dB(t,r)),e.unwrap=()=>e.element});function ww(e,t){return d4(wb,e,t)}function wE(e){return wq(Object.keys(e._zod.def.shape))}let wT=ou("ZodObject",(e,t)=>{u9.init(e,t),bo.init(e,t),hT.defineLazy(e,"shape",()=>t.shape),e.keyof=()=>wZ(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:wp()}),e.loose=()=>e.clone({...e._zod.def,catchall:wp()}),e.strict=()=>e.clone({...e._zod.def,catchall:wm()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>hT.extend(e,t),e.merge=t=>hT.merge(e,t),e.pick=t=>hT.pick(e,t),e.omit=t=>hT.omit(e,t),e.partial=(...t)=>hT.partial(wY,e,t[0]),e.required=(...t)=>hT.required(w3,e,t[0])});function wS(e,t){return new wT({type:"object",get shape(){return hT.assignProp(this,"shape",{...e}),this.shape},...hT.normalizeParams(t)})}function wI(e,t){return new wT({type:"object",get shape(){return hT.assignProp(this,"shape",{...e}),this.shape},catchall:wm(),...hT.normalizeParams(t)})}function wO(e,t){return new wT({type:"object",get shape(){return hT.assignProp(this,"shape",{...e}),this.shape},catchall:wp(),...hT.normalizeParams(t)})}let wA=ou("ZodUnion",(e,t)=>{u5.init(e,t),bo.init(e,t),e.options=t.options});function wk(e,t){return new wA({type:"union",options:e,...hT.normalizeParams(t)})}let wx=ou("ZodDiscriminatedUnion",(e,t)=>{wA.init(e,t),u8.init(e,t)});function w$(e,t,r){return new wx({type:"union",options:t,discriminator:e,...hT.normalizeParams(r)})}let wC=ou("ZodIntersection",(e,t)=>{u7.init(e,t),bo.init(e,t)});function wN(e,t){return new wC({type:"intersection",left:e,right:t})}let wP=ou("ZodTuple",(e,t)=>{ct.init(e,t),bo.init(e,t),e.rest=t=>e.clone({...e._zod.def,rest:t})});function wR(e,t,r){let i=t instanceof up,n=i?r:t;return new wP({type:"tuple",items:e,rest:i?t:null,...hT.normalizeParams(n)})}let wj=ou("ZodRecord",(e,t)=>{ci.init(e,t),bo.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function wU(e,t,r){return new wj({type:"record",keyType:e,valueType:t,...hT.normalizeParams(r)})}function wL(e,t,r){return new wj({type:"record",keyType:wk([e,wm()]),valueType:t,...hT.normalizeParams(r)})}let wD=ou("ZodMap",(e,t)=>{cn.init(e,t),bo.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function wM(e,t,r){return new wD({type:"map",keyType:e,valueType:t,...hT.normalizeParams(r)})}let wz=ou("ZodSet",(e,t)=>{cs.init(e,t),bo.init(e,t),e.min=(...t)=>e.check(dD(...t)),e.nonempty=t=>e.check(dD(1,t)),e.max=(...t)=>e.check(dL(...t)),e.size=(...t)=>e.check(dM(...t))});function wF(e,t){return new wz({type:"set",valueType:e,...hT.normalizeParams(t)})}let wB=ou("ZodEnum",(e,t)=>{cl.init(e,t),bo.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);let r=new Set(Object.keys(t.entries));e.extract=(e,i)=>{let n={};for(let i of e)if(r.has(i))n[i]=t.entries[i];else throw Error(`Key ${i} not found in enum`);return new wB({...t,checks:[],...hT.normalizeParams(i),entries:n})},e.exclude=(e,i)=>{let n={...t.entries};for(let t of e)if(r.has(t))delete n[t];else throw Error(`Key ${t} not found in enum`);return new wB({...t,checks:[],...hT.normalizeParams(i),entries:n})}});function wZ(e,t){return new wB({type:"enum",entries:Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e,...hT.normalizeParams(t)})}function wG(e,t){return new wB({type:"enum",entries:e,...hT.normalizeParams(t)})}let wH=ou("ZodLiteral",(e,t)=>{cu.init(e,t),bo.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function wq(e,t){return new wH({type:"literal",values:Array.isArray(e)?e:[e],...hT.normalizeParams(t)})}let wW=ou("ZodFile",(e,t)=>{cc.init(e,t),bo.init(e,t),e.min=(t,r)=>e.check(dD(t,r)),e.max=(t,r)=>e.check(dL(t,r)),e.mime=(t,r)=>e.check(dV(Array.isArray(t)?t:[t],r))});function wK(e){return hi(wW,e)}let wJ=ou("ZodTransform",(e,t)=>{cd.init(e,t),bo.init(e,t),e._zod.parse=(r,i)=>{r.addIssue=i=>{"string"==typeof i?r.issues.push(hT.issue(i,r.value,t)):(i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=e),i.continue??(i.continue=!0),r.issues.push(hT.issue(i)))};let n=t.transform(r.value,r);return n instanceof Promise?n.then(e=>(r.value=e,r)):(r.value=n,r)}});function wV(e){return new wJ({type:"transform",transform:e})}let wY=ou("ZodOptional",(e,t)=>{ch.init(e,t),bo.init(e,t),e.unwrap=()=>e._zod.def.innerType});function wX(e){return new wY({type:"optional",innerType:e})}let wQ=ou("ZodNullable",(e,t)=>{cp.init(e,t),bo.init(e,t),e.unwrap=()=>e._zod.def.innerType});function w0(e){return new wQ({type:"nullable",innerType:e})}function w1(e){return wX(w0(e))}let w4=ou("ZodDefault",(e,t)=>{cf.init(e,t),bo.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function w2(e,t){return new w4({type:"default",innerType:e,get defaultValue(){return"function"==typeof t?t():t}})}let w6=ou("ZodPrefault",(e,t)=>{cg.init(e,t),bo.init(e,t),e.unwrap=()=>e._zod.def.innerType});function w9(e,t){return new w6({type:"prefault",innerType:e,get defaultValue(){return"function"==typeof t?t():t}})}let w3=ou("ZodNonOptional",(e,t)=>{cy.init(e,t),bo.init(e,t),e.unwrap=()=>e._zod.def.innerType});function w5(e,t){return new w3({type:"nonoptional",innerType:e,...hT.normalizeParams(t)})}let w8=ou("ZodSuccess",(e,t)=>{cv.init(e,t),bo.init(e,t),e.unwrap=()=>e._zod.def.innerType});function w7(e){return new w8({type:"success",innerType:e})}let Ee=ou("ZodCatch",(e,t)=>{cb.init(e,t),bo.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Et(e,t){return new Ee({type:"catch",innerType:e,catchValue:"function"==typeof t?t:()=>t})}let Er=ou("ZodNaN",(e,t)=>{cw.init(e,t),bo.init(e,t)});function Ei(e){return dA(Er,e)}let En=ou("ZodPipe",(e,t)=>{cE.init(e,t),bo.init(e,t),e.in=t.in,e.out=t.out});function Ea(e,t){return new En({type:"pipe",in:e,out:t})}let Es=ou("ZodReadonly",(e,t)=>{cS.init(e,t),bo.init(e,t)});function Eo(e){return new Es({type:"readonly",innerType:e})}let El=ou("ZodTemplateLiteral",(e,t)=>{cO.init(e,t),bo.init(e,t)});function Eu(e,t){return new El({type:"template_literal",parts:e,...hT.normalizeParams(t)})}let Ec=ou("ZodLazy",(e,t)=>{ck.init(e,t),bo.init(e,t),e.unwrap=()=>e._zod.def.getter()});function Ed(e){return new Ec({type:"lazy",getter:e})}let Eh=ou("ZodPromise",(e,t)=>{cA.init(e,t),bo.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Ep(e){return new Eh({type:"promise",innerType:e})}let Ef=ou("ZodCustom",(e,t)=>{cx.init(e,t),bo.init(e,t)});function Em(e,t){let r=new lY({check:"custom",...hT.normalizeParams(t)});return r._zod.check=e,r}function Eg(e,t){return hg(Ef,e??(()=>!0),t)}function Ey(e,t={}){return hy(Ef,e,t)}function E_(e,t){let r=Em(t=>(t.addIssue=e=>{"string"==typeof e?t.issues.push(hT.issue(e,t.value,r._zod.def)):(e.fatal&&(e.continue=!1),e.code??(e.code="custom"),e.input??(e.input=t.value),e.inst??(e.inst=r),e.continue??(e.continue=!r._zod.def.abort),t.issues.push(hT.issue(e)))},e(t.value,t)),t);return r}function Ev(e,t={error:`Input not instance of ${e.name}`}){let r=new Ef({type:"custom",check:"custom",fn:t=>t instanceof e,abort:!0,...hT.normalizeParams(t)});return r._zod.bag.Class=e,r}let Eb=(...e)=>h_({Pipe:En,Boolean:b5,String:bu,Transform:wJ},...e);function Ew(e){let t=Ed(()=>wk([bc(e),b0(),b8(),wu(),ww(t),wU(bc(),t)]));return t}function EE(e,t){return Ea(wV(e),t)}let ET={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"},ES=Object.freeze({status:"aborted"});function EI(e){op({customError:e})}function EO(){return op().customError}function EA(e){return cz(bu,e)}function Ek(e){return da(bQ,e)}function Ex(e){return dp(b5,e)}function E$(e){return dm(b7,e)}function EC(e){return dO(w_,e)}e.s(["NEVER",0,ES,"ZodIssueCode",0,ET,"getErrorMap",()=>EO,"setErrorMap",()=>EI],170787),e.s(["bigint",()=>E$,"boolean",()=>Ex,"date",()=>EC,"number",()=>Ek,"string",()=>EA],684822),op(cN()),e.s([],502274),e.i(502274),e.i(954957),e.i(779192),e.i(744213),e.i(545731),e.i(456701),e.i(727412),e.i(248380);var EN=hT,EP=e.i(916714);e.i(295314),e.s(["ar",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:" ",url:"",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:"  ISO",time:"  ISO",duration:"  ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:"   IPv4",cidrv6:"   IPv6",base64:"  base64-encoded",base64url:"  base64url-encoded",json_string:"   JSON",e164:"   E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`  :   ${r.expected}    ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`  :   ${oZ(r.values[0])}`;return`  :     : ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`   :    ${r.origin??""} ${t} ${r.maximum.toString()} ${i.unit??""}`;return`  :    ${r.origin??""} ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`  :   ${r.origin}   ${t} ${r.minimum.toString()} ${i.unit}`;return`  :   ${r.origin}   ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`  :     "${r.prefix}"`;if("ends_with"===r.format)return`  :     "${r.suffix}"`;if("includes"===r.format)return`  :    "${r.includes}"`;if("regex"===r.format)return`  :     ${r.pattern}`;return`${t[r.format]??r.format}  `;case"not_multiple_of":return`  :      ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""} ${r.keys.length>1?"":""}: ${ob(r.keys," ")}`;case"invalid_key":return`    ${r.origin}`;case"invalid_union":default:return"  ";case"invalid_element":return`    ${r.origin}`}})}},"az",0,function(){let e,t;return{localeError:(e={string:{unit:"simvol",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"element",verb:"olmaldr"},set:{unit:"element",verb:"olmaldr"}},t={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Yanl dyr: g\xf6zlniln ${r.expected}, daxil olan ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Yanl dyr: g\xf6zlniln ${oZ(r.values[0])}`;return`Yanl se\xe7im: aadaklardan biri olmaldr: ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`\xc7ox b\xf6y\xfck: g\xf6zlniln ${r.origin??"dyr"} ${t}${r.maximum.toString()} ${i.unit??"element"}`;return`\xc7ox b\xf6y\xfck: g\xf6zlniln ${r.origin??"dyr"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`\xc7ox ki\xe7ik: g\xf6zlniln ${r.origin} ${t}${r.minimum.toString()} ${i.unit}`;return`\xc7ox ki\xe7ik: g\xf6zlniln ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Yanl mtn: "${r.prefix}" il balamaldr`;if("ends_with"===r.format)return`Yanl mtn: "${r.suffix}" il bitmlidir`;if("includes"===r.format)return`Yanl mtn: "${r.includes}" daxil olmaldr`;if("regex"===r.format)return`Yanl mtn: ${r.pattern} ablonuna uyun olmaldr`;return`Yanl ${t[r.format]??r.format}`;case"not_multiple_of":return`Yanl dd: ${r.divisor} il b\xf6l\xfcn biln olmaldr`;case"unrecognized_keys":return`Tannmayan a\xe7ar${r.keys.length>1?"lar":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`${r.origin} daxilind yanl a\xe7ar`;case"invalid_union":return"Yanl dyr";case"invalid_element":return`${r.origin} daxilind yanl dyr`;default:return`Yanl dyr`}})}},"be",0,function(){let e,t;return{localeError:(e={string:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""}},t={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${oZ(r.values[0])}`;return` :    ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i){let e=cC(Number(r.maximum),i.unit.one,i.unit.few,i.unit.many);return` : ,  ${r.origin??""}  ${i.verb} ${t}${r.maximum.toString()} ${e}`}return` : ,  ${r.origin??""}   ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i){let e=cC(Number(r.minimum),i.unit.one,i.unit.few,i.unit.many);return` : ,  ${r.origin}  ${i.verb} ${t}${r.minimum.toString()} ${e}`}return` : ,  ${r.origin}   ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :    "${r.prefix}"`;if("ends_with"===r.format)return` :    "${r.suffix}"`;if("includes"===r.format)return` :   "${r.includes}"`;if("regex"===r.format)return` :    ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` :    ${r.divisor}`;case"unrecognized_keys":return` ${r.keys.length>1?"":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${r.origin}`;default:return` `}})}},"ca",0,function(){let e,t;return{localeError:(e={string:{unit:"carcters",verb:"contenir"},file:{unit:"bytes",verb:"contenir"},array:{unit:"elements",verb:"contenir"},set:{unit:"elements",verb:"contenir"}},t={regex:"entrada",email:"adrea electrnica",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i hora ISO",date:"data ISO",time:"hora ISO",duration:"durada ISO",ipv4:"adrea IPv4",ipv6:"adrea IPv6",cidrv4:"rang IPv4",cidrv6:"rang IPv6",base64:"cadena codificada en base64",base64url:"cadena codificada en base64url",json_string:"cadena JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},r=>{switch(r.code){case"invalid_type":return`Tipus inv\xe0lid: s'esperava ${r.expected}, s'ha rebut ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Valor inv\xe0lid: s'esperava ${oZ(r.values[0])}`;return`Opci\xf3 inv\xe0lida: s'esperava una de ${ob(r.values," o ")}`;case"too_big":{let t=r.inclusive?"com a mxim":"menys de",i=e[r.origin]??null;if(i)return`Massa gran: s'esperava que ${r.origin??"el valor"} contingu\xe9s ${t} ${r.maximum.toString()} ${i.unit??"elements"}`;return`Massa gran: s'esperava que ${r.origin??"el valor"} fos ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?"com a mnim":"ms de",i=e[r.origin]??null;if(i)return`Massa petit: s'esperava que ${r.origin} contingu\xe9s ${t} ${r.minimum.toString()} ${i.unit}`;return`Massa petit: s'esperava que ${r.origin} fos ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Format inv\xe0lid: ha de comen\xe7ar amb "${r.prefix}"`;if("ends_with"===r.format)return`Format inv\xe0lid: ha d'acabar amb "${r.suffix}"`;if("includes"===r.format)return`Format inv\xe0lid: ha d'incloure "${r.includes}"`;if("regex"===r.format)return`Format inv\xe0lid: ha de coincidir amb el patr\xf3 ${r.pattern}`;return`Format inv\xe0lid per a ${t[r.format]??r.format}`;case"not_multiple_of":return`N\xfamero inv\xe0lid: ha de ser m\xfaltiple de ${r.divisor}`;case"unrecognized_keys":return`Clau${r.keys.length>1?"s":""} no reconeguda${r.keys.length>1?"s":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`Clau inv\xe0lida a ${r.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Element inv\xe0lid a ${r.origin}`;default:return`Entrada inv\xe0lida`}})}},"cs",0,function(){let e,t;return{localeError:(e={string:{unit:"znak",verb:"mt"},file:{unit:"bajt",verb:"mt"},array:{unit:"prvk",verb:"mt"},set:{unit:"prvk",verb:"mt"}},t={regex:"regulrn vraz",email:"e-mailov adresa",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"datum a as ve formtu ISO",date:"datum ve formtu ISO",time:"as ve formtu ISO",duration:"doba trvn ISO",ipv4:"IPv4 adresa",ipv6:"IPv6 adresa",cidrv4:"rozsah IPv4",cidrv6:"rozsah IPv6",base64:"etzec zakdovan ve formtu base64",base64url:"etzec zakdovan ve formtu base64url",json_string:"etzec ve formtu JSON",e164:"slo E.164",jwt:"JWT",template_literal:"vstup"},r=>{switch(r.code){case"invalid_type":return`Neplatn\xfd vstup: oek\xe1v\xe1no ${r.expected}, obdreno ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"slo";case"string":return"etzec";case"boolean":return"boolean";case"bigint":return"bigint";case"function":return"funkce";case"symbol":return"symbol";case"undefined":return"undefined";case"object":if(Array.isArray(e))return"pole";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Neplatn\xfd vstup: oek\xe1v\xe1no ${oZ(r.values[0])}`;return`Neplatn\xe1 monost: oek\xe1v\xe1na jedna z hodnot ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Hodnota je p\xedli velk\xe1: ${r.origin??"hodnota"} mus\xed m\xedt ${t}${r.maximum.toString()} ${i.unit??"prvk"}`;return`Hodnota je p\xedli velk\xe1: ${r.origin??"hodnota"} mus\xed b\xfdt ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Hodnota je p\xedli mal\xe1: ${r.origin??"hodnota"} mus\xed m\xedt ${t}${r.minimum.toString()} ${i.unit??"prvk"}`;return`Hodnota je p\xedli mal\xe1: ${r.origin??"hodnota"} mus\xed b\xfdt ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Neplatn\xfd etzec: mus\xed za\xednat na "${r.prefix}"`;if("ends_with"===r.format)return`Neplatn\xfd etzec: mus\xed konit na "${r.suffix}"`;if("includes"===r.format)return`Neplatn\xfd etzec: mus\xed obsahovat "${r.includes}"`;if("regex"===r.format)return`Neplatn\xfd etzec: mus\xed odpov\xeddat vzoru ${r.pattern}`;return`Neplatn\xfd form\xe1t ${t[r.format]??r.format}`;case"not_multiple_of":return`Neplatn\xe9 \xedslo: mus\xed b\xfdt n\xe1sobkem ${r.divisor}`;case"unrecognized_keys":return`Nezn\xe1m\xe9 kl\xede: ${ob(r.keys,", ")}`;case"invalid_key":return`Neplatn\xfd kl\xed v ${r.origin}`;case"invalid_union":return"Neplatn vstup";case"invalid_element":return`Neplatn\xe1 hodnota v ${r.origin}`;default:return`Neplatn\xfd vstup`}})}},"de",0,function(){let e,t;return{localeError:(e={string:{unit:"Zeichen",verb:"zu haben"},file:{unit:"Bytes",verb:"zu haben"},array:{unit:"Elemente",verb:"zu haben"},set:{unit:"Elemente",verb:"zu haben"}},t={regex:"Eingabe",email:"E-Mail-Adresse",url:"URL",emoji:"Emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-Datum und -Uhrzeit",date:"ISO-Datum",time:"ISO-Uhrzeit",duration:"ISO-Dauer",ipv4:"IPv4-Adresse",ipv6:"IPv6-Adresse",cidrv4:"IPv4-Bereich",cidrv6:"IPv6-Bereich",base64:"Base64-codierter String",base64url:"Base64-URL-codierter String",json_string:"JSON-String",e164:"E.164-Nummer",jwt:"JWT",template_literal:"Eingabe"},r=>{switch(r.code){case"invalid_type":return`Ung\xfcltige Eingabe: erwartet ${r.expected}, erhalten ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"Zahl";case"object":if(Array.isArray(e))return"Array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ung\xfcltige Eingabe: erwartet ${oZ(r.values[0])}`;return`Ung\xfcltige Option: erwartet eine von ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Zu gro\xdf: erwartet, dass ${r.origin??"Wert"} ${t}${r.maximum.toString()} ${i.unit??"Elemente"} hat`;return`Zu gro\xdf: erwartet, dass ${r.origin??"Wert"} ${t}${r.maximum.toString()} ist`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Zu klein: erwartet, dass ${r.origin} ${t}${r.minimum.toString()} ${i.unit} hat`;return`Zu klein: erwartet, dass ${r.origin} ${t}${r.minimum.toString()} ist`}case"invalid_format":if("starts_with"===r.format)return`Ung\xfcltiger String: muss mit "${r.prefix}" beginnen`;if("ends_with"===r.format)return`Ung\xfcltiger String: muss mit "${r.suffix}" enden`;if("includes"===r.format)return`Ung\xfcltiger String: muss "${r.includes}" enthalten`;if("regex"===r.format)return`Ung\xfcltiger String: muss dem Muster ${r.pattern} entsprechen`;return`Ung\xfcltig: ${t[r.format]??r.format}`;case"not_multiple_of":return`Ung\xfcltige Zahl: muss ein Vielfaches von ${r.divisor} sein`;case"unrecognized_keys":return`${r.keys.length>1?"Unbekannte Schlssel":"Unbekannter Schlssel"}: ${ob(r.keys,", ")}`;case"invalid_key":return`Ung\xfcltiger Schl\xfcssel in ${r.origin}`;case"invalid_union":return"Ungltige Eingabe";case"invalid_element":return`Ung\xfcltiger Wert in ${r.origin}`;default:return`Ung\xfcltige Eingabe`}})}},"en",0,cN,"es",0,function(){let e,t;return{localeError:(e={string:{unit:"caracteres",verb:"tener"},file:{unit:"bytes",verb:"tener"},array:{unit:"elementos",verb:"tener"},set:{unit:"elementos",verb:"tener"}},t={regex:"entrada",email:"direccin de correo electrnico",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"fecha y hora ISO",date:"fecha ISO",time:"hora ISO",duration:"duracin ISO",ipv4:"direccin IPv4",ipv6:"direccin IPv6",cidrv4:"rango IPv4",cidrv6:"rango IPv6",base64:"cadena codificada en base64",base64url:"URL codificada en base64",json_string:"cadena JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},r=>{switch(r.code){case"invalid_type":return`Entrada inv\xe1lida: se esperaba ${r.expected}, recibido ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nmero";case"object":if(Array.isArray(e))return"arreglo";if(null===e)return"nulo";if(Object.getPrototypeOf(e)!==Object.prototype)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Entrada inv\xe1lida: se esperaba ${oZ(r.values[0])}`;return`Opci\xf3n inv\xe1lida: se esperaba una de ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Demasiado grande: se esperaba que ${r.origin??"valor"} tuviera ${t}${r.maximum.toString()} ${i.unit??"elementos"}`;return`Demasiado grande: se esperaba que ${r.origin??"valor"} fuera ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Demasiado peque\xf1o: se esperaba que ${r.origin} tuviera ${t}${r.minimum.toString()} ${i.unit}`;return`Demasiado peque\xf1o: se esperaba que ${r.origin} fuera ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Cadena inv\xe1lida: debe comenzar con "${r.prefix}"`;if("ends_with"===r.format)return`Cadena inv\xe1lida: debe terminar en "${r.suffix}"`;if("includes"===r.format)return`Cadena inv\xe1lida: debe incluir "${r.includes}"`;if("regex"===r.format)return`Cadena inv\xe1lida: debe coincidir con el patr\xf3n ${r.pattern}`;return`Inv\xe1lido ${t[r.format]??r.format}`;case"not_multiple_of":return`N\xfamero inv\xe1lido: debe ser m\xfaltiplo de ${r.divisor}`;case"unrecognized_keys":return`Llave${r.keys.length>1?"s":""} desconocida${r.keys.length>1?"s":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`Llave inv\xe1lida en ${r.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Valor inv\xe1lido en ${r.origin}`;default:return`Entrada inv\xe1lida`}})}},"fa",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ",date:" ",time:" ",duration:"  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected}  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}  `;case"invalid_value":if(1===r.values.length)return` :  ${oZ(r.values[0])} `;return` :    ${ob(r.values,"|")} `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""} `;return` : ${r.origin??""}  ${t}${r.maximum.toString()} `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ${r.origin}  ${t}${r.minimum.toString()} ${i.unit} `;return` : ${r.origin}  ${t}${r.minimum.toString()} `}case"invalid_format":if("starts_with"===r.format)return` :   "${r.prefix}"  `;if("ends_with"===r.format)return` :   "${r.suffix}"  `;if("includes"===r.format)return` :   "${r.includes}" `;if("regex"===r.format)return` :    ${r.pattern}   `;return`${t[r.format]??r.format} `;case"not_multiple_of":return` :   ${r.divisor} `;case"unrecognized_keys":return`${r.keys.length>1?"":""} : ${ob(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":default:return` `;case"invalid_element":return`   ${r.origin}`}})}},"fi",0,function(){let e,t;return{localeError:(e={string:{unit:"merkki",subject:"merkkijonon"},file:{unit:"tavua",subject:"tiedoston"},array:{unit:"alkiota",subject:"listan"},set:{unit:"alkiota",subject:"joukon"},number:{unit:"",subject:"luvun"},bigint:{unit:"",subject:"suuren kokonaisluvun"},int:{unit:"",subject:"kokonaisluvun"},date:{unit:"",subject:"pivmrn"}},t={regex:"snnllinen lauseke",email:"shkpostiosoite",url:"URL-osoite",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-aikaleima",date:"ISO-pivmr",time:"ISO-aika",duration:"ISO-kesto",ipv4:"IPv4-osoite",ipv6:"IPv6-osoite",cidrv4:"IPv4-alue",cidrv6:"IPv6-alue",base64:"base64-koodattu merkkijono",base64url:"base64url-koodattu merkkijono",json_string:"JSON-merkkijono",e164:"E.164-luku",jwt:"JWT",template_literal:"templaattimerkkijono"},r=>{switch(r.code){case"invalid_type":return`Virheellinen tyyppi: odotettiin ${r.expected}, oli ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Virheellinen sy\xf6te: t\xe4ytyy olla ${oZ(r.values[0])}`;return`Virheellinen valinta: t\xe4ytyy olla yksi seuraavista: ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Liian suuri: ${i.subject} t\xe4ytyy olla ${t}${r.maximum.toString()} ${i.unit}`.trim();return`Liian suuri: arvon t\xe4ytyy olla ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Liian pieni: ${i.subject} t\xe4ytyy olla ${t}${r.minimum.toString()} ${i.unit}`.trim();return`Liian pieni: arvon t\xe4ytyy olla ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy alkaa "${r.prefix}"`;if("ends_with"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy loppua "${r.suffix}"`;if("includes"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy sis\xe4lt\xe4\xe4 "${r.includes}"`;if("regex"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy vastata s\xe4\xe4nn\xf6llist\xe4 lauseketta ${r.pattern}`;return`Virheellinen ${t[r.format]??r.format}`;case"not_multiple_of":return`Virheellinen luku: t\xe4ytyy olla luvun ${r.divisor} monikerta`;case"unrecognized_keys":return`${r.keys.length>1?"Tuntemattomat avaimet":"Tuntematon avain"}: ${ob(r.keys,", ")}`;case"invalid_key":return"Virheellinen avain tietueessa";case"invalid_union":return"Virheellinen unioni";case"invalid_element":return"Virheellinen arvo joukossa";default:return`Virheellinen sy\xf6te`}})}},"fr",0,function(){let e,t;return{localeError:(e={string:{unit:"caractres",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"lments",verb:"avoir"},set:{unit:"lments",verb:"avoir"}},t={regex:"entre",email:"adresse e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date et heure ISO",date:"date ISO",time:"heure ISO",duration:"dure ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chane encode en base64",base64url:"chane encode en base64url",json_string:"chane JSON",e164:"numro E.164",jwt:"JWT",template_literal:"entre"},r=>{switch(r.code){case"invalid_type":return`Entr\xe9e invalide : ${r.expected} attendu, ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombre";case"object":if(Array.isArray(e))return"tableau";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)} re\xe7u`;case"invalid_value":if(1===r.values.length)return`Entr\xe9e invalide : ${oZ(r.values[0])} attendu`;return`Option invalide : une valeur parmi ${ob(r.values,"|")} attendue`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Trop grand : ${r.origin??"valeur"} doit ${i.verb} ${t}${r.maximum.toString()} ${i.unit??"lment(s)"}`;return`Trop grand : ${r.origin??"valeur"} doit \xeatre ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Trop petit : ${r.origin} doit ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return`Trop petit : ${r.origin} doit \xeatre ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Cha\xeene invalide : doit commencer par "${r.prefix}"`;if("ends_with"===r.format)return`Cha\xeene invalide : doit se terminer par "${r.suffix}"`;if("includes"===r.format)return`Cha\xeene invalide : doit inclure "${r.includes}"`;if("regex"===r.format)return`Cha\xeene invalide : doit correspondre au mod\xe8le ${r.pattern}`;return`${t[r.format]??r.format} invalide`;case"not_multiple_of":return`Nombre invalide : doit \xeatre un multiple de ${r.divisor}`;case"unrecognized_keys":return`Cl\xe9${r.keys.length>1?"s":""} non reconnue${r.keys.length>1?"s":""} : ${ob(r.keys,", ")}`;case"invalid_key":return`Cl\xe9 invalide dans ${r.origin}`;case"invalid_union":return"Entre invalide";case"invalid_element":return`Valeur invalide dans ${r.origin}`;default:return`Entr\xe9e invalide`}})}},"frCA",0,function(){let e,t;return{localeError:(e={string:{unit:"caractres",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"lments",verb:"avoir"},set:{unit:"lments",verb:"avoir"}},t={regex:"entre",email:"adresse courriel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date-heure ISO",date:"date ISO",time:"heure ISO",duration:"dure ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chane encode en base64",base64url:"chane encode en base64url",json_string:"chane JSON",e164:"numro E.164",jwt:"JWT",template_literal:"entre"},r=>{switch(r.code){case"invalid_type":return`Entr\xe9e invalide : attendu ${r.expected}, re\xe7u ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Entr\xe9e invalide : attendu ${oZ(r.values[0])}`;return`Option invalide : attendu l'une des valeurs suivantes ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"":"<",i=e[r.origin]??null;if(i)return`Trop grand : attendu que ${r.origin??"la valeur"} ait ${t}${r.maximum.toString()} ${i.unit}`;return`Trop grand : attendu que ${r.origin??"la valeur"} soit ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?"":">",i=e[r.origin]??null;if(i)return`Trop petit : attendu que ${r.origin} ait ${t}${r.minimum.toString()} ${i.unit}`;return`Trop petit : attendu que ${r.origin} soit ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Cha\xeene invalide : doit commencer par "${r.prefix}"`;if("ends_with"===r.format)return`Cha\xeene invalide : doit se terminer par "${r.suffix}"`;if("includes"===r.format)return`Cha\xeene invalide : doit inclure "${r.includes}"`;if("regex"===r.format)return`Cha\xeene invalide : doit correspondre au motif ${r.pattern}`;return`${t[r.format]??r.format} invalide`;case"not_multiple_of":return`Nombre invalide : doit \xeatre un multiple de ${r.divisor}`;case"unrecognized_keys":return`Cl\xe9${r.keys.length>1?"s":""} non reconnue${r.keys.length>1?"s":""} : ${ob(r.keys,", ")}`;case"invalid_key":return`Cl\xe9 invalide dans ${r.origin}`;case"invalid_union":return"Entre invalide";case"invalid_element":return`Valeur invalide dans ${r.origin}`;default:return`Entr\xe9e invalide`}})}},"he",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:" ",url:" ",emoji:"'",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ISO",date:" ISO",time:" ISO",duration:"  ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:"  64",base64url:"  64  ",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`  :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`  :  ${oZ(r.values[0])}`;return`  :     ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ${r.origin??"value"}   ${t}${r.maximum.toString()} ${i.unit??"elements"}`;return` : ${r.origin??"value"}   ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ${r.origin}   ${t}${r.minimum.toString()} ${i.unit}`;return` : ${r.origin}   ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`  :   "${r.prefix}"`;if("ends_with"===r.format)return`  :    "${r.suffix}"`;if("includes"===r.format)return`  :   "${r.includes}"`;if("regex"===r.format)return`  :    ${r.pattern}`;return`${t[r.format]??r.format}  `;case"not_multiple_of":return`  :     ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""}  ${r.keys.length>1?"":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${r.origin}`;default:return`  `}})}},"hu",0,function(){let e,t;return{localeError:(e={string:{unit:"karakter",verb:"legyen"},file:{unit:"byte",verb:"legyen"},array:{unit:"elem",verb:"legyen"},set:{unit:"elem",verb:"legyen"}},t={regex:"bemenet",email:"email cm",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO idblyeg",date:"ISO dtum",time:"ISO id",duration:"ISO idintervallum",ipv4:"IPv4 cm",ipv6:"IPv6 cm",cidrv4:"IPv4 tartomny",cidrv6:"IPv6 tartomny",base64:"base64-kdolt string",base64url:"base64url-kdolt string",json_string:"JSON string",e164:"E.164 szm",jwt:"JWT",template_literal:"bemenet"},r=>{switch(r.code){case"invalid_type":return`\xc9rv\xe9nytelen bemenet: a v\xe1rt \xe9rt\xe9k ${r.expected}, a kapott \xe9rt\xe9k ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"szm";case"object":if(Array.isArray(e))return"tmb";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`\xc9rv\xe9nytelen bemenet: a v\xe1rt \xe9rt\xe9k ${oZ(r.values[0])}`;return`\xc9rv\xe9nytelen opci\xf3: valamelyik \xe9rt\xe9k v\xe1rt ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`T\xfal nagy: ${r.origin??"rtk"} m\xe9rete t\xfal nagy ${t}${r.maximum.toString()} ${i.unit??"elem"}`;return`T\xfal nagy: a bemeneti \xe9rt\xe9k ${r.origin??"rtk"} t\xfal nagy: ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`T\xfal kicsi: a bemeneti \xe9rt\xe9k ${r.origin} m\xe9rete t\xfal kicsi ${t}${r.minimum.toString()} ${i.unit}`;return`T\xfal kicsi: a bemeneti \xe9rt\xe9k ${r.origin} t\xfal kicsi ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`\xc9rv\xe9nytelen string: "${r.prefix}" \xe9rt\xe9kkel kell kezddnie`;if("ends_with"===r.format)return`\xc9rv\xe9nytelen string: "${r.suffix}" \xe9rt\xe9kkel kell v\xe9gzdnie`;if("includes"===r.format)return`\xc9rv\xe9nytelen string: "${r.includes}" \xe9rt\xe9ket kell tartalmaznia`;if("regex"===r.format)return`\xc9rv\xe9nytelen string: ${r.pattern} mint\xe1nak kell megfelelnie`;return`\xc9rv\xe9nytelen ${t[r.format]??r.format}`;case"not_multiple_of":return`\xc9rv\xe9nytelen sz\xe1m: ${r.divisor} t\xf6bbsz\xf6r\xf6s\xe9nek kell lennie`;case"unrecognized_keys":return`Ismeretlen kulcs${r.keys.length>1?"s":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`\xc9rv\xe9nytelen kulcs ${r.origin}`;case"invalid_union":return"rvnytelen bemenet";case"invalid_element":return`\xc9rv\xe9nytelen \xe9rt\xe9k: ${r.origin}`;default:return`\xc9rv\xe9nytelen bemenet`}})}},"id",0,function(){let e,t;return{localeError:(e={string:{unit:"karakter",verb:"memiliki"},file:{unit:"byte",verb:"memiliki"},array:{unit:"item",verb:"memiliki"},set:{unit:"item",verb:"memiliki"}},t={regex:"input",email:"alamat email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tanggal dan waktu format ISO",date:"tanggal format ISO",time:"jam format ISO",duration:"durasi format ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"rentang alamat IPv4",cidrv6:"rentang alamat IPv6",base64:"string dengan enkode base64",base64url:"string dengan enkode base64url",json_string:"string JSON",e164:"angka E.164",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Input tidak valid: diharapkan ${r.expected}, diterima ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Input tidak valid: diharapkan ${oZ(r.values[0])}`;return`Pilihan tidak valid: diharapkan salah satu dari ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Terlalu besar: diharapkan ${r.origin??"value"} memiliki ${t}${r.maximum.toString()} ${i.unit??"elemen"}`;return`Terlalu besar: diharapkan ${r.origin??"value"} menjadi ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Terlalu kecil: diharapkan ${r.origin} memiliki ${t}${r.minimum.toString()} ${i.unit}`;return`Terlalu kecil: diharapkan ${r.origin} menjadi ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`String tidak valid: harus dimulai dengan "${r.prefix}"`;if("ends_with"===r.format)return`String tidak valid: harus berakhir dengan "${r.suffix}"`;if("includes"===r.format)return`String tidak valid: harus menyertakan "${r.includes}"`;if("regex"===r.format)return`String tidak valid: harus sesuai pola ${r.pattern}`;return`${t[r.format]??r.format} tidak valid`;case"not_multiple_of":return`Angka tidak valid: harus kelipatan dari ${r.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali ${r.keys.length>1?"s":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`Kunci tidak valid di ${r.origin}`;case"invalid_union":default:return"Input tidak valid";case"invalid_element":return`Nilai tidak valid di ${r.origin}`}})}},"it",0,function(){let e,t;return{localeError:(e={string:{unit:"caratteri",verb:"avere"},file:{unit:"byte",verb:"avere"},array:{unit:"elementi",verb:"avere"},set:{unit:"elementi",verb:"avere"}},t={regex:"input",email:"indirizzo email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e ora ISO",date:"data ISO",time:"ora ISO",duration:"durata ISO",ipv4:"indirizzo IPv4",ipv6:"indirizzo IPv6",cidrv4:"intervallo IPv4",cidrv6:"intervallo IPv6",base64:"stringa codificata in base64",base64url:"URL codificata in base64",json_string:"stringa JSON",e164:"numero E.164",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Input non valido: atteso ${r.expected}, ricevuto ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"numero";case"object":if(Array.isArray(e))return"vettore";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Input non valido: atteso ${oZ(r.values[0])}`;return`Opzione non valida: atteso uno tra ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Troppo grande: ${r.origin??"valore"} deve avere ${t}${r.maximum.toString()} ${i.unit??"elementi"}`;return`Troppo grande: ${r.origin??"valore"} deve essere ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Troppo piccolo: ${r.origin} deve avere ${t}${r.minimum.toString()} ${i.unit}`;return`Troppo piccolo: ${r.origin} deve essere ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Stringa non valida: deve iniziare con "${r.prefix}"`;if("ends_with"===r.format)return`Stringa non valida: deve terminare con "${r.suffix}"`;if("includes"===r.format)return`Stringa non valida: deve includere "${r.includes}"`;if("regex"===r.format)return`Stringa non valida: deve corrispondere al pattern ${r.pattern}`;return`Invalid ${t[r.format]??r.format}`;case"not_multiple_of":return`Numero non valido: deve essere un multiplo di ${r.divisor}`;case"unrecognized_keys":return`Chiav${r.keys.length>1?"i":"e"} non riconosciut${r.keys.length>1?"e":"a"}: ${ob(r.keys,", ")}`;case"invalid_key":return`Chiave non valida in ${r.origin}`;case"invalid_union":default:return"Input non valido";case"invalid_element":return`Valore non valido in ${r.origin}`}})}},"ja",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`: ${r.expected}${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`: ${oZ(r.values[0])}`;return`: ${ob(r.values,"")}`;case"too_big":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin??""}${r.maximum.toString()}${i.unit??""}${t}`;return`: ${r.origin??""}${r.maximum.toString()}${t}`}case"too_small":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin}${r.minimum.toString()}${i.unit}${t}`;return`: ${r.origin}${r.minimum.toString()}${t}`}case"invalid_format":if("starts_with"===r.format)return`: "${r.prefix}"`;if("ends_with"===r.format)return`: "${r.suffix}"`;if("includes"===r.format)return`: "${r.includes}"`;if("regex"===r.format)return`: ${r.pattern}`;return`${t[r.format]??r.format}`;case"not_multiple_of":return`: ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""}: ${ob(r.keys,"")}`;case"invalid_key":return`${r.origin}`;case"invalid_union":return"";case"invalid_element":return`${r.origin}`;default:return``}})}},"kh",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:" base64",base64url:" base64url",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`  ${r.expected}  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?" (NaN)":"";case"object":if(Array.isArray(e))return" (Array)";if(null===e)return" (null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`  ${oZ(r.values[0])}`;return`  ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`  ${r.origin??""} ${t} ${r.maximum.toString()} ${i.unit??""}`;return`  ${r.origin??""} ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`  ${r.origin} ${t} ${r.minimum.toString()} ${i.unit}`;return`  ${r.origin} ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`  "${r.prefix}"`;if("ends_with"===r.format)return`  "${r.suffix}"`;if("includes"===r.format)return`  "${r.includes}"`;if("regex"===r.format)return`  ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return`  ${r.divisor}`;case"unrecognized_keys":return` ${ob(r.keys,", ")}`;case"invalid_key":return` ${r.origin}`;case"invalid_union":default:return``;case"invalid_element":return` ${r.origin}`}})}},"ko",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:"to have"},file:{unit:"",verb:"to have"},array:{unit:"",verb:"to have"},set:{unit:"",verb:"to have"}},t={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64  ",base64url:"base64url  ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :   ${r.expected},   ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${oZ(r.values[0])}  `;return` : ${ob(r.values," ")}   `;case"too_big":{let t=r.inclusive?"":"",i=""===t?" ":" ",n=e[r.origin]??null,a=n?.unit??"";if(n)return`${r.origin??""}  : ${r.maximum.toString()}${a} ${t}${i}`;return`${r.origin??""}  : ${r.maximum.toString()} ${t}${i}`}case"too_small":{let t=r.inclusive?"":"",i=""===t?" ":" ",n=e[r.origin]??null,a=n?.unit??"";if(n)return`${r.origin??""}  : ${r.minimum.toString()}${a} ${t}${i}`;return`${r.origin??""}  : ${r.minimum.toString()} ${t}${i}`}case"invalid_format":if("starts_with"===r.format)return` : "${r.prefix}"()  `;if("ends_with"===r.format)return` : "${r.suffix}"()  `;if("includes"===r.format)return` : "${r.includes}"()  `;if("regex"===r.format)return` :  ${r.pattern}   `;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` : ${r.divisor}  `;case"unrecognized_keys":return`   : ${ob(r.keys,", ")}`;case"invalid_key":return` : ${r.origin}`;case"invalid_union":default:return` `;case"invalid_element":return` : ${r.origin}`}})}},"mk",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:"  -",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64- ",base64url:"base64url- ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :   ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Invalid input: expected ${oZ(r.values[0])}`;return` :    ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` :   ${r.origin??""}   ${t}${r.maximum.toString()} ${i.unit??""}`;return` :   ${r.origin??""}   ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` :   ${r.origin}   ${t}${r.minimum.toString()} ${i.unit}`;return` :   ${r.origin}   ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :     "${r.prefix}"`;if("ends_with"===r.format)return` :     "${r.suffix}"`;if("includes"===r.format)return` :    "${r.includes}"`;if("regex"===r.format)return` :      ${r.pattern}`;return`Invalid ${t[r.format]??r.format}`;case"not_multiple_of":return` :      ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?" ":" "}: ${ob(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${r.origin}`;default:return` `}})}},"ms",0,function(){let e,t;return{localeError:(e={string:{unit:"aksara",verb:"mempunyai"},file:{unit:"bait",verb:"mempunyai"},array:{unit:"elemen",verb:"mempunyai"},set:{unit:"elemen",verb:"mempunyai"}},t={regex:"input",email:"alamat e-mel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tarikh masa ISO",date:"tarikh ISO",time:"masa ISO",duration:"tempoh ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"julat IPv4",cidrv6:"julat IPv6",base64:"string dikodkan base64",base64url:"string dikodkan base64url",json_string:"string JSON",e164:"nombor E.164",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Input tidak sah: dijangka ${r.expected}, diterima ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombor";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Input tidak sah: dijangka ${oZ(r.values[0])}`;return`Pilihan tidak sah: dijangka salah satu daripada ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Terlalu besar: dijangka ${r.origin??"nilai"} ${i.verb} ${t}${r.maximum.toString()} ${i.unit??"elemen"}`;return`Terlalu besar: dijangka ${r.origin??"nilai"} adalah ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Terlalu kecil: dijangka ${r.origin} ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return`Terlalu kecil: dijangka ${r.origin} adalah ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`String tidak sah: mesti bermula dengan "${r.prefix}"`;if("ends_with"===r.format)return`String tidak sah: mesti berakhir dengan "${r.suffix}"`;if("includes"===r.format)return`String tidak sah: mesti mengandungi "${r.includes}"`;if("regex"===r.format)return`String tidak sah: mesti sepadan dengan corak ${r.pattern}`;return`${t[r.format]??r.format} tidak sah`;case"not_multiple_of":return`Nombor tidak sah: perlu gandaan ${r.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali: ${ob(r.keys,", ")}`;case"invalid_key":return`Kunci tidak sah dalam ${r.origin}`;case"invalid_union":default:return"Input tidak sah";case"invalid_element":return`Nilai tidak sah dalam ${r.origin}`}})}},"nl",0,function(){let e,t;return{localeError:(e={string:{unit:"tekens"},file:{unit:"bytes"},array:{unit:"elementen"},set:{unit:"elementen"}},t={regex:"invoer",email:"emailadres",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum en tijd",date:"ISO datum",time:"ISO tijd",duration:"ISO duur",ipv4:"IPv4-adres",ipv6:"IPv6-adres",cidrv4:"IPv4-bereik",cidrv6:"IPv6-bereik",base64:"base64-gecodeerde tekst",base64url:"base64 URL-gecodeerde tekst",json_string:"JSON string",e164:"E.164-nummer",jwt:"JWT",template_literal:"invoer"},r=>{switch(r.code){case"invalid_type":return`Ongeldige invoer: verwacht ${r.expected}, ontving ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"getal";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ongeldige invoer: verwacht ${oZ(r.values[0])}`;return`Ongeldige optie: verwacht \xe9\xe9n van ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Te lang: verwacht dat ${r.origin??"waarde"} ${t}${r.maximum.toString()} ${i.unit??"elementen"} bevat`;return`Te lang: verwacht dat ${r.origin??"waarde"} ${t}${r.maximum.toString()} is`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Te kort: verwacht dat ${r.origin} ${t}${r.minimum.toString()} ${i.unit} bevat`;return`Te kort: verwacht dat ${r.origin} ${t}${r.minimum.toString()} is`}case"invalid_format":if("starts_with"===r.format)return`Ongeldige tekst: moet met "${r.prefix}" beginnen`;if("ends_with"===r.format)return`Ongeldige tekst: moet op "${r.suffix}" eindigen`;if("includes"===r.format)return`Ongeldige tekst: moet "${r.includes}" bevatten`;if("regex"===r.format)return`Ongeldige tekst: moet overeenkomen met patroon ${r.pattern}`;return`Ongeldig: ${t[r.format]??r.format}`;case"not_multiple_of":return`Ongeldig getal: moet een veelvoud van ${r.divisor} zijn`;case"unrecognized_keys":return`Onbekende key${r.keys.length>1?"s":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`Ongeldige key in ${r.origin}`;case"invalid_union":default:return"Ongeldige invoer";case"invalid_element":return`Ongeldige waarde in ${r.origin}`}})}},"no",0,function(){let e,t;return{localeError:(e={string:{unit:"tegn",verb:" ha"},file:{unit:"bytes",verb:" ha"},array:{unit:"elementer",verb:" inneholde"},set:{unit:"elementer",verb:" inneholde"}},t={regex:"input",email:"e-postadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslett",date:"ISO-dato",time:"ISO-klokkeslett",duration:"ISO-varighet",ipv4:"IPv4-omrde",ipv6:"IPv6-omrde",cidrv4:"IPv4-spekter",cidrv6:"IPv6-spekter",base64:"base64-enkodet streng",base64url:"base64url-enkodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Ugyldig input: forventet ${r.expected}, fikk ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"tall";case"object":if(Array.isArray(e))return"liste";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ugyldig verdi: forventet ${oZ(r.values[0])}`;return`Ugyldig valg: forventet en av ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`For stor(t): forventet ${r.origin??"value"} til \xe5 ha ${t}${r.maximum.toString()} ${i.unit??"elementer"}`;return`For stor(t): forventet ${r.origin??"value"} til \xe5 ha ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`For lite(n): forventet ${r.origin} til \xe5 ha ${t}${r.minimum.toString()} ${i.unit}`;return`For lite(n): forventet ${r.origin} til \xe5 ha ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Ugyldig streng: m\xe5 starte med "${r.prefix}"`;if("ends_with"===r.format)return`Ugyldig streng: m\xe5 ende med "${r.suffix}"`;if("includes"===r.format)return`Ugyldig streng: m\xe5 inneholde "${r.includes}"`;if("regex"===r.format)return`Ugyldig streng: m\xe5 matche m\xf8nsteret ${r.pattern}`;return`Ugyldig ${t[r.format]??r.format}`;case"not_multiple_of":return`Ugyldig tall: m\xe5 v\xe6re et multiplum av ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"Ukjente nkler":"Ukjent nkkel"}: ${ob(r.keys,", ")}`;case"invalid_key":return`Ugyldig n\xf8kkel i ${r.origin}`;case"invalid_union":default:return"Ugyldig input";case"invalid_element":return`Ugyldig verdi i ${r.origin}`}})}},"ota",0,function(){let e,t;return{localeError:(e={string:{unit:"harf",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"unsur",verb:"olmaldr"},set:{unit:"unsur",verb:"olmaldr"}},t={regex:"giren",email:"epostagh",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO hengm",date:"ISO tarihi",time:"ISO zaman",duration:"ISO mddeti",ipv4:"IPv4 nin",ipv6:"IPv6 nin",cidrv4:"IPv4 menzili",cidrv6:"IPv6 menzili",base64:"base64-ifreli metin",base64url:"base64url-ifreli metin",json_string:"JSON metin",e164:"E.164 says",jwt:"JWT",template_literal:"giren"},r=>{switch(r.code){case"invalid_type":return`F\xe2sit giren: umulan ${r.expected}, alnan ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"numara";case"object":if(Array.isArray(e))return"saf";if(null===e)return"gayb";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`F\xe2sit giren: umulan ${oZ(r.values[0])}`;return`F\xe2sit tercih: m\xfbteberler ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Fazla b\xfcy\xfck: ${r.origin??"value"}, ${t}${r.maximum.toString()} ${i.unit??"elements"} sahip olmalyd.`;return`Fazla b\xfcy\xfck: ${r.origin??"value"}, ${t}${r.maximum.toString()} olmalyd.`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Fazla k\xfc\xe7\xfck: ${r.origin}, ${t}${r.minimum.toString()} ${i.unit} sahip olmalyd.`;return`Fazla k\xfc\xe7\xfck: ${r.origin}, ${t}${r.minimum.toString()} olmalyd.`}case"invalid_format":if("starts_with"===r.format)return`F\xe2sit metin: "${r.prefix}" ile balamal.`;if("ends_with"===r.format)return`F\xe2sit metin: "${r.suffix}" ile bitmeli.`;if("includes"===r.format)return`F\xe2sit metin: "${r.includes}" ihtiv\xe2 etmeli.`;if("regex"===r.format)return`F\xe2sit metin: ${r.pattern} nakna uymal.`;return`F\xe2sit ${t[r.format]??r.format}`;case"not_multiple_of":return`F\xe2sit say: ${r.divisor} kat olmalyd.`;case"unrecognized_keys":return`Tannmayan anahtar ${r.keys.length>1?"s":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`${r.origin} i\xe7in tannmayan anahtar var.`;case"invalid_union":return"Giren tannamad.";case"invalid_element":return`${r.origin} i\xe7in tannmayan kymet var.`;default:return`Kymet tannamad.`}})}},"pl",0,function(){let e,t;return{localeError:(e={string:{unit:"znakw",verb:"mie"},file:{unit:"bajtw",verb:"mie"},array:{unit:"elementw",verb:"mie"},set:{unit:"elementw",verb:"mie"}},t={regex:"wyraenie",email:"adres email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i godzina w formacie ISO",date:"data w formacie ISO",time:"godzina w formacie ISO",duration:"czas trwania ISO",ipv4:"adres IPv4",ipv6:"adres IPv6",cidrv4:"zakres IPv4",cidrv6:"zakres IPv6",base64:"cig znakw zakodowany w formacie base64",base64url:"cig znakw zakodowany w formacie base64url",json_string:"cig znakw w formacie JSON",e164:"liczba E.164",jwt:"JWT",template_literal:"wejcie"},r=>{switch(r.code){case"invalid_type":return`Nieprawidowe dane wejciowe: oczekiwano ${r.expected}, otrzymano ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"liczba";case"object":if(Array.isArray(e))return"tablica";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Nieprawidowe dane wejciowe: oczekiwano ${oZ(r.values[0])}`;return`Nieprawidowa opcja: oczekiwano jednej z wartoci ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Za dua warto: oczekiwano, e ${r.origin??"warto"} bdzie mie ${t}${r.maximum.toString()} ${i.unit??"elementw"}`;return`Zbyt du(y/a/e): oczekiwano, e ${r.origin??"warto"} bdzie wynosi ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Za maa warto: oczekiwano, e ${r.origin??"warto"} bdzie mie ${t}${r.minimum.toString()} ${i.unit??"elementw"}`;return`Zbyt ma(y/a/e): oczekiwano, e ${r.origin??"warto"} bdzie wynosi ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Nieprawidowy cig znak\xf3w: musi zaczyna si od "${r.prefix}"`;if("ends_with"===r.format)return`Nieprawidowy cig znak\xf3w: musi koczy si na "${r.suffix}"`;if("includes"===r.format)return`Nieprawidowy cig znak\xf3w: musi zawiera "${r.includes}"`;if("regex"===r.format)return`Nieprawidowy cig znak\xf3w: musi odpowiada wzorcowi ${r.pattern}`;return`Nieprawidow(y/a/e) ${t[r.format]??r.format}`;case"not_multiple_of":return`Nieprawidowa liczba: musi by wielokrotnoci ${r.divisor}`;case"unrecognized_keys":return`Nierozpoznane klucze${r.keys.length>1?"s":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`Nieprawidowy klucz w ${r.origin}`;case"invalid_union":return"Nieprawidowe dane wejciowe";case"invalid_element":return`Nieprawidowa warto w ${r.origin}`;default:return`Nieprawidowe dane wejciowe`}})}},"ps",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"  ",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ",date:"",time:"",duration:"",ipv4:" IPv4 ",ipv6:" IPv6 ",cidrv4:" IPv4 ",cidrv6:" IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:" E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected} ,  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}  `;case"invalid_value":if(1===r.values.length)return` :  ${oZ(r.values[0])} `;return` :    ${ob(r.values,"|")}  `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""} `;return` : ${r.origin??""}  ${t}${r.maximum.toString()} `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ${r.origin}  ${t}${r.minimum.toString()} ${i.unit} `;return` : ${r.origin}  ${t}${r.minimum.toString()} `}case"invalid_format":if("starts_with"===r.format)return` :   "${r.prefix}"   `;if("ends_with"===r.format)return` :   "${r.suffix}"    `;if("includes"===r.format)return` :  "${r.includes}" `;if("regex"===r.format)return` :   ${r.pattern}   `;return`${t[r.format]??r.format}  `;case"not_multiple_of":return` :   ${r.divisor}  `;case"unrecognized_keys":return` ${r.keys.length>1?"":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`   ${r.origin} `;case"invalid_union":default:return` `;case"invalid_element":return`   ${r.origin} `}})}},"pt",0,function(){let e,t;return{localeError:(e={string:{unit:"caracteres",verb:"ter"},file:{unit:"bytes",verb:"ter"},array:{unit:"itens",verb:"ter"},set:{unit:"itens",verb:"ter"}},t={regex:"padro",email:"endereo de e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e hora ISO",date:"data ISO",time:"hora ISO",duration:"durao ISO",ipv4:"endereo IPv4",ipv6:"endereo IPv6",cidrv4:"faixa de IPv4",cidrv6:"faixa de IPv6",base64:"texto codificado em base64",base64url:"URL codificada em base64",json_string:"texto JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},r=>{switch(r.code){case"invalid_type":return`Tipo inv\xe1lido: esperado ${r.expected}, recebido ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nmero";case"object":if(Array.isArray(e))return"array";if(null===e)return"nulo";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Entrada inv\xe1lida: esperado ${oZ(r.values[0])}`;return`Op\xe7\xe3o inv\xe1lida: esperada uma das ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Muito grande: esperado que ${r.origin??"valor"} tivesse ${t}${r.maximum.toString()} ${i.unit??"elementos"}`;return`Muito grande: esperado que ${r.origin??"valor"} fosse ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Muito pequeno: esperado que ${r.origin} tivesse ${t}${r.minimum.toString()} ${i.unit}`;return`Muito pequeno: esperado que ${r.origin} fosse ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Texto inv\xe1lido: deve come\xe7ar com "${r.prefix}"`;if("ends_with"===r.format)return`Texto inv\xe1lido: deve terminar com "${r.suffix}"`;if("includes"===r.format)return`Texto inv\xe1lido: deve incluir "${r.includes}"`;if("regex"===r.format)return`Texto inv\xe1lido: deve corresponder ao padr\xe3o ${r.pattern}`;return`${t[r.format]??r.format} inv\xe1lido`;case"not_multiple_of":return`N\xfamero inv\xe1lido: deve ser m\xfaltiplo de ${r.divisor}`;case"unrecognized_keys":return`Chave${r.keys.length>1?"s":""} desconhecida${r.keys.length>1?"s":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`Chave inv\xe1lida em ${r.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Valor inv\xe1lido em ${r.origin}`;default:return`Campo inv\xe1lido`}})}},"ru",0,function(){let e,t;return{localeError:(e={string:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""}},t={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${oZ(r.values[0])}`;return` :    ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i){let e=cP(Number(r.maximum),i.unit.one,i.unit.few,i.unit.many);return`  : ,  ${r.origin??""}   ${t}${r.maximum.toString()} ${e}`}return`  : ,  ${r.origin??""}  ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i){let e=cP(Number(r.minimum),i.unit.one,i.unit.few,i.unit.many);return`  : ,  ${r.origin}   ${t}${r.minimum.toString()} ${e}`}return`  : ,  ${r.origin}  ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :    "${r.prefix}"`;if("ends_with"===r.format)return` :    "${r.suffix}"`;if("includes"===r.format)return` :   "${r.includes}"`;if("regex"===r.format)return` :    ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` :    ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""} ${r.keys.length>1?"":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${r.origin}`;default:return`  `}})}},"sl",0,function(){let e,t;return{localeError:(e={string:{unit:"znakov",verb:"imeti"},file:{unit:"bajtov",verb:"imeti"},array:{unit:"elementov",verb:"imeti"},set:{unit:"elementov",verb:"imeti"}},t={regex:"vnos",email:"e-potni naslov",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum in as",date:"ISO datum",time:"ISO as",duration:"ISO trajanje",ipv4:"IPv4 naslov",ipv6:"IPv6 naslov",cidrv4:"obseg IPv4",cidrv6:"obseg IPv6",base64:"base64 kodiran niz",base64url:"base64url kodiran niz",json_string:"JSON niz",e164:"E.164 tevilka",jwt:"JWT",template_literal:"vnos"},r=>{switch(r.code){case"invalid_type":return`Neveljaven vnos: priakovano ${r.expected}, prejeto ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"tevilo";case"object":if(Array.isArray(e))return"tabela";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Neveljaven vnos: priakovano ${oZ(r.values[0])}`;return`Neveljavna monost: priakovano eno izmed ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Preveliko: priakovano, da bo ${r.origin??"vrednost"} imelo ${t}${r.maximum.toString()} ${i.unit??"elementov"}`;return`Preveliko: priakovano, da bo ${r.origin??"vrednost"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Premajhno: priakovano, da bo ${r.origin} imelo ${t}${r.minimum.toString()} ${i.unit}`;return`Premajhno: priakovano, da bo ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Neveljaven niz: mora se zaeti z "${r.prefix}"`;if("ends_with"===r.format)return`Neveljaven niz: mora se konati z "${r.suffix}"`;if("includes"===r.format)return`Neveljaven niz: mora vsebovati "${r.includes}"`;if("regex"===r.format)return`Neveljaven niz: mora ustrezati vzorcu ${r.pattern}`;return`Neveljaven ${t[r.format]??r.format}`;case"not_multiple_of":return`Neveljavno tevilo: mora biti vekratnik ${r.divisor}`;case"unrecognized_keys":return`Neprepoznan${r.keys.length>1?"i kljui":" klju"}: ${ob(r.keys,", ")}`;case"invalid_key":return`Neveljaven klju v ${r.origin}`;case"invalid_union":default:return"Neveljaven vnos";case"invalid_element":return`Neveljavna vrednost v ${r.origin}`}})}},"sv",0,function(){let e,t;return{localeError:(e={string:{unit:"tecken",verb:"att ha"},file:{unit:"bytes",verb:"att ha"},array:{unit:"objekt",verb:"att innehlla"},set:{unit:"objekt",verb:"att innehlla"}},t={regex:"reguljrt uttryck",email:"e-postadress",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datum och tid",date:"ISO-datum",time:"ISO-tid",duration:"ISO-varaktighet",ipv4:"IPv4-intervall",ipv6:"IPv6-intervall",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodad strng",base64url:"base64url-kodad strng",json_string:"JSON-strng",e164:"E.164-nummer",jwt:"JWT",template_literal:"mall-literal"},r=>{switch(r.code){case"invalid_type":return`Ogiltig inmatning: f\xf6rv\xe4ntat ${r.expected}, fick ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"antal";case"object":if(Array.isArray(e))return"lista";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ogiltig inmatning: f\xf6rv\xe4ntat ${oZ(r.values[0])}`;return`Ogiltigt val: f\xf6rv\xe4ntade en av ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`F\xf6r stor(t): f\xf6rv\xe4ntade ${r.origin??"vrdet"} att ha ${t}${r.maximum.toString()} ${i.unit??"element"}`;return`F\xf6r stor(t): f\xf6rv\xe4ntat ${r.origin??"vrdet"} att ha ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`F\xf6r lite(t): f\xf6rv\xe4ntade ${r.origin??"vrdet"} att ha ${t}${r.minimum.toString()} ${i.unit}`;return`F\xf6r lite(t): f\xf6rv\xe4ntade ${r.origin??"vrdet"} att ha ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Ogiltig str\xe4ng: m\xe5ste b\xf6rja med "${r.prefix}"`;if("ends_with"===r.format)return`Ogiltig str\xe4ng: m\xe5ste sluta med "${r.suffix}"`;if("includes"===r.format)return`Ogiltig str\xe4ng: m\xe5ste inneh\xe5lla "${r.includes}"`;if("regex"===r.format)return`Ogiltig str\xe4ng: m\xe5ste matcha m\xf6nstret "${r.pattern}"`;return`Ogiltig(t) ${t[r.format]??r.format}`;case"not_multiple_of":return`Ogiltigt tal: m\xe5ste vara en multipel av ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"Oknda nycklar":"Oknd nyckel"}: ${ob(r.keys,", ")}`;case"invalid_key":return`Ogiltig nyckel i ${r.origin??"vrdet"}`;case"invalid_union":default:return"Ogiltig input";case"invalid_element":return`Ogiltigt v\xe4rde i ${r.origin??"vrdet"}`}})}},"ta",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:" ",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO  ",date:"ISO ",time:"ISO ",duration:"ISO  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?" ":"";case"object":if(Array.isArray(e))return"";if(null===e)return"";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${oZ(r.values[0])}`;return` :  ${ob(r.values,"|")}  `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` :  ${r.origin??""} ${t}${r.maximum.toString()} ${i.unit??""}   `;return` :  ${r.origin??""} ${t}${r.maximum.toString()}   `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` :  ${r.origin} ${t}${r.minimum.toString()} ${i.unit}   `;return` :  ${r.origin} ${t}${r.minimum.toString()}   `}case"invalid_format":if("starts_with"===r.format)return` : "${r.prefix}"   `;if("ends_with"===r.format)return` : "${r.suffix}"   `;if("includes"===r.format)return` : "${r.includes}"   `;if("regex"===r.format)return` : ${r.pattern}   `;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` : ${r.divisor}    `;case"unrecognized_keys":return`  ${r.keys.length>1?"":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`${r.origin}   `;case"invalid_union":return" ";case"invalid_element":return`${r.origin}   `;default:return` `}})}},"th",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:" ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IP  IPv4",cidrv6:" IP  IPv6",base64:" Base64",base64url:" Base64  URL",json_string:" JSON",e164:" (E.164)",jwt:" JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`:  ${r.expected}  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?" (NaN)":"";case"object":if(Array.isArray(e))return" (Array)";if(null===e)return" (null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`:  ${oZ(r.values[0])}`;return`:  ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin??""} ${t} ${r.maximum.toString()} ${i.unit??""}`;return`: ${r.origin??""} ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin} ${t} ${r.minimum.toString()} ${i.unit}`;return`: ${r.origin} ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`:  "${r.prefix}"`;if("ends_with"===r.format)return`:  "${r.suffix}"`;if("includes"===r.format)return`:  "${r.includes}" `;if("regex"===r.format)return`:  ${r.pattern}`;return`: ${t[r.format]??r.format}`;case"not_multiple_of":return`:  ${r.divisor} `;case"unrecognized_keys":return`: ${ob(r.keys,", ")}`;case"invalid_key":return` ${r.origin}`;case"invalid_union":return": ";case"invalid_element":return` ${r.origin}`;default:return``}})}},"tr",0,function(){let e,t;return{localeError:(e={string:{unit:"karakter",verb:"olmal"},file:{unit:"bayt",verb:"olmal"},array:{unit:"e",verb:"olmal"},set:{unit:"e",verb:"olmal"}},t={regex:"girdi",email:"e-posta adresi",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO tarih ve saat",date:"ISO tarih",time:"ISO saat",duration:"ISO sre",ipv4:"IPv4 adresi",ipv6:"IPv6 adresi",cidrv4:"IPv4 aral",cidrv6:"IPv6 aral",base64:"base64 ile ifrelenmi metin",base64url:"base64url ile ifrelenmi metin",json_string:"JSON dizesi",e164:"E.164 says",jwt:"JWT",template_literal:"ablon dizesi"},r=>{switch(r.code){case"invalid_type":return`Ge\xe7ersiz deer: beklenen ${r.expected}, alnan ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ge\xe7ersiz deer: beklenen ${oZ(r.values[0])}`;return`Ge\xe7ersiz se\xe7enek: aadakilerden biri olmal: ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`\xc7ok b\xfcy\xfck: beklenen ${r.origin??"deer"} ${t}${r.maximum.toString()} ${i.unit??"e"}`;return`\xc7ok b\xfcy\xfck: beklenen ${r.origin??"deer"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`\xc7ok k\xfc\xe7\xfck: beklenen ${r.origin} ${t}${r.minimum.toString()} ${i.unit}`;return`\xc7ok k\xfc\xe7\xfck: beklenen ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Ge\xe7ersiz metin: "${r.prefix}" ile balamal`;if("ends_with"===r.format)return`Ge\xe7ersiz metin: "${r.suffix}" ile bitmeli`;if("includes"===r.format)return`Ge\xe7ersiz metin: "${r.includes}" i\xe7ermeli`;if("regex"===r.format)return`Ge\xe7ersiz metin: ${r.pattern} desenine uymal`;return`Ge\xe7ersiz ${t[r.format]??r.format}`;case"not_multiple_of":return`Ge\xe7ersiz say: ${r.divisor} ile tam b\xf6l\xfcnebilmeli`;case"unrecognized_keys":return`Tannmayan anahtar${r.keys.length>1?"lar":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`${r.origin} i\xe7inde ge\xe7ersiz anahtar`;case"invalid_union":return"Geersiz deer";case"invalid_element":return`${r.origin} i\xe7inde ge\xe7ersiz deer`;default:return`Ge\xe7ersiz deer`}})}},"ua",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:" ",email:"  ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:"   base64",base64url:"   base64url",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:" "},r=>{switch(r.code){case"invalid_type":return`  :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`  :  ${oZ(r.values[0])}`;return` :    ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ,  ${r.origin??""} ${i.verb} ${t}${r.maximum.toString()} ${i.unit??""}`;return` : ,  ${r.origin??""}  ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ,  ${r.origin} ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return` : ,  ${r.origin}  ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :    "${r.prefix}"`;if("ends_with"===r.format)return` :    "${r.suffix}"`;if("includes"===r.format)return` :   "${r.includes}"`;if("regex"===r.format)return` :    ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` :    ${r.divisor}`;case"unrecognized_keys":return` ${r.keys.length>1?"":""}: ${ob(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${r.origin}`;default:return`  `}})}},"ur",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:" ",email:"  ",url:"  ",emoji:"",uuid:"   ",uuidv4:"     4",uuidv6:"     6",nanoid:"  ",guid:"   ",cuid:"   ",cuid2:"    2",ulid:"   ",xid:"  ",ksuid:"    ",datetime:"    ",date:"   ",time:"   ",duration:"   ",ipv4:"   4 ",ipv6:"   6 ",cidrv4:"   4 ",cidrv6:"   6 ",base64:" 64   ",base64url:" 64      ",json_string:"    ",e164:" 164 ",jwt:"  ",template_literal:" "},r=>{switch(r.code){case"invalid_type":return`  : ${r.expected}   ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}  `;case"invalid_value":if(1===r.values.length)return`  : ${oZ(r.values[0])}  `;return` : ${ob(r.values,"|")}     `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""}   `;return` : ${r.origin??""}  ${t}${r.maximum.toString()}   `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ${r.origin}  ${t}${r.minimum.toString()} ${i.unit}   `;return` : ${r.origin}  ${t}${r.minimum.toString()}   `}case"invalid_format":if("starts_with"===r.format)return` : "${r.prefix}"    `;if("ends_with"===r.format)return` : "${r.suffix}"    `;if("includes"===r.format)return` : "${r.includes}"   `;if("regex"===r.format)return` :  ${r.pattern}    `;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` : ${r.divisor}    `;case"unrecognized_keys":return`   ${r.keys.length>1?"":""}: ${ob(r.keys," ")}`;case"invalid_key":return`${r.origin}   `;case"invalid_union":return"  ";case"invalid_element":return`${r.origin}   `;default:return`  `}})}},"vi",0,function(){let e,t;return{localeError:(e={string:{unit:"k t",verb:"c"},file:{unit:"byte",verb:"c"},array:{unit:"phn t",verb:"c"},set:{unit:"phn t",verb:"c"}},t={regex:"u vo",email:"a ch email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ngy gi ISO",date:"ngy ISO",time:"gi ISO",duration:"khong thi gian ISO",ipv4:"a ch IPv4",ipv6:"a ch IPv6",cidrv4:"di IPv4",cidrv6:"di IPv6",base64:"chui m ha base64",base64url:"chui m ha base64url",json_string:"chui JSON",e164:"s E.164",jwt:"JWT",template_literal:"u vo"},r=>{switch(r.code){case"invalid_type":return`u v\xe0o kh\xf4ng hp l: mong i ${r.expected}, nhn c ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"s";case"object":if(Array.isArray(e))return"mng";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`u v\xe0o kh\xf4ng hp l: mong i ${oZ(r.values[0])}`;return`T\xf9y chn kh\xf4ng hp l: mong i mt trong c\xe1c gi\xe1 tr ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Qu\xe1 ln: mong i ${r.origin??"gi tr"} ${i.verb} ${t}${r.maximum.toString()} ${i.unit??"phn t"}`;return`Qu\xe1 ln: mong i ${r.origin??"gi tr"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Qu\xe1 nh: mong i ${r.origin} ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return`Qu\xe1 nh: mong i ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Chui kh\xf4ng hp l: phi bt u bng "${r.prefix}"`;if("ends_with"===r.format)return`Chui kh\xf4ng hp l: phi kt th\xfac bng "${r.suffix}"`;if("includes"===r.format)return`Chui kh\xf4ng hp l: phi bao gm "${r.includes}"`;if("regex"===r.format)return`Chui kh\xf4ng hp l: phi khp vi mu ${r.pattern}`;return`${t[r.format]??r.format} kh\xf4ng hp l`;case"not_multiple_of":return`S kh\xf4ng hp l: phi l\xe0 bi s ca ${r.divisor}`;case"unrecognized_keys":return`Kh\xf3a kh\xf4ng c nhn dng: ${ob(r.keys,", ")}`;case"invalid_key":return`Kh\xf3a kh\xf4ng hp l trong ${r.origin}`;case"invalid_union":return"u vo khng hp l";case"invalid_element":return`Gi\xe1 tr kh\xf4ng hp l trong ${r.origin}`;default:return`u v\xe0o kh\xf4ng hp l`}})}},"zhCN",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` ${r.expected} ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"(NaN)":"";case"object":if(Array.isArray(e))return"";if(null===e)return"(null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` ${oZ(r.values[0])}`;return` ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` ${r.origin??""} ${t}${r.maximum.toString()} ${i.unit??""}`;return` ${r.origin??""} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` ${r.origin} ${t}${r.minimum.toString()} ${i.unit}`;return` ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` "${r.prefix}" `;if("ends_with"===r.format)return` "${r.suffix}" `;if("includes"===r.format)return` "${r.includes}"`;if("regex"===r.format)return` ${r.pattern}`;return`${t[r.format]??r.format}`;case"not_multiple_of":return` ${r.divisor} `;case"unrecognized_keys":return`(key): ${ob(r.keys,", ")}`;case"invalid_key":return`${r.origin} (key)`;case"invalid_union":return"";case"invalid_element":return`${r.origin} (value)`;default:return``}})}},"zhTW",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64 ",base64url:"base64url ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` ${r.expected} ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` ${oZ(r.values[0])}`;return` ${ob(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""}`;return` ${r.origin??""}  ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` ${r.origin}  ${t}${r.minimum.toString()} ${i.unit}`;return` ${r.origin}  ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` "${r.prefix}" `;if("ends_with"===r.format)return` "${r.suffix}" `;if("includes"===r.format)return` "${r.includes}"`;if("regex"===r.format)return` ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` ${r.divisor} `;case"unrecognized_keys":return`${r.keys.length>1?"":""}${ob(r.keys,"")}`;case"invalid_key":return`${r.origin} `;case"invalid_union":return"";case"invalid_element":return`${r.origin} `;default:return``}})}}],63133);var ER=e.i(63133);e.i(947483),e.i(748059),e.i(115225),e.i(143191),e.i(864457);var Ej=e.i(279795);e.s(["$ZodAny",0,uV,"$ZodArray",0,u4,"$ZodAsyncError",()=>od,"$ZodBase64",0,uU,"$ZodBase64URL",0,uD,"$ZodBigInt",0,uH,"$ZodBigIntFormat",0,uq,"$ZodBoolean",0,uG,"$ZodCIDRv4",0,uP,"$ZodCIDRv6",0,uR,"$ZodCUID",0,uE,"$ZodCUID2",0,uT,"$ZodCatch",0,cb,"$ZodCheck",0,lY,"$ZodCheckBigIntFormat",0,l2,"$ZodCheckEndsWith",0,us,"$ZodCheckGreaterThan",0,l0,"$ZodCheckIncludes",0,un,"$ZodCheckLengthEquals",0,l7,"$ZodCheckLessThan",0,lQ,"$ZodCheckLowerCase",0,ur,"$ZodCheckMaxLength",0,l5,"$ZodCheckMaxSize",0,l6,"$ZodCheckMimeType",0,uu,"$ZodCheckMinLength",0,l8,"$ZodCheckMinSize",0,l9,"$ZodCheckMultipleOf",0,l1,"$ZodCheckNumberFormat",0,l4,"$ZodCheckOverwrite",0,uc,"$ZodCheckProperty",0,ul,"$ZodCheckRegex",0,ut,"$ZodCheckSizeEquals",0,l3,"$ZodCheckStartsWith",0,ua,"$ZodCheckStringFormat",0,ue,"$ZodCheckUpperCase",0,ui,"$ZodCustom",0,cx,"$ZodDate",0,u0,"$ZodDefault",0,cf,"$ZodDiscriminatedUnion",0,u8,"$ZodE164",0,uM,"$ZodEmail",0,u_,"$ZodEmoji",0,ub,"$ZodEnum",0,cl,"$ZodError",0,o7,"$ZodFile",0,cc,"$ZodFunction",()=>hv,"$ZodGUID",0,ug,"$ZodIPv4",0,uC,"$ZodIPv6",0,uN,"$ZodISODate",0,uk,"$ZodISODateTime",0,uA,"$ZodISODuration",0,u$,"$ZodISOTime",0,ux,"$ZodIntersection",0,u7,"$ZodJWT",0,uF,"$ZodKSUID",0,uO,"$ZodLazy",0,ck,"$ZodLiteral",0,cu,"$ZodMap",0,cn,"$ZodNaN",0,cw,"$ZodNanoID",0,uw,"$ZodNever",0,uX,"$ZodNonOptional",0,cy,"$ZodNull",0,uJ,"$ZodNullable",0,cp,"$ZodNumber",0,uB,"$ZodNumberFormat",0,uZ,"$ZodObject",0,u9,"$ZodOptional",0,ch,"$ZodPipe",0,cE,"$ZodPrefault",0,cg,"$ZodPromise",0,cA,"$ZodReadonly",0,cS,"$ZodRealError",0,le,"$ZodRecord",0,ci,"$ZodRegistry",()=>cU,"$ZodSet",0,cs,"$ZodString",0,uf,"$ZodStringFormat",0,um,"$ZodSuccess",0,cv,"$ZodSymbol",0,uW,"$ZodTemplateLiteral",0,cO,"$ZodTransform",0,cd,"$ZodTuple",0,ct,"$ZodType",0,up,"$ZodULID",0,uS,"$ZodURL",0,uv,"$ZodUUID",0,uy,"$ZodUndefined",0,uK,"$ZodUnion",0,u5,"$ZodUnknown",0,uY,"$ZodVoid",0,uQ,"$ZodXID",0,uI,"$brand",0,oc,"$constructor",()=>ou,"$input",0,cj,"$output",0,cR,"Doc",()=>ud,"JSONSchema",0,Ej,"JSONSchemaGenerator",()=>hw,"TimePrecision",0,c7,"_any",()=>dw,"_array",()=>d4,"_base64",()=>c9,"_base64url",()=>c3,"_bigint",()=>df,"_boolean",()=>dh,"_catch",()=>hc,"_cidrv4",()=>c2,"_cidrv6",()=>c6,"_coercedBigint",()=>dm,"_coercedBoolean",()=>dp,"_coercedDate",()=>dO,"_coercedNumber",()=>da,"_coercedString",()=>cz,"_cuid",()=>cV,"_cuid2",()=>cY,"_custom",()=>hg,"_date",()=>dI,"_default",()=>ho,"_discriminatedUnion",()=>d6,"_e164",()=>c5,"_email",()=>cF,"_emoji",()=>cK,"_endsWith",()=>dK,"_enum",()=>he,"_file",()=>hi,"_float32",()=>dl,"_float64",()=>du,"_gt",()=>d$,"_gte",()=>dC,"_guid",()=>cB,"_includes",()=>dq,"_int",()=>ds,"_int32",()=>dc,"_int64",()=>dg,"_intersection",()=>d9,"_ipv4",()=>c1,"_ipv6",()=>c4,"_isoDate",()=>dt,"_isoDateTime",()=>de,"_isoDuration",()=>di,"_isoTime",()=>dr,"_jwt",()=>c8,"_ksuid",()=>c0,"_lazy",()=>hf,"_length",()=>dB,"_literal",()=>hr,"_lowercase",()=>dG,"_lt",()=>dk,"_lte",()=>dx,"_map",()=>d8,"_max",()=>dx,"_maxLength",()=>dz,"_maxSize",()=>dL,"_mime",()=>dV,"_min",()=>dC,"_minLength",()=>dF,"_minSize",()=>dD,"_multipleOf",()=>dU,"_nan",()=>dA,"_nanoid",()=>cJ,"_nativeEnum",()=>ht,"_negative",()=>dP,"_never",()=>dT,"_nonnegative",()=>dj,"_nonoptional",()=>hl,"_nonpositive",()=>dR,"_normalize",()=>dX,"_null",()=>db,"_nullable",()=>hs,"_number",()=>dn,"_optional",()=>ha,"_overwrite",()=>dY,"_parse",0,ls,"_parseAsync",0,ll,"_pipe",()=>hd,"_positive",()=>dN,"_promise",()=>hm,"_property",()=>dJ,"_readonly",()=>hh,"_record",()=>d5,"_refine",()=>hy,"_regex",()=>dZ,"_safeParse",0,lc,"_safeParseAsync",0,lh,"_set",()=>d7,"_size",()=>dM,"_startsWith",()=>dW,"_string",()=>cM,"_stringbool",()=>h_,"_success",()=>hu,"_symbol",()=>d_,"_templateLiteral",()=>hp,"_toLowerCase",()=>d0,"_toUpperCase",()=>d1,"_transform",()=>hn,"_trim",()=>dQ,"_tuple",()=>d3,"_uint32",()=>dd,"_uint64",()=>dy,"_ulid",()=>cX,"_undefined",()=>dv,"_union",()=>d2,"_unknown",()=>dE,"_uppercase",()=>dH,"_url",()=>cW,"_uuid",()=>cZ,"_uuidv4",()=>cG,"_uuidv6",()=>cH,"_uuidv7",()=>cq,"_void",()=>dS,"_xid",()=>cQ,"clone",()=>oz,"config",()=>op,"flattenError",()=>lt,"formatError",()=>lr,"function",()=>hb,"globalConfig",0,oh,"globalRegistry",0,cD,"isValidBase64",()=>uj,"isValidBase64URL",()=>uL,"isValidJWT",()=>uz,"locales",0,ER,"parse",0,lo,"parseAsync",0,lu,"prettifyError",()=>la,"regexes",0,EP,"registry",()=>cL,"safeParse",0,ld,"safeParseAsync",0,lp,"toDotPath",()=>ln,"toJSONSchema",()=>hE,"treeifyError",()=>li,"util",0,EN,"version",0,uh],350339);var EU=e.i(350339);e.i(45770),e.i(841213),e.s(["endsWith",()=>dK,"gt",()=>d$,"gte",()=>dC,"includes",()=>dq,"length",()=>dB,"lowercase",()=>dG,"lt",()=>dk,"lte",()=>dx,"maxLength",()=>dz,"maxSize",()=>dL,"mime",()=>dV,"minLength",()=>dF,"minSize",()=>dD,"multipleOf",()=>dU,"negative",()=>dP,"nonnegative",()=>dj,"nonpositive",()=>dR,"normalize",()=>dX,"overwrite",()=>dY,"positive",()=>dN,"property",()=>dJ,"regex",()=>dZ,"size",()=>dM,"startsWith",()=>dW,"toLowerCase",()=>d0,"toUpperCase",()=>d1,"trim",()=>dQ,"uppercase",()=>dH],666098),e.i(666098),e.i(122538),e.i(655937),e.i(170787),e.s(["$brand",0,oc,"NEVER",0,ES,"ZodIssueCode",0,ET,"config",()=>op,"getErrorMap",()=>EO,"setErrorMap",()=>EI],730686),e.i(730686);var EL=e.i(599290),ED=e.i(684822);e.s(["$brand",0,oc,"$input",0,cj,"$output",0,cR,"NEVER",0,ES,"TimePrecision",0,c7,"ZodAny",0,wc,"ZodArray",0,wb,"ZodBase64",0,bH,"ZodBase64URL",0,bW,"ZodBigInt",0,b7,"ZodBigIntFormat",0,wt,"ZodBoolean",0,b5,"ZodCIDRv4",0,bF,"ZodCIDRv6",0,bZ,"ZodCUID",0,bA,"ZodCUID2",0,bx,"ZodCatch",0,Ee,"ZodCustom",0,Ef,"ZodDate",0,w_,"ZodDefault",0,w4,"ZodDiscriminatedUnion",0,wx,"ZodE164",0,bJ,"ZodEmail",0,bh,"ZodEmoji",0,bT,"ZodEnum",0,wB,"ZodError",0,bt,"ZodFile",0,wW,"ZodGUID",0,bf,"ZodIPv4",0,bL,"ZodIPv6",0,bM,"ZodISODate",0,v6,"ZodISODateTime",0,v4,"ZodISODuration",0,v8,"ZodISOTime",0,v3,"ZodIntersection",0,wC,"ZodIssueCode",0,ET,"ZodJWT",0,bY,"ZodKSUID",0,bj,"ZodLazy",0,Ec,"ZodLiteral",0,wH,"ZodMap",0,wD,"ZodNaN",0,Er,"ZodNanoID",0,bI,"ZodNever",0,wf,"ZodNonOptional",0,w3,"ZodNull",0,wl,"ZodNullable",0,wQ,"ZodNumber",0,bQ,"ZodNumberFormat",0,b1,"ZodObject",0,wT,"ZodOptional",0,wY,"ZodPipe",0,En,"ZodPrefault",0,w6,"ZodPromise",0,Eh,"ZodReadonly",0,Es,"ZodRealError",0,br,"ZodRecord",0,wj,"ZodSet",0,wz,"ZodString",0,bu,"ZodStringFormat",0,bd,"ZodSuccess",0,w8,"ZodSymbol",0,wn,"ZodTemplateLiteral",0,El,"ZodTransform",0,wJ,"ZodTuple",0,wP,"ZodType",0,bo,"ZodULID",0,bC,"ZodURL",0,bw,"ZodUUID",0,bg,"ZodUndefined",0,ws,"ZodUnion",0,wA,"ZodUnknown",0,wh,"ZodVoid",0,wg,"ZodXID",0,bP,"_ZodString",0,bl,"_default",()=>w2,"any",()=>wd,"array",()=>ww,"base64",()=>bq,"base64url",()=>bK,"bigint",()=>we,"boolean",()=>b8,"catch",()=>Et,"check",()=>Em,"cidrv4",()=>bB,"cidrv6",()=>bG,"clone",()=>oz,"coerce",0,ED,"config",()=>op,"core",0,EU,"cuid",()=>bk,"cuid2",()=>b$,"custom",()=>Eg,"date",()=>wv,"discriminatedUnion",()=>w$,"e164",()=>bV,"email",()=>bp,"emoji",()=>bS,"endsWith",()=>dK,"enum",()=>wZ,"file",()=>wK,"flattenError",()=>lt,"float32",()=>b2,"float64",()=>b6,"formatError",()=>lr,"function",()=>hb,"getErrorMap",()=>EO,"globalRegistry",0,cD,"gt",()=>d$,"gte",()=>dC,"guid",()=>bm,"includes",()=>dq,"instanceof",()=>Ev,"int",()=>b4,"int32",()=>b9,"int64",()=>wr,"intersection",()=>wN,"ipv4",()=>bD,"ipv6",()=>bz,"iso",0,EL,"json",()=>Ew,"jwt",()=>bX,"keyof",()=>wE,"ksuid",()=>bU,"lazy",()=>Ed,"length",()=>dB,"literal",()=>wq,"locales",0,ER,"looseObject",()=>wO,"lowercase",()=>dG,"lt",()=>dk,"lte",()=>dx,"map",()=>wM,"maxLength",()=>dz,"maxSize",()=>dL,"mime",()=>dV,"minLength",()=>dF,"minSize",()=>dD,"multipleOf",()=>dU,"nan",()=>Ei,"nanoid",()=>bO,"nativeEnum",()=>wG,"negative",()=>dP,"never",()=>wm,"nonnegative",()=>dj,"nonoptional",()=>w5,"nonpositive",()=>dR,"normalize",()=>dX,"null",()=>wu,"nullable",()=>w0,"nullish",()=>w1,"number",()=>b0,"object",()=>wS,"optional",()=>wX,"overwrite",()=>dY,"parse",0,bi,"parseAsync",0,bn,"partialRecord",()=>wL,"pipe",()=>Ea,"positive",()=>dN,"prefault",()=>w9,"preprocess",()=>EE,"prettifyError",()=>la,"promise",()=>Ep,"property",()=>dJ,"readonly",()=>Eo,"record",()=>wU,"refine",()=>Ey,"regex",()=>dZ,"regexes",()=>EP,"registry",()=>cL,"safeParse",0,ba,"safeParseAsync",0,bs,"set",()=>wF,"setErrorMap",()=>EI,"size",()=>dM,"startsWith",()=>dW,"strictObject",()=>wI,"string",()=>bc,"stringbool",0,Eb,"success",()=>w7,"superRefine",()=>E_,"symbol",()=>wa,"templateLiteral",()=>Eu,"toJSONSchema",()=>hE,"toLowerCase",()=>d0,"toUpperCase",()=>d1,"transform",()=>wV,"treeifyError",()=>li,"trim",()=>dQ,"tuple",()=>wR,"uint32",()=>b3,"uint64",()=>wi,"ulid",()=>bN,"undefined",()=>wo,"union",()=>wk,"unknown",()=>wp,"uppercase",()=>dH,"url",()=>bE,"uuid",()=>by,"uuidv4",()=>b_,"uuidv6",()=>bv,"uuidv7",()=>bb,"void",()=>wy,"xid",()=>bR],184516);var EM=e.i(184516);e.s(["default",0,EM],186279),e.i(186279);iI({},{BaseToolkit:()=>EG,DynamicStructuredTool:()=>EZ,DynamicTool:()=>EB,StructuredTool:()=>Ez,Tool:()=>EF,ToolInputParsingException:()=>nw,isLangChainTool:()=>gO,isRunnableToolLike:()=>gS,isStructuredTool:()=>gT,isStructuredToolParams:()=>gI,tool:()=>EH});var Ez=class extends mI{extras;returnDirect=!1;verboseParsingErrors=!1;get lc_namespace(){return["langchain","tools"]}responseFormat="content";defaultConfig;constructor(e){super(e??{}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat,this.defaultConfig=e?.defaultConfig??this.defaultConfig,this.metadata=e?.metadata??this.metadata,this.extras=e?.extras??this.extras}async invoke(e,t){let r,i=s3(s6(this.defaultConfig,t));return nb(e)?(r=e.args,i={...i,toolCall:e}):r=e,this.call(r,i)}async call(e,t,r){let i,n,a,s,o,l=nb(e)?e.args:e;if(hA(this.schema))try{i=await hN(this.schema,l)}catch(r){let t="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(t=`${t}
Details: ${r.message}`),hY(r)&&(t=`${t}

${EM.prettifyError(r)}`),new nw(t,JSON.stringify(e))}else{let t=pL(l,this.schema);if(!t.valid){let r="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(r=`${r}
Details: ${t.errors.map(e=>`${e.keywordLocation}: ${e.error}`).join("\n")}`),new nw(r,JSON.stringify(e))}i=l}let u=sG(t),c=sY.configure(u.callbacks,this.callbacks,u.tags||r,this.tags,u.metadata,this.metadata,{verbose:this.verbose}),d=await c?.handleToolStart(this.toJSON(),"string"==typeof e?e:JSON.stringify(e),u.runId,void 0,void 0,void 0,u.runName);delete u.runId;try{n=await this._call(i,d,u)}catch(e){throw await d?.handleToolError(e),e}if("content_and_artifact"===this.responseFormat)if(Array.isArray(n)&&2===n.length)[a,s]=n;else throw Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(n)}`);else a=n;nb(e)&&(o=e.id),!o&&u&&"object"==typeof u&&"toolCall"in u&&null!=u.toolCall&&"object"==typeof u.toolCall&&"id"in u.toolCall&&"string"==typeof u.toolCall.id&&(o=u.toolCall.id);let h=function(e){let{content:t,artifact:r,toolCallId:i,metadata:n}=e;return!i||np(t)?t:new nf("string"==typeof t||Array.isArray(t)&&t.every(e=>"object"==typeof e)?{status:"success",content:t,artifact:r,tool_call_id:i,name:e.name,metadata:n}:{status:"success",content:function(e){try{return JSON.stringify(e,null,2)??""}catch(t){return`${e}`}}(t),artifact:r,tool_call_id:i,name:e.name,metadata:n})}({content:a,artifact:s,toolCallId:o,name:this.name,metadata:this.metadata});return await d?.handleToolEnd(h),h}},EF=class extends Ez{schema=fC.z.object({input:fC.z.string().optional()}).transform(e=>e.input);constructor(e){super(e)}call(e,t){return super.call("string"==typeof e||null==e?{input:e}:e,t)}},EB=class extends EF{static lc_name(){return"DynamicTool"}name;description;func;constructor(e){super(e),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async call(e,t){let r=sG(t);return void 0===r.runName&&(r.runName=this.name),super.call(e,r)}async _call(e,t,r){return this.func(e,t,r)}},EZ=class extends Ez{static lc_name(){return"DynamicStructuredTool"}name;description;func;schema;constructor(e){super(e),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,t,r){let i=sG(t);return void 0===i.runName&&(i.runName=this.name),super.call(e,i,r)}_call(e,t,r){return this.func(e,t,r)}},EG=class{getTools(){return this.tools}};function EH(e,t){let r=hL(t.schema),i=pz(t.schema);if(!t.schema||r||i)return new EB({...t,description:t.description??t.schema?.description??`${t.name} tool`,func:async(t,r,i)=>new Promise((n,a)=>{let s=s5(i,{callbacks:r?.getChild()});s4.runWithConfig(s8(s),async()=>{try{n(e(t,s))}catch(e){a(e)}})})});let n=t.schema,a=t.description??t.schema.description??`${t.name} tool`;return new EZ({...t,description:a,schema:n,func:async(t,r,i)=>new Promise((n,a)=>{let s,o=()=>{i?.signal&&s&&i.signal.removeEventListener("abort",s)};i?.signal&&(s=()=>{o(),a(oe(i.signal))},i.signal.addEventListener("abort",s));let l=s5(i,{callbacks:r?.getChild()});s4.runWithConfig(s8(l),async()=>{try{let r=await e(t,l);if(i?.signal?.aborted)return void o();o(),n(r)}catch(e){o(),a(e)}})})})}e.s(["DynamicTool",()=>EB,"Tool",()=>EF,"tool",()=>EH],703932),Object.defineProperty(class extends EF{static lc_name(){return"DallEAPIWrapper"}constructor(e){e?.responseFormat!==void 0&&["url","b64_json"].includes(e.responseFormat)&&(e.dallEResponseFormat=e.responseFormat,e.responseFormat="content"),super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"dallEResponseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t={apiKey:e?.apiKey??e?.openAIApiKey??iP("OPENAI_API_KEY"),organization:e?.organization??iP("OPENAI_ORGANIZATION"),dangerouslyAllowBrowser:!0,baseURL:e?.baseUrl};this.client=new vo(t),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.dallEResponseFormat=e?.dallEResponseFormat??this.dallEResponseFormat,this.user=e?.user}processMultipleGeneratedUrls(e){return"url"===this.dallEResponseFormat?e.flatMap(e=>e.data?.flatMap(e=>e.url?{type:"image_url",image_url:e.url}:[]).filter(e=>void 0!==e&&"image_url"===e.type&&"string"==typeof e.image_url&&void 0!==e.image_url)??[]):e.flatMap(e=>e.data?.flatMap(e=>e.b64_json?{type:"image_url",image_url:{url:e.b64_json}}:[]).filter(e=>void 0!==e&&"image_url"===e.type&&"object"==typeof e.image_url&&"url"in e.image_url&&"string"==typeof e.image_url.url&&void 0!==e.image_url.url)??[])}async _call(e){let t={model:this.model,prompt:e,n:1,size:this.size,response_format:this.dallEResponseFormat,style:this.style,quality:this.quality,user:this.user};if(this.n>1){let e=await Promise.all(Array.from({length:this.n}).map(()=>this.client.images.generate(t)));return this.processMultipleGeneratedUrls(e)}let r=await this.client.images.generate(t),i="";return"url"===this.dallEResponseFormat?[i]=r.data?.map(e=>e.url).filter(e=>"undefined"!==e)??[]:[i]=r.data?.map(e=>e.b64_json).filter(e=>"undefined"!==e)??[],i}},"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),e.i(427471),e.i(522734);var Eq=e.i(924868);e.i(81111),e.i(188646),e.i(366212),e.i(217953),e.i(260238);var EW=e.i(106281);e.i(903441),EW.default;var EK=e.i(814747);(Q=r$||(r$={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",Q.OUTCOME_OK="OUTCOME_OK",Q.OUTCOME_FAILED="OUTCOME_FAILED",Q.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(ee=rC||(rC={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",ee.PYTHON="PYTHON",(et=rN||(rN={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",et.SILENT="SILENT",et.WHEN_IDLE="WHEN_IDLE",et.INTERRUPT="INTERRUPT",(er=rP||(rP={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",er.STRING="STRING",er.NUMBER="NUMBER",er.INTEGER="INTEGER",er.BOOLEAN="BOOLEAN",er.ARRAY="ARRAY",er.OBJECT="OBJECT",er.NULL="NULL",(ei=rR||(rR={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",ei.MODE_DYNAMIC="MODE_DYNAMIC",(en=rj||(rj={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",en.SIMPLE_SEARCH="SIMPLE_SEARCH",en.ELASTIC_SEARCH="ELASTIC_SEARCH",(ea=rU||(rU={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",ea.NO_AUTH="NO_AUTH",ea.API_KEY_AUTH="API_KEY_AUTH",ea.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",ea.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",ea.OAUTH="OAUTH",ea.OIDC_AUTH="OIDC_AUTH",(es=rL||(rL={})).HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",es.HTTP_IN_QUERY="HTTP_IN_QUERY",es.HTTP_IN_HEADER="HTTP_IN_HEADER",es.HTTP_IN_PATH="HTTP_IN_PATH",es.HTTP_IN_BODY="HTTP_IN_BODY",es.HTTP_IN_COOKIE="HTTP_IN_COOKIE",(eo=rD||(rD={})).PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",eo.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",eo.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",eo.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",eo.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",eo.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",eo.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH",(el=rM||(rM={})).THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",el.LOW="LOW",el.HIGH="HIGH",(eu=rz||(rz={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",eu.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",eu.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",eu.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",eu.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",eu.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",eu.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",eu.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",eu.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",eu.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",eu.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(ec=rF||(rF={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",ec.SEVERITY="SEVERITY",ec.PROBABILITY="PROBABILITY",(ed=rB||(rB={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",ed.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",ed.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",ed.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",ed.BLOCK_NONE="BLOCK_NONE",ed.OFF="OFF",(eh=rZ||(rZ={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",eh.STOP="STOP",eh.MAX_TOKENS="MAX_TOKENS",eh.SAFETY="SAFETY",eh.RECITATION="RECITATION",eh.LANGUAGE="LANGUAGE",eh.OTHER="OTHER",eh.BLOCKLIST="BLOCKLIST",eh.PROHIBITED_CONTENT="PROHIBITED_CONTENT",eh.SPII="SPII",eh.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",eh.IMAGE_SAFETY="IMAGE_SAFETY",eh.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",eh.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",eh.NO_IMAGE="NO_IMAGE",(ep=rG||(rG={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",ep.NEGLIGIBLE="NEGLIGIBLE",ep.LOW="LOW",ep.MEDIUM="MEDIUM",ep.HIGH="HIGH",(ef=rH||(rH={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",ef.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",ef.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",ef.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",ef.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(em=rq||(rq={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",em.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",em.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",em.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",em.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(eg=rW||(rW={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",eg.SAFETY="SAFETY",eg.OTHER="OTHER",eg.BLOCKLIST="BLOCKLIST",eg.PROHIBITED_CONTENT="PROHIBITED_CONTENT",eg.IMAGE_SAFETY="IMAGE_SAFETY",eg.MODEL_ARMOR="MODEL_ARMOR",eg.JAILBREAK="JAILBREAK",(ey=rK||(rK={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",ey.ON_DEMAND="ON_DEMAND",ey.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(e_=rJ||(rJ={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e_.TEXT="TEXT",e_.IMAGE="IMAGE",e_.AUDIO="AUDIO",(ev=rV||(rV={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",ev.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",ev.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",ev.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(eb=rY||(rY={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",eb.TUNING_MODE_FULL="TUNING_MODE_FULL",eb.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(ew=rX||(rX={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",ew.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",ew.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",ew.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",ew.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",ew.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",ew.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(eE=rQ||(rQ={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",eE.JOB_STATE_QUEUED="JOB_STATE_QUEUED",eE.JOB_STATE_PENDING="JOB_STATE_PENDING",eE.JOB_STATE_RUNNING="JOB_STATE_RUNNING",eE.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",eE.JOB_STATE_FAILED="JOB_STATE_FAILED",eE.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",eE.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",eE.JOB_STATE_PAUSED="JOB_STATE_PAUSED",eE.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",eE.JOB_STATE_UPDATING="JOB_STATE_UPDATING",eE.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(eT=r0||(r0={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",eT.TUNING_TASK_I2V="TUNING_TASK_I2V",eT.TUNING_TASK_T2V="TUNING_TASK_T2V",eT.TUNING_TASK_R2V="TUNING_TASK_R2V",(eS=r1||(r1={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",eS.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",eS.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",eS.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(eI=r4||(r4={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",eI.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",eI.BALANCED="BALANCED",eI.PRIORITIZE_COST="PRIORITIZE_COST",(eO=r2||(r2={})).UNSPECIFIED="UNSPECIFIED",eO.BLOCKING="BLOCKING",eO.NON_BLOCKING="NON_BLOCKING",(eA=r6||(r6={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",eA.MODE_DYNAMIC="MODE_DYNAMIC",(ek=r9||(r9={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",ek.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",(ex=r3||(r3={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",ex.AUTO="AUTO",ex.ANY="ANY",ex.NONE="NONE",ex.VALIDATED="VALIDATED",(e$=r5||(r5={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e$.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e$.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e$.BLOCK_NONE="BLOCK_NONE",(eC=r8||(r8={})).DONT_ALLOW="DONT_ALLOW",eC.ALLOW_ADULT="ALLOW_ADULT",eC.ALLOW_ALL="ALLOW_ALL",(eN=r7||(r7={})).auto="auto",eN.en="en",eN.ja="ja",eN.ko="ko",eN.hi="hi",eN.zh="zh",eN.pt="pt",eN.es="es",(eP=ie||(ie={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",eP.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",eP.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",eP.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",eP.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",(eR=it||(it={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",eR.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",eR.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",eR.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(ej=ir||(ir={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",ej.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",ej.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",ej.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",(eU=ii||(ii={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",eU.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",eU.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",eU.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",eU.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",eU.EDIT_MODE_STYLE="EDIT_MODE_STYLE",eU.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",eU.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(eL=ia||(ia={})).FOREGROUND="FOREGROUND",eL.BACKGROUND="BACKGROUND",eL.PROMPT="PROMPT",eL.SEMANTIC="SEMANTIC",eL.INTERACTIVE="INTERACTIVE",(eD=is||(is={})).ASSET="ASSET",eD.STYLE="STYLE",(eM=io||(io={})).INSERT="INSERT",eM.REMOVE="REMOVE",eM.REMOVE_STATIC="REMOVE_STATIC",eM.OUTPAINT="OUTPAINT",(ez=il||(il={})).OPTIMIZED="OPTIMIZED",ez.LOSSLESS="LOSSLESS",(eF=iu||(iu={})).SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",eF.PREFERENCE_TUNING="PREFERENCE_TUNING",(eB=ic||(ic={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",eB.STATE_PENDING="STATE_PENDING",eB.STATE_ACTIVE="STATE_ACTIVE",eB.STATE_FAILED="STATE_FAILED",(eZ=id||(id={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",eZ.PROCESSING="PROCESSING",eZ.ACTIVE="ACTIVE",eZ.FAILED="FAILED",(eG=ih||(ih={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",eG.UPLOADED="UPLOADED",eG.GENERATED="GENERATED",(eH=ip||(ip={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",eH.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",eH.RESPONSE_REJECTED="RESPONSE_REJECTED",eH.NEED_MORE_INPUT="NEED_MORE_INPUT",(eq=im||(im={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",eq.TEXT="TEXT",eq.IMAGE="IMAGE",eq.VIDEO="VIDEO",eq.AUDIO="AUDIO",eq.DOCUMENT="DOCUMENT",(eW=ig||(ig={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",eW.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",eW.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(eK=iy||(iy={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",eK.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",eK.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",(eJ=i_||(i_={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",eJ.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",eJ.NO_INTERRUPTION="NO_INTERRUPTION",(eV=iv||(iv={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",eV.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",eV.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(eY=ib||(ib={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",eY.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",eY.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",eY.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",eY.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",eY.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",eY.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",eY.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",eY.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",eY.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",eY.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",eY.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",eY.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(eX=iw||(iw={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",eX.QUALITY="QUALITY",eX.DIVERSITY="DIVERSITY",eX.VOCALIZATION="VOCALIZATION",(eQ=iE||(iE={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",eQ.PLAY="PLAY",eQ.PAUSE="PAUSE",eQ.STOP="STOP",eQ.RESET_CONTEXT="RESET_CONTEXT",(e0=iT||(iT={})).PAGED_ITEM_BATCH_JOBS="batchJobs",e0.PAGED_ITEM_MODELS="models",e0.PAGED_ITEM_TUNING_JOBS="tuningJobs",e0.PAGED_ITEM_FILES="files",e0.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e0.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e0.PAGED_ITEM_DOCUMENTS="documents","function"==typeof SuppressedError&&SuppressedError,e.i(791146),e.i(832821);let EJ=(e,t,r)=>{let{model:i="gpt-5-nano",temperature:n=1,maxTokens:a=16e3}=t||{};if(i.startsWith("gemini")){let t=new gD({model:i,temperature:n,maxOutputTokens:a});return r?.tools?t.bindTools(r.tools):e?t.withStructuredOutput(e):{invoke:async e=>{let r=await t.invoke(e);return"string"==typeof r.content?r.content:String(r.content)}}}{let t=new vQ({model:i,temperature:"gpt-5-nano"!==i?n:1,maxCompletionTokens:a,reasoningEffort:"low"});return r?.tools?t.bindTools(r.tools):e?t.withStructuredOutput(e):{invoke:async e=>{let r=await t.invoke(e);return"string"==typeof r.content?r.content:String(r.content)}}}};async function EV(e){let{batches:t,input:r,previousResults:i,parentName:n}=e,a=i.response,s={...i};for(let e=0;e<t.length;e++){let i=t[e],o=Object.keys(i);console.log(`[${n}] Executing batch ${e+1}/${t.length}: [${o.join(", ")}]`);let l=Date.now(),u=o.map(async e=>{let t,s,o,l=i[e];if(null!==l&&"object"==typeof l&&"agent"in l&&"function"==typeof l.agent?.invoke?(t=l.agent,s=l.condition,o=l.transform):t=l,s&&!s(a))return console.log(`[${n}:${e}] Skipped (condition not met)`),{key:e,result:null,skipped:!0};let u=o?o(a):r,c=Date.now();console.log(`[${n}:${e}] Starting`);let d=await t.invoke(u);return console.log(`[${n}:${e}] Completed in ${Date.now()-c}ms`),{key:e,result:d,skipped:!1}}),c=await Promise.all(u);for(let{key:t,result:r,skipped:i}of(console.log(`[${n}] Batch ${e+1} completed in ${Date.now()-l}ms`),c)){if(i)continue;let e=r&&"object"==typeof r&&"response"in r;s[t]=e?r.response:r}}let{response:o,...l}=s;return l}e.s(["initializeModel",0,EJ],164476);let EY={update_profile:1,get_workout:2,make_modification:3};async function EX(e){let{model:t,messages:r,tools:i,name:n,maxIterations:a}=e,s=[...r],o=[],l=[],u="action";for(let e=1;e<=a;e++){console.log(`[${n}] Tool loop iteration ${e}`);let r=await t.invoke(s);if(!r.tool_calls||0===r.tool_calls.length){let t="string"==typeof r.content?r.content:String(r.content);return console.log(`[${n}] Tool loop completed after ${e} iteration(s)`),{response:t,messages:l,toolCalls:o}}let a=[...r.tool_calls].sort((e,t)=>(EY[e.name]??99)-(EY[t.name]??99));console.log(`[${n}] ${a.length} tool call(s): ${a.map(e=>e.name).join(", ")}`);let c=[];for(let t=0;t<a.length;t++){let r=a[t],d=`call_${e}_${t}`,h=i.find(e=>e.name===r.name);if(!h){console.error(`[${n}] Tool not found: ${r.name}`);continue}let p=Date.now();try{console.log(`[${n}] Executing tool: ${r.name}`);let e=await h.invoke(r.args),t=Date.now()-p;u=e.toolType||"action",e.messages&&e.messages.length>0&&(l.push(...e.messages),c.push(...e.messages),console.log(`[${n}] Accumulated ${e.messages.length} message(s) from ${r.name}`)),o.push({name:r.name,args:r.args,result:e.response,durationMs:t}),s.push({role:"assistant",content:"",tool_calls:[{id:d,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}]}),s.push({role:"tool",content:e.response,tool_call_id:d}),console.log(`[${n}] ${r.name} complete in ${t}ms`)}catch(e){console.error(`[${n}] Tool error (${r.name}):`,e),s.push({role:"tool",content:`Error: ${e instanceof Error?e.message:"Unknown error"}`,tool_call_id:d}),l.push("I tried to help but encountered an issue. Please try again!")}}s.push({role:"user",content:function(e,t){let r="";return(t.length>0&&(r=`
[AUTOMATED MESSAGES]
The following messages will be sent to the user immediately after your response:
${t.map(e=>`- "${e.substring(0,100)}${e.length>100?"...":""}"`).join("\n")}
`),"query"===e)?`[SYSTEM: TOOL COMPLETE - QUERY]
${r}
[INSTRUCTION]
The user asked a question and you retrieved the answer.
- Provide a brief, natural intro to the information (e.g., "Here's your workout for today:" or "Today you've got [type]:")
- DO NOT say "Done" or "Complete" - this was a question, not a request for action
- If [AUTOMATED MESSAGES] are listed, they contain the detailed response. Just provide a smooth lead-in.
- If there was an error, explain it simply.
- Keep it conversational and SMS-style (1-2 sentences max).
`:`[SYSTEM: TOOL COMPLETE - ACTION]
${r}
[INSTRUCTION]
The user requested a change and it has been processed.
- Briefly confirm what was done in a natural way
- If [AUTOMATED MESSAGES] are listed, DO NOT repeat their content. Just provide a brief confirmation.
- If you called make_modification with a message, that acknowledgment was already sent. Focus on the result now.
- If the action failed, explain the issue simply.
- Keep it conversational and SMS-style (1-2 sentences max).
`}(u,c)}),console.log(`[${n}] All tools complete, continuing loop`)}return console.warn(`[${n}] Max iterations (${a}) reached`),{response:l.length>0?l[l.length-1]:"I'm here to help! What would you like to know?",messages:l,toolCalls:o}}var EQ=e.i(875559);let E0=EK.join(process.cwd(),"_logs");async function E1(){try{await Eq.mkdir(E0,{recursive:!0})}catch{}}var E4=e.i(46308);class E2 extends E4.BaseRepository{async getPromptPair(e){let t=await this.db.selectFrom("prompts").where("id","=",e).orderBy("createdAt","desc").selectAll().execute();if(0===t.length)return null;let r=t.find(e=>"system"===e.role),i=t.find(e=>"user"===e.role);return r?{systemPrompt:r.value,userPrompt:i?.value??null}:null}async getSystemPrompt(e){let t=await this.db.selectFrom("prompts").where("id","=",e).where("role","=","system").orderBy("createdAt","desc").limit(1).select("value").executeTakeFirst();return t?.value??null}async getUserPrompt(e){let t=await this.db.selectFrom("prompts").where("id","=",e).where("role","=","user").orderBy("createdAt","desc").limit(1).select("value").executeTakeFirst();return t?.value??null}async getContextPrompt(e){let t=await this.db.selectFrom("prompts").where("id","=",e).where("role","=","context").orderBy("createdAt","desc").limit(1).select("value").executeTakeFirst();return t?.value??null}async createPrompt(e){return this.db.insertInto("prompts").values(e).returningAll().executeTakeFirstOrThrow()}async createPrompts(e){0!==e.length&&await this.db.insertInto("prompts").values(e).execute()}async getPromptHistory(e,t,r=10){return this.db.selectFrom("prompts").where("id","=",e).where("role","=",t).orderBy("createdAt","desc").limit(r).selectAll().execute()}async getAllPromptIds(){return(await this.db.selectFrom("prompts").select("id").distinct().execute()).map(e=>e.id)}}let E6=new E2;e.s(["PromptRepository",()=>E2,"promptRepository",0,E6],221078);class E9{static instance;cache=new Map;contextCache=new Map;constructor(){}static getInstance(){return E9.instance||(E9.instance=new E9),E9.instance}async getPrompts(e){let t=this.cache.get(e);if(t&&t.expiresAt>Date.now())return t.data;let r=await E6.getPromptPair(e);if(!r)throw Error(`Prompt not found for agent '${e}'. All prompts must be seeded before use. Run the prompt seeding migration.`);return this.cache.set(e,{data:r,expiresAt:Date.now()+3e5}),r}async getContextPrompt(e){let t=`${e}:context`,r=this.contextCache.get(t);if(r&&r.expiresAt>Date.now())return r.data;let i=await E6.getContextPrompt(e);return null!==i&&this.contextCache.set(t,{data:i,expiresAt:Date.now()+3e5}),i}invalidateCache(e){this.cache.delete(e),this.contextCache.delete(`${e}:context`)}clearCache(){this.cache.clear(),this.contextCache.clear()}}let E3=E9.getInstance();async function E5(e,t){let{name:r,systemPrompt:i,userPrompt:n,context:a=[],previousMessages:s=[],tools:o,schema:l,subAgents:u=[]}=e,c=i,d=null;if(!c){let e=await E3.getPrompts(r);c=e.systemPrompt,d=e.userPrompt}let{maxIterations:h=5}=t||{},p=o&&o.length>0,f=p?EJ(void 0,t,{tools:o}):EJ(l,t);return{invoke:async e=>{let t=Date.now();console.log(`[${r}] Starting execution`);try{var i;let l,m;l=n?n(e):d?`${d}

${e}`:e;let g=function(e){let{systemPrompt:t,userPrompt:r,context:i=[],previousMessages:n=[]}=e;return[{role:"system",content:t},...i.filter(e=>e&&e.trim().length>0).map(e=>({role:"user",content:e})),...n,{role:"user",content:r}]}({systemPrompt:c,userPrompt:l,context:a,previousMessages:s}),y=[];if(p){let e=await EX({model:f,messages:g,tools:o,name:r,maxIterations:h});m=e.response,y=e.messages}else m=await f.invoke(g);if(i=m,(0,EQ.getFeatureFlags)().agentLogging&&(async()=>{try{let t,n,a,s,o,l;await E1();let u=(n=(t=new Date).toISOString().split("T")[0],a=t.toTimeString().split(" ")[0].replace(/:/g,""),s=t.getMilliseconds().toString().padStart(3,"0"),`${n}_${a}-${s}`),c=new Date().toISOString(),d=`${r}_${u}`;await Promise.all([Eq.writeFile(EK.join(E0,`${d}.json`),JSON.stringify({timestamp:c,agentName:r,input:e,messages:g,output:i},null,2),"utf-8"),Eq.writeFile(EK.join(E0,`${d}.txt`),(l=[o="=".repeat(80),`AGENT: ${r}`,`TIMESTAMP: ${c}`,`INPUT: ${e}`,o,"","--- MESSAGES ARRAY ---",""],g.forEach(e=>{let t,r,i;l.push((t=e.role.toUpperCase(),r=e.content||"",i="user"===e.role&&r.startsWith("[CONTEXT:")?"[USER - CONTEXT]":`[${t}]`,`${i}
${r}`)),l.push("")}),l.push("--- OUTPUT ---"),l.push("string"==typeof i?i:JSON.stringify(i,null,2)),l.push(o),l.join("\n")),"utf-8")])}catch(e){console.error("[AgentLogger] Failed to write log:",e)}})(),console.log(`[${r}] Main agent completed in ${Date.now()-t}ms`),!u||0===u.length)return{response:m,...y.length>0?{messages:y}:{}};let _="string"==typeof m?m:JSON.stringify(m),v=await EV({batches:u,input:_,previousResults:{response:m},parentName:r});return console.log(`[${r}] Total execution time: ${Date.now()-t}ms`),{response:m,...y.length>0?{messages:y}:{},...v}}catch(e){throw console.error(`[${r}] Execution failed:`,e),e}},name:r}}e.s(["createAgent",()=>E5],351250);let E8={CHAT_GENERATE:"chat:generate",PROFILE_FITNESS:"profile:fitness",PROFILE_STRUCTURED:"profile:structured",PROFILE_USER:"profile:user",PLAN_GENERATE:"plan:generate",PLAN_STRUCTURED:"plan:structured",PLAN_MESSAGE:"plan:message",PLAN_MODIFY:"plan:modify",WORKOUT_GENERATE:"workout:generate",WORKOUT_STRUCTURED:"workout:structured",WORKOUT_MESSAGE:"workout:message",WORKOUT_MODIFY:"workout:modify",MICROCYCLE_GENERATE:"microcycle:generate",MICROCYCLE_STRUCTURED:"microcycle:structured",MICROCYCLE_MESSAGE:"microcycle:message",MICROCYCLE_MODIFY:"microcycle:modify",MODIFICATIONS_ROUTER:"modifications:router"};e.s(["PROMPT_IDS",0,E8],14006),e.s([],574394);let E7=fC.z.object({type:fC.z.enum(["RPE","RIR","Percentage","Zone","HeartRate","Pace","Other"]).default("Other"),value:fC.z.string().describe("e.g., '7-8', '2', '75%', 'Zone 2', '150bpm'").default(""),description:fC.z.string().describe("Context for the user").default("")}),Te=fC.z.object({id:fC.z.string().default(""),name:fC.z.string().describe("e.g. 'Back Squat' or 'Zone 2 Run'"),type:fC.z.enum(["Strength","Cardio","Plyometric","Mobility","Rest","Other"]).default("Strength"),sets:fC.z.string().describe("e.g. '4' or '3-4'").default(""),reps:fC.z.string().describe("e.g. '6-8' or '4 min'").default(""),duration:fC.z.string().describe("e.g. '45 min'").default(""),distance:fC.z.string().describe("e.g. '5km'").default(""),rest:fC.z.string().describe("e.g. '2-3 min'").default(""),intensity:E7.default({type:"Other",value:"",description:""}),tempo:fC.z.string().describe("e.g. '3-0-1'").default(""),notes:fC.z.string().describe("Execution cues").default(""),tags:fC.z.array(fC.z.string()).default([]),supersetId:fC.z.string().default("")}),Tt=fC.z.object({title:fC.z.string().describe("e.g. 'Warm Up', 'Main Lift'"),overview:fC.z.string().describe("Brief goal of this section").default(""),exercises:fC.z.array(Te).default([])}),Tr=fC.z.object({title:fC.z.string().describe("Concise workout name, 2-4 words max (e.g. 'Pull A', 'Upper Strength', 'Leg Day')"),focus:fC.z.string().describe("Brief focus area, 1-3 words (e.g. 'Back & Biceps', 'Quads', 'Push')").default(""),description:fC.z.string().default(""),quote:fC.z.object({text:fC.z.string().default(""),author:fC.z.string().default("")}).default({text:"",author:""}),sections:fC.z.array(Tt).default([]),estimatedDurationMin:fC.z.number().describe("Estimated minutes").default(-1),intensityLevel:fC.z.enum(["Low","Moderate","High","Severe"]).default("Moderate")}),Ti=fC.z.object({type:fC.z.enum(["prep","compound","secondary","accessory","core","cardio","cooldown"]).describe("Type of exercise in the workout"),exercise:fC.z.string().describe("Specific, actionable exercise name that a user can immediately perform (e.g., 'Band Pull-Aparts', 'Cat-Cow Stretch', 'Scapular Wall Slides'). Never use vague terms like 'mobility sequence' or 'dynamic warmup'."),sets:fC.z.number().describe("Number of sets (use -1 if not applicable)"),reps:fC.z.string().describe("Number of reps (can be range like '6-8' or number like '10', use empty string if not applicable)"),durationSec:fC.z.number().describe("Duration in seconds (use -1 if not applicable)"),durationMin:fC.z.number().describe("Duration in minutes (use -1 if not applicable)"),RPE:fC.z.number().describe("Rate of Perceived Exertion (1-10 scale, use -1 if not applicable)"),rir:fC.z.number().describe("Reps in Reserve (typically 0-5, use -1 if not applicable)"),percentageRM:fC.z.number().describe("Percentage of 1 Rep Max (0-100 scale, use -1 if not applicable)"),restSec:fC.z.number().describe("Rest between sets in seconds (use -1 if not applicable)"),restText:fC.z.string().describe("Readable rest instruction (e.g., '90s between supersets', use empty string if not applicable)"),equipment:fC.z.string().describe("Equipment used (barbell, DB, band, etc., use empty string if not applicable)"),pattern:fC.z.string().describe("Movement pattern label (e.g., 'horizontal_press', use empty string if not applicable)"),tempo:fC.z.string().describe("Tempo prescription (e.g., '3-1-1', use empty string if not applicable)"),cues:fC.z.array(fC.z.string()).describe("Key coaching cues (use empty array if none)"),tags:fC.z.array(fC.z.string()).describe("Semantic tags for filtering/substitution (use empty array if none)"),notes:fC.z.string().describe("Additional notes for the exercise (use empty string if no notes)")}).strict(),Tn=fC.z.object({structureType:fC.z.enum(["straight","superset","circuit"]).describe("Defines how the exercises are grouped (straight = single exercise, superset = 2 exercises alternated, circuit = 3+ exercises)"),exercises:fC.z.array(Ti).min(1).describe("One or more exercises (1 = straight, 2 = superset, 3+ = circuit)"),restBetweenExercisesSec:fC.z.number().describe("Rest between exercises inside the superset/circuit in seconds (use -1 if not applicable)"),restAfterSetSec:fC.z.number().describe("Rest between rounds or sets of this work item in seconds (use -1 if not applicable)"),rounds:fC.z.number().describe("Number of times the group is repeated (for circuits, use -1 if not applicable)"),notes:fC.z.string().describe("Extra details about the grouping (use empty string if no notes)")}).strict(),Ta=fC.z.object({name:fC.z.string().describe("Name of the workout block (e.g., 'Warm-Up', 'Main Lift', 'Accessory')"),goal:fC.z.string().describe("Purpose of this block (use empty string if not applicable)"),durationMin:fC.z.number().describe("Estimated duration in minutes (use -1 if not applicable)"),notes:fC.z.string().describe("General notes for this block (use empty string if no notes)"),work:fC.z.array(Tn).describe("The list of work items (straight, superset, or circuit) within this block")}).strict(),Ts=fC.z.object({condition:fC.z.string().describe("Condition that triggers this modification (e.g., 'injury.lower_back.active')"),replace:fC.z.object({exercise:fC.z.string().describe("Exercise to replace"),with:fC.z.string().describe("Replacement exercise")}).describe("Exercise replacement details (use empty strings if not applicable)"),adjustment:fC.z.string().describe("Adjustment to make (e.g., 'reduce weight by 20%', use empty string if not applicable)"),note:fC.z.string().describe("Explanation for the modification")}).strict(),To=fC.z.object({phaseName:fC.z.string().describe("Name of the training phase (use empty string if not applicable)"),weekNumber:fC.z.number().describe("Week number in the program (use -1 if not applicable)"),dayIndex:fC.z.number().describe("Day index in the microcycle (use -1 if not applicable)"),goal:fC.z.string().describe("Goal of the session (use empty string if not applicable)"),durationEstimateMin:fC.z.number().describe("Estimated duration in minutes (use -1 if not applicable)"),environment:fC.z.string().describe("Training environment (e.g., 'gym', 'home', use empty string if not applicable)"),clientConstraints:fC.z.object({timeAvailable:fC.z.number().describe("Time available in minutes (use -1 if not applicable)"),equipmentAvailable:fC.z.array(fC.z.string()).describe("Available equipment (use empty array if not specified)"),injuries:fC.z.array(fC.z.string()).describe("Current injuries or limitations (use empty array if none)"),preferences:fC.z.array(fC.z.string()).describe("Client preferences (use empty array if not specified)")}).describe("Client-specific constraints for the session")}).strict(),Tl=fC.z.object({totalVolume:fC.z.number().describe("Total volume in kg (use -1 if not applicable)"),totalReps:fC.z.number().describe("Total reps across all exercises (use -1 if not applicable)"),totalSets:fC.z.number().describe("Total sets across all exercises (use -1 if not applicable)"),totalDistance:fC.z.number().describe("Total distance in km (use -1 if not applicable)"),totalDuration:fC.z.number().describe("Total duration in minutes (use -1 if not applicable)"),averageRPE:fC.z.number().describe("Average RPE across workout (use -1 if not applicable)"),averageIntensity:fC.z.number().describe("Average intensity across workout (use -1 if not applicable)")}).strict(),Tu=fC.z.object({adaptations:fC.z.array(fC.z.string()).describe("Expected adaptations from this workout (use empty array if not specified)"),coachingNotes:fC.z.string().describe("Coaching notes for the client (use empty string if no notes)"),progressionNotes:fC.z.string().describe("Notes on progression strategy (use empty string if no notes)"),recoveryFocus:fC.z.string().describe("Recovery focus areas (use empty string if not specified)")}).strict(),Tc=fC.z.object({theme:fC.z.string().describe("Overall theme of the workout (e.g., 'Upper Push', 'Lower Power')"),sessionContext:To.describe("Metadata and context about the session"),blocks:fC.z.array(Ta).describe("Structured blocks of the workout"),modifications:fC.z.array(Ts).describe("Modifications for special conditions (use empty array if none)"),targetMetrics:Tl.describe("Target metrics for the workout"),summary:Tu.describe("Summary and meta reflections about the workout"),notes:fC.z.string().describe("Additional notes for the workout (use empty string if no notes)")}).strict(),Td=Tc.extend({modificationsApplied:fC.z.array(fC.z.string()).describe("List of specific changes made to the workout (e.g., 'Replaced Barbell Bench Press with Dumbbell Bench Press due to no barbell available')")}).strict(),Th=fC.z.object({type:fC.z.enum(["prep","compound","secondary","accessory","core","cardio","cooldown"]).describe("Category of the movement or its role in the session."),exercise:fC.z.string().describe("Explicit exercise name (e.g., 'Barbell Back Squat')."),sets:fC.z.number().nullish().describe("Number of sets."),reps:fC.z.string().nullish().describe("Reps (can be a range or a single value)."),durationSec:fC.z.number().nullish().describe("Exercise duration in seconds."),durationMin:fC.z.number().nullish().describe("Exercise duration in minutes."),RPE:fC.z.number().min(1).max(10).nullish().describe("Rate of Perceived Exertion 110."),rir:fC.z.number().nullish().describe("Reps in Reserve (autoregulation measure)."),percentageRM:fC.z.number().min(0).max(100).nullish().describe("Percent of 1RM load."),restSec:fC.z.number().nullish().describe("Rest between sets in seconds."),restText:fC.z.string().nullish().describe("Readable rest instruction, e.g. '90s between supersets'."),equipment:fC.z.string().nullish().describe("Equipment used (barbell, DB, band, etc.)."),pattern:fC.z.string().nullish().describe("Movement pattern label (e.g., 'horizontal_press')."),tempo:fC.z.string().nullish().describe("Tempo prescription, e.g. '3-1-1'."),cues:fC.z.array(fC.z.string()).nullish().describe("Key coaching cues."),tags:fC.z.array(fC.z.string()).nullish().describe("Semantic tags for filtering/substitution."),notes:fC.z.string().nullish().describe("Extra details or special instructions.")}).strict(),Tp=fC.z.object({structureType:fC.z.enum(["straight","superset","circuit"]).default("straight").describe("Defines how the exercises are grouped."),exercises:fC.z.array(Th).min(1).describe("One or more exercises (1 = straight, 2 = superset, 3+ = circuit)."),restBetweenExercisesSec:fC.z.number().nullish().describe("Rest between exercises inside the superset/circuit."),restAfterSetSec:fC.z.number().nullish().describe("Rest between rounds or sets of this work item."),rounds:fC.z.number().nullish().describe("Number of times the group is repeated (for circuits)."),notes:fC.z.string().nullish().describe("Extra details about the grouping.")}).strict(),Tf=fC.z.object({name:fC.z.string().describe("Name of the workout block (e.g., 'Warm-Up', 'Main Lift')."),goal:fC.z.string().nullish().describe("Purpose of this block."),durationMin:fC.z.number().nullish().describe("Estimated duration in minutes."),notes:fC.z.string().nullish().describe("General notes for this block."),work:fC.z.array(Tp).describe("The list of work items (straight, superset, or circuit) within this block.")}).strict(),Tm=fC.z.object({condition:fC.z.string().describe("Trigger condition, e.g. 'injury.shoulder.active'."),replace:fC.z.object({exercise:fC.z.string().describe("Original exercise to replace."),with:fC.z.string().describe("Substitute exercise.")}).nullish(),adjustment:fC.z.string().nullish().describe("Other adjustments (e.g., reduce weight 20%)."),note:fC.z.string().describe("Reason or context for this modification.")}).strict(),Tg=fC.z.object({phaseName:fC.z.string().nullish(),weekNumber:fC.z.number().nullish(),dayIndex:fC.z.number().nullish(),goal:fC.z.string().nullish(),durationEstimateMin:fC.z.number().nullish(),environment:fC.z.string().nullish(),clientConstraints:fC.z.object({timeAvailable:fC.z.number().nullish(),equipmentAvailable:fC.z.array(fC.z.string()).nullish(),injuries:fC.z.array(fC.z.string()).nullish(),preferences:fC.z.array(fC.z.string()).nullish()}).nullish()}).nullish(),Ty=fC.z.object({totalVolume:fC.z.number().nullish(),totalReps:fC.z.number().nullish(),totalSets:fC.z.number().nullish(),totalDuration:fC.z.number().nullish(),averageRPE:fC.z.number().nullish(),averageIntensity:fC.z.number().nullish()}).nullish(),T_=fC.z.object({adaptations:fC.z.array(fC.z.string()).nullish(),coachingNotes:fC.z.string().nullish(),progressionNotes:fC.z.string().nullish(),recoveryFocus:fC.z.string().nullish()}).nullish(),Tv=fC.z.object({theme:fC.z.string().describe("Theme of the workout (e.g., 'Upper Push', 'Lower Power')."),sessionContext:Tg,blocks:fC.z.array(Tf),modifications:fC.z.array(Tm).nullish(),targetMetrics:Ty,summary:T_,notes:fC.z.string().nullish()}).strict(),Tb=Tv.extend({modificationsApplied:fC.z.array(fC.z.string()).describe("List of specific changes made to the workout (e.g., 'Replaced Barbell Bench Press with Dumbbell Bench Press due to no barbell available')")}).strict();function Tw(e){return e?.startsWith("gemini")||!1}function TE(e){return Tw(e)?{enhanced:Tc,updated:Td,isGemini:!0}:{enhanced:Tv,updated:Tb,isGemini:!1}}fC.z.object({sessionType:fC.z.enum(["run","lift","metcon","mobility","rest","other"]).describe("Primary modality"),details:fC.z.array(fC.z.object({label:fC.z.string().describe("Name of the block (e.g. Warm-up)"),activities:fC.z.array(fC.z.string()).describe("Ordered list of exercise descriptions")}).strict()).min(1).describe("Sequential blocks in the workout"),targets:fC.z.array(fC.z.object({key:fC.z.string().describe("Metric / target field name"),value:fC.z.number().describe("Numeric value for the key")}).strict()).describe("Numeric targets such as distanceKm, volumeKg").nullish()}).strict(),fC.z.object({formatted:fC.z.string().min(100).describe(`
      Formatted workout text using extended markdown format.

      REQUIRED STRUCTURE:
      # {Theme} - {Focus}

      ## Session Overview
      **Duration:** ~{X} minutes
      **RPE Target:** {X-Y}
      **Focus:** {focus areas}

      ---

      ## {Emoji} Block 1: {Block Name}
      **Goal:** {Purpose}

      {Work items with exercises, sets, reps, RPE, cues, etc.}

      ---

      ## Coaching Notes
      - {Notes for user}

      FORMAT EXAMPLES:

      Straight sets:
      1. **Barbell Bench Press** [COMPOUND]
         - 4 x 5 reps @ 80% 1RM
         - RPE: 8 | RIR: 2
         - Rest: 3-4 min
         - *Cues: Retract scapula, leg drive*
         - **Progression:** +5lbs from last week

      Supersets:
      **A. Superset (3 rounds, 90s rest between rounds):**
         1a. **Incline DB Press** [SECONDARY]
             - 10-12 reps @ RPE 7
             - *Cue: Full ROM, control eccentric*

         1b. **Cable Face Pulls** [ACCESSORY]
             - 15 reps
             - *Cue: Pull to forehead level*

      Circuits:
      **B. Circuit (2 rounds, 60s rest):**
         2a. **Dips** - 8-10 reps @ RPE 8
         2b. **Lateral Raises** - 12 reps per side
         2c. **Tricep Pushdowns** - 15 reps

      Cardio:
      1. **Easy Run**
         - Duration: 40 min
         - Pace: 9:30-10:00 /mile
         - Heart Rate: Zone 2 (130-145 bpm)
         - *Cues: Relax shoulders, land midfoot*

      IMPORTANT FORMATTING RULES:
      - Use markdown headers (# for title, ## for blocks)
      - Use --- to separate blocks
      - Use **bold** for exercise names
      - Use [TYPE] tags: [PREP], [COMPOUND], [SECONDARY], [ACCESSORY], [CORE], [CARDIO], [COOLDOWN]
      - Use emojis for visual hierarchy
      - Use *italic* for coaching cues
      - Use bullet points (-) for lists
      - Include RPE, sets, reps, rest periods as appropriate
      - Add coaching notes and modifications sections
      - Be comprehensive - include ALL exercises and details
      - Adapt format to workout type (strength, cardio, metcon, etc.)
    `)}).strict().extend({theme:fC.z.string().describe("Workout theme/title (e.g., 'Upper Push', 'Easy Run')")}).strict().extend({modificationsApplied:fC.z.array(fC.z.string()).describe("List of specific changes made (e.g., 'Replaced Barbell Bench Press with Dumbbell Bench Press due to no barbell available')")}).strict(),e.s(["getWorkoutSchemas",()=>TE,"isGeminiModel",()=>Tw],932542),e.i(932542);let TT=fC.z.object({overview:fC.z.string().describe("Full workout text after modifications (or original if unchanged)"),wasModified:fC.z.boolean().describe("Whether the workout was actually modified"),modifications:fC.z.string().default("").describe("Explanation of what changed and why (empty string if wasModified is false)")});var TS=((e1={}).USER="user",e1.USER_PROFILE="userProfile",e1.FITNESS_PLAN="fitnessPlan",e1.DAY_OVERVIEW="dayOverview",e1.CURRENT_WORKOUT="currentWorkout",e1.DATE_CONTEXT="dateContext",e1.TRAINING_META="trainingMeta",e1.CURRENT_MICROCYCLE="currentMicrocycle",e1.EXPERIENCE_LEVEL="experienceLevel",e1.DAY_FORMAT="dayFormat",e1);e.s(["ContextType",()=>TS],203068);var TI=((e4={}).MICROCYCLE="microcycle",e4.WORKOUT="workout",e4);let TO={microcycle:{beginner:"microcycle:generate:experience:beginner",intermediate:"microcycle:generate:experience:intermediate",advanced:"microcycle:generate:experience:advanced"},workout:{beginner:"workout:generate:experience:beginner",intermediate:"workout:generate:experience:intermediate",advanced:"workout:generate:experience:advanced"}},TA=async(e,t)=>{if(!e)return null;let r=TO[t]?.[e];if(!r)return null;try{return await E3.getContextPrompt(r)}catch(r){return console.warn(`[experienceLevel] Could not fetch snippet for ${e}/${t}:`,r),null}};var Tk=e.i(823525);let Tx={TRAINING:"workout:message:format:training",ACTIVE_RECOVERY:"workout:message:format:active_recovery",REST:"workout:message:format:rest"},T$=async e=>{if(!e)return null;let t=Tx[e];if(!t)return null;try{return await E3.getContextPrompt(t)}catch(t){return console.warn(`[dayFormat] Could not fetch format for ${e}:`,t),null}};e.s([],287336);class TC{static instance;deps;constructor(e){this.deps=e}static initialize(e){return TC.instance||(TC.instance=new TC(e)),TC.instance}static getInstance(){if(!TC.instance)throw Error("ContextService not initialized. Call initialize() first.");return TC.instance}async getContext(e,t,r={}){let i=t.includes(TS.FITNESS_PLAN)&&!r.planText,n=t.includes(TS.CURRENT_WORKOUT)&&void 0===r.workout,a=t.includes(TS.CURRENT_MICROCYCLE)&&void 0===r.microcycle,s=t.includes(TS.EXPERIENCE_LEVEL)&&void 0===r.experienceLevel,o=t.includes(TS.DAY_FORMAT)&&void 0!==r.activityType,l=t.includes(TS.EXPERIENCE_LEVEL),u=r.date||(0,Tk.today)(e.timezone),[c,d,h,p,f]=await Promise.all([i?this.deps.fitnessPlanService.getCurrentPlan(e.id):null,n?this.deps.workoutInstanceService.getWorkoutByUserIdAndDate(e.id,u):null,a?this.deps.microcycleService.getMicrocycleByDate(e.id,u):null,s?this.deps.profileRepository.getCurrentStructuredProfile(e.id):null,o?T$(r.activityType):null]),m=r.experienceLevel??p?.experienceLevel??null,g=r.snippetType||TI.WORKOUT,y=l&&m?await TA(m,g):null,_={userName:e.name,userGender:e.gender,userAge:e.age,profile:e.profile,planText:r.planText??c?.description,dayOverview:r.dayOverview,workout:r.workout??d,microcycle:r.microcycle??h,timezone:e.timezone||"America/New_York",date:u,isDeload:r.isDeload,absoluteWeek:r.absoluteWeek,currentWeek:r.currentWeek,experienceLevel:m,snippetType:g,activityType:r.activityType,dayFormatTemplate:f,experienceSnippet:y};return t.map(e=>this.buildContextForType(e,_)).filter(e=>e&&e.trim().length>0)}buildContextForType(e,t){switch(e){case TS.USER:var r,i,n,a,s,o,l,u,c,d,h,p={name:t.userName,gender:t.userGender,age:t.userAge};if(!p)return"<User>No user information available</User>";let f=[];return(p.name&&f.push(`<Name>${p.name}</Name>`),p.gender&&f.push(`<Gender>${p.gender}</Gender>`),p.age&&f.push(`<Age>${p.age}</Age>`),0===f.length)?"<User>No user information available</User>":`<User>
${f.join("\n")}
</User>`;case TS.USER_PROFILE:return(r=t.profile)&&0!==r.trim().length?`<UserProfile>${r.trim()}</UserProfile>`:"<UserProfile>No profile available</UserProfile>";case TS.FITNESS_PLAN:return(i=t.planText)&&0!==i.trim().length?`<FitnessPlan>${i.trim()}</FitnessPlan>`:"<FitnessPlan>No fitness plan available</FitnessPlan>";case TS.DAY_OVERVIEW:return(n=t.dayOverview)&&0!==n.trim().length?`<DayOverview>${n.trim()}</DayOverview>`:"<DayOverview>No day instruction provided</DayOverview>";case TS.CURRENT_WORKOUT:var m=t.workout;if(!m)return"<CurrentWorkout>No workout scheduled</CurrentWorkout>";let g=m.description||m.sessionType||"Workout";return`<CurrentWorkout>${g}</CurrentWorkout>`;case TS.DATE_CONTEXT:let y,_,v;return a=t.timezone,s=t.date,y=a||"America/New_York",_=s||new Date,v=(0,Tk.formatForAI)(_,y),`<DateContext>
Today is ${v}.
Timezone: ${y}
</DateContext>`;case TS.TRAINING_META:let b;return o={isDeload:t.isDeload,absoluteWeek:t.absoluteWeek,currentWeek:t.currentWeek},b=[],(void 0!==o.isDeload&&b.push(`Is Deload Week: ${o.isDeload}`),void 0!==o.absoluteWeek&&b.push(`Absolute Week: ${o.absoluteWeek}`),void 0!==o.currentWeek&&b.push(`Current Week: ${o.currentWeek}`),0===b.length)?"":`<TrainingMeta>${b.join(" | ")}</TrainingMeta>`;case TS.CURRENT_MICROCYCLE:var w=t.microcycle;if(!w)return"<CurrentMicrocycle>No microcycle available</CurrentMicrocycle>";let E=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],T=(w.days||[]).map((e,t)=>`${E[t]}: ${e}`).join("\n");return`<CurrentMicrocycle>
Week Overview: ${w.description||"N/A"}
Is Deload: ${w.isDeload}
Absolute Week: ${w.absoluteWeek}
Days:
${T}
</CurrentMicrocycle>`;case TS.EXPERIENCE_LEVEL:return l=t.experienceSnippet,u=t.experienceLevel,c=t.snippetType||TI.WORKOUT,l&&u?`<ExperienceLevelContext level="${u}" type="${c}">
${l.trim()}
</ExperienceLevelContext>`:"";case TS.DAY_FORMAT:return d=t.dayFormatTemplate,h=t.activityType,d&&h?`<DayFormatRules type="${h}">
${d.trim()}
</DayFormatRules>`:"";default:return""}}}e.s(["ContextService",()=>TC],880002),e.s([],684734),e.i(287336);class TN{static instance;messageAgentPromise=null;structuredAgentPromise=null;constructor(){}getContextService(){return TC.getInstance()}static getInstance(){return TN.instance||(TN.instance=new TN),TN.instance}async getMessageAgent(e,t){if(t&&e){let r=await this.getContextService().getContext(e,[TS.DAY_FORMAT],{activityType:t});return E5({name:E8.WORKOUT_MESSAGE,context:r},{model:"gpt-5-nano"})}return this.messageAgentPromise||(this.messageAgentPromise=E5({name:E8.WORKOUT_MESSAGE},{model:"gpt-5-nano"})),this.messageAgentPromise}async getStructuredAgent(){return this.structuredAgentPromise||(this.structuredAgentPromise=E5({name:E8.WORKOUT_STRUCTURED,schema:Tr},{model:"gpt-5-nano",maxTokens:32e3})),this.structuredAgentPromise}async generateWorkout(e,t,r=!1,i){let n=await this.getContextService().getContext(e,[TS.USER_PROFILE,TS.EXPERIENCE_LEVEL,TS.DAY_OVERVIEW,TS.TRAINING_META],{dayOverview:t,isDeload:r,snippetType:TI.WORKOUT}),[a,s]=await Promise.all([this.getMessageAgent(e,i),this.getStructuredAgent()]);return(await E5({name:E8.WORKOUT_GENERATE,context:n,subAgents:[{message:a,structure:s}]},{model:"gpt-5.1"})).invoke("")}async modifyWorkout(e,t,r){let i=await this.getContextService().getContext(e,[TS.USER_PROFILE,TS.CURRENT_WORKOUT],{workout:t}),[n,a]=await Promise.all([this.getMessageAgent(),this.getStructuredAgent()]),s=e=>{let t="string"==typeof e?e:JSON.stringify(e);try{return JSON.parse(t).overview||t}catch{return t}};return(await E5({name:E8.WORKOUT_MODIFY,context:i,schema:TT,subAgents:[{message:{agent:n,transform:s},structure:{agent:a,transform:s}}]},{model:"gpt-5-mini"})).invoke(r)}}let TP=TN.getInstance();e.s(["WorkoutAgentService",()=>TN,"workoutAgentService",0,TP],520676);let TR=fC.z.enum(["TRAINING","ACTIVE_RECOVERY","REST"]),Tj=fC.z.object({day:fC.z.enum(["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]),focus:fC.z.string().default(""),activityType:TR.default("TRAINING"),notes:fC.z.string().default("")}),TU=fC.z.object({weekNumber:fC.z.number().default(-1),phase:fC.z.string().default(""),overview:fC.z.string().default(""),days:fC.z.array(Tj).length(7),isDeload:fC.z.boolean().default(!1)});fC.z.object({overview:fC.z.string({description:"Overview of the week's training focus, objectives, and progression context"}),isDeload:fC.z.boolean({description:"Whether this is a deload week (reduced volume/intensity)"}).default(!1),days:fC.z.array(fC.z.string(),{description:"Array of 7 day descriptions (day 1 through day 7). Each string describes the session for that day including theme, focus, volume/intensity targets, and conditioning if applicable."}).length(7,"Must have exactly 7 days")});class TL{static fromDB(e){return{id:e.id,clientId:e.clientId,absoluteWeek:e.absoluteWeek,days:e.days??[],description:e.description??null,isDeload:e.isDeload??!1,message:e.message??null,structured:e.structured,startDate:new Date(e.startDate),endDate:new Date(e.endDate),isActive:e.isActive??!0,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}}static toDB(e){return{clientId:e.clientId,absoluteWeek:e.absoluteWeek,days:e.days,description:e.description,isDeload:e.isDeload,message:e.message,structured:e.structured,startDate:e.startDate,endDate:e.endDate,isActive:e.isActive}}}e.s(["MicrocycleModel",()=>TL],995515);let TD=fC.z.object({overview:fC.z.string({description:"Comprehensive weekly overview including week number, theme, objective, split, volume/intensity trends, conditioning plan, and rest day placement"}),isDeload:fC.z.boolean().default(!1).describe("Whether this is a deload/recovery week with reduced volume and intensity"),days:fC.z.array(fC.z.string(),{description:"Exactly 7 day overview strings in order: Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday"}).length(7)}),TM=TD.extend({wasModified:fC.z.boolean().describe("Whether the microcycle was actually modified in response to the change request. False if the current plan already satisfies the request or no changes were needed."),modifications:fC.z.string().default("").describe("Explanation of what changed and why (empty string if wasModified is false). When wasModified is true, describe specific changes made to the weekly pattern.")}),Tz=e=>7===e.length&&e.every(e=>e&&e.trim().length>0);class TF{static instance;messageAgentPromise=null;structuredAgentPromise=null;constructor(){}getContextService(){return TC.getInstance()}static getInstance(){return TF.instance||(TF.instance=new TF),TF.instance}async getMessageAgent(){return this.messageAgentPromise||(this.messageAgentPromise=E5({name:E8.MICROCYCLE_MESSAGE,userPrompt:e=>{var t;let r;return r=(t=JSON.parse(e)).days.map((e,t)=>`${Tk.DAY_NAMES[t]}:
${e}`).join("\n\n"),`
Generate a weekly breakdown SMS message based on the following structured microcycle pattern.

Focus on summarizing the week's training theme and providing a clear, easy-to-read breakdown of training days and rest days for the client.

WEEKLY OVERVIEW:
${t.overview}

IS DELOAD WEEK: ${t.isDeload}

DAILY BREAKDOWNS:

${r}

Output only the message text (no JSON wrapper) as specified in your system instructions.
`.trim()}},{model:"gpt-5-nano"})),this.messageAgentPromise}async getStructuredAgent(){return this.structuredAgentPromise||(this.structuredAgentPromise=E5({name:E8.MICROCYCLE_STRUCTURED,userPrompt:e=>{let t,r,i,n,a=JSON.parse(e);return t=a.overview,r=a.days,i=a.absoluteWeek??1,n=a.isDeload,`Parse the following microcycle into structured format:

Week Number: ${i}
Is Deload: ${n}

Weekly Overview:
${t}

Day Overviews:
${r.map((e,t)=>`${["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][t]}: ${e}`).join("\n\n")}`},schema:TU},{model:"gpt-5-nano",maxTokens:32e3})),this.structuredAgentPromise}async generateMicrocycle(e,t){let r=await this.getContextService().getContext(e,[TS.FITNESS_PLAN,TS.USER_PROFILE,TS.EXPERIENCE_LEVEL,TS.TRAINING_META],{absoluteWeek:t,snippetType:TI.MICROCYCLE}),[i,n]=await Promise.all([this.getMessageAgent(),this.getStructuredAgent()]),a=await E5({name:E8.MICROCYCLE_GENERATE,context:r,schema:TD,subAgents:[{message:i,structure:{agent:n,transform:e=>{let r="string"==typeof e?e:JSON.stringify(e);try{let e=JSON.parse(r);return JSON.stringify({...e,absoluteWeek:t})}catch{return r}}}}]},{model:"gpt-5.1"}),s=null;for(let e=1;e<=3;e++)try{e>1&&console.log(`[microcycle-generate] Retry attempt ${e}/3 for week ${t}`);let r=await a.invoke(`Absolute Week: ${t}`);if(!Tz(r.response.days)){let e=r.response.days.map((e,t)=>e&&0!==e.trim().length?-1:t).filter(e=>-1!==e).map(e=>Tk.DAY_NAMES[e]);throw Error(`Microcycle generate validation failed: Missing or empty days for ${e.join(", ")}. Expected all 7 days to be present and non-empty.`)}return console.log(`[microcycle-generate] Successfully generated day overviews and message for week ${t}${e>1?` (after ${e} attempts)`:""}`),{days:r.response.days,description:r.response.overview,isDeload:r.response.isDeload,message:r.message,structure:r.structure}}catch(r){if(console.error(`[microcycle-generate] Attempt ${e}/3 failed for week ${t}:`,(s=r instanceof Error?r:Error(String(r))).message),3===e)break}throw Error(`Failed to generate microcycle pattern for week ${t} after 3 attempts. Last error: ${s?.message||"Unknown error"}`)}async modifyMicrocycle(e,t,r){let i=t.absoluteWeek,n=await this.getContextService().getContext(e,[TS.USER,TS.USER_PROFILE,TS.CURRENT_MICROCYCLE,TS.DATE_CONTEXT],{microcycle:t}),[a,s]=await Promise.all([this.getMessageAgent(),this.getStructuredAgent()]),o=await E5({name:E8.MICROCYCLE_MODIFY,context:n,schema:TM,subAgents:[{message:a,structure:{agent:s,transform:e=>{let t="string"==typeof e?e:JSON.stringify(e);try{let e=JSON.parse(t);return JSON.stringify({...e,absoluteWeek:i})}catch{return t}}}}]},{model:"gpt-5.1"}),l=null;for(let e=1;e<=3;e++)try{e>1&&console.log(`[microcycle-modify] Retry attempt ${e}/3 for week ${i}`);let t=await o.invoke(r);if(!Tz(t.response.days)){let e=t.response.days.map((e,t)=>e&&0!==e.trim().length?-1:t).filter(e=>-1!==e).map(e=>Tk.DAY_NAMES[e]);throw Error(`Microcycle modify validation failed: Missing or empty days for ${e.join(", ")}. Expected all 7 days to be present and non-empty.`)}return console.log(`[microcycle-modify] Successfully modified day overviews and message for week ${i}${e>1?` (after ${e} attempts)`:""}`),{days:t.response.days,description:t.response.overview,isDeload:t.response.isDeload,message:t.message,structure:t.structure,wasModified:t.response.wasModified,modifications:t.response.modifications}}catch(t){if(console.error(`[microcycle-modify] Attempt ${e}/3 failed for week ${i}:`,(l=t instanceof Error?t:Error(String(t))).message),3===e)break}throw Error(`Failed to modify microcycle pattern for week ${i} after 3 attempts. Last error: ${l?.message||"Unknown error"}`)}}let TB=TF.getInstance();e.s(["MicrocycleAgentService",()=>TF,"microcycleAgentService",0,TB],404650),e.i(76421);var TZ=e.i(271964);let TG=fC.z.object({description:fC.z.string().describe("The updated structured text plan with PROGRAM ARCHITECTURE, WEEKLY SCHEDULE TEMPLATE, SESSION GUIDELINES, PROGRESSION STRATEGY, DELOAD PROTOCOL, and KEY PRINCIPLES sections"),wasModified:fC.z.boolean().describe("Whether the plan was actually modified in response to the change request. False if the current plan already satisfies the request or no changes were needed."),modifications:fC.z.string().default("").describe("Explanation of what changed and why (empty string if wasModified is false). When wasModified is true, describe specific changes made to the plan structure.")}),TH=e=>`Parse the following fitness plan into structured format:

${e}`;class Tq{static instance;messageAgentPromise=null;structuredAgentPromise=null;getContextService(){return TC.getInstance()}constructor(){}static getInstance(){return Tq.instance||(Tq.instance=new Tq),Tq.instance}async getMessageAgent(){return this.messageAgentPromise||(this.messageAgentPromise=E5({name:E8.PLAN_MESSAGE,userPrompt:e=>{let t;return t=JSON.parse(e),`
Generate a short, friendly onboarding SMS for the client below based on their new fitness plan.

<User>
Name: ${t.userName}
</User>

<User Profile>
${t.userProfile||"No profile information available"}
</User Profile>

<Fitness Plan>
${t.overview}
</Fitness Plan>

Guidelines:
- This message is sent right after the trainer finishes creating the plan.
- It should sound natural and personal, as if the coach is texting the client directly.
- Focus on what the plan does and how it's structured (e.g., building from base to strength, using 4-day split, etc.).
- Translate complex language into clear, human terms.
- Limit to 1 or 2 messages total (each under 160 characters).
- Do not greet or include the client's name.
- Use first-person tone.
- Avoid em dashes and long sentences.
- Output only the message text (no JSON wrapper).
`.trim()}},{model:"gpt-5-nano"})),this.messageAgentPromise}async getStructuredAgent(){return this.structuredAgentPromise||(this.structuredAgentPromise=E5({name:E8.PLAN_STRUCTURED,userPrompt:e=>{try{let t=JSON.parse(e),r=t.description||t.fitnessPlan||e;return TH(r)}catch{return TH(e)}},schema:TZ.PlanStructureSchema},{model:"gpt-5-nano",maxTokens:32e3})),this.structuredAgentPromise}async generateFitnessPlan(e){let t=await this.getContextService().getContext(e,[TS.USER,TS.USER_PROFILE]),[r,i]=await Promise.all([this.getMessageAgent(),this.getStructuredAgent()]),n=await E5({name:E8.PLAN_GENERATE,context:t,subAgents:[{message:{agent:r,transform:t=>{try{return JSON.stringify({userName:e.name,userProfile:e.profile||"",overview:t})}catch{return JSON.stringify({userName:e.name,userProfile:e.profile||"",overview:t})}}},structure:i}]},{model:"gpt-5.1"}),a=await n.invoke("");return console.log(`[plan-generate] Generated fitness plan for user ${e.id}`),{description:a.response,message:a.message,structure:a.structure}}async modifyFitnessPlan(e,t,r){let i=await this.getContextService().getContext(e,[TS.USER,TS.USER_PROFILE,TS.FITNESS_PLAN],{planText:t.description||""}),n=await this.getStructuredAgent(),a=await E5({name:E8.PLAN_MODIFY,context:i,schema:TG,subAgents:[{structure:n}]},{model:"gpt-5.1"}),s=await a.invoke(r);return console.log(`[plan-modify] Modified fitness plan, wasModified: ${s.response.wasModified}`),{description:s.response.description,wasModified:s.response.wasModified,modifications:s.response.modifications,structure:s.structure}}}let TW=Tq.getInstance();e.s(["FitnessPlanAgentService",()=>Tq,"fitnessPlanAgentService",0,TW],466405),e.s([],331950)}];

//# sourceMappingURL=_d6e170b6._.js.map