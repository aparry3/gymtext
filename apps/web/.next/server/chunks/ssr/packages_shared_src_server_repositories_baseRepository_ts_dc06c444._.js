module.exports=[449083,640796,964081,a=>{"use strict";let b;a.i(800525);var c=a.i(877750);function d(a){return void 0===a||void 0===a}function e(a){return"string"==typeof a}function f(a){return"number"==typeof a}function g(a){return"boolean"==typeof a}function h(a){return"bigint"==typeof a}function i(a){return"function"==typeof a}function j(a){return"object"==typeof a&&null!==a}function k(a){return Object.freeze(a)}function l(a){return m(a)?a:[a]}function m(a){return Array.isArray(a)}function n(a){return a}let o=Object.prototype.toString,p=k({is:a=>"AlterTableNode"===a.kind,create:a=>k({kind:"AlterTableNode",table:a}),cloneWithTableProps:(a,b)=>k({...a,...b}),cloneWithColumnAlteration:(a,b)=>k({...a,columnAlterations:a.columnAlterations?[...a.columnAlterations,b]:[b]})}),q=k({is:a=>"IdentifierNode"===a.kind,create:a=>k({kind:"IdentifierNode",name:a})}),r=k({is:a=>"CreateIndexNode"===a.kind,create:a=>k({kind:"CreateIndexNode",name:q.create(a)}),cloneWith:(a,b)=>k({...a,...b}),cloneWithColumns:(a,b)=>k({...a,columns:[...a.columns||[],...b]})}),s=k({is:a=>"CreateSchemaNode"===a.kind,create:(a,b)=>k({kind:"CreateSchemaNode",schema:q.create(a),...b}),cloneWith:(a,b)=>k({...a,...b})}),t=["preserve rows","delete rows","drop"],u=k({is:a=>"CreateTableNode"===a.kind,create:a=>k({kind:"CreateTableNode",table:a,columns:k([])}),cloneWithColumn:(a,b)=>k({...a,columns:k([...a.columns,b])}),cloneWithConstraint:(a,b)=>k({...a,constraints:a.constraints?k([...a.constraints,b]):k([b])}),cloneWithFrontModifier:(a,b)=>k({...a,frontModifiers:a.frontModifiers?k([...a.frontModifiers,b]):k([b])}),cloneWithEndModifier:(a,b)=>k({...a,endModifiers:a.endModifiers?k([...a.endModifiers,b]):k([b])}),cloneWith:(a,b)=>k({...a,...b})}),v=k({is:a=>"SchemableIdentifierNode"===a.kind,create:a=>k({kind:"SchemableIdentifierNode",identifier:q.create(a)}),createWithSchema:(a,b)=>k({kind:"SchemableIdentifierNode",schema:q.create(a),identifier:q.create(b)})}),w=k({is:a=>"DropIndexNode"===a.kind,create:(a,b)=>k({kind:"DropIndexNode",name:v.create(a),...b}),cloneWith:(a,b)=>k({...a,...b})}),x=k({is:a=>"DropSchemaNode"===a.kind,create:(a,b)=>k({kind:"DropSchemaNode",schema:q.create(a),...b}),cloneWith:(a,b)=>k({...a,...b})}),y=k({is:a=>"DropTableNode"===a.kind,create:(a,b)=>k({kind:"DropTableNode",table:a,...b}),cloneWith:(a,b)=>k({...a,...b})}),z=k({is:a=>"AliasNode"===a.kind,create:(a,b)=>k({kind:"AliasNode",node:a,alias:b})}),A=k({is:a=>"TableNode"===a.kind,create:a=>k({kind:"TableNode",table:v.create(a)}),createWithSchema:(a,b)=>k({kind:"TableNode",table:v.createWithSchema(a,b)})});function B(a){return j(a)&&i(a.toOperationNode)}function C(a){return j(a)&&"expressionType"in a&&B(a)}let D=k({is:a=>"SelectModifierNode"===a.kind,create:(a,b)=>k({kind:"SelectModifierNode",modifier:a,of:b}),createWithExpression:a=>k({kind:"SelectModifierNode",rawModifier:a})}),E=k({is:a=>"AndNode"===a.kind,create:(a,b)=>k({kind:"AndNode",left:a,right:b})}),F=k({is:a=>"OrNode"===a.kind,create:(a,b)=>k({kind:"OrNode",left:a,right:b})}),G=k({is:a=>"OnNode"===a.kind,create:a=>k({kind:"OnNode",on:a}),cloneWithOperation:(a,b,c)=>k({...a,on:"And"===b?E.create(a.on,c):F.create(a.on,c)})}),H=k({is:a=>"JoinNode"===a.kind,create:(a,b)=>k({kind:"JoinNode",joinType:a,table:b,on:void 0}),createWithOn:(a,b,c)=>k({kind:"JoinNode",joinType:a,table:b,on:G.create(c)}),cloneWithOn:(a,b)=>k({...a,on:a.on?G.cloneWithOperation(a.on,"And",b):G.create(b)})}),I=k({is:a=>"BinaryOperationNode"===a.kind,create:(a,b,c)=>k({kind:"BinaryOperationNode",leftOperand:a,operator:b,rightOperand:c})}),J=["->","->>"],K=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from","+","-","*","/","%","^","&","|","#","<<",">>","&&","||",...J,"not","-","exists","not exists","between","between symmetric"],L=k({is:a=>"OperatorNode"===a.kind,create:a=>k({kind:"OperatorNode",operator:a})});function M(a){return e(a)&&J.includes(a)}let N=k({is:a=>"ColumnNode"===a.kind,create:a=>k({kind:"ColumnNode",column:q.create(a)})}),O=k({is:a=>"SelectAllNode"===a.kind,create:()=>k({kind:"SelectAllNode"})}),P=k({is:a=>"ReferenceNode"===a.kind,create:(a,b)=>k({kind:"ReferenceNode",table:b,column:a}),createSelectAll:a=>k({kind:"ReferenceNode",table:a,column:O.create()})});class Q{#a;get dynamicReference(){return this.#a}get refType(){}constructor(a){this.#a=a}toOperationNode(){return ac(this.#a)}}function R(a){return j(a)&&B(a)&&e(a.dynamicReference)}let S=k({is:a=>"OrderByItemNode"===a.kind,create:(a,b)=>k({kind:"OrderByItemNode",orderBy:a,direction:b}),cloneWith:(a,b)=>k({...a,...b})}),T=k({is:a=>"RawNode"===a.kind,create:(a,b)=>k({kind:"RawNode",sqlFragments:k(a),parameters:k(b)}),createWithSql:a=>T.create([a],[]),createWithChild:a=>T.create(["",""],[a]),createWithChildren:a=>T.create(Array(a.length+1).fill(""),a)});class U{#b;constructor(a){this.#b=k(a)}desc(){return new U({node:S.cloneWith(this.#b.node,{direction:T.createWithSql("desc")})})}asc(){return new U({node:S.cloneWith(this.#b.node,{direction:T.createWithSql("asc")})})}nullsLast(){return new U({node:S.cloneWith(this.#b.node,{nulls:"last"})})}nullsFirst(){return new U({node:S.cloneWith(this.#b.node,{nulls:"first"})})}collate(a){let b;return new U({node:S.cloneWith(this.#b.node,{collation:(b=a,k({kind:"CollateNode",collation:q.create(b)}))})})}toOperationNode(){return this.#b.node}}let V=new Set;function W(a){V.has(a)||(V.add(a),console.log(a))}function X(a){return"asc"===a||"desc"===a}function Y(a){if(2===a.length)return[Z(a[0],a[1])];if(1===a.length){let[b]=a;return Array.isArray(b)?(W("orderBy(array) is deprecated, use multiple orderBy calls instead."),b.map(a=>Z(a))):[Z(b)]}throw Error(`Invalid number of arguments at order by! expected 1-2, received ${a.length}`)}function Z(a,b){let c=function(a){if(cj(a))return ch(a);if(R(a))return a.toOperationNode();let[b,c]=a.split(" ");return c?(W("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),$(af(b),c)):af(a)}(a);if(S.is(c)){if(b)throw Error("Cannot specify direction twice!");return c}return $(c,b)}function $(a,b){if("string"==typeof b){if(!X(b))throw Error(`Invalid order by direction: ${b}`);return S.create(a,T.createWithSql(b))}if(C(b))return W("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),S.create(a,b.toOperationNode());let c=S.create(a);return b?b(new U({node:c})).toOperationNode():c}let _=k({is:a=>"JSONReferenceNode"===a.kind,create:(a,b)=>k({kind:"JSONReferenceNode",reference:a,traversal:b}),cloneWithTraversal:(a,b)=>k({...a,traversal:b})}),aa=k({is:a=>"JSONOperatorChainNode"===a.kind,create:a=>k({kind:"JSONOperatorChainNode",operator:a,values:k([])}),cloneWithValue:(a,b)=>k({...a,values:k([...a.values,b])})}),ab=k({is:a=>"JSONPathNode"===a.kind,create:a=>k({kind:"JSONPathNode",inOperator:a,pathLegs:k([])}),cloneWithLeg:(a,b)=>k({...a,pathLegs:k([...a.pathLegs,b])})});function ac(a){return e(a)?af(a):a.toOperationNode()}function ad(a){return m(a)?a.map(a=>ae(a)):[ae(a)]}function ae(a){return cj(a)?ch(a):ac(a)}function af(a){if(!a.includes("."))return P.create(N.create(a));let b=a.split(".").map(ai);if(3===b.length)return function(a){let[b,c,d]=a;return P.create(N.create(d),A.createWithSchema(b,c))}(b);if(2===b.length)return function(a){let[b,c]=a;return P.create(N.create(c),A.create(b))}(b);throw Error(`invalid column reference ${a}`)}function ag(a){return N.create(a)}function ah(a){if(!a.includes(" "))return ag(a);{let[b,c]=a.split(" ").map(ai);if(!X(c))throw Error(`invalid order direction "${c}" next to "${b}"`);return Y([b,c])[0]}}function ai(a){return a.trim()}let aj=k({is:a=>"PrimitiveValueListNode"===a.kind,create:a=>k({kind:"PrimitiveValueListNode",values:k([...a])})}),ak=k({is:a=>"ValueListNode"===a.kind,create:a=>k({kind:"ValueListNode",values:k(a)})}),al=k({is:a=>"ValueNode"===a.kind,create:a=>k({kind:"ValueNode",value:a}),createImmediate:a=>k({kind:"ValueNode",value:a,immediate:!0})});function am(a){return cj(a)?ch(a):al.create(a)}function an(a){return f(a)||g(a)||null===a}function ao(a){if(!an(a))throw Error(`unsafe immediate value ${JSON.stringify(a)}`);return al.createImmediate(a)}let ap=k({is:a=>"ParensNode"===a.kind,create:a=>k({kind:"ParensNode",node:a})});function aq(a){if(3===a.length)return ar(a[0],a[1],a[2]);if(1===a.length)return am(a[0]);throw Error(`invalid arguments: ${JSON.stringify(a)}`)}function ar(a,b,c){var d,e;if(("is"===(d=b)||"is not"===d)&&av(c))return I.create(ae(a),aw(b),al.createImmediate(c));return I.create(ae(a),aw(b),m(c)?(e=c).some(cj)?ak.create(e.map(a=>am(a))):aj.create(e):am(c))}function as(a,b,c){return I.create(ae(a),aw(b),ae(c))}function at(a,b){return au(Object.entries(a).filter(([,a])=>!d(a)).map(([a,b])=>ar(a,av(b)?"is":"=",b)),b)}function au(a,b,c=!0){let d="and"===b?E.create:F.create;if(0===a.length)return I.create(al.createImmediate(1),L.create("="),al.createImmediate(+("and"===b)));let e=ax(a[0]);for(let b=1;b<a.length;++b)e=d(e,ax(a[b]));return a.length>1&&c?ap.create(e):e}function av(a){return null===a||g(a)}function aw(a){if(e(a)&&K.includes(a))return L.create(a);if(B(a))return a.toOperationNode();throw Error(`invalid operator ${JSON.stringify(a)}`)}function ax(a){return B(a)?a.toOperationNode():a}let ay=k({is:a=>"OrderByNode"===a.kind,create:a=>k({kind:"OrderByNode",items:k([...a])}),cloneWithItems:(a,b)=>k({...a,items:k([...a.items,...b])})}),az=k({is:a=>"PartitionByNode"===a.kind,create:a=>k({kind:"PartitionByNode",items:k(a)}),cloneWithItems:(a,b)=>k({...a,items:k([...a.items,...b])})}),aA=k({is:a=>"OverNode"===a.kind,create:()=>k({kind:"OverNode"}),cloneWithOrderByItems:(a,b)=>k({...a,orderBy:a.orderBy?ay.cloneWithItems(a.orderBy,b):ay.create(b)}),cloneWithPartitionByItems:(a,b)=>k({...a,partitionBy:a.partitionBy?az.cloneWithItems(a.partitionBy,b):az.create(b)})}),aB=k({is:a=>"FromNode"===a.kind,create:a=>k({kind:"FromNode",froms:k(a)}),cloneWithFroms:(a,b)=>k({...a,froms:k([...a.froms,...b])})}),aC=k({is:a=>"GroupByNode"===a.kind,create:a=>k({kind:"GroupByNode",items:k(a)}),cloneWithItems:(a,b)=>k({...a,items:k([...a.items,...b])})}),aD=k({is:a=>"HavingNode"===a.kind,create:a=>k({kind:"HavingNode",having:a}),cloneWithOperation:(a,b,c)=>k({...a,having:"And"===b?E.create(a.having,c):F.create(a.having,c)})}),aE=k({is:a=>"InsertQueryNode"===a.kind,create:(a,b,c)=>k({kind:"InsertQueryNode",into:a,...b&&{with:b},replace:c}),createWithoutInto:()=>k({kind:"InsertQueryNode"}),cloneWith:(a,b)=>k({...a,...b})}),aF=k({is:a=>"ListNode"===a.kind,create:a=>k({kind:"ListNode",items:k(a)})}),aG=k({is:a=>"UpdateQueryNode"===a.kind,create:(a,b)=>k({kind:"UpdateQueryNode",table:1===a.length?a[0]:aF.create(a),...b&&{with:b}}),createWithoutTable:()=>k({kind:"UpdateQueryNode"}),cloneWithFromItems:(a,b)=>k({...a,from:a.from?aB.cloneWithFroms(a.from,b):aB.create(b)}),cloneWithUpdates:(a,b)=>k({...a,updates:a.updates?k([...a.updates,...b]):b}),cloneWithLimit:(a,b)=>k({...a,limit:b})}),aH=k({is:a=>"UsingNode"===a.kind,create:a=>k({kind:"UsingNode",tables:k(a)}),cloneWithTables:(a,b)=>k({...a,tables:k([...a.tables,...b])})}),aI=k({is:a=>"DeleteQueryNode"===a.kind,create:(a,b)=>k({kind:"DeleteQueryNode",from:aB.create(a),...b&&{with:b}}),cloneWithOrderByItems:(a,b)=>aP.cloneWithOrderByItems(a,b),cloneWithoutOrderBy:a=>aP.cloneWithoutOrderBy(a),cloneWithLimit:(a,b)=>k({...a,limit:b}),cloneWithoutLimit:a=>k({...a,limit:void 0}),cloneWithUsing:(a,b)=>k({...a,using:void 0!==a.using?aH.cloneWithTables(a.using,b):aH.create(b)})}),aJ=k({is:a=>"WhereNode"===a.kind,create:a=>k({kind:"WhereNode",where:a}),cloneWithOperation:(a,b,c)=>k({...a,where:"And"===b?E.create(a.where,c):F.create(a.where,c)})}),aK=k({is:a=>"ReturningNode"===a.kind,create:a=>k({kind:"ReturningNode",selections:k(a)}),cloneWithSelections:(a,b)=>k({...a,selections:a.selections?k([...a.selections,...b]):k(b)})}),aL=k({is:a=>"ExplainNode"===a.kind,create:(a,b)=>k({kind:"ExplainNode",format:a,options:b})}),aM=k({is:a=>"WhenNode"===a.kind,create:a=>k({kind:"WhenNode",condition:a}),cloneWithResult:(a,b)=>k({...a,result:b})}),aN=k({is:a=>"MergeQueryNode"===a.kind,create:(a,b)=>k({kind:"MergeQueryNode",into:a,...b&&{with:b}}),cloneWithUsing:(a,b)=>k({...a,using:b}),cloneWithWhen:(a,b)=>k({...a,whens:a.whens?k([...a.whens,b]):k([b])}),cloneWithThen:(a,b)=>k({...a,whens:a.whens?k([...a.whens.slice(0,-1),aM.cloneWithResult(a.whens[a.whens.length-1],b)]):void 0})}),aO=k({is:a=>"OutputNode"===a.kind,create:a=>k({kind:"OutputNode",selections:k(a)}),cloneWithSelections:(a,b)=>k({...a,selections:a.selections?k([...a.selections,...b]):k(b)})}),aP=k({is:a=>aQ.is(a)||aE.is(a)||aG.is(a)||aI.is(a)||aN.is(a),cloneWithEndModifier:(a,b)=>k({...a,endModifiers:a.endModifiers?k([...a.endModifiers,b]):k([b])}),cloneWithWhere:(a,b)=>k({...a,where:a.where?aJ.cloneWithOperation(a.where,"And",b):aJ.create(b)}),cloneWithJoin:(a,b)=>k({...a,joins:a.joins?k([...a.joins,b]):k([b])}),cloneWithReturning:(a,b)=>k({...a,returning:a.returning?aK.cloneWithSelections(a.returning,b):aK.create(b)}),cloneWithoutReturning:a=>k({...a,returning:void 0}),cloneWithoutWhere:a=>k({...a,where:void 0}),cloneWithExplain:(a,b,c)=>k({...a,explain:aL.create(b,c?.toOperationNode())}),cloneWithTop:(a,b)=>k({...a,top:b}),cloneWithOutput:(a,b)=>k({...a,output:a.output?aO.cloneWithSelections(a.output,b):aO.create(b)}),cloneWithOrderByItems:(a,b)=>k({...a,orderBy:a.orderBy?ay.cloneWithItems(a.orderBy,b):ay.create(b)}),cloneWithoutOrderBy:a=>k({...a,orderBy:void 0})}),aQ=k({is:a=>"SelectQueryNode"===a.kind,create:a=>k({kind:"SelectQueryNode",...a&&{with:a}}),createFrom:(a,b)=>k({kind:"SelectQueryNode",from:aB.create(a),...b&&{with:b}}),cloneWithSelections:(a,b)=>k({...a,selections:a.selections?k([...a.selections,...b]):k(b)}),cloneWithDistinctOn:(a,b)=>k({...a,distinctOn:a.distinctOn?k([...a.distinctOn,...b]):k(b)}),cloneWithFrontModifier:(a,b)=>k({...a,frontModifiers:a.frontModifiers?k([...a.frontModifiers,b]):k([b])}),cloneWithOrderByItems:(a,b)=>aP.cloneWithOrderByItems(a,b),cloneWithGroupByItems:(a,b)=>k({...a,groupBy:a.groupBy?aC.cloneWithItems(a.groupBy,b):aC.create(b)}),cloneWithLimit:(a,b)=>k({...a,limit:b}),cloneWithOffset:(a,b)=>k({...a,offset:b}),cloneWithFetch:(a,b)=>k({...a,fetch:b}),cloneWithHaving:(a,b)=>k({...a,having:a.having?aD.cloneWithOperation(a.having,"And",b):aD.create(b)}),cloneWithSetOperations:(a,b)=>k({...a,setOperations:a.setOperations?k([...a.setOperations,...b]):k([...b])}),cloneWithoutSelections:a=>k({...a,selections:[]}),cloneWithoutLimit:a=>k({...a,limit:void 0}),cloneWithoutOffset:a=>k({...a,offset:void 0}),cloneWithoutOrderBy:a=>aP.cloneWithoutOrderBy(a),cloneWithoutGroupBy:a=>k({...a,groupBy:void 0})});class aR{#b;constructor(a){this.#b=k(a)}on(...a){return new aR({...this.#b,joinNode:H.cloneWithOn(this.#b.joinNode,aq(a))})}onRef(a,b,c){return new aR({...this.#b,joinNode:H.cloneWithOn(this.#b.joinNode,as(a,b,c))})}onTrue(){return new aR({...this.#b,joinNode:H.cloneWithOn(this.#b.joinNode,T.createWithSql("true"))})}$call(a){return a(this)}toOperationNode(){return this.#b.joinNode}}let aS=k({is:a=>"PartitionByItemNode"===a.kind,create:a=>k({kind:"PartitionByItemNode",partitionBy:a})});class aT{#b;constructor(a){this.#b=k(a)}orderBy(...a){return new aT({overNode:aA.cloneWithOrderByItems(this.#b.overNode,Y(a))})}clearOrderBy(){return new aT({overNode:aP.cloneWithoutOrderBy(this.#b.overNode)})}partitionBy(a){return new aT({overNode:aA.cloneWithPartitionByItems(this.#b.overNode,ad(a).map(aS.create))})}$call(a){return a(this)}toOperationNode(){return this.#b.overNode}}let aU=k({is:a=>"SelectionNode"===a.kind,create:a=>k({kind:"SelectionNode",selection:a}),createSelectAll:()=>k({kind:"SelectionNode",selection:O.create()}),createSelectAllFromTable:a=>k({kind:"SelectionNode",selection:P.createSelectAll(a)})});function aV(a){return i(a)?aV(a(cg())):m(a)?a.map(a=>aW(a)):[aW(a)]}function aW(a){return e(a)?aU.create(function(a){let b=" as ";if(!a.includes(b))return af(a);{let[c,d]=a.split(b).map(ai);return z.create(af(c),q.create(d))}}(a)):R(a)?aU.create(a.toOperationNode()):aU.create(ci(a))}function aX(a){return a?Array.isArray(a)?a.map(aY):[aY(a)]:[aU.createSelectAll()]}function aY(a){if(e(a))return aU.createSelectAllFromTable(cn(a));throw Error(`invalid value selectAll expression: ${JSON.stringify(a)}`)}let aZ=k({is:a=>"ValuesNode"===a.kind,create:a=>k({kind:"ValuesNode",values:k(a)})}),a$=k({is:a=>"DefaultInsertValueNode"===a.kind,create:()=>k({kind:"DefaultInsertValueNode"})});function a_(a){var b;let c,e=i(a)?a(cg()):a;return c=function(a){let b=new Map;for(let c of a)for(let a of Object.keys(c))b.has(a)||void 0===c[a]||b.set(a,b.size);return b}(b=m(e)?e:k([e])),[k([...c.keys()].map(N.create)),aZ.create(b.map(a=>(function(a,b){let c=Object.keys(a),e=Array.from({length:b.size}),f=!1,g=c.length;for(let h of c){let c=b.get(h);if(d(c)){g--;continue}let i=a[h];(d(i)||cj(i))&&(f=!0),e[c]=i}if(g<b.size||f){let a=a$.create();return ak.create(e.map(b=>d(b)?a:am(b)))}return aj.create(e)})(a,c)))]}let a0=k({is:a=>"ColumnUpdateNode"===a.kind,create:(a,b)=>k({kind:"ColumnUpdateNode",column:a,value:b})});function a1(a){return Object.entries(i(a)?a(cg()):a).filter(([a,b])=>void 0!==b).map(([a,b])=>a0.create(N.create(a),am(b)))}let a2=k({is:a=>"OnDuplicateKeyNode"===a.kind,create:a=>k({kind:"OnDuplicateKeyNode",updates:a})});class a3{insertId;numInsertedOrUpdatedRows;constructor(a,b){this.insertId=a,this.numInsertedOrUpdatedRows=b}}class a4 extends Error{node;constructor(a){super("no result"),this.node=a}}function a5(a){return Object.prototype.hasOwnProperty.call(a,"prototype")}let a6=k({is:a=>"OnConflictNode"===a.kind,create:()=>k({kind:"OnConflictNode"}),cloneWith:(a,b)=>k({...a,...b}),cloneWithIndexWhere:(a,b)=>k({...a,indexWhere:a.indexWhere?aJ.cloneWithOperation(a.indexWhere,"And",b):aJ.create(b)}),cloneWithIndexOrWhere:(a,b)=>k({...a,indexWhere:a.indexWhere?aJ.cloneWithOperation(a.indexWhere,"Or",b):aJ.create(b)}),cloneWithUpdateWhere:(a,b)=>k({...a,updateWhere:a.updateWhere?aJ.cloneWithOperation(a.updateWhere,"And",b):aJ.create(b)}),cloneWithUpdateOrWhere:(a,b)=>k({...a,updateWhere:a.updateWhere?aJ.cloneWithOperation(a.updateWhere,"Or",b):aJ.create(b)}),cloneWithoutIndexWhere:a=>k({...a,indexWhere:void 0}),cloneWithoutUpdateWhere:a=>k({...a,updateWhere:void 0})});class a7{#b;constructor(a){this.#b=k(a)}column(a){let b=N.create(a);return new a7({...this.#b,onConflictNode:a6.cloneWith(this.#b.onConflictNode,{columns:this.#b.onConflictNode.columns?k([...this.#b.onConflictNode.columns,b]):k([b])})})}columns(a){let b=a.map(N.create);return new a7({...this.#b,onConflictNode:a6.cloneWith(this.#b.onConflictNode,{columns:this.#b.onConflictNode.columns?k([...this.#b.onConflictNode.columns,...b]):k(b)})})}constraint(a){return new a7({...this.#b,onConflictNode:a6.cloneWith(this.#b.onConflictNode,{constraint:q.create(a)})})}expression(a){return new a7({...this.#b,onConflictNode:a6.cloneWith(this.#b.onConflictNode,{indexExpression:a.toOperationNode()})})}where(...a){return new a7({...this.#b,onConflictNode:a6.cloneWithIndexWhere(this.#b.onConflictNode,aq(a))})}whereRef(a,b,c){return new a7({...this.#b,onConflictNode:a6.cloneWithIndexWhere(this.#b.onConflictNode,as(a,b,c))})}clearWhere(){return new a7({...this.#b,onConflictNode:a6.cloneWithoutIndexWhere(this.#b.onConflictNode)})}doNothing(){return new a8({...this.#b,onConflictNode:a6.cloneWith(this.#b.onConflictNode,{doNothing:!0})})}doUpdateSet(a){return new a9({...this.#b,onConflictNode:a6.cloneWith(this.#b.onConflictNode,{updates:a1(a)})})}$call(a){return a(this)}}class a8{#b;constructor(a){this.#b=k(a)}toOperationNode(){return this.#b.onConflictNode}}class a9{#b;constructor(a){this.#b=k(a)}where(...a){return new a9({...this.#b,onConflictNode:a6.cloneWithUpdateWhere(this.#b.onConflictNode,aq(a))})}whereRef(a,b,c){return new a9({...this.#b,onConflictNode:a6.cloneWithUpdateWhere(this.#b.onConflictNode,as(a,b,c))})}clearWhere(){return new a9({...this.#b,onConflictNode:a6.cloneWithoutUpdateWhere(this.#b.onConflictNode)})}$call(a){return a(this)}toOperationNode(){return this.#b.onConflictNode}}let ba=k({is:a=>"TopNode"===a.kind,create:(a,b)=>k({kind:"TopNode",expression:a,modifiers:b})});function bb(a,b){var c;if(!f(a)&&!h(a))throw Error(`Invalid top expression: ${a}`);if(!d(b)&&"percent"!==(c=b)&&"with ties"!==c&&"percent with ties"!==c)throw Error(`Invalid top modifiers: ${b}`);return ba.create(a,b)}let bc=k({is:a=>"OrActionNode"===a.kind,create:a=>k({kind:"OrActionNode",action:a})});class bd{#b;constructor(a){this.#b=k(a)}values(a){let[b,c]=a_(a);return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{columns:b,values:c})})}columns(a){return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{columns:k(a.map(N.create))})})}expression(a){return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{values:ch(a)})})}defaultValues(){return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{defaultValues:!0})})}modifyEnd(a){return new bd({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,a.toOperationNode())})}ignore(){return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{orAction:bc.create("ignore")})})}orIgnore(){return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{orAction:bc.create("ignore")})})}orAbort(){return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{orAction:bc.create("abort")})})}orFail(){return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{orAction:bc.create("fail")})})}orReplace(){return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{orAction:bc.create("replace")})})}orRollback(){return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{orAction:bc.create("rollback")})})}top(a,b){return new bd({...this.#b,queryNode:aP.cloneWithTop(this.#b.queryNode,bb(a,b))})}onConflict(a){return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{onConflict:a(new a7({onConflictNode:a6.create()})).toOperationNode()})})}onDuplicateKeyUpdate(a){return new bd({...this.#b,queryNode:aE.cloneWith(this.#b.queryNode,{onDuplicateKey:a2.create(a1(a))})})}returning(a){return new bd({...this.#b,queryNode:aP.cloneWithReturning(this.#b.queryNode,aV(a))})}returningAll(){return new bd({...this.#b,queryNode:aP.cloneWithReturning(this.#b.queryNode,aX())})}output(a){return new bd({...this.#b,queryNode:aP.cloneWithOutput(this.#b.queryNode,aV(a))})}outputAll(a){return new bd({...this.#b,queryNode:aP.cloneWithOutput(this.#b.queryNode,aX(a))})}clearReturning(){return new bd({...this.#b,queryNode:aP.cloneWithoutReturning(this.#b.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new bd({...this.#b})}$castTo(){return new bd(this.#b)}$narrowType(){return new bd(this.#b)}$assertType(){return new bd(this.#b)}withPlugin(a){return new bd({...this.#b,executor:this.#b.executor.withPlugin(a)})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.queryNode,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){let a=this.compile(),b=await this.#b.executor.executeQuery(a,this.#b.queryId),{adapter:c}=this.#b.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new a3(b.insertId,b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=a4){let b=await this.executeTakeFirst();if(void 0===b)throw a5(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#b.executor.stream(b,a,this.#b.queryId))yield*c.rows}async explain(a,b){let c=new bd({...this.#b,queryNode:aP.cloneWithExplain(this.#b.queryNode,a,b)});return await c.execute()}}class be{numDeletedRows;constructor(a){this.numDeletedRows=a}}let bf=k({is:a=>"LimitNode"===a.kind,create:a=>k({kind:"LimitNode",limit:a})});class bg{#b;constructor(a){this.#b=k(a)}where(...a){return new bg({...this.#b,queryNode:aP.cloneWithWhere(this.#b.queryNode,aq(a))})}whereRef(a,b,c){return new bg({...this.#b,queryNode:aP.cloneWithWhere(this.#b.queryNode,as(a,b,c))})}clearWhere(){return new bg({...this.#b,queryNode:aP.cloneWithoutWhere(this.#b.queryNode)})}top(a,b){return new bg({...this.#b,queryNode:aP.cloneWithTop(this.#b.queryNode,bb(a,b))})}using(a){return new bg({...this.#b,queryNode:aI.cloneWithUsing(this.#b.queryNode,ck(a))})}innerJoin(...a){return this.#c("InnerJoin",a)}leftJoin(...a){return this.#c("LeftJoin",a)}rightJoin(...a){return this.#c("RightJoin",a)}fullJoin(...a){return this.#c("FullJoin",a)}#c(a,b){return new bg({...this.#b,queryNode:aP.cloneWithJoin(this.#b.queryNode,bM(a,b))})}returning(a){return new bg({...this.#b,queryNode:aP.cloneWithReturning(this.#b.queryNode,aV(a))})}returningAll(a){return new bg({...this.#b,queryNode:aP.cloneWithReturning(this.#b.queryNode,aX(a))})}output(a){return new bg({...this.#b,queryNode:aP.cloneWithOutput(this.#b.queryNode,aV(a))})}outputAll(a){return new bg({...this.#b,queryNode:aP.cloneWithOutput(this.#b.queryNode,aX(a))})}clearReturning(){return new bg({...this.#b,queryNode:aP.cloneWithoutReturning(this.#b.queryNode)})}clearLimit(){return new bg({...this.#b,queryNode:aI.cloneWithoutLimit(this.#b.queryNode)})}orderBy(...a){return new bg({...this.#b,queryNode:aP.cloneWithOrderByItems(this.#b.queryNode,Y(a))})}clearOrderBy(){return new bg({...this.#b,queryNode:aP.cloneWithoutOrderBy(this.#b.queryNode)})}limit(a){return new bg({...this.#b,queryNode:aI.cloneWithLimit(this.#b.queryNode,bf.create(am(a)))})}modifyEnd(a){return new bg({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,a.toOperationNode())})}$call(a){return a(this)}$if(a,b){return a?b(this):new bg({...this.#b})}$castTo(){return new bg(this.#b)}$narrowType(){return new bg(this.#b)}$assertType(){return new bg(this.#b)}withPlugin(a){return new bg({...this.#b,executor:this.#b.executor.withPlugin(a)})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.queryNode,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){let a=this.compile(),b=await this.#b.executor.executeQuery(a,this.#b.queryId),{adapter:c}=this.#b.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new be(b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=a4){let b=await this.executeTakeFirst();if(void 0===b)throw a5(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#b.executor.stream(b,a,this.#b.queryId))yield*c.rows}async explain(a,b){let c=new bg({...this.#b,queryNode:aP.cloneWithExplain(this.#b.queryNode,a,b)});return await c.execute()}}class bh{numUpdatedRows;numChangedRows;constructor(a,b){this.numUpdatedRows=a,this.numChangedRows=b}}class bi{#b;constructor(a){this.#b=k(a)}where(...a){return new bi({...this.#b,queryNode:aP.cloneWithWhere(this.#b.queryNode,aq(a))})}whereRef(a,b,c){return new bi({...this.#b,queryNode:aP.cloneWithWhere(this.#b.queryNode,as(a,b,c))})}clearWhere(){return new bi({...this.#b,queryNode:aP.cloneWithoutWhere(this.#b.queryNode)})}top(a,b){return new bi({...this.#b,queryNode:aP.cloneWithTop(this.#b.queryNode,bb(a,b))})}from(a){return new bi({...this.#b,queryNode:aG.cloneWithFromItems(this.#b.queryNode,ck(a))})}innerJoin(...a){return this.#c("InnerJoin",a)}leftJoin(...a){return this.#c("LeftJoin",a)}rightJoin(...a){return this.#c("RightJoin",a)}fullJoin(...a){return this.#c("FullJoin",a)}#c(a,b){return new bi({...this.#b,queryNode:aP.cloneWithJoin(this.#b.queryNode,bM(a,b))})}orderBy(...a){return new bi({...this.#b,queryNode:aP.cloneWithOrderByItems(this.#b.queryNode,Y(a))})}clearOrderBy(){return new bi({...this.#b,queryNode:aP.cloneWithoutOrderBy(this.#b.queryNode)})}limit(a){return new bi({...this.#b,queryNode:aG.cloneWithLimit(this.#b.queryNode,bf.create(am(a)))})}set(...a){return new bi({...this.#b,queryNode:aG.cloneWithUpdates(this.#b.queryNode,function(...a){return 2===a.length?[a0.create(ae(a[0]),am(a[1]))]:a1(a[0])}(...a))})}returning(a){return new bi({...this.#b,queryNode:aP.cloneWithReturning(this.#b.queryNode,aV(a))})}returningAll(a){return new bi({...this.#b,queryNode:aP.cloneWithReturning(this.#b.queryNode,aX(a))})}output(a){return new bi({...this.#b,queryNode:aP.cloneWithOutput(this.#b.queryNode,aV(a))})}outputAll(a){return new bi({...this.#b,queryNode:aP.cloneWithOutput(this.#b.queryNode,aX(a))})}modifyEnd(a){return new bi({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,a.toOperationNode())})}clearReturning(){return new bi({...this.#b,queryNode:aP.cloneWithoutReturning(this.#b.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new bi({...this.#b})}$castTo(){return new bi(this.#b)}$narrowType(){return new bi(this.#b)}$assertType(){return new bi(this.#b)}withPlugin(a){return new bi({...this.#b,executor:this.#b.executor.withPlugin(a)})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.queryNode,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){let a=this.compile(),b=await this.#b.executor.executeQuery(a,this.#b.queryId),{adapter:c}=this.#b.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new bh(b.numAffectedRows??BigInt(0),b.numChangedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=a4){let b=await this.executeTakeFirst();if(void 0===b)throw a5(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#b.executor.stream(b,a,this.#b.queryId))yield*c.rows}async explain(a,b){let c=new bi({...this.#b,queryNode:aP.cloneWithExplain(this.#b.queryNode,a,b)});return await c.execute()}}let bj=k({is:a=>"CommonTableExpressionNameNode"===a.kind,create:(a,b)=>k({kind:"CommonTableExpressionNameNode",table:A.create(a),columns:b?k(b.map(N.create)):void 0})}),bk=k({is:a=>"CommonTableExpressionNode"===a.kind,create:(a,b)=>k({kind:"CommonTableExpressionNode",name:a,expression:b}),cloneWith:(a,b)=>k({...a,...b})});class bl{#b;constructor(a){this.#b=k(a)}materialized(){return new bl({...this.#b,node:bk.cloneWith(this.#b.node,{materialized:!0})})}notMaterialized(){return new bl({...this.#b,node:bk.cloneWith(this.#b.node,{materialized:!1})})}toOperationNode(){return this.#b.node}}function bm(a,b){var c;let d=b(new bL({executor:bF})).toOperationNode();return i(a)?a((c=d,a=>new bl({node:bk.create(bn(a),c)}))).toOperationNode():bk.create(bn(a),d)}function bn(a){if(!a.includes("("))return bj.create(a);{let b=a.split(/[\(\)]/),c=b[0],d=b[1].split(",").map(a=>a.trim());return bj.create(c,d)}}let bo=k({is:a=>"WithNode"===a.kind,create:(a,b)=>k({kind:"WithNode",expressions:k([a]),...b}),cloneWithExpression:(a,b)=>k({...a,expressions:k([...a.expressions,b])})}),bp=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function bq(){return new br}class br{#d;get queryId(){return void 0===this.#d&&(this.#d=function(a){let b="";for(let a=0;a<8;++a)b+=bp[~~(Math.random()*bp.length)];return b}(0)),this.#d}}class bs{nodeStack=[];#e=k({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(a,b){if(!a)return a;this.nodeStack.push(a);let c=this.transformNodeImpl(a,b);return this.nodeStack.pop(),k(c)}transformNodeImpl(a,b){return this.#e[a.kind](a,b)}transformNodeList(a,b){return a?k(a.map(a=>this.transformNode(a,b))):a}transformSelectQuery(a,b){return{kind:"SelectQueryNode",from:this.transformNode(a.from,b),selections:this.transformNodeList(a.selections,b),distinctOn:this.transformNodeList(a.distinctOn,b),joins:this.transformNodeList(a.joins,b),groupBy:this.transformNode(a.groupBy,b),orderBy:this.transformNode(a.orderBy,b),where:this.transformNode(a.where,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),limit:this.transformNode(a.limit,b),offset:this.transformNode(a.offset,b),with:this.transformNode(a.with,b),having:this.transformNode(a.having,b),explain:this.transformNode(a.explain,b),setOperations:this.transformNodeList(a.setOperations,b),fetch:this.transformNode(a.fetch,b),top:this.transformNode(a.top,b)}}transformSelection(a,b){return{kind:"SelectionNode",selection:this.transformNode(a.selection,b)}}transformColumn(a,b){return{kind:"ColumnNode",column:this.transformNode(a.column,b)}}transformAlias(a,b){return{kind:"AliasNode",node:this.transformNode(a.node,b),alias:this.transformNode(a.alias,b)}}transformTable(a,b){return{kind:"TableNode",table:this.transformNode(a.table,b)}}transformFrom(a,b){return{kind:"FromNode",froms:this.transformNodeList(a.froms,b)}}transformReference(a,b){return{kind:"ReferenceNode",column:this.transformNode(a.column,b),table:this.transformNode(a.table,b)}}transformAnd(a,b){return{kind:"AndNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformOr(a,b){return{kind:"OrNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformValueList(a,b){return{kind:"ValueListNode",values:this.transformNodeList(a.values,b)}}transformParens(a,b){return{kind:"ParensNode",node:this.transformNode(a.node,b)}}transformJoin(a,b){return{kind:"JoinNode",joinType:a.joinType,table:this.transformNode(a.table,b),on:this.transformNode(a.on,b)}}transformRaw(a,b){return{kind:"RawNode",sqlFragments:k([...a.sqlFragments]),parameters:this.transformNodeList(a.parameters,b)}}transformWhere(a,b){return{kind:"WhereNode",where:this.transformNode(a.where,b)}}transformInsertQuery(a,b){return{kind:"InsertQueryNode",into:this.transformNode(a.into,b),columns:this.transformNodeList(a.columns,b),values:this.transformNode(a.values,b),returning:this.transformNode(a.returning,b),onConflict:this.transformNode(a.onConflict,b),onDuplicateKey:this.transformNode(a.onDuplicateKey,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),ignore:a.ignore,orAction:this.transformNode(a.orAction,b),replace:a.replace,explain:this.transformNode(a.explain,b),defaultValues:a.defaultValues,top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformValues(a,b){return{kind:"ValuesNode",values:this.transformNodeList(a.values,b)}}transformDeleteQuery(a,b){return{kind:"DeleteQueryNode",from:this.transformNode(a.from,b),using:this.transformNode(a.using,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),orderBy:this.transformNode(a.orderBy,b),limit:this.transformNode(a.limit,b),explain:this.transformNode(a.explain,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformReturning(a,b){return{kind:"ReturningNode",selections:this.transformNodeList(a.selections,b)}}transformCreateTable(a,b){return{kind:"CreateTableNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),constraints:this.transformNodeList(a.constraints,b),temporary:a.temporary,ifNotExists:a.ifNotExists,onCommit:a.onCommit,frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),selectQuery:this.transformNode(a.selectQuery,b)}}transformColumnDefinition(a,b){return{kind:"ColumnDefinitionNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),references:this.transformNode(a.references,b),primaryKey:a.primaryKey,autoIncrement:a.autoIncrement,unique:a.unique,notNull:a.notNull,unsigned:a.unsigned,defaultTo:this.transformNode(a.defaultTo,b),check:this.transformNode(a.check,b),generated:this.transformNode(a.generated,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),nullsNotDistinct:a.nullsNotDistinct,identity:a.identity,ifNotExists:a.ifNotExists}}transformAddColumn(a,b){return{kind:"AddColumnNode",column:this.transformNode(a.column,b)}}transformDropTable(a,b){return{kind:"DropTableNode",table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformOrderBy(a,b){return{kind:"OrderByNode",items:this.transformNodeList(a.items,b)}}transformOrderByItem(a,b){return{kind:"OrderByItemNode",orderBy:this.transformNode(a.orderBy,b),direction:this.transformNode(a.direction,b),collation:this.transformNode(a.collation,b),nulls:a.nulls}}transformGroupBy(a,b){return{kind:"GroupByNode",items:this.transformNodeList(a.items,b)}}transformGroupByItem(a,b){return{kind:"GroupByItemNode",groupBy:this.transformNode(a.groupBy,b)}}transformUpdateQuery(a,b){return{kind:"UpdateQueryNode",table:this.transformNode(a.table,b),from:this.transformNode(a.from,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),updates:this.transformNodeList(a.updates,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),explain:this.transformNode(a.explain,b),limit:this.transformNode(a.limit,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b),orderBy:this.transformNode(a.orderBy,b)}}transformColumnUpdate(a,b){return{kind:"ColumnUpdateNode",column:this.transformNode(a.column,b),value:this.transformNode(a.value,b)}}transformLimit(a,b){return{kind:"LimitNode",limit:this.transformNode(a.limit,b)}}transformOffset(a,b){return{kind:"OffsetNode",offset:this.transformNode(a.offset,b)}}transformOnConflict(a,b){return{kind:"OnConflictNode",columns:this.transformNodeList(a.columns,b),constraint:this.transformNode(a.constraint,b),indexExpression:this.transformNode(a.indexExpression,b),indexWhere:this.transformNode(a.indexWhere,b),updates:this.transformNodeList(a.updates,b),updateWhere:this.transformNode(a.updateWhere,b),doNothing:a.doNothing}}transformOnDuplicateKey(a,b){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(a.updates,b)}}transformCreateIndex(a,b){return{kind:"CreateIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists,where:this.transformNode(a.where,b),nullsNotDistinct:a.nullsNotDistinct}}transformList(a,b){return{kind:"ListNode",items:this.transformNodeList(a.items,b)}}transformDropIndex(a,b){return{kind:"DropIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformPrimaryKeyConstraint(a,b){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformUniqueConstraint(a,b){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),nullsNotDistinct:a.nullsNotDistinct,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformForeignKeyConstraint(a,b){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(a.columns,b),references:this.transformNode(a.references,b),name:this.transformNode(a.name,b),onDelete:a.onDelete,onUpdate:a.onUpdate,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformSetOperation(a,b){return{kind:"SetOperationNode",operator:a.operator,expression:this.transformNode(a.expression,b),all:a.all}}transformReferences(a,b){return{kind:"ReferencesNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),onDelete:a.onDelete,onUpdate:a.onUpdate}}transformCheckConstraint(a,b){return{kind:"CheckConstraintNode",expression:this.transformNode(a.expression,b),name:this.transformNode(a.name,b)}}transformWith(a,b){return{kind:"WithNode",expressions:this.transformNodeList(a.expressions,b),recursive:a.recursive}}transformCommonTableExpression(a,b){return{kind:"CommonTableExpressionNode",name:this.transformNode(a.name,b),materialized:a.materialized,expression:this.transformNode(a.expression,b)}}transformCommonTableExpressionName(a,b){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b)}}transformHaving(a,b){return{kind:"HavingNode",having:this.transformNode(a.having,b)}}transformCreateSchema(a,b){return{kind:"CreateSchemaNode",schema:this.transformNode(a.schema,b),ifNotExists:a.ifNotExists}}transformDropSchema(a,b){return{kind:"DropSchemaNode",schema:this.transformNode(a.schema,b),ifExists:a.ifExists,cascade:a.cascade}}transformAlterTable(a,b){return{kind:"AlterTableNode",table:this.transformNode(a.table,b),renameTo:this.transformNode(a.renameTo,b),setSchema:this.transformNode(a.setSchema,b),columnAlterations:this.transformNodeList(a.columnAlterations,b),addConstraint:this.transformNode(a.addConstraint,b),dropConstraint:this.transformNode(a.dropConstraint,b),renameConstraint:this.transformNode(a.renameConstraint,b),addIndex:this.transformNode(a.addIndex,b),dropIndex:this.transformNode(a.dropIndex,b)}}transformDropColumn(a,b){return{kind:"DropColumnNode",column:this.transformNode(a.column,b)}}transformRenameColumn(a,b){return{kind:"RenameColumnNode",column:this.transformNode(a.column,b),renameTo:this.transformNode(a.renameTo,b)}}transformAlterColumn(a,b){return{kind:"AlterColumnNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),dataTypeExpression:this.transformNode(a.dataTypeExpression,b),setDefault:this.transformNode(a.setDefault,b),dropDefault:a.dropDefault,setNotNull:a.setNotNull,dropNotNull:a.dropNotNull}}transformModifyColumn(a,b){return{kind:"ModifyColumnNode",column:this.transformNode(a.column,b)}}transformAddConstraint(a,b){return{kind:"AddConstraintNode",constraint:this.transformNode(a.constraint,b)}}transformDropConstraint(a,b){return{kind:"DropConstraintNode",constraintName:this.transformNode(a.constraintName,b),ifExists:a.ifExists,modifier:a.modifier}}transformRenameConstraint(a,b){return{kind:"RenameConstraintNode",oldName:this.transformNode(a.oldName,b),newName:this.transformNode(a.newName,b)}}transformCreateView(a,b){return{kind:"CreateViewNode",name:this.transformNode(a.name,b),temporary:a.temporary,orReplace:a.orReplace,ifNotExists:a.ifNotExists,materialized:a.materialized,columns:this.transformNodeList(a.columns,b),as:this.transformNode(a.as,b)}}transformRefreshMaterializedView(a,b){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(a.name,b),concurrently:a.concurrently,withNoData:a.withNoData}}transformDropView(a,b){return{kind:"DropViewNode",name:this.transformNode(a.name,b),ifExists:a.ifExists,materialized:a.materialized,cascade:a.cascade}}transformGenerated(a,b){return{kind:"GeneratedNode",byDefault:a.byDefault,always:a.always,identity:a.identity,stored:a.stored,expression:this.transformNode(a.expression,b)}}transformDefaultValue(a,b){return{kind:"DefaultValueNode",defaultValue:this.transformNode(a.defaultValue,b)}}transformOn(a,b){return{kind:"OnNode",on:this.transformNode(a.on,b)}}transformSelectModifier(a,b){return{kind:"SelectModifierNode",modifier:a.modifier,rawModifier:this.transformNode(a.rawModifier,b),of:this.transformNodeList(a.of,b)}}transformCreateType(a,b){return{kind:"CreateTypeNode",name:this.transformNode(a.name,b),enum:this.transformNode(a.enum,b)}}transformDropType(a,b){return{kind:"DropTypeNode",name:this.transformNode(a.name,b),ifExists:a.ifExists}}transformExplain(a,b){return{kind:"ExplainNode",format:a.format,options:this.transformNode(a.options,b)}}transformSchemableIdentifier(a,b){return{kind:"SchemableIdentifierNode",schema:this.transformNode(a.schema,b),identifier:this.transformNode(a.identifier,b)}}transformAggregateFunction(a,b){return{kind:"AggregateFunctionNode",func:a.func,aggregated:this.transformNodeList(a.aggregated,b),distinct:a.distinct,orderBy:this.transformNode(a.orderBy,b),withinGroup:this.transformNode(a.withinGroup,b),filter:this.transformNode(a.filter,b),over:this.transformNode(a.over,b)}}transformOver(a,b){return{kind:"OverNode",orderBy:this.transformNode(a.orderBy,b),partitionBy:this.transformNode(a.partitionBy,b)}}transformPartitionBy(a,b){return{kind:"PartitionByNode",items:this.transformNodeList(a.items,b)}}transformPartitionByItem(a,b){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(a.partitionBy,b)}}transformBinaryOperation(a,b){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(a.leftOperand,b),operator:this.transformNode(a.operator,b),rightOperand:this.transformNode(a.rightOperand,b)}}transformUnaryOperation(a,b){return{kind:"UnaryOperationNode",operator:this.transformNode(a.operator,b),operand:this.transformNode(a.operand,b)}}transformUsing(a,b){return{kind:"UsingNode",tables:this.transformNodeList(a.tables,b)}}transformFunction(a,b){return{kind:"FunctionNode",func:a.func,arguments:this.transformNodeList(a.arguments,b)}}transformCase(a,b){return{kind:"CaseNode",value:this.transformNode(a.value,b),when:this.transformNodeList(a.when,b),else:this.transformNode(a.else,b),isStatement:a.isStatement}}transformWhen(a,b){return{kind:"WhenNode",condition:this.transformNode(a.condition,b),result:this.transformNode(a.result,b)}}transformJSONReference(a,b){return{kind:"JSONReferenceNode",reference:this.transformNode(a.reference,b),traversal:this.transformNode(a.traversal,b)}}transformJSONPath(a,b){return{kind:"JSONPathNode",inOperator:this.transformNode(a.inOperator,b),pathLegs:this.transformNodeList(a.pathLegs,b)}}transformJSONPathLeg(a,b){return{kind:"JSONPathLegNode",type:a.type,value:a.value}}transformJSONOperatorChain(a,b){return{kind:"JSONOperatorChainNode",operator:this.transformNode(a.operator,b),values:this.transformNodeList(a.values,b)}}transformTuple(a,b){return{kind:"TupleNode",values:this.transformNodeList(a.values,b)}}transformMergeQuery(a,b){return{kind:"MergeQueryNode",into:this.transformNode(a.into,b),using:this.transformNode(a.using,b),whens:this.transformNodeList(a.whens,b),with:this.transformNode(a.with,b),top:this.transformNode(a.top,b),endModifiers:this.transformNodeList(a.endModifiers,b),output:this.transformNode(a.output,b),returning:this.transformNode(a.returning,b)}}transformMatched(a,b){return{kind:"MatchedNode",not:a.not,bySource:a.bySource}}transformAddIndex(a,b){return{kind:"AddIndexNode",name:this.transformNode(a.name,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists}}transformCast(a,b){return{kind:"CastNode",expression:this.transformNode(a.expression,b),dataType:this.transformNode(a.dataType,b)}}transformFetch(a,b){return{kind:"FetchNode",rowCount:this.transformNode(a.rowCount,b),modifier:a.modifier}}transformTop(a,b){return{kind:"TopNode",expression:a.expression,modifiers:a.modifiers}}transformOutput(a,b){return{kind:"OutputNode",selections:this.transformNodeList(a.selections,b)}}transformDataType(a,b){return a}transformSelectAll(a,b){return a}transformIdentifier(a,b){return a}transformValue(a,b){return a}transformPrimitiveValueList(a,b){return a}transformOperator(a,b){return a}transformDefaultInsertValue(a,b){return a}transformOrAction(a,b){return a}transformCollate(a,b){return a}}let bt=k({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),bu={json_agg:!0,to_json:!0};class bv extends bs{#f;#g=new Set;#h=new Set;constructor(a){super(),this.#f=a}transformNodeImpl(a,b){if(!this.#i(a))return super.transformNodeImpl(a,b);let c=this.#j(a);for(let a of c)this.#h.add(a);let d=this.#k(a);for(let a of d)this.#g.add(a);let e=super.transformNodeImpl(a,b);for(let a of d)this.#g.delete(a);for(let a of c)this.#h.delete(a);return e}transformSchemableIdentifier(a,b){let c=super.transformSchemableIdentifier(a,b);return c.schema||!this.#g.has(a.identifier.name)?c:{...c,schema:q.create(this.#f)}}transformReferences(a,b){let c=super.transformReferences(a,b);return c.table.table.schema?c:{...c,table:A.createWithSchema(this.#f,c.table.table.identifier.name)}}transformAggregateFunction(a,b){return{...super.transformAggregateFunction({...a,aggregated:[]},b),aggregated:this.#l(a,b,"aggregated")}}transformFunction(a,b){return{...super.transformFunction({...a,arguments:[]},b),arguments:this.#l(a,b,"arguments")}}#l(a,b,c){return bu[a.func]?a[c].map(a=>!A.is(a)||a.table.schema?this.transformNode(a,b):{...a,table:this.transformIdentifier(a.table.identifier,b)}):this.transformNodeList(a[c],b)}#i(a){return a.kind in bt}#k(a){let b=new Set;if("name"in a&&a.name&&v.is(a.name)&&this.#m(a.name,b),"from"in a&&a.from)for(let c of a.from.froms)this.#n(c,b);if("into"in a&&a.into&&this.#n(a.into,b),"table"in a&&a.table&&this.#n(a.table,b),"joins"in a&&a.joins)for(let c of a.joins)this.#n(c.table,b);return"using"in a&&a.using&&this.#n(a.using,b),b}#j(a){let b=new Set;return"with"in a&&a.with&&this.#o(a.with,b),b}#n(a,b){if(A.is(a))this.#m(a.table,b);else if(z.is(a)&&A.is(a.node))this.#m(a.node.table,b);else if(aF.is(a))for(let c of a.items)this.#n(c,b)}#m(a,b){let c=a.identifier.name;this.#g.has(c)||this.#h.has(c)||b.add(c)}#o(a,b){for(let c of a.expressions){let a=c.name.table.table.identifier.name;this.#h.has(a)||b.add(a)}}}class bw{#p;constructor(a){this.#p=new bv(a)}transformQuery(a){return this.#p.transformNode(a.node,a.queryId)}async transformResult(a){return a.result}}let bx=k({is:a=>"MatchedNode"===a.kind,create:(a,b=!1)=>k({kind:"MatchedNode",not:a,bySource:b})});function by(a,b,c){return aM.create(au([bx.create(!a.isMatched,a.bySource),...b&&b.length>0?[3===b.length&&c?as(b[0],b[1],b[2]):aq(b)]:[]],"and",!1))}function bz(a){return e(a)?T.create([a],[]):B(a)?a.toOperationNode():a}class bA{#q;#r;#s;constructor(){this.#q=new Promise((a,b)=>{this.#s=b,this.#r=a})}get promise(){return this.#q}resolve=a=>{this.#r&&this.#r(a)};reject=a=>{this.#s&&this.#s(a)}}async function bB(a){let b=new bA,c=new bA;return a.provideConnection(async a=>(b.resolve(a),await c.promise)).catch(a=>b.reject(a)),k({connection:await b.promise,release:c.resolve})}let bC=k([]);class bD{#t;constructor(a=bC){this.#t=a}get plugins(){return this.#t}transformQuery(a,b){for(let c of this.#t){let d=c.transformQuery({node:a,queryId:b});if(d.kind===a.kind)a=d;else throw Error(`KyselyPlugin.transformQuery must return a node of the same kind that was given to it. The plugin was given a ${a.kind} but it returned a ${d.kind}`)}return a}async executeQuery(a,b){return await this.provideConnection(async c=>{let d=await c.executeQuery(a);return"numUpdatedOrDeletedRows"in d&&W("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#u(d,b)})}async *stream(a,b,c){let{connection:d,release:e}=await bB(this);try{for await(let e of d.streamQuery(a,b))yield await this.#u(e,c)}finally{e()}}async #u(a,b){for(let c of this.#t)a=await c.transformResult({result:a,queryId:b});return a}}class bE extends bD{get adapter(){throw Error("this query cannot be compiled to SQL")}compileQuery(){throw Error("this query cannot be compiled to SQL")}provideConnection(){throw Error("this query cannot be executed")}withConnectionProvider(){throw Error("this query cannot have a connection provider")}withPlugin(a){return new bE([...this.plugins,a])}withPlugins(a){return new bE([...this.plugins,...a])}withPluginAtFront(a){return new bE([a,...this.plugins])}withoutPlugins(){return new bE([])}}let bF=new bE;class bG{numChangedRows;constructor(a){this.numChangedRows=a}}class bH{#b;constructor(a){this.#b=k(a)}modifyEnd(a){return new bH({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,a.toOperationNode())})}top(a,b){return new bH({...this.#b,queryNode:aP.cloneWithTop(this.#b.queryNode,bb(a,b))})}using(...a){return new bI({...this.#b,queryNode:aN.cloneWithUsing(this.#b.queryNode,bM("Using",a))})}returning(a){return new bH({...this.#b,queryNode:aP.cloneWithReturning(this.#b.queryNode,aV(a))})}returningAll(a){return new bH({...this.#b,queryNode:aP.cloneWithReturning(this.#b.queryNode,aX(a))})}output(a){return new bH({...this.#b,queryNode:aP.cloneWithOutput(this.#b.queryNode,aV(a))})}outputAll(a){return new bH({...this.#b,queryNode:aP.cloneWithOutput(this.#b.queryNode,aX(a))})}}class bI{#b;constructor(a){this.#b=k(a)}modifyEnd(a){return new bI({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,a.toOperationNode())})}top(a,b){return new bI({...this.#b,queryNode:aP.cloneWithTop(this.#b.queryNode,bb(a,b))})}whenMatched(){return this.#v([])}whenMatchedAnd(...a){return this.#v(a)}whenMatchedAndRef(a,b,c){return this.#v([a,b,c],!0)}#v(a,b){return new bJ({...this.#b,queryNode:aN.cloneWithWhen(this.#b.queryNode,by({isMatched:!0},a,b))})}whenNotMatched(){return this.#w([])}whenNotMatchedAnd(...a){return this.#w(a)}whenNotMatchedAndRef(a,b,c){return this.#w([a,b,c],!0)}whenNotMatchedBySource(){return this.#w([],!1,!0)}whenNotMatchedBySourceAnd(...a){return this.#w(a,!1,!0)}whenNotMatchedBySourceAndRef(a,b,c){return this.#w([a,b,c],!0,!0)}returning(a){return new bI({...this.#b,queryNode:aP.cloneWithReturning(this.#b.queryNode,aV(a))})}returningAll(a){return new bI({...this.#b,queryNode:aP.cloneWithReturning(this.#b.queryNode,aX(a))})}output(a){return new bI({...this.#b,queryNode:aP.cloneWithOutput(this.#b.queryNode,aV(a))})}outputAll(a){return new bI({...this.#b,queryNode:aP.cloneWithOutput(this.#b.queryNode,aX(a))})}#w(a,b=!1,c=!1){let d={...this.#b,queryNode:aN.cloneWithWhen(this.#b.queryNode,by({isMatched:!1,bySource:c},a,b))};return new(c?bJ:bK)(d)}$call(a){return a(this)}$if(a,b){return a?b(this):new bI({...this.#b})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.queryNode,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){let a=this.compile(),b=await this.#b.executor.executeQuery(a,this.#b.queryId),{adapter:c}=this.#b.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new bG(b.numAffectedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=a4){let b=await this.executeTakeFirst();if(void 0===b)throw a5(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}}class bJ{#b;constructor(a){this.#b=k(a)}thenDelete(){return new bI({...this.#b,queryNode:aN.cloneWithThen(this.#b.queryNode,bz("delete"))})}thenDoNothing(){return new bI({...this.#b,queryNode:aN.cloneWithThen(this.#b.queryNode,bz("do nothing"))})}thenUpdate(a){return new bI({...this.#b,queryNode:aN.cloneWithThen(this.#b.queryNode,bz(a(new bi({queryId:this.#b.queryId,executor:bF,queryNode:aG.createWithoutTable()}))))})}thenUpdateSet(...a){return this.thenUpdate(b=>b.set(...a))}}class bK{#b;constructor(a){this.#b=k(a)}thenDoNothing(){return new bI({...this.#b,queryNode:aN.cloneWithThen(this.#b.queryNode,bz("do nothing"))})}thenInsertValues(a){let[b,c]=a_(a);return new bI({...this.#b,queryNode:aN.cloneWithThen(this.#b.queryNode,bz(aE.cloneWith(aE.createWithoutInto(),{columns:b,values:c})))})}}class bL{#b;constructor(a){this.#b=k(a)}selectFrom(a){return new bV({queryId:bq(),executor:this.#b.executor,queryNode:aQ.createFrom(ck(a),this.#b.withNode)})}selectNoFrom(a){return new bV({queryId:bq(),executor:this.#b.executor,queryNode:aQ.cloneWithSelections(aQ.create(this.#b.withNode),aV(a))})}insertInto(a){return new bd({queryId:bq(),executor:this.#b.executor,queryNode:aE.create(cn(a),this.#b.withNode)})}replaceInto(a){return new bd({queryId:bq(),executor:this.#b.executor,queryNode:aE.create(cn(a),this.#b.withNode,!0)})}deleteFrom(a){return new bg({queryId:bq(),executor:this.#b.executor,queryNode:aI.create(ck(a),this.#b.withNode)})}updateTable(a){return new bi({queryId:bq(),executor:this.#b.executor,queryNode:aG.create(ck(a),this.#b.withNode)})}mergeInto(a){return new bH({queryId:bq(),executor:this.#b.executor,queryNode:aN.create(cm(a),this.#b.withNode)})}with(a,b){let c=bm(a,b);return new bL({...this.#b,withNode:this.#b.withNode?bo.cloneWithExpression(this.#b.withNode,c):bo.create(c)})}withRecursive(a,b){let c=bm(a,b);return new bL({...this.#b,withNode:this.#b.withNode?bo.cloneWithExpression(this.#b.withNode,c):bo.create(c,{recursive:!0})})}withPlugin(a){return new bL({...this.#b,executor:this.#b.executor.withPlugin(a)})}withoutPlugins(){return new bL({...this.#b,executor:this.#b.executor.withoutPlugins()})}withSchema(a){return new bL({...this.#b,executor:this.#b.executor.withPluginAtFront(new bw(a))})}}function bM(a,b){var c,d,e,f,g,h;if(3===b.length){return c=a,d=b[0],e=b[1],f=b[2],H.createWithOn(c,cl(d),as(e,"=",f))}if(2===b.length)return function(a,b,c){return c(new aR({joinNode:H.create(a,cl(b))})).toOperationNode()}(a,b[0],b[1]);if(1===b.length){return g=a,h=b[0],H.create(g,cl(h))}throw Error("not implemented")}let bN=k({is:a=>"OffsetNode"===a.kind,create:a=>k({kind:"OffsetNode",offset:a})}),bO=k({is:a=>"GroupByItemNode"===a.kind,create:a=>k({kind:"GroupByItemNode",groupBy:a})}),bP=k({is:a=>"SetOperationNode"===a.kind,create:(a,b,c)=>k({kind:"SetOperationNode",operator:a,expression:b,all:c})});function bQ(a,b,c){return i(b)&&(b=b(cg())),m(b)||(b=[b]),b.map(b=>bP.create(a,ch(b),c))}class bR{#x;constructor(a){this.#x=a}get expressionType(){}as(a){return new bS(this,a)}or(...a){return new bT(F.create(this.#x,aq(a)))}and(...a){return new bU(E.create(this.#x,aq(a)))}$castTo(){return new bR(this.#x)}$notNull(){return new bR(this.#x)}toOperationNode(){return this.#x}}class bS{#y;#z;constructor(a,b){this.#y=a,this.#z=b}get expression(){return this.#y}get alias(){return this.#z}toOperationNode(){return z.create(this.#y.toOperationNode(),B(this.#z)?this.#z.toOperationNode():q.create(this.#z))}}class bT{#x;constructor(a){this.#x=a}get expressionType(){}as(a){return new bS(this,a)}or(...a){return new bT(F.create(this.#x,aq(a)))}$castTo(){return new bT(this.#x)}toOperationNode(){return ap.create(this.#x)}}class bU{#x;constructor(a){this.#x=a}get expressionType(){}as(a){return new bS(this,a)}and(...a){return new bU(E.create(this.#x,aq(a)))}$castTo(){return new bU(this.#x)}toOperationNode(){return ap.create(this.#x)}}class bV{#b;constructor(a){this.#b=k(a)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...a){return new bV({...this.#b,queryNode:aP.cloneWithWhere(this.#b.queryNode,aq(a))})}whereRef(a,b,c){return new bV({...this.#b,queryNode:aP.cloneWithWhere(this.#b.queryNode,as(a,b,c))})}having(...a){return new bV({...this.#b,queryNode:aQ.cloneWithHaving(this.#b.queryNode,aq(a))})}havingRef(a,b,c){return new bV({...this.#b,queryNode:aQ.cloneWithHaving(this.#b.queryNode,as(a,b,c))})}select(a){return new bV({...this.#b,queryNode:aQ.cloneWithSelections(this.#b.queryNode,aV(a))})}distinctOn(a){return new bV({...this.#b,queryNode:aQ.cloneWithDistinctOn(this.#b.queryNode,ad(a))})}modifyFront(a){return new bV({...this.#b,queryNode:aQ.cloneWithFrontModifier(this.#b.queryNode,D.createWithExpression(a.toOperationNode()))})}modifyEnd(a){return new bV({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,D.createWithExpression(a.toOperationNode()))})}distinct(){return new bV({...this.#b,queryNode:aQ.cloneWithFrontModifier(this.#b.queryNode,D.create("Distinct"))})}forUpdate(a){return new bV({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,D.create("ForUpdate",a?l(a).map(cn):void 0))})}forShare(a){return new bV({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,D.create("ForShare",a?l(a).map(cn):void 0))})}forKeyShare(a){return new bV({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,D.create("ForKeyShare",a?l(a).map(cn):void 0))})}forNoKeyUpdate(a){return new bV({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,D.create("ForNoKeyUpdate",a?l(a).map(cn):void 0))})}skipLocked(){return new bV({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,D.create("SkipLocked"))})}noWait(){return new bV({...this.#b,queryNode:aP.cloneWithEndModifier(this.#b.queryNode,D.create("NoWait"))})}selectAll(a){return new bV({...this.#b,queryNode:aQ.cloneWithSelections(this.#b.queryNode,aX(a))})}innerJoin(...a){return this.#c("InnerJoin",a)}leftJoin(...a){return this.#c("LeftJoin",a)}rightJoin(...a){return this.#c("RightJoin",a)}fullJoin(...a){return this.#c("FullJoin",a)}crossJoin(...a){return this.#c("CrossJoin",a)}innerJoinLateral(...a){return this.#c("LateralInnerJoin",a)}leftJoinLateral(...a){return this.#c("LateralLeftJoin",a)}crossJoinLateral(...a){return this.#c("LateralCrossJoin",a)}crossApply(...a){return this.#c("CrossApply",a)}outerApply(...a){return this.#c("OuterApply",a)}#c(a,b){return new bV({...this.#b,queryNode:aP.cloneWithJoin(this.#b.queryNode,bM(a,b))})}orderBy(...a){return new bV({...this.#b,queryNode:aP.cloneWithOrderByItems(this.#b.queryNode,Y(a))})}groupBy(a){var b;return new bV({...this.#b,queryNode:aQ.cloneWithGroupByItems(this.#b.queryNode,ad(b=i(b=a)?b(cg()):b).map(bO.create))})}limit(a){return new bV({...this.#b,queryNode:aQ.cloneWithLimit(this.#b.queryNode,bf.create(am(a)))})}offset(a){return new bV({...this.#b,queryNode:aQ.cloneWithOffset(this.#b.queryNode,bN.create(am(a)))})}fetch(a,b="only"){return new bV({...this.#b,queryNode:aQ.cloneWithFetch(this.#b.queryNode,function(a,b){var c;let d,e;if(!f(a)&&!h(a))throw Error(`Invalid fetch row count: ${a}`);if("only"!==(c=b)&&"with ties"!==c)throw Error(`Invalid fetch modifier: ${b}`);return d=a,e=b,{kind:"FetchNode",rowCount:al.create(d),modifier:e}}(a,b))})}top(a,b){return new bV({...this.#b,queryNode:aP.cloneWithTop(this.#b.queryNode,bb(a,b))})}union(a){return new bV({...this.#b,queryNode:aQ.cloneWithSetOperations(this.#b.queryNode,bQ("union",a,!1))})}unionAll(a){return new bV({...this.#b,queryNode:aQ.cloneWithSetOperations(this.#b.queryNode,bQ("union",a,!0))})}intersect(a){return new bV({...this.#b,queryNode:aQ.cloneWithSetOperations(this.#b.queryNode,bQ("intersect",a,!1))})}intersectAll(a){return new bV({...this.#b,queryNode:aQ.cloneWithSetOperations(this.#b.queryNode,bQ("intersect",a,!0))})}except(a){return new bV({...this.#b,queryNode:aQ.cloneWithSetOperations(this.#b.queryNode,bQ("except",a,!1))})}exceptAll(a){return new bV({...this.#b,queryNode:aQ.cloneWithSetOperations(this.#b.queryNode,bQ("except",a,!0))})}as(a){return new bW(this,a)}clearSelect(){return new bV({...this.#b,queryNode:aQ.cloneWithoutSelections(this.#b.queryNode)})}clearWhere(){return new bV({...this.#b,queryNode:aP.cloneWithoutWhere(this.#b.queryNode)})}clearLimit(){return new bV({...this.#b,queryNode:aQ.cloneWithoutLimit(this.#b.queryNode)})}clearOffset(){return new bV({...this.#b,queryNode:aQ.cloneWithoutOffset(this.#b.queryNode)})}clearOrderBy(){return new bV({...this.#b,queryNode:aP.cloneWithoutOrderBy(this.#b.queryNode)})}clearGroupBy(){return new bV({...this.#b,queryNode:aQ.cloneWithoutGroupBy(this.#b.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new bV({...this.#b})}$castTo(){return new bV(this.#b)}$narrowType(){return new bV(this.#b)}$assertType(){return new bV(this.#b)}$asTuple(){return new bR(this.toOperationNode())}$asScalar(){return new bR(this.toOperationNode())}withPlugin(a){return new bV({...this.#b,executor:this.#b.executor.withPlugin(a)})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.queryNode,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){let a=this.compile();return(await this.#b.executor.executeQuery(a,this.#b.queryId)).rows}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=a4){let b=await this.executeTakeFirst();if(void 0===b)throw a5(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#b.executor.stream(b,a,this.#b.queryId))yield*c.rows}async explain(a,b){let c=new bV({...this.#b,queryNode:aP.cloneWithExplain(this.#b.queryNode,a,b)});return await c.execute()}}class bW{#A;#z;constructor(a,b){this.#A=a,this.#z=b}get expression(){return this.#A}get alias(){return this.#z}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return z.create(this.#A.toOperationNode(),q.create(this.#z))}}let bX=k({is:a=>"AggregateFunctionNode"===a.kind,create:(a,b=[])=>k({kind:"AggregateFunctionNode",func:a,aggregated:b}),cloneWithDistinct:a=>k({...a,distinct:!0}),cloneWithOrderBy(a,b,c=!1){let d=c?"withinGroup":"orderBy";return k({...a,[d]:a[d]?ay.cloneWithItems(a[d],b):ay.create(b)})},cloneWithFilter:(a,b)=>k({...a,filter:a.filter?aJ.cloneWithOperation(a.filter,"And",b):aJ.create(b)}),cloneWithOrFilter:(a,b)=>k({...a,filter:a.filter?aJ.cloneWithOperation(a.filter,"Or",b):aJ.create(b)}),cloneWithOver:(a,b)=>k({...a,over:b})}),bY=k({is:a=>"FunctionNode"===a.kind,create:(a,b)=>k({kind:"FunctionNode",func:a,arguments:b})});class bZ{#b;constructor(a){this.#b=k(a)}get expressionType(){}as(a){return new b$(this,a)}distinct(){return new bZ({...this.#b,aggregateFunctionNode:bX.cloneWithDistinct(this.#b.aggregateFunctionNode)})}orderBy(...a){return new bZ({...this.#b,aggregateFunctionNode:aP.cloneWithOrderByItems(this.#b.aggregateFunctionNode,Y(a))})}clearOrderBy(){return new bZ({...this.#b,aggregateFunctionNode:aP.cloneWithoutOrderBy(this.#b.aggregateFunctionNode)})}withinGroupOrderBy(...a){return new bZ({...this.#b,aggregateFunctionNode:bX.cloneWithOrderBy(this.#b.aggregateFunctionNode,Y(a),!0)})}filterWhere(...a){return new bZ({...this.#b,aggregateFunctionNode:bX.cloneWithFilter(this.#b.aggregateFunctionNode,aq(a))})}filterWhereRef(a,b,c){return new bZ({...this.#b,aggregateFunctionNode:bX.cloneWithFilter(this.#b.aggregateFunctionNode,as(a,b,c))})}over(a){let b=new aT({overNode:aA.create()});return new bZ({...this.#b,aggregateFunctionNode:bX.cloneWithOver(this.#b.aggregateFunctionNode,(a?a(b):b).toOperationNode())})}$call(a){return a(this)}$castTo(){return new bZ(this.#b)}$notNull(){return new bZ(this.#b)}toOperationNode(){return this.#b.aggregateFunctionNode}}class b${#B;#z;constructor(a,b){this.#B=a,this.#z=b}get expression(){return this.#B}get alias(){return this.#z}toOperationNode(){return z.create(this.#B.toOperationNode(),q.create(this.#z))}}function b_(){let a=(a,b)=>new bR(bY.create(a,ad(b??[]))),b=(a,b)=>new bZ({aggregateFunctionNode:bX.create(a,b?ad(b):void 0)});return Object.assign(a,{agg:b,avg:a=>b("avg",[a]),coalesce:(...b)=>a("coalesce",b),count:a=>b("count",[a]),countAll:a=>new bZ({aggregateFunctionNode:bX.create("count",aX(a))}),max:a=>b("max",[a]),min:a=>b("min",[a]),sum:a=>b("sum",[a]),any:b=>a("any",[b]),jsonAgg:a=>new bZ({aggregateFunctionNode:bX.create("json_agg",[e(a)?cn(a):a.toOperationNode()])}),toJson:a=>new bR(bY.create("to_json",[e(a)?cn(a):a.toOperationNode()]))})}let b0=k({is:a=>"UnaryOperationNode"===a.kind,create:(a,b)=>k({kind:"UnaryOperationNode",operator:a,operand:b})}),b1=k({is:a=>"CaseNode"===a.kind,create:a=>k({kind:"CaseNode",value:a}),cloneWithWhen:(a,b)=>k({...a,when:k(a.when?[...a.when,b]:[b])}),cloneWithThen:(a,b)=>k({...a,when:a.when?k([...a.when.slice(0,-1),aM.cloneWithResult(a.when[a.when.length-1],b)]):void 0}),cloneWith:(a,b)=>k({...a,...b})});class b2{#b;constructor(a){this.#b=k(a)}when(...a){return new b3({...this.#b,node:b1.cloneWithWhen(this.#b.node,aM.create(aq(a)))})}}class b3{#b;constructor(a){this.#b=k(a)}then(a){return new b4({...this.#b,node:b1.cloneWithThen(this.#b.node,an(a)?ao(a):am(a))})}}class b4{#b;constructor(a){this.#b=k(a)}when(...a){return new b3({...this.#b,node:b1.cloneWithWhen(this.#b.node,aM.create(aq(a)))})}else(a){return new b5({...this.#b,node:b1.cloneWith(this.#b.node,{else:an(a)?ao(a):am(a)})})}end(){return new bR(b1.cloneWith(this.#b.node,{isStatement:!1}))}endCase(){return new bR(b1.cloneWith(this.#b.node,{isStatement:!0}))}}class b5{#b;constructor(a){this.#b=k(a)}end(){return new bR(b1.cloneWith(this.#b.node,{isStatement:!1}))}endCase(){return new bR(b1.cloneWith(this.#b.node,{isStatement:!0}))}}let b6=k({is:a=>"JSONPathLegNode"===a.kind,create:(a,b)=>k({kind:"JSONPathLegNode",type:a,value:b})});class b7{#x;constructor(a){this.#x=a}at(a){return this.#C("ArrayLocation",a)}key(a){return this.#C("Member",a)}#C(a,b){return new b8(_.is(this.#x)?_.cloneWithTraversal(this.#x,ab.is(this.#x.traversal)?ab.cloneWithLeg(this.#x.traversal,b6.create(a,b)):aa.cloneWithValue(this.#x.traversal,al.createImmediate(b))):ab.cloneWithLeg(this.#x,b6.create(a,b)))}}class b8 extends b7{#x;constructor(a){super(a),this.#x=a}get expressionType(){}as(a){return new b9(this,a)}$castTo(){return new b8(this.#x)}$notNull(){return new b8(this.#x)}toOperationNode(){return this.#x}}class b9{#D;#z;constructor(a,b){this.#D=a,this.#z=b}get expression(){return this.#D}get alias(){return this.#z}toOperationNode(){return z.create(this.#D.toOperationNode(),B(this.#z)?this.#z.toOperationNode():q.create(this.#z))}}let ca=k({is:a=>"TupleNode"===a.kind,create:a=>k({kind:"TupleNode",values:k(a)})}),cb=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],cc=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],cd=k({is:a=>"DataTypeNode"===a.kind,create:a=>k({kind:"DataTypeNode",dataType:a})});function ce(a){if(B(a))return a.toOperationNode();if(cb.includes(a)||cc.some(b=>b.test(a)))return cd.create(a);throw Error(`invalid column data type ${JSON.stringify(a)}`)}let cf=k({is:a=>"CastNode"===a.kind,create:(a,b)=>k({kind:"CastNode",expression:a,dataType:b})});function cg(a=bF){function b(a,b){return new bR(b0.create(L.create(a),ae(b)))}let c=Object.assign(function(a,b,c){return new bR(ar(a,b,c))},{fn:void 0,eb:void 0,selectFrom:b=>new bV({queryId:bq(),executor:a,queryNode:aQ.createFrom(ck(b))}),case:a=>new b2({node:b1.create(d(a)?void 0:ae(a))}),ref:(a,b)=>d(b)?new bR(af(a)):new b7(function(a,b){let c=af(a);if(M(b))return _.create(c,aa.create(L.create(b)));let d=b.slice(0,-1);if(M(d))return _.create(c,ab.create(L.create(d)));throw Error(`Invalid JSON operator: ${b}`)}(a,b)),jsonPath:()=>new b7(ab.create()),table:a=>new bR(cn(a)),val:a=>new bR(am(a)),refTuple:(...a)=>new bR(ca.create(a.map(ae))),tuple:(...a)=>new bR(ca.create(a.map(am))),lit:a=>new bR(ao(a)),unary:b,not:a=>b("not",a),exists:a=>b("exists",a),neg:a=>b("-",a),between:(a,b,c)=>new bR(I.create(ae(a),L.create("between"),E.create(am(b),am(c)))),betweenSymmetric:(a,b,c)=>new bR(I.create(ae(a),L.create("between symmetric"),E.create(am(b),am(c)))),and:a=>new bR(m(a)?au(a,"and"):at(a,"and")),or:a=>new bR(m(a)?au(a,"or"):at(a,"or")),parens(...a){let b=aq(a);return new bR(ap.is(b)?b:ap.create(b))},cast:(a,b)=>new bR(cf.create(ae(a),ce(b))),withSchema:b=>cg(a.withPluginAtFront(new bw(b)))});return c.fn=b_(),c.eb=c,c}function ch(a){if(B(a))return a.toOperationNode();if(i(a))return a(cg()).toOperationNode();throw Error(`invalid expression: ${JSON.stringify(a)}`)}function ci(a){if(B(a))return a.toOperationNode();if(i(a))return a(cg()).toOperationNode();throw Error(`invalid aliased expression: ${JSON.stringify(a)}`)}function cj(a){return C(a)||j(a)&&"expression"in a&&e(a.alias)&&B(a)||i(a)}function ck(a){return m(a)?a.map(a=>cl(a)):[cl(a)]}function cl(a){return e(a)?cm(a):ci(a)}function cm(a){let b=" as ";if(!a.includes(b))return cn(a);{let[c,d]=a.split(b).map(co);return z.create(cn(c),q.create(d))}}function cn(a){if(!a.includes("."))return A.create(a);{let[b,c]=a.split(".").map(co);return A.createWithSchema(b,c)}}function co(a){return a.trim()}let cp=k({is:a=>"AddColumnNode"===a.kind,create:a=>k({kind:"AddColumnNode",column:a})}),cq=k({is:a=>"ColumnDefinitionNode"===a.kind,create:(a,b)=>k({kind:"ColumnDefinitionNode",column:N.create(a),dataType:b}),cloneWithFrontModifier:(a,b)=>k({...a,frontModifiers:a.frontModifiers?k([...a.frontModifiers,b]):[b]}),cloneWithEndModifier:(a,b)=>k({...a,endModifiers:a.endModifiers?k([...a.endModifiers,b]):[b]}),cloneWith:(a,b)=>k({...a,...b})}),cr=k({is:a=>"DropColumnNode"===a.kind,create:a=>k({kind:"DropColumnNode",column:N.create(a)})}),cs=k({is:a=>"RenameColumnNode"===a.kind,create:(a,b)=>k({kind:"RenameColumnNode",column:N.create(a),renameTo:N.create(b)})}),ct=k({is:a=>"CheckConstraintNode"===a.kind,create:(a,b)=>k({kind:"CheckConstraintNode",expression:a,name:b?q.create(b):void 0})}),cu=["no action","restrict","cascade","set null","set default"],cv=k({is:a=>"ReferencesNode"===a.kind,create:(a,b)=>k({kind:"ReferencesNode",table:a,columns:k([...b])}),cloneWithOnDelete:(a,b)=>k({...a,onDelete:b}),cloneWithOnUpdate:(a,b)=>k({...a,onUpdate:b})});function cw(a){return B(a)?a.toOperationNode():al.createImmediate(a)}let cx=k({is:a=>"GeneratedNode"===a.kind,create:a=>k({kind:"GeneratedNode",...a}),createWithExpression:a=>k({kind:"GeneratedNode",always:!0,expression:a}),cloneWith:(a,b)=>k({...a,...b})}),cy=k({is:a=>"DefaultValueNode"===a.kind,create:a=>k({kind:"DefaultValueNode",defaultValue:a})});function cz(a){if(cu.includes(a))return a;throw Error(`invalid OnModifyForeignAction ${a}`)}class cA{#x;constructor(a){this.#x=a}autoIncrement(){return new cA(cq.cloneWith(this.#x,{autoIncrement:!0}))}identity(){return new cA(cq.cloneWith(this.#x,{identity:!0}))}primaryKey(){return new cA(cq.cloneWith(this.#x,{primaryKey:!0}))}references(a){let b=af(a);if(!b.table||O.is(b.column))throw Error(`invalid call references('${a}'). The reference must have format table.column or schema.table.column`);return new cA(cq.cloneWith(this.#x,{references:cv.create(b.table,[b.column])}))}onDelete(a){if(!this.#x.references)throw Error("on delete constraint can only be added for foreign keys");return new cA(cq.cloneWith(this.#x,{references:cv.cloneWithOnDelete(this.#x.references,cz(a))}))}onUpdate(a){if(!this.#x.references)throw Error("on update constraint can only be added for foreign keys");return new cA(cq.cloneWith(this.#x,{references:cv.cloneWithOnUpdate(this.#x.references,cz(a))}))}unique(){return new cA(cq.cloneWith(this.#x,{unique:!0}))}notNull(){return new cA(cq.cloneWith(this.#x,{notNull:!0}))}unsigned(){return new cA(cq.cloneWith(this.#x,{unsigned:!0}))}defaultTo(a){return new cA(cq.cloneWith(this.#x,{defaultTo:cy.create(cw(a))}))}check(a){return new cA(cq.cloneWith(this.#x,{check:ct.create(a.toOperationNode())}))}generatedAlwaysAs(a){return new cA(cq.cloneWith(this.#x,{generated:cx.createWithExpression(a.toOperationNode())}))}generatedAlwaysAsIdentity(){return new cA(cq.cloneWith(this.#x,{generated:cx.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new cA(cq.cloneWith(this.#x,{generated:cx.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#x.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new cA(cq.cloneWith(this.#x,{generated:cx.cloneWith(this.#x.generated,{stored:!0})}))}modifyFront(a){return new cA(cq.cloneWithFrontModifier(this.#x,a.toOperationNode()))}nullsNotDistinct(){return new cA(cq.cloneWith(this.#x,{nullsNotDistinct:!0}))}ifNotExists(){return new cA(cq.cloneWith(this.#x,{ifNotExists:!0}))}modifyEnd(a){return new cA(cq.cloneWithEndModifier(this.#x,a.toOperationNode()))}$call(a){return a(this)}toOperationNode(){return this.#x}}let cB=k({is:a=>"ModifyColumnNode"===a.kind,create:a=>k({kind:"ModifyColumnNode",column:a})}),cC=k({is:a=>"ForeignKeyConstraintNode"===a.kind,create:(a,b,c,d)=>k({kind:"ForeignKeyConstraintNode",columns:a,references:cv.create(b,c),name:d?q.create(d):void 0}),cloneWith:(a,b)=>k({...a,...b})});class cD{#x;constructor(a){this.#x=a}onDelete(a){return new cD(cC.cloneWith(this.#x,{onDelete:cz(a)}))}onUpdate(a){return new cD(cC.cloneWith(this.#x,{onUpdate:cz(a)}))}deferrable(){return new cD(cC.cloneWith(this.#x,{deferrable:!0}))}notDeferrable(){return new cD(cC.cloneWith(this.#x,{deferrable:!1}))}initiallyDeferred(){return new cD(cC.cloneWith(this.#x,{initiallyDeferred:!0}))}initiallyImmediate(){return new cD(cC.cloneWith(this.#x,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#x}}let cE=k({is:a=>"AddConstraintNode"===a.kind,create:a=>k({kind:"AddConstraintNode",constraint:a})}),cF=k({is:a=>"UniqueConstraintNode"===a.kind,create:(a,b,c)=>k({kind:"UniqueConstraintNode",columns:k(a.map(N.create)),name:b?q.create(b):void 0,nullsNotDistinct:c}),cloneWith:(a,b)=>k({...a,...b})}),cG=k({is:a=>"DropConstraintNode"===a.kind,create:a=>k({kind:"DropConstraintNode",constraintName:q.create(a)}),cloneWith:(a,b)=>k({...a,...b})}),cH=k({is:a=>"AlterColumnNode"===a.kind,create:(a,b,c)=>k({kind:"AlterColumnNode",column:N.create(a),[b]:c})});class cI{#E;constructor(a){this.#E=a}setDataType(a){return new cJ(cH.create(this.#E,"dataType",ce(a)))}setDefault(a){return new cJ(cH.create(this.#E,"setDefault",cw(a)))}dropDefault(){return new cJ(cH.create(this.#E,"dropDefault",!0))}setNotNull(){return new cJ(cH.create(this.#E,"setNotNull",!0))}dropNotNull(){return new cJ(cH.create(this.#E,"dropNotNull",!0))}$call(a){return a(this)}}class cJ{#F;constructor(a){this.#F=a}toOperationNode(){return this.#F}}class cK{#b;constructor(a){this.#b=k(a)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class cL{#b;constructor(a){this.#b=k(a)}onDelete(a){return new cL({...this.#b,constraintBuilder:this.#b.constraintBuilder.onDelete(a)})}onUpdate(a){return new cL({...this.#b,constraintBuilder:this.#b.constraintBuilder.onUpdate(a)})}deferrable(){return new cL({...this.#b,constraintBuilder:this.#b.constraintBuilder.deferrable()})}notDeferrable(){return new cL({...this.#b,constraintBuilder:this.#b.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new cL({...this.#b,constraintBuilder:this.#b.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new cL({...this.#b,constraintBuilder:this.#b.constraintBuilder.initiallyImmediate()})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(p.cloneWithTableProps(this.#b.node,{addConstraint:cE.create(this.#b.constraintBuilder.toOperationNode())}),this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class cM{#b;constructor(a){this.#b=k(a)}ifExists(){return new cM({...this.#b,node:p.cloneWithTableProps(this.#b.node,{dropConstraint:cG.cloneWith(this.#b.node.dropConstraint,{ifExists:!0})})})}cascade(){return new cM({...this.#b,node:p.cloneWithTableProps(this.#b.node,{dropConstraint:cG.cloneWith(this.#b.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new cM({...this.#b,node:p.cloneWithTableProps(this.#b.node,{dropConstraint:cG.cloneWith(this.#b.node.dropConstraint,{modifier:"restrict"})})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}let cN=k({is:a=>"PrimaryKeyConstraintNode"===a.kind,create:(a,b)=>k({kind:"PrimaryKeyConstraintNode",columns:k(a.map(N.create)),name:b?q.create(b):void 0}),cloneWith:(a,b)=>k({...a,...b})}),cO=k({is:a=>"AddIndexNode"===a.kind,create:a=>k({kind:"AddIndexNode",name:q.create(a)}),cloneWith:(a,b)=>k({...a,...b}),cloneWithColumns:(a,b)=>k({...a,columns:[...a.columns||[],...b]})});class cP{#b;constructor(a){this.#b=k(a)}unique(){return new cP({...this.#b,node:p.cloneWithTableProps(this.#b.node,{addIndex:cO.cloneWith(this.#b.node.addIndex,{unique:!0})})})}column(a){return new cP({...this.#b,node:p.cloneWithTableProps(this.#b.node,{addIndex:cO.cloneWithColumns(this.#b.node.addIndex,[ah(a)])})})}columns(a){return new cP({...this.#b,node:p.cloneWithTableProps(this.#b.node,{addIndex:cO.cloneWithColumns(this.#b.node.addIndex,a.map(ah))})})}expression(a){return new cP({...this.#b,node:p.cloneWithTableProps(this.#b.node,{addIndex:cO.cloneWithColumns(this.#b.node.addIndex,[a.toOperationNode()])})})}using(a){return new cP({...this.#b,node:p.cloneWithTableProps(this.#b.node,{addIndex:cO.cloneWith(this.#b.node.addIndex,{using:T.createWithSql(a)})})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class cQ{#x;constructor(a){this.#x=a}nullsNotDistinct(){return new cQ(cF.cloneWith(this.#x,{nullsNotDistinct:!0}))}deferrable(){return new cQ(cF.cloneWith(this.#x,{deferrable:!0}))}notDeferrable(){return new cQ(cF.cloneWith(this.#x,{deferrable:!1}))}initiallyDeferred(){return new cQ(cF.cloneWith(this.#x,{initiallyDeferred:!0}))}initiallyImmediate(){return new cQ(cF.cloneWith(this.#x,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#x}}class cR{#x;constructor(a){this.#x=a}deferrable(){return new cR(cN.cloneWith(this.#x,{deferrable:!0}))}notDeferrable(){return new cR(cN.cloneWith(this.#x,{deferrable:!1}))}initiallyDeferred(){return new cR(cN.cloneWith(this.#x,{initiallyDeferred:!0}))}initiallyImmediate(){return new cR(cN.cloneWith(this.#x,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#x}}class cS{#x;constructor(a){this.#x=a}$call(a){return a(this)}toOperationNode(){return this.#x}}let cT=k({is:a=>"RenameConstraintNode"===a.kind,create:(a,b)=>k({kind:"RenameConstraintNode",oldName:q.create(a),newName:q.create(b)})});class cU{#b;constructor(a){this.#b=k(a)}renameTo(a){return new cK({...this.#b,node:p.cloneWithTableProps(this.#b.node,{renameTo:cn(a)})})}setSchema(a){return new cK({...this.#b,node:p.cloneWithTableProps(this.#b.node,{setSchema:q.create(a)})})}alterColumn(a,b){let c=b(new cI(a));return new cV({...this.#b,node:p.cloneWithColumnAlteration(this.#b.node,c.toOperationNode())})}dropColumn(a){return new cV({...this.#b,node:p.cloneWithColumnAlteration(this.#b.node,cr.create(a))})}renameColumn(a,b){return new cV({...this.#b,node:p.cloneWithColumnAlteration(this.#b.node,cs.create(a,b))})}addColumn(a,b,c=n){let d=c(new cA(cq.create(a,ce(b))));return new cV({...this.#b,node:p.cloneWithColumnAlteration(this.#b.node,cp.create(d.toOperationNode()))})}modifyColumn(a,b,c=n){let d=c(new cA(cq.create(a,ce(b))));return new cV({...this.#b,node:p.cloneWithColumnAlteration(this.#b.node,cB.create(d.toOperationNode()))})}addUniqueConstraint(a,b,c=n){let d=c(new cQ(cF.create(b,a)));return new cK({...this.#b,node:p.cloneWithTableProps(this.#b.node,{addConstraint:cE.create(d.toOperationNode())})})}addCheckConstraint(a,b,c=n){let d=c(new cS(ct.create(b.toOperationNode(),a)));return new cK({...this.#b,node:p.cloneWithTableProps(this.#b.node,{addConstraint:cE.create(d.toOperationNode())})})}addForeignKeyConstraint(a,b,c,d,e=n){let f=e(new cD(cC.create(b.map(N.create),cn(c),d.map(N.create),a)));return new cL({...this.#b,constraintBuilder:f})}addPrimaryKeyConstraint(a,b,c=n){let d=c(new cR(cN.create(b,a)));return new cK({...this.#b,node:p.cloneWithTableProps(this.#b.node,{addConstraint:cE.create(d.toOperationNode())})})}dropConstraint(a){return new cM({...this.#b,node:p.cloneWithTableProps(this.#b.node,{dropConstraint:cG.create(a)})})}renameConstraint(a,b){return new cM({...this.#b,node:p.cloneWithTableProps(this.#b.node,{renameConstraint:cT.create(a,b)})})}addIndex(a){return new cP({...this.#b,node:p.cloneWithTableProps(this.#b.node,{addIndex:cO.create(a)})})}dropIndex(a){return new cK({...this.#b,node:p.cloneWithTableProps(this.#b.node,{dropIndex:w.create(a)})})}$call(a){return a(this)}}class cV{#b;constructor(a){this.#b=k(a)}alterColumn(a,b){let c=b(new cI(a));return new cV({...this.#b,node:p.cloneWithColumnAlteration(this.#b.node,c.toOperationNode())})}dropColumn(a){return new cV({...this.#b,node:p.cloneWithColumnAlteration(this.#b.node,cr.create(a))})}renameColumn(a,b){return new cV({...this.#b,node:p.cloneWithColumnAlteration(this.#b.node,cs.create(a,b))})}addColumn(a,b,c=n){let d=c(new cA(cq.create(a,ce(b))));return new cV({...this.#b,node:p.cloneWithColumnAlteration(this.#b.node,cp.create(d.toOperationNode()))})}modifyColumn(a,b,c=n){let d=c(new cA(cq.create(a,ce(b))));return new cV({...this.#b,node:p.cloneWithColumnAlteration(this.#b.node,cB.create(d.toOperationNode()))})}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class cW extends bs{transformPrimitiveValueList(a){return ak.create(a.values.map(al.createImmediate))}transformValue(a){return al.createImmediate(a.value)}}class cX{#b;constructor(a){this.#b=k(a)}ifNotExists(){return new cX({...this.#b,node:r.cloneWith(this.#b.node,{ifNotExists:!0})})}unique(){return new cX({...this.#b,node:r.cloneWith(this.#b.node,{unique:!0})})}nullsNotDistinct(){return new cX({...this.#b,node:r.cloneWith(this.#b.node,{nullsNotDistinct:!0})})}on(a){return new cX({...this.#b,node:r.cloneWith(this.#b.node,{table:cn(a)})})}column(a){return new cX({...this.#b,node:r.cloneWithColumns(this.#b.node,[ah(a)])})}columns(a){return new cX({...this.#b,node:r.cloneWithColumns(this.#b.node,a.map(ah))})}expression(a){return new cX({...this.#b,node:r.cloneWithColumns(this.#b.node,[a.toOperationNode()])})}using(a){return new cX({...this.#b,node:r.cloneWith(this.#b.node,{using:T.createWithSql(a)})})}where(...a){let b=new cW;return new cX({...this.#b,node:aP.cloneWithWhere(this.#b.node,b.transformNode(aq(a),this.#b.queryId))})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class cY{#b;constructor(a){this.#b=k(a)}ifNotExists(){return new cY({...this.#b,node:s.cloneWith(this.#b.node,{ifNotExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class cZ{#b;constructor(a){this.#b=k(a)}temporary(){return new cZ({...this.#b,node:u.cloneWith(this.#b.node,{temporary:!0})})}onCommit(a){return new cZ({...this.#b,node:u.cloneWith(this.#b.node,{onCommit:function(a){if(t.includes(a))return a;throw Error(`invalid OnCommitAction ${a}`)}(a)})})}ifNotExists(){return new cZ({...this.#b,node:u.cloneWith(this.#b.node,{ifNotExists:!0})})}addColumn(a,b,c=n){let d=c(new cA(cq.create(a,ce(b))));return new cZ({...this.#b,node:u.cloneWithColumn(this.#b.node,d.toOperationNode())})}addPrimaryKeyConstraint(a,b,c=n){let d=c(new cR(cN.create(b,a)));return new cZ({...this.#b,node:u.cloneWithConstraint(this.#b.node,d.toOperationNode())})}addUniqueConstraint(a,b,c=n){let d=c(new cQ(cF.create(b,a)));return new cZ({...this.#b,node:u.cloneWithConstraint(this.#b.node,d.toOperationNode())})}addCheckConstraint(a,b,c=n){let d=c(new cS(ct.create(b.toOperationNode(),a)));return new cZ({...this.#b,node:u.cloneWithConstraint(this.#b.node,d.toOperationNode())})}addForeignKeyConstraint(a,b,c,d,e=n){let f=e(new cD(cC.create(b.map(N.create),cn(c),d.map(N.create),a)));return new cZ({...this.#b,node:u.cloneWithConstraint(this.#b.node,f.toOperationNode())})}modifyFront(a){return new cZ({...this.#b,node:u.cloneWithFrontModifier(this.#b.node,a.toOperationNode())})}modifyEnd(a){return new cZ({...this.#b,node:u.cloneWithEndModifier(this.#b.node,a.toOperationNode())})}as(a){return new cZ({...this.#b,node:u.cloneWith(this.#b.node,{selectQuery:ch(a)})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class c${#b;constructor(a){this.#b=k(a)}on(a){return new c$({...this.#b,node:w.cloneWith(this.#b.node,{table:cn(a)})})}ifExists(){return new c$({...this.#b,node:w.cloneWith(this.#b.node,{ifExists:!0})})}cascade(){return new c$({...this.#b,node:w.cloneWith(this.#b.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class c_{#b;constructor(a){this.#b=k(a)}ifExists(){return new c_({...this.#b,node:x.cloneWith(this.#b.node,{ifExists:!0})})}cascade(){return new c_({...this.#b,node:x.cloneWith(this.#b.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class c0{#b;constructor(a){this.#b=k(a)}ifExists(){return new c0({...this.#b,node:y.cloneWith(this.#b.node,{ifExists:!0})})}cascade(){return new c0({...this.#b,node:y.cloneWith(this.#b.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}let c1=k({is:a=>"CreateViewNode"===a.kind,create:a=>k({kind:"CreateViewNode",name:v.create(a)}),cloneWith:(a,b)=>k({...a,...b})});class c2{#p=new cW;transformQuery(a){return this.#p.transformNode(a.node,a.queryId)}transformResult(a){return Promise.resolve(a.result)}}class c3{#b;constructor(a){this.#b=k(a)}temporary(){return new c3({...this.#b,node:c1.cloneWith(this.#b.node,{temporary:!0})})}materialized(){return new c3({...this.#b,node:c1.cloneWith(this.#b.node,{materialized:!0})})}ifNotExists(){return new c3({...this.#b,node:c1.cloneWith(this.#b.node,{ifNotExists:!0})})}orReplace(){return new c3({...this.#b,node:c1.cloneWith(this.#b.node,{orReplace:!0})})}columns(a){return new c3({...this.#b,node:c1.cloneWith(this.#b.node,{columns:a.map(ag)})})}as(a){let b=a.withPlugin(new c2).toOperationNode();return new c3({...this.#b,node:c1.cloneWith(this.#b.node,{as:b})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}let c4=k({is:a=>"DropViewNode"===a.kind,create:a=>k({kind:"DropViewNode",name:v.create(a)}),cloneWith:(a,b)=>k({...a,...b})});class c5{#b;constructor(a){this.#b=k(a)}materialized(){return new c5({...this.#b,node:c4.cloneWith(this.#b.node,{materialized:!0})})}ifExists(){return new c5({...this.#b,node:c4.cloneWith(this.#b.node,{ifExists:!0})})}cascade(){return new c5({...this.#b,node:c4.cloneWith(this.#b.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}let c6=k({is:a=>"CreateTypeNode"===a.kind,create:a=>k({kind:"CreateTypeNode",name:a}),cloneWithEnum:(a,b)=>k({...a,enum:ak.create(b.map(al.createImmediate))})});class c7{#b;constructor(a){this.#b=k(a)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}asEnum(a){return new c7({...this.#b,node:c6.cloneWithEnum(this.#b.node,a)})}$call(a){return a(this)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}let c8=k({is:a=>"DropTypeNode"===a.kind,create:a=>k({kind:"DropTypeNode",name:a}),cloneWith:(a,b)=>k({...a,...b})});class c9{#b;constructor(a){this.#b=k(a)}ifExists(){return new c9({...this.#b,node:c8.cloneWith(this.#b.node,{ifExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}function da(a){if(!a.includes("."))return v.create(a);{let b=a.split(".").map(db);if(2===b.length)return v.createWithSchema(b[0],b[1]);throw Error(`invalid schemable identifier ${a}`)}}function db(a){return a.trim()}let dc=k({is:a=>"RefreshMaterializedViewNode"===a.kind,create:a=>k({kind:"RefreshMaterializedViewNode",name:v.create(a)}),cloneWith:(a,b)=>k({...a,...b})});class dd{#b;constructor(a){this.#b=k(a)}concurrently(){return new dd({...this.#b,node:dc.cloneWith(this.#b.node,{concurrently:!0,withNoData:!1})})}withData(){return new dd({...this.#b,node:dc.cloneWith(this.#b.node,{withNoData:!1})})}withNoData(){return new dd({...this.#b,node:dc.cloneWith(this.#b.node,{withNoData:!0,concurrently:!1})})}$call(a){return a(this)}toOperationNode(){return this.#b.executor.transformQuery(this.#b.node,this.#b.queryId)}compile(){return this.#b.executor.compileQuery(this.toOperationNode(),this.#b.queryId)}async execute(){await this.#b.executor.executeQuery(this.compile(),this.#b.queryId)}}class de{#G;constructor(a){this.#G=a}createTable(a){return new cZ({queryId:bq(),executor:this.#G,node:u.create(cn(a))})}dropTable(a){return new c0({queryId:bq(),executor:this.#G,node:y.create(cn(a))})}createIndex(a){return new cX({queryId:bq(),executor:this.#G,node:r.create(a)})}dropIndex(a){return new c$({queryId:bq(),executor:this.#G,node:w.create(a)})}createSchema(a){return new cY({queryId:bq(),executor:this.#G,node:s.create(a)})}dropSchema(a){return new c_({queryId:bq(),executor:this.#G,node:x.create(a)})}alterTable(a){return new cU({queryId:bq(),executor:this.#G,node:p.create(cn(a))})}createView(a){return new c3({queryId:bq(),executor:this.#G,node:c1.create(a)})}refreshMaterializedView(a){return new dd({queryId:bq(),executor:this.#G,node:dc.create(a)})}dropView(a){return new c5({queryId:bq(),executor:this.#G,node:c4.create(a)})}createType(a){return new c7({queryId:bq(),executor:this.#G,node:c6.create(da(a))})}dropType(a){return new c9({queryId:bq(),executor:this.#G,node:c8.create(da(a))})}withPlugin(a){return new de(this.#G.withPlugin(a))}withoutPlugins(){return new de(this.#G.withoutPlugins())}withSchema(a){return new de(this.#G.withPluginAtFront(new bw(a)))}}class df{ref(a){return new Q(a)}}class dg{#H;constructor(a){this.#H=a}async provideConnection(a){let b=await this.#H.acquireConnection();try{return await a(b)}finally{await this.#H.releaseConnection(b)}}}class dh extends bD{#I;#J;#K;constructor(a,b,c,d=[]){super(d),this.#I=a,this.#J=b,this.#K=c}get adapter(){return this.#J}compileQuery(a,b){return this.#I.compileQuery(a,b)}provideConnection(a){return this.#K.provideConnection(a)}withPlugins(a){return new dh(this.#I,this.#J,this.#K,[...this.plugins,...a])}withPlugin(a){return new dh(this.#I,this.#J,this.#K,[...this.plugins,a])}withPluginAtFront(a){return new dh(this.#I,this.#J,this.#K,[a,...this.plugins])}withConnectionProvider(a){return new dh(this.#I,this.#J,a,[...this.plugins])}withoutPlugins(){return new dh(this.#I,this.#J,this.#K,[])}}function di(){return"undefined"!=typeof performance&&i(performance.now)?performance.now():Date.now()}class dj{#H;#L;#M;#N;#O;#P=new WeakSet;constructor(a,b){this.#N=!1,this.#H=a,this.#L=b}async init(){if(this.#O)throw Error("driver has already been destroyed");this.#M||(this.#M=this.#H.init().then(()=>{this.#N=!0}).catch(a=>(this.#M=void 0,Promise.reject(a)))),await this.#M}async acquireConnection(){if(this.#O)throw Error("driver has already been destroyed");this.#N||await this.init();let a=await this.#H.acquireConnection();return this.#P.has(a)||(this.#Q()&&this.#R(a),this.#P.add(a)),a}async releaseConnection(a){await this.#H.releaseConnection(a)}beginTransaction(a,b){return this.#H.beginTransaction(a,b)}commitTransaction(a){return this.#H.commitTransaction(a)}rollbackTransaction(a){return this.#H.rollbackTransaction(a)}savepoint(a,b,c){if(this.#H.savepoint)return this.#H.savepoint(a,b,c);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(a,b,c){if(this.#H.rollbackToSavepoint)return this.#H.rollbackToSavepoint(a,b,c);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(a,b,c){if(this.#H.releaseSavepoint)return this.#H.releaseSavepoint(a,b,c);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#M&&(await this.#M,this.#O||(this.#O=this.#H.destroy().catch(a=>(this.#O=void 0,Promise.reject(a)))),await this.#O)}#Q(){return this.#L.isLevelEnabled("query")||this.#L.isLevelEnabled("error")}#R(a){let b=a.executeQuery,c=a.streamQuery,d=this;a.executeQuery=async c=>{let e,f=di();try{return await b.call(a,c)}catch(a){throw e=a,await d.#S(a,c,f),a}finally{e||await d.#T(c,f)}},a.streamQuery=async function*(b,e){let f,g=di();try{for await(let d of c.call(a,b,e))yield d}catch(a){throw f=a,await d.#S(a,b,g),a}finally{f||await d.#T(b,g,!0)}}}async #S(a,b,c){await this.#L.error(()=>({level:"error",error:a,query:b,queryDurationMillis:this.#U(c)}))}async #T(a,b,c=!1){await this.#L.query(()=>({level:"query",isStream:c,query:a,queryDurationMillis:this.#U(b)}))}#U(a){return di()-a}}let dk=()=>{};class dl{#V;#W;constructor(a){this.#V=a}async provideConnection(a){for(;this.#W;)await this.#W.catch(dk);return this.#W=this.#X(a).finally(()=>{this.#W=void 0}),this.#W}async #X(a){return await a(this.#V)}}let dm=["read only","read write"],dn=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function dp(a){if(a.accessMode&&!dm.includes(a.accessMode))throw Error(`invalid transaction access mode ${a.accessMode}`);if(a.isolationLevel&&!dn.includes(a.isolationLevel))throw Error(`invalid transaction isolation level ${a.isolationLevel}`)}k(["query","error"]);class dq{#Y;#Z;constructor(a){i(a)?(this.#Z=a,this.#Y=k({query:!0,error:!0})):(this.#Z=dr,this.#Y=k({query:a.includes("query"),error:a.includes("error")}))}isLevelEnabled(a){return this.#Y[a]}async query(a){this.#Y.query&&await this.#Z(a())}async error(a){this.#Y.error&&await this.#Z(a())}}function dr(a){if("query"===a.level){let b=`kysely:query:${a.isStream?"stream:":""}`;console.log(`${b} ${a.query.sql}`),console.log(`${b} duration: ${a.queryDurationMillis.toFixed(1)}ms`)}else"error"===a.level&&(a.error instanceof Error?console.error(`kysely:error: ${a.error.stack??a.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:a.error,query:a.query.sql,queryDurationMillis:a.queryDurationMillis})}`))}Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class ds extends bL{#b;constructor(a){let b,c;if(function(a){return j(a)&&j(a.config)&&j(a.driver)&&j(a.executor)&&j(a.dialect)}(a))b={executor:a.executor},c={...a};else{const d=a.dialect,e=d.createDriver(),f=d.createQueryCompiler(),g=d.createAdapter(),h=new dj(e,new dq(a.log??[])),i=new dh(f,g,new dg(h),a.plugins??[]);b={executor:i},c={config:a,executor:i,dialect:d,driver:h}}super(b),this.#b=k(c)}get schema(){return new de(this.#b.executor)}get dynamic(){return new df}get introspection(){return this.#b.dialect.createIntrospector(this.withoutPlugins())}case(a){return new b2({node:b1.create(d(a)?void 0:ch(a))})}get fn(){return b_()}transaction(){return new dv({...this.#b})}startTransaction(){return new dw({...this.#b})}connection(){return new du({...this.#b})}withPlugin(a){return new ds({...this.#b,executor:this.#b.executor.withPlugin(a)})}withoutPlugins(){return new ds({...this.#b,executor:this.#b.executor.withoutPlugins()})}withSchema(a){return new ds({...this.#b,executor:this.#b.executor.withPluginAtFront(new bw(a))})}withTables(){return new ds({...this.#b})}async destroy(){await this.#b.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#b.executor}executeQuery(a,b=bq()){let c=j(a)&&i(a.compile)?a.compile():a;return this.getExecutor().executeQuery(c,b)}async [Symbol.asyncDispose](){await this.destroy()}}class dt extends ds{#b;constructor(a){super(a),this.#b=a}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(a){return new dt({...this.#b,executor:this.#b.executor.withPlugin(a)})}withoutPlugins(){return new dt({...this.#b,executor:this.#b.executor.withoutPlugins()})}withSchema(a){return new dt({...this.#b,executor:this.#b.executor.withPluginAtFront(new bw(a))})}withTables(){return new dt({...this.#b})}}class du{#b;constructor(a){this.#b=k(a)}async execute(a){return this.#b.executor.provideConnection(async b=>{let c=this.#b.executor.withConnectionProvider(new dl(b)),d=new ds({...this.#b,executor:c});return await a(d)})}}class dv{#b;constructor(a){this.#b=k(a)}setAccessMode(a){return new dv({...this.#b,accessMode:a})}setIsolationLevel(a){return new dv({...this.#b,isolationLevel:a})}async execute(a){let{isolationLevel:b,accessMode:c,...d}=this.#b,e={isolationLevel:b,accessMode:c};return dp(e),this.#b.executor.provideConnection(async b=>{let c=this.#b.executor.withConnectionProvider(new dl(b)),f=new dt({...d,executor:c});try{await this.#b.driver.beginTransaction(b,e);let c=await a(f);return await this.#b.driver.commitTransaction(b),c}catch(a){throw await this.#b.driver.rollbackTransaction(b),a}})}}class dw{#b;constructor(a){this.#b=k(a)}setAccessMode(a){return new dw({...this.#b,accessMode:a})}setIsolationLevel(a){return new dw({...this.#b,isolationLevel:a})}async execute(){let{isolationLevel:a,accessMode:b,...c}=this.#b,d={isolationLevel:a,accessMode:b};dp(d);let e=await bB(this.#b.executor);return await this.#b.driver.beginTransaction(e.connection,d),new dx({...c,connection:e,executor:this.#b.executor.withConnectionProvider(new dl(e.connection))})}}class dx extends dt{#b;#$;#_;constructor(a){const b={isCommitted:!1,isRolledBack:!1},{connection:c,...d}=a={...a,executor:new dA(a.executor,b)};super(d),this.#b=k(a),this.#_=b;const e=bq();this.#$=b=>a.executor.compileQuery(b,e)}get isCommitted(){return this.#_.isCommitted}get isRolledBack(){return this.#_.isRolledBack}commit(){return dz(this.#_),new dy(async()=>{await this.#b.driver.commitTransaction(this.#b.connection.connection),this.#_.isCommitted=!0,this.#b.connection.release()})}rollback(){return dz(this.#_),new dy(async()=>{await this.#b.driver.rollbackTransaction(this.#b.connection.connection),this.#_.isRolledBack=!0,this.#b.connection.release()})}savepoint(a){return dz(this.#_),new dy(async()=>(await this.#b.driver.savepoint?.(this.#b.connection.connection,a,this.#$),new dx({...this.#b})))}rollbackToSavepoint(a){return dz(this.#_),new dy(async()=>(await this.#b.driver.rollbackToSavepoint?.(this.#b.connection.connection,a,this.#$),new dx({...this.#b})))}releaseSavepoint(a){return dz(this.#_),new dy(async()=>(await this.#b.driver.releaseSavepoint?.(this.#b.connection.connection,a,this.#$),new dx({...this.#b})))}withPlugin(a){return new dx({...this.#b,executor:this.#b.executor.withPlugin(a)})}withoutPlugins(){return new dx({...this.#b,executor:this.#b.executor.withoutPlugins()})}withSchema(a){return new dx({...this.#b,executor:this.#b.executor.withPluginAtFront(new bw(a))})}withTables(){return new dx({...this.#b})}}class dy{#aa;constructor(a){this.#aa=a}async execute(){return await this.#aa()}}function dz(a){if(a.isCommitted)throw Error("Transaction is already committed");if(a.isRolledBack)throw Error("Transaction is already rolled back")}class dA{#G;#_;constructor(a,b){a instanceof dA?this.#G=a.#G:this.#G=a,this.#_=b}get adapter(){return this.#G.adapter}get plugins(){return this.#G.plugins}transformQuery(a,b){return this.#G.transformQuery(a,b)}compileQuery(a,b){return this.#G.compileQuery(a,b)}provideConnection(a){return this.#G.provideConnection(a)}executeQuery(a,b){return dz(this.#_),this.#G.executeQuery(a,b)}stream(a,b,c){return dz(this.#_),this.#G.stream(a,b,c)}withConnectionProvider(a){return new dA(this.#G.withConnectionProvider(a),this.#_)}withPlugin(a){return new dA(this.#G.withPlugin(a),this.#_)}withPlugins(a){return new dA(this.#G.withPlugins(a),this.#_)}withPluginAtFront(a){return new dA(this.#G.withPluginAtFront(a),this.#_)}withoutPlugins(){return new dA(this.#G.withoutPlugins(),this.#_)}}function dB(a,b){return T.createWithChildren([T.createWithSql(`${a} `),q.create(b)])}let dC=k({raw:(a,b=[])=>k({sql:a,query:T.createWithSql(a),parameters:k(b),queryId:bq()})}),dD=Symbol();class dE{#ab;#P=new WeakMap;#ac;constructor(a){this.#ab=k({...a})}async init(){this.#ac=i(this.#ab.pool)?await this.#ab.pool():this.#ab.pool}async acquireConnection(){let a=await this.#ac.connect(),b=this.#P.get(a);return!b&&(b=new dF(a,{cursor:this.#ab.cursor??null}),this.#P.set(a,b),this.#ab.onCreateConnection&&await this.#ab.onCreateConnection(b)),this.#ab.onReserveConnection&&await this.#ab.onReserveConnection(b),b}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c="start transaction";b.isolationLevel&&(c+=` isolation level ${b.isolationLevel}`),b.accessMode&&(c+=` ${b.accessMode}`),await a.executeQuery(dC.raw(c))}else await a.executeQuery(dC.raw("begin"))}async commitTransaction(a){await a.executeQuery(dC.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(dC.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(dB("savepoint",b),bq()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(dB("rollback to",b),bq()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(dB("release",b),bq()))}async releaseConnection(a){a[dD]()}async destroy(){if(this.#ac){let a=this.#ac;this.#ac=void 0,await a.end()}}}class dF{#ad;#ae;constructor(a,b){this.#ad=a,this.#ae=b}async executeQuery(a){try{let{command:b,rowCount:c,rows:d}=await this.#ad.query(a.sql,[...a.parameters]);return{numAffectedRows:"INSERT"===b||"UPDATE"===b||"DELETE"===b||"MERGE"===b?BigInt(c):void 0,rows:d??[]}}catch(a){throw function(a,b){var c;if(j(c=a)&&e(c.stack)&&b.stack){let c=b.stack.split("\n").slice(1).join("\n");a.stack+=`
${c}`}return a}(a,Error())}}async *streamQuery(a,b){if(!this.#ae.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=this.#ad.query(new this.#ae.cursor(a.sql,a.parameters.slice()));try{for(;;){let a=await c.read(b);if(0===a.length)break;yield{rows:a}}}finally{await c.close()}}[dD](){this.#ad.release()}}k({__noMigrations__:!0});class dG{#b;constructor(a){this.#b=k(a)}get expressionType(){}get isRawBuilder(){return!0}as(a){return new dI(this,a)}$castTo(){return new dG({...this.#b})}$notNull(){return new dG(this.#b)}withPlugin(a){return new dG({...this.#b,plugins:void 0!==this.#b.plugins?k([...this.#b.plugins,a]):k([a])})}toOperationNode(){return this.#af(this.#ag())}compile(a){return this.#ah(this.#ag(a))}async execute(a){let b=this.#ag(a);return b.executeQuery(this.#ah(b),this.#b.queryId)}#ag(a){let b=void 0!==a?a.getExecutor():bF;return void 0!==this.#b.plugins?b.withPlugins(this.#b.plugins):b}#af(a){return a.transformQuery(this.#b.rawNode,this.#b.queryId)}#ah(a){return a.compileQuery(this.#af(a),this.#b.queryId)}}function dH(a){return new dG(a)}class dI{#ai;#z;constructor(a,b){this.#ai=a,this.#z=b}get expression(){return this.#ai}get alias(){return this.#z}get rawBuilder(){return this.#ai}toOperationNode(){return z.create(this.#ai.toOperationNode(),B(this.#z)?this.#z.toOperationNode():q.create(this.#z))}}let dJ=Object.assign((a,...b)=>dH({queryId:bq(),rawNode:T.create(a,b?.map(dK)??[])}),{ref:a=>dH({queryId:bq(),rawNode:T.createWithChild(af(a))}),val:a=>dH({queryId:bq(),rawNode:T.createWithChild(am(a))}),value(a){return this.val(a)},table:a=>dH({queryId:bq(),rawNode:T.createWithChild(cn(a))}),id(...a){let b=Array(a.length+1).fill(".");return b[0]="",b[b.length-1]="",dH({queryId:bq(),rawNode:T.create(b,a.map(q.create))})},lit:a=>dH({queryId:bq(),rawNode:T.createWithChild(al.createImmediate(a))}),literal(a){return this.lit(a)},raw:a=>dH({queryId:bq(),rawNode:T.createWithSql(a)}),join(a,b=dJ`, `){let c=Array(Math.max(2*a.length-1,0)),d=b.toOperationNode();for(let b=0;b<a.length;++b)c[2*b]=dK(a[b]),b!==a.length-1&&(c[2*b+1]=d);return dH({queryId:bq(),rawNode:T.createWithChildren(c)})}});function dK(a){return B(a)?a.toOperationNode():am(a)}a.s(["sql",0,dJ],640796);class dL{#aj;constructor(a){this.#aj=a}async getSchemas(){return(await this.#aj.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(a=>({name:a.nspname}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#aj.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",dJ`col_description(a.attrelid, a.attnum)`.as("column_description"),dJ`pg_get_serial_sequence(ns.nspname || '.' || c.relname, a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();a.withInternalKyselyTables||(b=b.where("c.relname","!=","kysely_migration").where("c.relname","!=","kysely_migration_lock"));let c=await b.execute();return this.#ak(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#ak(a){return a.reduce((a,b)=>{let c=a.find(a=>a.name===b.table&&a.schema===b.schema);return c||(c=k({name:b.table,isView:"v"===b.table_type,schema:b.schema,columns:[]}),a.push(c)),c.columns.push(k({name:b.column,dataType:b.type,dataTypeSchema:b.type_schema,isNullable:!b.not_null,isAutoIncrementing:null!==b.auto_incrementing,hasDefaultValue:b.has_default,comment:b.column_description??void 0})),a},[])}}class dM{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#al=k({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)});visitNode=a=>{this.nodeStack.push(a),this.#al[a.kind](a),this.nodeStack.pop()}}let dN=/'/g;class dO extends dM{#am="";#an=[];get numParameters(){return this.#an.length}compileQuery(a,b){return this.#am="",this.#an=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(a),k({query:a,queryId:b,sql:this.getSql(),parameters:[...this.#an]})}getSql(){return this.#am}visitSelectQuery(a){let b=void 0!==this.parentNode&&!ap.is(this.parentNode)&&!aE.is(this.parentNode)&&!u.is(this.parentNode)&&!c1.is(this.parentNode)&&!bP.is(this.parentNode);void 0===this.parentNode&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("select"),a.distinctOn&&(this.append(" "),this.compileDistinctOn(a.distinctOn)),a.frontModifiers?.length&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.top&&(this.append(" "),this.visitNode(a.top)),a.selections&&(this.append(" "),this.compileList(a.selections)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.groupBy&&(this.append(" "),this.visitNode(a.groupBy)),a.having&&(this.append(" "),this.visitNode(a.having)),a.setOperations&&(this.append(" "),this.compileList(a.setOperations," ")),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.offset&&(this.append(" "),this.visitNode(a.offset)),a.fetch&&(this.append(" "),this.visitNode(a.fetch)),a.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...a.endModifiers])," ")),b&&this.append(")")}visitFrom(a){this.append("from "),this.compileList(a.froms)}visitSelection(a){this.visitNode(a.selection)}visitColumn(a){this.visitNode(a.column)}compileDistinctOn(a){this.append("distinct on ("),this.compileList(a),this.append(")")}compileList(a,b=", "){let c=a.length-1;for(let d=0;d<=c;d++)this.visitNode(a[d]),d<c&&this.append(b)}visitWhere(a){this.append("where "),this.visitNode(a.where)}visitHaving(a){this.append("having "),this.visitNode(a.having)}visitInsertQuery(a){let b=this.nodeStack.find(aP.is),c=b!==a;!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!aN.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append(a.replace?"replace":"insert"),a.ignore&&(W("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),a.orAction&&(this.append(" "),this.visitNode(a.orAction)),a.top&&(this.append(" "),this.visitNode(a.top)),a.into&&(this.append(" into "),this.visitNode(a.into)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.output&&(this.append(" "),this.visitNode(a.output)),a.values&&(this.append(" "),this.visitNode(a.values)),a.defaultValues&&(this.append(" "),this.append("default values")),a.onConflict&&(this.append(" "),this.visitNode(a.onConflict)),a.onDuplicateKey&&(this.append(" "),this.visitNode(a.onDuplicateKey)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!aN.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitValues(a){this.append("values "),this.compileList(a.values)}visitDeleteQuery(a){let b=this.nodeStack.find(aP.is)!==a;!b&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("delete "),a.top&&(this.visitNode(a.top),this.append(" ")),this.visitNode(a.from),a.output&&(this.append(" "),this.visitNode(a.output)),a.using&&(this.append(" "),this.visitNode(a.using)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),b&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitReturning(a){this.append("returning "),this.compileList(a.selections)}visitAlias(a){this.visitNode(a.node),this.append(" as "),this.visitNode(a.alias)}visitReference(a){a.table&&(this.visitNode(a.table),this.append(".")),this.visitNode(a.column)}visitSelectAll(a){this.append("*")}visitIdentifier(a){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(a),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(a){if(!e(a.name))throw Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(a.name))}visitAnd(a){this.visitNode(a.left),this.append(" and "),this.visitNode(a.right)}visitOr(a){this.visitNode(a.left),this.append(" or "),this.visitNode(a.right)}visitValue(a){a.immediate?this.appendImmediateValue(a.value):this.appendValue(a.value)}visitValueList(a){this.append("("),this.compileList(a.values),this.append(")")}visitTuple(a){this.append("("),this.compileList(a.values),this.append(")")}visitPrimitiveValueList(a){this.append("(");let{values:b}=a;for(let a=0;a<b.length;++a)this.appendValue(b[a]),a!==b.length-1&&this.append(", ");this.append(")")}visitParens(a){this.append("("),this.visitNode(a.node),this.append(")")}visitJoin(a){this.append(dR[a.joinType]),this.append(" "),this.visitNode(a.table),a.on&&(this.append(" "),this.visitNode(a.on))}visitOn(a){this.append("on "),this.visitNode(a.on)}visitRaw(a){let{sqlFragments:b,parameters:c}=a;for(let a=0;a<b.length;++a)this.append(b[a]),c.length>a&&this.visitNode(c[a])}visitOperator(a){this.append(a.operator)}visitTable(a){this.visitNode(a.table)}visitSchemableIdentifier(a){a.schema&&(this.visitNode(a.schema),this.append(".")),this.visitNode(a.identifier)}visitCreateTable(a){this.append("create "),a.frontModifiers&&a.frontModifiers.length>0&&(this.compileList(a.frontModifiers," "),this.append(" ")),a.temporary&&this.append("temporary "),this.append("table "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.table),a.selectQuery?(this.append(" as "),this.visitNode(a.selectQuery)):(this.append(" ("),this.compileList([...a.columns,...a.constraints??[]]),this.append(")"),a.onCommit&&(this.append(" on commit "),this.append(a.onCommit)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," ")))}visitColumnDefinition(a){a.ifNotExists&&this.append("if not exists "),this.visitNode(a.column),this.append(" "),this.visitNode(a.dataType),a.unsigned&&this.append(" unsigned"),a.frontModifiers&&a.frontModifiers.length>0&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.generated&&(this.append(" "),this.visitNode(a.generated)),a.identity&&this.append(" identity"),a.defaultTo&&(this.append(" "),this.visitNode(a.defaultTo)),a.notNull&&this.append(" not null"),a.unique&&this.append(" unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.primaryKey&&this.append(" primary key"),a.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),a.references&&(this.append(" "),this.visitNode(a.references)),a.check&&(this.append(" "),this.visitNode(a.check)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(a){this.append("references "),this.visitNode(a.table),this.append(" ("),this.compileList(a.columns),this.append(")"),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate))}visitDropTable(a){this.append("drop table "),a.ifExists&&this.append("if exists "),this.visitNode(a.table),a.cascade&&this.append(" cascade")}visitDataType(a){this.append(a.dataType)}visitOrderBy(a){this.append("order by "),this.compileList(a.items)}visitOrderByItem(a){this.visitNode(a.orderBy),a.collation&&(this.append(" "),this.visitNode(a.collation)),a.direction&&(this.append(" "),this.visitNode(a.direction)),a.nulls&&(this.append(" nulls "),this.append(a.nulls))}visitGroupBy(a){this.append("group by "),this.compileList(a.items)}visitGroupByItem(a){this.visitNode(a.groupBy)}visitUpdateQuery(a){let b=this.nodeStack.find(aP.is),c=b!==a;if(!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!aN.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("update "),a.top&&(this.visitNode(a.top),this.append(" ")),a.table&&(this.visitNode(a.table),this.append(" ")),this.append("set "),a.updates&&this.compileList(a.updates),a.output&&(this.append(" "),this.visitNode(a.output)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins){if(!a.from)throw Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(a.joins," ")}a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!aN.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitColumnUpdate(a){this.visitNode(a.column),this.append(" = "),this.visitNode(a.value)}visitLimit(a){this.append("limit "),this.visitNode(a.limit)}visitOffset(a){this.append("offset "),this.visitNode(a.offset)}visitOnConflict(a){this.append("on conflict"),a.columns?(this.append(" ("),this.compileList(a.columns),this.append(")")):a.constraint?(this.append(" on constraint "),this.visitNode(a.constraint)):a.indexExpression&&(this.append(" ("),this.visitNode(a.indexExpression),this.append(")")),a.indexWhere&&(this.append(" "),this.visitNode(a.indexWhere)),!0===a.doNothing?this.append(" do nothing"):a.updates&&(this.append(" do update set "),this.compileList(a.updates),a.updateWhere&&(this.append(" "),this.visitNode(a.updateWhere)))}visitOnDuplicateKey(a){this.append("on duplicate key update "),this.compileList(a.updates)}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.using&&(this.append(" using "),this.visitNode(a.using)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.where&&(this.append(" "),this.visitNode(a.where))}visitDropIndex(a){this.append("drop index "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.cascade&&this.append(" cascade")}visitCreateSchema(a){this.append("create schema "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.schema)}visitDropSchema(a){this.append("drop schema "),a.ifExists&&this.append("if exists "),this.visitNode(a.schema),a.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("primary key ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}buildDeferrable(a){void 0!==a.deferrable&&(a.deferrable?this.append(" deferrable"):this.append(" not deferrable")),void 0!==a.initiallyDeferred&&(a.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}visitCheckConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("check ("),this.visitNode(a.expression),this.append(")")}visitForeignKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("foreign key ("),this.compileList(a.columns),this.append(") "),this.visitNode(a.references),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate)),this.buildDeferrable(a)}visitList(a){this.compileList(a.items)}visitWith(a){this.append("with "),a.recursive&&this.append("recursive "),this.compileList(a.expressions)}visitCommonTableExpression(a){this.visitNode(a.name),this.append(" as "),g(a.materialized)&&(a.materialized||this.append("not "),this.append("materialized ")),this.visitNode(a.expression)}visitCommonTableExpressionName(a){this.visitNode(a.table),a.columns&&(this.append("("),this.compileList(a.columns),this.append(")"))}visitAlterTable(a){this.append("alter table "),this.visitNode(a.table),this.append(" "),a.renameTo&&(this.append("rename to "),this.visitNode(a.renameTo)),a.setSchema&&(this.append("set schema "),this.visitNode(a.setSchema)),a.addConstraint&&this.visitNode(a.addConstraint),a.dropConstraint&&this.visitNode(a.dropConstraint),a.renameConstraint&&this.visitNode(a.renameConstraint),a.columnAlterations&&this.compileColumnAlterations(a.columnAlterations),a.addIndex&&this.visitNode(a.addIndex),a.dropIndex&&this.visitNode(a.dropIndex)}visitAddColumn(a){this.append("add column "),this.visitNode(a.column)}visitRenameColumn(a){this.append("rename column "),this.visitNode(a.column),this.append(" to "),this.visitNode(a.renameTo)}visitDropColumn(a){this.append("drop column "),this.visitNode(a.column)}visitAlterColumn(a){this.append("alter column "),this.visitNode(a.column),this.append(" "),a.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(a.dataType),a.dataTypeExpression&&(this.append("using "),this.visitNode(a.dataTypeExpression))),a.setDefault&&(this.append("set default "),this.visitNode(a.setDefault)),a.dropDefault&&this.append("drop default"),a.setNotNull&&this.append("set not null"),a.dropNotNull&&this.append("drop not null")}visitModifyColumn(a){this.append("modify column "),this.visitNode(a.column)}visitAddConstraint(a){this.append("add "),this.visitNode(a.constraint)}visitDropConstraint(a){this.append("drop constraint "),a.ifExists&&this.append("if exists "),this.visitNode(a.constraintName),"cascade"===a.modifier?this.append(" cascade"):"restrict"===a.modifier&&this.append(" restrict")}visitRenameConstraint(a){this.append("rename constraint "),this.visitNode(a.oldName),this.append(" to "),this.visitNode(a.newName)}visitSetOperation(a){this.append(a.operator),this.append(" "),a.all&&this.append("all "),this.visitNode(a.expression)}visitCreateView(a){this.append("create "),a.orReplace&&this.append("or replace "),a.materialized&&this.append("materialized "),a.temporary&&this.append("temporary "),this.append("view "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),this.append(" "),a.columns&&(this.append("("),this.compileList(a.columns),this.append(") ")),a.as&&(this.append("as "),this.visitNode(a.as))}visitRefreshMaterializedView(a){this.append("refresh materialized view "),a.concurrently&&this.append("concurrently "),this.visitNode(a.name),a.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(a){this.append("drop "),a.materialized&&this.append("materialized "),this.append("view "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.cascade&&this.append(" cascade")}visitGenerated(a){this.append("generated "),a.always&&this.append("always "),a.byDefault&&this.append("by default "),this.append("as "),a.identity&&this.append("identity"),a.expression&&(this.append("("),this.visitNode(a.expression),this.append(")")),a.stored&&this.append(" stored")}visitDefaultValue(a){this.append("default "),this.visitNode(a.defaultValue)}visitSelectModifier(a){a.rawModifier?this.visitNode(a.rawModifier):this.append(dP[a.modifier]),a.of&&(this.append(" of "),this.compileList(a.of,", "))}visitCreateType(a){this.append("create type "),this.visitNode(a.name),a.enum&&(this.append(" as enum "),this.visitNode(a.enum))}visitDropType(a){this.append("drop type "),a.ifExists&&this.append("if exists "),this.visitNode(a.name)}visitExplain(a){this.append("explain"),(a.options||a.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),a.options&&(this.visitNode(a.options),a.format&&this.append(this.getExplainOptionsDelimiter())),a.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(a.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(a){this.append("default")}visitAggregateFunction(a){this.append(a.func),this.append("("),a.distinct&&this.append("distinct "),this.compileList(a.aggregated),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),this.append(")"),a.withinGroup&&(this.append(" within group ("),this.visitNode(a.withinGroup),this.append(")")),a.filter&&(this.append(" filter("),this.visitNode(a.filter),this.append(")")),a.over&&(this.append(" "),this.visitNode(a.over))}visitOver(a){this.append("over("),a.partitionBy&&(this.visitNode(a.partitionBy),a.orderBy&&this.append(" ")),a.orderBy&&this.visitNode(a.orderBy),this.append(")")}visitPartitionBy(a){this.append("partition by "),this.compileList(a.items)}visitPartitionByItem(a){this.visitNode(a.partitionBy)}visitBinaryOperation(a){this.visitNode(a.leftOperand),this.append(" "),this.visitNode(a.operator),this.append(" "),this.visitNode(a.rightOperand)}visitUnaryOperation(a){this.visitNode(a.operator),this.isMinusOperator(a.operator)||this.append(" "),this.visitNode(a.operand)}isMinusOperator(a){return L.is(a)&&"-"===a.operator}visitUsing(a){this.append("using "),this.compileList(a.tables)}visitFunction(a){this.append(a.func),this.append("("),this.compileList(a.arguments),this.append(")")}visitCase(a){this.append("case"),a.value&&(this.append(" "),this.visitNode(a.value)),a.when&&(this.append(" "),this.compileList(a.when," ")),a.else&&(this.append(" else "),this.visitNode(a.else)),this.append(" end"),a.isStatement&&this.append(" case")}visitWhen(a){this.append("when "),this.visitNode(a.condition),a.result&&(this.append(" then "),this.visitNode(a.result))}visitJSONReference(a){this.visitNode(a.reference),this.visitNode(a.traversal)}visitJSONPath(a){for(let b of(a.inOperator&&this.visitNode(a.inOperator),this.append("'$"),a.pathLegs))this.visitNode(b);this.append("'")}visitJSONPathLeg(a){let b="ArrayLocation"===a.type;this.append(b?"[":"."),this.append(String(a.value)),b&&this.append("]")}visitJSONOperatorChain(a){for(let b=0,c=a.values.length;b<c;b++)b===c-1?this.visitNode(a.operator):this.append("->"),this.visitNode(a.values[b])}visitMergeQuery(a){a.with&&(this.visitNode(a.with),this.append(" ")),this.append("merge "),a.top&&(this.visitNode(a.top),this.append(" ")),this.append("into "),this.visitNode(a.into),a.using&&(this.append(" "),this.visitNode(a.using)),a.whens&&(this.append(" "),this.compileList(a.whens," ")),a.returning&&(this.append(" "),this.visitNode(a.returning)),a.output&&(this.append(" "),this.visitNode(a.output)),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitMatched(a){a.not&&this.append("not "),this.append("matched"),a.bySource&&this.append(" by source")}visitAddIndex(a){this.append("add "),a.unique&&this.append("unique "),this.append("index "),this.visitNode(a.name),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.using&&(this.append(" using "),this.visitNode(a.using))}visitCast(a){this.append("cast("),this.visitNode(a.expression),this.append(" as "),this.visitNode(a.dataType),this.append(")")}visitFetch(a){this.append("fetch next "),this.visitNode(a.rowCount),this.append(` rows ${a.modifier}`)}visitOutput(a){this.append("output "),this.compileList(a.selections)}visitTop(a){this.append(`top(${a.expression})`),a.modifiers&&this.append(` ${a.modifiers}`)}visitOrAction(a){this.append(a.action)}visitCollate(a){this.append("collate "),this.visitNode(a.collation)}append(a){this.#am+=a}appendValue(a){this.addParameter(a),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(a){let b=this.getLeftIdentifierWrapper(),c=this.getRightIdentifierWrapper(),d="";for(let e of a)d+=e,e===b?d+=b:e===c&&(d+=c);return d}sanitizeStringLiteral(a){return a.replace(dN,"''")}addParameter(a){this.#an.push(a)}appendImmediateValue(a){if(e(a))this.appendStringLiteral(a);else if(f(a)||g(a))this.append(a.toString());else if(null===a)this.append("null");else if(a instanceof Date)this.appendImmediateValue(a.toISOString());else if(h(a))this.appendImmediateValue(a.toString());else throw Error(`invalid immediate value ${a}`)}appendStringLiteral(a){this.append("'"),this.append(this.sanitizeStringLiteral(a)),this.append("'")}sortSelectModifiers(a){return a.sort((a,b)=>a.modifier&&b.modifier?dQ[a.modifier]-dQ[b.modifier]:1),k(a)}compileColumnAlterations(a){this.compileList(a)}announcesNewColumnDataType(){return!0}}let dP=k({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),dQ=k({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),dR=k({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"}),dS=/"/g;class dT extends dO{sanitizeIdentifier(a){return a.replace(dS,'""')}}class dU{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}let dV=BigInt("3853314791062309107");class dW extends dU{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(a,b){await dJ`select pg_advisory_xact_lock(${dJ.lit(dV)})`.execute(a)}async releaseMigrationLock(a,b){}}class dX{#ab;constructor(a){this.#ab=a}createDriver(){return new dE(this.#ab)}createQueryCompiler(){return new dT}createAdapter(){return new dW}createIntrospector(a){return new dL(a)}}class dY extends bs{#ao;constructor(a){super(),this.#ao=a}transformIdentifier(a,b){return{...a=super.transformIdentifier(a,b),name:this.#ao(a.name)}}}function dZ(a){return a>="0"&&a<="9"}function d$(a){let b=new Map;return c=>{let d=b.get(c);return d||(d=a(c),b.set(c,d)),d}}class d_{opt;#ap;#ao;#aq;constructor(a={}){this.opt=a,this.#ap=function({upperCase:a=!1}={}){return d$(b=>{if(0===b.length)return b;a&&function(a){for(let b=1,c=a.length;b<c;++b){let c=a[b];if("_"!==c&&c!==c.toUpperCase())return!1}return!0}(b)&&(b=b.toLowerCase());let c=b[0];for(let a=1,d=b.length;a<d;++a){let d=b[a],e=b[a-1];"_"!==d&&("_"===e?c+=d.toUpperCase():c+=d)}return c})}(a),this.#ao=function({upperCase:a=!1,underscoreBeforeDigits:b=!1,underscoreBetweenUppercaseLetters:c=!1}={}){return d$(d=>{if(0===d.length)return d;let e=d.toUpperCase(),f=d.toLowerCase(),g=f[0];for(let a=1,h=d.length;a<h;++a){let h=d[a],i=d[a-1],j=e[a],k=e[a-1],l=f[a],m=f[a-1];if(b&&dZ(h)&&!dZ(i)&&!g.endsWith("_")){g+="_"+h;continue}if(h===j&&j!==l){let a=i===k&&k!==m;c||!a?g+="_"+l:g+=l}else g+=h}return a?g.toUpperCase():g})}(a),this.#aq=new dY(this.snakeCase.bind(this))}transformQuery(a){return this.#aq.transformNode(a.node,a.queryId)}async transformResult(a){return a.result.rows&&Array.isArray(a.result.rows)?{...a.result,rows:a.result.rows.map(a=>this.mapRow(a))}:a.result}mapRow(a){return Object.keys(a).reduce((b,c)=>{let d=a[c];return Array.isArray(d)?d=d.map(a=>d0(a,this.opt)?this.mapRow(a):a):d0(d,this.opt)&&(d=this.mapRow(d)),b[this.camelCase(c)]=d,b},{})}snakeCase(a){return this.#ao(a)}camelCase(a){return this.#ap(a)}}function d0(a,b){return function(a){var b;if(!j(a)||"[object Object]"!==(null==(b=a)?void 0===b?"[object Undefined]":"[object Null]":o.call(b)))return!1;if(null===Object.getPrototypeOf(a))return!0;let c=a;for(;null!==Object.getPrototypeOf(c);)c=Object.getPrototypeOf(c);return Object.getPrototypeOf(a)===c}(a)&&!b?.maintainNestedObjectKeys}var d1=a.i(967255);let d2=new Map,d3=new Map,{databaseUrl:d4}=(0,c.getDatabaseSecrets)(),d5=function(a){if(d3.has(a))return d3.get(a);let b=d2.get(a);b||(b=new d1.Pool({connectionString:a,max:10}),d2.set(a,b));let c=new ds({dialect:new dX({pool:b}),plugins:[new d_]});return d3.set(a,c),c}(d4);(b=d2.get(d4))||(b=new d1.Pool({connectionString:d4,max:10}),d2.set(d4,b)),a.s(["postgresDb",0,d5],964081);class d6{db;constructor(a=d5){this.db=a}}a.s(["BaseRepository",()=>d6],449083)}];

//# sourceMappingURL=packages_shared_src_server_repositories_baseRepository_ts_dc06c444._.js.map